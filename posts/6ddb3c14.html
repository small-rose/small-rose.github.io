<!-- build time:Tue Oct 06 2020 20:27:05 GMT+0800 (中国标准时间) --><!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="keywords" content="java,sql,quartz定时任务,Quartz 定时任务,cron表达式"><meta name="description" content="个人技术笔记，记录学习/开发问题"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>定时任务之Quartz | 张小菜苔</title><link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/awesome/css/all.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/materialize/materialize.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/css/matery.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/css/my.css"><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/jquery/jquery.min.js"></script><script type="text/javascript">window.$crisp=[],window.CRISP_WEBSITE_ID="0c0bcdb7-097e-402f-bb6b-9cf042148a9e",function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)}()</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="张小菜苔" type="application/atom+xml"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><div><img src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/medias/logo-1.png" class="logo-img" alt="LOGO"> <span class="logo-span diyFont">张小菜苔</span></div></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home"></i><span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags"></i><span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark"></i><span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive"></i><span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle"></i><span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="https://zhangxiaocai.cn/contact" target="_blank" rel="noopener" class="waves-effect waves-light"><i class="fas fa-comments"></i><span>留言薄</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book"></i><span>友情链接</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fas fa-list"></i> <span>Secret</span> <i class="fas fa-chevron-down" aria-hidden="true"></i></a><ul class="sub-nav menus_item_child"><li><a href="/navigate"><i class="fas fa-location-arrow" style="margin-top:-20px"></i> <span>导航</span></a></li><li><a href="/box"><i class="fas fa-map-marker" style="margin-top:-20px"></i> <span>收藏</span></a></li><li><a href="https://hut.zhangxiaocai.cn" target="_blank" rel="noopener"><i class="fas fa-pen-alt" style="margin-top:-20px"></i> <span>写作</span></a></li><li><a href="https://yun.zhangxiaocai.cn" target="_blank" rel="noopener"><i class="fas fa-cloud" style="margin-top:-20px"></i> <span>云盘</span></a></li></ul></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索"></i></a></li><li id="fullscreen_li" class="fullscreen"><a href="javascript:void(0);" class="modal-trigger waves-effect waves-light"><i id="fullscreen" class="fa fa-expand-arrows-alt" title="全屏"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/medias/logo-1.png" class="logo-img circle responsive-img"><div class="logo-name">张小菜苔</div><div class="logo-desc">个人技术笔记，记录学习/开发问题</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="https://zhangxiaocai.cn/contact" target="_blank" rel="noopener" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言薄</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-list"></i> Secret <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/navigate" style="margin-left:75px"><i class="fa fas fa-location-arrow" style="position:absolute;left:50px"></i> <span>导航</span></a></li><li><a href="/box" style="margin-left:75px"><i class="fa fas fa-map-marker" style="position:absolute;left:50px"></i> <span>收藏</span></a></li><li><a href="https://hut.zhangxiaocai.cn" target="_blank" rel="noopener" style="margin-left:75px"><i class="fa fas fa-pen-alt" style="position:absolute;left:50px"></i> <span>写作</span></a></li><li><a href="https://yun.zhangxiaocai.cn" target="_blank" rel="noopener" style="margin-left:75px"><i class="fa fas fa-cloud" style="position:absolute;left:50px"></i> <span>云盘</span></a></li></ul></li></ul></div></div></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/medias/featureimages/20.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">定时任务之Quartz</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{margin:35px 0 15px 0;padding-left:17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{height:calc(100vh - 250px);overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:32px;bottom:155px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Quartz/"><span class="chip bg-color">Quartz</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" class="post-category">定时任务</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp; 2020-07-18</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp; 6.6k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp; 27 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><blockquote><p>本文主要记录学习Quartz的相关内容。<br>整理于2020-06-25，最后更新2020-07-18。</p></blockquote><h3 id="一、Quartz简述"><a href="#一、Quartz简述" class="headerlink" title="一、Quartz简述"></a>一、Quartz简述</h3><p>关于调度的实现方式主要有三种：</p><p>（1）Java自带的Api有个Timer类和TimerTask类。</p><p>（2）Spring自带的Spring Task调度工具。</p><p>（3）Quartz（读阔子）开源框架，功能强大，使用起来稍显复杂。</p><blockquote><p>Quartz是一个完全由java编写的开源作业调度框架，由OpenSymphony组织开源出来。作业调度其实就是按照程序的设定，根据定义的执行时间频次表达去执行某个作业任务。</p></blockquote><p>之前说过一个定时任务的基本组件有：执行的任务类、触发任务的触发器、管理任务的任务调度器。</p><p>那么Quartz同样有这三个基本的组件，但是除此之外还有更丰富的组件。在<code>Quartz-2.0</code>之后增加了构造器模式创建示例，监听器的集中管理接口等内容，所以有些地方在写法上稍有不同。</p><h3 id="二、Quartz的基本组件"><a href="#二、Quartz的基本组件" class="headerlink" title="二、Quartz的基本组件"></a>二、Quartz的基本组件</h3><h4 id="1、Scheduler调度器"><a href="#1、Scheduler调度器" class="headerlink" title="1、Scheduler调度器"></a>1、Scheduler调度器</h4><p><code>Scheduler</code>在使用之前需要实例化。一般通过调度工厂<code>SchedulerFactory</code>来创建一个实例。</p><pre class="language-java"><code class="language-java"><span class="token comment" spellcheck="true">//得到一个默认的调度工厂</span>
SchedulerFactory schedulerFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StdSchedulerFactory</span>
Scheduler sched <span class="token operator">=</span> schedFact<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>scheduler</code>实例化后，可以启动(start)、暂停(stand-by)、停止(shutdown)、还可以设置自定义相关监听。</p><p>【注意，此处只是列出一些常见方法，实际使用先后顺序】</p><pre class="language-java"><code class="language-java">scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> simpleTrigger<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//添加调度任务</span>

scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//启动</span>
scheduler<span class="token punctuation">.</span><span class="token function">standby</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//暂停</span>
scheduler<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//关闭</span>

scheduler<span class="token punctuation">.</span><span class="token function">addJobListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加自定义任务执行监听</span>
scheduler<span class="token punctuation">.</span><span class="token function">addTriggerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpTriggerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加自定义触发器监听</span>
scheduler<span class="token punctuation">.</span><span class="token function">addSchedulerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpSchedulerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加自定义调度器监听</span></code></pre><p>​ 需要注意的是：scheduler被停止后，除非重新实例化，否则不能重新启动；只有当scheduler启动后，即使处于暂停状态也不行，trigger才会被触发（job才能被执行）。</p><p>​ Quartz-2.0之后的监听器调整为使用监听管理的<code>ListenerManager</code>接口进行集中管理的。使用添加或移除都需要先拿到<code>ListenerManager</code>之后再进行操作，后面会有具体示例。</p><h4 id="2、Job作业接口"><a href="#2、Job作业接口" class="headerlink" title="2、Job作业接口"></a>2、Job作业接口</h4><p>Job接口只有一个execute方法，类似线程的run方法，用来执行业务作业逻辑。</p><p>业务作业实现了Job接口之后就可以由调度器Schedule进行管理执行。</p><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>job<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>Job<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobDataMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobExecutionContext<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobExecutionException<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> JobExecutionException <span class="token punctuation">{</span>
        JobDataMap dataMap <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" job executed "</span> <span class="token operator">+</span> dataMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre><h4 id="3、JobDetail作业实例"><a href="#3、JobDetail作业实例" class="headerlink" title="3、JobDetail作业实例"></a>3、JobDetail作业实例</h4><p><code>JobDetail</code>用于定义作业的实例（Job实例），为Job实例提供属性设置，用来存储特定Job实例的状态信息，调度器Schedule需要借助<code>JobDetail</code>对象来添加Job实例。</p><p><code>JobDetail</code>的重要属性有：</p><p>​ <code>name</code>—- 任务名称</p><p>​ <code>group</code> —- 任务所在组名称</p><p>​ <code>jobClass</code> —- 任务执行类，也就是实现了<code>Job</code>接口的业务作业类。</p><p>​ <code>jobDataMap</code> —- 任务的状态数据，其实就是一些相关参数，可以动态传入。</p><pre class="language-java"><code class="language-java">Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>Srting<span class="token punctuation">,</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
JobDetail JobDetail <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JobDetail</span><span class="token punctuation">(</span>jobName<span class="token punctuation">,</span> jobGroupName<span class="token punctuation">,</span> jobClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
JobDetail<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 该数据可以通过Job中的JobDataMap dataMap = context.getJobDetail().getJobDataMap();来进行参数传递值</span></code></pre><h4 id="4、Trigger触发器"><a href="#4、Trigger触发器" class="headerlink" title="4、Trigger触发器"></a>4、Trigger触发器</h4><p>Trigger是用来定义执行业务作业的计划组件。</p><p>Trigger的类型主要有4种：</p><p>​ （1）<code>SimpleTrigger</code>：从某一个时间开始，以一定的时间间隔来执行任务。它主要有两个属性，<code>repeatInterval</code> 重复的时间间隔；<code>repeatCount</code> 重复的次数，实际上执行的次数是n+1,因为在<code>startTime</code>的时候会执行一次。</p><p>​ （2） <code>CronTrigger</code>：适合于复杂的任务，使用<code>cron</code>表达式来定义执行规则。</p><p>​ （3）<code>CalendarIntervalTrigger</code>：类似于<code>SimpleTrigger</code>，指定从某一个时间开始，以一定的时间间隔执行的任务。但是<code>CalendarIntervalTrigger</code>执行任务的时间间隔比<code>SimpleTrigger</code>要丰富，它支持的间隔单位有秒，分钟，小时，天，月，年，星期。它的主要两个属性，<code>interval</code>执行间隔；<code>intervalUnit</code>执行间隔的单位（秒，分钟，小时，天，月，年，星期）</p><p>相较于<code>SimpleTrigger</code>有两个优势：</p><p>1、更方便，比如每隔1小时执行，不用自己去计算1小时等于多少毫秒。<br>2、支持不是固定长度的间隔，比如间隔为月和年。但劣势是精度只能到秒。</p><p>​ （4）<code>DailyTimeIntervalTrigger</code>：指定每天的某个时间段内，以一定的时间间隔执行任务。并且它可以支持指定星期。</p><p>它适合的任务类似于：指定每天9:00 至 18:00，每隔70秒执行一次，并且只要周一至周五执行。</p><p>它的属性有<code>startTimeOfDay</code>每天开始时间；<code>endTimeOfDay</code>每天结束时间；<code>daysOfWeek</code>需要执行的星期；<code>interval</code> 执行间隔；<code>intervalUnit</code>执行间隔的单位（秒，分钟，小时，天，月，年，星期）；<code>repeatCount</code>重复次数</p><p>Trigger公共属性主要有：</p><p><code>jobKey</code>属性，当触发器触发时被执行的job定位；</p><p><code>startTime</code>属性：设置Trigger第一次触发的时间；</p><p><code>endTime</code>属性：表示Trigger失效的时间点。</p><p>优先级(priority)、错过触发(misfire)、日历(calendar)等</p><p>​ 优先级（priority）</p><blockquote><p>Quartz线程池的工作线程太少或者触发器较多时，Quartz可能没有足够的资源同时触发所有的trigger；这种情况下，你可能希望控制哪些trigger优先使用Quartz的工作线程，要达到该目的，可以在trigger上设置priority属性。</p><p>注意：只有同时触发的trigger之间才会比较优先级。比如：11:59触发的trigger总是在12:00触发的trigger之前执行。</p><p>注意：如果trigger是可恢复的，在恢复后再调度时，优先级与原trigger是一样的。</p></blockquote><pre class="language-java"><code class="language-java">SimpleTrigger simpleTrigger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleTrigger</span><span class="token punctuation">(</span>triggerName<span class="token punctuation">,</span> triggerGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>
simpleTrigger<span class="token punctuation">.</span><span class="token function">setStartTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// set the interval, how often the job should run (10 seconds here) </span>
simpleTrigger<span class="token punctuation">.</span><span class="token function">setRepeatInterval</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//执行间隔毫秒</span>

simpleTrigger<span class="token punctuation">.</span><span class="token function">setRepeatCount</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//重复执行次数（不含第一次执行）</span>

<span class="token comment" spellcheck="true">//结束时间</span>
simpleTrigger<span class="token punctuation">.</span><span class="token function">setEndTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>ctime <span class="token operator">+</span> 60000L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 设置触发器的优先级 默认是 5</span>
simpleTrigger<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>​ 错过触发（misfire）</p><blockquote><p>如果scheduler关闭了（系统崩溃），或者Quartz线程池中没有可用的线程来执行job（任务时间过长），此时持久性的trigger就会错过(miss)其触发时间，即错过触发(misfire)。</p><p>不同类型的trigger，有不同的misfire机制。它们默认都使用“智能机制(smart policy)”，即根据trigger的类型和配置动态调整行为。当scheduler启动的时候，查询所有错过触发(misfire)的持久性trigger。然后根据它们各自的misfire机制更新trigger的信息。</p></blockquote><p>​ 日历（Calendar）</p><blockquote><p>Quartz的<code>org.quartz.Calendar</code>对象(不是<code>java.util.Calendar</code>对象)可以在定义和存储trigger的时候与trigger进行关联。Calendar用于从trigger的调度计划中排除时间段。比如，可以创建一个trigger，每个工作日的上午9:30执行，然后增加一个Calendar，排除掉所有节假日。</p><p>任何实现了Calendar接口的可序列化对象都可以作为Calendar对象。一个Trigger可以和多个Calendar关联，以便排除或包含某些时间点。</p></blockquote><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Calendar</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//参数是毫秒单位的时间戳</span>
  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isTimeIncluded</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeStamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getNextIncludedTime</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeStamp<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></code></pre><p>Quartz提供的<code>org.quartz.impl.HolidayCalendar</code>类可以很方便地实现排除整个日期。</p><pre class="language-java"><code class="language-java">HolidayCalendar cal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HolidayCalendar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cal<span class="token punctuation">.</span><span class="token function">addExcludedDate</span><span class="token punctuation">(</span> someDate <span class="token punctuation">)</span><span class="token punctuation">;</span>
cal<span class="token punctuation">.</span><span class="token function">addExcludedDate</span><span class="token punctuation">(</span> someOtherDate <span class="token punctuation">)</span><span class="token punctuation">;</span>

scheduler<span class="token punctuation">.</span><span class="token function">addCalendar</span><span class="token punctuation">(</span><span class="token string">"myHolidaysName"</span><span class="token punctuation">,</span> cal<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


Trigger t <span class="token operator">=</span> <span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"myTriggerName"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span><span class="token string">"myJobName"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">dailyAtHourAndMinute</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// execute job daily at 9:30</span>
    <span class="token punctuation">.</span><span class="token function">modifiedByCalendar</span><span class="token punctuation">(</span><span class="token string">"myHolidaysName"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// but not on holidays</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>只要的日历类有：</p><table><thead><tr><th>日历类</th><th>说明</th></tr></thead><tbody><tr><td>HolidayCalendar</td><td>指定特定的日期，比如20200613。精度到天。</td></tr><tr><td>DailyCalendar</td><td>指定每天的时间段（rangeStartingTime, rangeEndingTime)，格式是HH:MM[:SS[:mmm]]。也就是最大精度可以到毫秒。</td></tr><tr><td>WeeklyCalendar</td><td>指定每星期的星期几，可选值比如为java.util.Calendar.SUNDAY。精度是天。</td></tr><tr><td>MonthlyCalendar</td><td>指定每月的几号。可选值为1-31。精度是天</td></tr><tr><td>AnnualCalendar</td><td>指定每年的哪一天。使用方式如上例。精度是天。</td></tr><tr><td>CronCalendar</td><td>指定<code>Cron</code>表达式。精度取决于<code>Cron</code>表达式，也就是最大精度可以到秒。</td></tr></tbody></table><h4 id="5、JobBuilder构造器"><a href="#5、JobBuilder构造器" class="headerlink" title="5、JobBuilder构造器"></a>5、JobBuilder构造器</h4><p>[注意：版本较低的可能没有构造器方式，即可能没有<code>JobBuilder</code>、<code>TriggerBuilder</code>等Builder模式]</p><p><code>JobBuilder</code>也是用于定义/构建<code>JobDetail</code>实例，定义作业的实例。<code>JobBuilder</code>的属性和<code>JobDetail</code>的属性基本一致，这样得以在build()方法里面，完成对<code>JobDetail</code>进行创建。是一个构造器风格的API。</p><pre class="language-java"><code class="language-java">JobDetail job <span class="token operator">=</span> <span class="token function">newJob</span><span class="token punctuation">(</span>MyJob<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"myJob"</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Trigger trigger <span class="token operator">=</span> <span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
             <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token function">triggerKey</span><span class="token punctuation">(</span><span class="token string">"myTrigger"</span><span class="token punctuation">,</span> <span class="token string">"myTriggerGroup"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">withIntervalInHours</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> MINUTES<span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="6、TriggerBuilder构造器"><a href="#6、TriggerBuilder构造器" class="headerlink" title="6、TriggerBuilder构造器"></a>6、TriggerBuilder构造器</h4><p><code>TriggerBuilder</code> 用于定义/构建触发器实例。是一个构造器风格的API。</p><pre class="language-java"><code class="language-java">JobDetail job <span class="token operator">=</span> <span class="token function">newJob</span><span class="token punctuation">(</span>TestJob<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"myJob"</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Trigger trigger <span class="token operator">=</span> <span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
             <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token function">triggerKey</span><span class="token punctuation">(</span><span class="token string">"myTrigger"</span><span class="token punctuation">,</span> <span class="token string">"myTriggerGroup"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">withIntervalInHours</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> MINUTES<span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="三、触发器使用"><a href="#三、触发器使用" class="headerlink" title="三、触发器使用"></a>三、触发器使用</h3><p>​ 前面学习了不同的Trigger，常用2种是：<code>SimpleTrigger</code>和 <code>CronTrigger</code>。</p><h4 id="1、SimpleTrigger"><a href="#1、SimpleTrigger" class="headerlink" title="1、SimpleTrigger"></a>1、SimpleTrigger</h4><p>简易触发器的使用场景是：在具体的时间点执行一次，或者在具体的时间点执行并且以指定的间隔重复执行若干次。</p><p><code>SimpleTrigger</code>的属性包括：开始时间、结束时间、重复次数以及重复的间隔。</p><p>重复次数，可以是0、正整数，以及常量<code>SimpleTrigger.REPEAT_INDEFINITELY</code>。</p><p>重复的间隔，必须是0，或者long型的正数，表示毫秒。注意:，如果重复间隔为0，trigger将会以重复次数并发执行(或者以scheduler可以处理的近似并发数)。</p><p>endTime属性的值会覆盖设置重复次数的属性值；比如，你可以创建一个trigger，在终止时间之前每隔10秒执行一次，你不需要去计算在开始时间和终止时间之间的重复次数，只需要设置终止时间并将重复次数设置为REPEAT_INDEFINITELY(当然，你也可以将重复次数设置为一个很大的值，并保证该值比trigger在终止时间之前实际触发的次数要大即可)。</p><h5 id="构建SimpleTrigger"><a href="#构建SimpleTrigger" class="headerlink" title="构建SimpleTrigger"></a>构建SimpleTrigger</h5><p><code>SimpleTrigger</code>实例通过<code>TriggerBuilder</code>设置主要的属性，通过<code>SimpleScheduleBuilder</code>设置与<code>SimpleTrigger</code>相关的属性。要使用这些builder的静态方法，需要静态导入：</p><pre class="language-java"><code class="language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>TriggerBuilder<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>SimpleScheduleBuilder<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>DateBuilder<span class="token punctuation">.</span>*<span class="token operator">:</span></code></pre><h5 id="常见的触发实例："><a href="#常见的触发实例：" class="headerlink" title="常见的触发实例："></a>常见的触发实例：</h5><p>如：指定时间开始触发，不重复：</p><pre class="language-java"><code class="language-java">Scheduler scheduler <span class="token operator">=</span> schedulerFactory<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Date someDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

SimpleTrigger simpleTrigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTrigger<span class="token punctuation">)</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"trigger1"</span><span class="token punctuation">,</span> <span class="token string">"group1"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span>someDate<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// some Date </span>
        <span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span><span class="token string">"job1"</span><span class="token punctuation">,</span> <span class="token string">"group1"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// identify job with name, group strings</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>指定时间触发，每隔10秒执行一次，重复10次：</p><pre class="language-java"><code class="language-java">simpleTrigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTrigger<span class="token punctuation">)</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"trigger2"</span><span class="token punctuation">,</span> <span class="token string">"group1"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span>myTimeToStartFiring<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// if a start time is not given (if this line were omitted), "now" is implied</span>
        <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withIntervalInSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">withRepeatCount</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// note that 10 repeats will give a total of 11 firings</span>
        <span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span>myJob<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// identify job with handle to its JobDetail itself             </span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>5分钟以后开始触发，仅执行一次：</p><pre class="language-java"><code class="language-java">simpleTrigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTrigger<span class="token punctuation">)</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"trigger3"</span><span class="token punctuation">,</span> <span class="token string">"group1"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> IntervalUnit<span class="token punctuation">.</span>MINUTE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// use DateBuilder to create a date in the future</span>
        <span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span>myJobKey<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// identify job with its JobKey</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>立即触发，每个5分钟执行一次，直到22:00：</p><pre class="language-java"><code class="language-java">simpleTrigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTrigger<span class="token punctuation">)</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"trigger4"</span><span class="token punctuation">,</span> <span class="token string">"group1"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withIntervalInMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">endAt</span><span class="token punctuation">(</span><span class="token function">dateOf</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在下一小时整点触发，每个2小时执行一次，一直重复：</p><pre class="language-java"><code class="language-java">simpleTrigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTrigger<span class="token punctuation">)</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"trigger5"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 没有定义组名，"trigger5"进入默认的group</span>
        <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span><span class="token function">evenHourDate</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//整点触发 (minutes and seconds zero ("00:00"))</span>
        <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withIntervalInHours</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//一直重复</span>
        <span class="token comment" spellcheck="true">// note that in this example, 'forJob(..)' is not called which is valid </span>
        <span class="token comment" spellcheck="true">// if the trigger is passed to the scheduler along with the job  </span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>trigger<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>还有一些没有列举的方法，在实际使用中可以点开代码看。</p><blockquote><p>TriggerBuilder(以及Quartz的其它builder)会为那些没有被显式设置的属性选择合理的默认值。比如：如果你没有调用<em>withIdentity(..)</em>方法，TriggerBuilder会为trigger生成一个随机的名称；如果没有调用<em>startAt(..)</em>方法，则默认使用当前时间，即trigger立即生效。</p></blockquote><p><strong><code>SimpleTrigger</code> Misfire策略：</strong></p><p>所有的trigger都有一个Trigger.MISFIRE_INSTRUCTION_SMART_POLICY策略可以使用，该策略也是所有trigger的默认策略。对于<code>SimpleTrigger</code>，这个“智能机制”将根据触发器实例的状态和配置来决定其行为。具体如下：</p><p>如果Repeat Count=0：只执行一次</p><p>​ instruction selected = MISFIRE_INSTRUCTION_FIRE_NOW;</p><p>如果Repeat Count=REPEAT_INDEFINITELY：无限次执行</p><p>​ instruction selected = MISFIRE_INSTRUCTION_RESCHEDULE_NEXT_WITH_REMAINING_COUNT;</p><p>如果Repeat Count&gt;0：执行多次（有限）</p><p>instruction selected = MISFIRE_INSTRUCTION_RESCHEDULE_NOW_WITH_EXISTING_REPEAT_COUNT;</p><p><code>SimpleTrigger</code>常见策略：</p><table><thead><tr><th>常见策略</th><th>策略说明</th></tr></thead><tbody><tr><td>MISFIRE_INSTRUCTION_IGNORE_MISFIRE_POLICY</td><td>忽略所有的超时状态，按照触发器的策略执行。</td></tr><tr><td>MISFIRE_INSTRUCTION_FIRE_NOW</td><td>立刻执行。对于不会重复执行的任务，这是默认的处理策略。</td></tr><tr><td>MISFIRE_INSTRUCTION_RESCHEDULE_NEXT_WITH_REMAINING_COUNT</td><td>在下一个激活点执行，且超时期内错过的执行机会作废。</td></tr><tr><td>MISFIRE_INSTRUCTION_RESCHEDULE_NOW_WITH_REMAINING_COUNT</td><td>立即执行，且超时期内错过的执行机会作废。</td></tr><tr><td>MISFIRE_INSTRUCTION_RESCHEDULE_NEXT_WITH_EXISTING_COUNT</td><td>在下一个激活点执行，并重复到指定的次数。</td></tr><tr><td>MISFIRE_INSTRUCTION_RESCHEDULE_NOW_WITH_EXISTING_COUNT</td><td>立即执行，并重复到指定的次数。</td></tr><tr><td>MISFIRE_INSTRUCTION_IGNORE_MISFIRE_POLICY</td><td>忽略所有的超时状态，按照触发器的策略执行。</td></tr></tbody></table><h4 id="2、CronTrigger"><a href="#2、CronTrigger" class="headerlink" title="2、CronTrigger"></a>2、CronTrigger</h4><p><code>Cron</code>表达式触发器的使用场景是：</p><p>基于时间表，在复杂的时间点，复杂的执行周期执行一次或多次。</p><p>例如：“每周一到周五上午8:00”或“每月最后一个星期五凌晨1:30”。</p><p><code>CronTrigger</code>类似于在给定的时间触发作业，和Linux的“<code>cron-like</code>”调度定义相似。“<code>Cron Expression</code>”字符串的格式记录在<code>CronExpression</code>类中。</p><h5 id="Cron-Expressions"><a href="#Cron-Expressions" class="headerlink" title="Cron Expressions"></a>Cron Expressions</h5><p><code>Cron-Expressions</code>用于配置<code>CronTrigger</code>的实例。<code>Cron Expressions</code>是由七个子表达式组成的字符串，用于描述日程表的各个细节。这些子表达式用空格分隔，七个子表达式依次为：<code>秒 分 时 日 月 周 年</code></p><table><thead><tr><th>位置</th><th>说明</th><th>允许值</th><th>特殊值</th></tr></thead><tbody><tr><td>1</td><td>Seconds</td><td>0-59</td><td><code>,</code> <code>-</code> <code>*</code> <code>/</code></td></tr><tr><td>2</td><td>Minutes</td><td>0-59</td><td><code>,</code> <code>-</code> <code>*</code> <code>/</code></td></tr><tr><td>3</td><td>Hours</td><td>0-23</td><td><code>,</code> <code>-</code> <code>*</code> <code>/</code></td></tr><tr><td>4</td><td>Day-of-Month</td><td>1-31</td><td><code>,</code> <code>-</code> <code>*</code> <code>/</code> <code>?</code> <code>L</code> <code>W</code> <code>C</code></td></tr><tr><td>5</td><td>Month</td><td>1-12</td><td><code>,</code> <code>-</code> <code>*</code> <code>/</code></td></tr><tr><td>6</td><td>Day-of-Week</td><td>1-7</td><td><code>,</code> <code>-</code> <code>*</code> <code>/</code> <code>?</code> <code>L</code> <code>C</code> <code>#</code></td></tr><tr><td>7</td><td>Year (可选)</td><td></td><td><code>,</code> <code>-</code> <code>*</code> <code>/</code></td></tr></tbody></table><p><code>Cron</code>表达式对特殊字符的大小写不敏感，对代表星期的缩写英文大小写也不敏感。</p><p>特殊符号说明：</p><table><thead><tr><th>符号</th><th>说明</th></tr></thead><tbody><tr><td><strong>星号(*)</strong></td><td>可用在所有字段中，表示对应时间域的每一个时刻，例如，* 在分钟字段时，表示“每分钟”；</td></tr><tr><td><strong>问号（?）</strong></td><td>该字符只在日期和星期字段中使用，它通常指定为“无意义的值”，相当于占位符；</td></tr><tr><td><strong>减号(-)</strong></td><td>表达一个范围，如在小时字段中使用“10-12”，则表示从10到12点，即10,11,12；</td></tr><tr><td><strong>逗号(,)</strong></td><td>表达一个列表值，如在星期字段中使用“MON,WED,FRI”，则表示星期一，星期三和星期五；</td></tr><tr><td><strong>斜杠(/)</strong></td><td>x/y表达一个等步长序列，x为起始值，y为增量步长值。如在分钟字段中使用0/15，则表示为0,15,30和45秒，而5/15在分钟字段中表示5,20,35,50，你也可以使用*/y，它等同于0/y；</td></tr><tr><td><strong>L</strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td>该字符只在日期和星期字段中使用，代表“Last”的意思，但它在两个字段中意思不同。<br>L在日期字段中，表示这个月份的最后一天，如一月的31号，非闰年二月的28号；<br>如果L用在星期中，则表示星期六，等同于7。<br>但是，如果L出现在星期字段里，而且在前面有一个数值X，则表示“这个月的最后X天”，例如，6L表示该月的最后星期五；</td></tr><tr><td><strong>W</strong></td><td>该字符只能出现在日期字段里，是对前导日期的修饰，表示离该日期最近的工作日。<br>例如15W表示离该月15号最近的工作日，如果该月15号是星期六，则匹配14号星期五；如果15日是星期日，则匹配16号星期一；如果15号是星期二，那结果就是15号星期二。但必须注意关联的匹配日期不能够跨月，如你指定1W，如果1号是星期六，结果匹配的是3号星期一，而非上个月最后的那天。W字符串只能指定单一日期，而不能指定日期范围；</td></tr><tr><td><strong>LW组合</strong></td><td>在日期字段可以组合使用LW，它的意思是当月的最后一个工作日；</td></tr><tr><td>*<em>井号(#) *</em></td><td>该字符只能在星期字段中使用，表示当月某个工作日。如6#3表示当月的第三个星期五(6表示星期五，#3表示当前的第三个)，而4#5表示当月的第五个星期三，假设当月没有第五个星期三，忽略不触发；</td></tr><tr><td>*<em>C *</em></td><td>该字符只在日期和星期字段中使用，代表“Calendar”的意思。它的意思是计划所关联的日期，如果日期没有被关联，则相当于日历中所有日期。例如5C在日期字段中就相当于日历5日以后的第一天。1C在星期字段中相当于星期日后的第一天。</td></tr></tbody></table><h5 id="常见表达式示例："><a href="#常见表达式示例：" class="headerlink" title="常见表达式示例："></a>常见表达式示例：</h5><table><thead><tr><th>表达式</th><th>含义</th></tr></thead><tbody><tr><td><code>&quot;0 0 12 * * ?&quot;</code></td><td>每天12点触发执行</td></tr><tr><td><code>&quot;0 15 10 ? * *&quot;</code></td><td>每天10点15分触发执行</td></tr><tr><td><code>&quot;0 15 10 * * ?&quot;</code></td><td>每天10点15分触发执行</td></tr><tr><td><code>&quot;0 15 10 * * ? *&quot;</code></td><td>每天10点15分触发执行</td></tr><tr><td><code>&quot;0 15 10 * * ? 2020&quot;</code></td><td>在2020年内，每天10点15分触发执行</td></tr><tr><td><code>&quot;0 * 14 * * ?&quot;</code></td><td>每天从下午2点开始到下午2点59分结束，每分钟触发执行一次</td></tr><tr><td><code>&quot;0 0/5 14 * * ?&quot;</code></td><td>每天从下午2点到下午2点55分，每5分钟触发一次</td></tr><tr><td><code>&quot;0 0/5 14,18 * * ?&quot;</code></td><td>每天从下午2点开始到下午2点55分每5分钟触发一次<br>从下午6点开始到下午6点55分结束，每5分钟触发一次</td></tr><tr><td><code>&quot;0 0-5 14 * * ?&quot;</code></td><td>每天从下午2点开始到下午2点05分结束，每分钟触发一次</td></tr><tr><td><code>&quot;0 10,44 14 ? 3 WED&quot;</code></td><td>（每年）三月每周三下午2:10和2:44触发</td></tr><tr><td><code>&quot;0 15 10 ? * MON-FRI&quot;</code></td><td>每周一、二、三、四、五上午10:15触发</td></tr><tr><td><code>&quot;0 15 10 15 * ?&quot;</code></td><td>每月15日上午10:15触发</td></tr><tr><td><code>&quot;0 15 10 L * ?&quot;</code></td><td>每月最后一天上午10:15触发</td></tr><tr><td><code>&quot;0 15 10 * ？ 6L&quot;</code></td><td>每月最后一个星期五上午10:15触发</td></tr><tr><td><code>&quot;0 15 10 ? * 6L&quot;</code></td><td>每月最后一个星期五上午10:15触发</td></tr><tr><td><code>&quot;0 15 10 ? * 6L 2012-2015&quot;</code></td><td>在 2012, 2013, 2014,2015期间，每月最后一个星期五上午10:15触发</td></tr><tr><td><code>&quot;0 15 10 ? * 6#3&quot;</code></td><td>每月第三个星期五上午10:15触发执行</td></tr></tbody></table><h5 id="构建CronTriggers"><a href="#构建CronTriggers" class="headerlink" title="构建CronTriggers"></a>构建CronTriggers</h5><p><code>CronTrigger</code>实例使用<code>TriggerBuilder</code>（用于触发器的主要属性）和<code>CronScheduleBuilder</code>（对于<code>CronTrigger</code>特定的属性）构建。要以<code>DSL</code>风格使用这些构建器，请使用静态导入：</p><pre><code>import static org.quartz.TriggerBuilder.*;
import static org.quartz.CronScheduleBuilder.*;
import static org.quartz.DateBuilder.*:</code></pre><p>建立一个触发器，每隔一分钟，每天上午8点至下午5点之间：</p><pre><code>CronTrigger cronTrigger = newTrigger()
                .withIdentity(&quot;trigger3&quot;, &quot;triggerGroupName&quot;)
                .withSchedule(cronSchedule(&quot;0 0/2 8-17 * * ?&quot;))
                .forJob(&quot;myJobName&quot;, &quot;groupName&quot;).build();</code></pre><p>建立一个触发器，将在上午10:42每天发射：</p><pre><code>CronTrigger cronTrigger = newTrigger()
    .withIdentity(&quot;trigger3&quot;, &quot;triggerGroupName&quot;)
    .withSchedule(dailyAtHourAndMinute(10, 42))
    .forJob(myJobKey)
    .build();</code></pre><p>或者：</p><pre><code>CronTrigger cronTrigger = newTrigger()
    .withIdentity(&quot;trigger3&quot;, &quot;triggerGroupName&quot;)
    .withSchedule(cronSchedule(&quot;0 42 10 * * ?&quot;))
    .forJob(myJobKey)
    .build();</code></pre><p>建立一个带时区的触发器，将在星期三上午10:42在TimeZone（系统默认值）之外触发：</p><pre><code>  trigger = newTrigger()
    .withIdentity(&quot;trigger3&quot;, &quot;triggerGroupName&quot;)
    .withSchedule(weeklyOnDayAndHourAndMinute(DateBuilder.WEDNESDAY, 10, 42))
    .forJob(myJobKey)
    .inTimeZone(TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;))
    .build();</code></pre><p>或者：</p><pre><code>  trigger = newTrigger()
    .withIdentity(&quot;trigger3&quot;, &quot;triggerGroupName&quot;)
    .withSchedule(cronSchedule(&quot;0 42 10 ? * WED&quot;))
    .inTimeZone(TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;))
    .forJob(myJobKey)
    .build();</code></pre><h5 id="CronTrigger-Misfire说明"><a href="#CronTrigger-Misfire说明" class="headerlink" title="CronTrigger Misfire说明"></a>CronTrigger Misfire说明</h5><h5 id="CronTrigger常见策略："><a href="#CronTrigger常见策略：" class="headerlink" title="CronTrigger常见策略："></a>CronTrigger常见策略：</h5><table><thead><tr><th>策略名称</th><th>策略说明</th></tr></thead><tbody><tr><td>MISFIRE_INSTRUCTION_IGNORE_MISFIRE_POLICY</td><td>忽略所有的超时状态，按照触发器的策略执行。</td></tr><tr><td>MISFIRE_INSTRUCTION_FIRE_ONCE_NOW</td><td>立刻执行一次，然后就按照正常的计划执行。</td></tr><tr><td>MISFIRE_INSTRUCTION_DO_NOTHING</td><td>目前不执行，然后就按照正常的计划执行。这意味着如果下次执行时间超过了end time，实际上就没有执行机会了。</td></tr></tbody></table><p>所有的trigger都有一个Trigger.MISFIRE_INSTRUCTION_SMART_POLICY策略可以使用，该策略也是所有trigger的默认策略。对于<code>CronTrigger</code>，该“智能机制”默认选择<code>MISFIRE_INSTRUCTION_FIRE_ONCE_NOW</code>以指导其行为。</p><blockquote><p>TriggerBuilder(以及Quartz的其它builder)会为那些没有被显式设置的属性选择合理的默认值。比如：如果你没有调用<em>withIdentity(..)</em>方法，TriggerBuilder会为trigger生成一个随机的名称；如果没有调用<em>startAt(..)</em>方法，则默认使用当前时间，即trigger立即生效。</p></blockquote><h3 id="四、监听器使用"><a href="#四、监听器使用" class="headerlink" title="四、监听器使用"></a>四、监听器使用</h3><p><strong>Listeners</strong>(监听器)是实现监听接口创建的对象，用于根据调度程序中发生的事件执行操作。</p><p>比较常用的监听器：</p><h4 id="1-触发器监听和任务执行监听"><a href="#1-触发器监听和任务执行监听" class="headerlink" title="1. 触发器监听和任务执行监听"></a>1. 触发器监听和任务执行监听</h4><p>TriggerListeners接收到与触发器（trigger）相关的事件，JobListeners 接收与jobs相关的事件。</p><p>与触发相关的事件包括：触发器触发，触发失灵，并触发完成（触发器关闭的作业完成）。</p><p><code>org.quartz.TriggerListener</code>接口</p><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TriggerListener</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerFired</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">,</span> JobExecutionContext context<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">vetoJobExecution</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">,</span> JobExecutionContext context<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerMisfired</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerComplete</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">,</span> JobExecutionContext context<span class="token punctuation">,</span>
            <span class="token keyword">int</span> triggerInstructionCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>job相关事件包括：job即将执行的通知，以及job完成执行时的通知。</p><p>org.quartz.JobListener接口</p><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">JobListener</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobToBeExecuted</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobExecutionVetoed</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobWasExecuted</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">,</span>
            JobExecutionException jobException<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span></code></pre><h4 id="2-自定义监听器："><a href="#2-自定义监听器：" class="headerlink" title="2. 自定义监听器："></a>2. 自定义监听器：</h4><p>要创建一个自定义的listener，只需创建一个实现<code>org.quartz.TriggerListener</code>或<code>org.quartz.JobListener</code>接口的对象。</p><p>如自定义一个触发相关监听器：</p><pre class="language-ava"><code class="language-ava">package com.smallrose.web.app.quartz.listener;

import org.quartz.JobExecutionContext;
import org.quartz.Trigger;
import org.quartz.Trigger.CompletedExecutionInstruction;
import org.quartz.TriggerListener;

public class TestTriggerListener implements TriggerListener {

    @Override
    public String getName() {
        return null;
    }

    @Override
    public void triggerFired(Trigger trigger, JobExecutionContext context) {

    }

    @Override
    public boolean vetoJobExecution(Trigger trigger, JobExecutionContext context) {
        return false;
    }

    @Override
    public void triggerMisfired(Trigger trigger) {

    }

    @Override
    public void triggerComplete(Trigger trigger, JobExecutionContext context,
            CompletedExecutionInstruction triggerInstructionCode) {

    }
}</code></pre><p>如自定义一个任务相关监听器：</p><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>listener<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobExecutionContext<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobExecutionException<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobListener<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJobListener</span> <span class="token keyword">implements</span> <span class="token class-name">JobListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobToBeExecuted</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobExecutionVetoed</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobWasExecuted</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">,</span> JobExecutionException jobException<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h4 id="3-监听器的使用"><a href="#3-监听器的使用" class="headerlink" title="3. 监听器的使用"></a>3. 监听器的使用</h4><p>添加监听使用示例：</p><pre class="language-java"><code class="language-java"><span class="token comment" spellcheck="true">//旧版</span>
scheduler<span class="token punctuation">.</span><span class="token function">addJobListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加自定义任务执行监听</span>
scheduler<span class="token punctuation">.</span><span class="token function">addTriggerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpTriggerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加自定义触发器监听</span>

<span class="token comment" spellcheck="true">//新版 since 2.0</span>
scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addJobListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加任务执行监听</span>
scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTriggerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加任务执行触发器监听</span></code></pre><p>移除监听使用示例：</p><pre class="language-java"><code class="language-java">scheduler<span class="token punctuation">.</span><span class="token function">removeJobListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//移除自定义任务执行监听</span>
scheduler<span class="token punctuation">.</span><span class="token function">removeTriggerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpTriggerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//移除自定义触发器监听</span></code></pre><pre><code>package org.quartz;

import java.util.List;

/**
 * 
 * @author jhouse
 * @since 2.0 - previously listeners were managed directly on the Scheduler interface.
 */
public interface ListenerManager {

    public void addJobListener(JobListener jobListener);

    public void addJobListener(JobListener jobListener, Matcher&lt;JobKey&gt; matcher);

    public void addJobListener(JobListener jobListener, Matcher&lt;JobKey&gt; ... matchers);

    public void addJobListener(JobListener jobListener, List&lt;Matcher&lt;JobKey&gt;&gt; matchers);

    public boolean addJobListenerMatcher(String listenerName, Matcher&lt;JobKey&gt; matcher);

    public boolean removeJobListenerMatcher(String listenerName, Matcher&lt;JobKey&gt; matcher);

    public boolean setJobListenerMatchers(String listenerName, List&lt;Matcher&lt;JobKey&gt;&gt; matchers);

    public List&lt;Matcher&lt;JobKey&gt;&gt; getJobListenerMatchers(String listenerName);

    public boolean removeJobListener(String name);

    public JobListener getJobListener(String name);

    public void addTriggerListener(TriggerListener triggerListener);


    public void addTriggerListener(TriggerListener triggerListener, Matcher&lt;TriggerKey&gt; matcher);


    public void addTriggerListener(TriggerListener triggerListener, Matcher&lt;TriggerKey&gt; ... matchers);


    public void addTriggerListener(TriggerListener triggerListener, List&lt;Matcher&lt;TriggerKey&gt;&gt; matchers);

    public boolean addTriggerListenerMatcher(String listenerName, Matcher&lt;TriggerKey&gt; matcher);


    public boolean removeTriggerListenerMatcher(String listenerName, Matcher&lt;TriggerKey&gt; matcher);


    public boolean setTriggerListenerMatchers(String listenerName, List&lt;Matcher&lt;TriggerKey&gt;&gt; matchers);

    public List&lt;Matcher&lt;TriggerKey&gt;&gt; getTriggerListenerMatchers( String listenerName);


    public boolean removeTriggerListener(String name);


    public List&lt;TriggerListener&gt; getTriggerListeners();

    public TriggerListener getTriggerListener(String name);

    public void addSchedulerListener(SchedulerListener schedulerListener);

    public boolean removeSchedulerListener(SchedulerListener schedulerListener);


    public List&lt;SchedulerListener&gt; getSchedulerListeners();

}</code></pre><h4 id="4-调度监听器"><a href="#4-调度监听器" class="headerlink" title="4. 调度监听器"></a>4. 调度监听器</h4><p>SchedulerListeners非常类似于TriggerListeners和JobListeners，除了它们在Scheduler本身中接收到事件的通知 ，不一定与特定触发器（trigger）或job相关的事件。</p><p>与计划程序相关的事件包括：添加job/触发器，删除job/触发器，调度程序中的严重错误，关闭调度程序的通知等。</p><p><code>org.quartz.SchedulerListener</code>接口</p><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SchedulerListener</span> <span class="token punctuation">{</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobScheduled</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobUnscheduled</span><span class="token punctuation">(</span>String triggerName<span class="token punctuation">,</span> String triggerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerFinalized</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggersPaused</span><span class="token punctuation">(</span>String triggerName<span class="token punctuation">,</span> String triggerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggersResumed</span><span class="token punctuation">(</span>String triggerName<span class="token punctuation">,</span> String triggerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobsPaused</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobsResumed</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerError</span><span class="token punctuation">(</span>String msg<span class="token punctuation">,</span> SchedulerException cause<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerInStandbyMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulingDataCleared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  </code></pre><p>调度监听器注册到调度器的监听管理器中，调度监听器实际上可以是实现org.quartz.SchedulerListener接口的任何对象。</p><p>添加调度监听器</p><pre class="language-java"><code class="language-java"><span class="token comment" spellcheck="true">//旧版</span>
scheduler<span class="token punctuation">.</span><span class="token function">addSchedulerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpSchedulerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//添加自定义调度器监听</span>
<span class="token comment" spellcheck="true">//新版 since 2.0</span>
scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addSchedulerListener</span><span class="token punctuation">(</span>mySchedListener<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>移除调度监听器</p><pre class="language-java"><code class="language-java"><span class="token comment" spellcheck="true">//旧版</span>
scheduler<span class="token punctuation">.</span><span class="token function">removeSchedulerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpSchedulerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//移除自定义调度器监听</span>
<span class="token comment" spellcheck="true">//新版 since 2.0</span>
scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeSchedulerListener</span><span class="token punctuation">(</span>mySchedListener<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="五、Job-Stores"><a href="#五、Job-Stores" class="headerlink" title="五、Job Stores"></a>五、Job Stores</h3><p>JobStore负责跟踪您提供给调度程序的所有“工作数据”：jobs，triggers，日历等。</p><p><code>JobStore</code>其实就是定时任务的相关数据存储。</p><p>支持存储方式有：</p><p>（1）RAMJobStore 内存定时数据存储。</p><p>（2）JDBC JobStore 通过JDBC将其所有数据保存在数据库中。</p><p>（3）TerracottaJobStore TerracottaJobStore用于在集群服务器内存储调度信息（Jobs，Triggers和calendars）</p><h4 id="RAMJobStore"><a href="#RAMJobStore" class="headerlink" title="RAMJobStore"></a>RAMJobStore</h4><p>RAMJobStore是使用最简单的JobStore，配置简单，性能最高的（在CPU时间方面）。RAMJobStore以其明显的方式获取其名称，它将其所有数据保存在RAM中。缺点是当您的应用程序结束（或崩溃）时，所有调度信息都将丢失 - 这意味着RAMJobStore无法履行作业和triggers上的“非易失性”设置。</p><p>使用RAMJobStore ，只需将类名称org.quartz.simpl.RAMJobStore指定为用于配置石英的JobStore类属性：</p><p>配置Quartz以使用RAMJobStore</p><pre><code>org.quartz.jobStore.class = org.quartz.simpl.RAMJobStore</code></pre><p>其实在没有JDBC的情况下，默认就是RAMJobStore。</p><h4 id="JDBC-JobStore"><a href="#JDBC-JobStore" class="headerlink" title="JDBC JobStore"></a>JDBC JobStore</h4><p>JDBCJobStore几乎支持与任何数据库一起使用，已被广泛应用于Oracle，PostgreSQL，MySQL，MS SQLServer，HSQLDB和DB2。</p><p>数据库中各表的含义：</p><table><thead><tr><th>表名</th><th>表存储信息说明</th></tr></thead><tbody><tr><td>qrtz_blob_triggers</td><td>这张表示存储自己定义的trigger，不是quartz自己提供的trigger</td></tr><tr><td>qrtz_calendars</td><td>存储Calendar</td></tr><tr><td>qrtz_cron_triggers</td><td>存储cronTrigger</td></tr><tr><td>qrtz_fired_triggers</td><td>存储触发的Tirgger</td></tr><tr><td>qrtz_job_details</td><td>存储JobDetail</td></tr><tr><td>qrtz_locks</td><td>存储程序中非悲观锁的信息</td></tr><tr><td>qrtz_paused_trigger_grps</td><td>存储已暂停的Trigger组信息</td></tr><tr><td>qrtz_scheduler_state</td><td>存储集群中note实例信息，quartz会定时读取该表的信息判断集群中 每个实例的当前状态</td></tr><tr><td>qrtz_simple_triggers</td><td>存储simpleTrigger的信息</td></tr><tr><td>qrtz_simprop_triggers</td><td>储存CalendarIntervalTrigger和DailyTimeIntervalTrigger的信息</td></tr><tr><td>qrtz_triggers</td><td>存储已配置的trigger信息</td></tr></tbody></table><h3 id="六、其他"><a href="#六、其他" class="headerlink" title="六、其他"></a>六、其他</h3><p>后续再补充</p><br><br><p><strong>相关文章</strong></p><p><a href="a516f8e8.html">定时任务之Java定时API</a><br><a href="5a5ab620.html">定时任务之Spring Task</a><br><a href="6ddb3c14.html">定时任务之quartz</a></p><br><p>本文整理参考以下前辈链接，放个链接，以示感谢：</p><ul><li>参考文章1：<a href="https://blog.csdn.net/chengqiuming/java/article/details/84144534" target="_blank" rel="noopener">https://blog.csdn.net/chengqiuming/java/article/details/84144534</a></li><li>参考文章2：<a href="https://www.cnblogs.com/kyleinjava/p/10432168.html" target="_blank" rel="noopener">https://www.cnblogs.com/kyleinjava/p/10432168.html</a></li><li>参考文章3：<a href="http://www.quartz-scheduler.org/documentation/quartz-2.3.0/" target="_blank" rel="noopener">http://www.quartz-scheduler.org/documentation/quartz-2.3.0/</a></li><li>参考文章4：<a href="https://www.w3cschool.cn/quartz_doc/" target="_blank" rel="noopener">https://www.w3cschool.cn/quartz_doc/</a></li></ul></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Small-Rose / 张小菜</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: </i></span><span class="reprint-info"><a href="https://small-rose.github.io/posts/6ddb3c14.html">https://small-rose.github.io/posts/6ddb3c14.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Small-Rose / 张小菜</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Quartz/"><span class="chip bg-color">Quartz</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22AB38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019FE8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/gitalk/gitalk.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/css/my-gitalk.css"><div class="card gitalk-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="gitalk-container" class="card-content"></div></div><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/gitalk/gitalk.min.js"></script><script>let gitalk = new Gitalk({
        clientID: '25d0a50a89b8a9328515',
        clientSecret: '87ad6a6e64a7b5727d9c9f5f049f5a28bf714dcc',
        repo: 'small-rose.github.io',
        owner: 'small-rose',
        admin: "small-rose",
        id: '2020-07-18T23-00-00',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;上一篇</div><div class="card"><a href="/posts/5a2c12e2.html"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/medias/featureimages/5.jpg" class="responsive-img" alt="Hexo 博客添加思维导图渲染"> <span class="card-title">Hexo 博客添加思维导图渲染</span></div></a><div class="card-content article-content"><div class="summary block-with-text">本文记录hexo博客添加思维导图渲染。</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2020-07-20 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Hexo/" class="post-category">Hexo</a></span></div></div><div class="card-action article-tags"><a href="/tags/Hexo/"><span class="chip bg-color">Hexo</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/5a5ab620.html"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/medias/featureimages/7.jpg" class="responsive-img" alt="定时任务之Spring Task"> <span class="card-title">定时任务之Spring Task</span></div></a><div class="card-content article-content"><div class="summary block-with-text">本文整理Spring Task的不同场景不同用法。</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2020-07-18 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" class="post-category">定时任务</a></span></div></div><div class="card-action article-tags"><a href="/tags/Spring-Task/"><span class="chip bg-color">Spring Task</span></a></div></div></div></div></article></div><script>$("#articleContent").on("copy",function(e){if("undefined"!=typeof window.getSelection){var n=window.getSelection();if(!((""+n).length<Number.parseInt("120"))){var t=document.getElementsByTagName("body")[0],o=document.createElement("div");o.style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"===n.getRangeAt(0).commonAncestorContainer.nodeName&&(o.innerHTML="<pre>"+o.innerHTML+"</pre>");var i=document.location.href;o.innerHTML+='<br />来源: 张小菜苔<br />文章作者: Small Rose / 张小菜<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout(function(){t.removeChild(o)},200)}}})</script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><footer class="page-footer bg-color"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/aplayer/APlayer.min.css"><style>.aplayer .aplayer-lrc p{display:none;font-size:12px;font-weight:700;line-height:16px!important}.aplayer .aplayer-lrc p.aplayer-lrc-current{display:none;font-size:15px;color:#42b983}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><div><div class="row"><meting-js class="col l8 offset-l2 m10 offset-m1 s12" server="netease" type="playlist" id="503838841" fixed="true" autoplay theme="#42b983" loop order="random" preload="auto" volume="0.7" list-folded="true"></meting-js></div></div><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/aplayer/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2020</span> <a href="/about" target="_blank">Small Rose / 张小菜</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">176.3k</span>&nbsp;字 <span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次 </span><span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;人</span><br><span id="sitetime">载入运行时间...</span><script>function siteTime(){var e=1e3,t=60*e,n=60*t,o=24*n,r=365*o,a=new Date,i="2020",l="5",m="1",M="0",g="0",d="0",s=a.getFullYear(),u=a.getMonth()+1,T=a.getDate(),c=a.getHours(),f=a.getMinutes(),h=a.getSeconds(),y=Date.UTC(i,l,m,M,g,d),H=Date.UTC(s,u,T,c,f,h),I=H-y,B=Math.floor(I/r),D=Math.floor(I/o-365*B),E=Math.floor((I-(365*B+D)*o)/n),L=Math.floor((I-(365*B+D)*o-E*n)/t),v=Math.floor((I-(365*B+D)*o-E*n-L*t)/e);i==s?(document.getElementById("year").innerHTML=s,document.getElementById("sitetime").innerHTML="本站已安全运行 "+D+" 天 "+E+" 小时 "+L+" 分钟 "+v+" 秒"):(document.getElementById("year").innerHTML=i+" - "+s,document.getElementById("sitetime").innerHTML="本站已安全运行 "+B+" 年 "+D+" 天 "+E+" 小时 "+L+" 分钟 "+v+" 秒")}setInterval(siteTime,1e3)</script><br><span id="icp"><img src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/medias/icp.png" style="vertical-align:text-bottom"> <a href="http://beian.miit.gov.cn/" target="_blank">鄂ICP备19015637号</a></span></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/small-rose" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i> </a><a href="mailto:small-rose@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i> </a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=970175021" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 970175021" data-position="top" data-delay="50"><i class="fab fa-qq"></i> </a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/js/search.js"></script><script type="text/javascript">$(function(){searchFunc("https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/materialize/materialize.min.js"></script><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/masonry/masonry.pkgd.min.js"></script><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/aos/aos.js"></script><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/js/matery.js"></script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/others/clicklove.js" async></script><script async src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/others/busuanzi.pure.mini.js"></script><script type="text/javascript" size="150" alpha="0.6" zindex="-1" src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/background/ribbon-refresh.min.js" async></script><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/libs/instantpage/instantpage.js" type="module"></script><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/js/funnyTitle.js" type="module"></script><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/js/sakura.js" type="module"></script><script src="https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io@master/js/fullscreen.js" type="module"></script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var i=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){i&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,e,a=0;a<r.length;a++)t=r[a],0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight+240||document.documentElement.clientHeight+240)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html><!-- rebuild by neat -->