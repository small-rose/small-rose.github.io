<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å›¾ç‰‡éšæœºAPI</title>
      <link href="/posts/1fd50daf.html"/>
      <url>/posts/1fd50daf.html</url>
      
        <content type="html"><![CDATA[<h2 id="éšæœºå›¾ç‰‡è·å–api"><a href="#éšæœºå›¾ç‰‡è·å–api" class="headerlink" title="éšæœºå›¾ç‰‡è·å–api"></a>éšæœºå›¾ç‰‡è·å–api</h2><p>å°±æ˜¯ä¸€ä¸ªæ”¶é›†è®°å½•å›¾ç‰‡éšæœºAPIã€‚éåŸåˆ›ã€‚</p><h2 id="ä¸€ã€ç›´æ¥è·å–å›¾ç‰‡"><a href="#ä¸€ã€ç›´æ¥è·å–å›¾ç‰‡" class="headerlink" title="ä¸€ã€ç›´æ¥è·å–å›¾ç‰‡"></a>ä¸€ã€ç›´æ¥è·å–å›¾ç‰‡</h2><p><a href="http://lorempixel.com/1600/900" target="_blank" rel="noopener">http://lorempixel.com/1600/900</a><br><a href="https://unsplash.it/1600/900?randomï¼ˆå›½å†…åŠ è½½ç•¥æ…¢ï¼‰" target="_blank" rel="noopener">https://unsplash.it/1600/900?randomï¼ˆå›½å†…åŠ è½½ç•¥æ…¢ï¼‰</a><br><a href="https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPictureã€è¿”å›å¿…åº”å›¾ç‰‡ã€‘" target="_blank" rel="noopener">https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPictureã€è¿”å›å¿…åº”å›¾ç‰‡ã€‘</a><br><a href="https://uploadbeta.com/api/pictures/random/?key=%E6%8E%A8%E5%A5%B3%E9%83%8E" target="_blank" rel="noopener">https://uploadbeta.com/api/pictures/random/?key=%E6%8E%A8%E5%A5%B3%E9%83%8E</a><br><a href="https://unsplash.it/1600/900?random" target="_blank" rel="noopener">https://unsplash.it/1600/900?random</a></p><p>äºŒæ¬¡å…ƒéšæœºå›¾:<a href="http://www.dmoe.cc/random.php" target="_blank" rel="noopener">http://www.dmoe.cc/random.php</a></p><p>1366<em>768åˆ†è¾¨ç‡å›¾ç‰‡åœ°å€ï¼š<a href="https://api.dujin.org/bing/1366.php" target="_blank" rel="noopener">https://api.dujin.org/bing/1366.php</a><br>1920</em>1080åˆ†è¾¨ç‡å›¾ç‰‡åœ°å€ï¼š<a href="https://api.dujin.org/bing/1920.php" target="_blank" rel="noopener">https://api.dujin.org/bing/1920.php</a></p><p><a href="http://api.mtyqx.cn/api/random.phpï¼ˆäºŒæ¬¡å…ƒåŠ¨æ¼«ï¼‰" target="_blank" rel="noopener">http://api.mtyqx.cn/api/random.phpï¼ˆäºŒæ¬¡å…ƒåŠ¨æ¼«ï¼‰</a></p><p><a href="http://api.mtyqx.cn/tapi/random.phpï¼ˆäºŒæ¬¡å…ƒåŠ¨æ¼«ï¼‰" target="_blank" rel="noopener">http://api.mtyqx.cn/tapi/random.phpï¼ˆäºŒæ¬¡å…ƒåŠ¨æ¼«ï¼‰</a></p><p><a href="http://api.pingping6.com/girl/?type=302" target="_blank" rel="noopener">http://api.pingping6.com/girl/?type=302</a></p><p><a href="http://api.pingping6.com/girl2/?type=302" target="_blank" rel="noopener">http://api.pingping6.com/girl2/?type=302</a></p><p><a href="http://pic.1anime.video/random.php" target="_blank" rel="noopener">http://pic.1anime.video/random.php</a></p><h2 id="äºŒã€è·å–jsonæ•°æ®ã€‘"><a href="#äºŒã€è·å–jsonæ•°æ®ã€‘" class="headerlink" title="äºŒã€è·å–jsonæ•°æ®ã€‘"></a>äºŒã€è·å–jsonæ•°æ®ã€‘</h2><p><a href="https://bing.ioliu.cn/v1/rand?type=json" target="_blank" rel="noopener">https://bing.ioliu.cn/v1/rand?type=json</a><br><a href="https://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1" target="_blank" rel="noopener">https://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1</a><br><a href="http://lorempixel.com/1600/900" target="_blank" rel="noopener">http://lorempixel.com/1600/900</a></p><p>åŸæ–‡ç« åœ°å€ï¼š<a href="https://www.cnblogs.com/lgqrlchinese/p/11386857.html" target="_blank" rel="noopener">https://www.cnblogs.com/lgqrlchinese/p/11386857.html</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Img-Api </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Img-Api </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github çš„è®¿é—®æ…¢åŠ é€Ÿ</title>
      <link href="/posts/5817ecc2.html"/>
      <url>/posts/5817ecc2.html</url>
      
        <content type="html"><![CDATA[<h2 id="github-è®¿é—®æ…¢åŠ é€Ÿ"><a href="#github-è®¿é—®æ…¢åŠ é€Ÿ" class="headerlink" title="github è®¿é—®æ…¢åŠ é€Ÿ"></a>github è®¿é—®æ…¢åŠ é€Ÿ</h2><p>å†…å®¹æ•´ç†æ¥è‡ªç½‘ç»œã€‚</p><h2 id="ä¸€ã€è·å–ç›¸å…³åŸŸå"><a href="#ä¸€ã€è·å–ç›¸å…³åŸŸå" class="headerlink" title="ä¸€ã€è·å–ç›¸å…³åŸŸå"></a>ä¸€ã€è·å–ç›¸å…³åŸŸå</h2><p>è·å–Githubç›¸å…³ç½‘ç«™çš„åŸŸåã€‚</p><p>æ–¹å¼ä¸€ï¼š</p><p>è®¿é—® <a href="https://github.com" target="_blank" rel="noopener">https://github.com</a></p><p>F12 æŸ¥çœ‹ç½‘ç»œï¼ŒæŸ¥çœ‹åŸŸåã€‚</p><p>æ–¹å¼äºŒï¼š</p><p>ç›´æ¥è®¿é—®ï¼š<a href="https://github.com.ipaddress.com" target="_blank" rel="noopener">https://github.com.ipaddress.com</a></p><h2 id="ä¸€ã€è·å–ç›¸å…³åŸŸåå¯¹åº”IP"><a href="#ä¸€ã€è·å–ç›¸å…³åŸŸåå¯¹åº”IP" class="headerlink" title="ä¸€ã€è·å–ç›¸å…³åŸŸåå¯¹åº”IP"></a>ä¸€ã€è·å–ç›¸å…³åŸŸåå¯¹åº”IP</h2><p>è®¿é—® <a href="https://www.ipaddress.comï¼Œ" target="_blank" rel="noopener">https://www.ipaddress.comï¼Œ</a></p><p>åˆ†åˆ«è¾“å…¥</p><p>github.global.ssl.fastly.net<br>github.com</p><p>æŸ¥è¯¢ipåœ°å€</p><h2 id="ä¸‰ã€é…ç½®hosts"><a href="#ä¸‰ã€é…ç½®hosts" class="headerlink" title="ä¸‰ã€é…ç½®hosts"></a>ä¸‰ã€é…ç½®hosts</h2><p><code>windows</code> ç³»ç»Ÿçš„ hosts æ–‡ä»¶çš„ä½ç½®å¦‚ä¸‹ï¼š<code>C:\Windows\System32\drivers\etc\hosts</code> ;</p><p><code>mac/linux</code> ç³»ç»Ÿçš„ hosts æ–‡ä»¶çš„ä½ç½®å¦‚ä¸‹ï¼š<code>/etc/hosts</code> ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘çš„é…ç½®ï¼Œæ›´æ–°æ—¥æœŸ 2020-10-03</p><pre class=" language-txt"><code class="language-txt">140.82.112.3 github.com199.232.69.194 github.global.ssl.fastly.net199.232.68.133  githubusercontent.com185.199.108.153 assets-cdn.github.com185.199.109.153 assets-cdn.github.com185.199.110.153 assets-cdn.github.com185.199.111.153 assets-cdn.github.com</code></pre><h2 id="å››ã€åˆ·æ–°DNS"><a href="#å››ã€åˆ·æ–°DNS" class="headerlink" title="å››ã€åˆ·æ–°DNS"></a>å››ã€åˆ·æ–°DNS</h2><pre class=" language-bash"><code class="language-bash">ipconfig /flushdns</code></pre><p>åº”è¯¥å¿«ç‚¹äº†å§ï¼Ÿ</p><p>éš”ä¸€æ®µæ—¶é—´æŸ¥ä¸€æ¬¡ï¼ŒIP ä¸ä¼šä¸€ç›´ä¸å˜ï¼Œä¸å®šæœŸæ›´æ–°ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Matery æ·»åŠ ArtiTalkè¯´è¯´æ¨¡å—</title>
      <link href="/posts/7404e01a.html"/>
      <url>/posts/7404e01a.html</url>
      
        <content type="html"><![CDATA[<h2 id="Hexo-åšå®¢-Matery-ä¸»é¢˜æ·»åŠ -ArtiTalk-è¯´è¯´æ¨¡å—"><a href="#Hexo-åšå®¢-Matery-ä¸»é¢˜æ·»åŠ -ArtiTalk-è¯´è¯´æ¨¡å—" class="headerlink" title="Hexo åšå®¢ Matery ä¸»é¢˜æ·»åŠ  ArtiTalk è¯´è¯´æ¨¡å—"></a>Hexo åšå®¢ Matery ä¸»é¢˜æ·»åŠ  ArtiTalk è¯´è¯´æ¨¡å—</h2><h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h2><p>ArtiTalkæ˜¯åŸºäº LeanCloud å®ç°çš„å¯å®æ—¶å‘å¸ƒè¯´è¯´/å¾®è¯­çš„å°ç»„ä»¶ã€‚</p><p>ArtiTalk å¯ä»¥å¯¹å·²å‘å¸ƒçš„è¯´è¯´ç›´æ¥è¿›è¡Œå¢åˆ æŸ¥æ”¹ã€‚</p><p>ArtiTalk å¯ä»¥å¯¹è¯´è¯´å‘è¡¨è¯„è®º</p><p>ArtiTalk æ”¯æŒ Markdown/html è¯­æ³•</p><p>èŠ±äº†ç‚¹æ—¶é—´å·²ç»æ£é¼“å®Œæˆï¼Œé¡ºä¾¿å†™ä¸ªæ•™ç¨‹ï¼Œå…¶å®å®˜ç½‘ä¹Ÿæœ‰ï¼Œä¸è¿‡å¦‚æœä½ æ˜¯Matery ä¸»é¢˜ï¼ŒæŒ‰æ­¥éª¤æ¥å³å¯ã€‚</p><p><strong>å…¶å®è¿™ä¸ªå°ç»„ä»¶ä½¿ç”¨å°±æ˜¯jså’Œcssï¼Œè·Ÿä»€ä¹ˆä¸»é¢˜æ²¡æœ‰åŠæ¯›é’±å…³ç³»ã€‚</strong></p><p>ArtiTalkå®˜ç½‘ï¼š<a href="https://artitalk.js.org" target="_blank" rel="noopener">https://artitalk.js.org</a></p><p>ä»£ç ä»“åº“ï¼š<a href="https://github.com/ArtitalkJS/Artitalk" target="_blank" rel="noopener">https://github.com/ArtitalkJS/Artitalk</a></p><h2 id="äºŒã€å‡†å¤‡å·¥ä½œ"><a href="#äºŒã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="äºŒã€å‡†å¤‡å·¥ä½œ"></a>äºŒã€å‡†å¤‡å·¥ä½œ</h2><p>è¿™éƒ¨åˆ†æŒ‰å®˜ç½‘è¯´çš„æ¥ã€‚</p><p>LeanCloud çš„ç›¸å…³å‡†å¤‡</p><p>ğŸŒ å»ºè®®ä½¿ç”¨å›½é™…ç‰ˆçš„LeanCloud</p><p>å› ä¸ºå›½é™…ç‰ˆçš„leancloudä¸éœ€è¦é…ç½®serverurlï¼Œæ‰€ä»¥æ¨èä½¿ç”¨å›½é™…ç‰ˆï¼Œé€Ÿåº¦æ²¡æœ‰åŒºåˆ«ï¼Œå¦‚æœä½¿ç”¨å›½å†…ç‰ˆçš„leancloudåˆ«å¿˜äº†å¡«å†™serverurlå³å¯</p><p>å‰å¾€ LeanCloud å›½é™…ç‰ˆï¼Œæ³¨å†Œè´¦å·ã€‚</p><p>æ³¨å†Œå®Œæˆä¹‹åæ ¹æ® LeanCloud çš„æç¤ºç»‘å®šæ‰‹æœºå·å’Œé‚®ç®±ã€‚</p><p>ç»‘å®šå®Œæˆä¹‹åç‚¹å‡»åˆ›å»ºåº”ç”¨ï¼Œåº”ç”¨åç§°éšæ„ï¼Œæ¥ç€åœ¨ç»“æ„åŒ–æ•°æ®ä¸­åˆ›å»º classï¼Œå‘½åä¸º shuoshuoã€‚</p><p>åœ¨ä½ æ–°å»ºçš„åº”ç”¨ä¸­æ‰¾åˆ°ç»“æ„åŒ–æ•°æ®ä¸‹çš„ç”¨æˆ·ã€‚ç‚¹å‡»æ·»åŠ ç”¨æˆ·ï¼Œè¾“å…¥æƒ³ç”¨çš„ç”¨æˆ·ååŠå¯†ç ï¼Œè¿™ä¸ªè´¦æˆ·å°±æ˜¯ç”¨æ¥å‘å¸ƒè¯´è¯´ç”¨çš„ã€‚</p><p>å›åˆ°ç»“æ„åŒ–æ•°æ®ä¸­ï¼Œç‚¹å‡» class ä¸‹çš„ shuoshuoã€‚æ‰¾åˆ°æƒé™ï¼Œåœ¨ Class è®¿é—®æƒé™ä¸­å°† <code>add_fields</code> ä»¥åŠ <code>create</code> æƒé™è®¾ç½®ä¸ºæŒ‡å®šç”¨æˆ·ï¼Œè¾“å…¥ä½ åˆšæ‰è¾“å…¥çš„ç”¨æˆ·åä¼šè‡ªåŠ¨åŒ¹é…ã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå°† delete å’Œ update ä¹Ÿè®¾ç½®ä¸ºè·Ÿå®ƒä»¬ä¸€æ ·çš„æƒé™ã€‚<br>ç„¶åæ–°å»ºä¸€ä¸ªåä¸ºatCommentçš„classï¼Œæƒé™ä»€ä¹ˆçš„ä½¿ç”¨é»˜è®¤çš„å³å¯ã€‚</p><p>ç‚¹å‡» class ä¸‹çš„ <code>_User</code> æ·»åŠ åˆ—ï¼Œåˆ—åç§°ä¸º imgï¼Œé»˜è®¤å€¼å¡«ä¸Šä½ è¿™ä¸ªè´¦å·æƒ³è¦ç”¨çš„å‘å¸ƒè¯´è¯´çš„å¤´åƒurlï¼Œè¿™ä¸€é¡¹ä¸è¿›è¡Œé…ç½®ï¼Œè¯´è¯´å¤´åƒä¼šæ˜¾ç¤ºä¸ºé»˜è®¤å¤´åƒ Artitalk çš„ logoã€‚</p><p>åœ¨æœ€èœå•æ ä¸­æ‰¾åˆ°è®¾ç½® -&gt; åº”ç”¨ keysï¼Œè®°ä¸‹æ¥ <code>AppID</code> å’Œ <code>AppKey</code> ï¼Œåé¢ä¸»é¢˜é…ç½®æ–‡ä»¶é‡Œä¼šç”¨ã€‚</p><p>æœ€åå°† <code>_User</code> ä¸­çš„æƒé™å…¨éƒ¨è°ƒä¸ºæŒ‡å®šç”¨æˆ·ï¼Œæˆ–è€…æ•°æ®åˆ›å»ºè€…ï¼Œä¸ºäº†ä¿è¯ä¸è¢«ç¯¡æ”¹ç”¨æˆ·æ•°æ®å·²è¾¾åˆ°å¼ºåˆ¶å‘å¸ƒè¯´è¯´ã€‚</p><p>ğŸŒ å¦‚æœä½¿ç”¨å›½å†…ç‰ˆçš„LeanCloud</p><p>éœ€è¦ç»‘å®šAPIåŸŸåã€‚</p><p>serverurl</p><h2 id="ä¸‰ã€å¼€å·¥"><a href="#ä¸‰ã€å¼€å·¥" class="headerlink" title="ä¸‰ã€å¼€å·¥"></a>ä¸‰ã€å¼€å·¥</h2><h3 id="1ã€ä¸‹è½½"><a href="#1ã€ä¸‹è½½" class="headerlink" title="1ã€ä¸‹è½½"></a>1ã€ä¸‹è½½</h3><p>gitå‘½ä»¤ä¸‹è½½</p><pre class=" language-bash"><code class="language-bash"><span class="token function">git</span> clone --depth 2 git@github.com:ArtitalkJS/Artitalk.git</code></pre><p>ä¸‹è½½å®Œæˆåæœ‰ä¸ª Artitalk ç›®å½•ï¼Œdist é‡Œé¢å°±æ˜¯ç»„ä»¶ä»£ç ã€‚</p><h3 id="2ã€æ”¾å…¥ç»„ä»¶"><a href="#2ã€æ”¾å…¥ç»„ä»¶" class="headerlink" title="2ã€æ”¾å…¥ç»„ä»¶"></a>2ã€æ”¾å…¥ç»„ä»¶</h3><p>ç†è®ºä¸Šåªè¦æ”¾åˆ°ç›¸å…³å¯ä»¥è®¿é—®çš„ä½ç½®ï¼Œå¼•å…¥æ­£ç¡®çš„è·¯å¾„å³å¯ã€‚</p><p>åœ¨ä¸»é¢˜ç›®å½• <code>/source/libs</code> ç›®å½•æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ <code>artitalk</code>ã€‚</p><p>æ‰¾åˆ°åˆšæ‰ä¸‹è½½ Artitalk ç›®å½•ï¼Œè¿›å…¥dist ç›®å½•ï¼Œé‡Œé¢æœ‰2ä¸ªæ–‡ä»¶å¤¹ï¼šcss å’Œ js</p><p>å°† <code>/Artitalk/dist/css/</code> ä¸‹çš„ <code>artitalk.min.css</code> å¤åˆ¶åˆ°ä¸»é¢˜ç›®å½• <code>/source/libs/artitalk</code>ä¸‹ï¼›</p><p>å°† <code>/Artitalk/dist/js/</code> ä¸‹çš„ <code>artitalk.min.js</code> å¤åˆ¶åˆ°ä¸»é¢˜ç›®å½• <code>/source/libs/artitalk</code>ä¸‹ï¼›</p><p>å®Œæˆåï¼Œä¸»é¢˜ç›®å½• <code>/source/libs/artitalk</code>ä¸‹å°±æœ‰  <code>artitalk.min.css</code> å’Œ  <code>artitalk.min.js</code> ä¸¤ä¸ªæ–‡ä»¶äº†ã€‚</p><h3 id="3ã€å¼•å…¥å‡†å¤‡"><a href="#3ã€å¼•å…¥å‡†å¤‡" class="headerlink" title="3ã€å¼•å…¥å‡†å¤‡"></a>3ã€å¼•å…¥å‡†å¤‡</h3><p>å› ä¸ºå°½é‡å’Œ matery å¼•å…¥é£æ ¼ä¸€è‡´ã€‚</p><p>ä¿®æ”¹ä¸»é¢˜é…ç½® <code>_config.yml</code> æ–‡ä»¶ï¼Œæœç´¢å…³é”®è¯ <code>libs</code> </p><p>æ‰¾åˆ° css åœ¨æœ€åä¸€è¡Œæ·»åŠ ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">artitalk</span><span class="token punctuation">:</span> /libs/artitalk/artitalk.min.css</code></pre><p>æ‰¾åˆ°  js åœ¨æœ€åä¸€è¡Œ</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">artitalk</span><span class="token punctuation">:</span> /libs/artitalk/artitalk.min.js</code></pre><p>æˆ‘ç”¨çš„æ˜¯ç›®å‰3.1.2å›ºå®šç‰ˆæœ¬ï¼Œå¦‚æœä½ ä¸€ç›´æƒ³ç”¨æœ€æ–°ç‰ˆï¼Œå¯ä»¥æ¢æˆCDNæœ€æ–°ç‰ˆï¼š<code>https://cdn.jsdelivr.net/npm/artitalk</code></p><p>æˆ‘åˆ—ä¸€ä¸‹æœ€ç»ˆæ•ˆæœï¼Œå› ä¸ºåŸæ¥æœ‰å¾ˆå¤šï¼Œæˆ‘å°±ä¸å…¨éƒ¨åˆ—å‡ºäº†ï¼Œåªè¦çŸ¥é“æœ€åä¸€è¡ŒåŠ å°±å¯ä»¥äº†ï¼Œ<strong>æ³¨æ„å¯¹é½</strong>ï¼Œå¦‚ä¸‹ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">libs</span><span class="token punctuation">:</span>  <span class="token key atrule">css</span><span class="token punctuation">:</span>    <span class="token key atrule">fontAwesome</span><span class="token punctuation">:</span> /libs/awesome/css/all.css <span class="token comment" spellcheck="true"># V5.11.1</span>    <span class="token key atrule">materialize</span><span class="token punctuation">:</span> /libs/materialize/materialize.min.css <span class="token comment" spellcheck="true"># 1.0.0</span>    <span class="token key atrule">artitalk</span><span class="token punctuation">:</span> /libs/artitalk/artitalk.min.css <span class="token comment" spellcheck="true"># æœ€åä¸€è¡Œæ·»åŠ </span>  <span class="token key atrule">js</span><span class="token punctuation">:</span>    <span class="token key atrule">jquery</span><span class="token punctuation">:</span> /libs/jquery/jquery.min.js    <span class="token key atrule">materialize</span><span class="token punctuation">:</span> /libs/materialize/materialize.min.js <span class="token comment" spellcheck="true"># 1.0.0</span>    <span class="token key atrule">artitalk</span><span class="token punctuation">:</span> /libs/artitalk/artitalk.min.js  <span class="token comment" spellcheck="true"># æœ€åä¸€è¡Œæ·»åŠ </span></code></pre><h3 id="4ã€å¼•å…¥css"><a href="#4ã€å¼•å…¥css" class="headerlink" title="4ã€å¼•å…¥css"></a>4ã€å¼•å…¥css</h3><p>æ‰¾åˆ°ä¸»é¢˜ç›®å½•ä¸‹ <code>/layout/_partial/head.ejs</code>ï¼Œåœ¨å¤´éƒ¨å¼•å…¥css</p><p>å¼•å…¥</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%- theme.jsDelivr.url %<span class="token punctuation">></span>&lt;%- url_for(theme.libs.css.artitalk) %<span class="token punctuation">></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>å‚è€ƒæˆ‘çš„:</p><pre class=" language-html"><code class="language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%- theme.jsDelivr.url %<span class="token punctuation">></span>&lt;%- url_for(theme.libs.css.artitalk) %<span class="token punctuation">></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%- theme.jsDelivr.url %<span class="token punctuation">></span>&lt;%- url_for(<span class="token punctuation">'</span>/css/matery.css<span class="token punctuation">'</span>) %<span class="token punctuation">></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%- theme.jsDelivr.url %<span class="token punctuation">></span>&lt;%- url_for(<span class="token punctuation">'</span>/css/my.css<span class="token punctuation">'</span>) %<span class="token punctuation">></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><h3 id="5ã€æ¨¡å—å‡†å¤‡"><a href="#5ã€æ¨¡å—å‡†å¤‡" class="headerlink" title="5ã€æ¨¡å—å‡†å¤‡"></a>5ã€æ¨¡å—å‡†å¤‡</h3><p>åœ¨ä¸»é¢˜ç›®å½•ä¸‹ <code>/layout/</code> ç›®å½•æ–°å»ºä¸€ä¸ª <code>artitalk.ejs æ–‡ä»¶</code>ã€‚</p><p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><pre class=" language-html"><code class="language-html">&lt;%- partial('_partial/bg-cover') %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">ype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector"><span class="token id">#pubShuo</span> </span><span class="token punctuation">{</span>  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">5</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token id">#operare_artitalk</span> <span class="token class">.shuoshuo_input_log</span> </span><span class="token punctuation">{</span>    <span class="token property">outline-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>    <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">5</span>px<span class="token punctuation">;</span>    <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#ccc</span><span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">6</span>px<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">8</span>px <span class="token number">16</span>px<span class="token punctuation">;</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">12</span>px<span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#0bb7fb</span>d<span class="token number">6</span><span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">70%</span><span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">28</span>px<span class="token punctuation">;</span>    <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token id">#artitalk_main</span> </span><span class="token punctuation">{</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">5</span>px <span class="token punctuation">;</span>  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">5%</span><span class="token punctuation">;</span>  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">5%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token id">#lazy</span></span><span class="token punctuation">{</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">40</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>&lt;script src="<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">theme.jsDelivr.url</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> <span class="token function">url_for</span><span class="token punctuation">(</span>theme<span class="token punctuation">.</span>libs<span class="token punctuation">.</span>js<span class="token punctuation">.</span>artitalk<span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">></span>"<span class="token operator">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>articles11<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container  chip-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>row <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span> card<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card-content<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tag-title center-align<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fas fa-pen-alt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span> è¯´è¯´           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>artitalk_main<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token keyword">new</span> <span class="token class-name">Artitalk</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        appId<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.appId  %>"</span><span class="token punctuation">,</span>        appKey<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.appKey  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>serverURL<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          serverURL<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.serverURL  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>lang<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          lang<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.lang  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          pageSize<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.pageSize  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>shuoPla<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          shuoPla<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.shuoPla  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>avatarPla<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          avatarPla<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.avatarPla  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>motion <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          motion<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          motion<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span>  <span class="token operator">%</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>bgImg<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          bgImg<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.bgImg  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>color1<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          color1<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.color1  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>color2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          color2<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.color2  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>color3<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          color3<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.color3  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>artitalk<span class="token punctuation">.</span>cssUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>          cssUrl<span class="token punctuation">:</span> <span class="token string">"&lt;%=  theme.artitalk.cssUrl  %>"</span><span class="token punctuation">,</span>      <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>          atEmoji<span class="token punctuation">:</span> <span class="token punctuation">{</span>              baiyan<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/baiyan.png"</span><span class="token punctuation">,</span>              bishi<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/bishi.png"</span><span class="token punctuation">,</span>              bizui<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/bizui.png"</span><span class="token punctuation">,</span>              chan<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/chan.png"</span><span class="token punctuation">,</span>              daku<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/daku.png"</span><span class="token punctuation">,</span>              dalao<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/dalao.png"</span><span class="token punctuation">,</span>              dalian<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/dalian.png"</span><span class="token punctuation">,</span>              dianzan<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/dianzan.png"</span><span class="token punctuation">,</span>              doge<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/doge.png"</span><span class="token punctuation">,</span>              facai<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/facai.png"</span><span class="token punctuation">,</span>              fadai<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/fadai.png"</span><span class="token punctuation">,</span>              fanu<span class="token punctuation">:</span> <span class="token string">"https://cdn.jsdelivr.net/gh/Artitalk/Artitalk-emoji/fanu.png"</span><span class="token punctuation">,</span>           <span class="token punctuation">}</span><span class="token punctuation">,</span>     <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>æˆ‘è¿™é‡Œå› ä¸ºæµ‹è¯•å› ä¸ºç™»å½•çª—å£å˜å½¢äº†ï¼Œæ‰€ä»¥è‡ªå·±åŠ äº† å†…è”æ ·å¼ï¼Œå¦‚æœä½¿ç”¨æœ‰é—®é¢˜ï¼Œå¯ä»¥å°è¯•åˆ é™¤æ–‡ä»¶é‡Œçš„cssæ¨¡å—ï¼š </p><pre class=" language-css"><code class="language-css"><span class="token selector">&lt;style ype="text/css"><span class="token id">#pubShuo</span> </span><span class="token punctuation">{</span>  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">5</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token id">#operare_artitalk</span> <span class="token class">.shuoshuo_input_log</span> </span><span class="token punctuation">{</span>    <span class="token property">outline-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>    <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">5</span>px<span class="token punctuation">;</span>    <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token hexcode">#ccc</span><span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">6</span>px<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">8</span>px <span class="token number">16</span>px<span class="token punctuation">;</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">12</span>px<span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#0bb7fb</span>d<span class="token number">6</span><span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">70%</span><span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">28</span>px<span class="token punctuation">;</span>    <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token id">#artitalk_main</span> </span><span class="token punctuation">{</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">5</span>px <span class="token punctuation">;</span>  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">5%</span><span class="token punctuation">;</span>  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">5%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token id">#lazy</span></span><span class="token punctuation">{</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">40</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span>&lt;/style></code></pre><h3 id="6ã€æ·»åŠ é…ç½®"><a href="#6ã€æ·»åŠ é…ç½®" class="headerlink" title="6ã€æ·»åŠ é…ç½®"></a>6ã€æ·»åŠ é…ç½®</h3><p>åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">artitalk</span><span class="token punctuation">:</span>   <span class="token key atrule">appId</span><span class="token punctuation">:</span> ä½ çš„AppId  <span class="token key atrule">appKey</span><span class="token punctuation">:</span> ä½ çš„AppKwy  <span class="token key atrule">serverURL</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//xxx.zhangxiaocai.cn  <span class="token comment" spellcheck="true">#leancloudç»‘å®šçš„å®‰å…¨åŸŸåï¼Œä½¿ç”¨å›½é™…ç‰ˆçš„è¯ä¸éœ€è¦å¡«å†™</span>  <span class="token key atrule">lang</span><span class="token punctuation">:</span> zh <span class="token comment" spellcheck="true"># è¯­è¨€è®¾ç½®ï¼Œzhä¸ºæ±‰è¯­ï¼Œenä¸ºè‹±è¯­ï¼Œesä¸ºè¥¿ç­ç‰™è¯­ã€‚é»˜è®¤ä¸ºæ±‰è¯­</span>  <span class="token key atrule">pageSize</span><span class="token punctuation">:</span> <span class="token number">10  </span><span class="token comment" spellcheck="true">#æ¯é¡µè¯´è¯´çš„æ˜¾ç¤ºæ•°é‡</span>  <span class="token comment" spellcheck="true"># shuoPla: #åœ¨ç¼–è¾‘è¯´è¯´çš„è¾“å…¥æ¡†ä¸­çš„å ä½ç¬¦</span>  <span class="token key atrule">avatarPla</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cdn.jsdelivr.net/gh/small<span class="token punctuation">-</span>rose/small<span class="token punctuation">-</span>rose.github.io/medias/avatar.jpg <span class="token comment" spellcheck="true">#è‡ªå®šä¹‰å¤´åƒurlçš„è¾“å…¥æ¡†çš„å ä½ç¬¦</span>  <span class="token comment" spellcheck="true"># motion: #åŠ è½½åŠ¨ç”»çš„å¼€å…³ï¼Œ1ä¸ºå¼€ï¼Œ0ä¸ºå…³ï¼Œé»˜è®¤ä¸ºå¼€</span>  <span class="token comment" spellcheck="true"># bgImg: #è¯´è¯´è¾“å…¥æ¡†èƒŒæ™¯å›¾ç‰‡url</span>  <span class="token comment" spellcheck="true"># color1: #è¯´è¯´èƒŒæ™¯é¢œè‰²1&amp;æŒ‰é’®é¢œè‰²1</span>  <span class="token comment" spellcheck="true"># color2: #è¯´è¯´èƒŒæ™¯é¢œè‰²2&amp;æŒ‰é’®é¢œè‰²2</span>  <span class="token comment" spellcheck="true"># color3: #è¯´è¯´å­—ä½“é¢œè‰²</span></code></pre><p>æ›´å¤šé…ç½®é¡¹å‚è€ƒå®˜ç½‘ï¼š<a href="https://artitalk.js.org/settings.html#%F0%9F%98%9C-artitalk%E6%94%AF%E6%8C%81%E4%B8%A4%E7%A7%8D%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B9%E5%BC%8F" target="_blank" rel="noopener">é…ç½®é¡¹è¯´æ˜</a></p><h3 id="7ã€åˆ›å»ºé¡µé¢"><a href="#7ã€åˆ›å»ºé¡µé¢" class="headerlink" title="7ã€åˆ›å»ºé¡µé¢"></a>7ã€åˆ›å»ºé¡µé¢</h3><p>æ‰‹å·¥å»ºé¡µé¢æˆ–è€…æ‰§è¡Œå‘½ä»¤</p><p>æ‰§è¡Œåˆ›å»ºé¡µé¢</p><pre class=" language-bash"><code class="language-bash">hexo new page <span class="token string">"artitalk"</span></code></pre><p>åœ¨ hexo çš„ <code>source</code> ç›®å½•å¤šä¸ª <code>artitalk</code> æ–‡ä»¶å¤¹ï¼Œä¿®æ”¹é‡Œé¢çš„ <code>index.md</code> :</p><p>ç”Ÿæˆçš„æ–‡ä»¶ï¼š</p><pre class=" language-txt"><code class="language-txt">---title: è¯´è¯´date: 2020-10-02 16:19:14---</code></pre><p>ä¿®æ”¹ä¸ºï¼š</p><pre><code>---title: è¯´è¯´date: 2020-10-02 16:19:14type: &quot;artitalk&quot;layout: &quot;artitalk&quot;---</code></pre><h3 id="8ã€æ·»åŠ é“¾æ¥"><a href="#8ã€æ·»åŠ é“¾æ¥" class="headerlink" title="8ã€æ·»åŠ é“¾æ¥"></a>8ã€æ·»åŠ é“¾æ¥</h3><p>ä¸»é¢˜é…ç½®æ–‡ä»¶é‡Œæ·»åŠ ï¼š</p><pre><code>  ArtiTalk:    url: /artitalk    icon: fas fa-comments  </code></pre><p>æ¯”å¦‚æˆ‘çš„ï¼Œæ¢ä½ç½®è‡ªå·±è°ƒä¸€ä¸‹ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">menu</span><span class="token punctuation">:</span>  <span class="token key atrule">Index</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>home  <span class="token key atrule">Tags</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /tags    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>tags  <span class="token key atrule">Categories</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /categories    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>bookmark  <span class="token key atrule">Archives</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /archives    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>archive  <span class="token key atrule">About</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /about    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>user<span class="token punctuation">-</span>circle  <span class="token key atrule">Contact</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /contact    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>comments  <span class="token key atrule">ArtiTalk</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /artitalk    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>heartbeat</code></pre><h3 id="9ã€ä¸­æ–‡æ˜¾ç¤º"><a href="#9ã€ä¸­æ–‡æ˜¾ç¤º" class="headerlink" title="9ã€ä¸­æ–‡æ˜¾ç¤º"></a>9ã€ä¸­æ–‡æ˜¾ç¤º</h3><p>æ‰¾åˆ°ä¸»é¢˜ç›®å½•ä¸‹ <code>layout/_partial/navigation.ejs</code> æ–‡ä»¶</p><p>å¤§æ¦‚åœ¨ç¬¬ 11 è¡Œå·¦å³æ·»åŠ å¯¼èˆªèœå•</p><pre class=" language-txt"><code class="language-txt">    menuMap.set("ArtiTalk", "è¯´è¯´");</code></pre><p>åŠ å®Œä¹‹åï¼š</p><pre><code>    menuMap.set(&quot;Index&quot;, &quot;é¦–é¡µ&quot;);    menuMap.set(&quot;Tags&quot;, &quot;æ ‡ç­¾&quot;);    menuMap.set(&quot;Categories&quot;, &quot;åˆ†ç±»&quot;);    menuMap.set(&quot;Archives&quot;, &quot;å½’æ¡£&quot;);    menuMap.set(&quot;About&quot;, &quot;å…³äº&quot;);    menuMap.set(&quot;Contact&quot;, &quot;ç•™è¨€è–„&quot;);    menuMap.set(&quot;Friends&quot;, &quot;å‹æƒ…é“¾æ¥&quot;);    menuMap.set(&quot;Daohang&quot;, &quot;å¯¼èˆª&quot;);    menuMap.set(&quot;ArtiTalk&quot;, &quot;è¯´è¯´&quot;);</code></pre><h3 id="10ã€è‰²å½©ç¾åŒ–"><a href="#10ã€è‰²å½©ç¾åŒ–" class="headerlink" title="10ã€è‰²å½©ç¾åŒ–"></a>10ã€è‰²å½©ç¾åŒ–</h3><p>åé¢æœ‰æ—¶é—´å†è¡¥ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WebStackPage </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>keepalived</title>
      <link href="/posts/719b76b0.html"/>
      <url>/posts/719b76b0.html</url>
      
        <content type="html"><![CDATA[<h1 id="keepalived-é…åˆNginx-æ­å»ºé«˜å¯ç”¨"><a href="#keepalived-é…åˆNginx-æ­å»ºé«˜å¯ç”¨" class="headerlink" title="keepalived é…åˆNginx æ­å»ºé«˜å¯ç”¨"></a>keepalived é…åˆNginx æ­å»ºé«˜å¯ç”¨</h1><p>Nginx è§£å†³äº†è´Ÿè½½å‡è¡¡ã€‚</p><p>äº§ç”ŸèƒŒæ™¯ï¼šä¸€å°Nginxå¯èƒ½ä¼šå‡ºç°å•ç‚¹æ•…éšœï¼Œå¯¼è‡´ç¨‹åºä¸å¯ç”¨</p><h2 id="ä¸€ã€å‡†å¤‡"><a href="#ä¸€ã€å‡†å¤‡" class="headerlink" title="ä¸€ã€å‡†å¤‡"></a>ä¸€ã€å‡†å¤‡</h2><p>å¤šå° <code>nginx</code></p><p><code>keepalived</code>ï¼š ç›‘å¬nginxå¥åº·ã€‚</p><p><code>haproxy</code>ï¼š æä¾›ä¸€ä¸ªå•ç‹¬çš„è™šæ‹ŸIPå’Œç«¯å£ï¼Œç»Ÿä¸€æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><p>æ¶æ„å›¾ï¼š</p><pre><code>+------------------------------------------------------------------------------------------++                                                                                          ++                                     +--------------------+            +------------+     ++                                     +                    +            +            +     ++                                   + + Nginx + keepalived +  ++++++&gt;   +  server1   +     ++  +--------+      +-------+       /  +                    +   \   /    +            +     ++  +        +      +       +      /   +--------------------+    \ /     +------------+     ++  + client + ---&gt; +  VIP  + ---&gt;                                X                         +  +  +        +      +       +      \   +--------------------+    / \     +------------+     ++  +--------+      +-------+       \  +                    +   /   \    +            +     ++                                   + + Nginx + keepalived +  +++++++&gt;  +  server2   +     ++                                     +                    +            +            +     ++                                     +--------------------+            +------------+     ++                                                                                          ++------------------------------------------------------------------------------------------+</code></pre><p>ç›¸å…³è¡¥å……</p><p>keepalived ä¸‰ä¸ªæ¨¡å—ï¼š</p><p>coreæ¨¡å—ï¼šä¸ºkeepalivedçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ä¸»è¿›ç¨‹çš„å¯åŠ¨ã€ç»´æŠ¤ä»¥åŠå…¨å±€é…ç½®æ–‡ä»¶çš„åŠ è½½å’Œè§£æï¼›<br>checkï¼šè´Ÿè´£å¥åº·æ£€æŸ¥ï¼ŒåŒ…æ‹¬å¸¸è§çš„å„ç§æ£€æŸ¥æ–¹å¼ï¼›<br>VRRPæ¨¡å—ï¼šæ˜¯æ¥å®ç°VRRPåè®®çš„ã€‚</p><p>keepalived å·¥ä½œåŸç†</p><p>VRRP è™šæ‹Ÿè·¯ç”±å™¨å†—ä½™åè®®ï¼š</p><p>ï¼ˆ1ï¼‰ä¸ºçœ‹è§£å†³é™æ€è·¯ç”±çš„å•ç‚¹æ•…éšœè€Œäº§ç”Ÿã€‚<br>ï¼ˆ2ï¼‰é€šè¿‡ç«é€‰åè®®æœºåˆ¶å°†è·¯ç”±çš„ä»»åŠ¡äº¤ç»™æŸå°VRRPè·¯ç”±å™¨ã€‚<br>ï¼ˆ3ï¼‰ä¸»æœºé€šè¿‡IPå¤šæ’­åŒ…çš„æ–¹å¼ç›¸åŒé€šè®¯ï¼Œå‘ŠçŸ¥å¤‡æœºå­˜æ´»<br>ï¼ˆ4ï¼‰ä¸»æœºå‘åŒ…ï¼Œå¤‡æœºæ¥åŒ…ï¼ŒæŒ¡å¤‡æœºæ¥ä¸åˆ°åŒ…æ—¶ï¼Œå¯åŠ¨æ¥ç®¡ç¨‹åºæ¥ç®¡ä¸»æœºèµ„æºã€‚<br>ï¼ˆ5ï¼‰å¤‡æœºå¯ä»¥æœ‰å¤šå°ï¼Œå¯ä»¥é€šè¿‡ä¼˜å…ˆçº§ç«é€‰ã€‚<br>ï¼ˆ6ï¼‰VRRP ä½¿ç”¨åŠ å¯†åè®®ä¿è¯å®‰å…¨ã€‚</p><p>keepalived é«˜å¯ç”¨å¯¹ä¹‹é—´é€šè¿‡VRRP åè®®è¿›è¡Œé€šè®¯ï¼Œç¡®å®šä¸»å¤‡ï¼Œä¸»çš„ä¼˜å…ˆçº§é«˜äºå¤‡ã€‚å·¥ä½œè¿è¡Œæ—¶ä¸»æœºä¼šè·å¾—æ‰€æœ‰èµ„æºï¼Œå¤‡æœºå¤„äºç­‰å¾…çŠ¶æ€ï¼Œå½“ä¸»èŠ‚ç‚¹å®•æœºæ—¶ï¼Œå¤‡èŠ‚ç‚¹æ¥ç®¡ä¸»èŠ‚ç‚¹çš„èµ„æºï¼Œä»£æ›¿ä¸»èŠ‚ç‚¹æä¾›æœåŠ¡ã€‚</p><p>åœ¨keepalived ä¹‹é—´ï¼Œåªæœ‰ä½œä¸ºä¸»èŠ‚ç‚¹çš„çš„æœåŠ¡å™¨ä¼šä¸€ç›´å‘é€VRRP å¹¿æ’­åŒ…ï¼Œå‘Šè¯‰å¤‡èŠ‚ç‚¹ï¼Œè‡ªå·±æ˜¯å­˜æ´»çš„ï¼Œæ­¤æ—¶å¤‡èŠ‚ç‚¹ä¸ä¼šæŠ¢å ä¸»èŠ‚ç‚¹ã€‚å½“ä¸»èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œå³å¤‡èŠ‚ç‚¹æ¥æ”¶ä¸åˆ°ä¸»èŠ‚ç‚¹å‘é€çš„å¹¿æ’­åŒ…ï¼Œå°±ä¼šå¯åŠ¨ç›¸å…³æœåŠ¡æ¥ç®¡èµ„æºï¼Œæ¥ç®¡é€Ÿåº¦å¯ä»¥å°äº1ç§’ã€‚ </p><h2 id="äºŒã€å®‰è£…-keepalived"><a href="#äºŒã€å®‰è£…-keepalived" class="headerlink" title="äºŒã€å®‰è£… keepalived"></a>äºŒã€å®‰è£… keepalived</h2><h3 id="1ã€å®‰è£…-keepalived"><a href="#1ã€å®‰è£…-keepalived" class="headerlink" title="1ã€å®‰è£… keepalived"></a>1ã€å®‰è£… keepalived</h3><pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> -y openssl-develyum  -y <span class="token function">install</span>  keepalived</code></pre><h3 id="2ã€keepalived-å¸¸ç”¨å‘½ä»¤"><a href="#2ã€keepalived-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2ã€keepalived å¸¸ç”¨å‘½ä»¤"></a>2ã€keepalived å¸¸ç”¨å‘½ä»¤</h3><pre class=" language-bash"><code class="language-bash">keepalived -v  <span class="token comment" spellcheck="true"># æŸ¥çœ‹ç‰ˆæœ¬</span>keepalived  start <span class="token comment" spellcheck="true"># å¯åŠ¨</span>keepalived stop <span class="token comment" spellcheck="true"># åœæ­¢</span></code></pre><h3 id="2ã€é…ç½®"><a href="#2ã€é…ç½®" class="headerlink" title="2ã€é…ç½®"></a>2ã€é…ç½®</h3><p>Keepalivedé»˜è®¤çš„é…ç½®æ–‡ä»¶è·¯å¾„åœ¨ <code>/etc/keepalived/keepalived.conf</code></p><p>Keepalivedé»˜è®¤çš„æ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨ <code>/var/log/messages</code></p><p>ä¸»èŠ‚ç‚¹ <code>keepalived.conf</code> ï¼š</p><pre><code>! Configuration File for keepalivedglobal_defs {   smtp_connect_timeout 30    #è¿æ¥è¶…æ—¶æ—¶é—´   router_id 192.168.100.123  #è·¯ç”±IDï¼Œå¯ä»¥é€šè¿‡hostså–åˆ«å}vrrp_instance VI_1 {           # VRRP å®ä¾‹VI_1çš„é…ç½®    state MASTER               # æŒ‡å®šinstanceåˆå§‹çŠ¶æ€ï¼Œå®é™…æ ¹æ®ä¼˜å…ˆçº§å†³å®š.backupèŠ‚ç‚¹ä¸ä¸€æ ·    interface ens33            # å®¹å™¨ä¸­è™šæ‹ŸIPæ‰€åœ¨ç½‘å¡åç§°    virtual_router_id 51       # VRIDï¼Œç›¸åŒVRIDä¸ºä¸€ä¸ªç»„ï¼Œå†³å®šå¤šæ’­MACåœ°å€    priority 100               # ä¼˜å…ˆçº§ï¼Œå¦ä¸€å°æ”¹ä¸º90.backupèŠ‚ç‚¹ä¸ä¸€æ ·ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜    advert_int 1               # æ£€æŸ¥é—´éš”    authentication {        auth_type PASS         # è®¤è¯æ–¹å¼ï¼Œå¯ä»¥æ˜¯passæˆ–ha        auth_pass 1111         # è®¤è¯å¯†ç     }    virtual_ipaddress {        192.168.100.101         #VIPåœ°å€ï¼Œå¯¹å¤–ç»Ÿä¸€åœ°å€    }}</code></pre><p>å¤‡èŠ‚ç‚¹ <code>keepalived.conf</code> ï¼š</p><pre><code>! Configuration File for keepalivedglobal_defs {   smtp_connect_timeout 30      router_id 192.168.100.124}vrrp_instance VI_1 {    state BACKUP             interface eth33            virtual_router_id 51      priority 90              advert_int 1             authentication {        auth_type PASS            auth_pass 1111        }    virtual_ipaddress {        192.168.100.101         #VIPåœ°å€ï¼Œå¯¹å¤–ç»Ÿä¸€åœ°å€    }}</code></pre><h2 id="ä¸‰ã€å®‰è£…-haproxy"><a href="#ä¸‰ã€å®‰è£…-haproxy" class="headerlink" title="ä¸‰ã€å®‰è£… haproxy"></a>ä¸‰ã€å®‰è£… haproxy</h2><p>haproxy å®˜ç½‘åº”è¯¥è¢«å¢™äº†ï¼Œçœ‹githubçš„ï¼š<a href="https://github.com/haproxy/haproxy" target="_blank" rel="noopener">https://github.com/haproxy/haproxy</a></p><h3 id="1ã€å®‰è£…-haproxy"><a href="#1ã€å®‰è£…-haproxy" class="headerlink" title="1ã€å®‰è£… haproxy"></a>1ã€å®‰è£… haproxy</h3><pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> -y gcc gcc-c++yum  -y <span class="token function">install</span>  haproxy</code></pre><h3 id="2ã€keepalived-å¸¸ç”¨å‘½ä»¤-1"><a href="#2ã€keepalived-å¸¸ç”¨å‘½ä»¤-1" class="headerlink" title="2ã€keepalived å¸¸ç”¨å‘½ä»¤"></a>2ã€keepalived å¸¸ç”¨å‘½ä»¤</h3><p>#å¯åŠ¨ | #åœæ­¢ | #æŸ¥çœ‹çŠ¶æ€</p><pre class=" language-bash"><code class="language-bash">systemctl start haproxy.service systemctl stop haproxy.service systemctl status haproxy.service </code></pre><h3 id="3ã€haproxy-é…ç½®"><a href="#3ã€haproxy-é…ç½®" class="headerlink" title="3ã€haproxy é…ç½®"></a>3ã€haproxy é…ç½®</h3><p>haproxy é…ç½®æ–‡ä»¶éœ€è¦è‡ªå·±åˆ›å»º <code>/etc/haproxy/haproxy.cfg</code></p><pre><code>global    log 127.0.0.1 local3 info  # ç”¨127.0.0.1ä¸Šçš„rsyslogæœåŠ¡ä¸­çš„local3è®¾å¤‡è®°å½•æ—¥å¿—ï¼Œæ—¥å¿—çº§åˆ«ä¸ºinfo    user haproxy     #ç”¨æˆ·    group haproxy    #ç»„    daemon     # ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œ    maxconn 4000   # æœ€å¤§å¹¶å‘è¿æ¥æ•°defaults    log global   #è¡¨ç¤ºç”¨globalæ¨¡å—ä¸­å®šä¹‰çš„æ—¥å¿—é…ç½®    mode http    # æ¨¡å¼  ä½¿ç”¨httpæ¨¡å¼    option httplog       # é»˜è®¤haproxyæ—¥å¿—ï¼Œä¸è®°å½•httpè¯·æ±‚ï¼Œå¼€å¯è®°å½•httpè¯·æ±‚    option dontlognull   # ä¿è¯HAProxyä¸è®°å½•ä¸Šçº§è´Ÿè½½å‡è¡¡å‘é€è¿‡æ¥çš„ç”¨äºæ£€æµ‹çŠ¶æ€æ²¡æœ‰æ•°æ®çš„å¿ƒè·³åŒ…ã€‚    timeout connect 5000  # æˆåŠŸè¿æ¥ä¸€å°æœåŠ¡å™¨æœ€é•¿ç­‰å¾…æ—¶é—´ å•ä½æ¯«ç§’    timeout client 50000  # è¿æ¥å®¢æˆ·ç«¯æœ€é•¿ç­‰å¾…æ—¶é—´ å•ä½æ¯«ç§’    timeout server 50000  # æœåŠ¡å™¨å›åº”å®¢æˆ·ç«¯æœ€é•¿ç­‰å¾…æ—¶é—´ å•ä½æ¯«ç§’frontend http_front    bind 192.168.100.123:80   # ç›‘å¬æœ¬æœåŠ¡å™¨ 192.168.100.123çš„ip 80ç«¯å£    stats uri /haproxy?stats   # haproxyçš„çŠ¶æ€ç®¡ç†é¡µé¢ï¼Œé€šè¿‡/haproxy?statsæ¥è®¿é—®    default_backend http_back  # å®šä¹‰ä¸€ä¸ªæœåŠ¡å™¨ç»„ http_backbackend web_server    balance roundrobin  # è½®è¯¢    option httpchk GET /index.html  # å¯åŠ¨httpçš„å¥åº·æ£€æŸ¥    option forwardfor header X-Forwarded-For   # è®¾ç½®åç«¯æœåŠ¡å™¨å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯ip è®¿é—®æ—¥å¿—ä¸­    server node1 192.168.100.101:80 check inter 2000 rise 3 fall 3      # åç«¯æœåŠ¡å™¨æ˜µç§°node1    ipå’Œç«¯å£  | check å…³é”®å­—  | inter å¥åº·æ£€æŸ¥é—´éš”  2000æ¯«ç§’| rise æ£€æµ‹ 3æ¬¡ è®¤ä¸ºæ­£å¸¸| fall æ£€æµ‹3æ¬¡è®¤ä¸ºå¤±è´¥ | weight æƒé‡ 30</code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>æµ‹è¯•è®¿é—®haproxy <a href="http://192.168.100.101" target="_blank" rel="noopener">http://192.168.100.101</a> </p><p>æ¨¡æ‹Ÿä¸»èŠ‚ç‚¹å®•æœºï¼Œå…³é—­nginx,å†æ¬¡è®¿é—®haproxyã€‚</p><p>æ–‡ç« ä¸å®Œæ•´ï¼Œåç»­å†è¡¥å……ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> keepalived </category>
          
      </categories>
      
      
        <tags>
            
            <tag> keepalived </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker ä¹‹Docker-Compose</title>
      <link href="/posts/febc9253.html"/>
      <url>/posts/febc9253.html</url>
      
        <content type="html"><![CDATA[<h2 id="Docker-ä¹‹-Docker-Compose"><a href="#Docker-ä¹‹-Docker-Compose" class="headerlink" title="Docker ä¹‹ Docker-Compose"></a>Docker ä¹‹ Docker-Compose</h2><h2 id="ä¸€ã€äº§ç”ŸèƒŒæ™¯"><a href="#ä¸€ã€äº§ç”ŸèƒŒæ™¯" class="headerlink" title="ä¸€ã€äº§ç”ŸèƒŒæ™¯"></a>ä¸€ã€äº§ç”ŸèƒŒæ™¯</h2><p>è¿è¡Œä¸€ä¸ªé•œåƒï¼Œéœ€è¦æ·»åŠ å¤§é‡çš„å‚æ•°ã€‚å¦‚æœè¦è¿è¡Œä¸åŒå‘é•œåƒè¿˜éœ€è¦ä¸åŒçš„å‚æ•°ã€‚</p><p>å®¹å™¨å¢åŠ ä½¿å¾—ä½¿ç”¨ <code>docker run</code> å¯åŠ¨å‘½ä»¤å˜å¾—å¤šç¹çã€‚</p><p>é€šè¿‡Docker-Compose å¯ä»¥è¿›è¡Œæ‰¹é‡çš„ç®¡ç†å®¹å™¨ï¼Œé…ç½®å‚æ•°ã€‚</p><p>åªéœ€è¦ä¸€ä¸ª <code>docker-compose.yml</code> æ–‡ä»¶å»ç»´æŠ¤å³å¯ã€‚</p><h2 id="äºŒã€ä¸‹è½½ã€é…ç½®"><a href="#äºŒã€ä¸‹è½½ã€é…ç½®" class="headerlink" title="äºŒã€ä¸‹è½½ã€é…ç½®"></a>äºŒã€ä¸‹è½½ã€é…ç½®</h2><h3 id="1-githubå®˜ç½‘ä¸‹è½½"><a href="#1-githubå®˜ç½‘ä¸‹è½½" class="headerlink" title="1. githubå®˜ç½‘ä¸‹è½½"></a>1. githubå®˜ç½‘ä¸‹è½½</h3><p><code>Dockrer-Compose</code> çš„githubå‘å¸ƒåœ°å€ï¼š<a href="https://github.com/docker/compose" target="_blank" rel="noopener">https://github.com/docker/compose</a></p><p>releases ä¸­é€‰æ‹©æ¯”è¾ƒç¨³å®šçš„å‘å¸ƒç‰ˆæœ¬ã€‚</p><h3 id="2ã€ä¿®æ”¹æ–‡ä»¶å"><a href="#2ã€ä¿®æ”¹æ–‡ä»¶å" class="headerlink" title="2ã€ä¿®æ”¹æ–‡ä»¶å"></a>2ã€ä¿®æ”¹æ–‡ä»¶å</h3><p>éå¿…é¡»ï¼Œéœ€è¦æ˜¯ä¸ºäº†ä½¿ç”¨å‘½ä»¤æ–¹ä¾¿ã€‚<code>Docker-Compose</code> ä¸‹è½½ä¹‹ååç§°æ¯”è¾ƒé•¿ï¼Œä¿®æ”¹ä¹‹åæ–¹ä¾¿ä½¿ç”¨å‘½ä»¤ã€‚</p><pre class=" language-bash"><code class="language-bash"><span class="token function">mv</span> docker-compose-Linux-x86_64  /usr/local<span class="token function">cd</span> /usr/local<span class="token function">mv</span> docker-compose-Linux-x86_64 docker-compose<span class="token function">chmod</span> 777  docker-compose</code></pre><h3 id="3ã€é…ç½®ç¯å¢ƒå˜é‡"><a href="#3ã€é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="3ã€é…ç½®ç¯å¢ƒå˜é‡"></a>3ã€é…ç½®ç¯å¢ƒå˜é‡</h3><p>éå¿…é¡»ï¼Œéœ€è¦æ˜¯ä¸ºäº†åç»­ä½¿ç”¨å‘½ä»¤æ–¹ä¾¿ã€‚ä¸ºäº†å¯ä»¥åœ¨ä»»æ„ç›®å½•ä½¿ç”¨<code>docker-Compose</code> å‘½ä»¤ï¼Œæ–¹ä¾¿åç»­æ‰§è¡Œã€‚</p><p>å°† <code>docker-compose</code> æ–‡ä»¶ç§»åŠ¨åˆ° <code>/usr/local/bin</code>, ä¿®æ”¹äº† <code>/etc/profile</code> æ–‡ä»¶ï¼Œç»™<code>/usr/local/bin</code> é…ç½®åˆ° <code>PATH</code> ä¸­ã€‚</p><pre class=" language-sh"><code class="language-sh">mv docker-compose /usr/lcoal/binvi /etc/profile</code></pre><pre class=" language-txt"><code class="language-txt">export PATH=$JAVA_HOME:/usr/local/bin:$PATH</code></pre><pre class=" language-bash"><code class="language-bash"><span class="token function">source</span> /etc/profile</code></pre><p>æµ‹è¯•é…ç½®æ˜¯å¦æˆåŠŸï¼Œåœ¨ä»»æ„ç›®å½•ä¸‹æ‰§è¡Œ <code>docker-compose</code></p><h2 id="äºŒ-Docker-Compose-ç®¡ç†å®¹å™¨"><a href="#äºŒ-Docker-Compose-ç®¡ç†å®¹å™¨" class="headerlink" title="äºŒ Docker-Compose ç®¡ç†å®¹å™¨"></a>äºŒ Docker-Compose ç®¡ç†å®¹å™¨</h2><h3 id="1ã€YMLæ–‡ä»¶"><a href="#1ã€YMLæ–‡ä»¶" class="headerlink" title="1ã€YMLæ–‡ä»¶"></a>1ã€YMLæ–‡ä»¶</h3><p>æ–‡ä»¶åç§°ï¼š<code>docker-compose.yml</code> </p><p>æ–‡ä»¶éµå¾ªYAMLæ–‡ä»¶æ ¼å¼è¦æ±‚ï¼š<code>key+&quot;:&quot;+ç©ºæ ¼+value</code></p><p>æ¢è¡Œ+ç¼©è¿›çš„æ–¹å¼å†™å¤šç»„å€¼ã€‚</p><p>æ–‡ä»¶ä¸è¦ä½¿ç”¨åˆ¶è¡¨ç¬¦ã€‚</p><h3 id="2ã€ç¤ºä¾‹"><a href="#2ã€ç¤ºä¾‹" class="headerlink" title="2ã€ç¤ºä¾‹"></a>2ã€ç¤ºä¾‹</h3><p>ç¤ºä¾‹ï¼šDocker-Compose ç®¡ç†Mysqlå’ŒTomcatå®¹å™¨</p><pre class=" language-YAML"><code class="language-YAML">varsion: '3.1'services:   mysql:             # æœåŠ¡çš„åç§°    restart: always  # è¡¨ç¤ºåªè¦dockerå¯åŠ¨ï¼Œè¿™ä¸ªæœåŠ¡å°±è·Ÿç€ä¸€èµ·å¯åŠ¨    image: daocloud.io/library/mysql:5.7.4   # æŒ‡å®šé•œåƒæ¥æºè·¯å¾„    container_name: mysql    # æŒ‡å®šå®¹å™¨åç§°    ports:      - 3306:3306  # æŒ‡å®šç«¯å£å·æ˜ å°„    environment:      MYSQL_ROOT_PASSWORD: root    #æŒ‡å®šMysqlçš„rootç”¨æˆ·ç™»å½•å¯†ç       TZ: Asia/Shanghai            #æŒ‡å®šæ—¶åŒº    volumes:      - /opt/docker_msql_tomcat/mysql_data:/var/lib/mysql  # æ˜ å°„æ•°æ®å·  tomcat:     restart: always    image: daocloud.io/library/tomcat:8.5.15-jre8        container_name: tomcat    ports:      - 8080:8080    environment:       TZ: Asia/Shanghai    volumes:      - /opt/docker_msql_tomcat/tomcat_webapps:/var/local/tomcat/webapps      - /opt/docker_msql_tomcat/tomcat_logs:/var/local/tomcat/logs</code></pre><h2 id="ä¸‰-ä½¿ç”¨-docker-compose-å‘½ä»¤ç®¡ç†"><a href="#ä¸‰-ä½¿ç”¨-docker-compose-å‘½ä»¤ç®¡ç†" class="headerlink" title="ä¸‰.ä½¿ç”¨ docker-compose å‘½ä»¤ç®¡ç†"></a>ä¸‰.ä½¿ç”¨ docker-compose å‘½ä»¤ç®¡ç†</h2><h3 id="1ã€æ³¨æ„äº‹é¡¹"><a href="#1ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="1ã€æ³¨æ„äº‹é¡¹"></a>1ã€æ³¨æ„äº‹é¡¹</h3><p><strong>åœ¨ä½¿ç”¨docker-compose å‘½ä»¤æ—¶ï¼Œé»˜è®¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹æ‰¾ docker-compose.yml æ–‡ä»¶ã€‚</strong></p><h3 id="2ã€å¸¸è§å‘½ä»¤"><a href="#2ã€å¸¸è§å‘½ä»¤" class="headerlink" title="2ã€å¸¸è§å‘½ä»¤"></a>2ã€å¸¸è§å‘½ä»¤</h3><p><strong>åŸºäº docker-compose.yml å¯åŠ¨ç®¡ç†çš„å®¹å™¨</strong></p><pre class=" language-bash"><code class="language-bash">docker-compose up -d</code></pre><p><strong>å…³é—­å¹¶åˆ é™¤å®¹å™¨</strong></p><pre class=" language-bash"><code class="language-bash">docker-compose down</code></pre><p><strong>å¼€å¯|å…³é—­|é‡å¯ å·²ç»å­˜åœ¨çš„ç”±docker-composeç»´æŠ¤çš„å®¹å™¨</strong></p><pre class=" language-bash"><code class="language-bash">docker-compose startdocker-compose stop docker-compose restart</code></pre><p><strong>æŸ¥çœ‹ç”±docker-composeç»´æŠ¤çš„å®¹å™¨</strong></p><pre class=" language-bash"><code class="language-bash">docker-compose  <span class="token function">ps</span></code></pre><p><strong>æŸ¥çœ‹ç”±docker-composeç»´æŠ¤çš„å®¹å™¨çš„æ—¥å¿—</strong></p><pre class=" language-bash"><code class="language-bash">docker-compose  logs  -f</code></pre><h2 id="å››-Docker-composeé…ç½®Dockerfile-ä½¿ç”¨"><a href="#å››-Docker-composeé…ç½®Dockerfile-ä½¿ç”¨" class="headerlink" title="å››.Docker-composeé…ç½®Dockerfile ä½¿ç”¨"></a>å››.Docker-composeé…ç½®Dockerfile ä½¿ç”¨</h2><p>ä½¿ç”¨ <code>docker-compose.yml</code> æ–‡ä»¶ä»¥åŠ  <code>Dockerfile</code> æ–‡ä»¶å†ç”Ÿäº§è‡ªå®šä¹‰çš„é•œåƒçš„åŒæ—¶å¯åŠ¨å½“å‰é•œåƒï¼Œå¹¶ä¸”ç”±Docker-composeå»ç®¡ç†å®¹å™¨ã€‚</p><h3 id="1ã€ymlæ–‡ä»¶"><a href="#1ã€ymlæ–‡ä»¶" class="headerlink" title="1ã€ymlæ–‡ä»¶"></a>1ã€ymlæ–‡ä»¶</h3><pre class=" language-YAML"><code class="language-YAML">version: '3.1'services:  tomcat_dcdf:     restart: always    build:             # æ„å»ºè‡ªå®šä¹‰é•œåƒ      context: ../     # æŒ‡å®šDockerfileæ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œ../è¡¨ç¤ºä¸Šçº§ç›®å½•      dockerfile: Dockerfile   # æŒ‡å®šDockerfileæ–‡ä»¶åç§°    image: tomcat_dcdf:1.0.1    # æ„å»ºç”Ÿæˆçš„é•œåƒæ–‡ä»¶åç§°    container_name: tomcat_dcdf    ports:      - 8081:8080    environment:       TZ: Asia/Shanghai</code></pre><h3 id="2ã€Dockerfile-æ–‡ä»¶"><a href="#2ã€Dockerfile-æ–‡ä»¶" class="headerlink" title="2ã€Dockerfile æ–‡ä»¶"></a>2ã€Dockerfile æ–‡ä»¶</h3><pre class=" language-txt"><code class="language-txt">FROM daocloud.io/library/tomcat:8.5.15-jre8  CP  test.war /var/local/tomcat/webapps</code></pre><p>ç›®å½•å±‚çº§</p><ul><li>docker_tomcat_dcdf<br>|â€“+ docker-compose<br>|  |â€“ docker-compose.yml<br>|â€“ dockerfile<br>|â€“ test.war</li></ul><p>æ³¨æ„ï¼Œæµ‹è¯•test.warï¼Œéœ€è¦å…ˆç”¨å®¢æˆ·ç«¯è¿æ¥mysqlï¼Œåˆ›å»ºtest æ•°æ®åº“ã€‚</p><h3 id="3ã€æ‰§è¡Œæ„å»º-å¯åŠ¨å‘½ä»¤"><a href="#3ã€æ‰§è¡Œæ„å»º-å¯åŠ¨å‘½ä»¤" class="headerlink" title="3ã€æ‰§è¡Œæ„å»º/å¯åŠ¨å‘½ä»¤"></a>3ã€æ‰§è¡Œæ„å»º/å¯åŠ¨å‘½ä»¤</h3><p>ä¸€å®šè¦åœ¨ <code>docker-compse</code> ç›®å½•æ‰§è¡Œï¼Œ<code>docker-compose.yml</code> åœ¨è¿™ä¸ªç›®å½•ã€‚</p><pre class=" language-bash"><code class="language-bash">docker-compse up -d</code></pre><p>å› ä¸ºï¼š<strong>åœ¨ä½¿ç”¨docker-compose å‘½ä»¤æ—¶ï¼Œé»˜è®¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹æ‰¾ docker-compose.yml æ–‡ä»¶ã€‚</strong></p><p>æ³¨æ„ï¼š</p><p><code>docker-compse up -d</code> : å¯ä»¥ç›´æ¥å¯åŠ¨åŸºäº<code>docker-compose.yml</code> æ–‡ä»¶ä»¥åŠ  <code>Dockerfile</code> æ–‡ä»¶æ„å»ºçš„è‡ªå®šä¹‰é•œåƒã€‚ å¦‚æœè‡ªå®šä¹‰é•œåƒä¸å­˜åœ¨ï¼Œ <code>docker-compose</code> ä¼šè‡ªåŠ¨æ„å»ºå‡ºè‡ªå®šä¹‰é•œåƒï¼Œå¦‚æœè‡ªå®šä¹‰é•œåƒå·²ç»å­˜åœ¨ï¼Œ <code>docker-compose</code> ä¼šç›´æ¥è¿è¡Œè¿™ä¸ªè‡ªå®šä¹‰é•œåƒã€‚</p><p>å¦‚æœéœ€è¦é‡æ–°æ„å»ºè‡ªå®šä¹‰é•œåƒï¼Œæ‰§è¡Œï¼š</p><pre class=" language-bash"><code class="language-bash"> docker-compose build</code></pre><p>å¦‚æœéœ€è¦åœ¨è¿è¡Œä¹‹å‰ï¼Œé‡æ–°æ„å»ºè‡ªå®šä¹‰é•œåƒï¼Œæ‰§è¡Œï¼š</p><pre class=" language-bash"><code class="language-bash"> docker-compose up  -d  --build</code></pre><h3 id="4ã€è‡ªå»ºç¤ºä¾‹"><a href="#4ã€è‡ªå»ºç¤ºä¾‹" class="headerlink" title="4ã€è‡ªå»ºç¤ºä¾‹"></a>4ã€è‡ªå»ºç¤ºä¾‹</h3><h4 id="ç¤ºä¾‹ä¸€ï¼šDocker-compose-ç®¡ç†Nginx"><a href="#ç¤ºä¾‹ä¸€ï¼šDocker-compose-ç®¡ç†Nginx" class="headerlink" title="ç¤ºä¾‹ä¸€ï¼šDocker-compose ç®¡ç†Nginx"></a>ç¤ºä¾‹ä¸€ï¼šDocker-compose ç®¡ç†Nginx</h4><p>ymlæ–‡ä»¶ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>     <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">image</span><span class="token punctuation">:</span> daocloud.io/library/nginx<span class="token punctuation">:</span>latest    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nginx    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token datetime number">80:80</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> /opt/docker_nginx/conf.d/<span class="token punctuation">:</span>etc/nginx/conf.d</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Valine è¯„è®ºç³»ç»Ÿç´§æ€¥é˜²å¾¡</title>
      <link href="/posts/1e514b2c.html"/>
      <url>/posts/1e514b2c.html</url>
      
        <content type="html"><![CDATA[<h2 id="Valine-è¯„è®ºç³»ç»Ÿç´§æ€¥é˜²å¾¡"><a href="#Valine-è¯„è®ºç³»ç»Ÿç´§æ€¥é˜²å¾¡" class="headerlink" title="Valine è¯„è®ºç³»ç»Ÿç´§æ€¥é˜²å¾¡"></a>Valine è¯„è®ºç³»ç»Ÿç´§æ€¥é˜²å¾¡</h2><p>ä¸Šä¸ªæœˆæˆ‘çš„åšå®¢çš„è¯„è®ºvalineï¼Œè¢«æ¶æ„æ”»å‡»ï¼Œæ— é™å†™å…¥ã€‚</p><p>ä¹‹å‰å¤§å®¶éƒ½è¯´ä¸å®‰å…¨ï¼Œæˆ‘æ²¡æ€ä¹ˆæ”¾å¿ƒä¸Šã€‚æ¯•ç«Ÿåœ¨ç½‘ç»œä¸Šè¿˜æœ‰ä»€ä¹ˆæ˜¯å®‰å…¨çš„ã€‚</p><p>å¹¸å¥½ï¼Œæˆ‘çš„å®‰è£…äº†valine-admin ,æ‰€ä»¥å³ä½¿æ˜¯æ¶æ„è¯„è®ºï¼Œä¹Ÿä¼šç«‹å³æœ‰é‚®ä»¶æé†’ã€‚</p><p>å¥½å§ï¼Œæˆ‘å¿˜è®°äº†æˆ‘å½“æ—¶åœ¨ç ”ç©¶ä»€ä¹ˆã€‚åªæ˜¯æ‰‹æœºé‚®ä»¶æé†’ä¸åœçš„å¼¹å‡ºï¼Œæˆ‘æƒ³è°é‚£ä¹ˆä¸è¦å‘½çš„ç»™æˆ‘è¯„è®ºå‘¢ï¼Ÿ</p><p>ä¸€çœ‹é‚®ç®±ï¼Œå†æ‰“å¼€è¯„è®ºä¸€çœ‹ï¼Œæœç„¶æ˜¯åƒåœ¾è¯„è®ºï¼Œè€Œä¸”çœ‹ç•™çš„é‚®ä»¶è¿˜æ˜¯ç”¨ç¨‹åºè¿›è¡Œçš„æ¶æ„è¯„è®ºï¼Œæœ¬ä»¥ä¸ºä¸€ä¼šå°±å¥½ã€‚</p><p>æˆ‘å°±ç™»å½•leancloud åˆ é™¤è¯„è®ºï¼Œä¸è¿‡æˆ‘åˆ äº†ä¸¤æ¬¡ä¹‹åå‘ç°ï¼Œè¡¨æ•°æ®è¶Šæ¥è¶Šå¤§ã€‚</p><p>æˆ‘æ›´åŠ ç¡®è®¤äº†ï¼Œè¿™æ˜¯åœ¨ç”¨ç¨‹åºè°ƒç”¨æˆ‘çš„è¯„è®ºAPIã€‚</p><p>å¥½å§ï¼Œæˆ‘æƒ³è¦ä¸è¦å…³é—­valine, è¿™æ ·ä¸å°±æ˜¯é€€è®©å’Œå¦¥åå—? è€Œä¸”åç»­è¿˜æ˜¯è¦æ‰“å¼€çš„ï¼Œå› ä¸ºæˆ‘æ‡’å¾—å»æŠ˜è…¾å…¶ä»–çš„è¯„è®ºç³»ç»Ÿäº†ã€‚</p><p>äºæ˜¯æˆ‘å¿«é€Ÿæ‰¾åˆ°leancloud åå°çš„ç›¸å…³è®¾ç½®ï¼Œå…³é—­æ•°æ®å­˜å‚¨åŠŸèƒ½ï¼Œç„¶åå…³é—­comment è¡¨çš„å†™å…¥æƒé™ã€‚ ä¸–ç•Œç»ˆäºå®‰é™äº†ã€‚</p><p>æ¥ç€æ‰¹é‡åˆ é™¤æ•°æ®ï¼Œæ…¢æ…¢ç­‰å§ã€‚</p><p>æ˜¯å•Šï¼Œå°½é‡è¿™ä¸ªvaline ä¸å®‰å…¨ï¼Œä½†æ˜¯ä¸æƒ³å†æŠ˜è…¾äº†ã€‚</p><p>è¿˜å¥½è¿™æ¬¡çš„æ”»å‡»åªæ˜¯æ¶æ„å†™å…¥åƒåœ¾æ•°æ®ï¼Œæˆ‘æƒ³è¿™äººå®åœ¨æ— èŠã€‚æˆ‘å¹¶æ²¡æœ‰å¾—ç½ªè°å•Š~ ä¸è¿‡ matery ä¸»é¢˜çš„å¦ä¸€ä¸ªç¾¤é‡Œçš„æ‘å§‘ä¹Ÿé­é‡äº†ç›¸åŒçš„æ”»å‡»ã€‚é‚£å¤©æˆ‘çœ‹åˆ°å¥¹çš„è¯„è®ºç³»ç»Ÿä¸èƒ½ç”¨äº†ï¼Œ</p><p>ä¸è¿‡æ— æ‰€è°“äº†ï¼ŒæŸäººä¸åˆ©å·±çš„äº‹æµªè´¹æ—¶é—´ã€‚</p><p>ä¸ºä»€ä¹ˆç°åœ¨æ‰æœ‰è¿™ç¯‡æ–‡ç« å‘¢ï¼Ÿ</p><p>å› ä¸ºä¹‹å‰å»å­¦ä¹ åˆ«çš„äº†ã€‚ä¸€æ—¶æ²¡æœ‰æƒ³èµ·æ¥ã€‚</p><p>é‚£ä¹ˆå¦‚æœè¦é˜²æ­¢valineè¢«æ¶æ„å†™å…¥ï¼Œè¯·é‡‡å–ä»¥ä¸‹æ“ä½œã€‚</p><h3 id="1ã€ç¡®ä¿valineè¯„è®ºæœ‰é‚®ä»¶æé†’åŠŸèƒ½ã€‚"><a href="#1ã€ç¡®ä¿valineè¯„è®ºæœ‰é‚®ä»¶æé†’åŠŸèƒ½ã€‚" class="headerlink" title="1ã€ç¡®ä¿valineè¯„è®ºæœ‰é‚®ä»¶æé†’åŠŸèƒ½ã€‚"></a>1ã€ç¡®ä¿valineè¯„è®ºæœ‰é‚®ä»¶æé†’åŠŸèƒ½ã€‚</h3><p>å½“é­é‡æ¶æ„åˆ·è¯„æ—¶ï¼Œç¬¬ä¸€æ—¶é—´çŸ¥æ™“ã€‚è‡³äºå¦‚ä½•å®‰è£…ï¼Œè¯·å‚è€ƒï¼š<a href="358175a6.html">Valine-Adminè¸©å‘è®°å½•</a></p><h3 id="2ã€åœ¨é‚®ä»¶çŸ¥æ™“æ¶æ„åˆ·è¯„ååŠæ—¶å…³é—­å†™å…¥æƒé™"><a href="#2ã€åœ¨é‚®ä»¶çŸ¥æ™“æ¶æ„åˆ·è¯„ååŠæ—¶å…³é—­å†™å…¥æƒé™" class="headerlink" title="2ã€åœ¨é‚®ä»¶çŸ¥æ™“æ¶æ„åˆ·è¯„ååŠæ—¶å…³é—­å†™å…¥æƒé™"></a>2ã€åœ¨é‚®ä»¶çŸ¥æ™“æ¶æ„åˆ·è¯„ååŠæ—¶å…³é—­å†™å…¥æƒé™</h3><p>ç™»å½•leancloudåå°ï¼Œ</p><p>ï¼ˆ1ï¼‰åœ¨ â€œå­˜å‚¨â€  â€”â€” â€œç»“æ„åŒ–æ•°æ®â€ â€”â€”â€” â€œCommentâ€  â€”â€”â€”  â€œæƒé™â€ â€”â€” Class è®¿é—®æƒé™ ç‚¹ä¿®æ”¹ â€”â€”â€”  å°† â€œ add_fields â€œå’Œ â€œ create â€œ ä¿®æ”¹æˆç™»å½•ç”¨æˆ·ã€‚</p><p>ï¼ˆ2ï¼‰åœ¨è®¾ç½® â€”â€” å®‰å…¨ä¸­å¿ƒ â€”â€”â€” å…³é—­æ•°æ®å­˜å‚¨ã€‚</p><h3 id="3ã€è¿‡ä¸€æ®µæ—¶é—´å†æ‰“å¼€ã€‚"><a href="#3ã€è¿‡ä¸€æ®µæ—¶é—´å†æ‰“å¼€ã€‚" class="headerlink" title="3ã€è¿‡ä¸€æ®µæ—¶é—´å†æ‰“å¼€ã€‚"></a>3ã€è¿‡ä¸€æ®µæ—¶é—´å†æ‰“å¼€ã€‚</h3><p>ä½ å¯ä»¥éš”å‡ å¤©å‡ å‘¨éƒ½è¡Œã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker ä¹‹å®Œæ•´å…¥é—¨</title>
      <link href="/posts/9e6e2be2.html"/>
      <url>/posts/9e6e2be2.html</url>
      
        <content type="html"><![CDATA[<h2 id="Docker-ä¸€ç¯‡å…¥é—¨"><a href="#Docker-ä¸€ç¯‡å…¥é—¨" class="headerlink" title="Docker ä¸€ç¯‡å…¥é—¨"></a>Docker ä¸€ç¯‡å…¥é—¨</h2><h2 id="ä¸€ã€Docker-ç®€ä»‹"><a href="#ä¸€ã€Docker-ç®€ä»‹" class="headerlink" title="ä¸€ã€Docker ç®€ä»‹"></a>ä¸€ã€Docker ç®€ä»‹</h2><h3 id="1ã€åŸºæœ¬æ¦‚è¿°"><a href="#1ã€åŸºæœ¬æ¦‚è¿°" class="headerlink" title="1ã€åŸºæœ¬æ¦‚è¿°"></a>1ã€åŸºæœ¬æ¦‚è¿°</h3><p>Dockeræ˜¯ä¸–ç•Œé¢†å…ˆçš„è½¯ä»¶å®¹å™¨å¹³å°ã€‚ </p><p>Dockeræ˜¯åŸºäºGoè¯­è¨€å®ç°çš„äº‘å¼€æºé¡¹ç›®ã€‚</p><p>Dockerçš„ä¸»è¦ç›®æ ‡æ˜¯â€œBuildï¼ŒShip and Run Any App,Anywhereâ€ã€‚</p><p>é€šè¿‡å¯¹åº”ç”¨ç»„ä»¶çš„å°è£…ã€åˆ†å‘ã€éƒ¨ç½²ã€è¿è¡Œç­‰ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œä½¿ç”¨æˆ·çš„APPï¼ˆå¯ä»¥æ˜¯ä¸€ä¸ªWEBåº”ç”¨æˆ–æ•°æ®åº“åº”ç”¨ç­‰ç­‰ï¼‰åŠå…¶è¿è¡Œç¯å¢ƒèƒ½å¤Ÿåšåˆ°<strong>â€œä¸€æ¬¡å°è£…ï¼Œåˆ°å¤„è¿è¡Œâ€</strong>ã€‚</p><p>å› ä¸ºè™šæ‹Ÿæœºæ¨¡æ‹Ÿçš„å°±æ˜¯å¸¦æ“ä½œç³»ç»Ÿå’Œç¯å¢ƒçš„ï¼Œå…¶èµ„æºå ç”¨å¤šã€å†—ä½™æ­¥éª¤å¤šã€å¯åŠ¨æ…¢ç­‰ä¸è¶³ï¼ŒLinux å‘å±•å‡ºäº†å¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼šLinux å®¹å™¨ï¼ˆLinux Containersï¼Œç¼©å†™ä¸º LXCï¼‰ã€‚<strong>Linux å®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚</strong>æœ‰äº†å®¹å™¨ï¼Œå°±å¯ä»¥å°†è½¯ä»¶è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰èµ„æºæ‰“åŒ…åˆ°ä¸€ä¸ªéš”ç¦»çš„å®¹å™¨ä¸­ã€‚å®¹å™¨ä¸è™šæ‹Ÿæœºä¸åŒï¼Œä¸éœ€è¦æ†ç»‘ä¸€æ•´å¥—æ“ä½œç³»ç»Ÿï¼Œåªéœ€è¦è½¯ä»¶å·¥ä½œæ‰€éœ€çš„åº“èµ„æºå’Œè®¾ç½®ã€‚ç³»ç»Ÿå› æ­¤è€Œå˜å¾—é«˜æ•ˆè½»é‡å¹¶ä¿è¯éƒ¨ç½²åœ¨ä»»ä½•ç¯å¢ƒä¸­çš„è½¯ä»¶éƒ½èƒ½å§‹ç»ˆå¦‚ä¸€åœ°è¿è¡Œã€‚</p><p>Docker åœ¨Linux å®¹å™¨æŠ€æœ¯çš„åŸºç¡€ä¸Šå‘å±•è¿‡æ¥çš„ã€‚å°†åº”ç”¨è¿è¡Œåœ¨ Docker å®¹å™¨ä¸Šé¢ï¼Œè€Œ Docker å®¹å™¨åœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸Šéƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¿™å°±å®ç°äº†è·¨å¹³å°ã€è·¨æœåŠ¡å™¨ã€‚åªéœ€è¦ä¸€æ¬¡é…ç½®å¥½ç¯å¢ƒï¼Œæ¢åˆ°ä¸åŒçš„æœºå™¨ä¸Šå°±å¯ä»¥ä¸€é”®éƒ¨ç½²å¥½ï¼Œå¤§å¤§ç®€åŒ–äº†æ“ä½œã€‚è¿™æ ·æ˜¯é¡ºåº”äº† DevOps å¼€å‘è¿ç»´ç†å¿µã€‚</p><p>é’ˆå¯¹é›†ç¾¤ç¯å¢ƒï¼Œå¯ä»¥å¿«é€Ÿéƒ¨ç½²å®‰è£…ã€‚</p><p><strong>æ„ä¹‰æˆ–ä½œç”¨ï¼š</strong></p><p>Docker è§£å†³äº†è¿è¡Œç¯å¢ƒå’Œé…ç½®é—®é¢˜è½¯ä»¶å®¹å™¨ï¼Œæ–¹ä¾¿åšæŒç»­é›†æˆå¹¶æœ‰åŠ©äºæ•´ä½“å‘å¸ƒçš„å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚</p><h3 id="2ã€å®˜ç½‘åŠä»“åº“"><a href="#2ã€å®˜ç½‘åŠä»“åº“" class="headerlink" title="2ã€å®˜ç½‘åŠä»“åº“"></a>2ã€å®˜ç½‘åŠä»“åº“</h3><p>dockerå®˜ç½‘ï¼š<a href="http://www.docker.com" target="_blank" rel="noopener">http://www.docker.com</a></p><p>dockerä¸­æ–‡ç½‘ç«™ï¼š<a href="https://www.docker-cn.com" target="_blank" rel="noopener">https://www.docker-cn.com</a></p><p>Docker Hubå®˜ç½‘: <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p><h2 id="äºŒã€Docker-å®‰è£…"><a href="#äºŒã€Docker-å®‰è£…" class="headerlink" title="äºŒã€Docker å®‰è£…"></a>äºŒã€Docker å®‰è£…</h2><h3 id="1ã€ç¯å¢ƒæ£€æŸ¥"><a href="#1ã€ç¯å¢ƒæ£€æŸ¥" class="headerlink" title="1ã€ç¯å¢ƒæ£€æŸ¥"></a>1ã€ç¯å¢ƒæ£€æŸ¥</h3><p>CentOS Docker å®‰è£…<br>Dockeræ”¯æŒä»¥ä¸‹çš„CentOSç‰ˆæœ¬ï¼š<br>    CentOS 7 (64-bit)<br>    CentOS 6.5 (64-bit) æˆ–æ›´é«˜çš„ç‰ˆæœ¬</p><p>å‰ææ¡ä»¶<br>ç›®å‰ï¼ŒCentOS ä»…å‘è¡Œç‰ˆæœ¬ä¸­çš„å†…æ ¸æ”¯æŒ Dockerã€‚<br>Docker è¿è¡Œåœ¨ CentOS 7 ä¸Šï¼Œè¦æ±‚ç³»ç»Ÿä¸º64ä½ã€ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¸º 3.10 ä»¥ä¸Šã€‚<br>Docker è¿è¡Œåœ¨ CentOS-6.5 æˆ–æ›´é«˜çš„ç‰ˆæœ¬çš„ CentOS ä¸Šï¼Œè¦æ±‚ç³»ç»Ÿä¸º64ä½ã€ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¸º 2.6.32-431 æˆ–è€…æ›´é«˜ç‰ˆæœ¬ã€‚</p><p>Linux æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬å‘½ä»¤ï¼š</p><pre class=" language-bash"><code class="language-bash"> <span class="token function">uname</span> -a <span class="token function">cat</span> /proc/version lsb_release -a</code></pre><p>å¦‚æœå‘½ä»¤ <code>lsb_release -a</code>æç¤º<code>command not found</code>åˆ™éœ€è¦å®‰è£…<code>yum install redhat-lsb -y</code>ã€‚</p><h3 id="2ã€åŸºæœ¬ç»„æˆ"><a href="#2ã€åŸºæœ¬ç»„æˆ" class="headerlink" title="2ã€åŸºæœ¬ç»„æˆ"></a>2ã€åŸºæœ¬ç»„æˆ</h3><p>dockerä¸»æœº(Host)ï¼šå®‰è£…äº†Dockerç¨‹åºçš„æœºå™¨ï¼ŒDockerç›´æ¥å®‰è£…åœ¨æ“ä½œç³»ç»Ÿï¼ˆwindows / linuxï¼‰ä¸Šï¼›<br>dockerå®¢æˆ·ç«¯(Client)ï¼šè¿æ¥dockerä¸»æœºè¿›è¡Œæ“ä½œï¼›<br><strong>dockerä»“åº“(Registry)ï¼š</strong>ç”¨æ¥ä¿å­˜å„ç§æ‰“åŒ…å¥½çš„è½¯ä»¶é•œåƒï¼›<br><strong>dockeré•œåƒ(Images)ï¼š</strong>è½¯ä»¶æ‰“åŒ…å¥½çš„é•œåƒï¼›æ”¾åœ¨dockerä»“åº“ä¸­ï¼›<br><strong>dockerå®¹å™¨(Container)ï¼š</strong>é•œåƒå¯åŠ¨åçš„å®ä¾‹ç§°ä¸ºä¸€ä¸ªå®¹å™¨ï¼›å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ã€‚</p><p>æ¶æ„å›¾ï¼š</p><h3 id="3ã€å®‰è£…æ­¥éª¤"><a href="#3ã€å®‰è£…æ­¥éª¤" class="headerlink" title="3ã€å®‰è£…æ­¥éª¤"></a>3ã€å®‰è£…æ­¥éª¤</h3><p>å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰å®‰è£…æ­¥éª¤ï¼š<a href="https://docs.docker.com/install/linux/docker-ce/centos/" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/centos/</a></p><p><strong>Centos 6.8 å®‰è£…Dockerï¼š</strong></p><p>ï¼ˆ1ï¼‰ç¯å¢ƒå‡†å¤‡</p><p>Dockerä½¿ç”¨EPELå‘å¸ƒï¼ŒRHELç³»çš„OSé¦–å…ˆè¦ç¡®ä¿å·²ç»æŒæœ‰EPELä»“åº“ï¼Œå¦åˆ™å…ˆæ£€æŸ¥OSçš„ç‰ˆæœ¬ï¼Œç„¶åå®‰è£…ç›¸åº”çš„EPELåŒ…ã€‚</p><pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> -y epel-release</code></pre><p>ï¼ˆ2ï¼‰å®‰è£…docker</p><pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> -y docker-io</code></pre><p>ï¼ˆ3ï¼‰é…ç½®æ–‡ä»¶</p><p>å®‰è£…åçš„é…ç½®æ–‡ä»¶ï¼š/etc/sysconfig/docker</p><p>ï¼ˆ4ï¼‰å¯åœæ“ä½œ</p><pre class=" language-bash"><code class="language-bash"><span class="token function">service</span> docker start<span class="token function">service</span> docker stop</code></pre><p>ï¼ˆ5ï¼‰éªŒè¯</p><pre class=" language-bash"><code class="language-bash">docker version</code></pre><p><strong>Centos 7 å®‰è£…Dockerï¼š</strong></p><p>ï¼ˆ1ï¼‰ç¯å¢ƒæ£€æŸ¥</p><p>ç‰ˆæœ¬ç¡®è®¤ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">cat</span> /etc/redhat-release</code></pre><p>è”ç½‘æ£€æŸ¥</p><p>ï¼ˆ2ï¼‰gccç¯å¢ƒå®‰è£…</p><pre class=" language-bash"><code class="language-bash">yum -y <span class="token function">install</span> gccyum -y <span class="token function">install</span> gcc-c++</code></pre><p>ï¼ˆ3ï¼‰æ—§ç‰ˆå¸è½½</p><p>å¯å‚è€ƒå®˜ç½‘æ“ä½œï¼Œæ–°æœºå™¨å¯çœç•¥æ­¤æ“ä½œã€‚</p><pre class=" language-bash"><code class="language-bash">yum remove docker \                  docker-client \                  docker-client-latest \                  docker-common \                  docker-latest \                  docker-latest-logrotate \                  docker-logrotate \                  docker-selinux \                  docker-engine-selinux \                  docker-engine</code></pre><p>ï¼ˆ4ï¼‰å®‰è£…ä¾èµ–åŒ…</p><pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2</code></pre><p>ï¼ˆ5ï¼‰ä¿®æ”¹é•œåƒä»“åº“</p><p>ä¸»è¦æ˜¯ä¸ºäº†ä¼˜åŒ–ä¸‹è½½é€Ÿåº¦</p><pre class=" language-bash"><code class="language-bash">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code></pre><p>ï¼ˆ6ï¼‰æ›´æ–°yumåŒ…ç´¢å¼•</p><pre class=" language-bash"><code class="language-bash">yum makecache fast</code></pre><p>ï¼ˆ7ï¼‰å®‰è£…Docker CE</p><pre class=" language-bash"><code class="language-bash">yum -y <span class="token function">install</span> docker-ce</code></pre><p>ï¼ˆ8ï¼‰å¯åœæ“ä½œ</p><pre class=" language-bash"><code class="language-bash">systemctl start dockersystemctl stop docker</code></pre><p>ï¼ˆ9ï¼‰æµ‹è¯•éªŒè¯</p><pre class=" language-bash"><code class="language-bash">docker version</code></pre><p>ï¼ˆ10ï¼‰é…ç½®é•œåƒåŠ é€Ÿ</p><pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> -p /etc/dockervim /etc/docker/daemon.jsonsystemctl daemon-reload  <span class="token comment" spellcheck="true"># é‡æ–°åŠ è½½</span>systemctl restart docker <span class="token comment" spellcheck="true"># é‡å¯</span></code></pre><p><code>daemon.json</code> å†…å®¹ï¼š</p><pre class=" language-txt"><code class="language-txt">#ç½‘æ˜“äº‘{"registry-mirrors": ["http://hub-mirror.c.163.com"] }æˆ– #é˜¿é‡Œäº‘{  "registry-mirrors": ["https://ï½›è‡ªå·²çš„ç¼–ç ï½.mirror.aliyuncs.com"]}</code></pre><p>ï¼ˆ11ï¼‰å¸è½½docker</p><pre class=" language-bahs"><code class="language-bahs">systemctl stop dockeryum -y remove docker-cerm -rf /var/lib/docker</code></pre><p>å…³äºé˜¿é‡Œäº‘æˆ–ç½‘æ˜“äº‘é•œåƒåŠ é€Ÿ</p><p>æ³¨å†Œé˜¿é‡Œäº‘è´¦æˆ·ï¼Œç™»å½•é˜¿é‡Œäº‘å¼€å‘è€…å¹³å°ï¼Œè·å–åŠ é€Ÿå™¨åœ°å€ï¼Œé…ç½®å‚è€ƒç¬¬ï¼ˆ10ï¼‰æ­¥ã€‚</p><p>ï¼ˆ12ï¼‰æ›´å¤šå‘½ä»¤</p><p>â€‹ ï¼ˆAï¼‰ ï¼š<a href="https://docs.docker.com/engine/reference/commandline/docker/" target="_blank" rel="noopener">Docker å®˜æ–¹æ–‡æ¡£</a></p><p>â€‹ ï¼ˆBï¼‰ï¼šå‚è€ƒæ¯ä¸€ä¸ªé•œåƒçš„æ–‡æ¡£ã€‚</p><h2 id="ä¸‰ã€Docker-åŸç†"><a href="#ä¸‰ã€Docker-åŸç†" class="headerlink" title="ä¸‰ã€Docker åŸç†"></a>ä¸‰ã€Docker åŸç†</h2><p>Dockeræ˜¯ä¸€ä¸ªClient-Serverç»“æ„çš„ç³»ç»Ÿï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸»æœºä¸Šï¼Œ ç„¶åé€šè¿‡Socketè¿æ¥ä»å®¢æˆ·ç«¯è®¿é—®ï¼Œå®ˆæŠ¤è¿›ç¨‹ä»å®¢æˆ·ç«¯æ¥å—å‘½ä»¤å¹¶ç®¡ç†è¿è¡Œåœ¨ä¸»æœºä¸Šçš„å®¹å™¨ã€‚ </p><p>å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ç¯å¢ƒï¼Œé²¸é±¼èƒŒä¸Šçš„ä¸€ä¸ªä¸ªå°é›†è£…ç®±ã€‚</p><p><strong>ç”Ÿå‘½å‘¨æœŸ</strong></p><p>Docker å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸé‡Œåˆ†ä¸ºäº”ç§çŠ¶æ€ï¼Œå…¶åˆ†åˆ«ä»£è¡¨ç€ï¼š</p><ul><li>Createdï¼šå®¹å™¨å·²ç»è¢«åˆ›å»ºï¼Œå®¹å™¨æ‰€éœ€çš„ç›¸å…³èµ„æºå·²ç»å‡†å¤‡å°±ç»ªï¼Œä½†å®¹å™¨ä¸­çš„ç¨‹åºè¿˜æœªå¤„äºè¿è¡ŒçŠ¶æ€ã€‚</li><li>Runningï¼šå®¹å™¨æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå°±æ˜¯å®¹å™¨ä¸­çš„åº”ç”¨æ­£åœ¨è¿è¡Œã€‚</li><li>Pausedï¼šå®¹å™¨å·²æš‚åœï¼Œè¡¨ç¤ºå®¹å™¨ä¸­çš„æ‰€æœ‰ç¨‹åºéƒ½å¤„äºæš‚åœ ( ä¸æ˜¯åœæ­¢ ) çŠ¶æ€ã€‚</li><li>Stoppedï¼šå®¹å™¨å¤„äºåœæ­¢çŠ¶æ€ï¼Œå ç”¨çš„èµ„æºå’Œæ²™ç›’ç¯å¢ƒéƒ½ä¾ç„¶å­˜åœ¨ï¼Œåªæ˜¯å®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºå‡å·²åœæ­¢ã€‚</li><li>Deletedï¼šå®¹å™¨å·²åˆ é™¤ï¼Œç›¸å…³å ç”¨çš„èµ„æºåŠå­˜å‚¨åœ¨ Docker ä¸­çš„ç®¡ç†ä¿¡æ¯ä¹Ÿéƒ½å·²é‡Šæ”¾å’Œç§»é™¤ã€‚</li></ul><h2 id="å››ã€å¸¸ç”¨å‘½ä»¤"><a href="#å››ã€å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å››ã€å¸¸ç”¨å‘½ä»¤"></a>å››ã€å¸¸ç”¨å‘½ä»¤</h2><h3 id="1ã€å¸®åŠ©å‘½ä»¤"><a href="#1ã€å¸®åŠ©å‘½ä»¤" class="headerlink" title="1ã€å¸®åŠ©å‘½ä»¤"></a>1ã€å¸®åŠ©å‘½ä»¤</h3><pre><code>docker versiondocker infodocker --help</code></pre><h3 id="2ã€é•œåƒå‘½ä»¤"><a href="#2ã€é•œåƒå‘½ä»¤" class="headerlink" title="2ã€é•œåƒå‘½ä»¤"></a>2ã€é•œåƒå‘½ä»¤</h3><p>ï¼ˆ1ï¼‰æœç´¢é•œåƒ</p><p>å¯ä»¥ç›´æ¥åœ¨ï¼š<a href="https://hub.docker.com" target="_blank" rel="noopener">https://hub.docker.com</a> æœç´¢ã€‚</p><p>ä½¿ç”¨å‘½ä»¤æœç´¢é•œåƒï¼š</p><pre class=" language-bash"><code class="language-bash">docker search <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> images_name</code></pre><p>OPTIONS:</p><ul><li><strong>â€“no-trunc ï¼š</strong>æ˜¾ç¤ºå®Œæ•´çš„é•œåƒæè¿°ã€‚</li><li><strong>-s ï¼š</strong>åˆ—å‡ºæ”¶è—æ•°ä¸å°äºæŒ‡å®šå€¼çš„é•œåƒã€‚</li><li><strong>â€“automatedï¼š</strong>åªåˆ—å‡ºautomated build ç±»å‹çš„é•œåƒã€‚</li></ul><p>ï¼ˆ2ï¼‰ä¸‹è½½é•œåƒ</p><pre class=" language-bash"><code class="language-bash">docker pull images_name<span class="token punctuation">[</span>:tag<span class="token punctuation">]</span></code></pre><p>ï¼ˆ3ï¼‰æ˜¾ç¤ºæœ¬åœ°é•œåƒ</p><pre class=" language-bash"><code class="language-bash">docker images <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span></code></pre><p>OPTIONSï¼š</p><ul><li><strong>-a ï¼š</strong>åˆ—å‡ºæœ¬åœ°æ‰€æœ‰é•œåƒ</li><li><strong>-q ï¼š</strong>åªæ˜¾ç¤ºé•œåƒIDã€‚</li><li><strong>â€“digests ï¼š</strong>æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯</li><li><strong>â€“no-trunc ï¼š</strong>æ˜¾ç¤ºå®Œæ•´çš„é•œåƒä¿¡æ¯</li></ul><p>ï¼ˆ3ï¼‰åˆ é™¤æœ¬åœ°é•œåƒ</p><p>åˆ é™¤å•ä¸ªé•œåƒï¼š</p><pre><code>docker rmi -f images_id</code></pre><p>åˆ é™¤å¤šä¸ªé•œåƒï¼š</p><pre class=" language-bash"><code class="language-bash">docker rmi -f images_name1:tag  images_name2:tag </code></pre><p>åˆ é™¤å…¨éƒ¨é•œåƒï¼š</p><pre><code>docker rmi -f $(docker images -qa)</code></pre><p>ï¼ˆ4ï¼‰æäº¤é•œåƒ</p><p><code>docker commit</code> æäº¤å®¹å™¨å‰¯æœ¬ä½¿ä¹‹æˆä¸ºä¸€ä¸ªæ–°çš„é•œåƒã€‚</p><p>è¿™ä¸ªå‘½ä»¤ä¸€èˆ¬å¯ä»¥ä¸ªæ€§åŒ–å¥½å®¹å™¨ä¹‹åï¼Œåˆ¶ä½œæˆè‡ªå·±çš„é•œåƒæ¨¡æ¿ã€‚</p><pre><code>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</code></pre><p>OPTIONSè¯´æ˜ï¼š</p><ul><li><strong>-a ï¼š</strong>æäº¤çš„é•œåƒä½œè€…ï¼›</li><li><strong>-c ï¼š</strong>ä½¿ç”¨DockerfileæŒ‡ä»¤æ¥åˆ›å»ºé•œåƒï¼›</li><li><strong>-m ï¼š</strong>æäº¤æ—¶çš„è¯´æ˜æ–‡å­—ï¼›</li><li><strong>-p ï¼š</strong>åœ¨commitæ—¶ï¼Œå°†å®¹å™¨æš‚åœã€‚</li></ul><p>ç¤ºä¾‹ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># å°†å®¹å™¨a404c6c174a2 ä¿å­˜ä¸ºæ–°çš„é•œåƒ,å¹¶æ·»åŠ æäº¤äººä¿¡æ¯å’Œè¯´æ˜ä¿¡æ¯ã€‚</span>docker commit -a <span class="token string">"xiaocai.com"</span> -m <span class="token string">"my mysql"</span> a404c6c174a2  mymysql:v1 </code></pre><p>ï¼ˆ5ï¼‰ç™»å½•ä¸æäº¤</p><p>ä¹‹æ‰€ä»¥è¦ç™»å½•æ˜¯å› ä¸ºè¦æŠŠæœ¬åœ°é•œåƒæäº¤åˆ°é•œåƒä»“åº“ï¼Œé»˜è®¤ä¸ºå®˜æ–¹ä»“åº“Docker Hubï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ­å»ºè‡ªå·±çš„é•œåƒä»“åº“ã€‚</p><p>ç™»å½•ï¼š</p><pre><code>docker login -u username -p password</code></pre><p>é€€å‡ºï¼š</p><pre><code>docker logout</code></pre><p>æœ¬åœ°é•œåƒæäº¤åˆ°é•œåƒä»“åº“</p><pre><code>docker push [OPTIONS] NAME[:TAG]</code></pre><p>OPTIONSè¯´æ˜ï¼š</p><ul><li><strong>â€“disable-content-trust ï¼š</strong>å¿½ç•¥é•œåƒçš„æ ¡éªŒ,é»˜è®¤å¼€å¯</li></ul><h3 id="3ã€å®¹å™¨å‘½ä»¤"><a href="#3ã€å®¹å™¨å‘½ä»¤" class="headerlink" title="3ã€å®¹å™¨å‘½ä»¤"></a>3ã€å®¹å™¨å‘½ä»¤</h3><p>ï¼ˆ1ï¼‰æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨</p><pre class=" language-bash"><code class="language-bash">docker run <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> IMAGE <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARG<span class="token punctuation">..</span>.<span class="token punctuation">]</span></code></pre><p> OPTIONSè¯´æ˜ï¼ˆå¸¸ç”¨ï¼‰ï¼šï¼ˆæœ‰äº›æ˜¯ä¸€ä¸ªå‡å·ï¼Œæœ‰äº›æ˜¯ä¸¤ä¸ªå‡å·ï¼‰</p><ul><li><p><strong>â€“name=â€å®¹å™¨æ–°åå­—â€ï¼š</strong> ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›</p></li><li><p><strong>-dï¼š</strong> åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼Œä¹Ÿå³å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨ï¼›</p></li><li><p><strong>-iï¼š</strong>ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼›</p></li><li><p><strong>-tï¼š</strong>ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›</p></li><li><p><strong>-Pï¼š</strong>éšæœºç«¯å£æ˜ å°„ï¼›</p></li><li><p><strong>-pï¼š</strong>æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæœ‰ä»¥ä¸‹å››ç§æ ¼å¼</p><p>â€‹      ip:hostPort:containerPort</p><pre><code>  ip::containerPort  hostPort:containerPort  containerPort</code></pre></li><li><p><strong>â€“volume , -vï¼š</strong> ç»‘å®šä¸€ä¸ªå·ã€‚</p><p>æ­¤å¤„åªåˆ—ä¸¾å¸¸ç”¨å‚æ•°ï¼Œè¿˜æœ‰å…¶ä»–å‚æ•°å¯å‚è€ƒå®˜ç½‘å‘½ä»¤å‚æ•°è¯´æ˜ã€‚</p></li></ul><p>ç¤ºä¾‹1ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#ä½¿ç”¨é•œåƒcentos:latestä»¥äº¤äº’æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨,åœ¨å®¹å™¨å†…æ‰§è¡Œ/bin/bashå‘½ä»¤ã€‚</span>docker run -it centos /bin/bash </code></pre><p><strong>é€€å‡ºå®¹å™¨</strong></p><p>ä»¥äº¤äº’æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨ä¹‹åï¼Œé€€å‡ºå®¹å™¨ï¼š</p><p><code>exit</code> ï¼šå®¹å™¨åœæ­¢å¹¶é€€å‡ºã€‚</p><p><code>CTRL + P + Q</code> ï¼šå®¹å™¨ä¸åœæ­¢å¹¶é€€å‡ºã€‚</p><p>è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p><p>æ–¹å¼ä¸€ï¼š</p><pre class=" language-bash"><code class="language-bash">docker <span class="token function">exec</span> -it container-id  /bin/bash</code></pre><p>æ–¹å¼äºŒï¼š</p><pre><code>docker attach container-id </code></pre><p>äºŒè€…åŒºåˆ«ï¼š</p><p><strong>attach ï¼š</strong> ç›´æ¥è¿›å…¥å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚</p><p><strong>exec ï¼š</strong>æ˜¯åœ¨å®¹å™¨ä¸­æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå¹¶ä¸”å¯ä»¥å¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚</p><p>ç¤ºä¾‹2ï¼šï¼ˆå¸¸ç”¨ï¼‰</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#ä½¿ç”¨é•œåƒcentos:latestä»¥åå°å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨</span>docker run -d centos</code></pre><p>ï¼ˆ2ï¼‰æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p><pre class=" language-bash"><code class="language-bash">docker <span class="token function">ps</span> <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span></code></pre><p>OPTIONSï¼š</p><ul><li><strong>-a ï¼š</strong>åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨+å†å²ä¸Šè¿è¡Œè¿‡çš„</li><li><strong>-l ï¼š</strong>æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ã€‚</li><li><strong>-nï¼š</strong>æ˜¾ç¤ºæœ€è¿‘nä¸ªåˆ›å»ºçš„å®¹å™¨ã€‚</li><li><strong>-q ï¼š</strong>é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·ã€‚</li><li><strong>â€“no-trunc ï¼š</strong>ä¸æˆªæ–­è¾“å‡ºã€‚</li></ul><p>ï¼ˆ3ï¼‰å®¹å™¨å­˜åœ¨ä¹‹åçš„å¯åœåˆ </p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># å¯åŠ¨å®¹å™¨</span>docker start container-id <span class="token operator">|</span> container-name<span class="token comment" spellcheck="true"># é‡å¯å®¹å™¨</span>docker restart container-id <span class="token operator">|</span> container-name<span class="token comment" spellcheck="true"># åœæ­¢å®¹å™¨</span>docker restart container-id <span class="token operator">|</span> container-name<span class="token comment" spellcheck="true"># æš´åŠ›åœæ­¢å®¹å™¨-æ‹”ç”µæº</span>docker <span class="token function">kill</span> container-id <span class="token operator">|</span> container-name<span class="token comment" spellcheck="true"># åˆ é™¤å®¹å™¨</span>docker <span class="token function">rm</span> container-id <span class="token comment" spellcheck="true"># å¼ºåˆ¶åˆ é™¤å¤šä¸ªå®¹å™¨</span>docker <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -a -q<span class="token variable">)</span></span>docker  <span class="token function">ps</span> -a -q <span class="token operator">|</span> <span class="token function">xargs</span> docker <span class="token function">rm</span></code></pre><p>ï¼ˆ4ï¼‰æŸ¥å®¹å™¨ä¿¡æ¯ï¼ˆé‡ç‚¹ï¼‰</p><p><strong>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</strong></p><pre><code>docker logs -f -t --tail  container-id</code></pre><p><strong>-t ï¼š</strong>åŠ å…¥æ—¶é—´æˆ³</p><p><strong>-f ï¼š</strong>è·Ÿéšæœ€æ–°çš„æ—¥å¿—æ‰“å°</p><p><strong>â€“tail 300  ï¼š</strong>æ˜¾ç¤ºæœ€å300æ¡æ—¥å¿—</p><p><strong>æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹</strong></p><pre class=" language-bash"><code class="language-bash">docker  <span class="token function">top</span> container-id</code></pre><p><strong>æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚</strong></p><pre class=" language-bash"><code class="language-bash">docker  inspect container-id</code></pre><p><strong>ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°å®¿ä¸»æœº</strong></p><pre><code>docker cp container-id:å®¹å™¨å†…è·¯å¾„  ç›®æ ‡ä¸»æœºè·¯å¾„</code></pre><p>ç¤ºä¾‹ï¼š</p><pre class=" language-bash"><code class="language-bash">docker <span class="token function">cp</span> f1faf3c3c6c5:/usr/local/cptest/container_test.txt  /tmp/test.txt</code></pre><p><img src="/medias/loading-animated.gif" data-original="/images/docker/docker-commands-diagram.jpg" alt="Docker commands Diagram"></p><table><thead><tr><th>å‘½ä»¤å…³é”®è¯</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>attach</td><td>Attach to a running container   # å½“å‰ shell ä¸‹ attach è¿æ¥æŒ‡å®šè¿è¡Œé•œåƒ</td></tr><tr><td>build</td><td>Build an image from a Dockerfile  # é€šè¿‡ Dockerfile å®šåˆ¶é•œåƒ</td></tr><tr><td>commit</td><td>Create a new image from a container changes   # æäº¤å½“å‰å®¹å™¨ä¸ºæ–°çš„é•œåƒ</td></tr><tr><td>cp</td><td>Copy files/folders from the containers filesystem to the host path   #ä»å®¹å™¨ä¸­æ‹·è´æŒ‡å®šæ–‡ä»¶æˆ–è€…ç›®å½•åˆ°å®¿ä¸»æœºä¸­</td></tr><tr><td>create</td><td>Create a new container                        # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ŒåŒ runï¼Œä½†ä¸å¯åŠ¨å®¹å™¨</td></tr><tr><td>diff</td><td>Inspect changes on a containerâ€™s filesystem   # æŸ¥çœ‹ docker å®¹å™¨å˜åŒ–</td></tr><tr><td>events</td><td>Get real time events from the server          # ä» docker æœåŠ¡è·å–å®¹å™¨å®æ—¶äº‹ä»¶</td></tr><tr><td>exec</td><td>Run a command in an existing container        # åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸Šè¿è¡Œå‘½ä»¤</td></tr><tr><td>export</td><td>Stream the contents of a container as a tar archive   # å¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ª tar å½’æ¡£æ–‡ä»¶[å¯¹åº” import ]</td></tr><tr><td>history</td><td>Show the history of an image   # å±•ç¤ºä¸€ä¸ªé•œåƒå½¢æˆå†å²</td></tr><tr><td>images</td><td>List images  # åˆ—å‡ºç³»ç»Ÿå½“å‰é•œåƒ</td></tr><tr><td>import</td><td>Create a new filesystem image from the contents of a tarball # ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿæ˜ åƒ[å¯¹åº”export]</td></tr><tr><td>info</td><td>Display system-wide information               # æ˜¾ç¤ºç³»ç»Ÿç›¸å…³ä¿¡æ¯</td></tr><tr><td>inspect</td><td>Return low-level information on a container   # æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</td></tr><tr><td>kill</td><td>Kill a running container                      # kill æŒ‡å®š docker å®¹å™¨</td></tr><tr><td>load</td><td>Load an image from a tar archive              # ä»ä¸€ä¸ª tar åŒ…ä¸­åŠ è½½ä¸€ä¸ªé•œåƒ[å¯¹åº” save]</td></tr><tr><td>login</td><td>Register or Login to the docker registry server    # æ³¨å†Œæˆ–è€…ç™»é™†ä¸€ä¸ª docker æºæœåŠ¡å™¨</td></tr><tr><td>logout</td><td>Log out from a Docker registry server          # ä»å½“å‰ Docker registry é€€å‡º</td></tr><tr><td>logs</td><td>Fetch the logs of a container                 # è¾“å‡ºå½“å‰å®¹å™¨æ—¥å¿—ä¿¡æ¯</td></tr><tr><td>port</td><td>Lookup the public-facing port which is NAT-ed to PRIVATE_PORT    # æŸ¥çœ‹æ˜ å°„ç«¯å£å¯¹åº”çš„å®¹å™¨å†…éƒ¨æºç«¯å£</td></tr><tr><td>pause</td><td>Pause all processes within a container        # æš‚åœå®¹å™¨</td></tr><tr><td>ps</td><td>List containers                               # åˆ—å‡ºå®¹å™¨åˆ—è¡¨</td></tr><tr><td>pull</td><td>Pull an image or a repository from the docker registry server   # ä»dockeré•œåƒæºæœåŠ¡å™¨æ‹‰å–æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒ</td></tr><tr><td>push</td><td>Push an image or a repository to the docker registry server    # æ¨é€æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒè‡³dockeræºæœåŠ¡å™¨</td></tr><tr><td>restart</td><td>Restart a running container                   # é‡å¯è¿è¡Œçš„å®¹å™¨</td></tr><tr><td>rm</td><td>Remove one or more containers                 # ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨</td></tr><tr><td>rmi</td><td>Remove one or more images             # ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ[æ— å®¹å™¨ä½¿ç”¨è¯¥é•œåƒæ‰å¯åˆ é™¤ï¼Œå¦åˆ™éœ€åˆ é™¤ç›¸å…³å®¹å™¨æ‰å¯ç»§ç»­æˆ– -f å¼ºåˆ¶åˆ é™¤]</td></tr><tr><td>run</td><td>Run a command in a new container              # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤</td></tr><tr><td>save</td><td>Save an image to a tar archive                # ä¿å­˜ä¸€ä¸ªé•œåƒä¸ºä¸€ä¸ª tar åŒ…[å¯¹åº” load]</td></tr><tr><td>search</td><td>Search for an image on the Docker Hub         # åœ¨ docker hub ä¸­æœç´¢é•œåƒ</td></tr><tr><td>start</td><td>Start a stopped containers                    # å¯åŠ¨å®¹å™¨</td></tr><tr><td>stop</td><td>Stop a running containers                     # åœæ­¢å®¹å™¨</td></tr><tr><td>tag</td><td>Tag an image into a repository                # ç»™æºä¸­é•œåƒæ‰“æ ‡ç­¾</td></tr><tr><td>top</td><td>Lookup the running processes of a container   # æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯</td></tr><tr><td>unpause</td><td>Unpause a paused container                    # å–æ¶ˆæš‚åœå®¹å™¨</td></tr><tr><td>version</td><td>Show the docker version information           # æŸ¥çœ‹ docker ç‰ˆæœ¬å·</td></tr><tr><td>wait</td><td>Block until a container stops, then print its exit code   # æˆªå–å®¹å™¨åœæ­¢æ—¶çš„é€€å‡ºçŠ¶æ€å€¼</td></tr></tbody></table><h2 id="äº”ã€Docker-é•œåƒ"><a href="#äº”ã€Docker-é•œåƒ" class="headerlink" title="äº”ã€Docker é•œåƒ"></a>äº”ã€Docker é•œåƒ</h2><h3 id="1ã€Docker-é•œåƒæ˜¯ä»€ä¹ˆ"><a href="#1ã€Docker-é•œåƒæ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€Docker é•œåƒæ˜¯ä»€ä¹ˆ"></a>1ã€Docker é•œåƒæ˜¯ä»€ä¹ˆ</h3><p>UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼šUnionæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹(unite several directories into a single virtual filesystem)ã€‚Union æ–‡ä»¶ç³»ç»Ÿæ˜¯ Docker é•œåƒçš„åŸºç¡€ã€‚</p><p>é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼ˆæ²¡æœ‰çˆ¶é•œåƒï¼‰ï¼Œå¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong>ä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½•ã€‚</p><p>é•œåƒï¼ˆImagesï¼‰å¯ä»¥çœ‹æˆæ˜¯ç”±å¤šä¸ªé•œåƒå±‚å åŠ èµ·æ¥çš„ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ˆé€šè¿‡UnionFSä¸AUFSæ–‡ä»¶è”åˆç³»ç»Ÿå®ç°ï¼‰ï¼Œé•œåƒå±‚ï¼ˆ Image Layerï¼‰ä¹Ÿå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªåŸºæœ¬çš„é•œåƒï¼Œè€Œæ¯ä¸ªé•œåƒå±‚ä¹‹é—´é€šè¿‡æŒ‡é’ˆçš„å½¢å¼è¿›è¡Œå åŠ ã€‚</p><p><strong>Doceré•œåƒçš„ç‰¹ç‚¹ï¼š</strong></p><p>Dockeré•œåƒéƒ½æ˜¯åªè¯»çš„ï¼Œå½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ã€‚è¿™ä¸€å±‚é€šå¸¸è¢«ç§°ä½œâ€œå®¹å™¨å±‚â€ï¼Œâ€œå®¹å™¨å±‚â€ä¹‹ä¸‹çš„éƒ½å«â€œé•œåƒå±‚â€ã€‚ </p><h3 id="2ã€Dockeré•œåƒåŠ è½½åŸç†"><a href="#2ã€Dockeré•œåƒåŠ è½½åŸç†" class="headerlink" title="2ã€Dockeré•œåƒåŠ è½½åŸç†"></a>2ã€Dockeré•œåƒåŠ è½½åŸç†</h3><p>dockerçš„é•œåƒå®é™…ä¸Šç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œè¿™ç§å±‚çº§çš„æ–‡ä»¶ç³»ç»Ÿå«UnionFSã€‚</p><p><code>bootfs(boot file system)</code>ä¸»è¦åŒ…å«<code>bootloader</code>å’Œ<code>kernel</code>, <code>bootloader</code>ä¸»è¦æ˜¯å¼•å¯¼åŠ è½½<code>kernel</code>, <code>Linux</code>åˆšå¯åŠ¨æ—¶ä¼šåŠ è½½<code>bootfs</code>æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨Dockeré•œåƒçš„æœ€åº•å±‚æ˜¯<code>bootfs</code>ã€‚è¿™ä¸€å±‚ä¸æˆ‘ä»¬å…¸å‹çš„<code>Linux/Unix</code>ç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å«<code>boot</code>åŠ è½½å™¨å’Œå†…æ ¸ã€‚å½“bootåŠ è½½å®Œæˆä¹‹åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”±<code>bootfs</code>è½¬äº¤ç»™å†…æ ¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¹Ÿä¼šå¸è½½<code>bootfs</code>ã€‚</p><p><code>rootfs (root file system)</code>ï¼Œåœ¨bootfsä¹‹ä¸Šã€‚åŒ…å«çš„å°±æ˜¯å…¸å‹ <code>Linux</code> ç³»ç»Ÿä¸­çš„ /dev, /proc, /bin, /etc ç­‰æ ‡å‡†ç›®å½•å’Œæ–‡ä»¶ã€‚<code>rootfs</code>å°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚<code>Ubuntu</code>ï¼Œ<code>Centos</code>ç­‰ç­‰ã€‚ </p><p><img src="/medias/loading-animated.gif" data-original="/images/docker/docker-kernel.jpg" alt="Docker å®¹å™¨"></p><p>dockeré•œåƒé‡Œçš„centos ç³»ç»Ÿå¤§å°çº¦ 200Mï¼Œå¯¹äºä¸€ä¸ªç²¾ç®€çš„OSï¼Œrootfså¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„å‘½ä»¤ã€å·¥å…·å’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ç”¨Hostçš„kernelï¼Œè‡ªå·±åªéœ€è¦æä¾› rootfs å°±è¡Œäº†ã€‚ç”±æ­¤å¯è§å¯¹äºä¸åŒçš„linuxå‘è¡Œç‰ˆ, bootfsåŸºæœ¬æ˜¯ä¸€è‡´çš„, rootfsä¼šæœ‰å·®åˆ«, å› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…¬ç”¨bootfsã€‚</p><p>åœ¨æ‰§è¡Œpull å‘½ä»¤ä¸‹è½½é•œåƒçš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°dockerçš„é•œåƒå¥½åƒæ˜¯åœ¨ä¸€å±‚ä¸€å±‚çš„åœ¨ä¸‹è½½ã€‚</p><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åˆ†å±‚å‘¢ï¼Ÿ</p><p>æœ€ä¸»è¦çš„æ˜¯å¯ä»¥å®ç°<strong>å…±äº«èµ„æº</strong></p><p>æ¯”å¦‚ï¼šæœ‰å¤šä¸ªé•œåƒéƒ½ä»ç›¸åŒçš„ base é•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆå®¿ä¸»æœºåªéœ€åœ¨ç£ç›˜ä¸Šä¿å­˜ä¸€ä»½baseé•œåƒï¼Œ<br>åŒæ—¶å†…å­˜ä¸­ä¹Ÿåªéœ€åŠ è½½ä¸€ä»½ base é•œåƒï¼Œå°±å¯ä»¥ä¸ºæ‰€æœ‰å®¹å™¨æœåŠ¡äº†ã€‚è€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ã€‚</p><h2 id="å…­ã€Docker-å®¹å™¨æ•°æ®å·"><a href="#å…­ã€Docker-å®¹å™¨æ•°æ®å·" class="headerlink" title="å…­ã€Docker å®¹å™¨æ•°æ®å·"></a>å…­ã€Docker å®¹å™¨æ•°æ®å·</h2><p>Docker å®¹å™¨æ•°æ®å·ä¸»è¦æ˜¯ä¸ºäº†å®¹å™¨çš„æŒä¹…åŒ–ï¼Œæ–¹ä¾¿å®¹å™¨é—´ç»§æ‰¿å’Œæ•°æ®å…±äº«ã€‚</p><h3 id="æ•°æ®å·å‘½ä»¤"><a href="#æ•°æ®å·å‘½ä»¤" class="headerlink" title="æ•°æ®å·å‘½ä»¤"></a>æ•°æ®å·å‘½ä»¤</h3><h4 id="1-åˆ›å»ºæ•°æ®å·"><a href="#1-åˆ›å»ºæ•°æ®å·" class="headerlink" title="1.åˆ›å»ºæ•°æ®å·"></a>1.åˆ›å»ºæ•°æ®å·</h4><pre class=" language-bash"><code class="language-bash">docker volume  create  æ•°æ®å·åç§°</code></pre><p>åˆ›å»ºæ•°æ®å·ä¹‹åé»˜è®¤å­˜æ”¾åœ¨ï¼š<code>/var/lib/docker/volumes/æ•°æ®å·åç§°/_data</code></p><h4 id="2-æŸ¥çœ‹å…¨éƒ¨æ•°æ®å·"><a href="#2-æŸ¥çœ‹å…¨éƒ¨æ•°æ®å·" class="headerlink" title="2.æŸ¥çœ‹å…¨éƒ¨æ•°æ®å·"></a>2.æŸ¥çœ‹å…¨éƒ¨æ•°æ®å·</h4><pre class=" language-bash"><code class="language-bash">docker volume  <span class="token function">ls</span></code></pre><h4 id="3-æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯"><a href="#3-æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯" class="headerlink" title="3.æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯"></a>3.æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯</h4><pre class=" language-bash"><code class="language-bash">docker volume  inspect æ•°æ®å·åç§°</code></pre><h4 id="4-åˆ é™¤æ•°æ®å·"><a href="#4-åˆ é™¤æ•°æ®å·" class="headerlink" title="4.åˆ é™¤æ•°æ®å·"></a>4.åˆ é™¤æ•°æ®å·</h4><pre class=" language-bash"><code class="language-bash">docker volume  <span class="token function">rm</span> æ•°æ®å·åç§°</code></pre><h4 id="5-åº”ç”¨æ•°æ®å·"><a href="#5-åº”ç”¨æ•°æ®å·" class="headerlink" title="5.åº”ç”¨æ•°æ®å·"></a>5.åº”ç”¨æ•°æ®å·</h4><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># æ•°æ®å·ä¸å­˜åœ¨æ—¶docker è‡ªåŠ¨åˆ›å»ºã€‚ä¼šå°†æ•°æ®å·å†…éƒ¨è‡ªå¸¦æ–‡ä»¶å­˜å‚¨åœ¨é»˜è®¤çš„å­˜æ”¾è·¯å¾„ä¸­</span>docker run -v æ•°æ®å·åç§°:å®¹å™¨å†…éƒ¨è·¯å¾„  é•œåƒID<span class="token comment" spellcheck="true"># ç›´æ¥æŒ‡å®šä¸€ä¸ªè·¯å¾„ä½œä¸ºå®¹å™¨å·çš„å­˜æ”¾ä½ç½®ï¼Œè·¯å¾„æ˜¯ç©ºçš„ã€‚ï¼ˆæ¨èï¼‰</span>docker run -v  è·¯å¾„:å®¹å™¨å†…éƒ¨è·¯å¾„</code></pre><h3 id="1ã€å®¹å™¨æ·»åŠ æ•°æ®å·"><a href="#1ã€å®¹å™¨æ·»åŠ æ•°æ®å·" class="headerlink" title="1ã€å®¹å™¨æ·»åŠ æ•°æ®å·"></a>1ã€å®¹å™¨æ·»åŠ æ•°æ®å·</h3><p>ï¼ˆ1ï¼‰ç›´æ¥å‘½ä»¤æ·»åŠ </p><pre class=" language-bash"><code class="language-bash">docker run -it -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•      é•œåƒå</code></pre><p>å¸¦æƒé™çš„å‘½ä»¤ï¼š</p><pre class=" language-bash"><code class="language-bash">docker run -it -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•:ro      é•œåƒå</code></pre><p><code>rw</code> ï¼šread  write è¯»å†™æƒé™ï¼Œé»˜è®¤</p><p><code>ro</code> ï¼šread only åªè¯»æƒé™</p><p><code>wo</code> ï¼šwrite only åªå†™æƒé™</p><p>æŸ¥çœ‹æ•°æ®å·æ˜¯å¦æŒ‚è½½æˆåŠŸ</p><pre class=" language-bash"><code class="language-bash">docker inspect container-id</code></pre><p>å¦‚æœæµ‹è¯•å®¹å™¨å’Œå®¿ä¸»æœºç›´æ¥æ•°æ®å…±äº«ï¼Œå¯ä»¥å°è¯•ä»å®¿ä¸»æœºä¿®æ”¹æ–‡ä»¶ï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹ï¼Œå†åè¿‡æ¥æ“ä½œä¸€æ¬¡ã€‚</p><p><strong>å‡ºé”™æè¿°ï¼š</strong>DockeræŒ‚è½½ä¸»æœºç›®å½•Dockerè®¿é—®å‡ºç° <code>cannot open directory .: Permission denied</code><br><strong>è§£å†³åŠæ³•ï¼š</strong>åœ¨æŒ‚è½½ç›®å½•åå¤šåŠ ä¸€ä¸ªâ€“privileged=trueå‚æ•°å³å¯ã€‚</p><p>ï¼ˆ2ï¼‰DockerFileæ·»åŠ </p><p>æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª mydocker æ–‡ä»¶å¤¹è¿›å…¥ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªdockerfileæ–‡ä»¶ï¼Œå†…å®¹ï¼š</p><pre class=" language-txt"><code class="language-txt"># volume testFROM centosVOLUME ["/dataVolumeContainer1","/dataVolumeContainer2"]CMD echo "finished,--------success1"CMD /bin/bash</code></pre><p>è¿™é‡Œåœ¨ Dockerfile ä¸­ä½¿ç”¨VOLUMEæŒ‡ä»¤æ¥ç»™é•œåƒæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å·ã€‚</p><p><code>VOLUME[&quot;/dataVolumeContainer&quot;,&quot;/dataVolumeContainer2&quot;,&quot;/dataVolumeContainer3&quot;]</code></p><p>è¯´æ˜ï¼šå‡ºäºå¯ç§»æ¤å’Œåˆ†äº«çš„è€ƒè™‘ï¼Œç”¨<code>-v ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•</code>è¿™ç§æ–¹æ³•ä¸èƒ½å¤Ÿç›´æ¥åœ¨Dockerfileä¸­å®ç°ã€‚ç”±äºå®¿ä¸»æœºç›®å½•æ˜¯ä¾èµ–äºç‰¹å®šå®¿ä¸»æœºçš„ï¼Œå¹¶ä¸èƒ½å¤Ÿä¿è¯åœ¨æ‰€æœ‰çš„å®¿ä¸»æœºä¸Šéƒ½å­˜åœ¨è¿™æ ·çš„ç‰¹å®šç›®å½•ã€‚</p><p>ä½¿ç”¨ <code>build</code> ç”Ÿæˆé•œåƒ</p><pre><code>docker build -f /mydocker/dockerfile -t xiaocai/centos</code></pre><p>å¦‚æœç”ŸæˆæˆåŠŸåˆ™å¯ä»¥ä½¿ç”¨<code>docker images</code>æŸ¥çœ‹</p><p>è¿è¡Œå®¹å™¨ <code>docker run  it centos-container-id /bin/bash</code></p><p>ä½¿ç”¨ <code>docker inspect centos-container-id</code> æŸ¥çœ‹å®¹å™¨å†…çš„å·ç›®å½•åœ°å€å¯¹åº”çš„ä¸»æœºç›®å½•åœ°å€</p><p>ä¸€èˆ¬æ˜¯ï¼š<code>/var/lib/docker/volumes/container-id/_data</code></p><h3 id="2ã€å®¹å™¨æ•°æ®å·"><a href="#2ã€å®¹å™¨æ•°æ®å·" class="headerlink" title="2ã€å®¹å™¨æ•°æ®å·"></a>2ã€å®¹å™¨æ•°æ®å·</h3><p>å‘½åçš„å®¹å™¨æŒ‚è½½æ•°æ®å·ï¼Œå…¶å®ƒå®¹å™¨é€šè¿‡æŒ‚è½½è¿™ä¸ª(çˆ¶å®¹å™¨)å®ç°æ•°æ®å…±äº«ï¼ŒæŒ‚è½½æ•°æ®å·çš„å®¹å™¨ï¼Œç§°ä¹‹ä¸ºæ•°æ®å·å®¹å™¨</p><p>å®¹å™¨ä¼ é€’å…±äº« <code>--volumes-from</code></p><p>æ¯”å¦‚ï¼šä»¥ä¸Šé¢çš„ <code>xiaocai/centos</code> ä¸ºæ¨¡æ¿å¯åŠ¨å®¹å™¨ dk_centos_01/dk_centos_02/dk_centos_03</p><p>å…ˆå¯åŠ¨çˆ¶å®¹å™¨ï¼š<code>dk_centos_01</code>ï¼Œç„¶ååœ¨åœ¨<code>/dataVolumeContainer2</code> ç›®å½•æ–°å¢å†…å®¹</p><p>å¯åŠ¨ï¼š<code>dk_centos_02</code>å’Œ<code>dk_centos_03</code></p><pre class=" language-bash"><code class="language-bash">docker run -it --name dk_centos_02 --volumes-from dk_centos_01 zzyy/centosdocker run -it --name dk_centos_03 --volumes-from dk_centos_01 zzyy/centos</code></pre><p>åœ¨<code>dk_centos_02</code>å’Œ<code>dk_centos_03</code>åˆ†åˆ«åœ¨<code>/dataVolumeContainer2</code>å„è‡ªæ–°å¢å†…å®¹<code>test2.txt</code>ã€<code>test3.txt</code></p><p>å›åˆ°<code>dk_centos_01</code>å¯ä»¥çœ‹åˆ°<code>dk_centos_02</code>å’Œ<code>dk_centos_03</code>å„è‡ªæ·»åŠ çš„éƒ½èƒ½å…±äº«äº†ã€‚</p><p>åˆ é™¤<code>dk_centos_01</code>ï¼Œ<code>dk_centos_02</code>ä¿®æ”¹å<code>dk_centos_03</code>ä¾ç„¶å¯ä»¥è®¿é—®ã€‚</p><p>æ–°å»º<code>dk_centos_04</code>ç»§æ‰¿<code>dk_centos_03</code>åå†åˆ é™¤<code>dk_centos_03</code>ï¼Œ<code>dk_centos_04</code>ä¹Ÿå·²ç»ç»§ç»­è®¿é—®å…±äº«ã€‚</p><p>ç»“è®ºï¼š<strong>å®¹å™¨ä¹‹é—´é…ç½®ä¿¡æ¯çš„ä¼ é€’ï¼Œæ•°æ®å·çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨å®ƒä¸ºæ­¢ã€‚</strong></p><h2 id="ä¸ƒã€DockerFileè§£æ"><a href="#ä¸ƒã€DockerFileè§£æ" class="headerlink" title="ä¸ƒã€DockerFileè§£æ"></a>ä¸ƒã€DockerFileè§£æ</h2><h3 id="1ã€DockerFileæ˜¯ä»€ä¹ˆ"><a href="#1ã€DockerFileæ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€DockerFileæ˜¯ä»€ä¹ˆ"></a>1ã€DockerFileæ˜¯ä»€ä¹ˆ</h3><p>Dockerfileæ˜¯ç”¨æ¥æ„å»ºD1ockeré•œåƒçš„æ„å»ºæ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ã€‚</p><p>ä¸€èˆ¬åˆ†ä¸‰æ­¥éª¤ï¼š</p><p>ï¼ˆ1ï¼‰ç¼–å†™DockerFileæ–‡ä»¶</p><p>ï¼ˆ2ï¼‰æ‰§è¡Œ docker build å‘½ä»¤ï¼Œä»å®¹å™¨ç”Ÿæˆé•œåƒ</p><p>ï¼ˆ3ï¼‰è¿è¡Œdocker run å‘½ä»¤ï¼Œè¿è¡Œæ–°çš„å®¹å™¨</p><p>æ¯”å¦‚centosçš„dockerfile æ–‡ä»¶ï¼Œåœ¨ï¼š<a href="https://github.com/CentOS/sig-cloud-instance-images/blob/f2788ce41161326a18420913b0195d1c6cfa1581/docker/Dockerfile" target="_blank" rel="noopener">https://github.com/CentOS/sig-cloud-instance-images/blob/f2788ce41161326a18420913b0195d1c6cfa1581/docker/Dockerfile</a></p><pre><code>FROM scratchADD centos-7-x86_64-docker.tar.xz /LABEL \org.label-schema.schema-version=&quot;1.0&quot; \org.label-schema.name=&quot;CentOS Base Image&quot; \org.label-schema.vendor=&quot;CentOS&quot; \org.label-schema.license=&quot;GPLv2&quot; \org.label-schema.build-date=&quot;20200809&quot; \org.opencontainers.image.title=&quot;CentOS Base Image&quot; \org.opencontainers.image.vendor=&quot;CentOS&quot; \org.opencontainers.image.licenses=&quot;GPL-2.0-only&quot; \org.opencontainers.image.created=&quot;2020-08-09 00:00:00+01:00&quot;CMD [&quot;/bin/bash&quot;]</code></pre><h3 id="2ã€DockerFileæ„å»ºè¿‡ç¨‹"><a href="#2ã€DockerFileæ„å»ºè¿‡ç¨‹" class="headerlink" title="2ã€DockerFileæ„å»ºè¿‡ç¨‹"></a>2ã€DockerFileæ„å»ºè¿‡ç¨‹</h3><p>DockerFile å†…å®¹åŸºæœ¬è®¤è¯†ï¼š</p><p>ï¼ˆ1ï¼‰æ¯æ¡ä¿ç•™å­—æŒ‡ä»¤éƒ½å¿…é¡»ä¸ºå¤§å†™å­—æ¯ä¸”åé¢è¦è·Ÿéšè‡³å°‘ä¸€ä¸ªå‚æ•°</p><p>ï¼ˆ2ï¼‰æŒ‡ä»¤æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºæ‰§è¡Œã€‚</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨ <code>#</code> è¡¨ç¤ºæ³¨é‡Š</p><p>ï¼ˆ4ï¼‰æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚ï¼Œå¹¶å¯¹é•œåƒè¿›è¡Œæäº¤ã€‚ï¼ˆå‚è€ƒDockeråŸç†ï¼‰</p><p>Dockeræ‰§è¡ŒDockerFile ä¸»è¦åŸºæœ¬æµç¨‹ï¼š</p><p>ï¼ˆ1ï¼‰dockerä»åŸºç¡€é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨ã€‚</p><p>ï¼ˆ2ï¼‰æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å¹¶å¯¹å®¹å™¨ä½œå‡ºä¿®æ”¹ã€‚</p><p>ï¼ˆ3ï¼‰æ‰§è¡Œç±»ä¼¼<code>docker commit</code>çš„æ“ä½œæäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚</p><p>ï¼ˆ4ï¼‰dockerå†åŸºäºåˆšæäº¤çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°å®¹å™¨</p><p>ï¼ˆ5ï¼‰æ‰§è¡Œdockerfileä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ç›´åˆ°æ‰€æœ‰æŒ‡ä»¤éƒ½æ‰§è¡Œå®Œæˆ</p><blockquote><p>ä»åº”ç”¨è½¯ä»¶çš„è§’åº¦æ¥çœ‹ï¼ŒDockerfileã€Dockeré•œåƒä¸Dockerå®¹å™¨åˆ†åˆ«ä»£è¡¨è½¯ä»¶çš„ä¸‰ä¸ªä¸åŒé˜¶æ®µï¼Œ</p><ul><li>Dockerfileæ˜¯è½¯ä»¶çš„åŸææ–™</li><li>Dockeré•œåƒæ˜¯è½¯ä»¶çš„äº¤ä»˜å“</li><li>Dockerå®¹å™¨åˆ™å¯ä»¥è®¤ä¸ºæ˜¯è½¯ä»¶çš„è¿è¡Œæ€ã€‚<br>Dockerfileé¢å‘å¼€å‘ï¼ŒDockeré•œåƒæˆä¸ºäº¤ä»˜æ ‡å‡†ï¼ŒDockerå®¹å™¨åˆ™æ¶‰åŠéƒ¨ç½²ä¸è¿ç»´ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ï¼ŒåˆåŠ›å……å½“Dockerä½“ç³»çš„åŸºçŸ³ã€‚</li></ul><p>1 Dockerfileï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªDockerfileï¼ŒDockerfileå®šä¹‰äº†è¿›ç¨‹éœ€è¦çš„ä¸€åˆ‡ä¸œè¥¿ã€‚Dockerfileæ¶‰åŠçš„å†…å®¹åŒ…æ‹¬æ‰§è¡Œä»£ç æˆ–è€…æ˜¯æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€ä¾èµ–åŒ…ã€è¿è¡Œæ—¶ç¯å¢ƒã€åŠ¨æ€é“¾æ¥åº“ã€æ“ä½œç³»ç»Ÿçš„å‘è¡Œç‰ˆã€æœåŠ¡è¿›ç¨‹å’Œå†…æ ¸è¿›ç¨‹(å½“åº”ç”¨è¿›ç¨‹éœ€è¦å’Œç³»ç»ŸæœåŠ¡å’Œå†…æ ¸è¿›ç¨‹æ‰“äº¤é“ï¼Œè¿™æ—¶éœ€è¦è€ƒè™‘å¦‚ä½•è®¾è®¡namespaceçš„æƒé™æ§åˆ¶)ç­‰ç­‰;</p><p>2 Dockeré•œåƒï¼Œåœ¨ç”¨Dockerfileå®šä¹‰ä¸€ä¸ªæ–‡ä»¶ä¹‹åï¼Œdocker buildæ—¶ä¼šäº§ç”Ÿä¸€ä¸ªDockeré•œåƒï¼Œå½“è¿è¡Œ Dockeré•œåƒæ—¶ï¼Œä¼šçœŸæ­£å¼€å§‹æä¾›æœåŠ¡;</p><p>3 Dockerå®¹å™¨ï¼Œå®¹å™¨æ˜¯ç›´æ¥æä¾›æœåŠ¡çš„ã€‚</p></blockquote><h3 id="3ã€DockerFile-æŒ‡ä»¤"><a href="#3ã€DockerFile-æŒ‡ä»¤" class="headerlink" title="3ã€DockerFile æŒ‡ä»¤"></a>3ã€DockerFile æŒ‡ä»¤</h3><table><thead><tr><th>æŒ‡ä»¤</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>FROM</td><td>åŸºç¡€é•œåƒï¼Œå½“å‰é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„</td></tr><tr><td>MAINTAINER</td><td>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€</td></tr><tr><td>RUN</td><td>å®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤</td></tr><tr><td>EXPOSE</td><td>å½“å‰å®¹å™¨å¯¹å¤–æš´éœ²çš„ç«¯å£</td></tr><tr><td>WORKDIR</td><td>æŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»å½•è¿›å…¥çš„å·¥ä½œç›®å½•</td></tr><tr><td>ENV</td><td>æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</td></tr><tr><td>ADD</td><td>å°†æŒ‡å®šå®¿ä¸»æœºç›®å½•æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ADDå‘½ä»¤ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹tarå‹ç¼©åŒ…</td></tr><tr><td>COPY</td><td>ç±»ä¼¼ADDï¼Œæ‹·è´æ–‡ä»¶åˆ°ç›®å½•åˆ°é•œåƒä¸­ã€‚å°†æ„å»ºä¸Šä¸‹æ–‡ç›®å½•çš„æ–‡ä»¶å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚é•œåƒå†…çš„ç›®å½•è·¯å¾„ã€‚<code>COPY src  dest</code>, <code>COPY [&quot;src&quot;,&quot;dest&quot;]</code></td></tr><tr><td>VOLUME</td><td>å®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ</td></tr><tr><td>CMD</td><td>æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ã€‚<br/>Dockerfile ä¸­å¯ä»¥æœ‰å¤šä¸ª CMD æŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMD ä¼šè¢« docker run ä¹‹åçš„å‚æ•°æ›¿æ¢</td></tr><tr><td>ENTRYPOINT</td><td>æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ã€‚<br/> ENTRYPOINT çš„ç›®çš„ å’Œ CMD å‘½ä»¤ ä¸€æ ·ï¼Œéƒ½æ˜¯æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå‚æ•°</td></tr><tr><td>ONBUILD</td><td>å½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿çš„DockerFile æ—¶è¿è¡Œå‘½ä»¤ï¼Œçˆ¶é•œåƒåœ¨è¢«å­ç»§æ‰¿åçˆ¶é•œåƒçš„onbuildè¢«è§¦å‘</td></tr></tbody></table><p><code>FROM  scratch</code> ï¼šå¤§å¤šæ•°é•œåƒéƒ½æ˜¯é€šè¿‡base é•œåƒï¼ˆ<code>scratch</code>ï¼‰ä¸­å®‰è£…é…ç½®éœ€è¦çš„è½¯ä»¶æ„å»ºå‡ºæ¥ã€‚</p><p>CMD æŒ‡ä»¤çš„æ ¼å¼å’Œ RUN ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ä¸¤ç§æ ¼å¼ï¼š</p><p>ï¼ˆ1ï¼‰shell æ ¼å¼ï¼š<code>CMD &lt;å‘½ä»¤&gt;</code></p><p>ï¼ˆ2ï¼‰exec æ ¼å¼ï¼š<code>CMD [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;ï¼Œ&quot;å‚æ•°1&quot;,&quot;å‚æ•°2&quot;...]</code> </p><p>å‚æ•°åˆ—è¡¨çš„æ ¼å¼ï¼š<code>CMD [&quot;å‚æ•°1&quot;,&quot;å‚æ•°2&quot;...]</code> åœ¨æŒ‡å®šäº† ENTRYPOINT æŒ‡ä»¤åï¼Œç”¨CMD æŒ‡å®šå…·ä½“çš„å‚æ•°ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/docker/docker-dockerfile.jpg" alt="DockerFile"></p><p><strong>Dockerfile æŒ‡ä»¤åˆ†ç±»</strong></p><table><thead><tr><th>BUILD</th><th>BOTH</th><th>RUN</th></tr></thead><tbody><tr><td>FROM</td><td>WORKDIR</td><td>CMD</td></tr><tr><td>MAINTAINER</td><td>USER</td><td>ENV</td></tr><tr><td>COPY</td><td></td><td>EXPOSE</td></tr><tr><td>ADD</td><td></td><td>VOLUME</td></tr><tr><td>RUN</td><td></td><td>ENTRYPOINT</td></tr><tr><td>ONBUILD</td><td></td><td></td></tr><tr><td>.dockerignore</td><td></td><td></td></tr></tbody></table><h3 id="4ã€DockerFile-å­¦ä¹ ç¤ºä¾‹"><a href="#4ã€DockerFile-å­¦ä¹ ç¤ºä¾‹" class="headerlink" title="4ã€DockerFile å­¦ä¹ ç¤ºä¾‹"></a>4ã€DockerFile å­¦ä¹ ç¤ºä¾‹</h3><h4 id="ç¼–å†™Dockerfile-ç¤ºä¾‹ä¸€ï¼š"><a href="#ç¼–å†™Dockerfile-ç¤ºä¾‹ä¸€ï¼š" class="headerlink" title="ç¼–å†™Dockerfile ç¤ºä¾‹ä¸€ï¼š"></a>ç¼–å†™Dockerfile ç¤ºä¾‹ä¸€ï¼š</h4><p>ä¸‹è½½çš„centosé•œåƒï¼Œæ–°å»ºå¹¶è¿è¡Œå®¹å™¨ï¼Œé»˜è®¤çš„centos æ˜¯ä¸èƒ½æ‰§è¡Œ <code>ifconfig</code> ã€<code>vim</code>ã€ <code>rz</code> ã€<code>sz</code> ç­‰å‘½ä»¤ã€‚ç°åœ¨ç¼–å†™ä¸€ä¸ªdockerfile ç”¨æ¥æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„centos å®¹å™¨å–åä¸º <code>xiaocai_centos</code></p><p>ï¼ˆ1ï¼‰ä¸‹è½½centos é•œåƒ</p><pre class=" language-bash"><code class="language-bash">docker pull centos</code></pre><p>ï¼ˆ2ï¼‰ä»¥centosä¸ºé•œåƒæ¨¡æ¿å¯åŠ¨å®¹å™¨å¹¶è¿›å…¥å®¹å™¨</p><pre class=" language-bash"><code class="language-bash">docker run -it centos</code></pre><p>å¯ä»¥å°è¯•æ‰§è¡Œä¸Šè¿°æ‰€è¯´ä¸èƒ½æ‰§è¡Œçš„å‘½ä»¤ï¼Œç¡®è®¤ç°åœ¨æ˜¯å¦å¯ä»¥æ‰§è¡Œï¼Œå…¶å®æ˜¯ä¸èƒ½æ‰§è¡Œçš„ã€‚</p><p>ï¼ˆ3ï¼‰ç¼–å†™DockerFile æ–‡ä»¶</p><pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> -p xiaocai/dockerfiles<span class="token function">cd</span> /xiaocai/dockerfiles<span class="token function">vi</span> Dockerfile</code></pre><p>Dockerfile å†…å®¹å¦‚ä¸‹ï¼š</p><pre class=" language-txt"><code class="language-txt">FROM centosMAINTAINER xiaocai<smallrose@qq.com>RUN yum -y install vimRUN yum -y install net-toolsRUN yum -y install lrzszENV MYPATH /usr/localWORKDIR $MYPATH</code></pre><p>ä¿å­˜æ–‡ä»¶ã€‚</p><p>ï¼ˆ4ï¼‰æ„å»ºå‡ºæ–°çš„é•œåƒ</p><pre><code>docker build -t xiaocai_centos:1.1</code></pre><p>æœ€åˆå‡ºç° <code>successfully build</code> å­—æ ·è¡¨ç¤ºæ„å»ºæˆåŠŸã€‚</p><p>ï¼ˆ5ï¼‰è¿è¡Œæ–°çš„é•œåƒ</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># å¯ä»¥å…ˆæŸ¥çœ‹æœ¬åœ°é•œåƒ</span>docker images<span class="token comment" spellcheck="true"># ä»¥äº¤äº’æ–¹å¼è¿è¡Œæ–°çš„é•œåƒ</span>docker run -it xiaocai_centos:1.1</code></pre><p>æ­¤æ—¶ï¼Œå¦‚æœæ­£å¸¸å¯ä»¥æ‰§è¡Œ<code>ifconfig</code>  <code>vim</code>å‘½ä»¤ï¼Œå¦‚æœä½ åœ¨windowsæœºå™¨ä½¿ç”¨SSHé“¾æ¥å·¥å…·ï¼Œæ‰§è¡Œ <code>rz</code> å‘½ä»¤ï¼Œä¼šå¼¹å‡ºé€‰æ‹©æ–‡ä»¶çš„çª—å£ã€‚</p><p>ï¼ˆ6ï¼‰åˆ—å‡ºé•œåƒçš„å˜æ›´å†å²</p><pre><code>docker history centos</code></pre><h4 id="ç¼–å†™Dockerfile-ç¤ºä¾‹äºŒï¼š"><a href="#ç¼–å†™Dockerfile-ç¤ºä¾‹äºŒï¼š" class="headerlink" title="ç¼–å†™Dockerfile ç¤ºä¾‹äºŒï¼š"></a>ç¼–å†™Dockerfile ç¤ºä¾‹äºŒï¼š</h4><p><code>CMD / ENTRYPOINT</code> éƒ½æ˜¯æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ã€‚</p><p><strong><code>CMD</code>ï¼š</strong></p><p>åœ¨Dockerfile ä¸­å¯ä»¥æœ‰å¤šä¸ª CMD æŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMD ä¼šè¢« docker run ä¹‹åçš„å‚æ•°æ›¿æ¢ã€‚</p><p>å¦‚åœ¨centos é•œåƒä¸­ï¼Œæœ€åä¸€ä¸ªCMD æ˜¯ <code>CMD [&quot;/bin/bash&quot;]</code></p><p>ç°åœ¨ä»¥é»˜è®¤çš„centosä¸ºé•œåƒæ¨¡æ¿è¿è¡Œä¸€ä¸ªcentos å®ä¾‹ï¼š</p><pre class=" language-bash"><code class="language-bash">docker run -it -p 8888:8080 tomcat <span class="token function">ls</span> -l</code></pre><p>è¿™é‡Œ<code>CMD [&quot;/bin/bash&quot;]</code> ä¸ä¼šæ‰§è¡Œï¼Œè€Œæ˜¯è¢« <code>-it -p 8888:8080 tomcat ls -l</code> æ›¿æ¢ã€‚</p><p><strong>ENTRYPOINT ï¼š</strong></p><p>docker run ä¹‹åçš„å‚æ•°ä¼šè¢«å½“åšå‚æ•°ä¼ é€’ç»™ ENTRYPOINTï¼Œä¹‹åå½¢æˆæ–°çš„å‘½ä»¤ç»„åˆã€‚</p><p>åˆ¶ä½œCMDç‰ˆå¯ä»¥æŸ¥è¯¢IPä¿¡æ¯çš„å®¹å™¨ï¼Œä½¿ç”¨<code>curl</code> å‘½ä»¤</p><blockquote><p>curlå‘½ä»¤å¯ä»¥ç”¨æ¥æ‰§è¡Œä¸‹è½½ã€å‘é€å„ç§HTTPè¯·æ±‚ï¼ŒæŒ‡å®šHTTPå¤´éƒ¨ç­‰æ“ä½œã€‚</p><p>å¦‚æœç³»ç»Ÿæ²¡æœ‰curlå¯ä»¥ä½¿ç”¨<code>yum install curl</code>å®‰è£…ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½å®‰è£…ã€‚<br>curlæ˜¯å°†ä¸‹è½½æ–‡ä»¶è¾“å‡ºåˆ°<code>stdout</code></p><p>ä½¿ç”¨å‘½ä»¤ï¼š<code>curl http://www.baidu.com</code><br>æ‰§è¡Œåï¼Œ<a href="http://www.baidu.comçš„htmlå°±ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šäº†" target="_blank" rel="noopener">www.baidu.comçš„htmlå°±ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šäº†</a></p></blockquote><p>ï¼ˆ1ï¼‰æ–°å»ºä¸€ä¸ªç”¨ä½œæ„å»ºçš„æ–‡ä»¶å¤¹</p><pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> -p xiaocai/ipselect01<span class="token function">cd</span> xiaocai/ipselect01</code></pre><p>ï¼ˆ2ï¼‰ç¼–å†™Dockerfile æ–‡ä»¶</p><pre><code>vi Dockerfile</code></pre><p>æ–‡ä»¶å†…å®¹ï¼š</p><pre><code>FROM centosRUN yum install -y curlCMD [ &quot;curl&quot;, &quot;-s&quot;, &quot;http://ip.com&quot; ]</code></pre><p>ï¼ˆ3ï¼‰æ„å»ºæ–°é•œåƒ</p><pre><code>docker build -f Dockerfile -t ipselect01</code></pre><p>ï¼ˆ4ï¼‰è¿è¡Œæ–°é•œåƒçš„å®¹å™¨</p><pre class=" language-bash"><code class="language-bash">docker run  ipselect01</code></pre><p>ç›´æ¥è¿è¡Œåˆ™ä¼šé»˜è®¤æ‰§è¡ŒDockerfile æœ€åä¸€æ¡CMDï¼Œç»“æœè¿”å›IPä¿¡æ¯ã€‚</p><p>å¦‚æœå¸Œæœ›æ˜¾ç¤º HTTP å¤´ä¿¡æ¯ï¼Œå°±éœ€è¦åŠ ä¸Š<code>-i</code>å‚æ•°ï¼Œå³ï¼š<code>docker run  ipselect01  -i</code></p><p>ä½†æ˜¯å¦‚æœç›´æ¥æ‰§è¡Œå°±ä¼šæŠ¥é”™ï¼Œå› ä¸º <strong>å…è®¸å¤šä¸ª CMD æŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMD ä¼šè¢« docker run ä¹‹åçš„å‚æ•°æ›¿æ¢</strong>ã€‚</p><p>é‡æ–°ä½¿ç”¨ ENTRYPOINT é‡æ–°æ„å»ºæ–°çš„é•œåƒï¼š</p><p>ï¼ˆ1ï¼‰æ–°å»ºä¸€ä¸ªç”¨ä½œæ„å»ºçš„æ–‡ä»¶å¤¹</p><pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> -p xiaocai/ipselect02<span class="token function">cd</span> xiaocai/ipselect02</code></pre><p>ï¼ˆ2ï¼‰ç¼–å†™Dockerfile æ–‡ä»¶</p><pre><code>vi Dockerfile</code></pre><p>æ–‡ä»¶å†…å®¹ï¼š</p><pre><code>FROM centosRUN yum install -y curlENTRYPOINT  [ &quot;curl&quot;, &quot;-s&quot;, &quot;http://ip.com&quot; ]</code></pre><p>ï¼ˆ3ï¼‰æ„å»ºæ–°é•œåƒ</p><pre><code>docker build -f Dockerfile -t ipselect02</code></pre><p>ï¼ˆ4ï¼‰è¿è¡Œæ–°é•œåƒçš„å®¹å™¨</p><pre class=" language-bash"><code class="language-bash">docker run  ipselect02</code></pre><p>ç›´æ¥è¿è¡Œåˆ™ä¼šé»˜è®¤æ‰§è¡ŒDockerfile æœ€åä¸€æ¡CMDï¼Œç»“æœè¿”å›IPä¿¡æ¯ã€‚</p><p>ï¼ˆ5ï¼‰å‚æ•°æ‰§è¡ŒéªŒè¯</p><p>å¸¦ä¸Šå‚æ•°è¿è¡Œï¼š</p><pre class=" language-bash"><code class="language-bash">docker run  ipselect02 -i</code></pre><p>æ­¤æ—¶å¦‚æœæ­£å¸¸ï¼Œå¯ä»¥çœ‹åˆ°æ˜¾ç¤º HTTP å¤´ä¿¡æ¯ã€‚</p><h4 id="ç¼–å†™Dockerfile-ç¤ºä¾‹ä¸‰ï¼š"><a href="#ç¼–å†™Dockerfile-ç¤ºä¾‹ä¸‰ï¼š" class="headerlink" title="ç¼–å†™Dockerfile ç¤ºä¾‹ä¸‰ï¼š"></a>ç¼–å†™Dockerfile ç¤ºä¾‹ä¸‰ï¼š</h4><p>è‡ªå·±æ„å»ºä¸€ä¸ªtomcatçš„é•œåƒï¼Œå…ˆä¸‹è½½å¥½tomcatçš„taråŒ…ï¼Œå’Œjdkçš„tar åŒ…ï¼Œcentosç¯å¢ƒã€‚</p><p>ï¼ˆ1ï¼‰æ–°å»ºä¸€ä¸ªç”¨ä½œæ„å»ºçš„æ–‡ä»¶å¤¹</p><pre><code>mkdir -p xiaocai/tomcat9cd xiaocai/tomcat9touch test_copy.txt</code></pre><p>ï¼ˆ2ï¼‰å°†jdk å’Œ tomcat å®‰è£…çš„å‹ç¼©åŒ…æ‹·è´åˆ° <code>/xiaocai/tomcat9</code> ï¼Œå¹¶åœ¨ç›®å½•ä¸‹æ–°å»ºDockerfile æ–‡ä»¶ã€‚</p><p>åˆ°æ­¤ä¸€æ­¥ï¼Œé‚£ä¹ˆ<code>/xiaocai/tomcat9</code> ç›®å½•æœ‰å››ä¸ªæ–‡ä»¶ï¼š</p><ul><li>test_copy.txt</li><li>jdkçš„taråŒ… ï¼ˆjdk-8u171-linux-x64.tar.gzï¼‰</li><li>tomcatçš„taråŒ…ï¼ˆapache-tomcat-9.0.8.tar.gzï¼‰</li><li>Dockerfile æ–‡ä»¶</li></ul><p>ï¼ˆ3ï¼‰ç¼–å†™Dockerfileï¼Œ å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code># è¡¨ç¤ºåŸºäº centos å¼€å§‹æ„å»ºFROM         centosMAINTAINER    xiaocai&lt;smallrose@1qq.com&gt;#æŠŠå®¿ä¸»æœºå½“å‰ä¸Šä¸‹æ–‡çš„test_tomcat.txtæ‹·è´åˆ°å®¹å™¨/usr/local/è·¯å¾„ä¸‹COPY test_copy.txt /usr/local/test_copy_container.txt#æŠŠjavaä¸tomcatæ·»åŠ åˆ°å®¹å™¨ä¸­ADD jdk-8u171-linux-x64.tar.gz /usr/local/ADD apache-tomcat-9.0.8.tar.gz /usr/local/#å®‰è£…vimç¼–è¾‘å™¨RUN yum -y install vim#å®‰è£…ç½‘ç»œå·¥å…·RUN yum -y install net-tools#è®¾ç½®å·¥ä½œè®¿é—®æ—¶å€™çš„WORKDIRè·¯å¾„ï¼Œç™»å½•è½è„šç‚¹ENV MYPATH /usr/localWORKDIR $MYPATH#é…ç½®javaä¸tomcatç¯å¢ƒå˜é‡ENV JAVA_HOME /usr/local/jdk1.8.0_171ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarENV CATALINA_HOME /usr/local/apache-tomcat-9.0.8ENV CATALINA_BASE /usr/local/apache-tomcat-9.0.8ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin#å®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç«¯å£EXPOSE  8080#å¯åŠ¨æ—¶è¿è¡Œtomcat# ENTRYPOINT [&quot;/usr/local/apache-tomcat-9.0.8/bin/startup.sh&quot; ]# CMD [&quot;/usr/local/apache-tomcat-9.0.8/bin/catalina.sh&quot;,&quot;run&quot;]#å¯åŠ¨å€¼å¯ä»¥ç›´æ¥æ‰“å°å‡ºtomcatæ—¥å¿—CMD /usr/local/apache-tomcat-9.0.8/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.8/bin/logs/catalina.out</code></pre><p>ï¼ˆ4ï¼‰æ„å»ºæ–°çš„é•œåƒ</p><pre class=" language-bash"><code class="language-bash">docker build -t xiaocai_tomcat:2.0docker images</code></pre><p>ï¼ˆ5ï¼‰è¿è¡Œæ–°çš„é•œåƒ</p><pre class=" language-bash"><code class="language-bash">docker run -d -p 9080:8080 --name xiaocai_tomcat9 -v /xiaocai/tomcat9/test:/usr/local/apache-tomcat-9.0.8/webapps/test -v /xiaocai/tomcat9/tomcat9logs/:/usr/local/apache-tomcat-9.0.8/logs --privileged<span class="token operator">=</span>true xiaocai_tomcat:2.0</code></pre><p>è¿™é‡Œå°†å®¿ä¸»æœºçš„<code>/xiaocai/tomcat9/test</code> ç›®å½•ä¸å®¹å™¨<code>/usr/local/apache-tomcat-9.0.8/webapps/test</code>é¡¹ç›®éƒ¨ç½²ç›®å½•æ˜ å°„å°±æ˜¯ä¸ºäº†æ–¹ä¾¿éƒ¨ç½²é¡¹ç›®ã€‚</p><p>ï¼ˆ6ï¼‰éªŒè¯è®¿é—®</p><p>åœ¨ <code>/xiaocai/tomcat9/test</code> ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªhtml æˆ– jsp ï¼Œç„¶åè®¿é—®tomcatï¼Œä¸å‡ºé”™çš„è¯å¯ä»¥çœ‹åˆ°é¡µé¢ã€‚</p><p>å¦‚æœä¸æƒ³å»ºé¡µé¢ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®tomcat çš„é¡µé¢ã€‚</p><h2 id="å…«ã€Docker-å¸¸ç”¨å®‰è£…"><a href="#å…«ã€Docker-å¸¸ç”¨å®‰è£…" class="headerlink" title="å…«ã€Docker å¸¸ç”¨å®‰è£…"></a>å…«ã€Docker å¸¸ç”¨å®‰è£…</h2><p>å¸¸ç”¨çš„å®‰è£…æ¯”å¦‚ï¼šmysqlã€tomcatã€redis</p><p>åŸºæœ¬å®‰è£…æ­¥éª¤ï¼š</p><p>ï¼ˆ1ï¼‰æœç´¢é•œåƒ</p><p>ï¼ˆ2ï¼‰æ‹‰å–é•œåƒ</p><p>ï¼ˆ3ï¼‰æŸ¥çœ‹é•œåƒ</p><p>ï¼ˆ4ï¼‰å¯åŠ¨é•œåƒå®ä¾‹</p><p>ï¼ˆ5ï¼‰åœæ­¢å®¹å™¨</p><p>ï¼ˆ6ï¼‰åˆ é™¤å®¹å™¨</p><h3 id="1ã€å®‰è£…tocmat"><a href="#1ã€å®‰è£…tocmat" class="headerlink" title="1ã€å®‰è£…tocmat"></a>1ã€å®‰è£…tocmat</h3><p>ï¼ˆ1ï¼‰æœç´¢tomcat </p><p>åœ¨docker hub æ‰¾åˆ°éœ€è¦çš„tomcatåŠç‰ˆæœ¬</p><pre class=" language-bash"><code class="language-bash">docker search tomcat</code></pre><p>ï¼ˆ2ï¼‰æ‹‰å–tomcat é•œåƒ</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># é»˜è®¤æ‹‰å–æœ€æ–°ç‰ˆ</span>docker pull tomcat<span class="token comment" spellcheck="true"># æ‹‰å–ç‰¹ç‚¹ç‰ˆæœ¬çš„</span>docker pull tomcat:7.0</code></pre><p>ï¼ˆ3ï¼‰æŸ¥çœ‹é•œåƒ</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># æŸ¥çœ‹é•œåƒ</span>docker images </code></pre><p>ï¼ˆ4ï¼‰ä½¿ç”¨tomcaté•œåƒåˆ›å»ºå®¹å™¨å®ä¾‹</p><pre><code>docker run -it -p 8080:8080 tomcat</code></pre><ul><li><p><strong>-i</strong> ï¼šäº¤äº’</p></li><li><p><strong>-t</strong> ï¼šç»ˆç«¯</p></li><li><p><strong>-p</strong> ï¼šç«¯å£æ˜ å°„ï¼Œä¸»æœºç«¯å£: å®¹å™¨ç«¯å£</p></li><li><p><strong>-P</strong> ï¼šéšæœºç«¯å£</p></li></ul><h3 id="2ã€å®‰è£…mysql"><a href="#2ã€å®‰è£…mysql" class="headerlink" title="2ã€å®‰è£…mysql"></a>2ã€å®‰è£…mysql</h3><p>ï¼ˆ1ï¼‰æœç´¢mysql</p><p>åœ¨docker hub æ‰¾åˆ°éœ€è¦çš„mysqlåŠç‰ˆæœ¬</p><pre class=" language-bash"><code class="language-bash">docker search mysql</code></pre><p>ï¼ˆ2ï¼‰æ‹‰å–mysqlé•œåƒ</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># é»˜è®¤æ‹‰å–æœ€æ–°ç‰ˆ</span>docker pull mysql<span class="token comment" spellcheck="true"># æ‹‰å–ç‰¹ç‚¹ç‰ˆæœ¬çš„</span>docker pull mysql:5.7</code></pre><p>ï¼ˆ3ï¼‰æŸ¥çœ‹é•œåƒ</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># æŸ¥çœ‹é•œåƒ</span>docker images </code></pre><p>ï¼ˆ4ï¼‰ä½¿ç”¨mysqlé•œåƒåˆ›å»ºå®¹å™¨å®ä¾‹</p><pre class=" language-bash"><code class="language-bash">docker run -p 3306:3306 --name mysql -v /xiaocai/mysql/conf:/etc/mysql/conf.d -v /xiaocai/mysql/logs:/logs -v /xiaocai/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>123456 -d mysql:5.7</code></pre><p>å‘½ä»¤è¯´æ˜ï¼š<br><code>-p 3306:3306</code>ï¼šå°†ä¸»æœºçš„3306ç«¯å£æ˜ å°„åˆ°dockerå®¹å™¨çš„3306ç«¯å£ã€‚<br><code>--name mysql</code>ï¼šè¿è¡ŒæœåŠ¡åå­—<br><code>-v /xiaocai/mysql/conf:/etc/mysql/conf.d</code>ï¼šå°†ä¸»æœº<code>/xiaocai/mysql</code>å½•ä¸‹çš„conf/my.cnf æŒ‚è½½åˆ°å®¹å™¨çš„ <code>/etc/mysql/conf.d</code>ç›®å½•<br><code>-v /xiaocai/mysql/logs:/logs</code>ï¼šå°†ä¸»æœº/xiaocai/mysqlç›®å½•ä¸‹çš„ logs ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ /logsã€‚<br><code>-v /xiaocai/mysql/data:/var/lib/mysql</code> ï¼šå°†ä¸»æœº/xiaocai/mysqlç›®å½•ä¸‹çš„dataç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ /var/lib/mysql<br><code>-e MYSQL_ROOT_PASSWORD=123456</code>ï¼šåˆå§‹åŒ– root ç”¨æˆ·çš„å¯†ç ã€‚<br><code>-d mysql:5.7</code>: åå°ç¨‹åºè¿è¡Œmysql5.7</p><p>æ£€æŸ¥mysqlå®¹å™¨è¿è¡Œ</p><pre class=" language-bash"><code class="language-bash">docker <span class="token function">ps</span> -a</code></pre><p>å¦‚æœä½¿ç”¨å‘½ä»¤è¡Œç™»å½•mysqlï¼Œåˆ™é¦–å…ˆè¿›å…¥å®¹å™¨ï¼š</p><pre class=" language-bash"><code class="language-bash">docker <span class="token function">exec</span> -it MySQLè¿è¡ŒæˆåŠŸåçš„å®¹å™¨ID   /bin/bash</code></pre><p>è¿›è¡Œå®¹å™¨ä¹‹åå¯ä»¥ä½¿ç”¨ <code>mysql -u -p</code>çš„å‘½ä»¤è¿›è¡Œç™»å½•æ“ä½œã€‚</p><p>åœ¨å®¿ä¸»æœºç›´æ¥æ‰§è¡Œå‘½ä»¤è¿›è¡Œæ•°æ®å¤‡ä»½ï¼š</p><pre class=" language-bash"><code class="language-bash">docker <span class="token function">exec</span> myqlæœåŠ¡å®¹å™¨ID sh -c <span class="token string">' exec mysqldump --all-databases -uroot -p"123456" '</span> <span class="token operator">></span> /xiaocai/all-databases.sql</code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨mysqlå®¢æˆ·ç«¯è¿æ¥ï¼Œæ³¨æ„å®¿ä¸»æœºç«¯å£ã€‚</p><h3 id="2ã€å®‰è£…redis"><a href="#2ã€å®‰è£…redis" class="headerlink" title="2ã€å®‰è£…redis"></a>2ã€å®‰è£…redis</h3><p>ï¼ˆ1ï¼‰æœç´¢redis</p><p>åœ¨docker hub æ‰¾åˆ°éœ€è¦çš„redisåŠç‰ˆæœ¬</p><pre class=" language-bash"><code class="language-bash">docker search redis</code></pre><p>ï¼ˆ2ï¼‰æ‹‰å–redisé•œåƒ</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># é»˜è®¤æ‹‰å–æœ€æ–°ç‰ˆ</span>docker pull redis<span class="token comment" spellcheck="true"># æ‹‰å–ç‰¹ç‚¹ç‰ˆæœ¬çš„</span>docker pull redis:3.2</code></pre><p>ï¼ˆ3ï¼‰æŸ¥çœ‹é•œåƒ</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># æŸ¥çœ‹é•œåƒ</span>docker images </code></pre><p>ï¼ˆ4ï¼‰ä½¿ç”¨redisé•œåƒåˆ›å»ºå®¹å™¨å®ä¾‹</p><pre class=" language-bash"><code class="language-bash">docker run -p 6379:6379 -v /xiaocai/myredis/data:/data -v /xiaocai/myredis/conf/redis.conf:/usr/local/etc/redis/redis.conf  -d redis:3.2 redis-server /usr/local/etc/redis/redis.conf --appendonly <span class="token function">yes</span></code></pre><p>åœ¨ä¸»æœº/xiaocai/myredis/conf/redis.confç›®å½•ä¸‹æ–°å»ºredis.confæ–‡ä»¶</p><pre class=" language-bash"><code class="language-bash">vim /xiaocai/myredis/conf/redis.conf/redis.conf</code></pre><p>æ–‡ä»¶å†…å®¹ï¼š</p><p><a href="/images/docker/redis.conf">redis.conf</a></p><p>ï¼ˆ5ï¼‰æµ‹è¯•è¿æ¥</p><pre><code>docker exec -it è¿è¡Œç€RediisæœåŠ¡çš„å®¹å™¨ID redis-cli</code></pre><p>æ‰§è¡Œredis çš„<code>set/get</code>å‘½ä»¤è¿›è¡Œæ•°æ®ä¿å­˜æŸ¥è¯¢æ“ä½œã€‚</p><p>ï¼ˆ6ï¼‰æŒä¹…åŒ–éªŒè¯</p><p>æ‰§è¡Œ<code>shutdown</code> åœæ­¢redis</p><p>è¿›å…¥<code>/xiaocai/myredis/data</code>ç›®å½•æŸ¥çœ‹æŒä¹…åŒ–æ–‡ä»¶ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Matery æ·»åŠ WebStackPageå¯¼èˆªç½‘ç«™</title>
      <link href="/posts/38b34c3c.html"/>
      <url>/posts/38b34c3c.html</url>
      
        <content type="html"><![CDATA[<h2 id="Matery-æ·»åŠ WebStackPageå¯¼èˆªç½‘ç«™"><a href="#Matery-æ·»åŠ WebStackPageå¯¼èˆªç½‘ç«™" class="headerlink" title="Matery æ·»åŠ WebStackPageå¯¼èˆªç½‘ç«™"></a>Matery æ·»åŠ WebStackPageå¯¼èˆªç½‘ç«™</h2><p>è¿™ä¸ªå§‘å¨˜å·²ç»æ·»åŠ å¾ˆä¹…äº†ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨åˆ«çš„å°ä¼™ä¼´çš„åšå®¢å‘ç°çš„ï¼Œå°±æ‹¿è¿‡æ¥ç”¨äº†ã€‚</p><p><strong>å…ˆçœ‹æ•ˆæœ</strong></p><p>æˆ‘çš„æ•ˆæœåœ¨è¿™é‡Œï¼š<a href="https://zhangxiaocai.cn/box/cn/index.html" target="_blank" rel="noopener">å°èœå¯¼èˆª</a></p><h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h2><p>WebStackPage æ˜¯ä¸€ä½åå« Viggo çš„UIè®¾è®¡å¸ˆçš„å…¬ç›Šé¡¹ç›®ï¼Œå¼€æºçš„é™æ€ç½‘ç«™ï¼Œæºç æœ¬èº«å°±æ˜¯æˆå“ï¼Œä¸‹è½½ä»£ç ä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><p>å®˜æ–¹é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/WebStackPage/WebStackPage.github.io" target="_blank" rel="noopener">WebStackPage</a></p><h2 id="äºŒã€Matery-æ·»åŠ -WebStackPage"><a href="#äºŒã€Matery-æ·»åŠ -WebStackPage" class="headerlink" title="äºŒã€Matery æ·»åŠ  WebStackPage"></a>äºŒã€Matery æ·»åŠ  WebStackPage</h2><p>å¦‚æœä½ æ²¡æœ‰åšå®¢ï¼Œåªæƒ³æä¸ªå¯¼èˆªï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç›´æ¥æŠŠç›¸å…³ä»£ç æ”¾åˆ°ä½ çš„github æˆ–è€… ç äº‘ç­‰ä»“åº“ä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥è®¿é—®äº†ã€‚</p><p>å¦‚æœæ˜¯Hexoåšå®¢ï¼Œæˆ‘æ˜¯è¿™ä¹ˆæ“ä½œçš„ï¼š</p><h3 id="1ã€ä¸‹è½½ä»£ç "><a href="#1ã€ä¸‹è½½ä»£ç " class="headerlink" title="1ã€ä¸‹è½½ä»£ç "></a>1ã€ä¸‹è½½ä»£ç </h3><p>ä»å®˜æ–¹é¡¹ç›®åœ°å€å…‹éš†ä¸‹åˆ°æœ¬åœ°å³å¯ï¼š</p><p>ä½¿ç”¨å‘½ä»¤</p><pre class=" language-bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/WebStackPage/WebStackPage.github.io </code></pre><p>æˆ–è€…ä½¿ç”¨æµè§ˆå™¨ä¸‹è½½å‡å¯ã€‚</p><h3 id="2ã€æ”¾å…¥Hexo"><a href="#2ã€æ”¾å…¥Hexo" class="headerlink" title="2ã€æ”¾å…¥Hexo"></a>2ã€æ”¾å…¥Hexo</h3><p>åœ¨ <code>hexo</code> æ ¹ç›®å½•çš„ <code>source</code>  ç›®å½•ä¸‹ æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ box ï¼ˆåå­—å¯ä»¥è‡ªå·±å–ï¼Œæ²¡æœ‰è¦æ±‚ï¼‰,è¿™ä¸ª <code>box</code> ç›®å½•ä¼šå’Œ <code>_post</code>ã€<code>about</code> éƒ½å¤„åœ¨åŒä¸€å±‚ç›®å½•ã€‚</p><h3 id="3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>ï¼ˆ1ï¼‰ä¿®æ”¹ Hexo æ ¹ç›®å½•çš„é…ç½®æ–‡ä»¶ <code>_config.yml</code></p><p>å› ä¸ºhexo ç¼–è¯‘ä¼šå¯¹ä¸»é¢˜æ¨¡æ¿è¿›è¡Œæ¸²æŸ“ä¹‹åç”Ÿæˆé™æ€é¡µé¢ï¼Œä½†æ˜¯è¿™ä¸ªå¯¼èˆªçš„ç½‘ç«™æœ¬èº«å°±æ˜¯ <code>html</code>æ–‡ä»¶ï¼Œå› æ­¤ä¸éœ€è¦æ¸²æŸ“ï¼Œé‚£ä¹ˆè·³è¿‡æ¸²æŸ“å°±éœ€è¦é…ç½® <code>skip_render</code> é¡¹ï¼Œå¦‚æœä½ æ²¡æœ‰æ”¹å…¶ä»–çš„ä¸œè¥¿ï¼Œåº”è¯¥åœ¨ 39 è¡Œå·¦å³ã€‚æ²¡æœ‰æ‰¾åˆ°å°±æœç´¢ä¸€ä¸‹ã€‚ é…ç½®å¦‚ä¸‹ï¼š</p><pre class=" language-yml"><code class="language-yml">skip_render:   - 'box/**'</code></pre><p>ï¼ˆ2ï¼‰ä¿®æ”¹ Hexo Materyä¸»é¢˜ç›®å½•çš„é…ç½®æ–‡ä»¶ <code>_config.yml</code> </p><p>å¦‚æœä½ ä¸æ˜¯ Matery ä¸»é¢˜ä¹Ÿæ²¡æœ‰å…³ç³»ï¼ŒåŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸€æ­¥æ˜¯ç”¨æ¥é…ç½®è®¿é—®èœå•çš„ï¼ŒæŠŠè®¿é—®å¯¼èˆªçš„èœå•é…ç½®ä¸Šï¼š</p><p>æˆ‘çš„æ˜¯äºŒçº§èœå•ï¼Œæ‰€ä»¥æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">Friends</span><span class="token punctuation">:</span>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /friends    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>address<span class="token punctuation">-</span>book<span class="token key atrule">Secret</span><span class="token punctuation">:</span>    <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>list    <span class="token key atrule">children</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> å¯¼èˆª        <span class="token key atrule">url</span><span class="token punctuation">:</span> /navigate        <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>location<span class="token punctuation">-</span>arrow      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> æ”¶è—        <span class="token key atrule">url</span><span class="token punctuation">:</span> /box        <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>map<span class="token punctuation">-</span>marker      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> å†™ä½œ        <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//hut.zhangxiaocai.cn        <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>pen<span class="token punctuation">-</span>alt      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> äº‘ç›˜        <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//yun.zhangxiaocai.cn        <span class="token key atrule">icon</span><span class="token punctuation">:</span> fas fa<span class="token punctuation">-</span>cloud</code></pre><p>å…¶ä¸­</p><pre><code>      - name: æ”¶è—        url: /box        icon: fas fa-map-marker</code></pre><p>å°±æ˜¯è®¿é—® å°èœå¯¼èˆª çš„åç§°ã€ åœ°å€ã€ å›¾æ ‡ã€‚å› ä¸ºä¹‹å‰åˆ›å»ºçš„æ–‡ä»¶å¤¹å«boxï¼Œæ‰€ä»¥è¿™é‡Œé…ç½®è®¿é—®<code>url</code>çš„å€¼éƒ½æ˜¯<code>/box</code></p><p>å¦‚æœä½ æ˜¯ä¸€çº§èœå•é‚£ä¹ˆä½ çš„é…ç½®åº”è¯¥é•¿è¿™æ ·ï¼š</p><pre><code>Friends:    url: /friends    icon: fas fa-address-bookDaohang:    url: /box    icon: fas fa-map-marker    </code></pre><p>è®¿é—®ä¹‹åå¯èƒ½æ˜¯æ‹¼éŸ³ï¼Œä¸æ˜¯ä¸­æ–‡ï¼Œæ‰€ä»¥ä½ è¿˜è¦æ”¹å¦ä¸€ä¸ªæ–‡ä»¶ï¼š</p><p>æ‰¾åˆ° <code>layout/_partial/navigation.ejs</code> æ–‡ä»¶</p><p>å¤§æ¦‚åœ¨ç¬¬ 10 è¡Œå·¦å³æ·»åŠ å¯¼èˆªèœå•</p><pre class=" language-txt"><code class="language-txt">menuMap.set("Daohang", "å¯¼èˆª");</code></pre><p>åŠ å®Œä¹‹åæœ€åä¼šå¤šäº†ä¸€ä¸ª</p><pre class=" language-txt"><code class="language-txt">    menuMap.set("Index", "é¦–é¡µ");    menuMap.set("Tags", "æ ‡ç­¾");    menuMap.set("Categories", "åˆ†ç±»");    menuMap.set("Archives", "å½’æ¡£");    menuMap.set("About", "å…³äº");    menuMap.set("Contact", "ç•™è¨€è–„");    menuMap.set("Friends", "å‹æƒ…é“¾æ¥");    menuMap.set("Daohang", "å¯¼èˆª");</code></pre><p>é‡æ–°ç¼–è¯‘ä¸€ä¸‹ï¼Œåº”è¯¥å°±å¥½äº†ã€‚</p><p>æ”¹åˆ°è¿™é‡Œï¼ŒåŸºæœ¬ä¸Šåˆ»æœ‰è®¿é—®äº†ã€‚</p><h2 id="ä¸‰ã€ä¼˜åŒ–"><a href="#ä¸‰ã€ä¼˜åŒ–" class="headerlink" title="ä¸‰ã€ä¼˜åŒ–"></a>ä¸‰ã€ä¼˜åŒ–</h2><p>å¦‚æœä½ ä½¿ç”¨äº†github çš„CDN åŠ é€Ÿï¼Œå¯ä»¥æŠŠåœ°å€æ”¹æˆä½ çš„github çš„cdn åœ°å€ã€‚å¦‚æœä½ ä¸çŸ¥é“ä½ çš„cdn åŠ é€Ÿåœ°å€ï¼Œè¯·å‚è€ƒä¸»é¢˜ç›®å½•é…ç½®æ–‡ä»¶çš„æœ€åå…³äºcdnçš„è¯´æ˜ã€‚</p><p>å‰©ä¸‹çš„è°ˆä¸ä¸Šä¼˜åŒ–äº†ï¼Œå°±æ˜¯æ ¹æ®è‡ªå·±çš„æƒ³æ³•ç›´æ¥æ”¹htmlé¡µé¢å°±å¥½äº†ï¼Œæ²¡å•¥æŠ€å·§çš„ã€‚</p><p>å¦‚æœä½ ä¸è¦ä¸­è‹±æ–‡åˆ‡æ¢ï¼Œç›´æ¥ä¿®æ”¹åˆ é™¤ç›¸å…³htmlå³å¯ã€‚</p><p>å¦‚æœä½ ä¸æƒ³è®¿é—®è·¯å¾„å¤šä¸ª<code>cn</code> å¯ä»¥ç›´æ¥æŠŠ <code>source/box/cn/</code> æ–‡ä»¶å¤¹é‡Œé¢çš„æ–‡ä»¶ç›´æ¥æ”¾åˆ° <code>/box</code> ç›®å½•ï¼Œç„¶å<code>cn</code>ã€<code>en</code> ä¸¤ä¸ªæ–‡ä»¶å¤¹å¯ä»¥åˆ é™¤ï¼Œå¦‚æœå‡ºç°é™æ€å›¾ç‰‡ä¸èƒ½åŠ è½½ï¼Œå°±è‡ªå·±è°ƒæ•´ä¸€ä¸‹è·¯å¾„å³å¯ã€‚ æˆ‘æ²¡æœ‰è¿™ä¹ˆå¹²ã€‚</p><p>å¦‚æœä½ æƒ³æ”¹æˆå’Œæˆ‘ä¸€æ ·çš„ï¼Œç›´æ¥åˆ°<a href="https://zhangxiaocai.cn/box/cn/about.html" target="_blank" rel="noopener">å°èœå¯¼èˆª</a> é¡µé¢ï¼Œç„¶å æŒ‰F12 æˆ–è€… é¼ æ ‡å³é”®æŸ¥çœ‹é¡µé¢æºä»£ç ï¼ŒæŠŠè¦æ”¹çš„åœ°æ–¹å¤åˆ¶ä½¿ç”¨å³å¯ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WebStackPage </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot é…ç½®æ–‡ä»¶ç›¸å…³</title>
      <link href="/posts/9911da24.html"/>
      <url>/posts/9911da24.html</url>
      
        <content type="html"><![CDATA[<h2 id="SpringBoot-é…ç½®æ–‡ä»¶ç›¸å…³"><a href="#SpringBoot-é…ç½®æ–‡ä»¶ç›¸å…³" class="headerlink" title="SpringBoot é…ç½®æ–‡ä»¶ç›¸å…³"></a>SpringBoot é…ç½®æ–‡ä»¶ç›¸å…³</h2><h2 id="ä¸€ã€Profile-æœºåˆ¶"><a href="#ä¸€ã€Profile-æœºåˆ¶" class="headerlink" title="ä¸€ã€Profile æœºåˆ¶"></a>ä¸€ã€Profile æœºåˆ¶</h2><p>Profile å…¶å®å°±æ˜¯ç¯å¢ƒé…ç½®åˆ‡æ¢çš„è¿‡ç¨‹ã€‚</p><p>åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦ä¸åŒçš„ç¯å¢ƒé…ç½®ï¼Œå¦‚å¼€å‘æ—¶ä½¿ç”¨çš„å¼€å‘ç¯å¢ƒæ•°æ®åº“ï¼Œä¸€èˆ¬å¯ä»¥æ•°æ®æˆ–è¡¨å¯ä»¥ç›´æ¥æ“ä½œä¿®æ”¹ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è¿ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®åº“ï¼Œæµ‹è¯•çš„æ—¶å€™æµ‹è¯•äººå‘˜ä½¿ç”¨æµ‹è¯•æ•°æ®åº“ï¼Œè€Œä¸Šçº¿æ—¶å°±éœ€è¦è¿ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®åº“ã€‚è¿™å°±è¦æ±‚é¡¹ç›®èƒ½å¤Ÿåˆ‡æ¢ç¯å¢ƒé…ç½®ã€‚</p><p>spring booté¡¹ç›®ä¸­ï¼Œ<code>application.properties</code>ç§°ä¸ºå…¨å±€é…ç½®æ–‡ä»¶ï¼Œå®é™…ä¸Šå¯ä»¥å¼•å…¥ä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ï¼š<code>application-dev.properties</code>ï¼Œ<code>application-prod.properties</code>ï¼Œ<code>application-test.properties</code>ï¼Œ</p><p>é€šè¿‡æŒ‡å®šåœ¨å…¨å±€é…ç½®æ–‡ä»¶<code>application.properties</code>ä¸­æŒ‡å®šï¼š<code>spring.profiles.active</code>çš„å€¼åˆ‡æ¢é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">xxx</span></code></pre><p>å°±å¯åŠ è½½<code>application-xxx.properties</code>é…ç½®ã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œæ˜¯åˆ—ä¸¾çš„properties æ–‡ä»¶ï¼Œyml åç¼€åŒç†ã€‚</p><h2 id="äºŒã€æ¿€æ´»profileæ–¹å¼"><a href="#äºŒã€æ¿€æ´»profileæ–¹å¼" class="headerlink" title="äºŒã€æ¿€æ´»profileæ–¹å¼"></a>äºŒã€æ¿€æ´»profileæ–¹å¼</h2><p>ï¼ˆ1ï¼‰åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­æ¿€æ´»</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">xxx</span></code></pre><p>ï¼ˆ2ï¼‰åœ¨å¯åŠ¨é¡¹ç›®æ—¶ä½¿ç”¨å‘½ä»¤è¡Œæ¿€æ´»</p><pre class=" language-bash"><code class="language-bash">java -jar spring-boot-demo-0.0.1-SNAPSHOT.jar --spring.profiles.active<span class="token operator">=</span>dev</code></pre><p>ï¼ˆ3ï¼‰ä½¿ç”¨è™šæ‹Ÿæœºå‚æ•°æ¿€æ´»</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">-Dspring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">dev</span></code></pre><h2 id="ä¸‰ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®"><a href="#ä¸‰ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®" class="headerlink" title="ä¸‰ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®"></a>ä¸‰ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®</h2><p>springboot å¯åŠ¨ä¼šæ‰«æä»¥ä¸‹ä½ç½®çš„application.propertiesæˆ–è€…application.ymlæ–‡ä»¶ä½œä¸ºSpring bootçš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼š</p><ul><li>file:./config/</li><li>file:./</li><li>classpath:/config/</li><li>classpath:/</li></ul><p>SpringBootä¼šä»è¿™å››ä¸ªä½ç½®å…¨éƒ¨åŠ è½½ä¸»é…ç½®æ–‡ä»¶ï¼Œ<strong>ä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ï¼ˆç›¸åŒå±æ€§ï¼‰ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼Œä¸åŒå±æ€§äº’è¡¥é…ç½®</strong>ï¼›</p><p>æ€»ç»“ï¼šé‡å¤é…ç½®ä¼šè¦†ç›–ï¼Œä¸åŒé…ç½®å¯è¡¥å……ã€‚</p><h2 id="å››ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº"><a href="#å››ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº" class="headerlink" title="å››ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº"></a>å››ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº</h2><p>Spring Boot æ”¯æŒå¤šç§å¤–éƒ¨é…ç½®æ–¹å¼å¦‚ä¸‹ï¼Œ<strong>ä¼˜å…ˆçº§ä»é«˜åˆ°ä½</strong>ï¼š</p><p><strong>1.å‘½ä»¤è¡Œå‚æ•°</strong></p><p>æ‰€æœ‰çš„é…ç½®éƒ½å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè¿›è¡ŒæŒ‡å®š</p><p>java -jar spring-boot-demo-0.0.1-SNAPSHOT.jar â€“server.port=8087  â€“server.context-path=/abc</p><p>å¤šä¸ªé…ç½®ç”¨ç©ºæ ¼åˆ†å¼€ï¼› <code>--é…ç½®é¡¹=å€¼</code></p><p>2.æ¥è‡ªjava:comp/envçš„JNDIå±æ€§</p><p>3.Javaç³»ç»Ÿå±æ€§ï¼ˆSystem.getProperties()ï¼‰</p><p>4.æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡</p><p>5.RandomValuePropertySourceé…ç½®çš„ <code>random.*</code> å±æ€§å€¼</p><p><strong>ç”±jaråŒ…å¤–å‘jaråŒ…å†…è¿›è¡Œå¯»æ‰¾ï¼›</strong></p><p>==<strong>ä¼˜å…ˆåŠ è½½å¸¦profile</strong>==</p><p><strong>6.jaråŒ…å¤–éƒ¨çš„application-{profile}.propertiesæˆ–application.yml(å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p><strong>7.jaråŒ…å†…éƒ¨çš„application-{profile}.propertiesæˆ–application.yml(å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p>==<strong>å†æ¥åŠ è½½ä¸å¸¦profile</strong>==</p><p><strong>8.jaråŒ…å¤–éƒ¨çš„application.propertiesæˆ–application.yml(ä¸å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p><strong>9.jaråŒ…å†…éƒ¨çš„application.propertiesæˆ–application.yml(ä¸å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p>10.@Configurationæ³¨è§£ç±»ä¸Šçš„@PropertySource</p><p>11.é€šè¿‡SpringApplication.setDefaultPropertiesæŒ‡å®šçš„é»˜è®¤å±æ€§</p><p>æ‰€æœ‰æ”¯æŒçš„é…ç½®åŠ è½½æ¥æºï¼›</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#boot-features-external-config" target="_blank" rel="noopener">å‚è€ƒå®˜æ–¹æ–‡æ¡£</a></p><p>å‚è€ƒèµ„æ–™ï¼šå°šç¡…è°·å­¦ä¹ è§†é¢‘ï¼Œå®˜æ–¹æ–‡æ¡£ç­‰</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBooté…ç½®ç›¸å…³ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker å¿«é€Ÿä¸Šæ‰‹</title>
      <link href="/posts/66ee0bda.html"/>
      <url>/posts/66ee0bda.html</url>
      
        <content type="html"><![CDATA[<h2 id="Docker-å¿«é€Ÿä¸Šæ‰‹"><a href="#Docker-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="Docker å¿«é€Ÿä¸Šæ‰‹"></a>Docker å¿«é€Ÿä¸Šæ‰‹</h2><h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h2><p><strong>Docker</strong>æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼›æ˜¯ä¸€ä¸ªè½»é‡çº§å®¹å™¨æŠ€æœ¯ï¼›</p><p>Dockeræ”¯æŒå°†è½¯ä»¶ç¼–è¯‘æˆä¸€ä¸ªé•œåƒï¼›ç„¶ååœ¨é•œåƒä¸­å„ç§è½¯ä»¶åšå¥½é…ç½®ï¼Œå°†é•œåƒå‘å¸ƒåˆ°é•œåƒä»“åº“ï¼Œå…¶ä»–ä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé•œåƒï¼›</p><p>è¿è¡Œä¸­çš„è¿™ä¸ªé•œåƒç§°ä¸ºå®¹å™¨ï¼Œå®¹å™¨å¯åŠ¨æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚</p><h2 id="äºŒã€åŸºæœ¬æ¦‚å¿µ"><a href="#äºŒã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="äºŒã€åŸºæœ¬æ¦‚å¿µ"></a>äºŒã€åŸºæœ¬æ¦‚å¿µ</h2><p><strong>dockerä¸»æœº(Host)ï¼š</strong>å®‰è£…äº†Dockerç¨‹åºçš„æœºå™¨ï¼ŒDockerç›´æ¥å®‰è£…åœ¨æ“ä½œç³»ç»Ÿï¼ˆwindows / linuxï¼‰ä¸Šï¼›</p><p><strong>dockerå®¢æˆ·ç«¯(Client)ï¼š</strong>è¿æ¥dockerä¸»æœºè¿›è¡Œæ“ä½œï¼›</p><p><strong>dockerä»“åº“(Registry)ï¼š</strong>ç”¨æ¥ä¿å­˜å„ç§æ‰“åŒ…å¥½çš„è½¯ä»¶é•œåƒï¼›</p><p><strong>dockeré•œåƒ(Images)ï¼š</strong>è½¯ä»¶æ‰“åŒ…å¥½çš„é•œåƒï¼›æ”¾åœ¨dockerä»“åº“ä¸­ï¼›</p><p><strong>dockerå®¹å™¨(Container)ï¼š</strong>é•œåƒå¯åŠ¨åçš„å®ä¾‹ç§°ä¸ºä¸€ä¸ªå®¹å™¨ï¼›å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ã€‚</p><pre class=" language-txt"><code class="language-txt">Client   ---------> Host  --------->  Registry</code></pre><p>ä½¿ç”¨Dockerçš„åŸºæœ¬æ­¥éª¤ï¼š</p><p>1ï¼‰ã€å®‰è£…Docker</p><p>2ï¼‰ã€å»Dockerä»“åº“æ‰¾åˆ°è¿™ä¸ªè½¯ä»¶å¯¹åº”çš„é•œåƒï¼›</p><p>3ï¼‰ã€ä½¿ç”¨Dockerè¿è¡Œè¿™ä¸ªé•œåƒï¼Œè¿™ä¸ªé•œåƒå°±ä¼šç”Ÿæˆä¸€ä¸ªDockerå®¹å™¨ï¼›</p><p>4ï¼‰ã€å¯¹å®¹å™¨çš„å¯åŠ¨åœæ­¢å°±æ˜¯å¯¹è½¯ä»¶åº”ç”¨çš„å¯åŠ¨åœæ­¢ï¼›</p><h2 id="ä¸‰ã€Docker-å®‰è£…"><a href="#ä¸‰ã€Docker-å®‰è£…" class="headerlink" title="ä¸‰ã€Docker å®‰è£…"></a>ä¸‰ã€Docker å®‰è£…</h2><p>1ã€ç¯å¢ƒå‡†å¤‡</p><p>æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼ŒLinux å¿…é¡»æ˜¯3.10åŠä»¥ä¸Š</p><p>æ£€æŸ¥å‘½ä»¤ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">uname</span> -r</code></pre><p>2ã€å®‰è£…docker</p><pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> docker</code></pre><p>3ã€æŸ¥çœ‹ç‰ˆæœ¬</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker -v</span>Docker version 1.12.6, build 3e8e77d/1.12.6</code></pre><p>3ã€å¯åŠ¨docker</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl start docker</span></code></pre><p>4ã€å¼€æœºå¯åŠ¨</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl enable docker</span>Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</code></pre><p>5ã€åœæ­¢docker</p><pre class=" language-bash"><code class="language-bash">systemctl stop docker</code></pre><h2 id="å››ã€Docker-å¸¸ç”¨å‘½ä»¤-amp-æ“ä½œ"><a href="#å››ã€Docker-å¸¸ç”¨å‘½ä»¤-amp-æ“ä½œ" class="headerlink" title="å››ã€Docker å¸¸ç”¨å‘½ä»¤&amp;æ“ä½œ"></a>å››ã€Docker å¸¸ç”¨å‘½ä»¤&amp;æ“ä½œ</h2><h3 id="1ã€é•œåƒæ“ä½œ"><a href="#1ã€é•œåƒæ“ä½œ" class="headerlink" title="1ã€é•œåƒæ“ä½œ"></a>1ã€é•œåƒæ“ä½œ</h3><p>Docker Hub åœ°å€ï¼š <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p><p>é•œåƒå¸¸ç”¨æ“ä½œï¼š</p><table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ£€ç´¢</td><td><code>docker  search å…³é”®å­—</code><br/>egï¼šdocker  search redis</td><td>æˆ‘ä»¬ç»å¸¸å»docker  hubä¸Šæ£€ç´¢é•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚é•œåƒçš„TAGã€‚</td></tr><tr><td>æ‹‰å–</td><td><code>docker pull é•œåƒå:tag</code></td><td>:tagæ˜¯å¯é€‰çš„ï¼Œtagè¡¨ç¤ºæ ‡ç­¾ï¼Œå¤šä¸ºè½¯ä»¶çš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯latest</td></tr><tr><td>åˆ—è¡¨</td><td><code>docker images</code></td><td>æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°é•œåƒ</td></tr><tr><td>åˆ é™¤</td><td><code>docker rmi image-id</code></td><td>åˆ é™¤æŒ‡å®šçš„æœ¬åœ°é•œåƒ</td></tr></tbody></table><h3 id="2ã€å®¹å™¨æ“ä½œ"><a href="#2ã€å®¹å™¨æ“ä½œ" class="headerlink" title="2ã€å®¹å™¨æ“ä½œ"></a>2ã€å®¹å™¨æ“ä½œ</h3><p>ï¼ˆ1ï¼‰æœç´¢é•œåƒå‘½ä»¤ï¼š</p><pre class=" language-bash"><code class="language-bash">docker search é•œåƒåç§°</code></pre><p>ç¤ºä¾‹ï¼š</p><pre class=" language-bash"><code class="language-bash">docker search tomcat</code></pre><p>ä¹Ÿå¯ä»¥åœ¨ <a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a>ç›´æ¥æœç´¢ã€‚</p><p>ï¼ˆ2ï¼‰æ‹‰å–é•œåƒï¼š</p><pre class=" language-bash"><code class="language-bash">docker pull é•œåƒåç§°</code></pre><p>ç¤ºä¾‹ï¼š</p><pre><code>docker pull mysql</code></pre><p>ï¼ˆ3ï¼‰æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨ </p><pre><code>docker images [OPTIONS] [REPOSITORY[:TAG]]</code></pre><p>OPTIONSè¯´æ˜ï¼š</p><ul><li><strong>-a ï¼š</strong>åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒï¼ˆå«ä¸­é—´æ˜ åƒå±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿‡æ»¤æ‰ä¸­é—´æ˜ åƒå±‚ï¼‰ï¼›</li><li><strong>â€“digests ï¼š</strong>æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯ï¼›</li><li><strong>-f ï¼š</strong>æ˜¾ç¤ºæ»¡è¶³æ¡ä»¶çš„é•œåƒï¼›</li><li><strong>â€“format ï¼š</strong>æŒ‡å®šè¿”å›å€¼çš„æ¨¡æ¿æ–‡ä»¶ï¼›</li><li><strong>â€“no-trunc ï¼š</strong>æ˜¾ç¤ºå®Œæ•´çš„é•œåƒä¿¡æ¯ï¼›</li><li><strong>-q ï¼š</strong>åªæ˜¾ç¤ºé•œåƒIDã€‚</li></ul><p>ï¼ˆ4ï¼‰æ ¹æ®é•œåƒå¯åŠ¨å®¹å™¨åŸºæœ¬å‘½ä»¤ï¼š</p><pre><code>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]docker run --name å®¹å™¨åç§° -d é•œåƒåç§°:latest</code></pre><p>OPTIONSè¯´æ˜ï¼š</p><ul><li><strong>-a stdinï¼š</strong> æŒ‡å®šæ ‡å‡†è¾“å…¥è¾“å‡ºå†…å®¹ç±»å‹ï¼Œå¯é€‰ STDIN/STDOUT/STDERR ä¸‰é¡¹ï¼›</li><li><strong>-dï¼š</strong> åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼›</li><li><strong>-iï¼š</strong> ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼›</li><li><strong>-Pï¼š</strong> éšæœºç«¯å£æ˜ å°„ï¼Œå®¹å™¨å†…éƒ¨ç«¯å£<strong>éšæœº</strong>æ˜ å°„åˆ°ä¸»æœºçš„ç«¯å£</li><li><strong>-pï¼š</strong> æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£ </li><li><strong>-tï¼š</strong> ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›</li><li><strong>â€“name=â€nginx-lbâ€ï¼š</strong> ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›</li><li><strong>â€“dns 8.8.8.8ï¼š</strong> æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„DNSæœåŠ¡å™¨ï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ï¼›</li><li><strong>â€“dns-search example.comï¼š</strong> æŒ‡å®šå®¹å™¨DNSæœç´¢åŸŸåï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ï¼›</li><li><strong>-h â€œmarsâ€ï¼š</strong> æŒ‡å®šå®¹å™¨çš„hostnameï¼›</li><li><strong>-e username=â€ritchieâ€ï¼š</strong> è®¾ç½®ç¯å¢ƒå˜é‡ï¼›</li><li><strong>â€“env-file=[]ï¼š</strong> ä»æŒ‡å®šæ–‡ä»¶è¯»å…¥ç¯å¢ƒå˜é‡ï¼›</li><li><strong>â€“cpuset=â€0-2â€ or â€“cpuset=â€0,1,2â€ï¼š</strong> ç»‘å®šå®¹å™¨åˆ°æŒ‡å®šCPUè¿è¡Œï¼›</li><li><strong>-m ï¼š</strong>è®¾ç½®å®¹å™¨ä½¿ç”¨å†…å­˜æœ€å¤§å€¼ï¼›</li><li><strong>â€“net=â€bridgeâ€ï¼š</strong> æŒ‡å®šå®¹å™¨çš„ç½‘ç»œè¿æ¥ç±»å‹ï¼Œæ”¯æŒ bridge/host/none/container: å››ç§ç±»å‹ï¼›</li><li><strong>â€“link=[]ï¼š</strong> æ·»åŠ é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ï¼›</li><li><strong>â€“expose=[]ï¼š</strong> å¼€æ”¾ä¸€ä¸ªç«¯å£æˆ–ä¸€ç»„ç«¯å£ï¼› </li><li><strong>â€“volume , -vï¼š</strong>     ç»‘å®šä¸€ä¸ªå·</li></ul><p>å¸¸ç”¨çš„æ“ä½œæ˜¯ï¼š</p><p>-dï¼šåå°è¿è¡Œ<br>-p: å°†ä¸»æœºçš„ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ä¸€ä¸ªç«¯å£    ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨çš„ç«¯å£</p><p>ç¤ºä¾‹</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># å¯åŠ¨tomcat å®¹å™¨ã€æ˜ å°„ç«¯å£ã€åå°è¿è¡Œ</span>docker run -d -p 8888:8080 tomcat<span class="token comment" spellcheck="true"># èƒ½å¯åŠ¨mysql ä¸èƒ½è®¿é—®</span>docker run --name mysql_01 -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>123456 -d mysql<span class="token comment" spellcheck="true"># èƒ½å¯åŠ¨mysql å¹¶ä¸”èƒ½è®¿é—®</span>docker run -p 3306:3306 --name mysql_02 -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>123456 -d mysql<span class="token comment" spellcheck="true"># æŠŠä¸»æœºçš„/conf/mysqlæ–‡ä»¶å¤¹æŒ‚è½½åˆ° mysqldockerå®¹å™¨çš„/etc/mysql/conf.dæ–‡ä»¶å¤¹é‡Œé¢ï¼Œæ”¹mysqlçš„é…ç½®æ–‡ä»¶å°±åªéœ€è¦æŠŠmysqlé…ç½®æ–‡ä»¶æ”¾åœ¨è‡ªå®šä¹‰çš„æ–‡ä»¶å¤¹ä¸‹ï¼ˆ/conf/mysqlï¼‰</span>docker run --name mysql_03 -v /conf/mysql:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>my-secret-pw -d mysql:tag<span class="token comment" spellcheck="true"># æŒ‡å®šmysqlçš„ä¸€äº›é…ç½®å‚æ•°</span>docker run --name mysql_04 -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>my-secret-pw -d mysql:tag --character-set-server<span class="token operator">=</span>utf8mb4 --collation-server<span class="token operator">=</span>utf8mb4_unicode_ci</code></pre><p>ï¼ˆ5ï¼‰æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#æŸ¥çœ‹å®¹å™¨(é»˜è®¤æ˜¯å·²å¯åŠ¨çš„ Up)</span>docker <span class="token function">ps</span> <span class="token comment" spellcheck="true">#æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼ˆåŒ…å«å¯åŠ¨çš„å’Œåœæ­¢çš„ï¼‰</span>docker <span class="token function">ps</span> -a  </code></pre><p>ç¤ºä¾‹ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker ps</span>CONTAINER ID    IMAGE     COMMAND                   CREATED       STATUS              PORTS                     NAMESad10e4bc5c6a    mysql    <span class="token string">"docker-entrypoint.sh"</span>   4 seconds ago    Up 2 seconds        0.0.0.0:3306-<span class="token operator">></span>3306/tcp   mysql02</code></pre><p>ï¼ˆ5ï¼‰å®¹å™¨å¯åœ</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># å¯åŠ¨å®¹å™¨</span>docker start å®¹å™¨id<span class="token comment" spellcheck="true"># åˆ é™¤ä¸€ä¸ªå®¹å™¨</span>docker <span class="token function">rm</span> å®¹å™¨id</code></pre><p>ï¼ˆ6ï¼‰æ›´å¤šå‘½ä»¤</p><p>â€‹    ï¼ˆAï¼‰ ï¼š<a href="https://docs.docker.com/engine/reference/commandline/docker/" target="_blank" rel="noopener">Docker å®˜æ–¹æ–‡æ¡£</a></p><p>â€‹    ï¼ˆBï¼‰ï¼šå‚è€ƒæ¯ä¸€ä¸ªé•œåƒçš„æ–‡æ¡£ã€‚</p><p>ç¤ºä¾‹ï¼š</p><pre class=" language-bash"><code class="language-bash">docker pull mysqldocker imagesdocker run -p 3306:3306 --name mysql_05 -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>123456 -d mysqldocker <span class="token function">ps</span> -a</code></pre><p>è®¿é—®çš„è¯ï¼Œå…³é—­é˜²æŠ¤å¢™æˆ–è€…æ”¾è¡Œ3306ç«¯å£ã€‚</p><h2 id="äº”ã€å…¶ä»–"><a href="#äº”ã€å…¶ä»–" class="headerlink" title="äº”ã€å…¶ä»–"></a>äº”ã€å…¶ä»–</h2><p>å…¶ä»–åç»­é‡åˆ°å†è¡¥å……ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootæ³¨è§£IoC</title>
      <link href="/posts/372e3018.html"/>
      <url>/posts/372e3018.html</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBootæ³¨è§£IoC"><a href="#SpringBootæ³¨è§£IoC" class="headerlink" title="SpringBootæ³¨è§£IoC"></a>SpringBootæ³¨è§£IoC</h1><h2 id="ä¸€ã€Iocç®€ä»‹"><a href="#ä¸€ã€Iocç®€ä»‹" class="headerlink" title="ä¸€ã€Iocç®€ä»‹"></a>ä¸€ã€Iocç®€ä»‹</h2><p><code>IoC</code>æ˜¯ä¸€ç§é€šè¿‡æè¿°æ¥ç”Ÿæˆæˆ–è€…è·å–å¯¹è±¡çš„æŠ€æœ¯ã€‚åœ¨Spring ä¸­æŠŠæ¯ä¸ªéœ€è¦ç®¡ç†çš„å¯¹è±¡ç§°ä¸ºSpring Beanï¼Œç®€ç§°Beanï¼ŒSpring ç®¡ç†è¿™äº›Beançš„å®¹å™¨ï¼Œè¢«ç§°ä¸ºSpring IoCå®¹å™¨ï¼ˆç®€ç§°IoCå®¹å™¨ï¼‰ã€‚</p><p>2ä¸ªåŸºæœ¬ä½œç”¨ï¼š</p><p>ï¼ˆ1ï¼‰é€šè¿‡æè¿°ç®¡ç†Beanï¼ŒåŒ…æ‹¬å‘å¸ƒå’Œè·å–Beanï¼›</p><p>ï¼ˆ2ï¼‰é€šè¿‡æè¿°å®ŒæˆBeanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><p><code>Spring IoC</code>å®¹å™¨å…¶å®å°±æ˜¯ç®¡ç†Beançš„å®¹å™¨ã€‚Springå®šä¹‰ä¸­ï¼Œè¦æ±‚æ‰€æœ‰çš„ <code>IoC</code> å®¹å™¨éƒ½éœ€è¦å®ç° <code>BeanFactory</code> æ¥å£ï¼Œå®ƒæ˜¯ä¸€ä¸ªé¡¶çº§å®¹å™¨æ¥å£ã€‚</p><p><code>BeanFactory</code> æ¥å£ä¸»è¦ä»£ç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org <span class="token punctuation">.</span> springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanFactory</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// å‰ç¼€ ç”¨æ¥åŒºåˆ†æ˜¯è·å–FactoryBeanè¿˜æ˜¯FactoryBeançš„createBeanåˆ›å»ºçš„å®ä¾‹.å¦‚æœ&amp;å¼€å§‹åˆ™è·å–FactoryBean;å¦åˆ™è·å–createBeanåˆ›å»ºçš„å®ä¾‹.</span>    String FACTORY BEAN PREFIX <span class="token operator">=</span> <span class="token string">" &amp;"</span> <span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å¤šä¸ªgetBeanæ–¹æ³•</span>    Object <span class="token function">getBean</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token keyword">throws</span> BeansException<span class="token punctuation">;</span>    <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">getBean</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span> requiredType<span class="token punctuation">)</span> <span class="token keyword">throws</span> BeansException<span class="token punctuation">;</span>    Object <span class="token function">getBean</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> BeansException<span class="token punctuation">;</span>     <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">getBean</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span>T<span class="token operator">></span> requiredType<span class="token punctuation">)</span> <span class="token keyword">throws</span> BeansException<span class="token punctuation">;</span>    <span class="token operator">&lt;</span>T<span class="token operator">></span> T <span class="token function">getBean</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span>T<span class="token operator">></span> requiredType<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> BeansException<span class="token punctuation">;</span>    <span class="token operator">&lt;</span>T<span class="token operator">></span> ObjectProvider<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">getBeanProvider</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span>T<span class="token operator">></span> requiredType<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&lt;</span>T<span class="token operator">></span> ObjectProvider<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">getBeanProvider</span><span class="token punctuation">(</span>ResolvableType requiredType<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ˜¯å¦åŒ…å«æŸä¸ªBean</span>    <span class="token keyword">boolean</span> <span class="token function">containsBean</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//Bean æ˜¯å¦ä¸ºå•ä¾‹</span>    <span class="token keyword">boolean</span> <span class="token function">isSingleton</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchBeanDefinitionException<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//Bean æ˜¯å¦ä¸ºåŸå‹</span>    <span class="token keyword">boolean</span> <span class="token function">isPrototype</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchBeanDefinitionException<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ˜¯å¦ç±»å‹åŒ¹é…</span>    <span class="token keyword">boolean</span> <span class="token function">isTypeMatch</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> ResolvableType typeToMatch<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchBeanDefinitionException<span class="token punctuation">;</span>    <span class="token keyword">boolean</span> <span class="token function">isTypeMatch</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> typeToMatch<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchBeanDefinitionException<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è·å–Beançš„ç±»å‹</span>    <span class="token annotation punctuation">@Nullable</span>    Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">getType</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchBeanDefinitionException<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//è·å–Beançš„åˆ«å</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getAliases</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æºç ä¸­æœ‰å¤šä¸ª <code>getBean()</code> çš„æ–¹æ³•ï¼Œæœ‰æŒ‰ç±»å‹è·å–Beanï¼Œæœ‰æŒ‰åç§°è·å–Beanï¼ŒSpring IoCå®¹å™¨å…è®¸æŒ‰ç±»å‹æˆ–è€…åç§°è·å–Beanã€‚</p><p><code>isSingleton()</code> æ–¹æ³•åˆ¤æ–­Bean åœ¨Spring IoCä¸­æ˜¯å¦ä¸ºå•ä¾‹ã€‚<strong>åœ¨Spring IoCä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒBean éƒ½æ˜¯ä»¥å•ä¾‹å­˜åœ¨çš„ï¼Œå³ä½¿ç”¨ <code>getBean()</code> æ–¹æ³•è¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚</strong></p><p><code>isPrototype()</code> æ–¹æ³•ä¸<code>isSingleton()</code> æ–¹æ³•åˆšå¥½ç›¸åï¼Œå¦‚æœå®ƒè¿”å›<code>true</code>ï¼Œ é‚£ä¹ˆä½¿ç”¨ <code>getBean()</code> æ–¹æ³•è·å–Beançš„æ—¶å€™ï¼ŒSpring IoCå®¹å™¨å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Beanè¿”å›ã€‚</p><p>Spring IoC å®¹å™¨å¸ƒå±€ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/spring/springioc.svg" alt="spring IoC æ¥å£"></p><p><code>ApplicationContext</code> æ¥å£é€šè¿‡ç»§æ‰¿ä¸Šçº§æ¥å£è¿›è€Œç»§æ‰¿ <code>BeanFactory</code> æ¥å£ï¼Œè¿˜åœ¨<code>BeanFactory</code> çš„åŸºç¡€ä¸Šæ‰©å±•äº†æ¶ˆæ¯å›½é™…åŒ–æ¥å£ï¼ˆMessageSourceï¼‰ã€ç¯å¢ƒå¯é…ç½®æ¥å£ï¼ˆEnvironmentCapableï¼‰ã€åº”ç”¨äº‹ä»¶å‘å¸ƒæ¥å£ï¼ˆApplicationEventPublisherï¼‰å’Œèµ„æºæ¨¡å¼è§£ææ¥å£ï¼ˆResourcePatternResolverï¼‰ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚</p><p>XMLç›¸å…³çš„<code>IoC</code> å®¹å™¨è£…é…çš„æ–¹å¼ä¸»è¦æ˜¯ä½¿ç”¨<code>&lt;bean&gt;</code> æ ‡ç­¾ï¼Œé€šè¿‡è§£æ<code>bean</code>æ ‡ç­¾çš„æè¿°æ¥ç®¡ç†<code>bean</code>åŠç›¸å…³ä¾èµ–ã€‚</p><p>åœ¨SpringBoot ä¸­ä¸»è¦æ˜¯é€šè¿‡æ³¨è§£æ¥è£…é…<code>Bean</code> åˆ°<code>Spring IoC</code>å®¹å™¨ä¸­ï¼ŒåŸºäºæ³¨è§£çš„<code>IoC</code> å®¹å™¨ä¸º<code>AnnotationConfigApplicationContext</code>ã€‚</p><p>ç¤ºä¾‹ï¼š</p><p>ä¸€ä¸ªæ™®é€šçš„POJO</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>model<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String userName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String note<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// getter setter  tostring</span><span class="token punctuation">}</span></code></pre><p>SpringBoot çš„é…ç½®ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"user"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> User <span class="token function">initUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        User u <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        u<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        u<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">"zhangxiaocai.cn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        u<span class="token punctuation">.</span><span class="token function">setNote</span><span class="token punctuation">(</span><span class="token string">"å°èœ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> u<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><code>@Configuration</code> ï¼šè¡¨ç¤ºä¸€ä¸ªJavaé…ç½®æ–‡ä»¶ï¼Œç±»ä¼¼Springçš„xmlé…ç½®æ–‡ä»¶ã€‚Springçš„å®¹å™¨ä¼šæ ¹æ®å®ƒæ¥ç”ŸæˆIoCå®¹å™¨å»è£…é…Beanï¼›</p><p><code>@Bean</code>ï¼šè¡¨ç¤ºå°† <code>initeUser()</code> æ–¹æ³•è¿”å›çš„POJOè£…é…åˆ°IoCå®¹å™¨ä¸­ï¼Œå®ƒçš„å±æ€§name å®šä¹‰è¿™ä¸ªBeançš„åç§°ï¼Œå¦‚æœæ²¡æœ‰é…ç½®nameå±æ€§ï¼Œåˆ™å°†æ–¹æ³•åç§°<code>â€œinitUserâ€</code>ä½œä¸ºBeançš„åç§°ä¿å­˜åˆ°Srping IoC å®¹å™¨ä¸­ã€‚</p><p>ç„¶åå°±å¯ä»¥ä½¿ç”¨<code>AnnotationConfigApplicationContext</code>æ¥æ„å»ºè‡ªå·±çš„IoCå®¹å™¨ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>ApplicationContext<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>AnnotationConfigApplicationContext<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IoCTest</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Logger log <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>IoCTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ApplicationContext ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span>AppConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        User user <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre class=" language-txt"><code class="language-txt">15:06:34.640 [main] DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory - Creating shared instance of singleton bean 'appConfig'15:06:34.656 [main] DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory - Creating shared instance of singleton bean 'user'15:06:34.792 [main] DEBUG org.springframework.core.env.PropertySourcesPropertyResolver - Found key 'spring.liveBeansView.mbeanDomain' in PropertySource 'systemProperties' with value of type StringUser [id=123, userName=zhangxiaocai.cn, note=å°èœ]</code></pre><h2 id="äºŒã€Bean-çš„è£…é…"><a href="#äºŒã€Bean-çš„è£…é…" class="headerlink" title="äºŒã€Bean çš„è£…é…"></a>äºŒã€Bean çš„è£…é…</h2><p>Spring å…è®¸é€šè¿‡XMLæˆ–Javaé…ç½®æ–‡ä»¶è£…é…Beanï¼Œä½† SpringBoot æ˜¯åŸºäºæ³¨è§£çš„æ–¹å¼ã€‚</p><h3 id="1ã€æ‰«æè£…é…Bean"><a href="#1ã€æ‰«æè£…é…Bean" class="headerlink" title="1ã€æ‰«æè£…é…Bean"></a>1ã€æ‰«æè£…é…Bean</h3><p>å‰é¢çš„ä¾‹å­æ˜¯ä½¿ç”¨æ³¨è§£<code>@Bean</code> æ³¨å…¥åˆ°SpringIoC å®¹å™¨ï¼Œå®é™…é¡¹ç›®ä¸­ï¼Œè‚¯å®šä¼šæœ‰å¾ˆå¤šä¸ªBeanï¼Œæ¯ä¸ªéƒ½è¿™ä¹ˆå†™ï¼Œå²‚ä¸æ˜¯è¦ç´¯æ­»äººã€‚</p><p>Spring è¿˜å…è®¸è¿›è¡Œæ‰«æè£…é…Bean åˆ° IoC å®¹å™¨ï¼Œå¯¹äºæ‰«æè£…é…è€Œè¨€ä½¿ç”¨çš„æ³¨è§£æ˜¯<code>@Component</code>å’Œ<code>@ComponentScan</code>ã€‚</p><p><code>@Component</code> ï¼šç”¨æ¥æ ‡æ˜å“ªä¸ªç±»è¢«æ‰«æè¿›å…¥<code>Spring IoC</code> å®¹å™¨ã€‚</p><p><code>@ComponentScan</code> ï¼šç”¨æ¥æ ‡æ˜é‡‡ç”¨ä½•ç§ç­–ç•¥å»æ‰«æè£…é…Beanã€‚</p><p>å®ä¾‹ï¼š</p><p>åœ¨åˆšæ‰çš„ <code>config</code>ç›®å½•ä¸‹å»ºä¸€ä¸ªPOJO å¦‚ï¼Œå¯ä»¥å°†åˆšæ‰çš„<code>User</code>ç§»è¿‡æ¥ï¼Œä¸ºäº†åŒºåˆ†æˆ‘æ–°å»ºä¸€ä¸ªç±»ï¼š<code>Employee</code> ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"emp"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"zhangxiaocai.cn"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String empName<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"note_xiaocai"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String empNote<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//getter setter tostring</span><span class="token punctuation">}</span></code></pre><p>ä½¿ç”¨<code>@Component</code> æ³¨è§£è¡¨ç¤ºè¯¥ç±»å°†ä¼šè¢«<code>Spring IoC</code>å®¹å™¨æ‰«æè£…å¤‡ï¼Œå…¶ä¸­<code>â€œempâ€</code>è¡¨ç¤ºä½œä¸ºBeançš„åç§°ï¼Œä¹Ÿå¯ä»¥ä¸é…ç½®è¿™ä¸ªåç§°å­—ç¬¦ä¸²ï¼ŒIoC å®¹å™¨ä¼šæŠŠç±»åç¬¬ä¸€ä¸ªå­—æ¯ä½œä¸ºå°å†™å…¶ä»–ä¸å˜ä½œä¸ºBeançš„åç§°æ”¾å…¥åˆ°IoCå®¹å™¨ä¸­ï¼›</p><p><code>@Value</code> æ³¨è§£åœ¨å­¦ä¹ YMLè¯­æ³•çš„æ—¶å€™é‡åˆ°è¿‡ï¼Œæ˜¯ç”¨æ¥ç»‘å®šå±æ€§æ³¨å…¥å‚æ•°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥èµ‹å€¼ã€‚</p><p>ä¿®æ”¹<code>AppConfig</code>ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>ComponentScan<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>è¿™é‡Œæ·»åŠ äº†<code>@ComponentScan</code> æ³¨è§£ï¼Œå®ƒä¼šè¿›è¡Œæ‰«æï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒåªä¼šæ‰«ææ‰€åœ¨æ³¨è§£ç±»<code>AppConfig</code>æ‰€åœ¨çš„å½“å‰åŒ…å’Œå…¶å­åŒ…ã€‚ä¸ºä»€ä¹ˆè¦æŠŠ<code>Employee</code>å»ºåœ¨<code>config</code> ç›®å½•ä¸‹å°±æ˜¯è¿™ä¸ªåŸå› ã€‚</p><p>è¿è¡Œæµ‹è¯•ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>ApplicationContext<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>AnnotationConfigApplicationContext<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IoCTest</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Logger log <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>IoCTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ApplicationContext ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span>AppConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Employee emp <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>Employee<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œç»“æœï¼š</p><pre class=" language-txt"><code class="language-txt">16:07:46.227 [main] DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory - Creating shared instance of singleton bean 'appConfig'16:07:46.238 [main] DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory - Creating shared instance of singleton bean 'emp'Employee [id=123, empName=zhangxiaocai.cn, empNote=note_xiaocai]</code></pre><p>æ‰¾åˆ°æ³¨è§£ç±»<code>ComponentScan</code>æºç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>ElementType<span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span><span class="token annotation punctuation">@Documented</span><span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span>ComponentScans<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//åœ¨ä¸€ä¸ªç±»ä¸­å¯é‡å¤å®šä¹‰</span><span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">ComponentScan</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">//** å®šä¹‰æ‰«æçš„åŒ…</span>    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span><span class="token string">"basePackages"</span><span class="token punctuation">)</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//** å®šä¹‰æ‰«æçš„åŒ…</span>    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">basePackages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//** å®šä¹‰æ‰«æçš„ç±»</span>    Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">basePackageClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// Bean name ç”Ÿæˆå™¨</span>    Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">BeanNameGenerator</span><span class="token operator">></span> <span class="token function">nameGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> BeanNameGenerator<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// ä½œç”¨åŸŸè§£æå™¨</span>    Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">ScopeMetadataResolver</span><span class="token operator">></span> <span class="token function">scopeResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> AnnotationScopeMetadataResolver<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// ä½œç”¨åŸŸä»£ç†æ¨¡å¼</span>    ScopedProxyMode <span class="token function">scopedProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> ScopedProxyMode<span class="token punctuation">.</span>DEFAULT<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// èµ„æºåŒ¹é…æ¨¡å¼</span>    String <span class="token function">resourcePattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> ClassPathScanningCandidateComponentProvider<span class="token punctuation">.</span>DEFAULT_RESOURCE_PATTERN<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//æ˜¯å¦å¯ç”¨é»˜è®¤çš„è¿‡æ»¤å™¨</span>    <span class="token keyword">boolean</span> <span class="token function">useDefaultFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//** å½“æ»¡è¶³è¿‡æ»¤æ¡ä»¶æ—¶æ‰«æ</span>    Filter<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">includeFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//** å½“ä¸æ»¡è¶³è¿‡æ»¤æ¡ä»¶æ—¶æ‰«æ</span>    Filter<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">excludeFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// ** æ˜¯å¦å¯ç”¨å»¶è¿ŸåŠ è½½</span>    <span class="token keyword">boolean</span> <span class="token function">lazyInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å®šä¹‰è¿‡æ»¤å™¨</span>    <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>    <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    @<span class="token keyword">interface</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>         <span class="token comment" spellcheck="true">// è¿‡æ»¤å™¨ç±»å‹ï¼Œå¯ä»¥æŒ‰æ³¨è§£ç±»å‹æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼ç­‰è¿‡æ»¤</span>        FilterType <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> FilterType<span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// å®šä¹‰è¿‡æ»¤çš„ç±»</span>        <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span><span class="token string">"classes"</span><span class="token punctuation">)</span>        Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// å®šä¹‰è¿‡æ»¤çš„ç±»</span>        <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span>        Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">// åŒ¹é…æ–¹å¼</span>        String<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">pattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¸¦<code>â€œ**â€</code>çš„æ˜¯æœ€å¸¸ç”¨çš„é…ç½®é¡¹ã€‚</p><p><code>basePackages</code>ï¼š å®šä¹‰æ‰«æçš„åŒ…åï¼Œæ²¡æœ‰å®šä¹‰æ—¶åªä¼šæ‰«æå½“å‰åŒ…å’Œå­åŒ…ä¸‹çš„è·¯å¾„ï¼›</p><p><code>basePackagesClasses</code>ï¼šå®šä¹‰æ‰«æçš„ç±»ï¼›</p><p><code>includeFilters</code>ï¼šå®šä¹‰æ»¡è¶³è¿‡æ»¤å™¨ï¼ˆFilterï¼‰æ¡ä»¶çš„ <code>Bean</code>æ‰å»æ‰«æ</p><p><code>excludeFilters</code>ï¼šæ’é™¤è¿‡æ»¤å™¨ï¼ˆFilterï¼‰æ¡ä»¶çš„ <code>Bean</code>æ‰å»æ‰«æï¼ŒäºŒè€…éƒ½éœ€è¦é€šè¿‡ä¸€ä¸ª<code>@Filter</code>å»å®šä¹‰ï¼Œå®ƒæœ‰ä¸€ä¸ªtypeç±»å‹ï¼Œè¿™é‡Œå¯ä»¥å®šä¹‰ä¸ºæ³¨è§£æˆ–è€…æ­£åˆ™ç­‰ç±»å‹ã€‚<code>classes</code>å®šä¹‰æ³¨è§£ç±»ï¼Œ<code>pattern</code>å®šä¹‰æ­£åˆ™å¼ç±»ã€‚</p><p>æŒ‰ç…§å‰é¢çš„å®ä¾‹ï¼Œ<code>User</code>ç±»ä¸åœ¨<code>config</code>ç›®å½•ï¼Œå¯ä»¥å°†<code>AppConfig</code>ä¸­çš„æ³¨è§£ä¿®æ”¹ä¸ºï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.smallrose.web.app.*"</span><span class="token punctuation">)</span></code></pre><p>æˆ–è€…</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"com.smallrose.web.app.model"</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>æˆ–è€…</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackageClass<span class="token operator">=</span><span class="token punctuation">{</span>User<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>ä¸‰ç§æ–¹å¼éƒ½å¯ä»¥ä½¿<code>IoC</code> å®¹å™¨å»æ‰«æ<code>User</code> ç±»ï¼Œè€ŒåŒ…åå¯ä»¥é‡‡ç”¨æ­£åˆ™å¼å»åŒ¹é…ã€‚</p><p>ä½†æœ‰äº›æ—¶å€™éœ€æ±‚æ˜¯æ‰«æä¸€äº›åŒ…ï¼Œå°†ä¸€äº›Bean è£…é…åˆ°SpringIoC å®¹å™¨ä¸­ï¼Œè€Œä¸æƒ³åŠ è½½è¿™ä¸ªåŒ…é‡Œçš„æŸäº›Beanã€‚æ¯”å¦‚åœ¨åŒ…<code>com.smallrose.web.app</code> ä¸‹å¯èƒ½æœ‰<code>service</code>åŒ…ï¼Œåœ¨<code>service</code>åŒ…ä¸‹æœ‰ä¸ª<code>UserService</code>ç±»ï¼Œä¸€èˆ¬ä½¿ç”¨<code>@Service</code> æ³¨è§£æ ‡æ³¨ï¼ˆè¯¥æ ‡æ³¨æ³¨å…¥äº†<code>@Component</code>ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šè¢«Spring æ‰«æè£…é…åˆ° <code>IoC</code>å®¹å™¨ï¼‰ï¼Œç±»å¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printUser</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¦‚æœæ­£å¸¸å¯åŠ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»æ˜¯ä¼šè¢«æ‰«æåˆ°<code>Spring IoC</code> å®¹å™¨ä¸­ã€‚å‡è®¾ä¸æƒ³è£…é…è¿™ä¸ªç±»å‘¢ï¼Ÿ</p><p>åˆ™éœ€è¦æŠŠ<code>AppConfig</code> æ‰«æç­–ç•¥ä¿®æ”¹ä¸ºï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.smallrose.web.app.*"</span><span class="token punctuation">,</span>    excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token punctuation">{</span>Service<span class="token punctuation">.</span> <span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>è®°å¾—æŠŠ<code>User</code>ç±»æ·»åŠ <code>@Component</code>æ³¨è§£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>model<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String userName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String note<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// getter setter toString</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œæµ‹è¯•ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>ApplicationContext<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>AnnotationConfigApplicationContext<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">.</span>UserService<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IoCTest</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Logger log <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>IoCTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ApplicationContext ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span>AppConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        User user <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        UserService userservice <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>UserService<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" userservice "</span><span class="token operator">+</span> userservice<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œç»“æœï¼š</p><pre class=" language-txt"><code class="language-txt">17:18:43.019 [main] DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory - Creating shared instance of singleton bean 'appConfig'17:18:43.030 [main] DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory - Creating shared instance of singleton bean 'user'User [id=null, userName=null, note=null]Exception in thread "main" org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'com.smallrose.web.app.service.UserService' available    at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:352)    at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:343)    at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1127)    at com.smallrose.web.config.IoCTest.main(IoCTest.java:20)</code></pre><p>å¯ä»¥çœ‹åˆ°<code>User</code>ç±»å·²ç»è£…é…äº†ï¼Œåªæ˜¯å±æ€§é»˜è®¤<code>null</code>å€¼ï¼Œè€Œ<code>UserService</code>åˆ™æç¤ºæ²¡æœ‰å®šä¹‰è¿™ä¸ª<code>Bean</code>ï¼Œè¯´æ˜<code>UserService</code> ç±»æ ¹æœ¬æ²¡æœ‰è¿›è¡Œè£…é…ã€‚åœ¨åŠ å…¥äº†<code>excludeFilters</code>çš„é…ç½®ï¼Œä½¿æ ‡æ³¨äº†<code>@Service</code>çš„ç±»å°†ä¸è¢«<code>IoC</code>å®¹å™¨æ‰«ææ³¨å…¥ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠ<code>UserService</code> ç±»æ’é™¤å‡º <code>Spring IoC</code>ä¸­äº†ã€‚</p><p>åœ¨<code>@SpringBootApplication</code>æ³¨è§£ä¸­ä¹Ÿæ³¨å…¥äº†<code>@ComponentScan</code>ï¼Œæºç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>ElementType<span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token annotation punctuation">@Documented</span><span class="token annotation punctuation">@Inherited</span><span class="token annotation punctuation">@SpringBootConfiguration</span><span class="token annotation punctuation">@EnableAutoConfiguration</span><span class="token comment" spellcheck="true">//è‡ªå®šä¹‰æ’é™¤æ‰«æç±»</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> FilterType<span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> TypeExcludeFilter<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> FilterType<span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> AutoConfigurationExcludeFilter<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">// é€šè¿‡ç±»å‹æ’é™¤è‡ªåŠ¨ç±»å‹ç±»</span>    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> EnableAutoConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">exclude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// é€šè¿‡åç§°æ’é™¤è‡ªåŠ¨ç±»å‹ç±»</span>    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> EnableAutoConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">excludeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// å®šä¹‰æ‰«æåŒ…</span>    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> ComponentScan<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> attribute <span class="token operator">=</span> <span class="token string">"basePackages"</span><span class="token punctuation">)</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">scanBasePackages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// å®šä¹‰è¢«æ‰«æçš„ç±»</span>    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> ComponentScan<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> attribute <span class="token operator">=</span> <span class="token string">"basePackageClasses"</span><span class="token punctuation">)</span>    Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">scanBasePackageClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Bean çš„åç§°ç”Ÿæˆå™¨</span>    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> ComponentScan<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> attribute <span class="token operator">=</span> <span class="token string">"nameGenerator"</span><span class="token punctuation">)</span>    Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">BeanNameGenerator</span><span class="token operator">></span> <span class="token function">nameGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> BeanNameGenerator<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ˜¯å¦ç”Ÿæˆä»£ç†beanæ–¹æ³•</span>    <span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> Configuration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">boolean</span> <span class="token function">proxyBeanMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><code>exclude</code> å’Œ <code>excludeName</code> ä¸¤ä¸ªæ–¹æ³•æ˜¯å¯¹äºå…¶å†…éƒ¨çš„è‡ªåŠ¨é…ç½®ç±»æ‰ä¼šç”Ÿæ•ˆã€‚å¦‚æœè¦è‡ªå·±æ’é™¤å…¶ä»–ç±»ï¼Œå¯ä»¥åŠ å…¥<code>@ComponentScan</code>è¾¾åˆ°ç›®å½•ï¼Œå¦‚ä¸Šé¢çš„æ‰«æ<code>User</code>è€Œä¸æ‰«æ<code>UserService</code>å¯ä»¥ä¿®æ”¹å¯åŠ¨é…ç½®æ–‡ä»¶ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.smallrose.web.app.*"</span><span class="token punctuation">,</span>    excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token punctuation">{</span>Service<span class="token punctuation">.</span> <span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringiocApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>SpringiocApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="2ã€è‡ªå®šä¹‰ç¬¬ä¸‰æ–¹Bean"><a href="#2ã€è‡ªå®šä¹‰ç¬¬ä¸‰æ–¹Bean" class="headerlink" title="2ã€è‡ªå®šä¹‰ç¬¬ä¸‰æ–¹Bean"></a>2ã€è‡ªå®šä¹‰ç¬¬ä¸‰æ–¹Bean</h3><p>æœ‰æ—¶å€™éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹çš„<code>Bean</code>ï¼Œæ¯”å¦‚<code>DataSource</code>ï¼Œä½¿ç”¨<code>@Bean</code>æ³¨è§£å³å¯ã€‚</p><p>ç¤ºä¾‹ï¼š</p><p>å¼•å…¥DBCPæ•°æ®æº</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupid</span><span class="token punctuation">></span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupid</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactid</span><span class="token punctuation">></span></span>commons-dbcp2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactid</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupid</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupid</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactid</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactid</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>ç„¶ååœ¨<code>AppConfig.java</code> ä¸­æ·»åŠ åˆ°IoCå®¹å™¨å³å¯ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"dataSource"</span><span class="token punctuation">)</span><span class="token keyword">public</span> DateSource <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    Properties props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"driver"</span><span class="token punctuation">,</span><span class="token string">"com.mysql.jdbc,Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span><span class="token string">"jdbc:mysql://localhost:3306/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    DateSource dataSource <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">try</span><span class="token punctuation">{</span>        dataSource <span class="token operator">=</span> BasicDataSourceFactory<span class="token punctuation">.</span><span class="token function">creatDataSource</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="ä¸‰ã€ä¾èµ–æ³¨å…¥"><a href="#ä¸‰ã€ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¸‰ã€ä¾èµ–æ³¨å…¥"></a>ä¸‰ã€ä¾èµ–æ³¨å…¥</h2><h3 id="1ã€-Autowired-æ³¨è§£"><a href="#1ã€-Autowired-æ³¨è§£" class="headerlink" title="1ã€@Autowired æ³¨è§£"></a>1ã€@Autowired æ³¨è§£</h3><p>Spring ä¸­å¸¸ç”¨æ³¨è§£ä¹‹ä¸€ã€‚æ³¨å…¥æœºåˆ¶æœ€åŸºæœ¬çš„ä¸€æ¡æ˜¯æ ¹æ®å±æ€§çš„ç±»å‹ï¼ˆby typeï¼‰æ‰¾åˆ°å¯¹åº”çš„<code>Bean</code> è¿›è¡Œæ³¨å…¥ã€‚åœ¨Iocçš„é¡¶çº§æ¥å£<code>BeanFactory</code> ä¸­å°±æœ‰<code>getBean()</code> æ–¹æ³•è·å–å¯¹åº”çš„<code>Bean</code> ,<code>getBean()</code> æ”¯æŒæ ¹æ®ç±»å‹æˆ–æ ¹æ®åç§°è·å–æ–¹å¼ã€‚</p><p>æ¯”è¾ƒå¸¸è§çš„å°±ä¸ä¸¾ä¾‹äº†ã€‚åœ¨å¸¸è§çš„æ“ä½œé‡Œï¼Œä¸€ä¸ªæ¥å£ä¸€ä¸ªå®ç°ç±»ï¼Œå®ç°ç±»ä½¿ç”¨<code>@Service</code> æ ‡æ³¨ï¼Œç„¶åä½¿ç”¨æ¥å£æ³¨å…¥çš„æ–¹å¼è¿›è¡Œä½¿ç”¨ã€‚</p><p>è¿™é‡Œä¸¾ä¸ªä¸ä¸€æ ·çš„ä¾‹å­ï¼Œæ¨¡æ‹Ÿè°ƒç”¨æ”¯ä»˜çš„ï¼Œè¯·æ±‚åªè°ƒç”¨æ”¯ä»˜æ¥å£ï¼Œæ¥å£åˆ†å¸ƒè¢«ç”¨å¾®ä¿¡æ”¯ä»˜å’Œæ”¯ä»˜å®æ”¯ä»˜å®ç°ã€‚</p><p>æ¥å£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PayServiceI</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å¾®ä¿¡æ”¯ä»˜å®ç°ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">.</span>PayServiceI<span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxPayImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PayServiceI</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ”¯ä»˜å®æ”¯ä»˜å®ç°ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">.</span>PayServiceI<span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliPayImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PayServiceI</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åœ¨controller ä¸­æ³¨å…¥è°ƒç”¨ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>controller<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletRequest<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Controller<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>GetMapping<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">.</span>PayServiceI<span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> PayServiceI payservice <span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/pay"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toPay</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">)</span><span class="token punctuation">{</span>        payservice<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åœ¨ç¤ºä¾‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¾“å…¥å€¼æ˜¯ä¸€ä¸ªæ”¯ä»˜æ“ä½œï¼Œä½†æ˜¯å´æœ‰ä¸¤ç§æ”¯ä»˜æ–¹å¼ï¼Œ<code>SpringIoC</code> æ³¨å…¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¯åŠ¨ç¨‹åºå‘ç°ä¼šæœ‰ä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p><pre class=" language-txt"><code class="language-txt">Description:Field payservice in com.smallrose.web.app.controller.PayController required a single bean, but 2 were found:    - aliPayImpl: defined in file [D:\dev-toos\sts-bundle\stsWork\SpringBootLearn\target\classes\com\smallrose\web\app\service\impl\AliPayImpl.class]    - wxPayImpl: defined in file [D:\dev-toos\sts-bundle\stsWork\SpringBootLearn\target\classes\com\smallrose\web\app\service\impl\WxPayImpl.class]</code></pre><p>ç¨‹åºæ³¨å…¥éœ€è¦ä¸€ä¸ªBean ä½†æ˜¯ç°åœ¨å‘ç°äº†ä¸¤ä¸ªåŒ¹é…çš„Beanï¼Œæ‰€ä»¥å°±ä¸çŸ¥é“åˆ°åº•ä½¿ç”¨å“ªä¸€ä¸ªäº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>å°†å±æ€§åç§°æ”¹æˆå¯¹åº”çš„å®ç°ç±»åç§°</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>controller<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletRequest<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Controller<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>GetMapping<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">.</span>PayServiceI<span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> PayServiceI wxPayImpl <span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/pay"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toPay</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">)</span><span class="token punctuation">{</span>        wxPayImpl<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å°†å±æ€§åç§°ä» payservice æ”¹æˆ wxPayImp ä¸ºä»€ä¹ˆå¯ä»¥ï¼Ÿ</p><p><strong>å› ä¸º<code>@Autowired</code> é¦–å…ˆæ ¹æ®ç±»å‹æ‰¾å¯¹åº”çš„Beanï¼Œå¦‚æœå¯¹åº”çš„ç±»å‹çš„Bean ä¸æ˜¯å”¯ä¸€çš„ï¼Œé‚£ä¹ˆä¼šæ ¹æ®å…¶å±æ€§åç§°å’ŒBean çš„åç§°è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœåŒ¹é…å¾—ä¸Šå°±ä¼šä½¿ç”¨è¯¥Beanï¼Œå¦‚æœè¿˜æ— æ³•åŒ¹é…ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</strong></p><p>æ³¨æ„ï¼Œ<code>@Autowired</code> æ˜¯ä¸€ä¸ªé»˜è®¤å¿…é¡»æ‰¾åˆ°å¯¹åº”Beançš„æ³¨è§£ï¼Œå¦‚æœä¸èƒ½ç¡®å®šå…¶æ ‡æ³¨å±æ€§ä¸€å®šä¼šå­˜åœ¨å¹¶ä¸”å…è®¸è¿™ä¸ªè¢«æ ‡æ³¨çš„å±æ€§ä¸º<code>null</code>ï¼Œé‚£ä¹ˆå¯ä»¥é…ç½®<code>@Autowired</code> çš„å±æ€§<code>required</code> ä¸º<code>false</code>ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span></code></pre><p>å¦å¤–ï¼Œ<code>@Autowired</code>é™¤äº†å¯ä»¥æ ‡æ³¨å±æ€§å¤–ï¼Œè¿˜å¯ä»¥æ ‡æ³¨æ–¹æ³•ï¼Œå¦‚setPayserviceæ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPayservice</span><span class="token punctuation">(</span>Payservice payservice<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>payservice <span class="token operator">=</span> payservice<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="2ã€æ¶ˆé™¤æ­§ä¹‰"><a href="#2ã€æ¶ˆé™¤æ­§ä¹‰" class="headerlink" title="2ã€æ¶ˆé™¤æ­§ä¹‰"></a>2ã€æ¶ˆé™¤æ­§ä¹‰</h3><p>åœ¨ä¸Šé¢ï¼Œæ”¯ä»˜æ–¹å¼æœ‰ä¸¤ç§çš„æ—¶å€™ï¼Œä¸ºäº†ä½¿<code>@Autowired</code> èƒ½ç»§ç»­ä½¿ç”¨ï¼Œå°†å±æ€§åç§° payservice æ”¹æˆ wxPayImp ã€‚</p><p>äº§ç”Ÿæ³¨å…¥å¤±è´¥çš„é—®é¢˜æ ¹æœ¬æ˜¯æŒ‰ç±»å‹æŸ¥æ‰¾æ—¶ï¼Œå‘ç°äº†å¤šä¸ªåŒ¹é…Beanï¼Œé€ æˆIoC å®¹å™¨æ³¨å…¥çš„å›°æ‰°ï¼Œè¿™ä¸ªé—®é¢˜æˆä¸ºæ­§ä¹‰æ€§é—®é¢˜ã€‚</p><p>å¦‚æœä¸ä¿®æ”¹å±æ€§åç§°ï¼Œæ¶ˆé™¤æ­§ä¹‰çš„åŠæ³•æœ‰å“ªäº›å‘¢ï¼Ÿ</p><p>ï¼ˆ1ï¼‰ä½¿ç”¨ <code>@Primary</code> æ³¨è§£ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¿®æ”¹ä¼˜å…ˆæƒçš„æ³¨è§£ã€‚å½“æœ‰å¾®ä¿¡æ”¯ä»˜å’Œæ”¯ä»˜å®æ”¯ä»˜çš„æ—¶å€™ï¼Œå‡è®¾è¿™ä¸ªæ˜¯ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜ï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨å¾®ä¿¡æ”¯ä»˜çš„ç±»ä¸ŠåŠ å…¥ <code>@Primary</code> æ³¨è§£å³å¯ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Primary<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">.</span>PayServiceI<span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@Primary</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxPayImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PayServiceI</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p> <code>@Primary</code> æ³¨è§£ä¼šå‘Šè¯‰spring IoC å®¹å™¨ï¼Œæ”¾å‘ç°å¤šä¸ªç›¸åŒç±»å‹çš„Bean æ—¶ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨æˆ‘è¿›è¡Œæ³¨å…¥ã€‚</p><p>è¿™æ ·é€šè¿‡ä¼˜å…ˆçº§å˜æ¢ä½¿å¾—IoC å®¹å™¨çŸ¥é“é‚£ä¸ªå…·ä½“çš„å®ä¾‹æ»¡è¶³ä¾èµ–æ³¨å…¥ã€‚</p><p>ä½†æ˜¯ï¼Œ <code>@Primary</code> æ³¨è§£å¯ä»¥ä½¿ç”¨åœ¨å¤šä¸ªç±»ä¸Šï¼Œå¾®ä¿¡æ”¯ä»˜å’Œæ”¯ä»˜å®æ”¯ä»˜éƒ½æ·»åŠ äº†è¯¥æ³¨è§£ï¼Œé‚£ä¹ˆIoCå®¹å™¨è¿˜æ˜¯æ— æ³•åŒºåˆ†é‡‡ç”¨å“ªä¸ªBeançš„å®ä¾‹è¿›è¡Œæ³¨å…¥ã€‚é‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>@Quelifier</code>æ³¨è§£æ¥çµæ´»å®ç°æ³¨å…¥ã€‚å®ƒå°†å’Œ<code>@Autowired</code>æ³¨è§£ ç»„åˆåœ¨ä¸€èµ·ï¼Œé€šè¿‡ç±»å‹å’Œåç§°ä¸€èµ·æ‰¾åˆ°Beanã€‚<strong>å› ä¸ºBeanåç§°åœ¨Spring IoCå®¹å™¨ä¸­æ˜¯å”¯ä¸€æ ‡è¯†ã€‚</strong>è¿™æ ·å°±å¯ä»¥æ¶ˆé™¤æ­§ä¹‰æ€§ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>controller<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletRequest<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Qualifier<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Controller<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>GetMapping<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>service<span class="token punctuation">.</span>PayServiceI<span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PayController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"wxPayImpl"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> PayServiceI payService <span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/pay"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toPay</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">)</span><span class="token punctuation">{</span>        payService<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="3ã€å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ç±»è£…é…"><a href="#3ã€å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ç±»è£…é…" class="headerlink" title="3ã€å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ç±»è£…é…"></a>3ã€å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ç±»è£…é…</h3><p>ä¸Šé¢éƒ½æ˜¯ä¸å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ä¸‹å®ç°çš„ä¾èµ–æ³¨å…¥ã€‚ä½†æœ‰æ—¶å€™æœ‰äº›ç´¯åªæœ‰å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨<code>@Autowired</code></p><p> æ³¨è§£å¯¹æ„é€ æ–¹æ³•çš„å‚æ•°è¿›è¡Œæ³¨å…¥ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonBean</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> PayServiceI payService <span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token function">PersonBean</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"wxPayImpl"</span><span class="token punctuation">)</span> PayServiceI payService<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>payService<span class="token operator">=</span>payService<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="å››ã€ç”Ÿå‘½å‘¨æœŸ"><a href="#å››ã€ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å››ã€ç”Ÿå‘½å‘¨æœŸ"></a>å››ã€ç”Ÿå‘½å‘¨æœŸ</h2><p> IoC å®¹å™¨è£…é…å’Œé”€æ¯Beançš„è¿‡ç¨‹ï¼Œå³Bean çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ï¼Œå¤§è‡´åˆ†ä¸ºBeanå®šä¹‰ã€Beançš„åˆå§‹åŒ–ã€Beançš„ç”Ÿå­˜æœŸã€Beançš„é”€æ¯4ä¸ªéƒ¨åˆ†ã€‚</p><p><strong>Beanå®šä¹‰è¿‡ç¨‹ï¼š</strong></p><p>ï¼ˆ1ï¼‰<code>Spring</code> é€šè¿‡æˆ‘ä»¬çš„é…ç½®ï¼Œå¦‚<code>@ComponentScan</code>å®šä¹‰çš„æ‰«æè·¯å¾„å»æ‰¾åˆ°å¸¦æœ‰<code>@Component</code>çš„ç±»ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯èµ„æºå®šä½çš„è¿‡ç¨‹ã€‚</p><p>ï¼ˆ2ï¼‰æ‰¾åˆ°èµ„æºä¹‹åï¼Œå°±å¼€å§‹è§£æï¼Œå¹¶ä¸”å°†å®šä¹‰çš„ä¿¡æ¯ä¿å­˜èµ·æ¥ï¼ˆä¿å­˜åˆ°BeanDefinitionçš„å®ä¾‹ä¸­ï¼‰ã€‚ï¼ˆæ³¨æ„ï¼Œæ­¤æ—¶æ²¡æœ‰åˆå§‹åŒ–Beanï¼Œä¹Ÿæ²¡æœ‰Beanå®ä¾‹ï¼‰</p><p>ï¼ˆ3ï¼‰æ¥ç€ä¼šæŠŠ<code>Bean å®šä¹‰</code>å‘å¸ƒåˆ°<code>Spring IoC</code>å®¹å™¨ä¸­ã€‚ï¼ˆæ³¨æ„ï¼Œæ­¤æ—¶ä¹Ÿåªæœ‰Beanå®šä¹‰ï¼Œæ²¡æœ‰åˆå§‹åŒ–Beanï¼Œæ²¡æœ‰Beanå®ä¾‹ï¼‰</p><p>å®Œæˆ3æ­¥åªæ˜¯èµ„æºå®šä½å¹¶å°†Beançš„å®šä¹‰å‘å¸ƒåˆ° <code>IoC</code> å®¹å™¨çš„è¿‡ç¨‹ï¼Œè¿˜æ²¡æœ‰<code>Bean</code> å®ä¾‹çš„ç”Ÿæˆï¼Œæ›´æ²¡æœ‰å®Œæˆä¾èµ–æ³¨å…¥ã€‚</p><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring ä¼šç»§ç»­å»å®ŒæˆBean çš„å®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥ï¼Œè¿™æ ·ä» <code>IoC</code>å®¹å™¨ä¸­å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¾èµ–æ³¨å…¥å®Œæˆçš„Beanã€‚</p><p>Spring Bean çš„åˆå§‹åŒ–æµç¨‹ï¼š</p><pre class=" language-txt"><code class="language-txt">èµ„æºå®šä½       â€”â€”>       Beanå®šä¹‰          â€”â€”>     å‘å¸ƒBeanå®šä¹‰    â€”â€”>    å®ä¾‹åŒ–   â€”â€”>  ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰@ComponentScan    ä¿å­˜åˆ°BeanDefinitionçš„å®ä¾‹     IoCå®¹å™¨è£…è½½Beanå®šä¹‰    åˆ›å»ºBeanå®ä¾‹    @Autowiredæ³¨å…¥</code></pre><p><code>ComponentScan</code> ä¸­è¿˜æœ‰ä¸€ä¸ªé…ç½®é¡¹ lazyInitï¼Œåªå¯ä»¥é…ç½® Boolean å€¼ï¼Œä¸”é»˜è®¤å€¼ä¸º false ï¼Œä¹Ÿå°±æ˜¯ é»˜è®¤ä¸è¿›è¡Œå»¶è¿Ÿåˆå§‹åŒ–ï¼Œå› æ­¤åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ Spring ä¼šå¯¹ Bean è¿›è¡Œå®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥å¯¹åº”çš„å±æ€§å€¼ã€‚    </p><p>ä½¿ç”¨çš„è¯åœ¨é…ç½®ç±» AppConfig çš„<code>ï¼ ComponentScan</code> ä¸­åŠ å…¥ lazylnit é…ç½®ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š </p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.smallrose.web.app.*"</span><span class="token punctuation">,</span> lazyinit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    </code></pre><p>è¿™æ ·<code>IoC</code>å®¹å™¨ä¸ä¼šåœ¨å‘å¸ƒBeanå®šä¹‰åé©¬ä¸Šå®Œæˆå®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨Beançš„æ—¶å€™è¿›è¡Œå®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥ã€‚</p><p>/medias/loading-animated.gif" data-original="<img src="" alt="Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ"></p><p>ï¼ˆ1ï¼‰è¿™äº›æ¥å£å’Œæ–¹æ³•ï¼Œåœ¨æ²¡æœ‰æ³¨é‡Šè¯´æ˜çš„æƒ…å†µä¸‹çš„æµç¨‹èŠ‚ç‚¹éƒ½æ˜¯é’ˆå¯¹å•ä¸ªBeanï¼Œä½†æ˜¯<code>BeanPostProcessor</code>æ˜¯é’ˆå¯¹æ‰€æœ‰Beanã€‚</p><p>ï¼ˆ2ï¼‰å³ä½¿å®šä¹‰äº†<code>ApplicationContextAware</code> æ¥å£ï¼Œæœ‰æ—¶å¹¶ä¸ä¼šè°ƒç”¨ï¼Œè¿™è¦æ ¹æ®<code>IoC</code>å®¹å™¨æ¥å†³å®šã€‚<code>Spring IoC</code>å®¹å™¨çš„æœ€ä½è¦æ±‚æ˜¯å®ç°<code>BeanFactory</code>æ¥å£ï¼Œè€Œä¸æ˜¯å®ç°<code>ApplicationContext</code> æ¥å£ã€‚å¯¹äºæ²¡æœ‰å®ç°<code>ApplicationContextAware</code> æ¥å£çš„å®¹å™¨ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸå¯¹äºçš„<code>ApplicationContextAware</code> å®šä¹‰çš„æ–¹æ³•ä¹Ÿæ˜¯ä¸ä¼šè¢«è°ƒç”¨çš„ï¼Œåªæœ‰å®ç°äº†<code>ApplicationContext</code> æ¥å£çš„å®¹å™¨ï¼Œæ‰å¥½åœ¨ç”Ÿå‘½å‘¨æœŸè°ƒç”¨<code>ApplicationContextAware</code> æ‰€å®šä¹‰çš„<code>setApplicationContext</code>æ–¹æ³•ã€‚</p><h2 id="äº”ã€æ¡ä»¶è£…é…Bean"><a href="#äº”ã€æ¡ä»¶è£…é…Bean" class="headerlink" title="äº”ã€æ¡ä»¶è£…é…Bean"></a>äº”ã€æ¡ä»¶è£…é…Bean</h2><p>æœ‰æ—¶å› ä¸ºæŸäº›å®¢è§‚å› ç´ ä¼šä½¿ä¸€äº›Beanæ— æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦‚æ•°æ®åº“è¿æ¥æ± çš„é…ç½®ä¸­æ¼æ‰äº†ä¸€ä¸‹é…ç½®ä¼šé€ æˆæ•°æ®æºä¸èƒ½è¿æ¥ä¸Šï¼Œè¿™æ—¶<code>IoC</code>å®¹å™¨å¦‚æœè¿˜è¿›è¡Œæ•°æ®æºè£…é…ï¼Œç³»ç»Ÿå°†ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯¼è‡´åº”ç”¨æ— æ³•ç»§ç»­ï¼Œè¿™æ—¶å¸Œæœ›<code>IoC</code>å®¹å™¨ä¸å»è£…é…æ•°æ®æºã€‚</p><p>ä¸ºäº†å¤„ç†è¿™ç§åœºæ™¯ï¼ŒSpring æä¾›äº† <code>@Conditional</code>æ³¨è§£æ¥å®ç°ï¼ŒåŒæ—¶å®ƒéœ€è¦é…åˆå¦å¤–ä¸€ä¸ª<code>Condition</code>æ¥å£æ¥å®Œæˆå¯¹åº”çš„åŠŸèƒ½ã€‚(<code>org.springframework .context.annotation.Condition</code>)</p><p>å¦‚ä¹‹å‰é…ç½®æ•°æ®æºï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Properties<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>DataSource<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>dbcp2<span class="token punctuation">.</span>BasicDataSourceFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Conditional<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>condition<span class="token punctuation">.</span>DatabaseConditional<span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"dataSource"</span><span class="token punctuation">,</span>destroyMethod<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span>DatabaseConditional<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> DataSource <span class="token function">getDataSource</span><span class="token punctuation">(</span>            <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${database.driverName}"</span><span class="token punctuation">)</span> String driver<span class="token punctuation">,</span>            <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${database. url}"</span><span class="token punctuation">)</span>  String url <span class="token punctuation">,</span>            <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${database.username}"</span><span class="token punctuation">)</span> String username <span class="token punctuation">,</span>            <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${database. password }"</span><span class="token punctuation">)</span> String password            <span class="token punctuation">)</span><span class="token punctuation">{</span>        Properties props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"driver"</span><span class="token punctuation">,</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>        DataSource dataSource <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">try</span><span class="token punctuation">{</span>            dataSource <span class="token operator">=</span> BasicDataSourceFactory<span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ·»åŠ <code>@Conditional</code>æ³¨è§£ï¼Œå¹¶ä¸”é…ç½®ç±»<code>DatabaseConditional</code>ï¼Œè¿™ä¸ªç±»å¿…é¡»ç°å®<code>Condition</code>æ¥å£ã€‚å¯¹äº<code>Condition</code>æ¥å£åˆ™è¦æ±‚å®ç°<code>matches</code>æ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>condition<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Condition<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>ConditionContext<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>env<span class="token punctuation">.</span>Environment<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span>AnnotatedTypeMetadata<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseConditional</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * æ•°æ®åº“è£…é…æ¡ä»¶     * @param context æ¡ä»¶ä¸Šä¸‹æ–‡     * @param metadata æ³¨é‡Šç±»å‹çš„å…ƒæ•°æ®     * @return true è£…é… Bean ï¼Œå¦åˆ™ä¸è£…é…     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span>ConditionContext context<span class="token punctuation">,</span> AnnotatedTypeMetadata metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å–å‡ºç¯å¢ƒé…ç½®</span>        Environment evn <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// åˆ¤æ–­å±æ€§æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¯¹åº”çš„æ•°æ®åº“é…ç½®</span>        <span class="token keyword">return</span> evn<span class="token punctuation">.</span><span class="token function">containsProperty</span><span class="token punctuation">(</span><span class="token string">"database.driverName"</span><span class="token punctuation">)</span>                 <span class="token operator">&amp;&amp;</span> evn<span class="token punctuation">.</span><span class="token function">containsProperty</span><span class="token punctuation">(</span><span class="token string">"database.url"</span><span class="token punctuation">)</span>                 <span class="token operator">&amp;&amp;</span> evn<span class="token punctuation">.</span><span class="token function">containsProperty</span><span class="token punctuation">(</span><span class="token string">"database.userName"</span><span class="token punctuation">)</span>                <span class="token operator">&amp;&amp;</span> evn<span class="token punctuation">.</span><span class="token function">containsProperty</span><span class="token punctuation">(</span><span class="token string">"database.password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>matches æ–¹æ³•é¦–å…ˆè¯»å–å…¶ä¸Šä¸‹æ–‡ç¯å¢ƒ ï¼Œ ç„¶ååˆ¤å®šæ˜¯å¦å·²ç»é…ç½®äº†å¯¹åº”çš„æ•°æ®åº“ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“è¿™ äº›éƒ½å·±ç»é…ç½®å¥½ååˆ™è¿”å› trueã€‚è¿™ä¸ªæ—¶å€™ Spring ä¼šè£…é…æ•°æ®åº“è¿æ¥æ± çš„ Bean ï¼Œå¦åˆ™æ˜¯ä¸è£…é…çš„ã€‚    </p><h2 id="å…­ã€Beançš„ä½œç”¨åŸŸ"><a href="#å…­ã€Beançš„ä½œç”¨åŸŸ" class="headerlink" title="å…­ã€Beançš„ä½œç”¨åŸŸ"></a>å…­ã€Beançš„ä½œç”¨åŸŸ</h2><p>åœ¨<code>BeanFactory</code>æ¥å£ä¸­ï¼Œæœ‰<code>isSingleton</code> å’Œ <code>isPrototype</code> ä¸¤ä¸ªæ–¹æ³•ã€‚å…¶ä¸­ï¼Œ <code>isSingleton</code> æ–¹æ³•å¦‚æœè¿”å› <code>true</code> ï¼Œåˆ™ Bean åœ¨ loC å®¹å™¨ä¸­ä»¥å•ä¾‹å­˜åœ¨ï¼Œè¿™ä¹Ÿæ˜¯ <code>Spring IoC</code>å®¹å™¨çš„é»˜è®¤å€¼ ï¼›å¦‚æœ <code>isPrototype</code> æ–¹æ³•è¿”å› <code>true</code>ï¼Œåˆ™ å½“æˆ‘ä»¬æ¯æ¬¡è·å– Bean çš„æ—¶å€™ï¼Œ <code>IoC</code> å®¹å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Beanï¼Œè¿™æ˜¾ç„¶å­˜åœ¨å¾ˆå¤§çš„ä¸åŒï¼Œè¿™ä¾¿æ˜¯ Spring Bean çš„ä½œç”¨åŸŸçš„é—®é¢˜ã€‚ </p><p>åœ¨ä¸€èˆ¬å®¹å™¨ä¸­ï¼ŒBean éƒ½ä¼šå­˜åœ¨å•ä¾‹ï¼ˆSingletonï¼‰å’ŒåŸå‹ï¼ˆPrototypeï¼‰ä¸¤ç§ä½œç”¨åŸŸã€‚è€ŒWeb å®¹å™¨ï¼Œåˆ™å­˜åœ¨é¡µé¢ï¼ˆpageï¼‰ã€è¯·æ±‚ï¼ˆ request ï¼‰ã€ä¼šè¯ ï¼ˆ session ï¼‰å’Œåº”ç”¨ï¼ˆ Application ï¼‰4ç§ä½œç”¨åŸŸã€‚å¯¹äºé¡µé¢ï¼ˆPageï¼‰æ˜¯é’ˆå¯¹JSPå½“å‰é¡µé¢è€Œè¨€ï¼Œspring æ— æ³•æ”¯æŒã€‚</p><p>Beançš„ä½œç”¨åŸŸ</p><table><thead><tr><th>ä½œç”¨åŸŸç±»å‹</th><th>ä½¿ç”¨èŒƒå›´</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>singleton</strong></td><td>æ‰€æœ‰springåº”ç”¨</td><td>é»˜è®¤å€¼ï¼ŒIoCå®¹å™¨å€¼å­˜åœ¨å•ä¾‹</td></tr><tr><td><strong>prototype</strong></td><td>æ‰€æœ‰springåº”ç”¨</td><td>æ¯å½“ä»IoCå®¹å™¨å–å‡ºä¸€ä¸ªBeanï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean</td></tr><tr><td><strong>session</strong></td><td>spring webåº”ç”¨</td><td>HTTPä¼šè¯</td></tr><tr><td><strong>application</strong></td><td>spring webåº”ç”¨</td><td>Web å·¥ç¨‹ç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td>request</td><td>spring webåº”ç”¨</td><td>Web å·¥ç¨‹å•è¯è¯·æ±‚ï¼ˆrequestï¼‰</td></tr><tr><td>globalSession</td><td>spring webåº”ç”¨</td><td>åœ¨ä¸€ä¸ªå…¨å±€çš„HTTP Sessionï¼Œä¸€ä¸ªBeanå®šä¹‰å¯¹åº”ä¸€ä¸ªç¤ºä¾‹ã€‚<br/>å®è·µä¸­åŸºæœ¬ä¸ä½¿ç”¨</td></tr></tbody></table><p>å¸¸ç”¨çš„æ˜¯åŠ ç²—çš„4ç§ï¼Œå¯¹äºapplication ä½œç”¨åŸŸï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨å•ä¾‹æ¥ä»£æ›¿ã€‚</p><p><strong>å•ä¾‹ ï¼ˆ Singletonï¼‰å’ŒåŸå‹ï¼ˆ påˆšotype ï¼‰çš„åŒºåˆ«</strong></p><p>ä¸è¿›è¡Œä»»ä½•é…ç½®é»˜è®¤å°±æ˜¯å•ä¾‹ã€‚å•ä¾‹å°±æ˜¯æ¯æ¬¡è·å–çš„Beanå®ä¾‹éƒ½ä»–ç›¸åŒçš„ä¸€ä¸ªBeanã€‚</p><p>å¦‚æœè¦è¿›è¡ŒåŸå‹é…ç½®ï¼Œåˆ™åœ¨éœ€è¦é…ç½®çš„Beanä¸Šæ·»åŠ ä½œç”¨åŸŸæ³¨è§£<code>@Scope</code></p><pre><code>@Scope(ConfiguarebleBeanFactory.SCOPE_PROTOTYPE)</code></pre><p>ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>config<span class="token punctuation">.</span>ConfigurableBeanFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Scope<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>ConfigurableBeanFactory<span class="token punctuation">.</span>SCOPE_PROTOTYPE<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanTest</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>æµ‹è¯•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>test<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>AnnotationConfigApplicationContext<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">.</span>AppConfig<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">.</span>BeanTest<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IoCTest</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> Logger log <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>IoCTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        AnnotationConfigApplicationContext ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span>AppConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        BeanTest bean1 <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>BeanTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        BeanTest bean2 <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>BeanTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bean1<span class="token operator">==</span>bean2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æµ‹è¯•ç»“æœï¼šfalse</p><p>æ³¨é‡Šæ‰<code>@Scope</code> ç»“æœä¸º true ã€‚</p><p>ConfigurableBeanFactory åªèƒ½æä¾› å• ä¾‹ ï¼ˆ SCOPE_SINGLETON ï¼‰å’Œ åŸ å‹ ï¼ˆ SCOPE_ PROTOTYPE ï¼‰ ä¸¤ç§ä½œç”¨åŸŸä¾›é€‰æ‹© ï¼Œ å¦‚æœæ˜¯åœ¨ SpringMVC ç¯å¢ƒä¸­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ WebApp l icationContext å»å®š ä¹‰å…¶ä»–ä½œç”¨åŸŸ ï¼Œ å¦‚è¯·æ±‚ï¼ˆ SCOPE REQUEST ï¼‰ã€ ä¼šè¯ ï¼ˆ SCOPE_SESSION ï¼‰ å’Œåº”ç”¨ ï¼ˆ SCOPE APPLICATION ï¼‰ ã€‚     </p><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>config<span class="token punctuation">.</span>ConfigurableBeanFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Scope<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>WebApplicationContxt<span class="token punctuation">.</span>SCOPE_REQUEST<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanTest</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>è¿™æ ·åŒä¸€ä¸ªè¯·æ±‚èŒƒå›´å†…å»è·å–è¿™ä¸ªBeançš„æ—¶å€™ï¼Œåªä¼šå…±ç”¨åŒä¸€ä¸ªBeanï¼Œç¬¬äºŒæ¬¡è¯·æ±‚å°±ä¼šäº§ç”Ÿæ–°çš„Beanã€‚</p><h2 id="ä¸ƒã€ä½¿ç”¨-Profile"><a href="#ä¸ƒã€ä½¿ç”¨-Profile" class="headerlink" title="ä¸ƒã€ä½¿ç”¨ @Profile"></a>ä¸ƒã€ä½¿ç”¨ @Profile</h2><p>å®é™…å¼€å‘ä¸­ï¼Œå¸¸å¸¸æ˜¯å¤šç¯å¢ƒåˆ‡æ¢ã€‚æ¯å¥—ç¯å¢ƒå¯èƒ½ä¸€äº›ä¸Šä¸‹æ–‡é…ç½®ä¸ä¸€æ ·ã€æ•°æ®åº“è¿æ¥ä¸ä¸€æ ·ç­‰ã€‚Spring æä¾›äº† Profile æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¹‹é—´åˆ‡æ¢ã€‚</p><p>å¤ä¹ ä¸€ä¸‹é…ç½®æ–‡ä»¶çš„æ–¹å¼çš„è¯ä¹‹é—´ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š</p><p><code>application-{profile}.properties</code> æˆ–<code>application-{profile}.yml</code></p><p>ç„¶ååœ¨ <code>application.properties</code> æˆ–<code>application.yml</code> ä¸­æ¿€æ´»Profileä½¿ç”¨æœºåˆ¶ï¼š</p><p>å¦‚ï¼š</p><pre><code>spring.profiles.active=dev</code></pre><p>è¿™é‡Œä¸»è¦å­¦ä¹ çš„æ˜¯æ³¨è§£æ–¹å¼ã€‚</p><p>åœ¨ Spring ä¸­å­˜åœ¨ä¸¤ä¸ª å‚æ•°å¯ä»¥æä¾›ç»™é…ç½®ï¼Œä»¥ä¿®æ”¹å¯åŠ¨ Profile æœºåˆ¶ï¼Œ ä¸€ä¸ªæ˜¯<code>spring.profiles.active</code> ï¼Œ å¦ä¸€ä¸ªæ˜¯ <code>spring profiles.default</code> ã€‚åœ¨è¿™ä¸¤ä¸ªå±æ€§éƒ½æ²¡æœ‰é…ç½®çš„æƒ…å†µä¸‹ ï¼Œ Spring å°†ä¸ä¼šå¯ åŠ¨ Profile æœºåˆ¶ï¼Œè¿™å°±æ„å‘³ç€è¢«<code>ï¼ Profile</code> æ ‡æ³¨çš„ Bean å°†ä¸ä¼šè¢« Spring è£…é…åˆ° <code>IoC</code> å®¹å™¨ä¸­ ã€‚ Springæ˜¯å…ˆåˆ¤å®šæ˜¯å¦å­˜åœ¨<code>spring.profiles.active</code>é…ç½®åå†å»æŸ¥æ‰¾ <code>spring profiles.default</code> é…ç½®çš„ï¼Œæ‰€ä»¥<code>spring.profiles.active</code>çš„ä¼˜å…ˆçº§è¦å¤§äº <code>spring profiles.default</code> ã€‚</p><p>åœ¨Java å¯åŠ¨é¡¹ç›®æ—¶ï¼Œå¦‚æœä¸åœ¨é…ç½®æ–‡ä»¶æ¿€æ´»ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹é…ç½®ä¹Ÿå¯ä»¥å¯åŠ¨Profile æœºåˆ¶ï¼š</p><pre><code>JAVA_OPTS=&quot;-Dspring.profiles.active=dev&quot;</code></pre><p>å¦‚æœåœ¨å…¨å±€é…ç½®æ–‡ä»¶å’Œprofileé…ç½®æ–‡ä»¶æœ‰ç›¸åŒé…ç½®ï¼Œæ ¹æ®Spring Bootè§„åˆ™ï¼Œå¦‚æœé…ç½®äº†profileæ¿€æ´»ï¼Œé‚£ä¹ˆ<code>application- {profile} . properties</code> æ–‡ä»¶å»ä»£æ›¿åŸæ¥é»˜è®¤çš„ <code>app lication.properties</code> æ–‡ä»¶ï¼Œç›¸åŒå±æ€§ä¼šè¦†ç›–ï¼Œä¸åŒå±æ€§åˆ™åˆå¹¶ã€‚</p><p>æ¯”å¦‚å¼€å‘ç¯å¢ƒï¼Œå¯¹æ—¥å¿—æ‰“å°ä½¿ç”¨è¾ƒå¤šï¼Œä½†ç”Ÿäº§ç¯å¢ƒè¾ƒå°‘ã€‚</p><h2 id="å…«ã€XMLå¼•å…¥Bean"><a href="#å…«ã€XMLå¼•å…¥Bean" class="headerlink" title="å…«ã€XMLå¼•å…¥Bean"></a>å…«ã€XMLå¼•å…¥Bean</h2><p>SpringBoot å»ºè®®ä½¿ç”¨æ³¨è§£å’Œæ‰«æé…ç½®Beanï¼Œä½†åŒæ ·æ”¯æŒXMLé…ç½®Beanã€‚</p><p>åœ¨SpringBoot ä¸­ä½¿ç”¨XML å¯¹Bean è¿›è¡Œé…ç½®ï¼Œéœ€è¦ä½¿ç”¨<code>@ImportResource</code>æ³¨è§£å¼•å…¥å¯¹åº”çš„ XML æ–‡ä»¶ï¼Œç”¨ä»¥ä»·å€¼Beanã€‚ æœ‰äº›æ¡†æ¶ï¼ˆå¦‚Dubboç­‰ï¼‰æ˜¯åŸºäºSpring XML æ–¹å¼å¼€å‘ï¼Œè¿™æ—¶å°±éœ€è¦å¼•å…¥XML æ–¹å¼æ¥å®ç°é…ç½®ã€‚</p><p>æ¯”å¦‚æœ‰ä¸ªæƒ³åŠ è½½çš„Beanï¼Œå³ä½¿æ˜¯ä¸ªæ™®é€šçš„POJOä¹Ÿè¡Œï¼Œç„¶åå»ºä¸ª<code>spring-other.xml</code>æ–‡ä»¶ï¼Œæ¥ç€é…ç½®Beanã€‚</p><p>åœ¨java é…ç½®æ–‡ä»¶ä¸­ç›´æ¥è½½å…¥ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>config<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>ComponentScan<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>ImportResource<span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.smallrose.web.app.*"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ImportResource</span><span class="token punctuation">(</span>value<span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"classpath:spring-other.xml"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><h2 id="ä¹ã€Spring-EL"><a href="#ä¹ã€Spring-EL" class="headerlink" title="ä¹ã€Spring EL"></a>ä¹ã€Spring EL</h2><p>ä¸ºäº†è£…é…Bean æ›´åŠ çµæ´»ï¼ŒSpring æä¾›äº†è¡¨è¾¾å¼è¯­è¨€ Spring EL ã€‚ä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š</p><h3 id="ï¼ˆ1ï¼‰è¯»å–å±æ€§æ–‡ä»¶"><a href="#ï¼ˆ1ï¼‰è¯»å–å±æ€§æ–‡ä»¶" class="headerlink" title="ï¼ˆ1ï¼‰è¯»å–å±æ€§æ–‡ä»¶"></a>ï¼ˆ1ï¼‰è¯»å–å±æ€§æ–‡ä»¶</h3><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${database.driverName}"</span><span class="token punctuation">)</span>String driver <span class="token punctuation">;</span></code></pre><p><code>@Value</code> ä¸­çš„<code>${ }</code> ä»£è¡¨å ä½ç¬¦ï¼Œå®ƒä¼šå»è¯»ä¸Šä¸‹æ–‡çš„å±æ€§å€¼è£…é…åˆ°å±æ€§ä¸­ã€‚</p><p>æ›´å¤šçš„å±æ€§ä¸JavaBean ç»‘å®šå‚è€ƒ <a href="bb845937.html">YAML è¯­æ³•</a></p><h3 id="ï¼ˆ2ï¼‰è°ƒç”¨æ–¹æ³•"><a href="#ï¼ˆ2ï¼‰è°ƒç”¨æ–¹æ³•" class="headerlink" title="ï¼ˆ2ï¼‰è°ƒç”¨æ–¹æ³•"></a>ï¼ˆ2ï¼‰è°ƒç”¨æ–¹æ³•</h3><p>å¦‚è®°å½•ä¸€ä¸ªBean åˆå§‹åŒ–æ—¶é—´ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{T(System).currentTimeMillis()}"</span><span class="token punctuation">)</span><span class="token keyword">private</span> Long initTime <span class="token operator">=</span> null <span class="token punctuation">;</span></code></pre><p>è¿™é‡Œé‡‡ç”¨ <code>#{ }</code>ä»£è¡¨å¯ç”¨ Spring è¡¨è¾¾å¼ï¼Œå®ƒå°†å…·æœ‰è¿ç®—çš„åŠŸèƒ½ ï¼› <code>T(...)</code>ä»£è¡¨çš„æ˜¯å¼•å…¥ç±»ï¼›</p><p>Systemæ˜¯<code>java.lang.*</code>åŒ…çš„ç±»ï¼Œè¿™æ˜¯Java é»˜è®¤åŠ è½½çš„åŒ…ï¼Œå› æ­¤å¯ä»¥ä¸å†™å…¨é™å®šåï¼Œå¦‚æœæ˜¯å…¶ä»–çš„åŒ…ï¼Œåˆ™éœ€è¦å†™å‡ºå…¨é™å®šåæ‰èƒ½å¼•ç”¨ç±»ï¼›<code>currentTimeMillis</code> æ˜¯å®ƒçš„é™æ€ï¼ˆ static ï¼‰æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è°ƒç”¨ä¸€æ¬¡<code>System.currentTimeMillis()</code>æ–¹æ³•æ¥ä¸ºè¿™ä¸ªå±æ€§èµ‹å€¼ã€‚</p><h3 id="ï¼ˆ3ï¼‰ç»™å±æ€§ç›´æ¥èµ‹å€¼ã€‚"><a href="#ï¼ˆ3ï¼‰ç»™å±æ€§ç›´æ¥èµ‹å€¼ã€‚" class="headerlink" title="ï¼ˆ3ï¼‰ç»™å±æ€§ç›´æ¥èµ‹å€¼ã€‚"></a>ï¼ˆ3ï¼‰ç»™å±æ€§ç›´æ¥èµ‹å€¼ã€‚</h3><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{'ä½¿ç”¨spring EL èµ‹å€¼å­—ç¬¦ä¸²'}"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//å­—ç¬¦ä¸²èµ‹å€¼</span><span class="token keyword">private</span> String str <span class="token operator">=</span> null<span class="token punctuation">;</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{9.3E3}"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//ç§‘å­¦è®¡æ•°æ³•èµ‹å€¼</span><span class="token keyword">private</span> <span class="token keyword">double</span> d <span class="token punctuation">;</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{3.14}"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æµ®ç‚¹æ•°èµ‹å€¼</span><span class="token keyword">private</span> <span class="token keyword">float</span> pi <span class="token punctuation">;</span></code></pre><p>è¿˜å¯ä»¥è·å–å…¶ä»–Spring Bean çš„å±æ€§æ¥ç»™å½“å‰ Bean å±æ€§èµ‹å€¼ï¼Œå¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{beanName.str}"</span><span class="token punctuation">)</span><span class="token keyword">private</span> String otherBeanProp <span class="token operator">=</span> null<span class="token punctuation">;</span></code></pre><p>æ³¨æ„ ï¼Œè¿™é‡Œçš„ beanName æ˜¯ Spring IoC å®¹å™¨ Bean çš„åç§° ã€‚ str æ˜¯å…¶å±æ€§ï¼Œä»£è¡¨å¼•ç”¨å¯¹åº”çš„ Bean çš„å±æ€§ç»™å½“å‰å±æ€§èµ‹å€¼ã€‚å¦‚æœæƒ³æŠŠè¿™ä¸ªå±æ€§çš„å­—æ¯å…¨éƒ¨å˜å¤§å†™è¿˜å¯ä»¥è¿™æ ·ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{beanName.str?.toUpperCase()}"</span><span class="token punctuation">)</span><span class="token keyword">private</span> String otherBeanProp <span class="token operator">=</span> null <span class="token punctuation">;</span></code></pre><p>æ³¨æ„è¿™é‡Œçš„ Spring ELã€‚è¿™é‡Œå¼•ç”¨ç”±å±æ€§åè·Ÿç€æ˜¯ä¸€ä¸ª<code>ï¼Ÿ</code>ï¼Œè¿™ä¸ªç¬¦å· çš„å«ä¹‰æ˜¯åˆ¤æ–­è¿™ä¸ªå±æ€§æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ä¸ºç©ºæ‰ä¼šå»æ‰§è¡Œ toUppercase æ–¹æ³•ï¼Œè¿›è€ŒæŠŠå¼•ç”¨åˆ°çš„å±æ€§è½¬æ¢ä¸ºå¤§å†™ï¼Œèµ‹äºˆå½“å‰å±æ€§ã€‚</p><h3 id="ï¼ˆ4ï¼‰å…¶ä»–è¿ç®—"><a href="#ï¼ˆ4ï¼‰å…¶ä»–è¿ç®—" class="headerlink" title="ï¼ˆ4ï¼‰å…¶ä»–è¿ç®—"></a>ï¼ˆ4ï¼‰å…¶ä»–è¿ç®—</h3><p>å¯ä»¥ä½¿ç”¨ Spring EL è¿›è¡Œä¸€å®šçš„è¿ç®—ã€‚å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æ•°å­¦è¿ç®—</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{1+2}"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token keyword">int</span> addsum <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æµ®ç‚¹æ¯”è¾ƒè¿ç®—</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{beanName.pi == 3.14f}"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token keyword">int</span> piFlag <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{ beanName.str eq 'Spring Boot' }"</span><span class="token punctuation">)</span>pri<span class="token punctuation">.</span>vate <span class="token keyword">boolean</span> strFlag <span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å­—ç¬¦ä¸²è¿æ¥</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{beanName.str + ' è¿æ¥å­—ç¬¦ä¸² '}"</span>ï¼‰<span class="token keyword">private</span> String strApp <span class="token operator">=</span> null <span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ï¼ƒä¸‰å…ƒè¿ç®—</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{beanName.d > 1000 ï¼Ÿ 'å¤§äº' ï¼š'å°äº'}"</span> ï¼‰<span class="token keyword">private</span> String resultDesc <span class="token operator">=</span> null <span class="token punctuation">;</span></code></pre><p>Spring EL èƒ½å¤Ÿæ”¯æŒçš„è¿ç®—è¿˜æœ‰å¾ˆå¤šï¼Œå…¶ä¸­ç­‰å€¼æ¯”è¾ƒå¦‚æœæ˜¯æ•°å­—å‹çš„å¯ ä»¥ä½¿ç”¨<code>==</code>æ¯”è¾ƒç¬¦ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²å‹çš„å¯ä»¥ä½¿ç”¨ <code>eq</code> æ¯”è¾ƒç¬¦ã€‚å½“ç„¶ ï¼Œ Spring EL çš„å†…å®¹è¿œä¸æ­¢è¿™äº›ï¼Œåª æ˜¯å…¶ä»–è¡¨è¾¾å¼çš„ä½¿ç”¨ç‡æ²¡æœ‰é‚£ä¹ˆé«˜    </p><p>â€‹     </p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IoC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Matery æ·»åŠ åŠ è½½åŠ¨ç”»</title>
      <link href="/posts/7496029d.html"/>
      <url>/posts/7496029d.html</url>
      
        <content type="html"><![CDATA[<h2 id="Matery-æ·»åŠ åŠ è½½åŠ¨ç”»"><a href="#Matery-æ·»åŠ åŠ è½½åŠ¨ç”»" class="headerlink" title="Matery æ·»åŠ åŠ è½½åŠ¨ç”»"></a>Matery æ·»åŠ åŠ è½½åŠ¨ç”»</h2><p>Matery æ·»åŠ è¿‡æ¸¡çš„åŠ è½½åŠ¨ç”»ï¼Œå¯¹äºåŠ è½½é€Ÿåº¦è¾ƒæ…¢æ˜¯ä¸€ç§å‹å¥½çš„è§£å†³æ–¹å¼ã€‚</p><p>èµ·åˆæˆ‘ä½¿ç”¨å¤§ä½¬çš„æ–¹æ¡ˆï¼š<a href="https://yafine-blog.cn/posts/7400.html" target="_blank" rel="noopener">Matery ä¸»é¢˜æ·»åŠ  loading-pages</a></p><p>å¼€å§‹ä¹Ÿæ­£å¸¸ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œä»Šå¤©å‘ç°åŠ è½½åŠ¨ç”»ä¸è§äº†ï¼Ÿ</p><p>ç„¶åå®‰è£…å¤§ä½¬çš„æ–¹æ¡ˆå†æ¥ä¸€éï¼Œæ˜¾ç¤ºä¸å‡ºæ¥ï¼Œå…¶å®æˆ‘å¹¶æ²¡æœ‰æ”¹ä»€ä¹ˆï¼Œå°±æ˜¯æ”¹ä¸‹åœç•™æ—¶é—´ï¼Œå¥½ä¸å®¹æ˜“æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œä½†æ˜¯æˆ‘å‘ç°åŸæœ¬åœ¨ <code>&lt;head&gt;</code> åŒºçš„ä»£ç è·‘åˆ°äº† <code>&lt;body&gt;</code> åŒºï¼Œå…¶å®å¤§ä½¬çš„æ–¹æ¡ˆå¯¹äºä½¿ç”¨å®Œå…¨æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p><p>å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</p><p>é‚£ä¹ˆæˆ‘ä¸ºä»€ä¹ˆè¦æŠ˜è…¾è¿™ç¯‡æ–‡ç« å‘¢ï¼Ÿ</p><p>å› ä¸ºæˆ‘æ˜¯ä¸ªè¿½æ±‚å®Œç¾çš„äººï¼Œå¥½å§ï¼Œå°±è¿™ä¹ˆè¯´è¯´ï¼Œä¿¡ä¸ä¿¡ä¸é‡è¦äº†~</p><p>åæ­£å°±æ˜¯æƒ³ä»£ç æ˜¾ç¤ºçš„æ­£å¸¸ä¸€ç‚¹ï¼Œå…¶å®æ˜¯æ‹…å¿ƒä¼šä¸ä¼šå½±å“æœç´¢ä»€ä¹ˆçš„â€¦</p><p>æ‰€ä»¥å°±æŒ‰ç…§å¤§ä½¬ä»£ç ï¼Œå˜æ¢äº†ä¸€ä¸‹ç»“æ„ã€‚</p><h3 id="1ã€åœ¨-layout-partial-ç›®å½•æ–°å»ºä¸€ä¸ª-loading-pages-ejs-å†…å®¹å¦‚ä¸‹ï¼š"><a href="#1ã€åœ¨-layout-partial-ç›®å½•æ–°å»ºä¸€ä¸ª-loading-pages-ejs-å†…å®¹å¦‚ä¸‹ï¼š" class="headerlink" title="1ã€åœ¨ /layout/_partial/ ç›®å½•æ–°å»ºä¸€ä¸ª loading-pages.ejs å†…å®¹å¦‚ä¸‹ï¼š"></a>1ã€åœ¨ <code>/layout/_partial/</code> ç›®å½•æ–°å»ºä¸€ä¸ª <code>loading-pages.ejs</code> å†…å®¹å¦‚ä¸‹ï¼š</h3><p>å¦‚æœä½ å‘ç°äº†çˆ†çº¢ä»€ä¹ˆçš„ï¼Œä¸è¦æ‹…å¿ƒã€‚</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css">    <span class="token selector"><span class="token id">#loading-container</span></span><span class="token punctuation">{</span>        <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>        <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">min-height</span><span class="token punctuation">:</span> <span class="token number">100</span>vh<span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>vw<span class="token punctuation">;</span>        <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">9999</span><span class="token punctuation">;</span>        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>        <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>        <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>        <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode">#FFF</span><span class="token punctuation">;</span>        <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/* loaderé¡µé¢æ¶ˆå¤±é‡‡ç”¨æ¸éšçš„æ–¹å¼*/</span>        <span class="token property">-webkit-transition</span><span class="token punctuation">:</span> opacity <span class="token number">1</span>s ease<span class="token punctuation">;</span>        <span class="token property">-moz-transition</span><span class="token punctuation">:</span> opacity <span class="token number">1</span>s ease<span class="token punctuation">;</span>        <span class="token property">-o-transition</span><span class="token punctuation">:</span> opacity <span class="token number">1</span>s ease<span class="token punctuation">;</span>        <span class="token property">transition</span><span class="token punctuation">:</span> opacity <span class="token number">1</span>s ease<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.loading-image</span></span><span class="token punctuation">{</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">120</span>px<span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">50</span>px<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-<span class="token number">50%</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.loading-image</span> div<span class="token pseudo-class">:nth-child(2)</span> </span><span class="token punctuation">{</span>        <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> pacman-balls <span class="token number">1</span>s linear <span class="token number">0</span>s infinite<span class="token punctuation">;</span>        <span class="token property">animation</span><span class="token punctuation">:</span> pacman-balls <span class="token number">1</span>s linear <span class="token number">0</span>s infinite    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.loading-image</span> div<span class="token pseudo-class">:nth-child(3)</span> </span><span class="token punctuation">{</span>        <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> pacman-balls <span class="token number">1</span>s linear <span class="token number">.33</span>s infinite<span class="token punctuation">;</span>        <span class="token property">animation</span><span class="token punctuation">:</span> pacman-balls <span class="token number">1</span>s linear <span class="token number">.33</span>s infinite    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.loading-image</span> div<span class="token pseudo-class">:nth-child(4)</span> </span><span class="token punctuation">{</span>        <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> pacman-balls <span class="token number">1</span>s linear <span class="token number">.66</span>s infinite<span class="token punctuation">;</span>        <span class="token property">animation</span><span class="token punctuation">:</span> pacman-balls <span class="token number">1</span>s linear <span class="token number">.66</span>s infinite    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.loading-image</span> div<span class="token pseudo-class">:nth-child(5)</span> </span><span class="token punctuation">{</span>        <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> pacman-balls <span class="token number">1</span>s linear <span class="token number">.99</span>s infinite<span class="token punctuation">;</span>        <span class="token property">animation</span><span class="token punctuation">:</span> pacman-balls <span class="token number">1</span>s linear <span class="token number">.99</span>s infinite    <span class="token punctuation">}</span>   <span class="token selector"><span class="token class">.loading-image</span> div<span class="token pseudo-class">:first-of-type</span> </span><span class="token punctuation">{</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">25</span>px solid <span class="token hexcode">#49b1f5</span><span class="token punctuation">;</span>        <span class="token property">border-right-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">25</span>px<span class="token punctuation">;</span>        <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> rotate_pacman_half_up <span class="token number">.5</span>s <span class="token number">0</span>s infinite<span class="token punctuation">;</span>        <span class="token property">animation</span><span class="token punctuation">:</span> rotate_pacman_half_up <span class="token number">.5</span>s <span class="token number">0</span>s infinite<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.loading-image</span> div<span class="token pseudo-class">:nth-child(2)</span> </span><span class="token punctuation">{</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">25</span>px solid <span class="token hexcode">#49b1f5</span><span class="token punctuation">;</span>        <span class="token property">border-right-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">25</span>px<span class="token punctuation">;</span>        <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> rotate_pacman_half_down <span class="token number">.5</span>s <span class="token number">0</span>s infinite<span class="token punctuation">;</span>        <span class="token property">animation</span><span class="token punctuation">:</span> rotate_pacman_half_down <span class="token number">.5</span>s <span class="token number">0</span>s infinite<span class="token punctuation">;</span>        <span class="token property">margin-top</span><span class="token punctuation">:</span> -<span class="token number">50</span>px<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token atrule"><span class="token rule">@-webkit-keyframes</span> rotate_pacman_half_up</span> <span class="token punctuation">{</span><span class="token selector">0% </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">270</span>deg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token selector">50% </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">1</span>turn<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token selector">to </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">270</span>deg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token atrule"><span class="token rule">@keyframes</span> rotate_pacman_half_up</span> <span class="token punctuation">{</span><span class="token selector">0% </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">270</span>deg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token selector">50% </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">1</span>turn<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token selector">to </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">270</span>deg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token atrule"><span class="token rule">@-webkit-keyframes</span> rotate_pacman_half_down</span> <span class="token punctuation">{</span><span class="token selector">0% </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">90</span>deg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token selector">50% </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">0</span>deg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token selector">to </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">90</span>deg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token atrule"><span class="token rule">@keyframes</span> rotate_pacman_half_down</span> <span class="token punctuation">{</span><span class="token selector">0% </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">90</span>deg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token selector">50% </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">0</span>deg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token selector">to </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">90</span>deg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token atrule"><span class="token rule">@-webkit-keyframes</span> pacman-balls</span> <span class="token punctuation">{</span><span class="token selector">75% </span><span class="token punctuation">{</span><span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">.7</span><span class="token punctuation">}</span><span class="token selector">to </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-<span class="token number">100</span>px, -<span class="token number">6.25</span>px<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token atrule"><span class="token rule">@keyframes</span> pacman-balls</span> <span class="token punctuation">{</span><span class="token selector">75% </span><span class="token punctuation">{</span><span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">.7</span><span class="token punctuation">}</span><span class="token selector">to </span><span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-<span class="token number">100</span>px, -<span class="token number">6.25</span>px<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.loading-image</span> div<span class="token pseudo-class">:nth-child(3)</span>,    <span class="token class">.loading-image</span> div<span class="token pseudo-class">:nth-child(4)</span>,    <span class="token class">.loading-image</span> div<span class="token pseudo-class">:nth-child(5)</span>,    <span class="token class">.loading-image</span> div<span class="token pseudo-class">:nth-child(6)</span></span><span class="token punctuation">{</span>        <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#49b1f5</span><span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">15</span>px<span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">15</span>px<span class="token punctuation">;</span>        <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span>        <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">2</span>px<span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-<span class="token number">6.25</span>px<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">25</span>px<span class="token punctuation">;</span>        <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.loading-text</span></span><span class="token punctuation">{</span>        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span>vh<span class="token punctuation">;</span>        <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#2c3e50</span><span class="token punctuation">;</span>        <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">2</span>rem<span class="token punctuation">;</span>        <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>        <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">10</span>px<span class="token punctuation">;</span>        <span class="token property">text-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">2</span>px <span class="token number">10</span>px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span>,<span class="token number">0</span>,<span class="token number">0</span>,<span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token atrule"><span class="token rule">@media</span> only screen and <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>         <span class="token selector"><span class="token class">.loading-text</span></span><span class="token punctuation">{</span>            <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1.5</span>rem<span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token selector"><span class="token class">.fadeout</span> </span><span class="token punctuation">{</span>        <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">filter</span><span class="token punctuation">:</span> <span class="token function">alpha</span><span class="token punctuation">(</span>opacity=<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/* logoå‡ºç°åŠ¨ç”» */</span>    <span class="token atrule"><span class="token rule">@-webkit-keyframes</span> fadeInDown</span><span class="token punctuation">{</span><span class="token selector">0%</span><span class="token punctuation">{</span><span class="token property">opacity</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token property">-webkit-transform</span><span class="token punctuation">:</span>translate<span class="token number">3</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token number">0</span>,-<span class="token number">100%</span>,<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">transform</span><span class="token punctuation">:</span>translate<span class="token number">3</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token number">0</span>,-<span class="token number">100%</span>,<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token selector">100%</span><span class="token punctuation">{</span><span class="token property">opacity</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token property">-webkit-transform</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span><span class="token property">transform</span><span class="token punctuation">:</span>none<span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token atrule"><span class="token rule">@keyframes</span> fadeInDown</span><span class="token punctuation">{</span><span class="token selector">0%</span><span class="token punctuation">{</span><span class="token property">opacity</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token property">-webkit-transform</span><span class="token punctuation">:</span>translate<span class="token number">3</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token number">0</span>,-<span class="token number">100%</span>,<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> loaded <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">const</span> loader <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"loading-container"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            loader<span class="token punctuation">.</span>className<span class="token operator">=</span><span class="token string">"fadeout"</span> <span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä½¿ç”¨æ¸éšçš„æ–¹æ³•æ·¡å‡ºloading page</span>            <span class="token comment" spellcheck="true">// document.getElementById("body-wrap").style.display="flex";</span>            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                loader<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å¼ºåˆ¶æ˜¾ç¤ºloading page 1s  </span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">loaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="2ã€åœ¨ä¸»é¢˜çš„-layout-ç›®å½•æ‰¾åˆ°-layout-ejs-æ–‡ä»¶"><a href="#2ã€åœ¨ä¸»é¢˜çš„-layout-ç›®å½•æ‰¾åˆ°-layout-ejs-æ–‡ä»¶" class="headerlink" title="2ã€åœ¨ä¸»é¢˜çš„ layout ç›®å½•æ‰¾åˆ° layout.ejs æ–‡ä»¶"></a>2ã€åœ¨ä¸»é¢˜çš„ <code>layout</code> ç›®å½•æ‰¾åˆ° <code>layout.ejs</code> æ–‡ä»¶</h3><p>åœ¨ <code>&lt;body&gt;</code> é™„è¿‘æ·»åŠ å†…å®¹åå¦‚ä¸‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE HTML></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> config.language %<span class="token punctuation">></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&lt;%- partial('_partial/head') %> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">if</span> <span class="token attr-name">(theme.loadingPages.enable)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>    &lt;%- partial('_partial/loading-pages') %> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">if</span> <span class="token attr-name">(theme.loadingPages.enable)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å˜˜~  æ­£åœ¨ä»æœåŠ¡å™¨å·å–é¡µé¢ . . . <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-image<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>    &lt;%- partial('_partial/header') %>    ...</code></pre><h3 id="3ã€æ·»åŠ å¼€å…³é…ç½®"><a href="#3ã€æ·»åŠ å¼€å…³é…ç½®" class="headerlink" title="3ã€æ·»åŠ å¼€å…³é…ç½®"></a>3ã€æ·»åŠ å¼€å…³é…ç½®</h3><pre class=" language-yml"><code class="language-yml">loadingPages:  enable: true  </code></pre><p><code>enable</code> è®¾ç½®ä¸º <code>true</code> è¡¨ç¤ºå¼€å¯åŠ è½½åŠ¨ç”»ï¼Œ <code>false</code> è¡¨ç¤ºå…³é—­åŠ è½½åŠ¨ç”»ã€‚</p><h3 id="4ã€å¤§åŠŸå‘Šæˆ"><a href="#4ã€å¤§åŠŸå‘Šæˆ" class="headerlink" title="4ã€å¤§åŠŸå‘Šæˆ"></a>4ã€å¤§åŠŸå‘Šæˆ</h3><pre class=" language-bash"><code class="language-bash">hexo clean <span class="token operator">&amp;&amp;</span> hexo g <span class="token operator">&amp;&amp;</span> hexo s</code></pre><p>çœ‹çœ‹æ•ˆæœå§~</p><br/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx å¿«é€Ÿä¸Šæ‰‹</title>
      <link href="/posts/35e29c2a.html"/>
      <url>/posts/35e29c2a.html</url>
      
        <content type="html"><![CDATA[<h1 id="Nginx-å¿«é€Ÿä¸Šæ‰‹"><a href="#Nginx-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="Nginx å¿«é€Ÿä¸Šæ‰‹"></a>Nginx å¿«é€Ÿä¸Šæ‰‹</h1><p>å‰è¨€</p><blockquote><p>å»å¹´çš„æ—¶å€™ä½¿ç”¨ <code>SpringBoot</code> å¼€å‘äº†è‡ªå·±çš„åšå®¢ï¼Œç„¶éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ä¸Šï¼Œå°±æ˜¯ä½¿ç”¨ <code>Nginx</code> å’Œ <code>Tomcat</code> éƒ¨ç½²çš„ï¼Œ ç›¸å…³çš„åå‘ä»£ç†æˆ–è€…è´Ÿè½½å‡è¡¡è™½ç„¶ç¡®å®å®æ“è¿‡ï¼Œä½†æ˜¯éƒ½æ˜¯ç°æ‰¾å…¶ä»–äººçš„åšå®¢æ“ä½œçš„ï¼Œå°±æ˜¯è¿›è¡Œäº†å¿«é€Ÿçš„å­¦ä¹ å’Œäº†è§£ï¼Œä½†æ˜¯æ²¡æœ‰ç³»ç»Ÿå­¦ä¹ ã€‚ä¹‹æ‰€ä»¥è¦æ•´ç†å°±æ˜¯ä¸ºäº†ç³»ç»Ÿæ€§çš„å­¦ä¹ ä¸€ä¸‹å¹¶æ•´ç†ä¸€ä¸‹ã€‚ä¹Ÿæ–¹ä¾¿å¿˜äº†æ—¶åŠæ—¶æŸ¥é˜…æ¸©ä¹ ã€‚ </p></blockquote><h2 id="ä¸€ã€Nginx-å¿«é€Ÿç†Ÿæ‚‰"><a href="#ä¸€ã€Nginx-å¿«é€Ÿç†Ÿæ‚‰" class="headerlink" title="ä¸€ã€Nginx å¿«é€Ÿç†Ÿæ‚‰"></a>ä¸€ã€Nginx å¿«é€Ÿç†Ÿæ‚‰</h2><h3 id="1ã€äº†è§£"><a href="#1ã€äº†è§£" class="headerlink" title="1ã€äº†è§£"></a>1ã€äº†è§£</h3><p>Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚</p><p>Nginx å¯ä»¥ä½œä¸ºé™æ€é¡µé¢çš„ web æœåŠ¡å™¨ï¼ŒåŒæ—¶è¿˜æ”¯æŒ CGI åè®®çš„åŠ¨æ€è¯­è¨€ï¼Œæ¯”å¦‚ perlã€ php<br>ç­‰ã€‚ä½†æ˜¯ä¸æ”¯æŒ javaã€‚ Java ç¨‹åºåªèƒ½é€šè¿‡ä¸ tomcat é…åˆå®Œæˆã€‚</p><h3 id="2ã€ç‰¹ç‚¹"><a href="#2ã€ç‰¹ç‚¹" class="headerlink" title="2ã€ç‰¹ç‚¹"></a>2ã€ç‰¹ç‚¹</h3><p>ï¼ˆ1ï¼‰å æœ‰å†…å­˜å°‘ï¼Œ<br>ï¼ˆ2ï¼‰å¹¶å‘èƒ½åŠ›å¼ºï¼ˆæ®è¯´æœ‰æŠ¥å‘Šè¡¨æ˜èƒ½æ”¯æŒé«˜è¾¾ 50,000 ä¸ªå¹¶å‘è¿æ¥æ•°  ï¼‰<br>ï¼ˆ3ï¼‰æ”¯æŒåå‘ä»£ç†<br>ï¼ˆ4ï¼‰æ”¯æŒè´Ÿè½½å‡è¡¡<br>ï¼ˆ5ï¼‰æ”¯æŒåŠ¨é™åˆ†ç¦»</p><h3 id="3ã€åå‘ä»£ç†"><a href="#3ã€åå‘ä»£ç†" class="headerlink" title="3ã€åå‘ä»£ç†"></a>3ã€åå‘ä»£ç†</h3><p>åœ¨å®¢æˆ·ç«¯è®¿é—®é¡µé¢æ—¶å°†è¯·æ±‚å‘é€åˆ°åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±åå‘ä»£ç†æœåŠ¡å™¨å»é€‰æ‹©ç›®æ ‡æœåŠ¡å™¨è·å–æ•°æ®åï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶åå‘ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨å¯¹å¤–å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæš´éœ²çš„æ˜¯ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œéšè—äº†çœŸå®æœåŠ¡å™¨ IP åœ°å€åŠç«¯å£ã€‚</p><h3 id="4ã€è´Ÿè½½å‡è¡¡"><a href="#4ã€è´Ÿè½½å‡è¡¡" class="headerlink" title="4ã€è´Ÿè½½å‡è¡¡"></a>4ã€è´Ÿè½½å‡è¡¡</h3><p>å•ä¸ªæœåŠ¡å™¨æˆ–æå‡ç¡¬ä»¶æ¯”è¾ƒéš¾ä»¥è§£å†³è®¿é—®é‡å’Œæ•°æ®é‡çš„å¢é•¿å¯¼è‡´è¯·æ±‚ç¼“æ…¢æˆ–å®•æœºçš„èƒŒæ™¯ä¸‹ï¼Œå‡ºç°é›†ç¾¤æ¦‚å¿µã€‚å¢åŠ æœåŠ¡å™¨çš„æ•°é‡ï¼Œç„¶åå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†åŸå…ˆè¯·æ±‚é›†ä¸­åˆ°å•ä¸ªæœåŠ¡å™¨ä¸Šçš„æƒ…å†µæ”¹ä¸ºå°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†è´Ÿè½½åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯æ‰€è¯´çš„è´Ÿè½½å‡è¡¡ã€‚</p><h3 id="5ã€åŠ¨é™åˆ†ç¦»"><a href="#5ã€åŠ¨é™åˆ†ç¦»" class="headerlink" title="5ã€åŠ¨é™åˆ†ç¦»"></a>5ã€åŠ¨é™åˆ†ç¦»</h3><p>ä¸ºäº†åŠ å¿«ç½‘ç«™çš„è§£æé€Ÿåº¦ï¼Œå¯ä»¥æŠŠåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç”±ä¸åŒçš„æœåŠ¡å™¨æ¥è§£æï¼ŒåŠ å¿«è§£æé€Ÿ<br>åº¦ã€‚é™ä½åŸæ¥å•ä¸ªæœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><p>åŠ¨é™åˆ†ç¦»çš„æ–¹å¼ï¼š</p><p>ï¼ˆ1ï¼‰ç»Ÿä¸€éƒ¨ç½²ï¼Œé™æ€è¯·æ±‚è§£æåˆ°æŒ‡å®šé™æ€èµ„æºç›®å½•ã€‚<br>ï¼ˆ2ï¼‰åˆ†å¼€éƒ¨ç½²ï¼Œé™æ€è¯·æ±‚è½¬å‘åˆ°é™æ€èµ„æºæœåŠ¡å™¨ã€‚</p><h2 id="äºŒã€Nginx-å®‰è£…"><a href="#äºŒã€Nginx-å®‰è£…" class="headerlink" title="äºŒã€Nginx å®‰è£…"></a>äºŒã€Nginx å®‰è£…</h2><p>Nginx å®‰è£…åˆ†ä¸ºä¸¤ç§æ–¹å¼ã€‚å…¶å®ä¹Ÿä¸æ˜¯å®˜æ–¹çš„ã€‚</p><h3 id="1ã€é€šç”¨æ–¹å¼"><a href="#1ã€é€šç”¨æ–¹å¼" class="headerlink" title="1ã€é€šç”¨æ–¹å¼"></a>1ã€é€šç”¨æ–¹å¼</h3><p>ç¬¬ä¸€æ­¥ï¼Œ å®‰è£… pcre</p><pre class=" language-bash"><code class="language-bash"><span class="token function">wget</span> http://downloads.sourceforge.net/project/pcre/pcre/8.37/pcre-8.37.tar.gz</code></pre><p>PCRE(Perl Compatible Regular Expressions)æ˜¯ä¸€ä¸ªPerlåº“ï¼ŒåŒ…æ‹¬ perl å…¼å®¹çš„æ­£åˆ™è¡¨è¾¾å¼åº“ã€‚<br>nginxçš„httpæ¨¡å—ä½¿ç”¨pcreæ¥è§£ææ­£åˆ™è¡¨è¾¾å¼ï¼Œæ‰€ä»¥éœ€è¦åœ¨linuxä¸Šå®‰è£…pcreåº“ã€‚</p><p>ä¸‹è½½æˆåŠŸåè§£å‹æ–‡ä»¶</p><pre class=" language-bash"><code class="language-bash"><span class="token function">tar</span> -zxvf pcre-8.37.tar.gz</code></pre><p>è¿›å…¥ç›®å½•æ‰§è¡Œ</p><pre class=" language-bash"><code class="language-bash">./configure </code></pre><p>å®Œæˆåï¼Œå›åˆ° pcre ç›®å½•ä¸‹æ‰§è¡Œ </p><pre class=" language-bash"><code class="language-bash"><span class="token function">make</span><span class="token function">make</span> <span class="token function">install</span></code></pre><p>ç¬¬äºŒæ­¥ï¼Œ å®‰è£…ä¸€äº›éœ€è¦çš„ä¾èµ–</p><p>å®‰è£… zlibï¼Œå®‰è£… gccï¼Œå®‰è£… openssl</p><pre class=" language-bash"><code class="language-bash">yum -y <span class="token function">install</span> <span class="token function">make</span> zlib zlib-devel gcc-c++ libtool openssl openssl-devel</code></pre><p>ç¬¬ä¸‰æ­¥ï¼Œ å®‰è£… nginx</p><p>å®˜æ–¹ç½‘å€ï¼š<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a></p><p><code>Nginx</code>å®˜ç½‘æä¾›äº†ä¸‰ä¸ªç±»å‹çš„ç‰ˆæœ¬<br><code>Mainline version</code>ï¼š <code>Mainline</code> æ˜¯ <code>Nginx</code> ç›®å‰ä¸»åŠ›åœ¨åšçš„ç‰ˆæœ¬ï¼Œå¯ä»¥è¯´æ˜¯å¼€å‘ç‰ˆ<br><code>Stable version</code>ï¼š æœ€æ–°ç¨³å®šç‰ˆï¼Œç”Ÿäº§ç¯å¢ƒä¸Šå»ºè®®ä½¿ç”¨çš„ç‰ˆæœ¬<br><code>Legacy versions</code>ï¼š é—ç•™çš„è€ç‰ˆæœ¬çš„ç¨³å®šç‰ˆã€‚</p><p>å»ºè®®é€‰æ‹©ç¨³å®šç‰ˆã€‚</p><p>å¯ä»¥ç›´æ¥ä¸‹è½½åˆ°ç›®å½•ã€‚<br>ä¹Ÿå¯ä»¥ä¸‹è½½ä¹‹åå†ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p><p>1ã€ è§£å‹ç¼© <code>nginx-xx.tar.gz</code> åŒ…ã€‚</p><pre class=" language-bash"><code class="language-bash"><span class="token function">tar</span> -zxvf nginx-xx.tar.gz</code></pre><p>2ã€ è¿›å…¥è§£å‹ç¼©ç›®å½•ï¼Œ æ‰§è¡Œ<code>./configure</code>ã€‚</p><pre class=" language-bash"><code class="language-bash">./configure</code></pre><p>3ã€ æ‰§è¡Œç¼–è¯‘å®‰è£…</p><pre class=" language-bash"><code class="language-bash"><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span></code></pre><h3 id="2ã€YUMæ–¹å¼"><a href="#2ã€YUMæ–¹å¼" class="headerlink" title="2ã€YUMæ–¹å¼"></a>2ã€YUMæ–¹å¼</h3><p>1ã€æ·»åŠ æº</p><p>ã€€ã€€é»˜è®¤æƒ…å†µCentos7ä¸­æ— Nginxçš„æºï¼Œåé¢Nginxå®˜ç½‘æä¾›äº†Centosçš„æºåœ°å€ã€‚å› æ­¤å¯ä»¥å¦‚ä¸‹æ‰§è¡Œå‘½ä»¤æ·»åŠ æºï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</code></pre><p>2ã€å®‰è£…<code>Nginx</code></p><p>å¯ä»¥ä½¿ç”¨ search å‘½ä»¤ï¼š</p><pre class=" language-bash"><code class="language-bash">yum search nginx</code></pre><p>çœ‹çœ‹æ˜¯å¦å·²ç»æ·»åŠ æºæˆåŠŸã€‚å¦‚æœæˆåŠŸåˆ™æ‰§è¡Œä¸‹åˆ—å‘½ä»¤å®‰è£…<code>Nginx</code>ã€‚</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> -y nginx</code></pre><h3 id="3ã€é˜²ç«å¢™ç«¯å£ç›¸å…³"><a href="#3ã€é˜²ç«å¢™ç«¯å£ç›¸å…³" class="headerlink" title="3ã€é˜²ç«å¢™ç«¯å£ç›¸å…³"></a>3ã€é˜²ç«å¢™ç«¯å£ç›¸å…³</h3><p>å¦‚æœéœ€è¦çš„è¯ï¼Œå¯èƒ½ç”¨å¾—ä¸Šã€‚å¦‚æœæ˜¯äº‘æœåŠ¡å™¨ï¼Œè‡ªå·±ç™»å½•æ§åˆ¶å°çœ‹çœ‹ç›¸å…³ç«¯å£æ˜¯å¦å·²ç»å¼€æ”¾ã€‚</p><p>æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£å·</p><pre class=" language-bash"><code class="language-bash">firewall-cmd --list-all</code></pre><p>è®¾ç½®å¼€æ”¾çš„ç«¯å£å·</p><pre class=" language-bash"><code class="language-bash">firewall-cmd --add-service<span class="token operator">=</span>http â€“permanent<span class="token function">sudo</span> firewall-cmd --add-port<span class="token operator">=</span>80/tcp --permanent</code></pre><p>é‡å¯é˜²ç«å¢™</p><pre class=" language-bash"><code class="language-bash">firewall-cmd â€“reload</code></pre><h2 id="ä¸‰ã€Nginx-å¸¸ç”¨å‘½ä»¤"><a href="#ä¸‰ã€Nginx-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="ä¸‰ã€Nginx å¸¸ç”¨å‘½ä»¤"></a>ä¸‰ã€Nginx å¸¸ç”¨å‘½ä»¤</h2><p>å¦‚æœä½ ä¸ç¡®å®šä½ çš„ <code>Nginx</code> åˆ°åº•å®‰è£…åˆ°å“ªé‡Œäº†,ä½¿ç”¨ <code>whereis</code> å‘½ä»¤æŸ¥æ‰¾ä¸€ä¸‹ã€‚</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># whereis nginx</span>nginx: /usr/sbin/nginx /usr/lib64/nginx /etc/nginx /usr/share/nginx /usr/share/man/man8/nginx.8.gz</code></pre><h3 id="1ã€æŸ¥çœ‹ç‰ˆæœ¬å‘½ä»¤ï¼š"><a href="#1ã€æŸ¥çœ‹ç‰ˆæœ¬å‘½ä»¤ï¼š" class="headerlink" title="1ã€æŸ¥çœ‹ç‰ˆæœ¬å‘½ä»¤ï¼š"></a>1ã€æŸ¥çœ‹ç‰ˆæœ¬å‘½ä»¤ï¼š</h3><pre class=" language-bash"><code class="language-bash">nginx -v</code></pre><h3 id="2ã€å¯åŠ¨å‘½ä»¤ï¼š"><a href="#2ã€å¯åŠ¨å‘½ä»¤ï¼š" class="headerlink" title="2ã€å¯åŠ¨å‘½ä»¤ï¼š"></a>2ã€å¯åŠ¨å‘½ä»¤ï¼š</h3><p>ï¼ˆ1ï¼‰æ‰§è¡Œæ‰§è¡Œå¯åŠ¨ï¼š</p><pre class=" language-bash"><code class="language-bash">start  nginx </code></pre><p>ï¼ˆ2ï¼‰åˆ° <code>/usr/sbin/</code> ç›®å½•æ‰§è¡Œå‘½ä»¤å¯åŠ¨ï¼š</p><pre class=" language-bash"><code class="language-bash">./nginx</code></pre><p>ï¼ˆ3ï¼‰ä¹Ÿå¯ä»¥ä½¿ç”¨Linux æ–¹å¼</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start nginx.service</code></pre><h3 id="3ã€å…³é—­å‘½ä»¤ï¼š"><a href="#3ã€å…³é—­å‘½ä»¤ï¼š" class="headerlink" title="3ã€å…³é—­å‘½ä»¤ï¼š"></a>3ã€å…³é—­å‘½ä»¤ï¼š</h3><p>ï¼ˆ1ï¼‰å¿«é€Ÿåœæ­¢æˆ–å…³é—­</p><pre class=" language-bash"><code class="language-bash">nginx stop</code></pre><p>æˆ–</p><pre class=" language-bash"><code class="language-bash">nginx -s stop</code></pre><p>ï¼ˆ2ï¼‰æ­£å¸¸åœæ­¢æˆ–å…³é—­</p><pre class=" language-bash"><code class="language-bash">nginx -s quit</code></pre><p>ï¼ˆ3ï¼‰ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Linux</code> æ–¹å¼</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start nginx.service</code></pre><h3 id="4ã€é…ç½®æ£€æŸ¥ï¼š"><a href="#4ã€é…ç½®æ£€æŸ¥ï¼š" class="headerlink" title="4ã€é…ç½®æ£€æŸ¥ï¼š"></a>4ã€é…ç½®æ£€æŸ¥ï¼š</h3><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ä¹‹åæ‰§è¡Œç”¨æ¥æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯çš„å‘½ä»¤ï¼Œå¦‚æœæœ‰ä¼šç»™å‡ºæç¤ºã€‚</p><pre class=" language-bash"><code class="language-bash">nginx -t</code></pre><h3 id="5ã€é…ç½®åŠ è½½ï¼š"><a href="#5ã€é…ç½®åŠ è½½ï¼š" class="headerlink" title="5ã€é…ç½®åŠ è½½ï¼š"></a>5ã€é…ç½®åŠ è½½ï¼š</h3><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ä¹‹åï¼Œä¸éœ€è¦é‡å¯æœåŠ¡ï¼Œæ£€æŸ¥é…ç½®æ–‡ä»¶æ­£ç¡®ä¹‹åï¼Œç›´æ¥åŠ è½½æ–°çš„é…ç½®æ–‡ä»¶çš„å‘½ä»¤ã€‚</p><pre class=" language-bash"><code class="language-bash">nginx -s reload</code></pre><h2 id="å››ã€Nginx-é…ç½®æ–‡ä»¶"><a href="#å››ã€Nginx-é…ç½®æ–‡ä»¶" class="headerlink" title="å››ã€Nginx é…ç½®æ–‡ä»¶"></a>å››ã€Nginx é…ç½®æ–‡ä»¶</h2><h3 id="1ã€nginx-é…ç½®æ–‡ä»¶ç›®å½•"><a href="#1ã€nginx-é…ç½®æ–‡ä»¶ç›®å½•" class="headerlink" title="1ã€nginx é…ç½®æ–‡ä»¶ç›®å½•"></a>1ã€nginx é…ç½®æ–‡ä»¶ç›®å½•</h3><p>ä¸€èˆ¬åœ¨ <code>nginx/conf/</code> ç›®å½•ä¸‹ï¼Œå…·ä½“ç›®å½•ä½¿ç”¨ <code>whereis</code> æ‰¾ä¸€ä¸‹ã€‚æˆ‘ä½¿ç”¨<code>yum</code> å®‰è£…ï¼Œé…ç½®æ–‡ä»¶ç›®å½•åœ¨ <code>/etc/nginx/ç›®å½•</code>ä¸‹æœ‰ä¸ª <code>nginx.conf</code> æ–‡ä»¶å°±æ˜¯é…ç½®æ–‡ä»¶ã€‚</p><p>é…ç½®æ–‡ä»¶ä¸­æœ‰å¾ˆå¤š <code>#</code> ï¼Œ <code>#</code> å¼€å¤´çš„è¡¨ç¤ºæ³¨é‡Šå†…å®¹</p><p>ç²¾ç®€çš„é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre class=" language-conf"><code class="language-conf">worker_processes  1;events {    worker_connections  1024;}http {    include       mime.types;    default_type  application/octet-stream;    sendfile        on;    keepalive_timeout  65;    server {        listen       80;        server_name  localhost;        location / {            root   html;            index  index.html index.htm;        }    }}</code></pre><h3 id="2ã€é…ç½®æ–‡ä»¶ç»†åˆ†"><a href="#2ã€é…ç½®æ–‡ä»¶ç»†åˆ†" class="headerlink" title="2ã€é…ç½®æ–‡ä»¶ç»†åˆ†"></a>2ã€é…ç½®æ–‡ä»¶ç»†åˆ†</h3><p>nginx.conf æ–‡ä»¶å¤§è‡´åˆ†ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p><p>ï¼ˆ1ï¼‰å…¨å±€å—<br>ä»é…ç½®æ–‡ä»¶å¼€å§‹åˆ° <code>events</code> å—ä¹‹é—´çš„å†…å®¹ï¼Œä¸»è¦ä¼šè®¾ç½®ä¸€äº›å½±å“ <code>nginx</code> æœåŠ¡å™¨æ•´ä½“è¿è¡Œçš„é…ç½®æŒ‡ä»¤ï¼Œä¸»è¦åŒ…æ‹¬é…ç½®è¿è¡Œ <code>Nginx</code>æœåŠ¡å™¨çš„ç”¨æˆ·ï¼ˆç»„ï¼‰ã€å…è®¸ç”Ÿæˆçš„ <code>worker process</code> æ•°ï¼Œ è¿›ç¨‹ <code>PID</code> å­˜æ”¾è·¯å¾„ã€æ—¥å¿—å­˜æ”¾è·¯å¾„å’Œç±»å‹ä»¥åŠé…ç½®æ–‡ä»¶çš„å¼•å…¥ç­‰ã€‚<br>æ¯”å¦‚ç¬¬ä¸€è¡Œé…ç½®ï¼š</p><pre><code>worker_processes 1;</code></pre><p>è¿™æ˜¯ Nginx æœåŠ¡å™¨å¹¶å‘å¤„ç†æœåŠ¡çš„å…³é”®é…ç½®ï¼Œ <code>worker_processes</code> å€¼è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒçš„å¹¶å‘å¤„ç†é‡ä¹Ÿè¶Šå¤šï¼Œä½†æ˜¯ä¼šå—åˆ°ç¡¬ä»¶ã€è½¯ä»¶ç­‰è®¾å¤‡çš„åˆ¶çº¦ã€‚</p><p>ï¼ˆ2ï¼‰events å—</p><p>â€‹    <code>events</code> å—æ¶‰åŠçš„æŒ‡ä»¤ä¸»è¦å½±å“ Nginx æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼Œå¸¸ç”¨çš„è®¾ç½®åŒ…æ‹¬æ˜¯å¦å¼€å¯å¯¹å¤š <code>work process</code>ä¸‹çš„ç½‘ç»œè¿æ¥è¿›è¡Œåºåˆ—åŒ–ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹æ¥å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ¯ä¸ª <code>work  process</code> å¯ä»¥åŒæ—¶æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ç­‰ã€‚</p><p>ä¸Šè¿°ä¾‹å­å°±è¡¨ç¤ºæ¯ä¸ª <code>work process</code> æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ä¸º 1024ã€‚</p><p>è¿™éƒ¨åˆ†çš„é…ç½®å¯¹ Nginx çš„æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œåœ¨å®é™…ä¸­åº”è¯¥çµæ´»é…ç½®ã€‚</p><p>ï¼ˆ3ï¼‰http å—</p><p>â€‹    <code>Nginx</code> æœåŠ¡å™¨é…ç½®ä¸­æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜å’Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½åœ¨è¿™é‡Œã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š <code>http</code> å—ä¹Ÿå¯ä»¥åŒ…æ‹¬ <code>http</code> å…¨å±€å—ã€ server å—ã€‚</p><p>Aï¼‰ http å…¨å±€å—</p><p>â€‹    <code>http</code> å…¨å±€å—é…ç½®çš„æŒ‡ä»¤åŒ…æ‹¬æ–‡ä»¶å¼•å…¥ã€ <code>MIME-TYPE</code> å®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€è¿æ¥è¶…æ—¶æ—¶é—´ã€å•é“¾æ¥è¯·æ±‚æ•°ä¸Šé™ã€404ç­‰ç­‰ã€‚    </p><p>Bï¼‰  server å—</p><p>â€‹    è¿™å—å’Œè™šæ‹Ÿä¸»æœºæœ‰å¯†åˆ‡å…³ç³»ï¼Œè™šæ‹Ÿä¸»æœºä»ç”¨æˆ·è§’åº¦çœ‹ï¼Œå’Œä¸€å°ç‹¬ç«‹çš„ç¡¬ä»¶ä¸»æœºæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œè¯¥æŠ€æœ¯çš„äº§ç”Ÿæ˜¯ä¸ºäº† èŠ‚çœäº’è”ç½‘æœåŠ¡å™¨ç¡¬ä»¶æˆæœ¬ã€‚ </p><p>â€‹    æ¯ä¸ª http å—å¯ä»¥åŒ…æ‹¬å¤šä¸ª <code>server</code>å—ï¼Œè€Œæ¯ä¸ª <code>server</code> å—å°±ç›¸å½“äºä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚ è€Œæ¯ä¸ª <code>server</code> å—ä¹Ÿåˆ†ä¸ºå…¨å±€ <code>server</code> å—ï¼Œä»¥åŠå¯ä»¥åŒæ—¶åŒ…å«å¤šä¸ª <code>locaton</code> å—ã€‚ </p><p>â€‹    1)ã€å…¨å±€ server å— </p><p>â€‹    æœ€å¸¸è§çš„é…ç½®æ˜¯æœ¬è™šæ‹Ÿæœºä¸»æœºçš„ç›‘å¬é…ç½®å’Œæœ¬è™šæ‹Ÿä¸»æœºçš„åç§°æˆ– IP é…ç½®ã€‚ </p><p>â€‹    2)ã€location å— </p><p>â€‹    ä¸€ä¸ª server å—å¯ä»¥é…ç½®å¤šä¸ª location å—ã€‚ </p><p>â€‹    è¿™å—çš„ä¸»è¦ä½œç”¨æ˜¯åŸºäº Nginx æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ <code>server_name</code>/<code>uri-string</code>ï¼‰ï¼Œå¯¹è™šæ‹Ÿä¸»æœºåç§° ï¼ˆä¹Ÿå¯ä»¥æ˜¯ IP åˆ«åï¼‰ä¹‹å¤–çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ å‰é¢çš„ /uri-stringï¼‰è¿›è¡ŒåŒ¹é…ï¼Œå¯¹ç‰¹å®šçš„è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚åœ°å€å®šå‘ã€æ•°æ®ç¼“ å­˜å’Œåº”ç­”æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œè¿˜æœ‰è®¸å¤šç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ä¹Ÿåœ¨è¿™é‡Œè¿›è¡Œã€‚    </p><h2 id="äº”ã€é…ç½®å®ä¾‹"><a href="#äº”ã€é…ç½®å®ä¾‹" class="headerlink" title="äº”ã€é…ç½®å®ä¾‹"></a>äº”ã€é…ç½®å®ä¾‹</h2><h3 id="1ã€åå‘ä»£ç†é…ç½®å®ä¾‹1"><a href="#1ã€åå‘ä»£ç†é…ç½®å®ä¾‹1" class="headerlink" title="1ã€åå‘ä»£ç†é…ç½®å®ä¾‹1"></a>1ã€åå‘ä»£ç†é…ç½®å®ä¾‹1</h3><p>å‡†å¤‡å·¥ä½œï¼šå®‰è£…ä¸€ä¸ª <code>tomcat</code> å¹¶é…ç½®ç«¯å£ä¸º <code>8081</code></p><p>nginx.conf é…ç½®ï¼š</p><pre><code>server{    listen 80;    server_name www.zhangxiaocai.cn    location / {        proxy_pass http://127.0.0.1:8081 ;        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504        index index.html index.htm index.jsp;    }}</code></pre><p>å¦‚ä¸Šé…ç½®ï¼Œæˆ‘ä»¬ç›‘å¬ 80 ç«¯å£ï¼Œè®¿é—®åŸŸåä¸º <code>www.zhangxiaocai.cn</code>ï¼Œä¸åŠ ç«¯å£å·æ—¶é»˜è®¤ä¸º <code>80</code> ç«¯å£ï¼Œæ‰€ä»¥åœ¨æµè§ˆå™¨è®¿é—®è¯¥åŸŸåæ—¶ä¼šè·³è½¬åˆ° <code>127.0.0.1:8080</code>è·¯å¾„ä¸Šã€‚</p><p>æœ¬åœ°æµ‹è¯•éœ€è¦ä¿®æ”¹<code>C:/Windows/System32/drivers/etc/hosts</code>æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ ä»¥ä¸‹å†…å®¹</p><pre><code>www.zhangxiaocai.cn   127.0.0.1</code></pre><h3 id="2ã€åå‘ä»£ç†é…ç½®å®ä¾‹2"><a href="#2ã€åå‘ä»£ç†é…ç½®å®ä¾‹2" class="headerlink" title="2ã€åå‘ä»£ç†é…ç½®å®ä¾‹2"></a>2ã€åå‘ä»£ç†é…ç½®å®ä¾‹2</h3><p>å‡†å¤‡å·¥ä½œï¼šå®‰è£…2ä¸ª <code>tomcat</code> å¹¶é…ç½®ç«¯å£åˆ†åˆ«ä¸º <code>8081</code> å’Œ <code>8082</code> ï¼Œä¸ºäº†åŒºåˆ†ä¹Ÿå¯ä»¥å‡†å¤‡2ä¸ªä¸åŒçš„ <code>index.html</code> é¡µé¢ã€‚</p><p>nginx.conf é…ç½®ï¼š</p><pre><code>server{    listen 80;    server_name www.zhangxiaocai.cn    location ~ /java/ {        proxy_pass http://127.0.0.1:8081 ;        index index.html index.htm index.jsp;    }    location ~ /spring/ {        proxy_pass http://127.0.0.1:8082 ;        index index.html index.htm index.jsp;    }}</code></pre><p>æ ¹æ®è®¿é—®çš„è·¯å¾„è·³è½¬åˆ°ä¸åŒç«¯å£çš„æœåŠ¡ä¸­ nginx ç›‘å¬ç«¯å£ä¸º 80ï¼Œ </p><p>è®¿é—® <code>http://www.zhangxiaocai.cn/java/</code> ç›´æ¥è·³è½¬åˆ° <code>127.0.0.1:8081</code></p><p>è®¿é—® <code>http://www.zhangxiaocai.cn/spring/</code> ç›´æ¥è·³è½¬åˆ° <code>127.0.0.1:8082</code></p><h3 id="3ã€location-æŒ‡ä»¤è¯´æ˜"><a href="#3ã€location-æŒ‡ä»¤è¯´æ˜" class="headerlink" title="3ã€location æŒ‡ä»¤è¯´æ˜"></a>3ã€location æŒ‡ä»¤è¯´æ˜</h3><p>location æŒ‡ä»¤ç”¨äºåŒ¹é… URLã€‚ </p><p>è¯­æ³•å¦‚ä¸‹ï¼š </p><pre><code>location [ = | ~ | ~* |^~] uri {}</code></pre><p>è¯­æ³•è§„åˆ™å¤§è‡´åˆ†ä¸¤ç§ï¼š</p><p>ï¼ˆ1ï¼‰æ™®é€šè§„åˆ™ Location</p><p>æ— å‰ç¼€ï¼šæ™®é€šåŒ¹é…</p><p><code>=</code> : è¡¨ç¤ºç²¾å‡†åŒ¹é…ï¼›</p><p><code>^~</code> :  <code>^</code>è¡¨ç¤ºå–åï¼Œæ­£åˆ™å–åï¼Œå°±æ˜¯è¡¨ç¤ºä¸ç”¨æ­£åˆ™ï¼›</p><p>æ— å‰ç¼€åŒ¹é…ç¤ºä¾‹ï¼š</p><pre><code>location ~* /xxx {     # åŒ¹é…ä»»ä½•å«æœ‰xxxdçš„è¯·æ±‚ã€‚}location ~* \.(gif|jpg|jpeg)$ {     # åŒ¹é…ä»»ä½•ä»¥ gifã€jpg æˆ– jpeg ç»“å°¾çš„è¯·æ±‚ã€‚}</code></pre><p>ç²¾å‡†åŒ¹é…ç¤ºä¾‹ï¼š</p><pre><code>location = / {    # ç²¾å‡†åŒ¹é…ï¼Œä¸»æœºååä¸å¸¦ä»»ä½•å­—ç¬¦ä¸²}</code></pre><p>æ­£åˆ™å–ååŒ¹é…ç¤ºä¾‹ï¼š</p><pre><code>location ^~ /images/ { # ä¸ä½¿ç”¨æ­£åˆ™ï¼ŒåŒ¹é…ä»»ä½•ä»¥ /images/ å¼€å¤´çš„ä»»ä½•æŸ¥è¯¢å¹¶ä¸”åœæ­¢æœç´¢ã€‚}</code></pre><p>ï¼ˆ2ï¼‰æ­£åˆ™è§„åˆ™ Location</p><p><code>~</code> :  åŒºåˆ†å¤§å°å†™ï¼›</p><p><code>~*</code> :  ä¸åŒºåˆ†å¤§å°å†™ï¼›</p><p><strong>è¯­æ³•è§„åˆ™ä¼˜å…ˆçº§</strong>ï¼ˆç”±é«˜åˆ°åº•ï¼‰</p><p>ï¼ˆ1ï¼‰æœ‰ç²¾å‡†åŒ¹é…çš„ä¼˜å…ˆåŒ¹é…</p><p>ï¼ˆ2ï¼‰æ— ç²¾å‡†åŒ¹é…çš„æ‰§è¡Œæ™®é€šåŒ¹é…ï¼Œæ™®é€šåŒ¹é…ä¸­ä¼˜å…ˆæœ€å…¨/æœ€é•¿åŒ¹é…</p><p>ç¤ºä¾‹ä¸€ï¼š</p><pre class=" language-conf"><code class="language-conf">location /xxx {}</code></pre><p>æ­¤æ—¶æ™®é€šåŒ¹é…ï¼ŒåŒ¹é…æ‰€æœ‰ä»¥ /xxx å¼€å¤´çš„è·¯å¾„ã€‚</p><p>ç¤ºä¾‹äºŒï¼š</p><p>è®¿é—®åœ°å€ï¼š/uri/a/b/c/d</p><p>è§„åˆ™1ï¼š /a</p><p>è§„åˆ™2ï¼š /a/b</p><p>è§„åˆ™3ï¼š/a/b/c</p><p>è§„åˆ™3æ˜¯ä¸è®¿é—®åœ°å€æœ€é•¿åŒ¹é…</p><p>ç¤ºä¾‹ä¸‰ï¼š</p><p>è®¿é—®åœ°å€ï¼š/uri/a/b/c/d</p><p>è§„åˆ™1ï¼š~ /a</p><p>è§„åˆ™2ï¼š~ /a/b</p><p>è§„åˆ™3ï¼š~ /a/b/c</p><p>è§„åˆ™3æ˜¯ä¸è®¿é—®åœ°å€æœ€é•¿åŒ¹é…ï¼Œä½†æ˜¯æ­¤æ—¶è§„åˆ™ä¸­å¦‚æœæœ‰æ­£åˆ™åŒ¹é…ï¼Œåˆ™ä¼šå†æ¬¡è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œè§„åˆ™1ä¼šè¢«å‘½ä¸­æ‰§è¡Œ ã€‚</p><p>ï¼ˆ3ï¼‰æ— ç²¾å‡†åŒ¹é…ï¼Œæ— æ™®é€šåŒ¹é…ï¼Œæ‰§è¡Œæ­£åˆ™å–åçš„åŒ¹é…ï¼Œä¹Ÿæ˜¯æ™®é€šåŒ¹é…çš„ä¸€ç§</p><p>ï¼ˆ4ï¼‰æ‰§è¡Œæ­£åˆ™åŒ¹é…</p><p>ç¤ºä¾‹ä¸€ï¼š</p><pre><code>location ~ /xxx {}</code></pre><p>æ­¤æ—¶æ­£åˆ™åŒ¹é…ï¼ŒåŒ¹é…æ‰€æœ‰åŒ…å« /xxx çš„è·¯å¾„ï¼ŒåŒºåˆ†å¤§å°å†™ã€‚</p><p>ï¼ˆ5ï¼‰åŒ¹é…èµ·å§‹è·¯å¾„</p><pre><code>location  /xxx {    #æ­¤æ—¶æ­£åˆ™åŒ¹é…ï¼ŒåŒ¹é…æ‰€æœ‰ä»¥ /xxx å¼€å¤´çš„è·¯å¾„ï¼ŒåŒºåˆ†å¤§å°å†™ã€‚}location ~* \.(gif|jpg|jpeg)$ {     # åŒ¹é…ä»»ä½•ä»¥ gifã€jpg æˆ– jpeg ç»“å°¾çš„è¯·æ±‚ã€‚}</code></pre><p>ï¼ˆ6ï¼‰åŒ¹é…æ‰€æœ‰</p><pre><code>location / {}</code></pre><hr><p><code>=</code> ï¼šç”¨äºä¸å«æ­£åˆ™è¡¨è¾¾å¼çš„ uri å‰ï¼Œè¦æ±‚è¯·æ±‚å­—ç¬¦ä¸²ä¸ uri ä¸¥æ ¼åŒ¹é…ï¼Œå¦‚æœåŒ¹é… æˆåŠŸï¼Œå°±åœæ­¢ç»§ç»­å‘ä¸‹æœç´¢å¹¶ç«‹å³å¤„ç†è¯¥è¯·æ±‚ã€‚<br><code>~</code>ï¼šç”¨äºè¡¨ç¤º uri åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åŒºåˆ†å¤§å°å†™ã€‚<br><code>~*</code>ï¼šç”¨äºè¡¨ç¤º uri åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”ä¸åŒºåˆ†å¤§å°å†™ã€‚<br><code>^~</code>ï¼šç”¨äºä¸å«æ­£åˆ™è¡¨è¾¾å¼çš„ uri å‰ï¼Œè¦æ±‚ Nginx æœåŠ¡å™¨æ‰¾åˆ°æ ‡è¯† uri å’Œè¯·æ±‚å­— ç¬¦ä¸²åŒ¹é…åº¦æœ€é«˜çš„ location åï¼Œç«‹å³ä½¿ç”¨æ­¤ location å¤„ç†è¯·æ±‚ï¼Œè€Œä¸å†ä½¿ç”¨ location å—ä¸­çš„æ­£åˆ™ uri å’Œè¯·æ±‚å­—ç¬¦ä¸²åšåŒ¹é…ã€‚ </p><p>æ³¨æ„ï¼šå¦‚æœ uri åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™å¿…é¡»è¦æœ‰ <code>~</code> æˆ–è€… <code>~*</code> æ ‡è¯†ã€‚    </p><h3 id="4ã€è´Ÿè½½å‡è¡¡é…ç½®å®ä¾‹"><a href="#4ã€è´Ÿè½½å‡è¡¡é…ç½®å®ä¾‹" class="headerlink" title="4ã€è´Ÿè½½å‡è¡¡é…ç½®å®ä¾‹"></a>4ã€è´Ÿè½½å‡è¡¡é…ç½®å®ä¾‹</h3><p>è´Ÿè½½å‡è¡¡å³æ˜¯å°†è´Ÿè½½åˆ†æ‘Šåˆ°ä¸åŒçš„æœåŠ¡å•å…ƒï¼Œæ—¢ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ï¼Œåˆä¿è¯å“åº” è¶³å¤Ÿå¿«ï¼Œç»™ç”¨æˆ·å¾ˆå¥½çš„ä½“éªŒã€‚</p><p>å¿«é€Ÿå¢é•¿çš„è®¿é—®é‡å’Œæ•°æ®æµé‡å‚¬ç”Ÿäº†å„å¼å„æ ·çš„è´Ÿè½½å‡è¡¡äº§å“ï¼Œ å¾ˆå¤šä¸“ä¸šçš„è´Ÿè½½å‡è¡¡ç¡¬ä»¶æä¾›äº†å¾ˆå¥½çš„åŠŸèƒ½ï¼Œä½†å´ä»·æ ¼ä¸è²ï¼Œè¿™ä½¿å¾—è´Ÿè½½å‡è¡¡è½¯ä»¶å¤§å—æ¬¢è¿ï¼Œ nginx å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªï¼Œåœ¨ linux ä¸‹æœ‰ Nginxã€ LVSã€ Haproxy ç­‰ç­‰æœåŠ¡å¯ä»¥æä¾›è´Ÿè½½å‡è¡¡æœåŠ¡ ã€‚</p><p>å‡†å¤‡å·¥ä½œï¼šå®‰è£…2ä¸ª <code>tomcat</code> å¹¶é…ç½®ç«¯å£åˆ†åˆ«ä¸º <code>8081</code> å’Œ <code>8082</code> ï¼Œä¸ºäº†åŒºåˆ†ä¹Ÿå¯ä»¥å‡†å¤‡2ä¸ªä¸åŒçš„ <code>index.html</code> é¡µé¢ã€‚</p><p>nginx.conf é…ç½®ï¼š</p><pre><code>http {    ...    upstream my_server{        ip_hash;        server 127.0.0.1:8081 weight=1;        server 127.0.0.1:8082 weight=1;    }    ...    server{        location / {            proxy_pass http://myserver;            proxy_connect_timeout 10;            ...        }    }}</code></pre><h3 id="5ã€nginx-æœåŠ¡å‡è¡¡ç­–ç•¥"><a href="#5ã€nginx-æœåŠ¡å‡è¡¡ç­–ç•¥" class="headerlink" title="5ã€nginx æœåŠ¡å‡è¡¡ç­–ç•¥"></a>5ã€nginx æœåŠ¡å‡è¡¡ç­–ç•¥</h3><p>Nginx æä¾›äº†å‡ ç§åˆ†é…æ–¹å¼(ç­–ç•¥)ï¼š </p><p>1ã€è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ </p><p>æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨ down æ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ </p><p>2ã€ weight </p><p>weight ä»£è¡¨æƒ,é‡é»˜è®¤ä¸º 1,æƒé‡è¶Šé«˜è¢«åˆ†é…çš„å®¢æˆ·ç«¯è¶Šå¤š æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œ weight å’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ ä¾‹å¦‚ï¼š</p><pre><code>upstream my_server_pool{    server 192.168.0.121 weight=10;    server 192.168.0.122 weight=10;}</code></pre><p>3 ã€ ip_hash </p><p>æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—® ip çš„ hash ç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³ session çš„é—®é¢˜ã€‚ ä¾‹å¦‚ï¼š </p><pre><code>upstream my_server_pool{     ip_hash;     server 192.168.0.121:80;     server 192.168.0.122:80; } </code></pre><p>4 ã€ fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰ æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ </p><pre><code>upstream my_server_pool{     server 192.168.5.21:80;     server 192.168.5.22:80;     fair; }    </code></pre><h3 id="6ã€åŠ¨é™åˆ†ç¦»é…ç½®å®ä¾‹"><a href="#6ã€åŠ¨é™åˆ†ç¦»é…ç½®å®ä¾‹" class="headerlink" title="6ã€åŠ¨é™åˆ†ç¦»é…ç½®å®ä¾‹"></a>6ã€åŠ¨é™åˆ†ç¦»é…ç½®å®ä¾‹</h3><p>Nginx åŠ¨é™åˆ†ç¦»ç®€å•æ¥è¯´å°±æ˜¯æŠŠåŠ¨æ€è·Ÿé™æ€è¯·æ±‚åˆ†å¼€ï¼Œä¸èƒ½ç†è§£æˆåªæ˜¯å•çº¯çš„æŠŠåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç‰©ç†åˆ†ç¦»ã€‚</p><p>ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´åº”è¯¥æ˜¯åŠ¨æ€è¯·æ±‚è·Ÿé™æ€è¯·æ±‚åˆ†å¼€ï¼Œå¯ä»¥ç†è§£æˆä½¿ç”¨ Nginx å¤„ç†é™æ€é¡µé¢ï¼Œ Tomcat å¤„ç†åŠ¨æ€é¡µé¢ã€‚</p><p>åŠ¨é™åˆ†ç¦»ä»ç›®å‰å®ç°è§’åº¦æ¥è®²å¤§è‡´åˆ†ä¸ºä¸¤ç§ï¼š</p><p>ï¼ˆ1ï¼‰ ä¸€ç§æ˜¯çº¯ç²¹æŠŠé™æ€æ–‡ä»¶ç‹¬ç«‹æˆå•ç‹¬çš„åŸŸåï¼Œæ”¾åœ¨ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿæ˜¯ç›®å‰ä¸»æµæ¨å´‡çš„æ–¹æ¡ˆï¼›</p><p>ï¼ˆ2ï¼‰ å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯åŠ¨æ€è·Ÿé™æ€æ–‡ä»¶æ··åˆåœ¨ä¸€èµ·å‘å¸ƒï¼Œé€šè¿‡ nginx æ¥åˆ†å¼€ã€‚ é€šè¿‡ location æŒ‡å®šä¸åŒçš„åç¼€åå®ç°ä¸åŒçš„è¯·æ±‚è½¬å‘ã€‚é€šè¿‡ expires å‚æ•°è®¾ç½®ï¼Œå¯ä»¥ä½¿ æµè§ˆå™¨ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå‡å°‘ä¸æœåŠ¡å™¨ä¹‹å‰çš„è¯·æ±‚å’Œæµé‡ã€‚</p><p>â€‹    å…·ä½“ Expires å®šä¹‰ï¼šæ˜¯ç»™ä¸€ä¸ªèµ„ æºè®¾å®šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´æ— éœ€å»æœåŠ¡ç«¯éªŒè¯ï¼Œç›´æ¥é€šè¿‡æµè§ˆå™¨è‡ªèº«ç¡®è®¤æ˜¯å¦è¿‡æœŸå³å¯ï¼Œ æ‰€ä»¥ä¸ä¼šäº§ç”Ÿé¢å¤–çš„æµé‡ã€‚æ­¤ç§æ–¹æ³•éå¸¸é€‚åˆä¸ç»å¸¸å˜åŠ¨çš„èµ„æºã€‚ï¼ˆå¦‚æœç»å¸¸æ›´æ–°çš„æ–‡ä»¶ï¼Œ ä¸å»ºè®®ä½¿ç”¨ Expires æ¥ç¼“å­˜ï¼‰ï¼Œå‡å¦‚è®¾ç½®ä¸º 3dï¼Œè¡¨ç¤ºåœ¨è¿™ 3 å¤©ä¹‹å†…è®¿é—®è¿™ä¸ª URLï¼Œå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯”å¯¹æœåŠ¡å™¨è¯¥æ–‡ä»¶æœ€åæ›´æ–°æ—¶é—´æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šä»æœåŠ¡å™¨æŠ“å–ï¼Œè¿”å›çŠ¶æ€ç  304ï¼Œå¦‚æœæœ‰ä¿®æ”¹ï¼Œåˆ™ç›´æ¥ä»æœåŠ¡å™¨é‡æ–°ä¸‹è½½ï¼Œè¿”å›çŠ¶æ€ç  200ã€‚    </p><p><strong>åŠ¨æ€èµ„æºä»£ç†é…ç½®</strong>ï¼š</p><pre><code>location / {    proxy_pass è·¯å¾„}</code></pre><p><strong>é™æ€èµ„æºä»£ç†é…ç½®</strong>ï¼š</p><pre><code>location / {    root é™æ€èµ„æºè·¯å¾„    index  é»˜è®¤è®¿é—®è·¯å¾„ä¸‹çš„ä»€ä¹ˆèµ„æº    autoindex on; # ä»£è¡¨å±•ç¤ºé™æ€èµ„æºçš„å…¨éƒ¨å†…å®¹ï¼Œä»¥åˆ—è¡¨çš„å½¢å¼å±•å¼€ã€‚}</code></pre><p>é…ç½®æ–‡ä»¶å®ä¾‹ï¼š</p><pre><code>server{    listen 80;    server_name www.zhangxiaocai.cn    location /js/ {        root /home/tomcat/webapps/test/js/;        autoindex on;    }    location /image/ {        root /home/tomcat/webapps/test/images/;        autoindex on;    }}</code></pre><p>æµ‹è¯•è®¿é—®okä¹‹åå¯ä»¥åˆ é™¤é™æ€æ–‡ä»¶å†è¯•è¯•ï¼Œçœ‹çœ‹è®¿é—®èµ°çš„ <code>nginx</code> è¿˜æ˜¯ <code>tomcat</code>ã€‚</p><h2 id="å…­ã€Nginx-åŸç†"><a href="#å…­ã€Nginx-åŸç†" class="headerlink" title="å…­ã€Nginx åŸç†"></a>å…­ã€Nginx åŸç†</h2><h3 id="1ã€nginxåŸºæœ¬åŸç†ï¼š"><a href="#1ã€nginxåŸºæœ¬åŸç†ï¼š" class="headerlink" title="1ã€nginxåŸºæœ¬åŸç†ï¼š"></a>1ã€nginxåŸºæœ¬åŸç†ï¼š</h3><p>â€‹    ä½¿ç”¨ <code>master-workers</code> çš„æœºåˆ¶ï¼Œé€šè¿‡ä¸€ä¸ª <code>master</code> ä¸»è¿›ç¨‹ç®¡ç†å…¶ä»– <code>worker</code> è¿›è¡Œæ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚å’Œå“åº”ã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><p>ï¼ˆ1ï¼‰æ¯ä¸ª <code>worker</code> è¿›ç¨‹éƒ½æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸éœ€è¦åŠ é”ã€‚</p><p>ï¼ˆ2ï¼‰é‡‡ç”¨ç‹¬ç«‹è¿›ç¨‹ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šå½±å“ï¼Œä¸€ä¸ªè¿›ç¨‹ç»“æŸï¼Œä¸å½±å“å…¶ä»–è¿›ç¨‹ï¼ŒæœåŠ¡ä¸ä¼šä¸­æ–­ï¼Œ<code>master</code> è¿›ç¨‹ä¼šå¯åŠ¨æ–°çš„ worker è¿›ç¨‹ã€‚</p><p>ï¼ˆ3ï¼‰<code>worker</code> è¿›ç¨‹ å¼‚å¸¸é€€å‡ºï¼Œåªä¼šå¯¼è‡´å½“å‰è¿›ç¨‹ <code>worker</code> ä¸Šçš„è¯·æ±‚å¤±è´¥ï¼Œä¸ä¼šå½±å“æ‰€æœ‰è¯·æ±‚ï¼Œé™ä½è¿è¡Œé£é™©ã€‚</p><h3 id="2ã€ç›¸å…³è®¾ç½®"><a href="#2ã€ç›¸å…³è®¾ç½®" class="headerlink" title="2ã€ç›¸å…³è®¾ç½®"></a>2ã€ç›¸å…³è®¾ç½®</h3><p><strong>worker è®¾ç½®</strong></p><p>â€‹    nginx åŒ redis ç±»ä¼¼éƒ½é‡‡ç”¨äº† io å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œæ¯ä¸ª <code>worker</code> éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½†æ¯ä¸ªè¿› ç¨‹é‡Œåªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œé€šè¿‡å¼‚æ­¥éé˜»å¡çš„æ–¹å¼æ¥å¤„ç†è¯·æ±‚ï¼Œ å³ä½¿æ˜¯åƒä¸Šä¸‡ä¸ªè¯·æ±‚ä¹Ÿä¸åœ¨è¯ ä¸‹ã€‚æ¯ä¸ª worker çš„çº¿ç¨‹å¯ä»¥æŠŠä¸€ä¸ª cpu çš„æ€§èƒ½å‘æŒ¥åˆ°æè‡´ã€‚æ‰€ä»¥ <code>worker</code> æ•°å’ŒæœåŠ¡å™¨çš„ cpu æ•°ç›¸ç­‰æ˜¯æœ€ä¸ºé€‚å®œçš„ã€‚è®¾å°‘äº†ä¼šæµªè´¹ cpuï¼Œè®¾å¤šäº†ä¼šé€ æˆ cpu é¢‘ç¹åˆ‡æ¢ä¸Šä¸‹æ–‡å¸¦æ¥çš„æŸè€—ã€‚</p><p><strong>è¿æ¥æ•° worker_connection</strong></p><p>è¿™ä¸ªå€¼æ˜¯è¡¨ç¤ºæ¯ä¸ª <code>worker</code> è¿›ç¨‹æ‰€èƒ½å»ºç«‹è¿æ¥çš„æœ€å¤§å€¼ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ª <code>nginx</code> èƒ½å»ºç«‹çš„æœ€å¤§è¿æ¥ æ•°ï¼Œåº”è¯¥æ˜¯ <code>worker_connections * worker_processes</code> ã€‚å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„æ˜¯æœ€å¤§è¿æ¥æ•°ï¼Œå¯¹äº <code>HTTP</code> è¯·æ±‚æœ¬åœ°èµ„æºæ¥è¯´ ï¼Œ èƒ½ å¤Ÿæ”¯æŒçš„æœ€å¤§å¹¶å‘æ•°é‡æ˜¯ <code>worker_connections * worker_processes</code>ï¼Œ</p><p>å¦‚æœæ˜¯æ”¯æŒ <code>http1.1</code> çš„æµè§ˆå™¨æ¯æ¬¡è®¿é—®è¦å ä¸¤ä¸ªè¿æ¥ï¼Œæ‰€ä»¥<strong>æ™®é€šçš„é™æ€è®¿é—®æœ€å¤§å¹¶å‘æ•°</strong>æ˜¯ï¼š <code>worker_connections * worker_processes /2</code>ï¼Œ</p><p>å¦‚æœæ˜¯ <code>HTTP</code> ä½œä¸ºåå‘ä»£ç†æ¥è¯´ï¼Œ<strong>åŠ¨æ€èµ„æºæœ€å¤§å¹¶å‘æ•°é‡</strong>åº”è¯¥æ˜¯ <code>worker_connections * worker_processes /4</code>ã€‚å› ä¸ºä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ¯ä¸ªå¹¶å‘ä¼šå»ºç«‹ä¸å®¢æˆ·ç«¯çš„è¿æ¥å’Œä¸åç«¯æœ åŠ¡çš„è¿æ¥ï¼Œä¼šå ç”¨ä¸¤ä¸ªè¿æ¥ã€‚    </p><h3 id="3ã€é…ç½®æ–‡ä»¶ç»“æ„"><a href="#3ã€é…ç½®æ–‡ä»¶ç»“æ„" class="headerlink" title="3ã€é…ç½®æ–‡ä»¶ç»“æ„"></a>3ã€é…ç½®æ–‡ä»¶ç»“æ„</h3><blockquote class="pullquote mindmap mindmap-md"><!-- build time:Sat Oct 03 2020 23:21:19 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><ul><li>Nginx.conf ç»“æ„<ul><li>work_processes</li><li>events<ul><li>worker_connection</li></ul></li><li>http<ul><li>server<ul><li>listen</li><li>server_name</li><li>location<ul><li>root</li><li>index</li></ul></li></ul></li></ul></li></ul></li></ul><!-- rebuild by neat --></blockquote><h2 id="ä¸ƒã€å…¶ä»–"><a href="#ä¸ƒã€å…¶ä»–" class="headerlink" title="ä¸ƒã€å…¶ä»–"></a>ä¸ƒã€å…¶ä»–</h2><p>https å·²ç»åœ¨ä½¿ç”¨äº†ï¼Œæš‚æ—¶è¿˜æ²¡åŠ ä¸Šã€‚</p><p>é‡åˆ°å†è¡¥å……å§~</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thymeleaf å†…ç½®å¯¹è±¡</title>
      <link href="/posts/44478111.html"/>
      <url>/posts/44478111.html</url>
      
        <content type="html"><![CDATA[<h2 id="Thymeleaf-å†…ç½®å¯¹è±¡"><a href="#Thymeleaf-å†…ç½®å¯¹è±¡" class="headerlink" title="Thymeleaf  å†…ç½®å¯¹è±¡"></a>Thymeleaf  å†…ç½®å¯¹è±¡</h2><p>Thymeleaf çš„å†…ç½®å¯¹è±¡ä¸»è¦æœ‰ä¸‰ç±»</p><ul><li>è¯·æ±‚/ä¼šè¯å±æ€§çš„Webä¸Šä¸‹æ–‡å‘½åç©ºé—´å¯¹è±¡</li><li>Web ä¸Šä¸‹æ–‡å¯¹è±¡</li><li>å†…ç½®å·¥å…·å¯¹è±¡</li></ul><h2 id="ä¸€-è¯·æ±‚-ä¼šè¯å±æ€§ç­‰"><a href="#ä¸€-è¯·æ±‚-ä¼šè¯å±æ€§ç­‰" class="headerlink" title="ä¸€. è¯·æ±‚/ä¼šè¯å±æ€§ç­‰"></a>ä¸€. è¯·æ±‚/ä¼šè¯å±æ€§ç­‰</h2><p>è¯·æ±‚/ä¼šè¯å±æ€§ç­‰çš„Webä¸Šä¸‹æ–‡å‘½åç©ºé—´å¯¹è±¡ã€‚å¦‚ä¸‹</p><h3 id="ctx"><a href="#ctx" class="headerlink" title="#ctx"></a>#ctx</h3><p><code>org.thymeleaf.context.IContext</code> APIæä¾›</p><pre><code>${#ctx.locale}${#ctx.variableNames}</code></pre><p><code>class org.thymeleaf.context.IWebContext</code> APIæä¾›</p><pre><code>${#ctx.request}${#ctx.response}${#ctx.session}${#ctx.servletContext}</code></pre><h3 id="locale"><a href="#locale" class="headerlink" title="#locale"></a>#locale</h3><p>ç›´æ¥è®¿é—®java.util.Localeä¸å½“å‰è¯·æ±‚å…³è”ã€‚</p><pre><code>${#locale}</code></pre><h3 id="param"><a href="#param" class="headerlink" title="param"></a>param</h3><p>ä¸æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè€Œæ˜¯ä½œä¸ºå˜é‡æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­çš„æ˜ å°„ï¼Œä¸ä½¿ç”¨#æ¥è®¿é—®å®ƒä»¬ã€‚paramç±»ä¼¼åç§°ç©ºé—´ã€‚</p><p><code>org.thymeleaf.context.WebRequestParamsVariablesMap</code> APIæä¾›</p><pre><code>${param.foo}${param.fooArray[0]}${param.size()}${param.isEmpty()}${param.containsKey(&#39;foo&#39;)}</code></pre><h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><p><code>org.thymeleaf.context.WebSessionVariablesMap</code> æä¾›API</p><pre><code>${session.foo} // Retrieves the session atttribute &#39;foo&#39;${session.size()}${session.isEmpty()}${session.containsKey(&#39;foo&#39;)}</code></pre><h3 id="application"><a href="#application" class="headerlink" title="application"></a>application</h3><p>ç”¨äºæ£€ç´¢ <code>application/servlet</code>ä¸Šä¸‹æ–‡å±æ€§ã€‚</p><pre><code>${application.foo} // Retrieves the ServletContext atttribute &#39;foo&#39;${application.size()}${application.isEmpty()}${application.containsKey(&#39;foo&#39;)}</code></pre><h2 id="äºŒ-Web-ä¸Šä¸‹æ–‡å¯¹è±¡"><a href="#äºŒ-Web-ä¸Šä¸‹æ–‡å¯¹è±¡" class="headerlink" title="äºŒ. Web ä¸Šä¸‹æ–‡å¯¹è±¡"></a>äºŒ. Web ä¸Šä¸‹æ–‡å¯¹è±¡</h2><p>Web ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚å¦‚ä¸‹ï¼š</p><h3 id="request"><a href="#request" class="headerlink" title="#request :"></a>#request :</h3><p>ç›´æ¥è®¿é—® <code>javax.servlet.http.HttpServletRequest</code> å¯¹è±¡ä¸å½“å‰è¯·æ±‚å…³è”</p><pre><code>${#request.getAttribute(&#39;foo&#39;)}${#request.getParameter(&#39;foo&#39;)}${#request.getContextPath()}${#request.getRequestName()}</code></pre><h3 id="session-1"><a href="#session-1" class="headerlink" title="#session :"></a>#session :</h3><p>ç›´æ¥è®¿é—® <code>javax.servlet.http.HttpSession</code> å¯¹è±¡ä¸å½“å‰è¯·æ±‚å…³è”</p><pre><code>${#session.getAttribute(&#39;foo&#39;)}${#session.id}${#session.lastAccessedTime}</code></pre><h3 id="servletContext"><a href="#servletContext" class="headerlink" title="#servletContext :"></a>#servletContext :</h3><p>ç›´æ¥è®¿é—® <code>javax.servlet.ServletContext</code> å¯¹è±¡ä¸å½“å‰è¯·æ±‚å…³è”</p><pre><code>${#servletContext.getAttribute(&#39;foo&#39;)}${#servletContext.contextPath}</code></pre><h2 id="ä¸‰-å†…ç½®å·¥å…·å¯¹è±¡"><a href="#ä¸‰-å†…ç½®å·¥å…·å¯¹è±¡" class="headerlink" title="ä¸‰. å†…ç½®å·¥å…·å¯¹è±¡"></a>ä¸‰. å†…ç½®å·¥å…·å¯¹è±¡</h2><h3 id="1-Execution-Info"><a href="#1-Execution-Info" class="headerlink" title="1. Execution Info"></a>1. Execution Info</h3><p><code>#execInfo</code> ï¼šæä¾›æœ‰å…³åœ¨Thymeleaf å†…éƒ¨æ­£åœ¨å¤„ç†çš„æ¨¡æ¿çš„æœ‰ç”¨ä¿¡æ¯æ ‡å‡†è¡¨è¾¾å¼ã€‚</p><p>ç”± <code>org.thymeleaf.expression.ExecutionInfo</code> æä¾›çš„API</p><pre><code>/** Return the name and mode of the &#39;leaf&#39; template. This means the template* from where the events being processed were parsed. So if this piece of* code is not in the root template &quot;A&quot; but on a fragment being inserted* into &quot;A&quot; from another template called &quot;B&quot;, this will return &quot;B&quot; as a* name, and B&#39;s mode as template mode.*/${#execInfo.templateName}${#execInfo.templateMode}/** Return the name and mode of the &#39;root&#39; template. This means the template* that the template engine was originally asked to process. So if this* piece of code is not in the root template &quot;A&quot; but on a fragment being* inserted into &quot;A&quot; from another template called &quot;B&quot;, this will still* return &quot;A&quot; and A&#39;s template mode.*/${#execInfo.processedTemplateName}${#execInfo.processedTemplateMode}/** Return the stacks (actually, List&lt;String&gt; or List&lt;TemplateMode&gt;) of* templates being processed. The first element will be the* &#39;processedTemplate&#39; (the root one), the last one will be the &#39;leaf&#39;* template, and in the middle all the fragments inserted in nested* manner to reach the leaf from the root will appear.*/${#execInfo.templateNames}${#execInfo.templateModes}/** Return the stack of templates being processed similarly (and in the* same order) to &#39;templateNames&#39; and &#39;templateModes&#39;, but returning* a List&lt;TemplateData&gt; with the full template metadata.*/${#execInfo.templateStack}</code></pre><h3 id="2-Messages"><a href="#2-Messages" class="headerlink" title="2. Messages"></a>2. Messages</h3><p><code>#message</code> ï¼šåœ¨å˜é‡è¡¨è¾¾å¼ä¸­è·å–å¤–éƒ¨åŒ–æ¶ˆæ¯çš„å·¥å…·æ–¹æ³•ã€‚ä¹Ÿæ˜¯ä½¿ç”¨ <code>#{ }</code> è¯­æ³•ã€‚</p><p>ç”± <code>org.thymeleaf.expression.Messages</code> æä¾›APIã€‚    </p><pre><code>/** Obtain externalized messages. Can receive a single key, a key plus arguments,* or an array/list/set of keys (in which case it will return an array/list/set of* externalized messages).* If a message is not found, a default message (like &#39;??msgKey??&#39;) is returned.*/${#messages.msg(&#39;msgKey&#39;)}${#messages.msg(&#39;msgKey&#39;, param1)}${#messages.msg(&#39;msgKey&#39;, param1, param2)}${#messages.msg(&#39;msgKey&#39;, param1, param2, param3)}${#messages.msgWithParams(&#39;msgKey&#39;, new Object[] {param1, param2, param3, param4})}${#messages.arrayMsg(messageKeyArray)}${#messages.listMsg(messageKeyList)}${#messages.setMsg(messageKeySet)}/** Obtain externalized messages or null. Null is returned instead of a default* message if a message for the specified key is not found.*/${#messages.msgOrNull(&#39;msgKey&#39;)}${#messages.msgOrNull(&#39;msgKey&#39;, param1)}${#messages.msgOrNull(&#39;msgKey&#39;, param1, param2)}${#messages.msgOrNull(&#39;msgKey&#39;, param1, param2, param3)}${#messages.msgOrNullWithParams(&#39;msgKey&#39;, new Object[] {param1, param2, param3, param4})}${#messages.arrayMsgOrNull(messageKeyArray)}${#messages.listMsgOrNull(messageKeyList)}${#messages.setMsgOrNull(messageKeySet)}</code></pre><h3 id="3-URI-URL"><a href="#3-URI-URL" class="headerlink" title="3. URI/URL"></a>3. URI/URL</h3><p><code>#uris</code>ï¼šç”¨äºåœ¨ Thymeleaf æ ‡å‡†è¡¨è¾¾å¼ä¸­è¿›è¡ŒURI/URLæ“ä½œçš„å·¥å…·å¯¹è±¡ã€‚</p><p>æ¯”å¦‚:URLå‚æ•°ä¸­æœ‰ç‰¹æ®Šå­—ç¬¦å¯ä»¥è¿›è¡Œè½¬ä¹‰æˆ–å–æ¶ˆè½¬ä¹‰ï¼Œä¸­æ–‡ä¹±ç å¯ä»¥è¿›è¡Œç¼–ç è½¬ç ã€‚</p><p>ç”± <code>org.thymeleaf.expression.Uris</code> æä¾›APIã€‚</p><pre><code>/** Escape/Unescape as a URI/URL path*/${#uris.escapePath(uri)}${#uris.escapePath(uri, encoding)}${#uris.unescapePath(uri)}${#uris.unescapePath(uri, encoding)}/** Escape/Unescape as a URI/URL path segment (between &#39;/&#39; symbols)*/${#uris.escapePathSegment(uri)}${#uris.escapePathSegment(uri, encoding)}${#uris.unescapePathSegment(uri)}${#uris.unescapePathSegment(uri, encoding)}/** Escape/Unescape as a Fragment Identifier (#frag)*/${#uris.escapeFragmentId(uri)}${#uris.escapeFragmentId(uri, encoding)}${#uris.unescapeFragmentId(uri)}${#uris.unescapeFragmentId(uri, encoding)}/** Escape/Unescape as a Query Parameter (?var=value)*/${#uris.escapeQueryParam(uri)}${#uris.escapeQueryParam(uri, encoding)}${#uris.unescapeQueryParam(uri)}${#uris.unescapeQueryParam(uri, encoding)}</code></pre><h3 id="4-Conversions"><a href="#4-Conversions" class="headerlink" title="4. Conversions"></a>4. Conversions</h3><p><code>#conversions</code>ï¼šå…è®¸åœ¨æ¨¡æ¿çš„ä»»ä½•ç‚¹æ‰§è¡Œè½¬æ¢æœåŠ¡ã€‚</p><p>ç”± <code>org.thymeleaf.expression.Conversions</code> æä¾›APIã€‚</p><pre><code>/** Execute the desired conversion of the &#39;object&#39; value into the* specified class.*/${#conversions.convert(object, &#39;java.util.TimeZone&#39;)}${#conversions.convert(object, targetClass)}</code></pre><h3 id="5-Dates"><a href="#5-Dates" class="headerlink" title="5. Dates"></a>5. Dates</h3><p><code>#dates</code> :  å…¶å®å°±å’Œ <code>java.util.Date</code>å¯¹è±¡çš„å·¥å…·æ–¹æ³•ç±»ä¼¼ã€‚</p><p>ç”± <code>org.thymeleaf.expression.Dates</code> æä¾›APIã€‚</p><pre><code>/** æ ¼å¼åŒ–æˆ æ ‡å‡†åŒºåŸŸæ ¼å¼æ—¶é—´* æ”¯æŒ arrays, lists or sets æ“ä½œ*/${#dates.format(date)}${#dates.arrayFormat(datesArray)}${#dates.listFormat(datesList)}${#dates.setFormat(datesSet)}/** æ ¼å¼åŒ–æˆ  ISO8601æ—¶é—´* æ”¯æŒ arrays, lists or sets æ“ä½œ*/${#dates.formatISO(date)}${#dates.arrayFormatISO(datesArray)}${#dates.listFormatISO(datesList)}${#dates.setFormatISO(datesSet)}/** æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´æˆè‡ªå®šä¹‰çš„æ ¼å¼* æ”¯æŒ arrays, lists or sets æ“ä½œ*/${#dates.format(date, &#39;dd/MMM/yyyy HH:mm&#39;)}${#dates.arrayFormat(datesArray, &#39;dd/MMM/yyyy HH:mm&#39;)}${#dates.listFormat(datesList, &#39;dd/MMM/yyyy HH:mm&#39;)}${#dates.setFormat(datesSet, &#39;dd/MMM/yyyy HH:mm&#39;)}/** è·å–æ—¥æœŸå±æ€§* æ”¯æŒ arrays, lists or sets æ“ä½œ*/${#dates.day(date)} // also arrayDay(...), listDay(...), etc.${#dates.month(date)} // also arrayMonth(...), listMonth(...), etc.${#dates.monthName(date)} // also arrayMonthName(...), listMonthName(...), etc.${#dates.monthNameShort(date)} // also arrayMonthNameShort(...), listMonthNameShort(...), etc.${#dates.year(date)} // also arrayYear(...), listYear(...), etc.${#dates.dayOfWeek(date)} // also arrayDayOfWeek(...), listDayOfWeek(...), etc.${#dates.dayOfWeekName(date)} // also arrayDayOfWeekName(...), listDayOfWeekName(...), etc.${#dates.dayOfWeekNameShort(date)} // also arrayDayOfWeekNameShort(...), listDayOfWeekNameShort(...), etc.${#dates.hour(date)} // also arrayHour(...), listHour(...), etc.${#dates.minute(date)} // also arrayMinute(...), listMinute(...), etc.${#dates.second(date)} // also arraySecond(...), listSecond(...), etc.${#dates.millisecond(date)} // also arrayMillisecond(...), listMillisecond(...), etc./** ä½¿ç”¨è‡ªå¸¦ç»„ä»¶åˆ›å»ºæ—¥æœŸ (java.util.Date) å¯¹è±¡*/${#dates.create(year,month,day)}${#dates.create(year,month,day,hour,minute)}${#dates.create(year,month,day,hour,minute,second)}${#dates.create(year,month,day,hour,minute,second,millisecond)}/** ä½¿ç”¨è‡ªå¸¦ç»„ä»¶åˆ›å»ºå½“å‰æ—¥æœŸæˆ–æ—¶é—´ (java.util.Date)*/${#dates.createNow()}${#dates.createNowForTimeZone()}/** ä½¿ç”¨è‡ªå¸¦ç»„ä»¶åˆ›å»ºå½“å‰æ—¥æœŸ (java.util.Date)ï¼Œæ—¶é—´æ˜¯00:00*/${#dates.createToday()}${#dates.createTodayForTimeZone()}</code></pre><h3 id="6-Calendar"><a href="#6-Calendar" class="headerlink" title="6. Calendar"></a>6. Calendar</h3><p><code>#calendar</code> ï¼šç±»ä¼¼ <code>#dates</code> ï¼Œä½†æ˜¯æ˜¯ <code>java.util.Calendar</code> å¯¹è±¡ã€‚</p><p>ç”± <code>class org.thymeleaf.expression.Calendars</code> æä¾›APIã€‚</p><pre><code>/** Format calendar with the standard locale format* Also works with arrays, lists or sets*/${#calendars.format(cal)}${#calendars.arrayFormat(calArray)}${#calendars.listFormat(calList)}${#calendars.setFormat(calSet)}/** Format calendar with the ISO8601 format* Also works with arrays, lists or sets*/${#calendars.formatISO(cal)}${#calendars.arrayFormatISO(calArray)}${#calendars.listFormatISO(calList)}${#calendars.setFormatISO(calSet)}/** Format calendar with the specified pattern* Also works with arrays, lists or sets*/${#calendars.format(cal, &#39;dd/MMM/yyyy HH:mm&#39;)}${#calendars.arrayFormat(calArray, &#39;dd/MMM/yyyy HH:mm&#39;)}${#calendars.listFormat(calList, &#39;dd/MMM/yyyy HH:mm&#39;)}${#calendars.setFormat(calSet, &#39;dd/MMM/yyyy HH:mm&#39;)}/** è·å–æ—¥å†å±æ€§* Also works with arrays, lists or sets*/${#calendars.day(date)} // also arrayDay(...), listDay(...), etc.${#calendars.month(date)} // also arrayMonth(...), listMonth(...), etc.${#calendars.monthName(date)} // also arrayMonthName(...), listMonthName(...), etc.${#calendars.monthNameShort(date)} // also arrayMonthNameShort(...), listMonthNameShort(...), etc.${#calendars.year(date)} // also arrayYear(...), listYear(...), etc.${#calendars.dayOfWeek(date)} // also arrayDayOfWeek(...), listDayOfWeek(...), etc.${#calendars.dayOfWeekName(date)} // also arrayDayOfWeekName(...), listDayOfWeekName(...), etc.${#calendars.dayOfWeekNameShort(date)} // also arrayDayOfWeekNameShort(...), listDayOfWeekNameShort(...), etc.${#calendars.hour(date)} // also arrayHour(...), listHour(...), etc.${#calendars.minute(date)} // also arrayMinute(...), listMinute(...), etc.${#calendars.second(date)} // also arraySecond(...), listSecond(...), etc.${#calendars.millisecond(date)} // also arrayMillisecond(...), listMillisecond(...), etc./** Create calendar (java.util.Calendar) objects from its components*/${#calendars.create(year,month,day)}${#calendars.create(year,month,day)}${#calendars.create(year,month,day,hour,minute)}${#calendars.create(year,month,day,hour,minute,second)}${#calendars.create(year,month,day,hour,minute,second,millisecond)}${#calendars.createForTimeZone(year,month,day,timeZone)}${#calendars.createForTimeZone(year,month,day,hour,minute,timeZone)}${#calendars.createForTimeZone(year,month,day,hour,minute,second,timeZone)}${#calendars.createForTimeZone(year,month,day,hour,minute,second,millisecond,timeZone)}/** åˆ›å»ºå½“å‰æ—¥æœŸå’Œæ—¶é—´çš„æ—¥å†å¯¹è±¡(java.util.Calendar) */${#calendars.createNow()}${#calendars.createNowForTimeZone()}/**   åˆ›å»ºå½“å‰æ—¥æœŸ (time set to 00:00)çš„æ—¥å†å¯¹è±¡(java.util.Calendar) */${#calendars.createToday()}${#calendars.createTodayForTimeZone()}</code></pre><h3 id="7-Numbers"><a href="#7-Numbers" class="headerlink" title="7. Numbers"></a>7. Numbers</h3><p><code>#numbers</code> ï¼šæ•°å­—å¯¹è±¡çš„å·¥å…·å¯¹è±¡æ–¹æ³•ã€‚</p><p><code>org.thymeleaf.expression.Numbers</code> æä¾›APIã€‚</p><p> integer ç±»å‹æ ¼å¼åŒ–</p><pre><code>/** Set minimum integer digits.* Also works with arrays, lists or sets*/${#numbers.formatInteger(num,3)}${#numbers.arrayFormatInteger(numArray,3)}${#numbers.listFormatInteger(numList,3)}${#numbers.setFormatInteger(numSet,3)}/** Set minimum integer digits and thousands separator:* &#39;POINT&#39;, &#39;COMMA&#39;, &#39;WHITESPACE&#39;, &#39;NONE&#39; or &#39;DEFAULT&#39; (by locale).* Also works with arrays, lists or sets*/${#numbers.formatInteger(num,3,&#39;POINT&#39;)}${#numbers.arrayFormatInteger(numArray,3,&#39;POINT&#39;)}${#numbers.listFormatInteger(numList,3,&#39;POINT&#39;)}${#numbers.setFormatInteger(numSet,3,&#39;POINT&#39;)}</code></pre><p>decimal   ç±»å‹æ ¼å¼åŒ–</p><pre><code>/** Set minimum integer digits and (exact) decimal digits.* Also works with arrays, lists or sets*/${#numbers.formatDecimal(num,3,2)}${#numbers.arrayFormatDecimal(numArray,3,2)}${#numbers.listFormatDecimal(numList,3,2)}${#numbers.setFormatDecimal(numSet,3,2)}/** Set minimum integer digits and (exact) decimal digits, and also decimal separator.* Also works with arrays, lists or sets*/${#numbers.formatDecimal(num,3,2,&#39;COMMA&#39;)}${#numbers.arrayFormatDecimal(numArray,3,2,&#39;COMMA&#39;)}${#numbers.listFormatDecimal(numList,3,2,&#39;COMMA&#39;)}${#numbers.setFormatDecimal(numSet,3,2,&#39;COMMA&#39;)}/** Set minimum integer digits and (exact) decimal digits, and also thousands and* decimal separator.* Also works with arrays, lists or sets*/${#numbers.formatDecimal(num,3,&#39;POINT&#39;,2,&#39;COMMA&#39;)}${#numbers.arrayFormatDecimal(numArray,3,&#39;POINT&#39;,2,&#39;COMMA&#39;)}${#numbers.listFormatDecimal(numList,3,&#39;POINT&#39;,2,&#39;COMMA&#39;)}${#numbers.setFormatDecimal(numSet,3,&#39;POINT&#39;,2,&#39;COMMA&#39;)}</code></pre><p>è´§å¸æ ¼å¼åŒ–ï¼š</p><pre><code>${#numbers.formatCurrency(num)}${#numbers.arrayFormatCurrency(numArray)}${#numbers.listFormatCurrency(numList)}${#numbers.setFormatCurrency(numSet)}</code></pre><p>ç™¾åˆ†ç™¾æ ¼å¼åŒ–ï¼š</p><pre><code>${#numbers.formatPercent(num)}${#numbers.arrayFormatPercent(numArray)}${#numbers.listFormatPercent(numList)}${#numbers.setFormatPercent(numSet)}</code></pre><p>è®¾ç½®æœ€å°æ•´æ•°ä½æ•°å’Œï¼ˆç²¾ç¡®ï¼‰å°æ•°ä½æ•°ã€‚</p><pre><code>${#numbers.formatPercent(num, 3, 2)}${#numbers.arrayFormatPercent(numArray, 3, 2)}${#numbers.listFormatPercent(numList, 3, 2)}${#numbers.setFormatPercent(numSet, 3, 2)}</code></pre><p>åˆ›å»ºä¸€ä¸ªä»xåˆ°yæ•´æ•°åºåˆ—ï¼ˆæ•°ç»„ï¼‰</p><pre><code>${#numbers.sequence(from,to)}${#numbers.sequence(from,to,step)}</code></pre><h3 id="8-Strings"><a href="#8-Strings" class="headerlink" title="8. Strings"></a>8. Strings</h3><p><code>#strings</code> : å­—ç¬¦ä¸²å¯¹è±¡å®ç”¨å·¥å…·å¯¹è±¡ã€‚</p><p>ç”± <code>org.thymeleaf.expression.Strings</code> æä¾›APIã€‚</p><p>Nullå®‰å…¨çš„è½¬å­—ç¬¦ä¸²ï¼š</p><pre><code>${#strings.toString(obj)} // also array*, list* and set*</code></pre><p>åˆ¤æ–­æ˜¯å¦ä¸ºç©º</p><pre><code>/** Check whether a String is empty (or null). Performs a trim() operation before check* Also works with arrays, lists or sets*/${#strings.isEmpty(name)}${#strings.arrayIsEmpty(nameArr)}${#strings.listIsEmpty(nameList)}${#strings.setIsEmpty(nameSet)}</code></pre><p>å¸¦é»˜è®¤å€¼çš„åˆ¤ç©º</p><pre><code>/** Perform an &#39;isEmpty()&#39; check on a string and return it if false, defaulting to* another specified string if true.* Also works with arrays, lists or sets*/${#strings.defaultString(text,default)}${#strings.arrayDefaultString(textArr,default)}${#strings.listDefaultString(textList,default)}${#strings.setDefaultString(textSet,default)}</code></pre><p>åˆ¤æ–­ç‰‡æ®µæ˜¯å¦åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²</p><pre><code>/** Check whether a fragment is contained in a String* Also works with arrays, lists or sets*/${#strings.contains(name,&#39;ez&#39;)} // also array*, list* and set*${#strings.containsIgnoreCase(name,&#39;ez&#39;)} // also array*, list* and set*</code></pre><p>åˆ¤æ–­ä»¥æŸå­—ç¬¦ä¸²å¼€å§‹æˆ–ç»“æŸï¼š</p><pre><code>/** Check whether a String starts or ends with a fragment* Also works with arrays, lists or sets*/${#strings.startsWith(name,&#39;Don&#39;)} // also array*, list* and set*${#strings.endsWith(name,endingFragment)} // also array*, list* and set*</code></pre><p>å­—ç¬¦ä¸²æˆªå–ç›¸å…³ï¼š</p><pre><code>/** Substring-related operations* Also works with arrays, lists or sets*/${#strings.indexOf(name,frag)} // also array*, list* and set*${#strings.substring(name,3,5)} // also array*, list* and set*${#strings.substringAfter(name,prefix)} // also array*, list* and set*${#strings.substringBefore(name,suffix)} // also array*, list* and set*${#strings.replace(name,&#39;las&#39;,&#39;ler&#39;)} // also array*, list* and set*</code></pre><p>å­—ç¬¦ä¸²è¿½åŠ ï¼š</p><pre><code>/** Append and prepend* Also works with arrays, lists or sets*/${#strings.prepend(str,prefix)} // also array*, list* and set*${#strings.append(str,suffix)} // also array*, list* and set*</code></pre><p>å­—ç¬¦ä¸²å¤§å°å†™è½¬æ¢</p><pre><code>/** Change case* Also works with arrays, lists or sets*/${#strings.toUpperCase(name)} // also array*, list* and set*${#strings.toLowerCase(name)} // also array*, list* and set*</code></pre><p>å­—ç¬¦ä¸²åˆ†å‰²æˆ–è¿æ¥</p><pre><code>/** Split and join*/${#strings.arrayJoin(namesArray,&#39;,&#39;)}${#strings.listJoin(namesList,&#39;,&#39;)}${#strings.setJoin(namesSet,&#39;,&#39;)}${#strings.arraySplit(namesStr,&#39;,&#39;)} // returns String[]${#strings.listSplit(namesStr,&#39;,&#39;)} // returns List&lt;String&gt;${#strings.setSplit(namesStr,&#39;,&#39;)} // returns Set&lt;String&gt;</code></pre><p>å»ç©ºæ ¼ï¼š</p><pre><code>/** Trim* Also works with arrays, lists or sets*/${#strings.trim(str)} // also array*, list* and set*</code></pre><p>è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦ï¼š</p><pre><code>/** Compute length* Also works with arrays, lists or sets*/${#strings.length(str)} // also array*, list* and set*</code></pre><p>ç¼©å†™æ–‡æœ¬ä½¿å…¶æœ€å¤§å¤§å°ä¸ºnã€‚å¦‚æœæ–‡æœ¬æ›´å¤§ï¼Œå®ƒå°†è¢«å‰ªè¾‘å¹¶ä»¥â€œâ€¦â€ç»“å°¾</p><pre><code>${#strings.abbreviate(str,10)} // also array*, list* and set*</code></pre><p>å°†å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå¤§å†™æˆ–å°å†™</p><pre><code>${#strings.capitalize(str)} // also array*, list* and set*${#strings.unCapitalize(str)} // also array*, list* and set*</code></pre><p>å°†å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå•è¯çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå¤§å†™</p><pre><code>${#strings.capitalizeWords(str)} // also array*, list* and set*${#strings.capitalizeWords(str,delimiters)} // also array*, list* and set*</code></pre><p>å­—ç¬¦ä¸²è½¬ä¹‰</p><pre><code>${#strings.escapeXml(str)} // also array*, list* and set*${#strings.escapeJava(str)} // also array*, list* and set*${#strings.escapeJavaScript(str)} // also array*, list* and set*Page 98 of 106${#strings.escapeJavaScript(str)} // also array*, list* and set*${#strings.unescapeJava(str)} // also array*, list* and set*${#strings.unescapeJavaScript(str)} // also array*, list* and set*</code></pre><p>Null-Safe çš„æ¯”è¾ƒå’Œä¸²è” </p><pre><code>${#strings.equals(first, second)}${#strings.equalsIgnoreCase(first, second)}${#strings.concat(values...)}${#strings.concatReplaceNulls(nullValue, values...)}</code></pre><p>éšæœºæ•°</p><pre><code>${#strings.randomAlphanumeric(count)}</code></pre><h3 id="9-Objects"><a href="#9-Objects" class="headerlink" title="9.Objects"></a>9.Objects</h3><p><code>#objects</code> ï¼šå¯¹è±¡çš„å¸¸ç”¨å·¥å…·æ–¹æ³•ã€‚</p><p><code>org.thymeleaf.expression.Objects</code> æä¾›APIã€‚</p><pre><code>/** Return obj if it is not null, and default otherwise* Also works with arrays, lists or sets*/${#objects.nullSafe(obj,default)}${#objects.arrayNullSafe(objArray,default)}${#objects.listNullSafe(objList,default)}${#objects.setNullSafe(objSet,default)}</code></pre><h3 id="10-Booleans"><a href="#10-Booleans" class="headerlink" title="10. Booleans"></a>10. Booleans</h3><p><code>#booleans</code> ï¼šå¸ƒå°”è¿ç®—çš„å®ç”¨æ–¹æ³•ã€‚</p><p><code>org.thymeleaf.expression.Bool</code> æä¾›APIã€‚</p><pre><code>/** Evaluate a condition in the same way that it would be evaluated in a th:if tag* (see conditional evaluation chapter afterwards).* Also works with arrays, lists or sets*/${#bools.isTrue(obj)}${#bools.arrayIsTrue(objArray)}${#bools.listIsTrue(objList)}${#bools.setIsTrue(objSet)}/** Evaluate with negation* Also works with arrays, lists or sets*/${#bools.isFalse(cond)}${#bools.arrayIsFalse(condArray)}${#bools.listIsFalse(condList)}${#bools.setIsFalse(condSet)}/** Evaluate and apply AND operator* Receive an array, a list or a set as parameter*/${#bools.arrayAnd(condArray)}${#bools.listAnd(condList)}${#bools.setAnd(condSet)}/** Evaluate and apply OR operator* Receive an array, a list or a set as parameter*/${#bools.arrayOr(condArray)}${#bools.listOr(condList)}${#bools.setOr(condSet)}Arrays</code></pre><h3 id="11-Arrays"><a href="#11-Arrays" class="headerlink" title="11. Arrays"></a>11. Arrays</h3><p><code>#arrays</code> ï¼š æ•°ç»„å·¥å…·å¯¹è±¡ã€‚</p><p><code>org.thymeleaf.expression.Arrays</code>  æä¾›APIã€‚</p><pre><code>/** Converts to array, trying to infer array component class.* Note that if resulting array is empty, or if the elements* of the target object are not all of the same class,* this method will return Object[].*/${#arrays.toArray(object)}/** Convert to arrays of the specified component class.*/${#arrays.toStringArray(object)}${#arrays.toIntegerArray(object)}${#arrays.toLongArray(object)}${#arrays.toDoubleArray(object)}${#arrays.toFloatArray(object)}${#arrays.toBooleanArray(object)}/** Compute length*/${#arrays.length(array)}/** Check whether array is empty*/${#arrays.isEmpty(array)}/** Check if element or elements are contained in array*/${#arrays.contains(array, element)}${#arrays.containsAll(array, elements)}</code></pre><h3 id="12-Lists"><a href="#12-Lists" class="headerlink" title="12. Lists"></a>12. Lists</h3><p><code>#Lists</code> ï¼š List é›†åˆå·¥å…·å¯¹è±¡ã€‚</p><p><code>org.thymeleaf.expression.Lists</code>  æä¾›APIã€‚</p><pre><code>/** Converts to list*/${#lists.toList(object)}/** Compute size*/${#lists.size(list)}/** Check whether list is empty*/${#lists.isEmpty(list)}/** Check if element or elements are contained in list*/${#lists.contains(list, element)}${#lists.containsAll(list, elements)}/** Sort a copy of the given list. The members of the list must implement* comparable or you must define a comparator.*/${#lists.sort(list)}${#lists.sort(list, comparator)}</code></pre><h3 id="13-Sets"><a href="#13-Sets" class="headerlink" title="13. Sets"></a>13. Sets</h3><p><code>#Sets</code> ï¼š Sets é›†åˆå·¥å…·å¯¹è±¡ã€‚</p><p><code>org.thymeleaf.expression.Sets</code>  æä¾›APIã€‚</p><pre><code>/** Converts to set*/${#sets.toSet(object)}/** Compute size*/${#sets.size(set)}/** Check whether set is empty*/${#sets.isEmpty(set)}/** Check if element or elements are contained in set*/${#sets.contains(set, element)}${#sets.containsAll(set, elements)}</code></pre><h3 id="14-Maps"><a href="#14-Maps" class="headerlink" title="14. Maps"></a>14. Maps</h3><p><code>#Maps</code> ï¼š Maps é›†åˆå·¥å…·å¯¹è±¡ã€‚</p><p><code>org.thymeleaf.expression.Maps</code>  æä¾›APIã€‚</p><pre><code>/** Compute size*/${#maps.size(map)}/** Check whether map is empty*/${#maps.isEmpty(map)}/** Check if key/s or value/s are contained in maps*/${#maps.containsKey(map, key)}${#maps.containsAllKeys(map, keys)}${#maps.containsValue(map, value)}${#maps.containsAllValues(map, value)}</code></pre><h3 id="15-Aggregates"><a href="#15-Aggregates" class="headerlink" title="15. Aggregates"></a>15. Aggregates</h3><p><code>#Aggregates</code> ï¼š åœ¨æ•°ç»„æˆ–é›†åˆä¸Šåˆ›å»ºèšåˆçš„å®ç”¨æ–¹æ³•ã€‚</p><p><code>org.thymeleaf.expression.Aggregates</code>  æä¾›èšåˆAPIã€‚</p><pre><code>/** Compute sum. Returns null if array or collection is empty*/${#aggregates.sum(array)}${#aggregates.sum(collection)}/** Compute average. Returns null if array or collection is empty*/${#aggregates.avg(array)}${#aggregates.avg(collection)}</code></pre><h3 id="16-Ids"><a href="#16-Ids" class="headerlink" title="16. Ids"></a>16. Ids</h3><p><code>#Ids</code>ï¼šå¤„ç†å¯èƒ½é‡å¤çš„idå±æ€§çš„å®ç”¨æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œä½œä¸ºè¿­ä»£çš„ç»“æœï¼‰ã€‚</p><p><code>org.thymeleaf.expression.Aggregates.Ids</code>  æä¾›APIã€‚</p><pre><code>/** Normally used in th:id attributes, for appending a counter to the id attribute value* so that it remains unique even when involved in an iteration process.*/${#ids.seq(&#39;someId&#39;)}/** Normally used in th:for attributes in &lt;label&gt; tags, so that these labels can refer to Ids* generated by means if the #ids.seq(...) function.* *Depending on whether the &lt;label&gt; goes before or after the element with the #ids.seq(...)* function, the &quot;next&quot; (label goes before &quot;seq&quot;) or the &quot;prev&quot; function (label goes after* &quot;seq&quot;) function should be called.*/${#ids.next(&#39;someId&#39;)}${#ids.prev(&#39;someId&#39;)}</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Thymeleaf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thymeleaf è¯­æ³•å­¦ä¹ </title>
      <link href="/posts/9e1a85cd.html"/>
      <url>/posts/9e1a85cd.html</url>
      
        <content type="html"><![CDATA[<h2 id="SpringBoot-Thymeleaf-è¯­æ³•å­¦ä¹ "><a href="#SpringBoot-Thymeleaf-è¯­æ³•å­¦ä¹ " class="headerlink" title="SpringBoot Thymeleaf  è¯­æ³•å­¦ä¹ "></a>SpringBoot Thymeleaf  è¯­æ³•å­¦ä¹ </h2><h2 id="ä¸€ã€åŸºæœ¬ä½¿ç”¨"><a href="#ä¸€ã€åŸºæœ¬ä½¿ç”¨" class="headerlink" title="ä¸€ã€åŸºæœ¬ä½¿ç”¨"></a>ä¸€ã€åŸºæœ¬ä½¿ç”¨</h2><p>å¸¸è§çš„æ¨¡æ¿å¼•æ“æœ‰JSPã€Velocityã€Freemarkerã€Thymeleafç­‰</p><p>SpringBoot å®˜æ–¹æ¨èçš„æ˜¯ <strong>Thymeleaf</strong> </p><p>Thtmeleaf åœ¨ SpringBoot ä¸­ä½¿ç”¨åªè¦å¼•å…¥</p><pre class=" language-xml"><code class="language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>              2.1.6        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šåˆ‡æ¢thymeleafç‰ˆæœ¬ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thymeleaf.version</span><span class="token punctuation">></span></span>3.0.9.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thymeleaf.version</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- å¸ƒå±€åŠŸèƒ½çš„æ”¯æŒç¨‹åº  thymeleaf3ä¸»ç¨‹åº  layout2ä»¥ä¸Šç‰ˆæœ¬ --></span>        <span class="token comment" spellcheck="true">&lt;!-- thymeleaf2   layout1--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thymeleaf-layout-dialect.version</span><span class="token punctuation">></span></span>2.2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thymeleaf-layout-dialect.version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span></code></pre><p>Thymeleaf é…ç½®ç±»æ˜¯</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.thymeleaf"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThymeleafProperties</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Charset DEFAULT_ENCODING <span class="token operator">=</span> Charset<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> MimeType DEFAULT_CONTENT_TYPE <span class="token operator">=</span> MimeType<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">"text/html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String DEFAULT_PREFIX <span class="token operator">=</span> <span class="token string">"classpath:/templates/"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String DEFAULT_SUFFIX <span class="token operator">=</span> <span class="token string">".html"</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//</span></code></pre><p>å¯ä»¥è‡ªå®šä¹‰çš„é…ç½®ï¼š</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.thymeleaf.prefix</span><span class="token punctuation">=</span><span class="token attr-value">classpath:/views/</span><span class="token attr-name">spring.thymeleaf.suffix</span><span class="token punctuation">=</span><span class="token attr-value">.html</span><span class="token attr-name">spring.thymeleaf.mode</span><span class="token punctuation">=</span><span class="token attr-value">HTML5</span><span class="token attr-name">spring.thymeleaf.encoding</span><span class="token punctuation">=</span><span class="token attr-value">UTF-8</span><span class="token attr-name">spring.thymeleaf.servlet.content-type</span><span class="token punctuation">=</span><span class="token attr-value">text/html  </span><span class="token attr-name">spring.thymeleaf.cache</span><span class="token punctuation">=</span><span class="token attr-value">false</span></code></pre><p>ç¼“å­˜åœ¨å¼€å‘é˜¶æ®µå¯ä»¥è®¾ç½® <code>false</code>ã€‚idea ä¸­å¯ä»¥ä½¿ç”¨ Ctrl + F9 å¿«é€Ÿç¼–è¯‘ thymeleaf è¯­æ³•é¡µé¢ã€‚</p><p>å½“ç„¶ä¹Ÿä½¿ç”¨ä½¿ç”¨ Java æ–¹å¼é…ç½®ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GTVGApplication</span> <span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> TemplateEngine templateEngine<span class="token punctuation">;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">public</span> <span class="token function">GTVGApplication</span><span class="token punctuation">(</span><span class="token keyword">final</span> ServletContext servletContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ServletContextTemplateResolver templateResolver <span class="token operator">=</span>        <span class="token keyword">new</span> <span class="token class-name">ServletContextTemplateResolver</span><span class="token punctuation">(</span>servletContext<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// HTML is the default mode, but we set it anyway for better understanding of code</span>        templateResolver<span class="token punctuation">.</span><span class="token function">setTemplateMode</span><span class="token punctuation">(</span>TemplateMode<span class="token punctuation">.</span>HTML<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// This will convert "home" to "/WEB-INF/templates/home.html"</span>        templateResolver<span class="token punctuation">.</span><span class="token function">setPrefix</span><span class="token punctuation">(</span><span class="token string">"/WEB-INF/templates/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        templateResolver<span class="token punctuation">.</span><span class="token function">setSuffix</span><span class="token punctuation">(</span><span class="token string">".html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Template cache TTL=1h. If not set, entries would be cached until expelled</span>        templateResolver<span class="token punctuation">.</span><span class="token function">setCacheTTLMs</span><span class="token punctuation">(</span>Long<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>3600000L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Cache is set to true by default. Set to false if you want templates to</span>        <span class="token comment" spellcheck="true">// be automatically updated when modified.</span>        templateResolver<span class="token punctuation">.</span><span class="token function">setCacheable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>templateEngine<span class="token punctuation">.</span><span class="token function">setTemplateResolver</span><span class="token punctuation">(</span>templateResolver<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é»˜è®¤åªè¦æŠŠHTMLé¡µé¢æ”¾åœ¨classpath:/templates/ï¼Œthymeleafå°±èƒ½è‡ªåŠ¨æ¸²æŸ“ã€‚</p><h2 id="äºŒã€åŸºæœ¬è¯­æ³•"><a href="#äºŒã€åŸºæœ¬è¯­æ³•" class="headerlink" title="äºŒã€åŸºæœ¬è¯­æ³•"></a>äºŒã€åŸºæœ¬è¯­æ³•</h2><p>Thymeleaf æ”¯æŒ6ç§å¸¸è§æ¨¡æ¿æ¨¡å¼ï¼š</p><p>2ç§æ ‡è®°æ¨¡æ¿æ¨¡å¼ï¼šHTMLå’ŒXML;</p><p>3ç§æ–‡æœ¬æ¨¡æ¿æ¨¡å¼ï¼šTEXTã€JAVASCRIPTå’ŒCSS</p><p>1ç§æ— æ“ä½œæ¨¡æ¿æ¨¡å¼ï¼šRAW</p><p>1ã€å‘½åç©ºé—´</p><p>å¯¼å…¥thymeleafçš„åç§°ç©ºé—´ï¼Œåœ¨ç¼–å†™çš„æ—¶å€™ä¼šæœ‰æç¤ºã€‚</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>2ã€åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>This is my Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--th:text å°†divé‡Œé¢çš„æ–‡æœ¬å†…å®¹è®¾ç½®ä¸ºå–åˆ°çš„å€¼ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${hello}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>3ã€åŸºæœ¬è¯­æ³•è§„åˆ™</p><p><code>th:*</code>ï¼Œå¯ä»¥æ¥æ›¿æ¢åŸç”Ÿå±æ€§çš„å€¼ï¼Œå…¶ä¸­ <code>&quot;*&quot;</code> è¡¨ç¤ºä»»æ„htmlå±æ€§ã€‚</p><p>å¦‚å¸¸ç”¨çš„ <code>th:text</code> æ”¹å˜æˆ–æ›¿æ¢å½“å‰å…ƒç´ é‡Œé¢çš„æ–‡æœ¬å†…å®¹ã€‚</p><h2 id="ä¸‰ã€è¯­æ³•è§„åˆ™ä¸ä¼˜å…ˆçº§"><a href="#ä¸‰ã€è¯­æ³•è§„åˆ™ä¸ä¼˜å…ˆçº§" class="headerlink" title="ä¸‰ã€è¯­æ³•è§„åˆ™ä¸ä¼˜å…ˆçº§"></a>ä¸‰ã€è¯­æ³•è§„åˆ™ä¸ä¼˜å…ˆçº§</h2><p>è¯­æ³•ä¼˜å…ˆçº§æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚</p><table><thead><tr><th align="center">ä¼˜å…ˆçº§</th><th>åŸºæœ¬ç‰¹å¾</th><th>å¸¸è§å±æ€§</th><th>ç±»ä¼¼è¯­æ³• JSP/JSTL/JSç­‰</th></tr></thead><tbody><tr><td align="center">1</td><td>ç‰‡æ®µåŒ…å«</td><td><code>th:insert</code><br/><code>th:replace</code></td><td><code>jsp:include</code></td></tr><tr><td align="center">2</td><td>ç‰‡æ®µéå†</td><td><code>th:each</code></td><td><code>c:forEach</code></td></tr><tr><td align="center">3</td><td>æ¡ä»¶åˆ¤æ–­</td><td><code>th:if</code><br/><code>th:unless</code><br/><code>th:switch</code><br/><code>th:case</code></td><td><code>c:if</code></td></tr><tr><td align="center">4</td><td>å˜é‡å£°æ˜</td><td><code>th:object</code><br/><code>th:with</code></td><td><code>c:set</code></td></tr><tr><td align="center">5</td><td>ä¸€èˆ¬å±æ€§ä¿®æ”¹</td><td><code>th:attr</code><br/><code>th:attrprepend</code> <br/><code>th:attrappend</code></td><td><code>ç±»ä¼¼jsçš„ä¸­attr()</code><br/> <code>append()</code>ã€<code>appendTo()</code></td></tr><tr><td align="center">a</td><td>ç‰¹å®šå±æ€§ä¿®æ”¹</td><td><code>th:value</code> <br/><code>th:href</code> <br/><code>th:src</code></td><td><code>ç±»ä¼¼jsçš„ä¸­attr()</code><br/><code>val()</code></td></tr><tr><td align="center">7</td><td>ä¿®æ”¹æ ‡ç­¾ä½“å†…å®¹</td><td><code>th:text</code> <br/><code>th:utext</code></td><td>c:out</td></tr><tr><td align="center">8</td><td>ç‰‡æ®µå£°æ˜</td><td><code>th:fragment</code></td><td>-</td></tr><tr><td align="center">9</td><td>ç‰‡æ®µç§»é™¤</td><td><code>th:remove</code></td><td>-</td></tr></tbody></table><p>ç®€å•ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java">model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token string">"&lt;h2>Hello Thyneleaf ! &lt;/h2>"</span><span class="token punctuation">)</span></code></pre><p>é¡µé¢ä½¿ç”¨ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${hello}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>utext</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${hello}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>æœ€ç»ˆå±•ç¤ºæ•ˆæœåŒºåˆ«ï¼š</p><p><code>th:text</code> ï¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œå†…å®¹æ˜¯ä»€ä¹ˆåŸæ ·è¾“å‡ºä»€ä¹ˆï¼Œæµè§ˆå™¨ä¸è¿›è¡Œè§£æã€‚</p><p><code>th:utext</code> ï¼šä¸è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œæœ‰æ ‡ç­¾æ—¶ï¼Œæµè§ˆå™¨ä¼šè¯†åˆ«è§£æ html æ ‡ç­¾ã€‚</p><h2 id="å››ã€æ ‡å‡†çš„è¡¨è¾¾å¼è¯­æ³•"><a href="#å››ã€æ ‡å‡†çš„è¡¨è¾¾å¼è¯­æ³•" class="headerlink" title="å››ã€æ ‡å‡†çš„è¡¨è¾¾å¼è¯­æ³•"></a>å››ã€æ ‡å‡†çš„è¡¨è¾¾å¼è¯­æ³•</h2><p>å¸¸è§æˆ–å¸¸ç”¨è¡¨è¾¾å¼å­¦ä¹ ã€‚</p><h3 id="1-ç®€å•è¡¨è¾¾å¼"><a href="#1-ç®€å•è¡¨è¾¾å¼" class="headerlink" title="1. ç®€å•è¡¨è¾¾å¼"></a>1. ç®€å•è¡¨è¾¾å¼</h3><ul><li><p>Variable Expressionsï¼š è·å–å˜é‡å€¼çš„è¡¨è¾¾å¼ï¼š<code>${...}</code></p></li><li><p>Selection Variable Expressionsï¼šé€‰æ‹©è¡¨è¾¾å¼ï¼š <code>*{...}</code></p></li><li><p>Message Expressionsï¼š è·å–å›½é™…åŒ–çš„è¡¨è¾¾å¼ï¼š <code>#{...}</code></p></li><li><p>Link URL Expressions: å®šä¹‰URLçš„è¡¨è¾¾å¼ï¼š<code>@{...}</code></p></li><li><p>Fragment Expressions: å¼•ç”¨ä»£ç ç‰‡æ®µè¡¨è¾¾å¼ï¼š<code>~{...}</code></p></li></ul><h4 id="1ï¼‰-è·å–å˜é‡å€¼çš„è¡¨è¾¾å¼"><a href="#1ï¼‰-è·å–å˜é‡å€¼çš„è¡¨è¾¾å¼" class="headerlink" title="1ï¼‰ è·å–å˜é‡å€¼çš„è¡¨è¾¾å¼"></a>1ï¼‰ è·å–å˜é‡å€¼çš„è¡¨è¾¾å¼</h4><ul><li><p>è·å–å¯¹è±¡çš„å±æ€§ã€è°ƒç”¨æ–¹æ³•ï¼›</p></li><li><p>ä¹Ÿå¯ä»¥ä½¿ç”¨å†…ç½®çš„åŸºæœ¬å¯¹è±¡ï¼›</p></li></ul><p>ç®€å•ç¤ºä¾‹å¦‚ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>This is my Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${hello}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- å®é™…ç­‰ä»·äº  ctx.getVariable("today"); --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user.userName}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- å®é™…ç­‰ä»·äº  ctx.getVariable("session").get("user")).getUserName(); --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h5 id="a-å¸¸è§å–å˜é‡çš„å†™æ³•"><a href="#a-å¸¸è§å–å˜é‡çš„å†™æ³•" class="headerlink" title="(a) å¸¸è§å–å˜é‡çš„å†™æ³•"></a>(a) å¸¸è§å–å˜é‡çš„å†™æ³•</h5><p>è®¿é—®å±æ€§å¯ä»¥ä½¿ç”¨ <code>.</code> ç‚¹å·</p><pre><code>${person.father.name}${user.department.departmenrName}</code></pre><p>è®¿é—®å±æ€§å¯ä»¥ä½¿ç”¨ <code>[ ]</code> å·</p><pre><code>${person[&#39;father&#39;][&#39;name&#39;]}${user[&#39;department&#39;][&#39;departmenrName&#39;]}</code></pre><p>å¯¹è±¡æ˜¯ Map ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>[ ]</code> å’Œ <code>.</code> æ··ç”¨</p><pre><code>${countriesByCode.ES}${personsByName[&#39;Stephen Zucchini&#39;].age}</code></pre><p>å¸¦ç´¢å¼•çš„æ•°ç»„æˆ–é›†åˆå¯ä»¥ä½¿ç”¨ä¸‹æ ‡ç´¢å¼•è®¿é—®ï¼š</p><pre><code>${personsArray[0].name}</code></pre><p>ä¹Ÿå¯ä»¥è°ƒç”¨æ–¹æ³•ï¼Œå…è®¸å¸¦å‚æ•°ï¼š</p><pre><code>${person.createCompleteName()}${person.createCompleteNameWithSeparator(&#39;-&#39;)}</code></pre><h5 id="b-å¸¸è§å†…ç½®åŸºæœ¬å¯¹è±¡ï¼š"><a href="#b-å¸¸è§å†…ç½®åŸºæœ¬å¯¹è±¡ï¼š" class="headerlink" title="(b) å¸¸è§å†…ç½®åŸºæœ¬å¯¹è±¡ï¼š"></a>(b) å¸¸è§å†…ç½®åŸºæœ¬å¯¹è±¡ï¼š</h5><table><thead><tr><th>å†…ç½®å¯¹è±¡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>#ctx</td><td>å®¹å™¨å¯¹è±¡/ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä¹Ÿå¯ <code>#root</code> ,<code>#vars</code>,æ¨è<code>#ctx</code></td></tr><tr><td>#vars</td><td>å®¹å™¨é‡Œçš„å˜é‡</td></tr><tr><td>#locale</td><td>å®¹å™¨ç†çš„åŒºåŸŸå¯¹è±¡</td></tr><tr><td>#request</td><td>Webå®¹å™¨é‡Œçš„HttpServletRequestå¯¹è±¡</td></tr><tr><td>#response</td><td>Webå®¹å™¨é‡Œçš„HttpServletResponseå¯¹è±¡</td></tr><tr><td>#session</td><td>Webå®¹å™¨é‡Œçš„HttpSessionå¯¹è±¡</td></tr><tr><td>#servletContext</td><td>Webå®¹å™¨é‡Œçš„ServletContextå¯¹è±¡</td></tr></tbody></table><p>å†…ç½®å¯¹è±¡çš„è¯¦ç»†å†…å®¹æ¯”è¾ƒå¤šä¸€æ¬¡æ•´ç†ä¸å®Œï¼Œä¼šå•ç‹¬æ•´ç†ä¸€ç¯‡å†…ç½®å¯¹è±¡ã€‚</p><p>å†…ç½®å¯¹è±¡å‚è€ƒ<a href="44478111.html">ã€ŠThymeleaf å†…ç½®å¯¹è±¡ã€‹</a></p><h4 id="ï¼ˆcï¼‰å†…ç½®çš„å·¥å…·å¯¹è±¡"><a href="#ï¼ˆcï¼‰å†…ç½®çš„å·¥å…·å¯¹è±¡" class="headerlink" title="ï¼ˆcï¼‰å†…ç½®çš„å·¥å…·å¯¹è±¡"></a>ï¼ˆcï¼‰å†…ç½®çš„å·¥å…·å¯¹è±¡</h4><p><code>#execInfo</code> : æœ‰å…³æ¨¡æ¿è¿è¡Œæ—¶çš„ä¸€äº›ä¿¡æ¯<br><code>#messages</code> : åœ¨å˜é‡è¡¨è¾¾å¼ä¸­è·å–å›½é™…åŒ–ä¿¡æ¯çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>#{â€¦}</code>è¯­æ³•.<br><code>#uris</code> : å¯¹URIæˆ–URLè¿›è¡Œè½¬ä¹‰ç›¸å…³çš„æ–¹æ³•<br><code>#conversions</code> : å¦‚æœæœ‰å†™ç›¸å…³çš„è½¬æ¢ï¼Œç”¨æ¥æ‰§è¡Œé…ç½®çš„è½¬æ¢æœåŠ¡çš„æ–¹æ³•.<br><code>#dates</code> : java.util.Date æ—¥æœŸå¯¹è±¡æ ¼å¼åŒ–ï¼Œç»„ä»¶æå–çš„æ–¹æ³•<br><code>#calendars</code> : ç±»ä¼¼äº #dates , ä½†æ˜¯æ˜¯ java.util.Calendar å¯¹è±¡çš„.<br><code>#numbers</code> : æ•°å­—æ ¼å¼åŒ–ç›¸å…³çš„æ–¹æ³•.<br><code>#strings</code> : å­—ç¬¦ä¸²ç›¸å…³æ–¹æ³•: åŒ…å«, ä»¥ä»€ä¹ˆå¼€å§‹/ç»“å°¾, è¿½åŠ , å»ç©ºæ ¼ç­‰ç­‰.<br><code>#objects</code> : å¯¹è±¡é€šç”¨æ–¹æ³•.<br><code>#bools</code> : boolean è¿ç®—æ–¹æ³•<br><code>#arrays</code> : æ•°ç»„ç›¸å…³æ–¹æ³•.<br><code>#lists</code> : listé›†åˆç›¸å…³çš„æ–¹æ³•.<br><code>#sets</code> :  seté›†åˆç›¸å…³çš„æ–¹æ³•.<br><code>#maps</code> : mapé›†åˆç›¸å…³çš„æ–¹æ³•.<br><code>#aggregates</code> : åœ¨æ•°ç»„æˆ–é›†åˆä¸Šåˆ›å»ºèšåˆçš„æ–¹æ³•.<br><code>#ids</code> : å¤„ç†å¯èƒ½é‡å¤çš„idå±æ€§çš„æ–¹æ³•.ä¾‹å¦‚ï¼Œä½œä¸ºè¿­ä»£çš„ç»“æœ.</p><p>å†…ç½®å¯¹è±¡çš„è¯¦ç»†å†…å®¹æ¯”è¾ƒå¤šä¸€æ¬¡æ•´ç†ä¸å®Œï¼Œä¼šå•ç‹¬æ•´ç†ä¸€ç¯‡å†…ç½®å¯¹è±¡ã€‚</p><p>å†…ç½®å¯¹è±¡å‚è€ƒ<a href="44478111.html">ã€ŠThymeleaf å†…ç½®å¯¹è±¡ã€‹</a></p><h4 id="2ï¼‰é€‰æ‹©å˜é‡è¡¨è¾¾å¼"><a href="#2ï¼‰é€‰æ‹©å˜é‡è¡¨è¾¾å¼" class="headerlink" title="2ï¼‰é€‰æ‹©å˜é‡è¡¨è¾¾å¼"></a>2ï¼‰é€‰æ‹©å˜é‡è¡¨è¾¾å¼</h4><p>é€‰æ‹©è¡¨è¾¾å¼è¯­æ³•ï¼š<code>*{...}</code> å’Œ <code>*{...}</code></p><p> <code>*{...}</code> ä¸€èˆ¬é…åˆ <code>th:object</code> ä½¿ç”¨</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>object</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{firstName}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sebastian<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Surname: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{lastName}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Pepper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Email: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{email}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Saturn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>ç­‰ä»·äºï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user.firstName}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sebastian<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Surname: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user.lastName}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Pepper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Email: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user.email}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Saturn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>ä¹Ÿæ”¯æŒæ··åˆä½¿ç”¨:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>object</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{firstName}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sebastian<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Surname: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user.lastName}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Pepper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Email: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{email}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Saturn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>#object</code> è¡¨è¾¾å¼å–å€¼: </p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>object</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${#object.firstName}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sebastian<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Surname: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user.lastName}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Pepper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Email: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{email}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Saturn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span> &lt;/div    </code></pre><p>å¦‚æœæ²¡æœ‰æ‰§è¡Œå¯¹è±¡é€‰æ‹©ï¼Œ<code>$</code> å’Œ <code>*</code> è¯­æ³•æ˜¯ç­‰ä»·çš„:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{session.user.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sebastian<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Surname: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{session.user.surname}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Pepper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Email: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{session.user.email}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Saturn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><h4 id="3ï¼‰è·å–å›½é™…åŒ–çš„è¡¨è¾¾å¼"><a href="#3ï¼‰è·å–å›½é™…åŒ–çš„è¡¨è¾¾å¼" class="headerlink" title="3ï¼‰è·å–å›½é™…åŒ–çš„è¡¨è¾¾å¼"></a>3ï¼‰è·å–å›½é™…åŒ–çš„è¡¨è¾¾å¼</h4><p>è·å–å›½é™…åŒ–çš„è¡¨è¾¾å¼è¯­æ³•ï¼š <code>#{...}</code></p><p>æ¯”å¦‚åœ¨å›½é™…åŒ–é‡Œé…ç½®å¥½<br>é…ç½®è‹±æ–‡</p><pre><code>home.welcome=Welcome</code></pre><p>æˆ–è€…ä¸­æ–‡</p><pre><code>home.welcome=æ¬¢è¿ç™»å½•</code></pre><p>ä½¿ç”¨åˆ™ä½¿ç”¨è¡¨è¾¾å¼è·å–å³å¯</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>utext</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#{home.welcome}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Welcome to our site!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre><p>ä¹Ÿå¯ä»¥æ·»åŠ å ä½ç¬¦å‚æ•°è¿›è¡ŒåŠ¨æ€æ”¯æŒï¼š</p><p><code>java.text.MessageFormat</code> å‚æ•°æ”¯æŒã€‚</p><p><code>java.text.*</code> åŠ¨æ€æ¶ˆæ¯æ ¼å¼åŒ–ç±»å¯ä»¥æ ¼å¼åŒ–æ•°å­—æˆ–æ—¥æœŸã€‚</p><pre><code>home.welcome=Welcome, {0}!</code></pre><p>ä½¿ç”¨æ—¶ç›´æ¥ä¼ å…¥å‚æ•°å³å¯</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>utext</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#{home.welcome(${session.user.name})}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    Welcome to our site, guest!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre><p>å‚æ•°ä¹Ÿå¯ä»¥ä»å˜é‡è·å–</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>utext</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#{${welcomeMsgKey}(${session.user.name})}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    Welcome to our site, guest!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre><h4 id="4ï¼‰å®šä¹‰URLçš„è¡¨è¾¾å¼ï¼š"><a href="#4ï¼‰å®šä¹‰URLçš„è¡¨è¾¾å¼ï¼š" class="headerlink" title="4ï¼‰å®šä¹‰URLçš„è¡¨è¾¾å¼ï¼š"></a>4ï¼‰å®šä¹‰URLçš„è¡¨è¾¾å¼ï¼š</h4><p>å®šä¹‰URLçš„è¡¨è¾¾å¼è¯­æ³•ï¼š<code>@{...}</code></p><p>æ”¯æŒç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ã€‚<br>ç›¸å¯¹è·¯å¾„åŒ…æ‹¬ï¼š</p><ul><li>é¡µé¢ç›¸å¯¹è·¯å¾„ï¼šuser/login.html</li><li>ä¸Šä¸‹æ–‡ç›¸å¯¹è·¯å¾„ï¼š/emps?id=2</li><li>æœåŠ¡ç›¸å¯¹è·¯å¾„ï¼š~ã€billing/processInvoice</li><li>ç›¸å¯¹URLï¼š //code.jquery.com/jquery-2.0.3.min.js    </li></ul><blockquote><p>è¡¨è¾¾å¼çš„è¯­æ³•çœŸæ­£å¤„ç†åŠå…¶åˆ°å°†è¦è¾“å‡ºçš„urlçš„è½¬æ¢ç”±å®ç° <code>org.thymeleaf.linkbuilder</code>æ³¨å†Œåˆ°æ­£åœ¨ä½¿ç”¨ <code>ITemplateEngine</code> å¯¹è±¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¥å£çš„ä¸€ä¸ªå®ç°æ˜¯ç±»çš„æ³¨å†Œ<code>org.thymeleaf.linkbuilder.StandardLinkBuilder</code>ï¼Œå¯¹äºè„±æœºï¼ˆéwebï¼‰å’Œwebåœºæ™¯éƒ½å¯ä»¥æ”¯æŒåŸºäºServlet APIã€‚å…¶ä»–åœºæ™¯ï¼ˆå¦‚ä¸éServletAPI webæ¡†æ¶çš„é›†æˆï¼‰å¯èƒ½éœ€è¦ç‰¹å®šçš„é“¾æ¥ç”Ÿæˆå™¨æ¥å£çš„å®ç°ã€‚</p></blockquote><p>ä½¿ç”¨ï¼š<code>th:href</code></p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- Will produce 'http://localhost:8080/gtvg/order/details?orderId=3' (plus rewriting) --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>details.html<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{http://localhost:8080/gtvg/order/details(orderId<span class="token punctuation">=</span>${o.id})}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- Will produce '/gtvg/order/details?orderId=3' (plus rewriting) --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>details.html<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/order/details(orderId<span class="token punctuation">=</span>${o.id})}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!-- Will produce '/gtvg/order/3/details' (plus rewriting) --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>details.html<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/order/{orderId}/details(orderId<span class="token punctuation">=</span>${o.id})}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code></pre><p>æ³¨æ„äº‹é¡¹ï¼š</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ul><li><p><code>th:href</code> æ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦å±æ€§ï¼šä¸€æ—¦å¤„ç†ï¼Œå®ƒå°†è®¡ç®—è¦ä½¿ç”¨çš„é“¾æ¥URLå¹¶å°†è¯¥å€¼è®¾ç½®ä¸º<code>&lt;a&gt;</code> æ ‡è®°çš„hrefå±æ€§ã€‚</p></li><li><p>æˆ‘ä»¬å¯ä»¥å¯¹URLå‚æ•°ä½¿ç”¨è¡¨è¾¾å¼ï¼ˆå¦‚orderId=${o.id}ï¼‰ã€‚æ‰€éœ€çš„URLparameterç¼–ç æ“ä½œä¹Ÿå°†è‡ªåŠ¨æ‰§è¡Œã€‚</p></li><li><p>å¦‚æœéœ€è¦å¤šä¸ªå‚æ•°ï¼Œè¿™äº›å‚æ•°å°†ç”¨é€—å·éš”å¼€ï¼š<code>@{/order/process(execId=${execId}, execType=&#39;FAST&#39;)}</code></p></li><li><p>URLè·¯å¾„ä¸­ä¹Ÿå…è®¸å˜é‡æ¨¡æ¿ï¼š<code>@{/order/{orderId}/details(orderId=${orderId})}</code></p></li><li><p>ä»¥ <code>/</code> å¼€å¤´çš„ç›¸å¯¹URLå°†è‡ªåŠ¨ä»¥åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡åç§°ä½œä¸ºå‰ç¼€ã€‚ä¾‹å¦‚ï¼š<code>/order/details</code> æ˜¯é¡µé¢æŸ¥çœ‹æºä»£ç å¯ä»¥çœ‹åˆ°æ˜¯ <code>http://localhost:8080/thymeleaf/order/details</code></p></li><li><p>å¦‚æœ cookies æœªå¯ç”¨æˆ–å°šä¸çŸ¥é“ï¼Œåˆ™å¯èƒ½ä¼šåœ¨ç›¸å¯¹URLä¸­æ·»åŠ â€œï¼›jsessionid=â€¦â€åç¼€ï¼Œä»¥ä¾¿ä¼šè¯è¢«ä¿ç•™ã€‚è¿™å«åšURLé‡å†™ï¼ŒThymeleafå…è®¸ä½¿ç”¨ <code>response.encodeURL(...)</code> çš„æœºåˆ¶å¯¹æ¯ä¸ªURLçš„Servlet API è¿›è¡Œè‡ªå®šä¹‰é‡å†™ã€‚</p></li><li><p><code>th:href</code> å±æ€§å…è®¸æˆ‘ä»¬ï¼ˆå¯é€‰åœ°ï¼‰åœ¨æ¨¡æ¿ä¸­æœ‰ä¸€ä¸ªå·¥ä½œçš„é™æ€ <code>href</code>å±æ€§ï¼Œä»¥ä¾¿å½“ç›´æ¥æ‰“å¼€æ¨¡æ¿é“¾æ¥ä»¥è¿›è¡ŒåŸå‹è®¾è®¡æ—¶ï¼Œæµè§ˆå™¨ä»ç„¶å¯ä»¥å¯¼èˆªæ¨¡æ¿é“¾æ¥ã€‚é»˜è®¤<code>href</code> å’Œ <code>th:href</code> å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå³å¯ä»¥è®¾ç½®é»˜è®¤å€¼ã€‚</p></li></ul><p>å…è®¸URLé€šè¿‡è¿ç®—è·å¾—ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{${url}(orderId<span class="token punctuation">=</span>${o.id})}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{<span class="token punctuation">'</span>/details/<span class="token punctuation">'</span>+${user.login}(orderId<span class="token punctuation">=</span>${o.id})}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code></pre><p>ç®€å•ç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Please select an option<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>product/list.html<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/product/list}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Product List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>order/list.html<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/order/list}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Order List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subscribe.html<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/subscribe}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Subscribe to our Newsletter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userprofile.html<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/userprofile}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>See User Profile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">></span></span></code></pre><p> æœåŠ¡å™¨æ ¹ç›¸å¯¹URL</p><p>è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–è¯­æ³•æ¥åˆ›å»ºç›¸å¯¹äºæœåŠ¡å™¨æ ¹ç›®å½•ï¼ˆè€Œä¸æ˜¯ç›¸å¯¹äºä¸Šä¸‹æ–‡æ ¹ç›®å½•ï¼‰çš„urlï¼Œä»¥ä¾¿è¿›è¡Œé“¾æ¥åŒä¸€æœåŠ¡å™¨ä¸­çš„ä¸åŒä¸Šä¸‹æ–‡ã€‚è¿™äº›urlå°†è¢«æŒ‡å®šä¸º <code>@{~/path/to/something}</code></p><h4 id="5ï¼‰ç‰‡æ®µè¡¨è¾¾å¼"><a href="#5ï¼‰ç‰‡æ®µè¡¨è¾¾å¼" class="headerlink" title="5ï¼‰ç‰‡æ®µè¡¨è¾¾å¼"></a>5ï¼‰ç‰‡æ®µè¡¨è¾¾å¼</h4><p>å¼•ç”¨ä»£ç ç‰‡æ®µçš„ç‰‡æ®µå¼•ç”¨è¡¨è¾¾å¼è¯­æ³•ï¼š<code>~{...}</code></p><p>ç‰‡æ®µè¡¨è¾¾å¼æ˜¯è¡¨ç¤ºæ ‡è®°ç‰‡æ®µå¹¶åœ¨æ¨¡æ¿ä¸­ç§»åŠ¨å®ƒä»¬çš„ä¸€ç§ç®€å•æ–¹æ³•ã€‚è¿™å…è®¸æˆ‘ä»¬é‡å¤ä½¿ç”¨ç›¸åŒçš„ä»£ç ç‰‡æ®µï¼Œå°†å®ƒä»¬ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–æ¨¡æ¿ã€‚</p><p>ä»£ç ç‰‡æ®µä¸€èˆ¬é…åˆå¸ƒå±€ä½¿ç”¨ï¼Œæ¯”å¦‚å¤´éƒ¨ï¼Œèœå•ï¼Œè„šéƒ¨ç­‰å¯ä»¥å…¬å…±ä½¿ç”¨çš„ä»£ç ç‰‡æ®µã€‚</p><h5 id="a-å°ç¤ºä¾‹"><a href="#a-å°ç¤ºä¾‹" class="headerlink" title="(a) å°ç¤ºä¾‹"></a>(a) å°ç¤ºä¾‹</h5><p>å¦‚ï¼šåœ¨ <code>/template/footer.html</code> å®šä¹‰ä¸€ä¸ªç‰‡æ®µ</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>copy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token entity" title="&copy;">&amp;copy;</span> 2020  Small-Rose     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>å¯ä»¥åœ¨  <code>home.html</code> ä½¿ç”¨ <code>th:insert</code> æˆ– <code>th:replace</code> æˆ– <code>th:include</code> å¼•ç”¨ç‰‡æ®µï¼š</p><p>ä½¿ç”¨  <code>th:insert</code> :</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>...    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>insert</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>~{footer :: copy}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><p>å¯¹äºéå¤æ‚çš„è¡¨è¾¾å¼ç­‰ä»·äº</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>...    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>insert</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer :: copy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><h5 id="b-ç‰‡æ®µè§„èŒƒè¯­æ³•"><a href="#b-ç‰‡æ®µè§„èŒƒè¯­æ³•" class="headerlink" title="(b) ç‰‡æ®µè§„èŒƒè¯­æ³•"></a>(b) ç‰‡æ®µè§„èŒƒè¯­æ³•</h5><p>è§„èŒƒè¯­æ³•æœ‰ä¸‰ç§ï¼š</p><ul><li><code>&quot;~{templatename::selector}&quot;</code> å¼•å…¥åä¸º <code>templatename</code> ï¼ŒæŒ‡å®šæ ‡è®°é€‰æ‹©å™¨çš„æ¨¡æ¿ç‰‡æ®µã€‚æ³¨æ„å¯ä»¥æ˜¯ä¸€ä¸ªç‰‡æ®µåï¼Œæ ‡è®°é€‰æ‹©å™¨å¯ä»¥æŒ‡å®šä¸€äº›å†…å®¹ã€‚</li><li><code>&quot;~{templatename::selector}&quot;</code> å¼•å…¥åä¸º <code>templatename</code> çš„æ¨¡æ¿ç‰‡æ®µã€‚</li><li><code>~{::selector}&quot;</code> æˆ– <code>&quot;~{this::selector}&quot;</code> å¼•å…¥åŒ¹é…é€‰æ‹©å™¨çš„åŒä¸€æ¨¡æ¿ä¸­çš„ç‰‡æ®µï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™ä¼šéå†æ•´ä¸ªæ¨¡æ¿ç›®å½•ï¼Œç›´åˆ°é€‰æ‹©å™¨æ‰¾åˆ°åŒ¹é…ã€‚</li></ul><p>å¼•å…¥æ–¹å¼éƒ½æ˜¯å…¨åŠŸèƒ½çš„ï¼Œæ”¯æŒé€‰æ‹©è¡¨è¾¾å¼ã€‚</p><p>æ¯”å¦‚å®šä¹‰å¤šä¸ªï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>adminFooter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token entity" title="&copy;">&amp;copy;</span> 2020 Welcome to site , Admin ~<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>normaluser<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token entity" title="&copy;">&amp;copy;</span> 2020  Welcome to Site <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>å¯¹åº”çš„ä½¿ç”¨ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>insert</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer :: (${user.isAdmin}? #{footer.admin} : #{footer.normaluser})<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ˜¯Adminç”¨æˆ·ï¼Œå¦‚æœæ˜¯adminï¼Œåˆ™å¼•å…¥ footer æ¨¡æ¿é¡µé¢ä¸­å–åˆ°çš„å›½é™…åŒ–å€¼( <code>#{footer.admin}</code>)å¯¹åº”çš„ä»£ç ç‰‡æ®µã€‚</p><p>å¦‚ä¸ä½¿ç”¨<code>th:fragment</code> å®šä¹‰ç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>copy-section<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token entity" title="&copy;">&amp;copy;</span> 2020 Small-Rose<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>å¯¹åº”çš„å¼•å…¥ä¸ºï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>...&lt;    div th:insert="~{footer :: #copy-section}"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><p>å…¶å®å°±æ˜¯ä½¿ç”¨äº†css é€‰æ‹©å™¨ï¼Œè¿™é‡Œä½¿ç”¨çš„ id é€‰æ‹©å™¨</p><h5 id="c-ä¸‰ç§ç‰‡æ®µè§„èŒƒåŒºåˆ«"><a href="#c-ä¸‰ç§ç‰‡æ®µè§„èŒƒåŒºåˆ«" class="headerlink" title="(c) ä¸‰ç§ç‰‡æ®µè§„èŒƒåŒºåˆ«"></a>(c) ä¸‰ç§ç‰‡æ®µè§„èŒƒåŒºåˆ«</h5><p><code>th:insert</code> å’Œ <code>th:replace</code>å’Œ <code>th:include</code>(ä»3.0å¼€å§‹ä¸æ¨èï¼‰ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><ul><li><code>th:insert</code> æœ€ç®€å•çš„ä½¿ç”¨ï¼Œç›´æ¥å°†å¼•å…¥çš„ä»£ç ç‰‡æ®µæ’å…¥å¼•ç”¨å¤„çš„æ ‡ç­¾ã€‚</li><li><code>th:replace</code> ç›´æ¥å°†å¼•å…¥çš„ä»£ç ç‰‡æ®µæ›¿æ¢å¼•ç”¨å¤„çš„æ ‡ç­¾ã€‚</li><li><code>th:include</code> æœ‰ç‚¹ç±»ä¼¼ <code>th:insert</code> ï¼Œä½†åªæ˜¯æ’å…¥å¼•ç”¨ä»£ç ç‰‡æ®µçš„å†…å®¹éƒ¨åˆ†ã€‚     </li></ul><p>æ¥ä¸ªç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>copy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token entity" title="&copy;">&amp;copy;</span> 2020 Small-Rose<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span></code></pre><p>ä¸åŒçš„å¼•å…¥æ–¹å¼ï¼Œå‡å¦‚ä½¿ç”¨ <code>&lt;div&gt;</code> å¼•å…¥ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>...    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>insert</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer :: copy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer :: copy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>include</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer :: copy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><p>æœ€ç»ˆæ•ˆæœï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>...    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span>            <span class="token entity" title="&copy;">&amp;copy;</span> 2020 Small-Rose        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span>        <span class="token entity" title="&copy;">&amp;copy;</span> 2020 Small-Rose    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token entity" title="&copy;">&amp;copy;</span> 2020 Small-Rose    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><h5 id="dï¼‰å¯å‚æ•°åŒ–ç‰‡æ®µç­¾å"><a href="#dï¼‰å¯å‚æ•°åŒ–ç‰‡æ®µç­¾å" class="headerlink" title="(dï¼‰å¯å‚æ•°åŒ–ç‰‡æ®µç­¾å"></a>(dï¼‰å¯å‚æ•°åŒ–ç‰‡æ®µç­¾å</h5><p>å‚æ•°åŒ–ç­¾åå¯ä»¥ä½¿æ¨¡æ¿ç‰‡æ®µåˆ›å»ºä¸€ä¸ªç±»ä¼¼å‡½æ•°çš„æœºåˆ¶ï¼Œç”¨<code>th:fragment</code>å®šä¹‰çš„ç‰‡æ®µå¯ä»¥æŒ‡å®šä¸€ç»„å‚æ•°ã€‚</p><pre><code>&lt;div th:fragment=&quot;frag (onevar,twovar)&quot;&gt;    &lt;p th:text=&quot;${onevar} + &#39; - &#39; + ${twovar}&quot;&gt;...&lt;/p&gt;&lt;/div</code></pre><p>åœ¨å¼•å…¥ä»£ç ç‰‡æ®µçš„åœ°æ–¹ä¼ å…¥å‚æ•° <code>th:insert</code> æˆ– <code>th:replace</code> çš†å¯ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>::frag (${value1},${value2})<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>è¯¥ç§æ–¹å¼éœ€è¦æ³¨æ„å‚æ•°é¡ºåºï¼Œå¦‚æœä¸æƒ³ä¸ºå‚æ•°é¡ºåºçƒ¦æ¼ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>::frag (onevar<span class="token punctuation">=</span>${value1},twovar<span class="token punctuation">=</span>${value2})<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p><strong>ç‰¹åˆ«æ³¨æ„</strong></p><p>å¦‚æœåœ¨å®šä¹‰çš„æ—¶å€™ä¸æŒ‡å®šæ¨¡æ¿ï¼Œåˆ™åªèƒ½ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ä¼ å…¥å‚æ•°ã€‚</p><p>å®šä¹‰ç‰‡æ®µï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>frag<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>å¼•å…¥ä½¿ç”¨åªèƒ½ç¬¬äºŒç§æ–¹å¼ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>::frag (onevar<span class="token punctuation">=</span>${value1},twovar<span class="token punctuation">=</span>${value2})<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>ç­‰ä»·äº<code>th:replace</code> å’Œ <code>th:with</code> çš„ç»„åˆï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>::frag<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>with</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onevar<span class="token punctuation">=</span>${value1},twovar<span class="token punctuation">=</span>${value2}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><h5 id="eï¼‰æ¨¡æ¿å†…æ–­è¨€"><a href="#eï¼‰æ¨¡æ¿å†…æ–­è¨€" class="headerlink" title="(eï¼‰æ¨¡æ¿å†…æ–­è¨€"></a>(eï¼‰æ¨¡æ¿å†…æ–­è¨€</h5><p><code>th:assert</code> å¯¹äºæ¨¡æ¿å†…æ–­è¨€ <code>th:assert</code> å±æ€§å¯ä»¥æŒ‡å®šä¸€ä¸ªé€—å·åˆ†éš”çš„è¡¨è¾¾å¼åˆ—è¡¨ï¼Œåªæœ‰å½“æ¯ä¸ªè¡¨è¾¾å¼çš„å€¼éƒ½æ˜¯trueçš„æ—¶å€™ï¼Œå¯¹åº”çš„ä»£ç ç‰‡æ®µå°†ä¼šè¢«æ¿€æ´»ï¼Œå¦åˆ™ä¼šå¼•å‘å¼‚å¸¸ã€‚</p><p>ç‰‡æ®µç­¾åæ·»åŠ å‚æ•°éªŒè¯ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>contentheader(title)<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>assert</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${!#strings.isEmpty(title)}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span></code></pre><h5 id="fï¼‰çµæ´»å¸ƒå±€"><a href="#fï¼‰çµæ´»å¸ƒå±€" class="headerlink" title="(fï¼‰çµæ´»å¸ƒå±€"></a>(fï¼‰çµæ´»å¸ƒå±€</h5><p>ç‰‡æ®µä¸­titleå’Œlinkså˜é‡çš„ç”¨æ³•ï¼Œåœ¨<code>/template/base.html</code> ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>common_header(title,links)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${title}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>The awesome application<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- Common styles and scripts --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/css/awesomeapp.css}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>shortcut icon<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/images/favicon.ico}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/sh/scripts/codebase.js}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--/* Per-page placeholder for additional links */--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">th:</span>block</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${links}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></code></pre><p>ä½¿ç”¨</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>base :: common_header(~{::title},~{::link})<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Awesome - Main<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/css/bootstrap.min.css}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/themes/smoothness/jquery-ui.css}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></code></pre><p>è¿™é‡Œçš„å¼•å…¥æ˜¯ä½¿ç”¨çš„é€‰æ‹©å™¨æ–¹å¼å¼•å…¥ï¼Œç»“æœå°†ä½¿ç”¨è°ƒç”¨æ¨¡æ¿ä¸­çš„å®é™… <code>&lt;title&gt;</code> å’Œ <code>&lt;link&gt;</code> æ ‡è®°ä½œä¸º<code>title</code>å’Œé“¾æ¥å˜é‡ï¼Œä½¿æˆ‘ä»¬çš„ç‰‡æ®µåœ¨æ’å…¥è¿‡ç¨‹ä¸­è¢«è‡ªå®šä¹‰ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Awesome - Main<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- Common styles and scripts --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/awe/css/awesomeapp.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>shortcut icon<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/awe/images/favicon.ico<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/awe/sh/scripts/codebase.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/awe/css/bootstrap.min.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/awe/themes/smoothness/jquery-ui.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></code></pre><p>è¿˜æœ‰ä¸€äº›ç©ºç‰‡æ®µä½¿ç”¨ã€æ— æ“ä½œç‰‡æ®µä½¿ç”¨å‚è€ƒ<a href="https://www.thymeleaf.org/documentation.html" target="_blank" rel="noopener">Thymeleaf å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h3 id="2-å­—é¢é‡è¡¨è¾¾å¼"><a href="#2-å­—é¢é‡è¡¨è¾¾å¼" class="headerlink" title="2. å­—é¢é‡è¡¨è¾¾å¼"></a>2. å­—é¢é‡è¡¨è¾¾å¼</h3><p>1ï¼‰æ–‡æœ¬å­—é¢é‡</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Now you are looking at a <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>working web application<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>template file<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.&lt;/p</code></pre><p>2ï¼‰æ•°å­—å­—é¢é‡</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>The year is <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2013<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1492<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>In two years, it will be <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2013 + 2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1494<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre><p>3ï¼‰å¸ƒå°”å­—é¢é‡</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.isAdmin()} <span class="token punctuation">=</span><span class="token punctuation">=</span> false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>4ï¼‰nullå­—é¢é‡</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${variable.something} <span class="token punctuation">=</span><span class="token punctuation">=</span> null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>3ï¼‰æ–‡å­—æ ‡è®°</p><p>æ•°å­—ã€å¸ƒå°”å’Œç©ºæ–‡å­—å®é™…ä¸Šæ˜¯æ–‡å­—æ ‡è®°çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚</p><p>æ–‡å­—æ ‡è®°å…è®¸åœ¨æ ‡å‡†è¡¨è¾¾å¼ä¸­è¿›è¡Œä¸€ç‚¹ç®€åŒ–ã€‚å®ƒä»¬çš„å·¥ä½œåŸç†ä¸æ–‡æœ¬å­—é¢é‡å®Œå…¨ç›¸åŒï¼Œä½†å®ƒä»¬åªå…è®¸å­—æ¯<code>A-Z</code> å’Œ <code>A-Z</code>ã€æ•°å­— <code>0-9</code>ã€æ–¹æ‹¬å·<code>[ ]</code>ã€ç‚¹ <code>.</code>ï¼Œè¿å­—ç¬¦<code>-</code> å’Œä¸‹åˆ’çº¿<code>_</code> ã€‚<strong>æ²¡æœ‰ç©ºæ ¼ï¼Œæ²¡æœ‰é€—å·ç­‰</strong>ã€‚</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>ä»£æ›¿</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>content<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><h3 id="3-æ–‡æœ¬æ“ä½œ"><a href="#3-æ–‡æœ¬æ“ä½œ" class="headerlink" title="3. æ–‡æœ¬æ“ä½œ"></a>3. æ–‡æœ¬æ“ä½œ</h3><p><code>+</code> ä½¿ç”¨ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>The name of the user is <span class="token punctuation">'</span> + ${user.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&lt;/p</code></pre><p><code>|</code> ä½¿ç”¨ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>|Welcome to our application, ${user.name}!|<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>Welcome to our application, <span class="token punctuation">'</span> + ${user.name} + <span class="token punctuation">'</span>!<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>ç»„åˆä½¿ç”¨</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${onevar} + <span class="token punctuation">'</span> <span class="token punctuation">'</span> + |${twovar}, ${threevar}|<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><p><strong>æ³¨æ„ï¼š</strong>åœ¨ <code>|  |</code> æ–‡æœ¬æ›¿æ¢ä¸­åªå…è®¸å˜é‡/æ¶ˆæ¯è¡¨è¾¾å¼ï¼ˆ<code>${â€¦}</code>ï¼Œ<code>*{â€¦}</code>ï¼Œ<code>#{â€¦}</code>ï¼‰ã€‚ä¸å…è®¸å…¶ä»–æ–‡å­—æ ‡è®°ï¼ˆ<code>&quot;â€¦&quot;</code>ï¼‰ã€å¸ƒå°”/æ•°å­—æ ‡è®°ã€æ¡ä»¶è¡¨è¾¾å¼ç­‰ã€‚</p><h3 id="4-æ•°å­¦è¿ç®—"><a href="#4-æ•°å­¦è¿ç®—" class="headerlink" title="4. æ•°å­¦è¿ç®—"></a>4. æ•°å­¦è¿ç®—</h3><p>å¸¸è§çš„ï¼š<strong><code>+</code> , <code>-</code> , <code>*</code> , <code>/</code> å’Œ <code>%</code></strong></p><p>æ–‡æœ¬åˆ«åè¿ç®—ç¬¦ï¼š<code>div</code>ï¼ˆ<code>/</code>ï¼‰ï¼Œ  <code>mod</code>ï¼ˆ<code>%</code>ï¼‰</p><h3 id="5-é€»è¾‘è¿ç®—"><a href="#5-é€»è¾‘è¿ç®—" class="headerlink" title="5.é€»è¾‘è¿ç®—"></a>5.é€»è¾‘è¿ç®—</h3><p>å¸¸è§çš„è¿ç®—ç¬¦ï¼š<code>and</code> ï¼Œ<code>or</code> , <code>|</code> ï¼Œ<code>not</code></p><h3 id="6-æ¯”è¾ƒè¿ç®—"><a href="#6-æ¯”è¾ƒè¿ç®—" class="headerlink" title="6. æ¯”è¾ƒè¿ç®—"></a>6. æ¯”è¾ƒè¿ç®—</h3><p>gt ( &gt; ), lt ( &lt; ), ge ( &gt;= ), le ( &lt;= ), not ( ! ). Also eq ( == ), neq / ne ( != ).    </p><table><thead><tr><th>æ¯”è¾ƒè¿ç®—</th><th>ç¬¦å·</th></tr></thead><tbody><tr><td>å¤§äº</td><td><code>gt</code> ï¼Œ <code>&gt;</code></td></tr><tr><td>å°äº</td><td><code>lt</code> ï¼Œ <code>&lt;</code></td></tr><tr><td>å¤§äºæˆ–ç­‰äº</td><td><code>ge</code> ï¼Œ<code>&gt;=</code></td></tr><tr><td>å°äºæˆ–ç­‰äº</td><td><code>le</code> ï¼Œ <code>&lt;=</code></td></tr><tr><td>é</td><td><code>not</code> ï¼Œ <code>!</code></td></tr><tr><td>ç­‰äº</td><td><code>eq</code> ï¼Œ <code>==</code></td></tr><tr><td>ä¸ç­‰äº</td><td><code>neq</code> ï¼Œ<code>!=</code></td></tr></tbody></table><h3 id="6-æ¡ä»¶è¡¨è¾¾å¼"><a href="#6-æ¡ä»¶è¡¨è¾¾å¼" class="headerlink" title="6. æ¡ä»¶è¡¨è¾¾å¼"></a>6. æ¡ä»¶è¡¨è¾¾å¼</h3><p>å¸¸è§çš„æ¡ä»¶è¡¨è¾¾å¼åŸºæœ¬æ ¼å¼ï¼š</p><ul><li><code>condition ? then : else</code></li><li><code>condition ? then</code></li><li><code>condition ? ( condition2 ? then2 : else2 ): else</code></li></ul><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${row.even}? <span class="token punctuation">'</span>even<span class="token punctuation">'</span> : <span class="token punctuation">'</span>odd<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span></code></pre><p>æ¡ä»¶è¡¨è¾¾å¼çš„ä¸‰ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥ä½¿ç”¨ï¼š</p><ul><li>å˜é‡è¡¨è¾¾å¼ <code>${ }</code>ï¼Œ <code>*{ }</code> ï¼Œ</li><li>æ¶ˆæ¯è¡¨è¾¾å¼ <code>#{ }</code> ï¼Œ</li><li>é“¾æ¥è¡¨è¾¾å¼ <code>@{ }</code> ï¼Œ</li><li>å­—é¢é‡è¡¨è¾¾å¼ <code>&#39; &#39;</code>ã€‚</li></ul><h3 id="7-é»˜è®¤è¡¨è¾¾å¼"><a href="#7-é»˜è®¤è¡¨è¾¾å¼" class="headerlink" title="7. é»˜è®¤è¡¨è¾¾å¼"></a>7. é»˜è®¤è¡¨è¾¾å¼</h3><p>é»˜è®¤è¡¨è¾¾å¼æ˜¯æ¡ä»¶è¡¨è¾¾å¼æ²¡æœ‰ <code>then</code> éƒ¨åˆ†ã€‚</p><p>åŸºæœ¬è¯­æ³•ï¼š<code>condition ?: else</code></p><p>åµŒå¥—è¯­æ³•ï¼š<code>condition ?: ( condition ? then : else )</code></p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>object</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Age: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{age}?: <span class="token punctuation">'</span>(no age specified)<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>27<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>ç­‰ä»·äºï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Age: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{age !<span class="token punctuation">=</span> null}? *{age} : <span class="token punctuation">'</span>(no age specified)<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>27<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre><p>åµŒå¥—ç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*{firstName}?: (*{admin}? <span class="token punctuation">'</span>Admin<span class="token punctuation">'</span> : #{default.username})<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sebastian<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre><h3 id="8-æ— æ“ä½œæ ‡è®°"><a href="#8-æ— æ“ä½œæ ‡è®°" class="headerlink" title="8. æ— æ“ä½œæ ‡è®°"></a>8. æ— æ“ä½œæ ‡è®°</h3><p>æ— æ“ä½œæ ‡è®°ä½¿ç”¨ä¸‹åˆ’çº¿ç¬¦å· <code>_</code> </p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.name} ?: _<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>no user authenticated<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><h2 id="äº”ã€å±æ€§è®¾ç½®"><a href="#äº”ã€å±æ€§è®¾ç½®" class="headerlink" title="äº”ã€å±æ€§è®¾ç½®"></a>äº”ã€å±æ€§è®¾ç½®</h2><h3 id="1ã€é€šç”¨å±æ€§è®¾ç½®"><a href="#1ã€é€šç”¨å±æ€§è®¾ç½®" class="headerlink" title="1ã€é€šç”¨å±æ€§è®¾ç½®"></a>1ã€é€šç”¨å±æ€§è®¾ç½®</h3><p>åŸºæœ¬è¯­æ³•ï¼š<code>th:attr</code></p><p>å¦‚ï¼ŒåŠ¨æ€è®¾ç½®è¡¨å•çš„ <code>action</code> å€¼ã€æ ¹æ®å›½é™…åŒ–çš„å€¼æ˜¾ç¤ºæŒ‰é’®æ–‡å­—ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subscribe.html<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>action<span class="token punctuation">=</span>@{/subscribe}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Subscribe!<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>value<span class="token punctuation">=</span>#{subscribe.submit}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><p>ä¹Ÿå¯ä»¥è®¾ç½®æ ‡ç­¾æ²¡æœ‰çš„è‡ªå®šä¹‰å±æ€§:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>someone<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>love<span class="token punctuation">=</span>you<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>è¿˜å¯ä»¥è®¾ç½®å¤šä¸ªå±æ€§ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../images/gtvglogo.png<span class="token punctuation">"</span></span><span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>src<span class="token punctuation">=</span>@{/images/gtvglogo.png},title<span class="token punctuation">=</span>#{logo},alt<span class="token punctuation">=</span>#{logo}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><h3 id="2ã€ç‰¹æ®Šå±æ€§è®¾ç½®"><a href="#2ã€ç‰¹æ®Šå±æ€§è®¾ç½®" class="headerlink" title="2ã€ç‰¹æ®Šå±æ€§è®¾ç½®"></a>2ã€ç‰¹æ®Šå±æ€§è®¾ç½®</h3><p>æ¯”å¦‚ä¸Šé¢ä½¿ç”¨ <code>th:attr</code> è®¾ç½® <code>action</code> å±æ€§å’Œ <code>value</code> å±æ€§ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Subscribe!<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>value<span class="token punctuation">=</span>#{subscribe.submit}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>th:action</code>  å’Œ <code>th:value</code> è®¾ç½® ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subscribe.html<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/subscribe}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Subscribe!<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#{subscribe.submit}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><p>HTML5 å¸¸è§ç‰¹æ®Šå±æ€§ï¼š</p><table><thead><tr><th align="left">th:abbr</th><th align="left">th:accesskey</th><th align="left">th:alt</th></tr></thead><tbody><tr><td align="left">th:autocomplete</td><td align="left">th:accept</td><td align="left">th:action</td></tr><tr><td align="left">th:archive</td><td align="left">th:axis</td><td align="left">th:accept-charset</td></tr><tr><td align="left">th:align</td><td align="left">th:audio</td><td align="left">th:background</td></tr><tr><td align="left">th:bgcolor</td><td align="left">th:cellspacing</td><td align="left">th:cite</td></tr><tr><td align="left">th:codebase</td><td align="left">th:colspan</td><td align="left">th:contenteditable</td></tr><tr><td align="left">th:border</td><td align="left">th:challenge</td><td align="left">th:class</td></tr><tr><td align="left">th:codetype</td><td align="left">th:compact</td><td align="left">th:contextmenu</td></tr><tr><td align="left">th:cellpadding</td><td align="left">th:charset</td><td align="left">th:classid</td></tr><tr><td align="left">th:cols</td><td align="left">th:content</td><td align="left">th:data</td></tr><tr><td align="left">th:datetime</td><td align="left">th:dropzone</td><td align="left">th:form</td></tr><tr><td align="left">th:formmethod</td><td align="left">th:frame</td><td align="left">th:dir</td></tr><tr><td align="left">th:enctype</td><td align="left">th:formaction</td><td align="left">th:formtarget</td></tr><tr><td align="left">th:frameborder</td><td align="left">th:draggable</td><td align="left">th:for</td></tr><tr><td align="left">th:formenctype</td><td align="left">th:fragment</td><td align="left">th:headers</td></tr><tr><td align="left">th:height</td><td align="left">th:hreflang</td><td align="left">th:icon</td></tr><tr><td align="left">th:keytype</td><td align="left">th:lang</td><td align="left">th:low</td></tr><tr><td align="left">th:high</td><td align="left">th:hspace</td><td align="left">th:id</td></tr><tr><td align="left">th:kind</td><td align="left">th:list</td><td align="left">th:manifest</td></tr><tr><td align="left">th:href</td><td align="left">th:http-equiv</td><td align="left">th:inline</td></tr><tr><td align="left">th:label</td><td align="left">th:longdesc</td><td align="left">th:marginheight</td></tr><tr><td align="left">th:low</td><td align="left">th:manifest</td><td align="left">th:marginheight</td></tr><tr><td align="left">th:marginwidth</td><td align="left">th:media</td><td align="left">th:name</td></tr><tr><td align="left">th:onbeforeprint</td><td align="left">th:oncanplay</td><td align="left">th:max</td></tr><tr><td align="left">th:method</td><td align="left">th:onabort</td><td align="left">th:onbeforeunload</td></tr><tr><td align="left">th:oncanplaythrough</td><td align="left">th:maxlength</td><td align="left">th:min</td></tr><tr><td align="left">th:onafterprint</td><td align="left">th:onblur</td><td align="left">th:onchange</td></tr><tr><td align="left">th:onclick</td><td align="left">th:ondrag</td><td align="left">th:ondragleave</td></tr><tr><td align="left">th:ondrop</td><td align="left">th:onended</td><td align="left">th:onformchange</td></tr><tr><td align="left">th:oncontextmenu</td><td align="left">th:ondragend</td><td align="left">th:ondragover</td></tr><tr><td align="left">th:ondurationchange</td><td align="left">th:onerror</td><td align="left">th:onforminput</td></tr><tr><td align="left">th:ondblclick</td><td align="left">th:ondragenter</td><td align="left">th:ondragstart</td></tr><tr><td align="left">th:onemptied</td><td align="left">th:onfocus</td><td align="left">th:onhashchange</td></tr><tr><td align="left">th:oninput</td><td align="left">th:onkeypress</td><td align="left">th:onloadeddata</td></tr><tr><td align="left">th:onmessage</td><td align="left">th:onmouseout</td><td align="left">th:oninvalid</td></tr><tr><td align="left">th:onkeyup</td><td align="left">th:onloadedmetadata</td><td align="left">th:onmousedown</td></tr><tr><td align="left">th:onmouseover</td><td align="left">th:onkeydown</td><td align="left">th:onload</td></tr><tr><td align="left">th:onloadstart</td><td align="left">th:onmousemove</td><td align="left">th:onmouseup</td></tr><tr><td align="left">th:onmousewheel</td><td align="left">th:onpause</td><td align="left">th:onpopstate</td></tr><tr><td align="left">th:onreadystatechange</td><td align="left">th:onresize</td><td align="left">th:onoffline</td></tr><tr><td align="left">th:onplay</td><td align="left">th:onprogress</td><td align="left">th:onredo</td></tr><tr><td align="left">th:onscroll</td><td align="left">th:ononline</td><td align="left">th:onplaying</td></tr><tr><td align="left">th:onratechange</td><td align="left">th:onreset</td><td align="left">th:onseeked</td></tr><tr><td align="left">th:onseeking</td><td align="left">th:onstalled</td><td align="left">th:onsuspend</td></tr><tr><td align="left">th:onunload</td><td align="left">th:optimum</td><td align="left">th:poster</td></tr><tr><td align="left">th:onselect</td><td align="left">th:onstorage</td><td align="left">th:ontimeupdate</td></tr><tr><td align="left">th:onvolumechange</td><td align="left">th:pattern</td><td align="left">th:preload</td></tr><tr><td align="left">th:onshow</td><td align="left">th:onsubmit</td><td align="left">th:onundo</td></tr><tr><td align="left">th:onwaiting</td><td align="left">th:placeholder</td><td align="left">th:radiogroup</td></tr><tr><td align="left">th:rel</td><td align="left">th:rowspan</td><td align="left">th:scheme</td></tr><tr><td align="left">th:size</td><td align="left">th:spellcheck</td><td align="left">th:rev</td></tr><tr><td align="left">th:rules</td><td align="left">th:scope</td><td align="left">th:sizes</td></tr><tr><td align="left">th:src</td><td align="left">th:rows</td><td align="left">th:sandbox</td></tr><tr><td align="left">th:scrolling</td><td align="left">th:span</td><td align="left">th:srclang</td></tr><tr><td align="left">th:standby</td><td align="left">th:style</td><td align="left">th:target</td></tr><tr><td align="left">th:usemap</td><td align="left">th:vspace</td><td align="left">th:xmlbase</td></tr><tr><td align="left">th:start</td><td align="left">th:summary</td><td align="left">th:title</td></tr><tr><td align="left">th:value</td><td align="left">th:width</td><td align="left">th:xmllang</td></tr><tr><td align="left">th:step</td><td align="left">th:tabindex</td><td align="left">th:type</td></tr><tr><td align="left">th:valuetype</td><td align="left">th:wrap</td><td align="left">th:xmlspace</td></tr></tbody></table><h3 id="3ã€ä¸€æ¬¡è®¾ç½®å¤šä¸ªå±æ€§å€¼"><a href="#3ã€ä¸€æ¬¡è®¾ç½®å¤šä¸ªå±æ€§å€¼" class="headerlink" title="3ã€ä¸€æ¬¡è®¾ç½®å¤šä¸ªå±æ€§å€¼"></a>3ã€ä¸€æ¬¡è®¾ç½®å¤šä¸ªå±æ€§å€¼</h3><p>æœ‰ä¸¤ä¸ªç›¸å½“ç‰¹æ®Šçš„å±æ€§ç§°ä¸º <code>th:alt-title</code> å’Œ <code>th:lang-xmllang</code> ï¼Œå¯ç”¨äºè®¾ç½®ä¸¤ä¸ªå±æ€§ï¼š</p><ul><li><code>th:alt-title</code> å¯ä»¥è®¾ç½® <code>alt</code> å’Œ <code>title</code> å±æ€§ . </li><li><code>th:lang-xmllang</code> å¯ä»¥è®¾ç½®  <code>lang</code>  å’Œ  <code>xml:lang</code> å±æ€§ . </li></ul><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../images/gtvglogo.png<span class="token punctuation">"</span></span><span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>src<span class="token punctuation">=</span>@{/images/gtvglogo.png},title<span class="token punctuation">=</span>#{logo},alt<span class="token punctuation">=</span>#{logo}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>ç­‰ä»·äº</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../images/gtvglogo.png<span class="token punctuation">"</span></span><span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/images/gtvglogo.png}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#{logo}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#{logo}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>ç­‰ä»·äº</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../../images/gtvglogo.png<span class="token punctuation">"</span></span><span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/images/gtvglogo.png}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>alt-title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#{logo}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><h3 id="4ã€è¿½åŠ å±æ€§"><a href="#4ã€è¿½åŠ å±æ€§" class="headerlink" title="4ã€è¿½åŠ å±æ€§"></a>4ã€è¿½åŠ å±æ€§</h3><p><code>th:attrappend</code> ï¼šè¡¨ç¤ºåœ¨åé¢è¿½åŠ  ã€‚</p><p><code>th:attrprepend</code> ï¼šè¡¨ç¤ºåœ¨å‰é¢è¿½åŠ  ã€‚  </p><p>æ¯”è¾ƒå¸¸è§çš„æ˜¯ä¿®æ”¹ <code>CSS</code> æ ·å¼ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Do it!<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>attrappend</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>class<span class="token punctuation">=</span>${<span class="token punctuation">'</span> <span class="token punctuation">'</span> + cssStyle}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>å‡å¦‚ cssStyle çš„å€¼æ˜¯ success ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Do it!<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn success<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>æ ‡å‡†æ–¹è¨€ä¸­è¿˜æœ‰ä¸¤ä¸ªç‰¹å®šçš„é™„åŠ å±æ€§ï¼š<code>th:classappend</code> å’Œ <code>th:styleappend</code> å±æ€§ï¼Œç”¨äºå‘å…ƒç´ æ·»åŠ  <code>CSS</code> ç±»æˆ–æ ·å¼ç‰‡æ®µï¼Œè€Œä¸è¦†ç›–ç°å·²ç»æœ‰çš„ä»£ç ã€‚</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prod : ${prods}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>classappend</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prodStat.odd}? <span class="token punctuation">'</span>odd<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>æ»¡è¶³æ¡ä»¶ä¹‹åå°±ä¼šå˜æˆï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prod : ${prods}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>row odd<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></code></pre><h3 id="5ã€å›ºå®šå€¼å¸ƒå°”å±æ€§"><a href="#5ã€å›ºå®šå€¼å¸ƒå°”å±æ€§" class="headerlink" title="5ã€å›ºå®šå€¼å¸ƒå°”å±æ€§"></a>5ã€å›ºå®šå€¼å¸ƒå°”å±æ€§</h3><p>æ¯”å¦‚ <code>checked</code> å±æ€§:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>option2<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span> <span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">&lt;!-- HTML --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>option1<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checked<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">&lt;!-- XHTML --></span></code></pre><p>æ ‡å‡†æ–¹è¨€åŒ…å«å…è®¸æ‚¨é€šè¿‡è®¡ç®—æ¡ä»¶æ¥è®¾ç½®è¿™äº›å±æ€§çš„å±æ€§ï¼Œè¿™æ ·å¦‚æœè¡¨è¾¾å¼æ±‚å€¼ä¸ºtrueï¼Œåˆ™å±æ€§å°†è®¾ç½®ä¸ºå…¶å›ºå®šå€¼ï¼Œå¦‚æœæ±‚å€¼ä¸ºfalseï¼Œåˆ™ä¸ä¼šè®¾ç½®è¯¥å±æ€§ã€‚å¦‚ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>active<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>checked</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.active}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p> æ ‡å‡†æ–¹è¨€ä¸­å­˜åœ¨ä»¥ä¸‹å›ºå®šå€¼å¸ƒå°”å±æ€§ï¼š</p><table><thead><tr><th>th:async</th><th>th:autofocus</th><th>th:autoplay</th></tr></thead><tbody><tr><td>th:checked</td><td>th:default</td><td>th:formnovalidate</td></tr><tr><td>th:loop</td><td>th:nowrap</td><td>th:controls</td></tr><tr><td>th:defer</td><td>th:hidden</td><td>th:multiple</td></tr><tr><td>th:open</td><td>th:declare</td><td>th:disabled</td></tr><tr><td>th:ismap</td><td>th:novalidate</td><td>th:pubdate</td></tr><tr><td>th:readonly</td><td>th:scoped</td><td>th:required</td></tr><tr><td>th:seamless</td><td>th:reversed</td><td>th:selected</td></tr></tbody></table><h3 id="6ã€ä»»æ„å±æ€§è®¾ç½®"><a href="#6ã€ä»»æ„å±æ€§è®¾ç½®" class="headerlink" title="6ã€ä»»æ„å±æ€§è®¾ç½®"></a>6ã€ä»»æ„å±æ€§è®¾ç½®</h3><p>Thymeleafæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å±æ€§å¤„ç†å™¨ï¼Œå…è®¸æˆ‘ä»¬è®¾ç½®ä»»ä½•å±æ€§çš„å€¼ï¼Œå³ä½¿æ²¡æœ‰ç‰¹å®šçš„ <code>thï¼š*</code> å¤„ç†å™¨æ˜¯ç”¨æ ‡å‡†æ–¹è¨€å®šä¹‰çš„ã€‚å¦‚ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>whatever</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><p>è§£æåï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">whatever</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>John Apricot<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><h3 id="7ã€H5å±æ€§å…ƒç´ æ”¯æŒ"><a href="#7ã€H5å±æ€§å…ƒç´ æ”¯æŒ" class="headerlink" title="7ã€H5å±æ€§å…ƒç´ æ”¯æŒ"></a>7ã€H5å±æ€§å…ƒç´ æ”¯æŒ</h3><p><code>data-{prefix}-{name}</code> è¯­æ³•æ˜¯åœ¨HTML5ä¸­ç¼–å†™è‡ªå®šä¹‰å±æ€§çš„æ ‡å‡†æ–¹æ³•ï¼Œæ— éœ€å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ä»»ä½•åç§°ç©ºé—´çš„åç§°ï¼Œæœ‰äº›ç±»ä¼¼ <code>th:*</code> çš„ç”¨æ³•ã€‚</p><p>æ¯”å¦‚ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">data-th-each</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user : ${users}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">data-th-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.login}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">data-th-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span></code></pre><h2 id="å…­ã€è¿­ä»£"><a href="#å…­ã€è¿­ä»£" class="headerlink" title="å…­ã€è¿­ä»£"></a>å…­ã€è¿­ä»£</h2><h3 id="1ã€åŸºæœ¬è¿­ä»£"><a href="#1ã€åŸºæœ¬è¿­ä»£" class="headerlink" title="1ã€åŸºæœ¬è¿­ä»£"></a>1ã€åŸºæœ¬è¿­ä»£</h3><p>åŸºæœ¬è¯­æ³•ï¼š<code>th:each</code> </p><p>ç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Product list<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>NAME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>PRICE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>IN STOCK<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prod : ${prods}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Onions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.price}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>2.41<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.inStock}? #{true} : #{false}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../home.html<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Return to home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre><ul><li>å°† <code>${prods}</code> ç§°ä¸ºè¿­ä»£è¡¨è¾¾å¼æˆ–è¢«è¿­ä»£å˜é‡ã€‚</li><li>å°† <code>prod</code> ç§°ä¸ºè¿­ä»£å˜é‡æˆ–ç®€ç§°iterå˜é‡ã€‚</li><li>æ³¨æ„ <code>prod</code> è¿­ä»£å˜é‡çš„ä½œç”¨åŸŸæ˜¯<code>&lt;tr&gt;</code>å…ƒç´ ï¼Œè¿™æ„å‘³ç€å®ƒå¯ç”¨äºå†…éƒ¨æ ‡è®°ï¼Œå¦‚ <code>&lt;td&gt;</code> ï¼ŒåŒæ—¶ä¹Ÿå°†æ„å‘³ç€è¿­ä»£ä¼šäº§ç”Ÿå¤šä¸ª <code>&lt;tr&gt;</code> å…ƒç´ ã€‚</li><li>å¯ä»¥ç”¨äºè¿­ä»£çš„å¯¹è±¡ä¸æ­¢<code>List</code>, è¿˜æœ‰ï¼š<ul><li>ï¼ˆ A ï¼‰ä»»ä½•å®ç°äº†<code>java.util.Iterable</code> æˆ– <code>java.util.Enumeration</code> æˆ–  <code>java.util.Iterator</code>(å€¼å°†åœ¨è¿­ä»£å™¨è¿”å›æ—¶ä½¿ç”¨ï¼Œä¸éœ€è¦åœ¨å†…å­˜ä¸­ç¼“å­˜æ‰€æœ‰å€¼) æˆ– <code>java.util.Map</code>ï¼ˆ Mapä¸­è¿­ä»£å˜é‡ä¼šæ˜¯ <code>java.util.Map.Entry</code> ç±»ï¼‰ã€‚</li><li>ï¼ˆ B ï¼‰å¯ä»¥æ˜¯æ•°ç»„ã€‚</li><li>ï¼ˆ C ï¼‰ä»»ä½•å…¶ä»–å¯¹è±¡éƒ½å°†è¢«è§†ä¸ºåŒ…å«å¯¹è±¡æœ¬èº«çš„å•å€¼åˆ—è¡¨</li></ul></li></ul><h3 id="2ã€è¿­ä»£æ—¶çŠ¶æ€"><a href="#2ã€è¿­ä»£æ—¶çŠ¶æ€" class="headerlink" title="2ã€è¿­ä»£æ—¶çŠ¶æ€"></a>2ã€è¿­ä»£æ—¶çŠ¶æ€</h3><p>å½“ä½¿ç”¨ <code>th:each</code> æ—¶ï¼ŒThymeleaf æä¾›äº†ä¸€ç§ç”¨äºè·Ÿè¸ªè¿­ä»£çŠ¶æ€çš„æœºåˆ¶ï¼šçŠ¶æ€å˜é‡ã€‚</p><p>çŠ¶æ€å˜é‡åœ¨th:eachå±æ€§ä¸­å®šä¹‰ï¼Œå¹¶åŒ…å«ä»¥ä¸‹æ•°æ®ï¼š</p><ul><li><p>å½“å‰è¿­ä»£ç´¢å¼•ï¼Œä»0å¼€å§‹ã€‚<code>index</code> å±æ€§ã€‚ </p></li><li><p>å½“å‰è¿­ä»£ç´¢å¼•ï¼Œä»1å¼€å§‹ã€‚<code>count</code> å±æ€§ã€‚ </p></li><li><p>è¿­ä»£å˜é‡ä¸­å…ƒç´ çš„æ€»æ•°ã€‚<code>size</code> å±æ€§ã€‚ </p></li><li><p>æ¯æ¬¡è¿­ä»£çš„iterå˜é‡ã€‚<code>current</code> å±æ€§ã€‚ </p></li><li><p>å½“å‰è¿­ä»£æ˜¯å¶æ•°è¿˜æ˜¯å¥‡æ•°ã€‚è¿™äº›æ˜¯ even /odd å¸ƒå°”å±æ€§ã€‚ </p></li><li><p>å½“å‰è¿­ä»£æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªè¿­ä»£ã€‚first å¸ƒå°”å±æ€§ã€‚ </p></li><li><p>å½“å‰è¿­ä»£æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªè¿­ä»£ã€‚last å¸ƒå°”å±æ€§ã€‚</p></li></ul><p>ç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>NAME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>PRICE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>IN STOCK<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prod,iterStat : ${prods}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${iterStat.odd}? <span class="token punctuation">'</span>odd<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Onions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.price}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>2.41<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.inStock}? #{true} : #{false}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span></code></pre><p>â€‹    çŠ¶æ€å˜é‡ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ <code>iterStat</code>ï¼‰æ˜¯é€šè¿‡åœ¨ <code>iter</code>åé¢å†™å…¥å…¶åç§°åœ¨th:eachå±æ€§ä¸­å®šä¹‰çš„å˜é‡æœ¬èº«ï¼Œç”¨é€—å·åˆ†éš”ã€‚ä¸iterå˜é‡ä¸€æ ·ï¼Œstatuså˜é‡çš„ä½œç”¨åŸŸä¹Ÿæ˜¯ç”±åŒ…å« <code>th:each</code> å±æ€§çš„æ ‡è®°å®šä¹‰çš„ä»£ç ã€‚ å¦‚æœæˆ‘ä»¬ä¸å†™ä¹Ÿå¯ä»¥ï¼ŒThymeleaf ä¹Ÿèƒ½è¯†åˆ«ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>NAME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>PRICE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>IN STOCK<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prod : ${prods}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prodStat.odd}? <span class="token punctuation">'</span>odd<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Onions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.price}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>2.41<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.inStock}? #{true} : #{false}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span></code></pre><h3 id="3ã€å»¶è¿ŸåŠ è½½"><a href="#3ã€å»¶è¿ŸåŠ è½½" class="headerlink" title="3ã€å»¶è¿ŸåŠ è½½"></a>3ã€å»¶è¿ŸåŠ è½½</h3><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›ä¼˜åŒ–æ•°æ®é›†åˆçš„æ£€ç´¢ï¼ˆä¾‹å¦‚ä»æ•°æ®åº“ï¼‰ï¼Œä»¥ä¾¿åªæœ‰å½“é›†åˆçœŸçš„è¦è¢«ä½¿ç”¨æ—¶æ‰ä¼šè¢«æ£€ç´¢ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ç§å¯ä»¥åº”ç”¨äºä»»ä½•æ•°æ®å—çš„ä¸œè¥¿ï¼Œä½†æ˜¯å¯èƒ½æŒ‡å®šäº†å†…å­˜é›†åˆçš„å¤§å°ï¼Œæ£€ç´¢è¦è¿­ä»£çš„é›†åˆæ˜¯è¿™ç§æƒ…å†µä¸‹æœ€å¸¸è§çš„æƒ…å†µã€‚</p><p>ä¸ºäº†æ”¯æŒè¿™ä¸€ç‚¹ï¼ŒThymeleaf æä¾›äº†ä¸€ç§å»¶è¿ŸåŠ è½½ä¸Šä¸‹æ–‡å˜é‡çš„æœºåˆ¶ã€‚ä¸Šä¸‹æ–‡å˜é‡å®ç° <code>ILazyContextVariable</code> æ¥å£ï¼ˆå¾ˆå¯èƒ½æ˜¯é€šè¿‡æ‰©å±•å…¶ <code>LazyContextVariable</code> é»˜è®¤å€¼æ¥å®ç°ï¼‰å®ç°å°†åœ¨æ‰§è¡Œæ—¶è§£å†³ã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-java"><code class="language-java">context<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">LazyContextVariable</span><span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>User<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Override</span><span class="token keyword">protected</span> List<span class="token operator">&lt;</span>User<span class="token operator">></span> <span class="token function">loadValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> databaseRepository<span class="token punctuation">.</span><span class="token function">findAllUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä»£ç ä¸­ï¼Œå¯ä»¥åœ¨ä¸çŸ¥é“å…¶æ‡’æ•£æ€§çš„æƒ…å†µä¸‹ä½¿ç”¨æ­¤å˜é‡ï¼Œä¸ºäº†ä¿è¯æ˜¯å¦æ‰§è¡Œï¼Œå¯ä»¥åŠ ä¸ªæ¡ä»¶ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${condition}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>u : ${users}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${u.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>user name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code></pre><h2 id="ä¸ƒã€æ¡ä»¶è¡¨è¾¾å¼"><a href="#ä¸ƒã€æ¡ä»¶è¡¨è¾¾å¼" class="headerlink" title="ä¸ƒã€æ¡ä»¶è¡¨è¾¾å¼"></a>ä¸ƒã€æ¡ä»¶è¡¨è¾¾å¼</h2><h3 id="1ã€ç®€å•æ¡ä»¶è¡¨è¾¾å¼"><a href="#1ã€ç®€å•æ¡ä»¶è¡¨è¾¾å¼" class="headerlink" title="1ã€ç®€å•æ¡ä»¶è¡¨è¾¾å¼"></a>1ã€ç®€å•æ¡ä»¶è¡¨è¾¾å¼</h3><p><code>if</code> å’Œ  <code>unless</code> ã€‚</p><p>ç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>NAME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>PRICE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>IN STOCK<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>COMMENTS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prod : ${prods}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prodStat.odd}? <span class="token punctuation">'</span>odd<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Onions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.price}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>2.41<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${prod.inStock}? #{true} : #{false}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${#lists.size(prod.comments)}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span> comment/s            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>comments.html<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/product/comments(prodId<span class="token punctuation">=</span>${prod.id})}<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${not #lists.isEmpty(prod.comments)}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span></code></pre><p>å¯ä»¥çœ‹åˆ° <code>&lt;a&gt;</code>æ ‡ç­¾è¢«è§£æçš„æ¡ä»¶æ˜¯<code>prod.comments</code> ä¸èƒ½ä¸ºç©ºã€‚</p><p>æ³¨æ„ï¼Œ<code>th:if</code> å±æ€§ä¸ä»…è®¡ç®—å¸ƒå°”æ¡ä»¶ã€‚å®ƒçš„èƒ½åŠ›è¿œä¸æ­¢äºæ­¤ï¼Œè€Œä¸”å°†æ ¹æ®ä»¥ä¸‹è§„åˆ™å°†æŒ‡å®šçš„è¡¨è¾¾å¼æ±‚å€¼ä¸º <code>true</code>ï¼š</p><p>ï¼ˆ1ï¼‰if è¡¨è¾¾å¼å€¼ä¸ä¸º null çš„æƒ…å†µè¿ç®—ç»“æœæ˜¯<code>true</code>: </p><ul><li>If è¡¨è¾¾å¼å€¼æ˜¯ä¸ªå¸ƒå°”å€¼å¹¶ä¸”æ˜¯true. </li><li>If è¡¨è¾¾å¼å€¼æ˜¯ä¸ªä¸ä¸º 0 çš„æ•°å­—ã€‚</li><li>If è¡¨è¾¾å¼å€¼æ˜¯ä¸ªä¸ä¸º <code>&#39;0&#39;</code> çš„å­—ç¬¦ã€‚</li><li>If è¡¨è¾¾å¼å€¼æ˜¯ä¸ªå­—ç¬¦ï¼Œä½†ä¸æ˜¯ â€œfalseâ€, â€œoffâ€ or â€œnoâ€ </li><li>If è¡¨è¾¾å¼å€¼ä¸æ˜¯å¸ƒå°”å€¼ã€ä¸æ˜¯æ•°å­—ã€ä¸æ˜¯å­—ç¬¦ã€ä¹Ÿä¸æ˜¯å­—ç¬¦ä¸²ã€‚</li></ul><p>ï¼ˆ2ï¼‰if è¡¨è¾¾å¼å€¼ä¸º null ï¼Œé‚£ä¹ˆè¿ç®—ç»“æœæ˜¯ <code>false</code>  ã€‚    </p><p><code>th:if</code> çš„é€†å±æ€§ <code>th:unless</code> ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</p><pre class=" language-html"><code class="language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>comments.html<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{/product/comments(prodId<span class="token punctuation">=</span>${prod.id})}<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">th:</span>unless</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${#lists.isEmpty(prod.comments)}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>view<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code></pre><h3 id="2ã€åˆ‡æ¢é€‰æ‹©è¯­å¥"><a href="#2ã€åˆ‡æ¢é€‰æ‹©è¯­å¥" class="headerlink" title="2ã€åˆ‡æ¢é€‰æ‹©è¯­å¥"></a>2ã€åˆ‡æ¢é€‰æ‹©è¯­å¥</h3><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨Javaä¸­çš„<code>switch</code> ç»“æ„æœ‰æ¡ä»¶åœ°æ˜¾ç¤ºå†…å®¹ï¼š<code>th:switch</code> / <code>th:case</code> å±æ€§é›†ã€‚</p><p>ç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>switch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.role}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>case</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>admin<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>User is an administrator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>case</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#{roles.manager}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>User is a manager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>è¯·æ³¨æ„ï¼Œåªè¦ä¸€ä¸ª <code>th:case</code> å±æ€§è¢«è¿ç®—ä¸º <code>true</code> ï¼Œåˆ™åœ¨åŒä¸€ä¸ª<code>switch</code> ä¸­å…¶ä»–æ¯ä¸€ä¸ª <code>th:case</code>å±æ€§è¿ç®—ç»“æœä¸º <code>false</code> ã€‚</p><p>ä¸‡ä¸€æ‰€æœ‰çš„ <code>case</code> éƒ½ä¸ä¸­æ€ä¹ˆåŠï¼Ÿå¯ä»¥è®¾ç½®é»˜è®¤é€‰é¡¹å‘€~ é»˜è®¤é€‰é¡¹æŒ‡å®šä¸º<code>th:case=&quot;*&quot;</code>ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>switch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.role}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>case</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>admin<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>User is an administrator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>case</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#{roles.manager}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>User is a manager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>case</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>User is some other thing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><h2 id="å…«ã€å†…è”"><a href="#å…«ã€å†…è”" class="headerlink" title="å…«ã€å†…è”"></a>å…«ã€å†…è”</h2><h3 id="1ã€è¡¨è¾¾å¼å†…è”"><a href="#1ã€è¡¨è¾¾å¼å†…è”" class="headerlink" title="1ã€è¡¨è¾¾å¼å†…è”"></a>1ã€è¡¨è¾¾å¼å†…è”</h3><p>è¡¨è¾¾å¼å†…è”ã€ä¹Ÿå«å†…è”å†™æ³•ã€è¡Œé—´å†™æ³•ã€‚åæ­£éƒ½æ˜¯ç¿»è¯‘çš„æ€ä¹ˆå«éƒ½è¡Œï¼Œå…¶å®å°±æ˜¯ç›´æ¥åœ¨HTMLæ–‡æœ¬ä¸­å†™å…¥è¡¨è¾¾å¼ï¼Œä¸é…åˆæ ‡ç­¾æ¥ä½¿ç”¨ã€‚</p><p>ç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello, [[${session.user.name}]]!&lt;/p</code></pre><p>ç­‰ä»·äºï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${session.user.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sebastian<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre><p><code>[[...]]</code> å’Œ <code>[(...)]</code> çš„åŒºåˆ«ç±»ä¼¼ <code>th:text</code> å’Œ <code>th:utext</code>    </p><p><code>[[...]]</code> å¯¹åº”ç€ <code>th:text</code> ï¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œå†…å®¹æ˜¯ä»€ä¹ˆåŸæ ·è¾“å‡ºä»€ä¹ˆï¼Œæµè§ˆå™¨ä¸è¿›è¡Œè§£æã€‚</p><p><code>[(...)]</code>å¯¹åº”ç€ <code>th:utext</code> ï¼šä¸è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œæœ‰æ ‡ç­¾æ—¶ï¼Œæµè§ˆå™¨ä¼šè¯†åˆ«è§£æ html æ ‡ç­¾ã€‚</p><p>æ³¨æ„ï¼šè¿™ä¸ªå†…è”å†™æ³•å¯ä»¥ä½¿ç”¨ <code>th:inline=&quot;none&quot;</code> ç¦ç”¨ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>none<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>A double array looks like this: [[1, 2, 3], [4, 5]]!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre><p>è§£æç»“æœï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>A double array looks like this: [[1, 2, 3], [4, 5]]!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre><h3 id="2ã€æ–‡æœ¬å†…è”"><a href="#2ã€æ–‡æœ¬å†…è”" class="headerlink" title="2ã€æ–‡æœ¬å†…è”"></a>2ã€æ–‡æœ¬å†…è”</h3><p>Textual template modes æ–‡æœ¬æ¨¡æ¿æ¨¡å¼</p><p>è¿™ä¸ªç‰¹å¾åœ¨é¡µé¢å¼€å‘ä¸­æ„Ÿè§‰ä½¿ç”¨å¹¶ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œå¦‚æœä»¥åé‡åˆ°å†æŸ¥API è¿›è¡Œè¡¥å……å­¦ä¹ ã€‚</p><h3 id="3ã€JSè„šæœ¬å†…è”"><a href="#3ã€JSè„šæœ¬å†…è”" class="headerlink" title="3ã€JSè„šæœ¬å†…è”"></a>3ã€JSè„šæœ¬å†…è”</h3><p>å°±æ˜¯å…è®¸åœ¨<code>&lt;javascript&gt;</code> è„šæœ¬ä¸­ä½¿ç”¨ Thymeleaf ã€‚</p><p>1) åŸºæœ¬ä½¿ç”¨</p><p>ä½¿ç”¨ <code>th:inline=&quot;javascript&quot;</code> æ¥æ¿€æ´»ä½¿ç”¨ï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script th<span class="token punctuation">:</span>inline<span class="token operator">=</span><span class="token string">"javascript"</span><span class="token operator">></span><span class="token operator">...</span><span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>$<span class="token punctuation">{</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>æœ€ç»ˆç»“æœï¼š</p><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script th<span class="token punctuation">:</span>inline<span class="token operator">=</span><span class="token string">"javascript"</span><span class="token operator">></span><span class="token operator">...</span><span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token string">"Sebastian \"Fruity\" Applejuice"</span><span class="token punctuation">;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>éœ€è¦æ³¨æ„ï¼š</p><p>ï¼ˆ1ï¼‰JavaScript å†…è”ä¸ä»…è¾“å‡ºæ‰€éœ€çš„æ–‡æœ¬ï¼Œè¿˜å°†å…¶ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œå¹¶ä¸”JavaScript è½¬ä¹‰å…¶å†…å®¹ï¼Œä»¥ä¾¿å°†è¡¨è¾¾å¼ç»“æœä½œä¸ºæ ¼å¼è‰¯å¥½çš„JavaScriptæ–‡æœ¬è¾“å‡ºã€‚</p><p>ï¼ˆ2ï¼‰å› ä¸ºæˆ‘ä»¬ <code>${session.user.name}</code> è¾“å‡ºï¼Œè¡¨è¾¾å¼ä¸ºè½¬ä¹‰ï¼Œå¦‚æœä½¿ç”¨åŒæ‹¬å·è¡¨è¾¾å¼ï¼š[[${session.user.name}]] ï¼Œè¡¨è¾¾å¼çš„ç»“æœå°±æ˜¯éè½¬ä¹‰ã€‚å°±åƒè¿™æ ·ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token operator">...</span><span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">...</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>æœ€ç»ˆç»“æœï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token operator">...</span><span class="token keyword">var</span> username <span class="token operator">=</span> Sebastian <span class="token string">"Fruity"</span> Applejuice<span class="token punctuation">;</span><span class="token operator">...</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>æ˜æ˜¾è¿™æ ·æ˜¯ä¸€ç§é”™è¯¯çš„JSæ ¼å¼ï¼Œæµè§ˆå™¨è‚¯å®šä¼šæŠ¥é”™ã€‚ä½†æ˜¯è¾“å‡ºä¸ºè½¬ä¹‰çš„å†…å®¹å¯èƒ½æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œæ¯”å¦‚é€šè¿‡é™„åŠ å†…è”è¡¨è¾¾å¼æ¥å®ç°è„šæœ¬çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸é”™çš„å·¥å…·ã€‚</p><p>JavaScriptå†…è”æœºåˆ¶çš„æ™ºèƒ½æ€§è¿œä¸æ­¢æ˜¯åº”ç”¨ç‰¹å®šäºJavaScriptçš„è½¬ä¹‰å¹¶å°†è¡¨è¾¾å¼ç»“æœä½œä¸ºæœ‰æ•ˆæ–‡æœ¬è¾“å‡ºã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨JavaScriptæ³¨é‡Šä¸­åŒ…è£…ï¼ˆè½¬ä¹‰ï¼‰å†…è”è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token operator">...</span><span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token comment" spellcheck="true">/*[[${session.user.name}]]*/</span> <span class="token string">"Gertrud Kiwifruit"</span><span class="token punctuation">;</span><span class="token operator">...</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>è€ŒThymeleafå°†å¿½ç•¥æˆ‘ä»¬åœ¨æ³¨é‡Šä¹‹åå’Œåˆ†å·ä¹‹å‰å†™çš„æ‰€æœ‰å†…å®¹ï¼ˆåœ¨æœ¬ä¾‹ä¸­ <code>&#39;Gertrud Kiwifruit&#39;</code>ï¼‰ï¼Œå› æ­¤æ‰§è¡Œæ­¤æ“ä½œçš„ç»“æœå°†ä¸ä¸ä½¿ç”¨åŒ…è£…æ—¶å®Œå…¨ç›¸åŒï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token operator">...</span><span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token string">"Sebastian \"Fruity\" Applejuice"</span><span class="token punctuation">;</span><span class="token operator">...</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>æ³¨æ„ï¼šè¿™æ˜¯å¦‚ä½•æœ‰æ•ˆçš„JavaScriptä»£ç ã€‚å½“ä½ åœ¨é™æ€æ¨¡å¼ä¸‹æ‰“å¼€ä½ çš„æ¨¡æ¿æ–‡ä»¶æ—¶ï¼Œå®ƒå°†å®Œç¾åœ°æ‰§è¡Œæ–¹å¼ï¼ˆä¸åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ç§æ–¹æ³•æ¥åˆ¶ä½œJavaScriptè‡ªç„¶æ¨¡æ¿ï¼</p><p>2ï¼‰ é«˜çº§å†…è”æ±‚å€¼å’ŒJavaScriptåºåˆ—åŒ–:</p><p>å…³äºJavaScriptå†…è”ï¼Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œè¿™ä¸ªè¡¨è¾¾å¼è®¡ç®—æ˜¯æ™ºèƒ½çš„ï¼Œä¸å±€é™äºå­—ç¬¦ä¸²ã€‚Thymeleafå°†æ­£ç¡®åœ°ç”¨JavaScriptè¯­æ³•ç¼–å†™ä»¥ä¸‹ç±»å‹çš„å¯¹è±¡ï¼š</p><p><code>Strings</code>ã€<code>Numbers</code> ã€<code>Booleans</code>ã€ <code>Arrays</code>ã€ <code>Collections</code>ã€ <code>Maps</code>ã€ <code>Beans</code> (å¯¹è±¡è¦æ±‚æœ‰getterå’Œsetteræ–¹æ³•)    </p><p>ç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token operator">...</span><span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token comment" spellcheck="true">/*[[${session.user}]]*/</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token operator">...</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p><code>${session.user}</code> å°†ä¼šè¿ç®— user å¯¹è±¡ï¼Œè¿è¡Œç»“æœï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token operator">...</span><span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"age"</span><span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">"firstName"</span><span class="token punctuation">:</span><span class="token string">"John"</span><span class="token punctuation">,</span><span class="token string">"lastName"</span><span class="token punctuation">:</span><span class="token string">"Apricot"</span><span class="token punctuation">,</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"John Apricot"</span><span class="token punctuation">,</span><span class="token string">"nationality"</span><span class="token punctuation">:</span><span class="token string">"Antarctica"</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token operator">...</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>â€‹        JavaScriptåºåˆ—åŒ–çš„æ–¹æ³•æ˜¯é€šè¿‡ <code>org.thymeleaf.standard.serializer.IStandardJavaScriptSerializer</code> æ¥å£ï¼Œå¯ä»¥åœ¨æ¨¡æ¿å¼•æ“ä¸­ä½¿ç”¨çš„<code>StandardDialect</code>çš„å®ä¾‹ã€‚ è¿™ä¸ªJSåºåˆ—åŒ–æœºåˆ¶çš„é»˜è®¤å®ç°å°†åœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾<code>Jackson</code>åº“ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°†ä½¿ç”¨å®ƒã€‚å¦‚æœæ²¡æœ‰ï¼Œå®ƒå°†åº”ç”¨ä¸€ä¸ªå†…ç½®çš„åºåˆ—åŒ–æœºåˆ¶æ¥æ»¡è¶³å¤§å¤šæ•°åœºæ™¯å’Œäº§ç”Ÿç±»ä¼¼çš„ç»“æœï¼ˆä½†çµæ´»æ€§è¾ƒå·®ï¼‰ </p><h3 id="4ã€CSSæ ·å¼å†…è”"><a href="#4ã€CSSæ ·å¼å†…è”" class="headerlink" title="4ã€CSSæ ·å¼å†…è”"></a>4ã€CSSæ ·å¼å†…è”</h3><p>å°±æ˜¯å…è®¸åœ¨<code>&lt;style&gt;</code> æ ·å¼è„šæœ¬ä¸­ä½¿ç”¨ Thymeleaf ã€‚</p><p>ä½¿ç”¨ <code>th:inline=&quot;css&quot;</code> æ¥æ¿€æ´»ä½¿ç”¨ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token number">...</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²å˜é‡ï¼š</p><pre class=" language-css"><code class="language-css">classname = <span class="token string">'main elems'</span>align = 'center</code></pre><p>å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector">.[[$</span><span class="token punctuation">{</span>classname<span class="token punctuation">}</span><span class="token selector">]] </span><span class="token punctuation">{</span><span class="token selector">text-align: [[$</span><span class="token punctuation">{</span>align<span class="token punctuation">}</span>]]<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>æœ€ç»ˆè§£æç»“æœï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector"><span class="token class">.main</span>\ elems </span><span class="token punctuation">{</span>    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>æ³¨æ„ï¼š</p><p>â€‹    CSSå†…è”ä¹Ÿå…·æœ‰ä¸€äº›æ™ºèƒ½ï¼Œå°±åƒJavaScriptä¸€æ ·åƒ <code>[[${classname}]]</code> è¿™æ ·çš„è¡¨è¾¾å¼å°†ä½œä¸ºCSSæ ‡è¯†ç¬¦è½¬ä¹‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸Šé¢çš„ <code>classname=&#39;main elems&#39;</code>åœ¨ä»£ç ç‰‡æ®µä¸­å˜æˆäº†<code>main\ elems</code>ã€‚</p><p>é«˜çº§åŠŸèƒ½ï¼šCSSè‡ªç„¶æ¨¡æ¿ã€‚</p><p>â€‹    ä¸å‰é¢å¯¹JavaScriptçš„è§£é‡Šç›¸åŒï¼ŒCSSå†…è”ä¹Ÿå…è®¸ <code>&lt;style&gt;</code>æ ‡è®°å·¥ä½œé™æ€å’ŒåŠ¨æ€éƒ½å¯ä»¥ï¼Œä¾‹å¦‚é€šè¿‡åœ¨æ³¨é‡Šä¸­åŒ…è£…å†…è”è¡¨è¾¾å¼ä½œä¸ºCSSè‡ªç„¶æ¨¡æ¿ã€‚</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector"><span class="token class">.main</span>\ elems </span><span class="token punctuation">{</span><span class="token property">text-align</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">/*[[${align}]]*/</span> left<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>ç»“æœæ˜¯ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector"><span class="token class">.main</span>\ elems </span><span class="token punctuation">{</span><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h2 id="ä¹ã€æ³¨é‡Šå’Œå—"><a href="#ä¹ã€æ³¨é‡Šå’Œå—" class="headerlink" title="ä¹ã€æ³¨é‡Šå’Œå—"></a>ä¹ã€æ³¨é‡Šå’Œå—</h2><h3 id="1ã€æ ‡å‡†HTML-XMLæ³¨é‡Š"><a href="#1ã€æ ‡å‡†HTML-XMLæ³¨é‡Š" class="headerlink" title="1ã€æ ‡å‡†HTML/XMLæ³¨é‡Š"></a>1ã€æ ‡å‡†HTML/XMLæ³¨é‡Š</h3><p>åŸºæœ¬è¯­æ³•ï¼š<code>&lt;!--  ...   --&gt;</code></p><h3 id="2ã€è§£æå™¨çº§æ³¨é‡Šå—"><a href="#2ã€è§£æå™¨çº§æ³¨é‡Šå—" class="headerlink" title="2ã€è§£æå™¨çº§æ³¨é‡Šå—"></a>2ã€è§£æå™¨çº§æ³¨é‡Šå—</h3><p>è§£æå™¨çº§æ³¨é‡Šå—æ˜¯åœ¨Thymeleafè§£ææ¨¡æ¿æ—¶å°†å…¶ä»æ¨¡æ¿ä¸­ç®€å•åˆ é™¤çš„ä»£ç ã€‚</p><p>åŸºæœ¬è¯­æ³•ï¼š<code>&lt;!--/* and */--&gt;</code></p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--/* This code will be removed at Thymeleaf parsing time! */--></span></code></pre><h3 id="3ã€ThymeleafåŸå‹ä»…æ³¨é‡Šå—"><a href="#3ã€ThymeleafåŸå‹ä»…æ³¨é‡Šå—" class="headerlink" title="3ã€ThymeleafåŸå‹ä»…æ³¨é‡Šå—"></a>3ã€ThymeleafåŸå‹ä»…æ³¨é‡Šå—</h3><p>å½“æ¨¡æ¿é™æ€åœ°ï¼ˆä¾‹å¦‚ï¼Œä½œä¸ºä¸€ä¸ªåŸå‹ï¼‰æ‰“å¼€æ—¶ï¼ŒThymeleafå…è®¸å®šä¹‰æ ‡è®°ä¸ºæ³¨é‡Šçš„ç‰¹æ®Šæ³¨é‡Šå—ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œæ¨¡æ¿æ—¶ï¼ŒThymeleafè®¤ä¸ºæ˜¯æ­£å¸¸çš„æ ‡è®°ã€‚</p><p>ç¤ºä¾‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--/*/&lt;div th:text="${...}">...&lt;/div>/*/--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>goodbye!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><p>Thymeleafçš„è§£æç³»ç»Ÿå°†ç®€å•åœ°åˆ é™¤ <code>&lt;ï¼--/*  */--&gt;</code> æ ‡è®°ï¼Œä½†ä¸åŒ…æ‹¬å…¶å†…å®¹ã€‚å› æ­¤æ²¡æœ‰æ³¨é‡Šã€‚å› æ­¤ï¼Œåœ¨æ‰§è¡Œæ¨¡æ¿æ—¶ï¼ŒThymeleafå°†å®é™…çœ‹åˆ°ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${...}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>goodbye!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><p>ä¸è§£æå™¨çº§åˆ«çš„æ³¨é‡Šå—ä¸€æ ·ï¼Œè¿™ä¸ªç‰¹æ€§ä¸æ–¹è¨€æ— å…³ã€‚</p><h3 id="4ã€åˆæˆ-th-block-æ ‡è®°"><a href="#4ã€åˆæˆ-th-block-æ ‡è®°" class="headerlink" title="4ã€åˆæˆ th:block æ ‡è®°"></a>4ã€åˆæˆ th:block æ ‡è®°</h3><p>Thymeleafæ ‡å‡†æ–¹è¨€ä¸­å”¯ä¸€çš„å…ƒç´ å¤„ç†å™¨ï¼ˆä¸æ˜¯å±æ€§ï¼‰æ˜¯<code>th:block</code>ã€‚<code>th:block</code> ä»…ä»…æ˜¯ä¸€ä¸ªå±æ€§å®¹å™¨ï¼Œå…è®¸æ¨¡æ¿å¼€å‘äººå‘˜æŒ‡å®šä»–ä»¬æƒ³è¦çš„ä»»ä½•å±æ€§ã€‚</p><p>Thymeleafå°†æ‰§è¡Œè¿™äº›å±æ€§ï¼Œç„¶åç®€å•åœ°ä½¿å—ï¼ˆè€Œä¸æ˜¯å…¶å†…å®¹ï¼‰æ¶ˆå¤±ã€‚å› æ­¤ï¼Œä¾‹å¦‚ï¼Œåœ¨åˆ›å»ºæ¯ä¸ªå…ƒç´ éœ€è¦å¤šä¸ª<code>&lt;tr&gt;</code>çš„è¿­ä»£è¡¨æ—¶ï¼Œå®ƒå¯èƒ½å¾ˆæœ‰ç”¨ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">th:</span>block</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>user : ${users}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.login}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">colspan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.address}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">th:</span>block</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span></code></pre><p>å°¤å…¶æ˜¯ä¸åŸå‹ä»…æ³¨é‡Šå—ç»“åˆä½¿ç”¨æ—¶éå¸¸æœ‰ç”¨ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--/*/ &lt;th:block th:each="user : ${users}"> /*/--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.login}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.name}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">colspan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${user.address}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--/*/ &lt;/th:block> /*/--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span></code></pre><p>æ³¨æ„ï¼š</p><p>â€‹    è¿™ä¸ªè§£å†³æ–¹æ¡ˆå…è®¸æ¨¡æ¿æ˜¯æœ‰æ•ˆçš„HTMLï¼ˆä¸éœ€è¦åœ¨<code>&lt;table&gt;</code>ä¸­æ·»åŠ ç¦æ­¢çš„<code>&lt;div&gt;</code>å—ï¼‰ï¼Œä»¥åŠä½œä¸ºåŸå‹åœ¨æµè§ˆå™¨ä¸­é™æ€æ‰“å¼€æ—¶ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼ </p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Thymeleaf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot é™æ€èµ„æºé…ç½®</title>
      <link href="/posts/6de4ee20.html"/>
      <url>/posts/6de4ee20.html</url>
      
        <content type="html"><![CDATA[<h2 id="SpringBoot-é™æ€èµ„æºé…ç½®"><a href="#SpringBoot-é™æ€èµ„æºé…ç½®" class="headerlink" title="SpringBoot é™æ€èµ„æºé…ç½®"></a>SpringBoot é™æ€èµ„æºé…ç½®</h2><p>åœ¨ SpringBoot çš„ç‰¹å¾ä¸­ä¹‹ä¸€æ˜¯ SpringBoot çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚ SpringBoot å·²ç»é»˜è®¤å°†å¤§éƒ¨åˆ†åœºæ™¯é…ç½®éƒ½åšå¥½äº†ï¼Œé™æ€èµ„æºéƒ¨åˆ†åœ¨å…¶ä¸­ã€‚</p><h3 id="1ã€é™æ€èµ„æºç®¡ç†"><a href="#1ã€é™æ€èµ„æºç®¡ç†" class="headerlink" title="1ã€é™æ€èµ„æºç®¡ç†"></a>1ã€é™æ€èµ„æºç®¡ç†</h3><p>é™æ€èµ„æºçš„é…ç½®åœ¨ SringMVC çš„è‡ªåŠ¨åŒ–é…ç½®ç±»  <code>org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</code>ä¸­è¿›è¡Œç®¡ç†çš„ã€‚çœŸæ­£å®ç°çš„æ˜¯åœ¨å…¶å†…éƒ¨é™æ€ç±» <code>WebMvcAutoConfigurationAdapter</code> ä¸­è¿›è¡Œçš„ä¸€ç³»åˆ—çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> Type<span class="token punctuation">.</span>SERVLET<span class="token punctuation">)</span><span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Servlet<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> DispatcherServlet<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> WebMvcConfigurer<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>WebMvcConfigurationSupport<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span>Ordered<span class="token punctuation">.</span>HIGHEST_PRECEDENCE <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> DispatcherServletAutoConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>        TaskExecutionAutoConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> ValidationAutoConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfiguration</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">// some code </span>    <span class="token annotation punctuation">@Configuration</span>    <span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span>EnableWebMvcConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> WebMvcProperties<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> ResourceProperties<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfigurationAdapter</span>            <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">,</span> ResourceLoaderAware <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Log logger <span class="token operator">=</span> LogFactory<span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span>WebMvcConfigurer<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">final</span> ResourceProperties resourceProperties<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// some code </span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p> å…¶ä¸­ <code>ResourceProperties</code> å°±æ˜¯é™æ€é™æ€èµ„æºé…ç½®çš„ç±»ï¼Œå¯ä»¥è®¾ç½®å’Œé™æ€èµ„æºæœ‰å…³çš„å‚æ•°ï¼Œèµ„æºè·¯å¾„ã€æ˜¯å¦ç¼“å­˜ã€ç¼“å­˜å‘¨æœŸï¼ˆç§’ï¼‰ã€èµ„æºå¤„ç†é“¾ã€èµ„æºç‰ˆæœ¬æ˜¯å¦å›ºå®šä¸€ç³»åˆ—å†…å®¹ã€‚</p><p><strong>å¸¸è§çš„ä»¥ xxxxProperties çš„é…ç½®ç±»æ˜¯ç”¨æ¥å°è£…é…ç½®æ–‡ä»¶çš„å†…å®¹çš„ Bean ã€‚</strong></p><p>åœ¨ <code>WebMvcAutoConfiguration</code> çš„å†…éƒ¨é™æ€ç±» <code>WebMvcAutoConfigurationAdapter</code>ä¸­è¿›è¡Œä¸€äº›å¸¸è§çš„é™æ€èµ„æºå¤„ç†ï¼š</p><pre class=" language-java"><code class="language-java">         <span class="token comment" spellcheck="true">// é™æ€èµ„æºå¼‚æ­¥æ”¯æŒ</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureAsyncSupport</span><span class="token punctuation">(</span>AsyncSupportConfigurer configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">.</span><span class="token function">containsBean</span><span class="token punctuation">(</span>                    TaskExecutionAutoConfiguration<span class="token punctuation">.</span>APPLICATION_TASK_EXECUTOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                Object taskExecutor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>                        TaskExecutionAutoConfiguration<span class="token punctuation">.</span>APPLICATION_TASK_EXECUTOR_BEAN_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>taskExecutor <span class="token keyword">instanceof</span> <span class="token class-name">AsyncTaskExecutor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    configurer<span class="token punctuation">.</span><span class="token function">setTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>AsyncTaskExecutor<span class="token punctuation">)</span> taskExecutor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            Duration timeout <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequestTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                configurer<span class="token punctuation">.</span><span class="token function">setDefaultTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// å›½é™…åŒ–</span>        <span class="token annotation punctuation">@Bean</span>        <span class="token annotation punctuation">@ConditionalOnMissingBean</span>        <span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.mvc"</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"locale"</span><span class="token punctuation">)</span>        <span class="token keyword">public</span> LocaleResolver <span class="token function">localeResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties                    <span class="token punctuation">.</span><span class="token function">getLocaleResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> WebMvcProperties<span class="token punctuation">.</span>LocaleResolver<span class="token punctuation">.</span>FIXED<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FixedLocaleResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            AcceptHeaderLocaleResolver localeResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AcceptHeaderLocaleResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            localeResolver<span class="token punctuation">.</span><span class="token function">setDefaultLocale</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> localeResolver<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// é™æ€èµ„æºæ˜ å°„ç›¸å…³</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span>ResourceHandlerRegistry registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">isAddMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Default resource handling disabled"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            Duration cachePeriod <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            CacheControl cacheControl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">getCachecontrol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHttpCacheControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">hasMappingForPattern</span><span class="token punctuation">(</span><span class="token string">"/webjars/**"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">customizeResourceHandlerRegistration</span><span class="token punctuation">(</span>registry                        <span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/webjars/**"</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"classpath:/META-INF/resources/webjars/"</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">setCachePeriod</span><span class="token punctuation">(</span><span class="token function">getSeconds</span><span class="token punctuation">(</span>cachePeriod<span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">setCacheControl</span><span class="token punctuation">(</span>cacheControl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>                <span class="token operator">/</span><span class="token operator">/</span> é™æ€èµ„æºæ–‡ä»¶å¤¹æ˜ å°„å¤„ç†            String staticPathPattern <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getStaticPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">hasMappingForPattern</span><span class="token punctuation">(</span>staticPathPattern<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">customizeResourceHandlerRegistration</span><span class="token punctuation">(</span>                        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span>staticPathPattern<span class="token punctuation">)</span>                                <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token function">getResourceLocations</span><span class="token punctuation">(</span>                                        <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getStaticLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                                <span class="token punctuation">.</span><span class="token function">setCachePeriod</span><span class="token punctuation">(</span><span class="token function">getSeconds</span><span class="token punctuation">(</span>cachePeriod<span class="token punctuation">)</span><span class="token punctuation">)</span>                                <span class="token punctuation">.</span><span class="token function">setCacheControl</span><span class="token punctuation">(</span>cacheControl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token operator">/</span><span class="token operator">/</span> æ¬¢è¿é¡µ é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰index<span class="token punctuation">.</span>htmlé¡µé¢ï¼›è¢«<span class="token string">"/**"</span>æ˜ å°„        <span class="token annotation punctuation">@Bean</span>        <span class="token keyword">public</span> WelcomePageHandlerMapping <span class="token function">welcomePageHandlerMapping</span><span class="token punctuation">(</span>                ApplicationContext applicationContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WelcomePageHandlerMapping</span><span class="token punctuation">(</span>                    <span class="token keyword">new</span> <span class="token class-name">TemplateAvailabilityProviders</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">,</span>                    applicationContext<span class="token punctuation">,</span> <span class="token function">getWelcomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getStaticPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token operator">/</span><span class="token operator">/</span>  favicon å›¾æ ‡        <span class="token annotation punctuation">@Configuration</span>        <span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"spring.mvc.favicon.enabled"</span><span class="token punctuation">,</span> matchIfMissing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">FaviconConfiguration</span> <span class="token keyword">implements</span> <span class="token class-name">ResourceLoaderAware</span> <span class="token punctuation">{</span>            <span class="token keyword">private</span> <span class="token keyword">final</span> ResourceProperties resourceProperties<span class="token punctuation">;</span>            <span class="token keyword">private</span> ResourceLoader resourceLoader<span class="token punctuation">;</span>            <span class="token keyword">public</span> <span class="token function">FaviconConfiguration</span><span class="token punctuation">(</span>ResourceProperties resourceProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties <span class="token operator">=</span> resourceProperties<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setResourceLoader</span><span class="token punctuation">(</span>ResourceLoader resourceLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader <span class="token operator">=</span> resourceLoader<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token annotation punctuation">@Bean</span>            <span class="token keyword">public</span> SimpleUrlHandlerMapping <span class="token function">faviconHandlerMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                SimpleUrlHandlerMapping mapping <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleUrlHandlerMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                mapping<span class="token punctuation">.</span><span class="token function">setOrder</span><span class="token punctuation">(</span>Ordered<span class="token punctuation">.</span>HIGHEST_PRECEDENCE <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token operator">/</span><span class="token operator">/</span> æ‰€æœ‰çš„ <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">/</span>favicon<span class="token punctuation">.</span>ico  éƒ½æ˜¯åœ¨é™æ€èµ„æºæ–‡ä»¶ä¸‹æ‰¾                mapping<span class="token punctuation">.</span><span class="token function">setUrlMap</span><span class="token punctuation">(</span>Collections<span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">"**/favicon.ico"</span><span class="token punctuation">,</span>                        <span class="token function">faviconRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> mapping<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token annotation punctuation">@Bean</span>            <span class="token keyword">public</span> ResourceHttpRequestHandler <span class="token function">faviconRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                ResourceHttpRequestHandler requestHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceHttpRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                requestHandler<span class="token punctuation">.</span><span class="token function">setLocations</span><span class="token punctuation">(</span><span class="token function">resolveFaviconLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> requestHandler<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Resource<span class="token operator">></span> <span class="token function">resolveFaviconLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                String<span class="token punctuation">[</span><span class="token punctuation">]</span> staticLocations <span class="token operator">=</span> <span class="token function">getResourceLocations</span><span class="token punctuation">(</span>                        <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getStaticLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                List<span class="token operator">&lt;</span>Resource<span class="token operator">></span> locations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>staticLocations<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                Arrays<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>staticLocations<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader<span class="token operator">:</span><span class="token operator">:</span>getResource<span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>locations<span class="token operator">:</span><span class="token operator">:</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span>                locations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> Collections<span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span>locations<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span></code></pre><p>è¿˜æœ‰ä¸€äº›è§†å›¾è§£æã€è·¯å¾„åŒ¹é…ç­‰ç­‰ç›¸å…³å¤„ç†ã€‚</p><h3 id="2ã€é™æ€èµ„æºé»˜è®¤é…ç½®"><a href="#2ã€é™æ€èµ„æºé»˜è®¤é…ç½®" class="headerlink" title="2ã€é™æ€èµ„æºé»˜è®¤é…ç½®"></a>2ã€é™æ€èµ„æºé»˜è®¤é…ç½®</h3><p>åœ¨ ResourceProperties  ç±»ä¸­å¯ä»¥æ‰¾ç‚¹é»˜è®¤çš„é™æ€èµ„æºè·¯å¾„</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.resources"</span><span class="token punctuation">,</span> ignoreUnknownFields <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResourceProperties</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> CLASSPATH_RESOURCE_LOCATIONS <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">"classpath:/META-INF/resources/"</span><span class="token punctuation">,</span> <span class="token string">"classpath:/resources/"</span><span class="token punctuation">,</span>            <span class="token string">"classpath:/static/"</span><span class="token punctuation">,</span> <span class="token string">"classpath:/public/"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * Locations of static resources. Defaults to classpath:[/META-INF/resources/,     * /resources/, /static/, /public/].     */</span>    <span class="token keyword">private</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> staticLocations <span class="token operator">=</span> CLASSPATH_RESOURCE_LOCATIONS<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// some code </span><span class="token punctuation">}</span></code></pre><p>é»˜è®¤è·¯å¾„æœ‰ï¼š</p><pre class=" language-txt"><code class="language-txt">"classpath:/META-INF/resources/""classpath:/resources/""classpath:/static/""classpath:/public/"</code></pre><p>é™æ€èµ„æºé»˜è®¤å¯ä»¥æ”¾è¿™4ä¸ªåœ°æ–¹ã€‚</p><h3 id="3ã€é™æ€èµ„æºè‡ªå®šä¹‰é…ç½®"><a href="#3ã€é™æ€èµ„æºè‡ªå®šä¹‰é…ç½®" class="headerlink" title="3ã€é™æ€èµ„æºè‡ªå®šä¹‰é…ç½®"></a>3ã€é™æ€èµ„æºè‡ªå®šä¹‰é…ç½®</h3><p>åœ¨ YAML è¯­æ³•å­¦ä¹  ç¯‡ç« ä¸­å­¦ä¹ äº† é…ç½®æ–‡ä»¶ä¸JavaBean çš„ç»‘å®šï¼Œå…¶å® <strong><code>@ConfigurationProperties</code></strong> å°±æ˜¯å…¶ä¸­æ–¹å¼ä¹‹ä¸€ï¼Œå¹¶ä¸”è¿™ä¸ªç±»æ²¡æœ‰ä½¿ç”¨<strong><code>@PropertySource</code></strong> æ³¨è§£ç”¨æ¥æŒ‡å®šæ–‡ä»¶ï¼Œè¯´æ˜å¦‚æœè¦è‡ªå®šä¹‰é…ç½®ä»¥ <code>spring.resources</code> å‰ç¼€çš„é™æ€èµ„æºç›¸å…³é…ç½®å¿…é¡»æ”¾åœ¨å…¨å±€é…ç½®<code>application.properties</code> æˆ– <code>application.yml</code> é‡Œé¢ã€‚å¦‚æœå†™åœ¨å¦å¤–çš„é…ç½®æ–‡ä»¶å°†æ— æ³•è¯†åˆ«ã€‚å½“ç„¶ä¹Ÿæ”¯æŒJavaæ–¹å¼è®¾ç½®è‡ªå®šä¹‰é…ç½®ã€‚</p><p>æ¯”å¦‚åœ¨ <code>application.properties</code>ä¸­ï¼š</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.resources.static-locations</span><span class="token punctuation">=</span><span class="token attr-value">/**</span></code></pre><p>å…¶ä¸­ <code>static-locations</code> å°±æ˜¯ <code>ResourceProperties</code> ä¸­çš„ <code>staticLocations</code> å±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥é…ç½®å¤šä¸ªé™æ€èµ„æºè·¯å¾„ï¼Œä»¥é€—å· <code>,</code> åˆ†éš”ã€‚</p><p><code>static-locations</code> ä¹Ÿå¯ä»¥å†™æˆ <code>static_locations</code> ã€‚</p><p>å¦‚æœ SpringBoot ç‰ˆæœ¬è¾ƒé«˜ï¼Œé™æ€èµ„æºå¯èƒ½ç•¥æœ‰å˜åŒ–ï¼š</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">spring.mvc.static-path-pattern</span><span class="token punctuation">=</span><span class="token attr-value">/resources/**</span></code></pre><p>å¯ä»¥åˆ° <code>ResourceProperties</code> ç±»ä¸­æŸ¥çœ‹ä¸€ä¸‹å‰ç¼€å’Œå˜é‡å³å¯ã€‚</p><h3 id="4ã€é™æ€èµ„æºå¼•å…¥"><a href="#4ã€é™æ€èµ„æºå¼•å…¥" class="headerlink" title="4ã€é™æ€èµ„æºå¼•å…¥"></a>4ã€é™æ€èµ„æºå¼•å…¥</h3><p>å¯¹äºé™æ€èµ„æºå¼•å…¥å¯ä»¥ä¸¤ç§ï¼š</p><ul><li>ï¼ˆ1ï¼‰ç›´æ¥å¼•å…¥å¤–éƒ¨åº“ <code>webjars</code> æ–¹å¼ã€‚</li><li>ï¼ˆ2ï¼‰å¼•å…¥è‡ªå®šä¹‰é™æ€èµ„æºï¼Œæ¯”å¦‚é¡¹ç›®è‡ªå®šä¹‰çš„<code>js</code> ã€<code>css</code> ã€<code>images</code>ç­‰</li></ul><p>ï¼ˆ1ï¼‰<code>webjars</code> æ–¹å¼</p><p><code>webjars</code> æ˜¯ä»¥jaråŒ…çš„æ–¹å¼å¼•å…¥é™æ€èµ„æºï¼Œå¯ä»¥åœ¨ webjars ç½‘ç«™ <a href="http://www.webjars.org/" target="_blank" rel="noopener">http://www.webjars.org/</a> æŸ¥è¯¢å¼•å…¥è‡ªå·±éœ€è¦çš„ã€‚</p><p>å¦‚å¼•å…¥ jquery :</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--å¼•å…¥jquery-webjar--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.webjars<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jquery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>åœ¨è®¿é—®çš„æ—¶å€™åªéœ€è¦å†™ webjars ä¸‹é¢èµ„æºçš„åç§°å³å¯ï¼Œå¦‚ <code>localhost:8080/webjars/jquery/3.3.1/jquery.js</code> </p><p>æ‰€æœ‰ /webjars/** ï¼Œéƒ½ä¼šåœ¨ classpath:/META-INF/resources/webjars/ æ‰¾å¯¹åº”çš„èµ„æºã€‚</p><p>ï¼ˆ2ï¼‰è‡ªå®šä¹‰æ–¹å¼</p><p><code>&quot;/**&quot;</code> è®¿é—®å½“å‰é¡¹ç›®çš„ä»»ä½•èµ„æºï¼Œéƒ½å»ï¼ˆé™æ€èµ„æºçš„æ–‡ä»¶å¤¹ï¼‰æ‰¾æ˜ å°„è‡ªå®šä¹‰æ–¹å¼å‰é¢æåˆ°äº†é»˜è®¤è·¯å¾„ï¼š</p><pre class=" language-txt"><code class="language-txt">"classpath:/META-INF/resources/", "classpath:/resources/","classpath:/static/", "classpath:/public/" "/"ï¼šå½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„</code></pre><h3 id="5ã€å…¶ä»–"><a href="#5ã€å…¶ä»–" class="headerlink" title="5ã€å…¶ä»–"></a>5ã€å…¶ä»–</h3><p>å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜åç»­è¡¥å……</p><p>â€‹    </p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> static </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot æ—¥å¿—å­¦ä¹ </title>
      <link href="/posts/c74d2d29.html"/>
      <url>/posts/c74d2d29.html</url>
      
        <content type="html"><![CDATA[<h2 id="SpringBoot-æ—¥å¿—å­¦ä¹ "><a href="#SpringBoot-æ—¥å¿—å­¦ä¹ " class="headerlink" title="SpringBoot æ—¥å¿—å­¦ä¹ "></a>SpringBoot æ—¥å¿—å­¦ä¹ </h2><h3 id="ä¸€ã€-æ—¥å¿—æ¡†æ¶äº†è§£"><a href="#ä¸€ã€-æ—¥å¿—æ¡†æ¶äº†è§£" class="headerlink" title="ä¸€ã€ æ—¥å¿—æ¡†æ¶äº†è§£"></a>ä¸€ã€ æ—¥å¿—æ¡†æ¶äº†è§£</h3><p>Log4jã€Log4j2<br>Logback<br>Slf4j<br>JCL (Jakarta Commons Logging)ï¼Œä¹Ÿå« Apache Common logging<br>JUL (java.util.logging)</p><p>å…¶ä¸­ï¼ŒJCLï¼ˆCommons Loggingï¼‰ å’Œ Slf4j æ˜¯å±äºæ—¥å¿—é—¨é¢ã€‚æ—¥å¿—é—¨é¢æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿå«æ­£é¢æ¨¡å¼æˆ–å¤–è§‚æ¨¡å¼ã€‚é—¨é¢å¯¹å¤–æä¾›ç»Ÿä¸€çš„æŠ½è±¡å±‚æ¥å£ï¼ŒçœŸæ­£çš„æ—¥å¿—å®ç°å­ç³»ç»Ÿåªè¦å®ç°æŠ½è±¡æ¥å£å³å¯ã€‚è°ƒç”¨è€…å¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„è°ƒç”¨APIï¼Œä¸éœ€è¦çš„å…³å¿ƒå­ç³»ç»Ÿæ˜¯å¦‚ä½•å®ç°ï¼Œå®ç°è§£è€¦ã€‚å¦‚æœçœŸæ­£çš„å®ç°å­ç³»ç»Ÿå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œæ›´æ¢æˆ–å‡çº§ï¼Œè€Œä¸ä¿®æ”¹åŸæœ‰è°ƒç”¨ä»£ç ã€‚</p><p>æ•´ç†è¡¨æ ¼1ï¼š</p><table><thead><tr><th>æ—¥å¿—é—¨é¢ï¼ˆæŠ½è±¡å±‚ï¼Œæœ¬èº«æ— æ—¥å¿—å®ç°ï¼‰</th><th>æ—¥å¿—å®ç°</th></tr></thead><tbody><tr><td>Jakarta Commons Loggingï¼Œ Slf4j</td><td>log4jï¼Œlogbackï¼Œlog4j2ï¼ŒJulï¼ˆJava Util Loggingï¼‰</td></tr></tbody></table><p>åœ¨å®é™…ä½¿ç”¨æ—¶ï¼šé—¨é¢ + å®ç° ã€‚</p><p>æ•´ç†è¡¨æ ¼2ï¼š</p><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Jakarta Commons Logging / Commons Logging</td><td>Apacheé¡¹ç›®ï¼Œæä¾›ä¸€å¥—æ—¥å¿—æ¥å£ï¼Œå±äºæ—¥å¿—é—¨é¢ã€‚</td></tr><tr><td>Slf4j</td><td>ç±»ä¼¼Commons Logging ä¹Ÿæ˜¯æ—¥å¿—æ¥å£ï¼Œå±äºæ—¥å¿—é—¨é¢ã€‚è¾ƒä¼˜äºå‰è€…ã€‚</td></tr><tr><td>Logback</td><td>æ—¥å¿—è®°å½•ç»„ä»¶çš„å®ç°ã€‚ä¸Slf4jæ˜¯åŒä¸€ä½œè€…ï¼Œé«˜å…¼å®¹ï¼Œå¿…é¡»é…åˆSlf4jä½¿ç”¨ã€‚</td></tr><tr><td>Log4j</td><td>æ—¥å¿—è®°å½•ç»„ä»¶å·¥å…·å®ç°ï¼Œæ—¥å¿—å®ç°æ¡†æ¶ä¹‹ä¸€ã€‚</td></tr><tr><td>Log4j2</td><td>Log4jçš„å‡çº§ç‰ˆï¼Œä¸”ä¸å…¼å®¹å‰è€…ã€‚</td></tr><tr><td>Julï¼ˆJava Util Loggingï¼‰</td><td>java1.4 ä¹‹åçš„å®˜æ–¹æ—¥å¿—å®ç°ã€‚</td></tr><tr><td>jboss-logging</td><td>æ—¥å¿—çš„æŠ½è±¡å±‚ã€‚</td></tr></tbody></table><h3 id="äºŒã€å¸¸è§-Commons-Logging-é›†æˆ"><a href="#äºŒã€å¸¸è§-Commons-Logging-é›†æˆ" class="headerlink" title="äºŒã€å¸¸è§ Commons Logging é›†æˆ"></a>äºŒã€å¸¸è§ Commons Logging é›†æˆ</h3><p>ç°åœ¨slf4jçš„ä¼˜åŠ¿å‡ºæ¥ä¹‹åï¼Œç›¸å¯¹çš„å°±ä¼šé€æ¸ä»£æ›¿æ—§çš„ <code>Commons Logging</code> çš„é›†æˆæ–¹å¼ï¼Œä½†æ˜¯å­¦ä¹ äº†è§£ä¸å¯å°‘ï¼Œä¸‡ä¸€ä½ é‡åˆ°äº†é¡¹ç›®é‡Œå°±æ˜¯ç”¨äº†å‘¢ï¼Œä½ èƒ½å¦çœ‹å¾—æ‡‚é¡¹ç›®é‡Œçš„é…ç½®æ—¥å¿—é›†æˆå—ï¼Ÿ</p><table><thead><tr><th>é›†æˆç»„åˆ</th><th>æ‰€éœ€JaråŒ…</th></tr></thead><tbody><tr><td>commons-logging ä¸ jdk-logging</td><td>commons-logging.jar</td></tr><tr><td>commons-logging ä¸ Log4j</td><td>commons-logging.jar <br/>log4j åŸºæœ¬åŒ…</td></tr><tr><td>commons-logging ä¸ Log4j2</td><td>commons-logging.jar <br/>log4j-api<br/>log4j-core<br/>log4j-jcl (é›†æˆè½¬æ¢é€‚é…)</td></tr><tr><td>commons-logging ä¸ logback</td><td>logback-core <br/>logback-classic <br/>slf4j-api <br/></td></tr></tbody></table><p>å¯¹äº <code>commons-logging</code> ä¸ <code>logback</code> çš„ç»„åˆï¼Œæˆ‘è¡¨ç¤ºå­˜ç–‘ï¼Œlogback å±äºslf4jé˜µè¥ï¼Œè¿™ä¸ªç»„åˆå¾…è€ƒâ€¦</p><h3 id="ä¸‰ã€Slf4j-ä½¿ç”¨ä¸é›†æˆ"><a href="#ä¸‰ã€Slf4j-ä½¿ç”¨ä¸é›†æˆ" class="headerlink" title="ä¸‰ã€Slf4j ä½¿ç”¨ä¸é›†æˆ"></a>ä¸‰ã€Slf4j ä½¿ç”¨ä¸é›†æˆ</h3><h4 id="1ã€åŸºæœ¬ä½¿ç”¨"><a href="#1ã€åŸºæœ¬ä½¿ç”¨" class="headerlink" title="1ã€åŸºæœ¬ä½¿ç”¨"></a>1ã€åŸºæœ¬ä½¿ç”¨</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Logger logger <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="2ã€Slf4j-é›†æˆå…³ç³»å›¾"><a href="#2ã€Slf4j-é›†æˆå…³ç³»å›¾" class="headerlink" title="2ã€Slf4j é›†æˆå…³ç³»å›¾"></a>2ã€Slf4j é›†æˆå…³ç³»å›¾</h4><p>Slf4j å®˜ç½‘</p><p><img src="/medias/loading-animated.gif" data-original="/images/springboot-images/concrete-bindings.png" alt="Slf4gé›†æˆå…³ç³»å›¾"></p><p>å°†å†™æˆè¡¨æ ¼ï¼š</p><table><thead><tr><th>Slf4j é›†æˆ</th><th>é›†æˆæ‰€éœ€jar</th></tr></thead><tbody><tr><td>Slf4j ä¸ logback</td><td>slf4j-api.jar<br/>logback-core.jar <br/>logback-classic.jar</td></tr><tr><td>Slf4j ä¸ log4j</td><td>slf4j-api.jar<br/>log4j.jar<br/>slf4j-log4j12.jar ï¼ˆslf4j å’Œ log4j çš„æ¡¥æ¥ï¼‰</td></tr><tr><td>Slf4j ä¸ jdk logging</td><td>slf4j-api.jar<br/>slf4j-jdkxxx.jarï¼ˆslf4j å’Œ jdk logging çš„æ¡¥æ¥ï¼‰</td></tr><tr><td>Slf4j ä¸ Simple</td><td>slf4j-api.jar<br/>slf4j-simple.jar</td></tr><tr><td>Slf4j ä¸ Nop</td><td>slf4j-api.jar<br/>slf4j-nop.jar ï¼ˆslf4j å’Œ NOP çš„æ¡¥æ¥ï¼‰</td></tr></tbody></table><p>ä½¿ç”¨ Slf4j ä¹‹åï¼Œæ¯ä¸ªæ—¥å¿—å®ç°æ¡†æ¶ï¼Œéœ€è¦è‡ªå·±æœ¬èº«çš„é…ç½®æ–‡ä»¶ã€‚</p><h4 id="3ã€Slf4j-æ¡¥æ¥é—ç•™API"><a href="#3ã€Slf4j-æ¡¥æ¥é—ç•™API" class="headerlink" title="3ã€Slf4j æ¡¥æ¥é—ç•™API"></a>3ã€Slf4j æ¡¥æ¥é—ç•™API</h4><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¼•å…¥ä¸åŒçš„ç»„ä»¶ï¼Œç»„ä»¶è‡ªèº«ä¼šæºå¸¦æ—¥å¿—ç»„ä»¶ï¼Œå¦‚æœéœ€è¦ç»Ÿä¸€ä½¿ç”¨æŸä¸ªæ—¥å¿—é—¨é¢å¦‚ Slf4j ï¼Œå°±éœ€è¦æŠŠå…¶ä»–çš„æ—¥å¿—ç»„ä»¶é‡å®šå‘åˆ°æˆ‘ä»¬æƒ³ä½¿ç”¨çš„æ—¥å¿—é—¨é¢Slf4jç®¡ç†ã€‚ç„¶å Slf4j ä¼šæ ¹æ®ç»‘å®šå™¨ï¼Œä½¿ç”¨å…·ä½“çš„æ—¥å¿—å®ç°æ¡†æ¶ã€‚</p><p>å®˜æ–¹æ¡¥æ¥ç­–ç•¥å›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/springboot-images/legacy.png" alt=" Slf4j æ¡¥æ¥é—ç•™é€‚é…å›¾"></p><p>Slf4j è‡ªå¸¦äº†å‡ ä¸ªæ¡¥æ¥æ¨¡æ¿ï¼Œå¯ä»¥ä½¿Log4jï¼ŒJCLå’ŒJava.util.loggingçš„APIé‡å®šå‘ Slf4jã€‚</p><table><thead><tr><th>æ¡¥æ¥é€‚é…åŒ…</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>log4j-over-slf4j-xxx.jar</td><td>å°† Log4j cé‡å®šå‘åˆ° Slf4j</td></tr><tr><td>jcl-over-slf4j-xxx.jar</td><td>å°† Commons Logging é‡Œ Simple Logger é‡å®šå‘åˆ° Slf4j</td></tr><tr><td>jul-to-slf4j-xxx.jar</td><td>å°† Java Uitl Logging é‡å®šå‘åˆ° Slf4j</td></tr></tbody></table><p><strong>ä½¿ç”¨ Slf4j æ¡¥æ¥æ—¶æ³¨æ„é¿å…å†²çªå’Œæ­»å¾ªç¯é—®é¢˜ï¼š</strong></p><p>ï¼ˆ1ï¼‰log4j-over-slf4j-xxx.jar å’Œ slf4j-log4j.jar åŒæ—¶å­˜åœ¨ï¼Œslf4j-log4j12.jar çš„å­˜åœ¨ä¼šå°†æ‰€æœ‰æ—¥å¿—è°ƒç”¨å§”æ‰˜ç»™log4jã€‚ä½†ç”±äºåŒæ—¶ç”±äºlog4j-over-slf4j.jarçš„å­˜åœ¨ï¼Œä¼šå°†æ‰€æœ‰å¯¹log4j apiçš„è°ƒç”¨å§”æ‰˜ç»™ç›¸åº”ç­‰å€¼çš„slf4j,æ‰€ä»¥log4j-over-slf4j.jarå’Œslf4j-log4j12.jaråŒæ—¶å­˜åœ¨ä¼šå½¢æˆæ­»å¾ªç¯ã€‚</p><p>ï¼ˆ2ï¼‰jul-to-slf4j-xxx.jar å’Œ slf4j-jdkxxx.jar åŒæ—¶å­˜åœ¨ï¼Œslf4j-jdk14.jarçš„å­˜åœ¨ä¼šå°†æ‰€æœ‰æ—¥å¿—è°ƒç”¨å§”æ‰˜ç»™jdkçš„logã€‚ä½†ç”±äºåŒæ—¶jul-to-slf4j.jarçš„å­˜åœ¨ï¼Œä¼šå°†æ‰€æœ‰å¯¹jul apiçš„è°ƒç”¨å§”æ‰˜ç»™ç›¸åº”ç­‰å€¼çš„slf4jï¼Œæ‰€ä»¥jul-to-slf4j.jarå’Œslf4j-jdk14.jaråŒæ—¶å­˜åœ¨ä¼šå½¢æˆæ­»å¾ªç¯ã€‚</p><p><strong>å¦‚ä½•è®©ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ—¥å¿—éƒ½ç»Ÿä¸€åˆ° Slf4j ï¼Ÿ</strong></p><ul><li>1ã€å°†ç³»ç»Ÿä¸­å…¶ä»–æ—¥å¿—æ¡†æ¶å…ˆæ’é™¤å‡ºå»ï¼›</li><li>2ã€ç”¨ä¸­é—´åŒ…æ¥æ›¿æ¢åŸæœ‰çš„æ—¥å¿—æ¡†æ¶ï¼›</li><li>3ã€å¯¼å…¥slf4jå…¶ä»–çš„å®ç°</li></ul><p>æ›´å¤šå†…å®¹å‚è€ƒ <a href="https://www.slf4j.org" target="_blank" rel="noopener">Slf4j å®˜ç½‘</a></p><h3 id="å››ã€SpringBoot-æ—¥å¿—ä½¿ç”¨"><a href="#å››ã€SpringBoot-æ—¥å¿—ä½¿ç”¨" class="headerlink" title="å››ã€SpringBoot æ—¥å¿—ä½¿ç”¨"></a>å››ã€SpringBoot æ—¥å¿—ä½¿ç”¨</h3><h4 id="1ã€SpringBoot-æ—¥å¿—"><a href="#1ã€SpringBoot-æ—¥å¿—" class="headerlink" title="1ã€SpringBoot æ—¥å¿—"></a>1ã€SpringBoot æ—¥å¿—</h4><p>ï¼ˆ1ï¼‰åŸºæœ¬ä¾èµ–</p><p>SpringBootçš„å¯åŠ¨å™¨</p><pre class=" language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>SpringBootç§»åŠ¨å™¨çš„ä¾èµ–ä¸­ä½¿ç”¨ æ—¥å¿—åŠŸèƒ½ï¼›</p><pre class=" language-xml"><code class="language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>SpringBoot åº•å±‚ä¾èµ–å…³ç³»ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/springboot-images/springboot-log.png" alt="Slf4gé›†æˆå…³ç³»å›¾"></p><p>SpringBootåº•å±‚ä¹Ÿæ˜¯ä½¿ç”¨ <code>slf4j</code> + <code>logback</code> çš„æ–¹å¼è¿›è¡Œæ—¥å¿—è®°å½•ã€‚</p><p>SpringBootä¹ŸæŠŠå…¶ä»–çš„æ—¥å¿—éƒ½æ›¿æ¢æˆäº†slf4jï¼Œä½¿ç”¨äº†æ¡¥æ¥ä¸­é—´åŒ…æ›¿æ¢äº†åŸæ¥æ¡†æ¶çš„æ—¥å¿—ã€‚</p><p>å¦‚æœè¦å¼•å…¥å…¶ä»–æ¡†æ¶ï¼Œä¸€å®šè¦æŠŠè¿™ä¸ªæ¡†æ¶çš„é»˜è®¤æ—¥å¿—ä¾èµ–ç§»é™¤æ‰ï¼Œæ¯”å¦‚ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>SpringBootèƒ½è‡ªåŠ¨é€‚é…æ‰€æœ‰çš„æ—¥å¿—ï¼Œè€Œä¸”åº•å±‚ä½¿ç”¨ slf4j + logback çš„æ–¹å¼è®°å½•æ—¥å¿—ï¼Œå¼•å…¥å…¶ä»–æ¡†æ¶çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªæ¡†æ¶ä¾èµ–çš„æ—¥å¿—æ¡†æ¶æ’é™¤æ‰å³å¯ã€‚</p><p>ï¼ˆ2ï¼‰logback</p><p>logback ä¸»è¦æœ‰ä¸‰ä¸ªæ¨¡å—ï¼š</p><ul><li>logback-coreï¼šåŸºç¡€æ—¥å¿—åŠŸèƒ½ã€‚</li><li>logback-classicï¼šlog4jçš„å‡çº§ï¼Œå¯¹æ—¥å¿—é—¨é¢ Slf4j API è¿›è¡Œå…·ä½“å®ç°ã€‚</li><li>logback-accessï¼šç”¨äºServlet å®¹å™¨è¿›è¡ŒåŸºç¡€ã€æä¾›ç½‘ç»œè®¿é—®æ—¥å¿—åŠŸèƒ½ã€‚</li></ul><p>logback ä¸»è¦åŒ…å«ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p><ul><li>Logger - æ—¥å¿—è®°å½•å™¨</li><li>Appenders - è¾“å‡ºæ§åˆ¶å™¨</li><li>Layouts - æ—¥å¿—è¾“å‡ºæ ¼å¼ç®¡ç†</li></ul><h4 id="2ã€SpringBoot-æ—¥å¿—é…ç½®"><a href="#2ã€SpringBoot-æ—¥å¿—é…ç½®" class="headerlink" title="2ã€SpringBoot æ—¥å¿—é…ç½®"></a>2ã€SpringBoot æ—¥å¿—é…ç½®</h4><h5 id="ï¼ˆ1ï¼‰é»˜è®¤æ—¥å¿—"><a href="#ï¼ˆ1ï¼‰é»˜è®¤æ—¥å¿—" class="headerlink" title="ï¼ˆ1ï¼‰é»˜è®¤æ—¥å¿—"></a>ï¼ˆ1ï¼‰é»˜è®¤æ—¥å¿—</h5><p>SpringBooté»˜è®¤å¸®é…ç½®å¥½äº†æ—¥å¿—ï¼Œé»˜è®¤çš„æ—¥å¿—çº§åˆ«æ˜¯ <code>info</code></p><p>æ—¥å¿—çš„çº§åˆ«ç”±ä½åˆ°é«˜ï¼š  <strong>trace &lt; debug &lt; info &lt; warn &lt; error</strong></p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//è®°å½•å™¨</span>    Logger logger <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//System.out.println();</span>        <span class="token comment" spellcheck="true">//å¯ä»¥è°ƒæ•´è¾“å‡ºçš„æ—¥å¿—çº§åˆ«ï¼›æ—¥å¿—å°±åªä¼šåœ¨è¿™ä¸ªçº§åˆ«ä»¥ä»¥åçš„é«˜çº§åˆ«ç”Ÿæ•ˆ</span>        logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯traceæ—¥å¿—..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯debugæ—¥å¿—..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//SpringBooté»˜è®¤ç»™æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯infoçº§åˆ«çš„ï¼Œæ²¡æœ‰æŒ‡å®šçº§åˆ«çš„å°±ç”¨SpringBooté»˜è®¤è§„å®šçš„çº§åˆ«ï¼›rootçº§åˆ«</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯infoæ—¥å¿—..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯warnæ—¥å¿—..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯erroræ—¥å¿—..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š</p><p><code>%d</code> è¡¨ç¤ºæ—¥æœŸæ—¶é—´ï¼Œ<br><code>%thread</code> - è¡¨ç¤ºçº¿ç¨‹åï¼Œ<br><code>%-5level</code> - çº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦<br><code>%logger{50}</code> - è¡¨ç¤ºloggeråå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²ã€‚<br><code>%msg</code> -  æ—¥å¿—æ¶ˆæ¯ï¼Œ<br><code>%n</code> - æ˜¯æ¢è¡Œç¬¦</p><p>å¦‚ï¼š</p><pre class=" language-txt"><code class="language-txt">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</code></pre><p>SpringBootä¿®æ”¹æ—¥å¿—çš„é»˜è®¤é…ç½®</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">logging.level.com.smallrose</span><span class="token punctuation">=</span><span class="token attr-value">trace</span><span class="token comment" spellcheck="true">#logging.path=</span><span class="token comment" spellcheck="true"># ä¸æŒ‡å®šè·¯å¾„åœ¨å½“å‰é¡¹ç›®ä¸‹ç”Ÿæˆspringboot.logæ—¥å¿—</span><span class="token comment" spellcheck="true"># å¯ä»¥æŒ‡å®šå®Œæ•´çš„è·¯å¾„ï¼›</span><span class="token comment" spellcheck="true">#logging.file=G:/springboot.log</span><span class="token comment" spellcheck="true"># åœ¨å½“å‰ç£ç›˜çš„æ ¹è·¯å¾„ä¸‹åˆ›å»ºspringæ–‡ä»¶å¤¹å’Œé‡Œé¢çš„logæ–‡ä»¶å¤¹ï¼›ä½¿ç”¨ spring.log ä½œä¸ºé»˜è®¤æ–‡ä»¶</span><span class="token attr-name">logging.path</span><span class="token punctuation">=</span><span class="token attr-value">/spring/log</span><span class="token comment" spellcheck="true">#  åœ¨æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çš„æ ¼å¼</span><span class="token attr-name">logging.pattern.console</span><span class="token punctuation">=</span><span class="token attr-value">%d{yyyy-MM-dd} [%thread] %-5level %logger{50} - %msg%n</span><span class="token comment" spellcheck="true"># æŒ‡å®šæ–‡ä»¶ä¸­æ—¥å¿—è¾“å‡ºçš„æ ¼å¼</span><span class="token attr-name">logging.pattern.file</span><span class="token punctuation">=</span><span class="token attr-value">%d{yyyy-MM-dd} === [%thread] === %-5level === %logger{50} ==== %msg%n</span></code></pre><p><strong>logging.file å’Œ logging.path :</strong></p><table><thead><tr><th>logging.file</th><th>logging.path</th><th>Example</th><th>Description</th></tr></thead><tbody><tr><td>(none)</td><td>(none)</td><td></td><td>åªåœ¨æ§åˆ¶å°è¾“å‡º</td></tr><tr><td>æŒ‡å®šæ–‡ä»¶å</td><td>(none)</td><td>my.log</td><td>è¾“å‡ºæ—¥å¿—åˆ°my.logæ–‡ä»¶</td></tr><tr><td>(none)</td><td>æŒ‡å®šç›®å½•</td><td>/var/log</td><td>è¾“å‡ºåˆ°æŒ‡å®šç›®å½•çš„ spring.log æ–‡ä»¶ä¸­</td></tr></tbody></table><p><code>logging.file</code> å’Œ  <code>logging.path</code> äºŒè€…é€‰å…¶ä¸€å³å¯ã€‚å¦‚æœéƒ½é…ç½®äº†ï¼Œ<code>logging.file</code> ä¼šç”Ÿæ•ˆã€‚</p><h5 id="ï¼ˆ2ï¼‰æŒ‡å®šé…ç½®"><a href="#ï¼ˆ2ï¼‰æŒ‡å®šé…ç½®" class="headerlink" title="ï¼ˆ2ï¼‰æŒ‡å®šé…ç½®"></a>ï¼ˆ2ï¼‰æŒ‡å®šé…ç½®</h5><p>ç±»è·¯å¾„ä¸‹æ”¾ä¸Šæ¯ä¸ªæ—¥å¿—æ¡†æ¶è‡ªå·±çš„é…ç½®æ–‡ä»¶å³å¯ï¼›SpringBootå°±ä¸ä½¿ç”¨ä»–é»˜è®¤é…ç½®çš„äº†</p><table><thead><tr><th>Logging System</th><th>Customization</th></tr></thead><tbody><tr><td>Logback</td><td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td></tr><tr><td>Log4j2</td><td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td></tr><tr><td>JDK (Java Util Logging)</td><td><code>logging.properties</code></td></tr></tbody></table><p>logback.xmlï¼šç›´æ¥å°±è¢«æ—¥å¿—æ¡†æ¶è¯†åˆ«äº†ï¼›</p><p><strong>logback-spring.xml</strong>ï¼šæ—¥å¿—æ¡†æ¶å°±ä¸ç›´æ¥åŠ è½½æ—¥å¿—çš„é…ç½®é¡¹ï¼Œç”±SpringBootè§£ææ—¥å¿—é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨SpringBootçš„é«˜çº§ProfileåŠŸèƒ½ï¼Œä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„æ–¹å¼ã€‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>staging<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- configuration to be enabled when the "staging" profile is active --></span>      å¯ä»¥æŒ‡å®šæŸæ®µé…ç½®åªåœ¨æŸä¸ªç¯å¢ƒä¸‹ç”Ÿæ•ˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dev, staging<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- configuration to be enabled when the "dev" or "staging" profiles are active --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!production<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- configuration to be enabled when the "production" profile is not active --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">></span></span></code></pre><p>ä½¿ç”¨ç¤ºä¾‹å¦‚ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stdout<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.PatternLayout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dev<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} ----> [%thread] ---> %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!dev<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} ==== [%thread] ==== %-5level %logger{50} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span></code></pre><p>å¦‚æœä½¿ç”¨logback.xmlä½œä¸ºæ—¥å¿—é…ç½®æ–‡ä»¶ï¼Œè¿˜è¦ä½¿ç”¨profileåŠŸèƒ½ï¼Œä¼šæŠ¥é”™ ï¼š<code>no applicable action for [springProfile]</code></p><h4 id="3ã€æ—¥å¿—æ¡†æ¶åˆ‡æ¢"><a href="#3ã€æ—¥å¿—æ¡†æ¶åˆ‡æ¢" class="headerlink" title="3ã€æ—¥å¿—æ¡†æ¶åˆ‡æ¢"></a>3ã€æ—¥å¿—æ¡†æ¶åˆ‡æ¢</h4><p>å¯ä»¥æŒ‰ç…§ Slf4j æ¡¥æ¥é—ç•™é€‚é…å›¾ ï¼Œè¿›è¡Œç›¸å…³çš„åˆ‡æ¢ï¼›</p><p>(1) <code>slf4j+log4j</code>çš„æ–¹å¼ :</p><p>ä½¿ç”¨ <code>slf4j+log4j</code> çš„æ–¹å¼éœ€è¦æ’é™¤ <code>logback</code> å’Œ è‡ªèº«æºå¸¦çš„ log4jåˆ°slf4j çš„æ¡¥æ¥åŒ… <code>log4j-over-slf4j</code>ï¼ŒåŒæ—¶è¦å¼•å…¥</p><p>è§‚å¯Ÿ slf4j é›†æˆæ•´ç†çš„è¡¨æ ¼é‡Œ Slf4j ä¸ log4j é›†æˆï¼Œéœ€è¦ slf4j-api.jar ã€log4j.jar ä»¥åŠslf4j å’Œ log4j çš„æ¡¥æ¥åŒ… slf4j-log4j12.jar ï¼Œspringboot é»˜è®¤å·²æœ‰å‰è€…ä¸¤è€…ï¼Œéœ€è¦å¼•å…¥æ¡¥æ¥åŒ… <code>slf4j-log4j12</code></p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>logback-classic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>ch.qos.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>log4j-over-slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>åˆ‡æ¢ä¸ºlog4j2 ï¼š</p><p>springboot æ”¯æŒçš„æ—¥å¿—æ¡†æ¶:<code>spring-boot-starter-log4j2</code> å’Œ <code>spring-boot-starter-logging</code> ï¼Œåè€…ä¸ºé»˜è®¤ï¼Œè‹¥è¦ä½¿ç”¨å‰è€…åˆ™ï¼Œç›´æ¥æ’é™¤åè€…å³å¯ã€‚ <a href="https://docs.spring.io/spring-boot/docs/2.2.8.RELEASE/reference/html/using-spring-boot.html#using-boot" target="_blank" rel="noopener">å®˜ç½‘è¯´æ˜</a> ã€‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-log4j2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://segmentfault.com/a/1190000017909301" target="_blank" rel="noopener">https://segmentfault.com/a/1190000017909301</a> </p><p>ç¡…è°·springboot æ—¥å¿—ç›¸å…³è§†é¢‘æ•™ç¨‹</p><p><a href="https://docs.spring.io/spring-boot/docs/2.2.8.RELEASE/reference/html/using-spring-boot.html#using-boot" target="_blank" rel="noopener">springboot å®˜ç½‘</a> </p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Loging </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>YAML è¯­æ³•å­¦ä¹ </title>
      <link href="/posts/bb845937.html"/>
      <url>/posts/bb845937.html</url>
      
        <content type="html"><![CDATA[<h2 id="YAMLè¯­æ³•å­¦ä¹ "><a href="#YAMLè¯­æ³•å­¦ä¹ " class="headerlink" title="YAMLè¯­æ³•å­¦ä¹ "></a>YAMLè¯­æ³•å­¦ä¹ </h2><p>å…¶å® <code>YAML</code> å¹¶ä¸æ˜¯springboot ç‰¹æœ‰è¯­æ³•ï¼Œæ¯”å¦‚ Hexo çš„é…ç½®æ–‡ä»¶éƒ½æ˜¯è¿™ç§æ ¼å¼ï¼Œåªæ˜¯ä¸€æ—¶åˆä¸å¥½å½’ç±»ï¼Œå°±å…ˆæ”¾åˆ°springboot é‡Œäº†ã€‚</p><h3 id="ä¸€ã€åŸºæœ¬è¯­æ³•"><a href="#ä¸€ã€åŸºæœ¬è¯­æ³•" class="headerlink" title="ä¸€ã€åŸºæœ¬è¯­æ³•"></a>ä¸€ã€åŸºæœ¬è¯­æ³•</h3><p> <code>YAML</code> æ˜¯ä»¥é”®å€¼å¯¹çš„æ–¹å¼ä¹¦å†™ä»£ç å—çš„ï¼Œæ”¯æŒå¤šå±‚çº§ï¼Œå¯¹è±¡æ•°ç»„ç­‰é›†åˆå…ƒç´ ã€‚</p><p>åŸºæœ¬æ ¼å¼ï¼š</p><pre class=" language-yml"><code class="language-yml">key: valuekey:    key2: value2    key2ï¼š        key3: value3</code></pre><p><code>key:  value</code>ï¼šè¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹ï¼ˆå†’å·åé¢å¿…é¡»æœ‰ç©ºæ ¼ï¼‰ï¼›å±æ€§é”®å’Œå¯¹åº”çš„å€¼æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚</p><p>ä¸Šè¿°å†™æ³•ç­‰ä»·äº <code>properties</code> æ ¼å¼ï¼š</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">key</span><span class="token punctuation">=</span><span class="token attr-value">value</span><span class="token attr-name">key.key2</span><span class="token punctuation">=</span><span class="token attr-value">value2</span><span class="token attr-name">key.key2.key3</span><span class="token punctuation">=</span><span class="token attr-value">value3</span></code></pre><p><code>YAML</code> ä»¥ç©ºæ ¼çš„ç¼©è¿›æ¥æ§åˆ¶å±‚çº§å…³ç³»ï¼›åªè¦æ˜¯å·¦å¯¹é½çš„ä¸€åˆ—æ•°æ®ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå±‚çº§çš„ï¼Œæ¯”å¦‚</p><pre class=" language-yml"><code class="language-yml">server:    port: 8080    servlet:        context-path: /dbcm        session:            timeout: 1800s</code></pre><h3 id="äºŒã€ç‰¹æ®Šçš„å€¼"><a href="#äºŒã€ç‰¹æ®Šçš„å€¼" class="headerlink" title="äºŒã€ç‰¹æ®Šçš„å€¼"></a>äºŒã€ç‰¹æ®Šçš„å€¼</h3><h4 id="1ã€å•å¼•å·å’ŒåŒå¼•å·"><a href="#1ã€å•å¼•å·å’ŒåŒå¼•å·" class="headerlink" title="1ã€å•å¼•å·å’ŒåŒå¼•å·"></a>1ã€å•å¼•å·å’ŒåŒå¼•å·</h4><p>ä¸€èˆ¬çš„é”®å’Œå€¼éƒ½æ˜¯å­—é¢é‡å’Œæ™®é€šçš„å€¼ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”ï¼‰ç»„æˆã€‚å­—ç¬¦ä¸²é»˜è®¤ä¸å¸¦å•å¼•å·<code>&#39; &#39;</code>æˆ–åŒå¼•å· <code>&quot; &quot;</code>ã€‚</p><ul><li><code>&#39;&#39;</code> : å•å¼•å·ï¼Œä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦ä¼šè§£ææˆæ™®é€šçš„å­—ç¬¦ä¸²æ•°æ®ã€‚</li><li><code>&quot; &quot;</code> ï¼šåŒå¼•å·ï¼Œä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ã€‚ç‰¹æ®Šå­—ç¬¦è¡¨è¾¾è§£ææˆåŸæœ¬çš„å«ä¹‰ã€‚</li></ul><p>å¦‚å•å¼•å·ç¤ºä¾‹ï¼š</p><pre class=" language-yml"><code class="language-yml">xiaocai:    name: 'small \n rose' </code></pre><p>è§£æä¹‹åå¾—åˆ°çš„ name å€¼å°±æ˜¯ï¼š</p><pre class=" language-txt"><code class="language-txt"> small \n rose </code></pre><p>åŒå¼•å·ç¤ºä¾‹ï¼š</p><pre class=" language-yml"><code class="language-yml">xiaocai:    name: "small \n rose" </code></pre><p>è§£æä¹‹åå¾—åˆ°çš„ name å€¼å°±æ˜¯ï¼š</p><pre class=" language-txt"><code class="language-txt">smallrose</code></pre><h4 id="2ã€æ•°ç»„ä¸é›†åˆ"><a href="#2ã€æ•°ç»„ä¸é›†åˆ" class="headerlink" title="2ã€æ•°ç»„ä¸é›†åˆ"></a>2ã€æ•°ç»„ä¸é›†åˆ</h4><p>ï¼ˆ1ï¼‰å¯¹è±¡</p><p>å¯¹è±¡ä¾ç„¶æ˜¯é”®å€¼å¯¹çš„æ–¹å¼:</p><pre class=" language-yml"><code class="language-yml">user:    name: smale-rose    email: small-rose@qq.com</code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼ map çš„è¡Œé—´æ–¹å¼ä¹¦å†™ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">user</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> smale<span class="token punctuation">-</span>rose<span class="token punctuation">,</span> <span class="token key atrule">email</span><span class="token punctuation">:</span> small<span class="token punctuation">-</span>rose@qq.com<span class="token punctuation">}</span></code></pre><p>æ³¨æ„å†’å·åé¢çš„ç©ºæ ¼ã€‚</p><p>ï¼ˆ2ï¼‰æ•°ç»„æˆ–é›†åˆ</p><p>ç”¨ <code>-</code> å€¼è¡¨ç¤ºæ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚</p><p>å¦‚ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">fruits</span><span class="token punctuation">:</span>  â€ apple  â€ pear  â€ banana  â€ watermelon</code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼ list çš„è¡Œé—´æ–¹å¼ä¹¦å†™ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">fruits</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>apple<span class="token punctuation">,</span> pear<span class="token punctuation">,</span> banana<span class="token punctuation">,</span> watermelon<span class="token punctuation">]</span></code></pre><h3 id="ä¸‰ã€æ–‡æ¡£å—ç‰¹å¾"><a href="#ä¸‰ã€æ–‡æ¡£å—ç‰¹å¾" class="headerlink" title="ä¸‰ã€æ–‡æ¡£å—ç‰¹å¾"></a>ä¸‰ã€æ–‡æ¡£å—ç‰¹å¾</h3><p>YAML çš„æ–‡æ¡£å—çš„ç‰¹å¾ï¼Œå¯ä»¥å¾ˆå¥½çš„é…åˆ SpringBoot çš„ <code>Profile</code> ç‰¹å¾ã€‚</p><p>YAML æ–‡æ¡£ä½¿ç”¨  <code>---</code> è¿›è¡Œåˆ†å‰²æ–‡æ¡£å—ã€‚</p><p>æ¯”å¦‚ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev    <span class="token punctuation">---</span><span class="token key atrule">server</span><span class="token punctuation">:</span>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev<span class="token punctuation">---</span><span class="token key atrule">server</span><span class="token punctuation">:</span>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9090</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> prod</code></pre><p>ç¤ºä¾‹ä¸­åœ¨ç¬¬ä¸€ä¸ªæ–‡æ¡£å—æ¿€æ´»äº† <code>dev</code> ç¯å¢ƒï¼Œåº”ç”¨å¯åŠ¨ä¹‹åä½¿ç”¨ç«¯å£æ˜¯ 8081ã€‚</p><h3 id="å››ï¼šå ä½ç¬¦"><a href="#å››ï¼šå ä½ç¬¦" class="headerlink" title="å››ï¼šå ä½ç¬¦"></a>å››ï¼šå ä½ç¬¦</h3><h4 id="1ã€éšæœºæ•°"><a href="#1ã€éšæœºæ•°" class="headerlink" title="1ã€éšæœºæ•°"></a>1ã€éšæœºæ•°</h4><pre class=" language-yaml"><code class="language-yaml">$<span class="token punctuation">{</span>random.value<span class="token punctuation">}</span>ã€$<span class="token punctuation">{</span>random.uuid<span class="token punctuation">}</span>ã€$<span class="token punctuation">{</span>random.int<span class="token punctuation">}</span>ã€$<span class="token punctuation">{</span>random.long<span class="token punctuation">}</span>$<span class="token punctuation">{</span>random.int(10)<span class="token punctuation">}</span>ã€$<span class="token punctuation">{</span>random.int<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token number">65536</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h4 id="2ã€å ä½ç¬¦å–å€¼"><a href="#2ã€å ä½ç¬¦å–å€¼" class="headerlink" title="2ã€å ä½ç¬¦å–å€¼"></a>2ã€å ä½ç¬¦å–å€¼</h4><p>å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨ <code>:</code> æŒ‡å®šé»˜è®¤å€¼ã€‚</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">user</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> smale<span class="token punctuation">-</span>rose    <span class="token key atrule">email</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>random.value<span class="token punctuation">}</span>_small<span class="token punctuation">-</span>rose@qq.com    <span class="token key atrule">age</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>random.int<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">}</span>    <span class="token key atrule">addr</span><span class="token punctuation">:</span> Address_$<span class="token punctuation">{</span><span class="token key atrule">user.name</span><span class="token punctuation">:</span> no_user<span class="token punctuation">}</span>    <span class="token key atrule">last_name</span><span class="token punctuation">:</span> LastName_$<span class="token punctuation">{</span><span class="token key atrule">user.lastName</span><span class="token punctuation">:</span> no_user<span class="token punctuation">}</span></code></pre><h3 id="äº”ã€é…ç½®ä¸JavaBean-ç»‘å®š"><a href="#äº”ã€é…ç½®ä¸JavaBean-ç»‘å®š" class="headerlink" title="äº”ã€é…ç½®ä¸JavaBean ç»‘å®š"></a>äº”ã€é…ç½®ä¸JavaBean ç»‘å®š</h3><h4 id="1ã€ç»‘å®šç¤ºä¾‹"><a href="#1ã€ç»‘å®šç¤ºä¾‹" class="headerlink" title="1ã€ç»‘å®šç¤ºä¾‹"></a>1ã€ç»‘å®šç¤ºä¾‹</h4><p>ï¼ˆ1ï¼‰å¯ä»¥å¼•å…¥é…ç½®æ–‡ä»¶å¤„ç†</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!â€â€å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤ºâ€â€</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>springâ€bootâ€configurationâ€processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span> </code></pre><p>ï¼ˆ2ï¼‰å¯¹åº” <code>application.yaml</code>  çš„ é…ç½®</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">initvalue</span><span class="token punctuation">:</span>    <span class="token key atrule">evn</span><span class="token punctuation">:</span> prod    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>    <span class="token key atrule">flag</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>    <span class="token key atrule">dbTypeIdList</span><span class="token punctuation">:</span>            <span class="token punctuation">-</span> <span class="token number">1</span>            <span class="token punctuation">-</span> <span class="token number">2</span>            <span class="token punctuation">-</span> <span class="token number">3</span></code></pre><p>ï¼ˆ3ï¼‰ä½¿ç”¨æ³¨è§£ <code>@ConfigurationProperties</code> è¿›è¡Œç»‘å®š</p><p>æ¯”å¦‚æˆ‘è¿™ä¸ªç¤ºä¾‹æ˜¯å®é™…é¡¹ç›®æœ‰ä¸€äº›åˆå§‹åŒ–é…ç½®å€¼ï¼Œå­—æ®µç‰¹åˆ«å¤šï¼Œä½œä¸ºç¤ºä¾‹ï¼Œé€‰å‡ ä¸ªï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"initvalue"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InitValueConfig</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String evn <span class="token punctuation">;</span>    <span class="token keyword">private</span> String port <span class="token punctuation">;</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Long<span class="token operator">></span> dbTypeIdList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>Long<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">private</span> <span class="token keyword">boolean</span> flag<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// setter getter ...</span><span class="token punctuation">}</span></code></pre><p>æ³¨æ„ï¼š <strong>@ConfigurationProperties(prefix = â€œinitvalueâ€) ** è¡¨ç¤ºé»˜è®¤ä»å…¨å±€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼ï¼›å¦‚æœ initvalue å‰ç¼€çš„é…ç½®æ”¾åœ¨å¦å¤–çš„ <code>initvalue.yml</code> æ–‡ä»¶ä¸­ï¼Œåˆ™éœ€è¦æ·»åŠ   *<em><code>@PropertySource(&quot;classpath:initvalue.yml&quot;)</code> *</em> è¡¨ç¤ºä»æŒ‡å®šçš„é…ç½®ä¸­æŸ¥æ‰¾å¯¹åº”çš„å‰ç¼€ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªé…ç½®æ–‡ä»¶  **<code>@PropertySource({&quot;classpath:initvalue.yml&quot;,&quot;classpath:initvalue2.yml&quot;})</code></strong> </p><p>å¦‚æœæ˜¯propertiesæ–‡ä»¶ï¼ŒåŒç†ï¼š</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">initvalue.evn</span><span class="token punctuation">=</span><span class="token attr-value">prod</span><span class="token attr-name">initvalue.port</span><span class="token punctuation">:</span> <span class="token attr-value">8080</span><span class="token attr-name">initvalue.dbTypeIdList[0]</span><span class="token punctuation">=</span><span class="token attr-value">1</span><span class="token attr-name">initvalue.dbTypeIdList[1]</span><span class="token punctuation">=</span><span class="token attr-value">2</span><span class="token attr-name">initvalue.dbTypeIdList[2]</span><span class="token punctuation">=</span><span class="token attr-value">3</span><span class="token attr-name">initvalue.flag</span><span class="token punctuation">=</span><span class="token attr-value">false</span></code></pre><p>ä¹Ÿå¯ä»¥è¿›è¡Œç»‘å®šï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:initvalue.properties"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"initvalue"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InitValueConfig</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> String evn <span class="token punctuation">;</span>    <span class="token keyword">private</span> String port <span class="token punctuation">;</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Long<span class="token operator">></span> dbTypeIdList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>Long<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">boolean</span> flag<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// setter getter ...</span><span class="token punctuation">}</span></code></pre><p><strong>@ConfigurationProperties(prefix = â€œinitvalueâ€)</strong> ï¼šé»˜è®¤ä»å…¨å±€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼ï¼›</p><p><strong>@PropertySource</strong> ï¼šè¡¨ç¤ºåŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶æ¥æ˜ å°„ç»‘å®šï¼›</p><p><strong>@ImportResource</strong>ï¼šå¯¼å…¥Springçš„é…ç½®æ–‡ä»¶ï¼Œè®©é…ç½®æ–‡ä»¶é‡Œé¢çš„å†…å®¹ç”Ÿæ•ˆï¼›</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ImportResource</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"classpath:beans.xml"</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>å½“ç„¶ springboot  æ¨èä½¿ç”¨æ³¨è§£<code>@Configuration</code> å’Œ <code>@Bean</code> ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> Filter <span class="token function">validatorFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> FileNotFoundException<span class="token punctuation">{</span>         System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------------load validatorFilter---------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ValidatorFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="2ã€å–å€¼æ–¹å¼"><a href="#2ã€å–å€¼æ–¹å¼" class="headerlink" title="2ã€å–å€¼æ–¹å¼"></a>2ã€å–å€¼æ–¹å¼</h4><p>è·å–å€¼é™¤äº†<code>@Conï¬gurationProperties</code> è¿˜å¯ä»¥ä½¿ç”¨<code>@Value</code> è·å–ã€‚</p><p>æ¯”å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InitValueConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${initvalue.evn}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String evn <span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${initvalue.port}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String port <span class="token punctuation">;</span>     <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{'${initvalue.list}'.split(',')}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Long<span class="token operator">></span> dbTypeIdList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>Long<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{${initvalue.maps}}"</span><span class="token punctuation">)</span>      <span class="token keyword">private</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">></span> maps<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${initvalue.flag}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> flag<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{${webServiceMap}}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">></span> webServiceMap<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// setter getter ...</span><span class="token punctuation">}</span></code></pre><p>å¯¹åº”çš„ <code>YAML</code> ä¸º</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">initvalue</span><span class="token punctuation">:</span>    <span class="token key atrule">evn</span><span class="token punctuation">:</span> prod    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>    <span class="token key atrule">flag</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>    <span class="token key atrule">list</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span>    <span class="token key atrule">maps</span><span class="token punctuation">:</span> "<span class="token punctuation">{</span><span class="token key atrule">key1</span><span class="token punctuation">:</span> <span class="token string">'value1'</span><span class="token punctuation">,</span> <span class="token key atrule">key2</span><span class="token punctuation">:</span> <span class="token string">'value2'</span><span class="token punctuation">}</span>"    <span class="token key atrule">webServiceMap</span><span class="token punctuation">:</span> "<span class="token punctuation">{</span><span class="token key atrule">webServiceURL</span><span class="token punctuation">:</span> <span class="token string">'http://web.com.server/xxx'</span><span class="token punctuation">,</span> <span class="token key atrule">success</span><span class="token punctuation">:</span> <span class="token string">'0000'</span><span class="token punctuation">,</span><span class="token key atrule">filePath</span><span class="token punctuation">:</span> <span class="token string">'/home/file/'</span><span class="token punctuation">}</span>"</code></pre><p>å–å€¼æ–¹å¼æ¯”è¾ƒ</p><table><thead><tr><th></th><th>@value</th><th>@ConfigurationProperties</th></tr></thead><tbody><tr><td>åŠŸèƒ½</td><td>æ‰¹é‡æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§</td><td>ä¸€ä¸ªä¸ªæŒ‡å®š</td></tr><tr><td>æ¾æ•£ç»‘å®šï¼ˆæ¾æ•£è¯­æ³•ï¼‰</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>SpEL</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>JSR303æ•°æ®æ ¡éªŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>å¤æ‚ç±»å‹å°è£…</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><p>é…ç½®æ–‡ä»¶<code>yml</code> æˆ–è€… <code>properties</code> äºŒè€…éƒ½èƒ½è·å–åˆ°å€¼ï¼›åªè·å–ä¸€ä¸‹é…ç½®æ–‡ä»¶ä¸­çš„æŸé¡¹å€¼ï¼Œä½¿ç”¨@Valueï¼›å‚æ•°è¾ƒå¤šæ—¶ä½¿ç”¨JavaBeanæ¥å’Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šæ˜ å°„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>@Conï¬gurationProperties</code> çœå»äº†ä¸€ä¸ªä¸ªé…ç½®çš„éº»çƒ¦ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> YAML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Matery ä¸»é¢˜æ·»åŠ å¤šçº§åˆ†ç±»</title>
      <link href="/posts/5a99eb4d.html"/>
      <url>/posts/5a99eb4d.html</url>
      
        <content type="html"><![CDATA[<h2 id="Hexo-Matery-ä¸»é¢˜æ·»åŠ å¤šçº§åˆ†ç±»"><a href="#Hexo-Matery-ä¸»é¢˜æ·»åŠ å¤šçº§åˆ†ç±»" class="headerlink" title="Hexo Matery ä¸»é¢˜æ·»åŠ å¤šçº§åˆ†ç±»"></a>Hexo Matery ä¸»é¢˜æ·»åŠ å¤šçº§åˆ†ç±»</h2><blockquote><p>æœ‰åŒå­¦æå‡º Matery ä¸»é¢˜çš„ æ ‡ç­¾ å’Œ åˆ†ç±» çš„å±•ç¤ºå¤ªç›¸ä¼¼ï¼Œå¯ä»¥è¯´åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚äºæ˜¯æœ‰äº†æœ¬æ–‡ï¼Œå°è¯•æ”¹æˆå¤šçº§åˆ†ç±»çš„ã€‚ å‡å¦‚è¦è‡ªå·±ä»é›¶å¼€å§‹å­¦ä¹ åˆä¸å¤ªç°å®ï¼Œ æ‰€ä»¥å°±å€Ÿé‰´ç§»æ¤äº† Fluid ä¸»é¢˜çš„å¤šçº§åˆ†ç±»åŠŸèƒ½ã€‚ä¸ºäº†ç»™ä¹Ÿæƒ³æŠ˜è…¾çš„äººï¼Œç‰¹æ­¤è®°å½•ä¿®æ”¹è¿‡ç¨‹ã€‚</p></blockquote><h2 id="å¤šçº§åˆ†ç±»æ·»åŠ æµç¨‹"><a href="#å¤šçº§åˆ†ç±»æ·»åŠ æµç¨‹" class="headerlink" title="å¤šçº§åˆ†ç±»æ·»åŠ æµç¨‹"></a>å¤šçº§åˆ†ç±»æ·»åŠ æµç¨‹</h2><p>Matery ä¸»é¢˜æ˜¯å¡ç‰‡å¼ç»“æ„ï¼Œä¸ºäº†ä¿æŒåŸæ¥çš„æ•´ä½“ç»“æ„ï¼Œæ–°å»ºå¤šçº§åˆ†ç±»çš„æ¨¡å—ã€‚</p><h3 id="1ã€æ–°å»º-category-list-ejs"><a href="#1ã€æ–°å»º-category-list-ejs" class="headerlink" title="1ã€æ–°å»º category-list.ejs"></a>1ã€æ–°å»º category-list.ejs</h3><p>åœ¨ä¸»é¢˜ç›®å½• <code>/layout/_widget/</code>ç›®å½•ä¸‹æ–°å»º <code>category-list.ejs</code> æ–‡ä»¶ã€‚ å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code>&lt;% var orderBy =  &#39;name&#39; ;  %&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css&quot;&gt;&lt;script src=&quot;https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;&lt;style&gt;.category:not(:last-child) {  margin-bottom: 1rem;}.category-item {  font-size: 1.25rem;  font-weight: bold;  display: flex;  align-items: center;}.category-subitem {  font-size: 1rem;  font-weight: bold;}.category-collapse {  margin-left: 1.25rem;  width: 100%;}.category-count {  font-size: 0.9rem;  font-weight: initial;  min-width: 1.3em;  line-height: 1.3em;  display: flex;  align-items: center;}.category-count i {  padding-right: 0.25rem;}.category-count span {  width: 2rem;}.category-item-action:not(.collapsed) &gt; i {  transform: rotate(90deg);  transform-origin: center center;}.category-item-action i {  transition: transform 0.3s ease-out;  display: inline-block;  margin-left: 0.25rem;}.category-item-action:hover {  z-index: 1;  color: #38ACDF;  text-decoration: none;  background-color: #F8F9FA;}.category .row {  margin-left: 0;  margin-right: 0;}.list-group-item:first-child {    border-top-left-radius: .25rem;    border-top-right-radius: .25rem;}.category-item {    font-size: 1.25rem;    font-weight: 700;    display: flex;    align-items: center;}.list-group-item {    background-color: transparent;    border: 0;}.list-group-item {    position: relative;    display: block;    padding: .75rem 1.25rem;    background-color: #fff;    /* border: 1px solid rgba(0,0,0,.125); */}#card-list-zzy .list-group-item:hover {    color: #38ACDF;    background-color: #F8F9FA;    /*  border: 1px solid rgba(0,0,0,.125); */}.category-item-action i {    transition: transform .3s ease-out;    display: inline-block;    margin-left: .25rem;}card-categories-list-spcail &gt; div:hover{    color:#38ACDF;    background-color: #F8F9FA;}.fa {    font-size: 1rem;    line-height: 1;}.category-count {    font-size: .9rem;    font-weight: initial;    min-width: 1.3em;    line-height: 1.3em;    display: flex;    align-items: center;}.collapse:not(.show) {    display: none;}.collapsing {  position: relative;  height: 0;  overflow: hidden;  @include transition($transition-collapse);}#card-list-zzy{    position: relative;    /* margin-top: -2rem; */    transition: background-color .2s ease-in-out;    border-radius: .5rem;    z-index: 3;}&lt;/style&gt;  &lt;% function render_categories(cats, depth) { %&gt;  &lt;% depth = depth || 0 %&gt;  &lt;% return cats.each(function(cat){ %&gt;    &lt;% var subCats = site.categories.find({parent: cat._id}).sort(orderBy).filter(cat =&gt; cat.length) %&gt;    &lt;% var collapsed = subCats.length === 0 %&gt;    &lt;div class=&quot;&lt;%= depth &lt;= 0 ? &#39;category&#39; : &#39;category-sub&#39; %&gt; row&quot;&gt;      &lt;a        class=&quot;&lt;%= depth &lt;= 0 ? &#39;category-item&#39; : &#39;category-subitem&#39; %&gt; &lt;%= collapsed ? &#39;collapsed&#39; : &#39;&#39; %&gt; list-group-item category-item-action col-10 col-md-11&quot;        id=&quot;heading-&lt;%= cat._id %&gt;&quot; role=&quot;tab&quot; data-toggle=&quot;collapse&quot;   data-target=&quot;#collapse-&lt;%= cat._id %&gt;&quot;        aria-expanded=&quot;&lt;%= collapsed ? &#39;false&#39; : &#39;true&#39; %&gt;&quot;      &gt;        &lt;%= cat.name %&gt;        &lt;i class=&quot;fas fa-chevron-right&quot;&gt;&lt;/i&gt;      &lt;/a&gt;      &lt;a href=&quot;&lt;%= url_for(cat.path) %&gt;&quot; class=&quot;category-count col-2 col-md-1&quot;&gt;        &lt;i class=&quot;fa fa-list&quot;&gt;&lt;/i&gt;        &lt;span&gt;&lt;%= cat.posts.length %&gt;&lt;/span&gt;      &lt;/a&gt;      &lt;div class=&quot;category-collapse&quot;&gt;        &lt;% if (subCats.length &gt; 0) { %&gt;          &lt;%- render_sub_categories(subCats, cat, depth + 1) %&gt;        &lt;% } else { %&gt;          &lt;%- render_posts(cat) %&gt;        &lt;% } %&gt;      &lt;/div&gt;    &lt;/div&gt;  &lt;% }) %&gt;&lt;% } %&gt;&lt;% function render_sub_categories(cats, parent, depth) { %&gt;  &lt;div id=&quot;collapse-&lt;%= parent._id %&gt;&quot; class=&quot; collapse in show&quot; role=&quot;tabpanel&quot;       aria-labelledby=&quot;heading-&lt;%= parent._id %&gt;&quot;&gt;    &lt;%- render_categories(cats, depth) %&gt;  &lt;/div&gt;&lt;% } %&gt;&lt;% function render_posts(cat) { %&gt;  &lt;div id=&quot;collapse-&lt;%= cat._id %&gt;&quot; class=&quot;collapse in&quot; role=&quot;tabpanel&quot;       aria-labelledby=&quot;heading-&lt;%= cat._id %&gt;&quot;&gt;    &lt;% var limit = 100 ; %&gt;    &lt;% var posts = cat.posts.sort(config.index_generator.order_by || &#39;-date&#39;) %&gt;    &lt;% for (var idx = 0; idx &lt; posts.length; idx++) { %&gt;      &lt;% var post = posts.data[idx] %&gt;      &lt;% if (idx &amp;&amp; limit &amp;&amp; idx &gt;= limit) { %&gt;        &lt;a href=&quot;&lt;%- url_for(cat.path) %&gt;&quot; class=&quot;list-group-item list-group-item-action&quot;&gt;          &lt;span class=&quot;category-post&quot;&gt;More...&lt;/span&gt;        &lt;/a&gt;        &lt;% break %&gt;      &lt;% } else { %&gt;        &lt;a href=&quot;&lt;%- url_for(post.path) %&gt;&quot; class=&quot;list-group-item list-group-item-action&quot;&gt;          &lt;span class=&quot;category-post&quot;&gt;&lt;%= post.title %&gt;&lt;/span&gt;        &lt;/a&gt;      &lt;% } %&gt;    &lt;% } %&gt;  &lt;/div&gt;&lt;% } %&gt;&lt;div class=&quot;container&quot; data-aos=&quot;fade-up&quot;&gt;    &lt;div class=&quot;card  card-categories-list-spcail&quot;&gt;        &lt;div class=&quot;card-content col-12 col-md-10 m-auto &quot;&gt;            &lt;div  id=&quot;card-list-zzy&quot; class=&quot;&quot;&gt;                &lt;div class=&quot;category-list&quot;&gt;                  &lt;% cats = site.categories.find({parent: {$exists: false}}).sort(orderBy).filter(cat =&gt; cat.length) %&gt;                  &lt;%- render_categories(cats) %&gt;                &lt;/div&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;</code></pre><h3 id="2ã€å¼•å…¥-category-list-ejs"><a href="#2ã€å¼•å…¥-category-list-ejs" class="headerlink" title="2ã€å¼•å…¥ category-list.ejs"></a>2ã€å¼•å…¥ category-list.ejs</h3><p>æ‰¾åˆ°ä¸»é¢˜ç›®å½•ä¸‹ <code>/layout/categories.ejs</code> , æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><pre class=" language-ejs"><code class="language-ejs"><%- partial('_widget/category-list') %></code></pre><p>åŠ äº†ä¹‹åï¼Œå¤§æ¦‚æ˜¯è¿™æ ·å­ï¼š</p><pre><code>&lt;%- partial(&#39;_partial/bg-cover&#39;) %&gt;&lt;main class=&quot;content&quot;&gt;    &lt;%- partial(&#39;_widget/category-cloud&#39;) %&gt;    &lt;% if (site.categories &amp;&amp; site.categories.length &gt; 0) { %&gt;    &lt;%- partial(&#39;_widget/category-radar&#39;) %&gt;    &lt;% } %&gt;    &lt;%- partial(&#39;_widget/category-list&#39;) %&gt;&lt;/main&gt;</code></pre><h3 id="3ã€ä½¿ç”¨"><a href="#3ã€ä½¿ç”¨" class="headerlink" title="3ã€ä½¿ç”¨"></a>3ã€ä½¿ç”¨</h3><p>åœ¨æ–‡ç« çš„å¤´éƒ¨å†™ <code>categories</code> å¤šçº§çš„å†™æ³•ï¼š</p><pre><code>categories:  - æ”¶è—èµ„æº  - å·¥å…·ç½‘ç«™</code></pre><p>æ˜¾ç¤ºåˆ†çº§åˆ™ä¾æ¬¡ä»ä¸Šåˆ°ä¸‹ã€‚</p><p>æœ€åå¯åŠ¨çœ‹æ•ˆæœå§~</p><pre class=" language-bash"><code class="language-bash">hexo cleanhexo ghexo s</code></pre><p>å¥½å§ï¼Œå¦‚æœä½ ä¸æ˜¯æ­Œè¿½æ±‚å®Œç¾çš„äººï¼Œç°åœ¨å…¶å®å·²ç»å¯ä»¥ä½¿ç”¨äº†ã€‚</p><p>å’³~ å’³~ è¯¥è¯´æ­£äº‹äº†</p><p>æ¥ä¸‹æ¥è·Ÿæˆ‘çš„æç¤ºå»ç§ç§ï¼Œçœ‹çœ‹ä½ è¿™ä¸ªé¡µé¢çš„ baner ä¸Šçš„å­æ ‡é¢˜ï¼Œæ˜¯ä¸æ˜¯æœ‰åƒå³ç‚¹è·‘åçš„ä¸€ç‚¹ï¼Œ å†çœ‹çœ‹è¿™ä¸ªé¡µé¢çš„ footer æ˜¯ä¸æ˜¯æ²¡æœ‰åŸæ¥è§„æ•´äº†ï¼Ÿ</p><p>å…¶å®æ˜¯å› ä¸ºè¿™ä¸ªé¡µé¢å¼•å…¥äº†  <code>bootstrap.min.css</code> é€ æˆäº†ã€‚</p><p>å› ä¸º <code>Materialize</code> å’Œ <code>bootstrap</code> å­˜åœ¨å†²çªã€‚</p><h3 id="4ã€é‡å¤´å†æ¥"><a href="#4ã€é‡å¤´å†æ¥" class="headerlink" title="4ã€é‡å¤´å†æ¥"></a>4ã€é‡å¤´å†æ¥</h3><p>ç»è¿‡å…­ä¸ªå°æ—¶çš„æ‘¸ç´¢ï¼Œ æŸ¥çœ‹ <code>Materialize</code> çš„å®˜ç½‘ç”¨æ³•ï¼Œæä¸ª <code>Demo</code> ï¼Œ ç„¶åæŠŠåˆšæ‰ä¸Šé¢çš„ä»£ç é‡æ–°ä¿®æ”¹è°ƒè¯•, è¾¾åˆ°äº†å‡ æœ¬å¯ä»¥ç”¨ï¼Œ ä¸”ä¸å†å†²çªï¼Œå› ä¸ºç”¨çš„æ˜¯ <code>Materialize</code> çš„æ ·å¼ï¼Œå¥½å§~ ä¸çŸ¥ä¸è§‰ï¼ŒåˆæŠ˜è…¾äº†ä¸€é <code>bootstrap</code>  å’Œ  <code>Materialize</code> ã€‚</p><p>æ–°çš„ <code>category-list.ejs</code> é•¿è¿™æ ·ï¼š</p><pre class=" language-html"><code class="language-html">&lt;% var orderBy =  'name' ;  %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token comment" spellcheck="true">/*.category:not(:last-child) {  margin-bottom: 1rem;}*/</span><span class="token selector"><span class="token class">.category-item</span> </span><span class="token punctuation">{</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1.25</span>rem<span class="token punctuation">;</span>  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-subitem</span> </span><span class="token punctuation">{</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1</span>rem<span class="token punctuation">;</span>  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-collapse</span> </span><span class="token punctuation">{</span>  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">1.25</span>rem<span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-count</span> </span><span class="token punctuation">{</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">0.9</span>rem<span class="token punctuation">;</span>  <span class="token property">font-weight</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>  <span class="token property">min-width</span><span class="token punctuation">:</span> <span class="token number">1.3</span>em<span class="token punctuation">;</span>  <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">1.3</span>em<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-count</span> i </span><span class="token punctuation">{</span>  <span class="token property">padding-right</span><span class="token punctuation">:</span> <span class="token number">0.25</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-count</span> span </span><span class="token punctuation">{</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">2</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-item-action</span><span class="token pseudo-class">:not(.collapsed)</span> > i </span><span class="token punctuation">{</span>  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">90</span>deg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">transform-origin</span><span class="token punctuation">:</span> center center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-item-action</span> i </span><span class="token punctuation">{</span>  <span class="token property">transition</span><span class="token punctuation">:</span> transform <span class="token number">0.3</span>s ease-out<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">0.25</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-item-action</span><span class="token pseudo-class">:hover</span> </span><span class="token punctuation">{</span>  <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#38ACDF</span><span class="token punctuation">;</span>  <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#F8F9FA</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.list-group-item</span><span class="token pseudo-class">:first-child</span> </span><span class="token punctuation">{</span>    <span class="token property">border-top-left-radius</span><span class="token punctuation">:</span> <span class="token number">.25</span>rem<span class="token punctuation">;</span>    <span class="token property">border-top-right-radius</span><span class="token punctuation">:</span> <span class="token number">.25</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-item</span> </span><span class="token punctuation">{</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1.25</span>rem<span class="token punctuation">;</span>    <span class="token property">font-weight</span><span class="token punctuation">:</span> <span class="token number">700</span><span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.list-group-item</span> </span><span class="token punctuation">{</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>    <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.list-group-item</span> </span><span class="token punctuation">{</span>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">.75</span>rem <span class="token number">1.25</span>rem<span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#fff</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* border: 1px solid rgba(0,0,0,.125); */</span><span class="token punctuation">}</span><span class="token selector"><span class="token id">#card-list-zzy</span> <span class="token class">.list-group-item</span><span class="token pseudo-class">:hover</span> </span><span class="token punctuation">{</span>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#38ACDF</span><span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#F8F9FA</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/*  border: 1px solid rgba(0,0,0,.125); */</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/*.category-item-action i {    transition: transform .3s ease-out;    display: inline-block;    margin-left: .25rem;}*/</span><span class="token selector">card-categories-list-spcail > div<span class="token pseudo-class">:hover</span></span><span class="token punctuation">{</span>  <span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#38ACDF</span><span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#F8F9FA</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.fa</span> </span><span class="token punctuation">{</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1</span>rem<span class="token punctuation">;</span>    <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-count</span> </span><span class="token punctuation">{</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">.9</span>rem<span class="token punctuation">;</span>    <span class="token property">font-weight</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>    <span class="token property">min-width</span><span class="token punctuation">:</span> <span class="token number">1.3</span>em<span class="token punctuation">;</span>    <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">1.3</span>em<span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-content</span></span><span class="token punctuation">{</span>   <span class="token property">border-left</span><span class="token punctuation">:</span><span class="token number">0</span>px<span class="token punctuation">;</span>   <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">.75</span>rem <span class="token number">1.25</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-content</span> a</span><span class="token punctuation">{</span>    <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-content</span> a<span class="token pseudo-class">:hover</span></span><span class="token punctuation">{</span>    <span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#38ACDF</span><span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#F8F9FA</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-row</span> </span><span class="token punctuation">{</span>  <span class="token property">border-color</span><span class="token punctuation">:</span> <span class="token hexcode">#F8F9FA</span><span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token property">border-bottom</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token id">#card-list-zzy</span></span><span class="token punctuation">{</span>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* margin-top: -2rem; */</span>    <span class="token property">transition</span><span class="token punctuation">:</span> background-color <span class="token number">.2</span>s ease-in-out<span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">.5</span>rem<span class="token punctuation">;</span>    <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.collapsible-header</span></span><span class="token punctuation">{</span>    <span class="token property">boder</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">function</span> <span class="token attr-name">render_categories(cats,</span> <span class="token attr-name">depth)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>  &lt;% depth = depth || 0 %>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">return</span> <span class="token attr-name">cats.each(function(cat){</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>    &lt;% var subCats = site.categories.find({parent: cat._id}).sort(orderBy).filter(cat => cat.length) %>    &lt;% var collapsed = subCats.length === 0 %>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span>  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> subCats.length <span class="token punctuation">></span> 0 ? <span class="token punctuation">'</span>active<span class="token punctuation">'</span> : <span class="token punctuation">'</span><span class="token punctuation">'</span> %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> depth &lt;<span class="token punctuation">=</span> 0 ? <span class="token punctuation">'</span>category-row<span class="token punctuation">'</span> : <span class="token punctuation">'</span>category-row category-sub<span class="token punctuation">'</span> %<span class="token punctuation">></span>  row collapsible-header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span> &lt;%<span class="token punctuation">=</span> depth &lt;<span class="token punctuation">=</span> 0 ? <span class="token punctuation">'</span>category-item<span class="token punctuation">'</span> : <span class="token punctuation">'</span>category-subitem<span class="token punctuation">'</span> %<span class="token punctuation">></span> &lt;%<span class="token punctuation">=</span> subCats.length <span class="token punctuation">></span> 0 ? <span class="token punctuation">'</span><span class="token punctuation">'</span> : <span class="token punctuation">'</span>collapsed<span class="token punctuation">'</span> %<span class="token punctuation">></span> list-group-item category-item-action col s10 m9<span class="token punctuation">"</span></span>        <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heading-&lt;%<span class="token punctuation">=</span> cat._id %<span class="token punctuation">></span><span class="token punctuation">"</span></span>       <span class="token punctuation">></span></span>        &lt;%= cat.name %>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fas fa-chevron-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> url_for(cat.path) %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-count col s2 m3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fa fa-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>&lt;%= cat.posts.length %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">if</span> <span class="token attr-name">(subCats.length</span> <span class="token punctuation">></span></span> 0) { %>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-content collapsible-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">render_sub_categories(subCats,</span> <span class="token attr-name">cat,</span> <span class="token attr-name">depth</span> <span class="token attr-name">+</span> <span class="token attr-name">1)</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">else</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">render_posts(cat)</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">})</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">function</span> <span class="token attr-name">render_sub_categories(cats,</span> <span class="token attr-name">parent,</span> <span class="token attr-name">depth)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>collapsible category-row<span class="token punctuation">"</span></span>  <span class="token attr-name">data-collapsible</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>expandable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">render_categories(cats,</span> <span class="token attr-name">depth)</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">function</span> <span class="token attr-name">render_posts(cat)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>collapse-&lt;%<span class="token punctuation">=</span> cat._id %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-content collapsible-body<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    &lt;% var limit = 20 ; %>    &lt;% var posts = cat.posts.sort(config.index_generator.order_by || '-date') %>    &lt;% for (var idx = 0; idx &lt; posts.length; idx++) { %>      &lt;% var post = posts.data[idx] %>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">if</span> <span class="token attr-name">(idx</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">limit</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">idx</span> <span class="token punctuation">></span></span>= limit) { %>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%- url_for(cat.path) %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list-group-item list-group-item-action<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>More...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">break</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">else</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%- url_for(post.path) %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span> list-group-item list-group-item-action<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&lt;%= post.title %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span> <span class="token attr-name">data-aos</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fade-up<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card  card-categories-list-spcail<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card-content col s12  m12<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>  <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card-list-zzy<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-list collapsible <span class="token punctuation">"</span></span>  <span class="token attr-name">data-collapsible</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>expandable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          &lt;% cats = site.categories.find({parent: {$exists: false}}).sort(orderBy).filter(cat => cat.length) %>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">render_categories(cats)</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.list-group-item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasClass</span><span class="token punctuation">(</span><span class="token string">'collapsed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'collapsed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"aria-expanded"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'collapsed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"aria-expanded"</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'display'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">==</span> <span class="token string">'block'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//$(id).hide();</span>    <span class="token comment" spellcheck="true">//$(id).slideUp();</span>  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//$(id).show();</span>    <span class="token comment" spellcheck="true">//$(id).slideDown();</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.collapsible'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collapsible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="5ã€é‡æ–°ç¼–è¯‘å¯åŠ¨"><a href="#5ã€é‡æ–°ç¼–è¯‘å¯åŠ¨" class="headerlink" title="5ã€é‡æ–°ç¼–è¯‘å¯åŠ¨"></a>5ã€é‡æ–°ç¼–è¯‘å¯åŠ¨</h3><p>å¯èƒ½è¿˜æœ‰ä¸€äº›æ ·å¼é—®é¢˜ï¼Œä¸è¿‡è¦ç¡è§‰äº†ã€‚</p><p>å°±è‡ªå·±è°ƒè°ƒå§~ å°½é‡ç”¨å†…è”æ ·å¼</p><p>åé¢è°ƒå¥½äº†ï¼Œæ–‡ç« å†æ›´æ–°ã€‚</p><h3 id="6ã€é‡æ–°æ›´æ–°ä¸€ç‰ˆ"><a href="#6ã€é‡æ–°æ›´æ–°ä¸€ç‰ˆ" class="headerlink" title="6ã€é‡æ–°æ›´æ–°ä¸€ç‰ˆ"></a>6ã€é‡æ–°æ›´æ–°ä¸€ç‰ˆ</h3><p>é‡æ–°è°ƒæ•´æ ·å¼ï¼Œ æ·»åŠ äº†æ ‡é¢˜ï¼Œ å»æ‰äº†è°ƒè¯• Demo , ç†è®ºä¸Šä¸é™åˆ¶çº§åˆ«æ·±ï¼Œ æ·»åŠ äº†è‡ªå®šä¹‰æ˜¾ç¤ºå¤šå°‘æœ€è¿‘å¤šå°‘ç¯‡é…ç½®å‚æ•°ã€‚</p><p>æ–°çš„ <code>category-list.ejs</code> é•¿è¿™æ ·ï¼š</p><pre class=" language-html"><code class="language-html">&lt;% var orderBy =  'name' ;  %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token comment" spellcheck="true">/*.category:not(:last-child) {  margin-bottom: 1rem;}*/</span><span class="token selector"><span class="token class">.category-item</span> </span><span class="token punctuation">{</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1.25</span>rem<span class="token punctuation">;</span>  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-subitem</span> </span><span class="token punctuation">{</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1</span>rem<span class="token punctuation">;</span>  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-collapse</span> </span><span class="token punctuation">{</span>  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">1.25</span>rem<span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100%</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-count</span> </span><span class="token punctuation">{</span>  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">0.9</span>rem<span class="token punctuation">;</span>  <span class="token property">font-weight</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>  <span class="token property">min-width</span><span class="token punctuation">:</span> <span class="token number">1.3</span>em<span class="token punctuation">;</span>  <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">1.3</span>em<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-count</span> i </span><span class="token punctuation">{</span>  <span class="token property">padding-right</span><span class="token punctuation">:</span> <span class="token number">0.25</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-count</span> span </span><span class="token punctuation">{</span>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">2</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-item-action</span><span class="token pseudo-class">:not(.collapsed)</span> > i </span><span class="token punctuation">{</span>  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">90</span>deg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">transform-origin</span><span class="token punctuation">:</span> center center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-item-action</span> i </span><span class="token punctuation">{</span>  <span class="token property">transition</span><span class="token punctuation">:</span> transform <span class="token number">0.3</span>s ease-out<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>  <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">0.25</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-item-action</span><span class="token pseudo-class">:hover</span> </span><span class="token punctuation">{</span>  <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#38ACDF</span><span class="token punctuation">;</span>  <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#F8F9FA</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.list-group-item</span><span class="token pseudo-class">:first-child</span> </span><span class="token punctuation">{</span>    <span class="token property">border-top-left-radius</span><span class="token punctuation">:</span> <span class="token number">.25</span>rem<span class="token punctuation">;</span>    <span class="token property">border-top-right-radius</span><span class="token punctuation">:</span> <span class="token number">.25</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-item</span> </span><span class="token punctuation">{</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1.25</span>rem<span class="token punctuation">;</span>    <span class="token property">font-weight</span><span class="token punctuation">:</span> <span class="token number">700</span><span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.list-group-item</span> </span><span class="token punctuation">{</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>    <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.list-group-item</span> </span><span class="token punctuation">{</span>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">.75</span>rem <span class="token number">1.25</span>rem<span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#fff</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* border: 1px solid rgba(0,0,0,.125); */</span><span class="token punctuation">}</span><span class="token selector"><span class="token id">#card-list-zzy</span> <span class="token class">.list-group-item</span><span class="token pseudo-class">:hover</span> </span><span class="token punctuation">{</span>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#38ACDF</span><span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#F8F9FA</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/*  border: 1px solid rgba(0,0,0,.125); */</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-item-action</span> i </span><span class="token punctuation">{</span>    <span class="token property">transition</span><span class="token punctuation">:</span> transform <span class="token number">.3</span>s ease-out<span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>    <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">.25</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-item-action</span> a</span><span class="token punctuation">{</span>      <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>      <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">.75</span>rem <span class="token number">1.25</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">card-categories-list-spcail > div<span class="token pseudo-class">:hover</span></span><span class="token punctuation">{</span>  <span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#38ACDF</span><span class="token punctuation">;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#F8F9FA</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.fa</span> </span><span class="token punctuation">{</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">1</span>rem<span class="token punctuation">;</span>    <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-count</span> </span><span class="token punctuation">{</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">.9</span>rem<span class="token punctuation">;</span>    <span class="token property">font-weight</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>    <span class="token property">min-width</span><span class="token punctuation">:</span> <span class="token number">1.3</span>em<span class="token punctuation">;</span>    <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">1.3</span>em<span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-content</span></span><span class="token punctuation">{</span>   <span class="token property">border-left</span><span class="token punctuation">:</span><span class="token number">0</span>px<span class="token punctuation">;</span>   <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">.75</span>rem <span class="token number">1.25</span>rem<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-content</span> a</span><span class="token punctuation">{</span>    <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-content</span> a<span class="token pseudo-class">:hover</span></span><span class="token punctuation">{</span>    <span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#38ACDF</span><span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#F8F9FA</span><span class="token punctuation">;</span>    <span class="token property">box-shadow</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token selector"><span class="token class">.category-row</span> </span><span class="token punctuation">{</span>  <span class="token property">border-color</span><span class="token punctuation">:</span> <span class="token hexcode">#F8F9FA</span><span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token property">border-bottom</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span>  <span class="token property">box-shadow</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token id">#card-list-zzy</span></span><span class="token punctuation">{</span>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* margin-top: -2rem; */</span>    <span class="token property">transition</span><span class="token punctuation">:</span> background-color <span class="token number">.2</span>s ease-in-out<span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">.5</span>rem<span class="token punctuation">;</span>    <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.collapsible-header</span></span><span class="token punctuation">{</span>    <span class="token property">boder</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.collapsible</span></span><span class="token punctuation">{</span>  <span class="token property">box-shadow</span><span class="token punctuation">:</span>none <span class="token important">!important</span><span class="token punctuation">;</span>  <span class="token property">-webkit-box-shadow</span><span class="token punctuation">:</span> none <span class="token important">!important</span><span class="token punctuation">;</span>  <span class="token property">border-left</span><span class="token punctuation">:</span>none <span class="token important">!important</span><span class="token punctuation">;</span>  <span class="token property">border-right</span><span class="token punctuation">:</span>none <span class="token important">!important</span><span class="token punctuation">;</span>  <span class="token property">border-bottom</span><span class="token punctuation">:</span>none <span class="token important">!important</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.categories-title</span></span><span class="token punctuation">{</span>    <span class="token property">padding-top</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* padding-bottom: 5px; */</span>    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> -<span class="token number">10</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">function</span> <span class="token attr-name">render_categories(cats,</span> <span class="token attr-name">depth)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>  &lt;% depth = depth || 0 %>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">return</span> <span class="token attr-name">cats.each(function(cat){</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>    &lt;% var subCats = site.categories.find({parent: cat._id}).sort(orderBy).filter(cat => cat.length) %>    &lt;% var collapsed = subCats.length === 0 %>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span>  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> subCats.length <span class="token punctuation">></span> 0 ? <span class="token punctuation">'</span>active<span class="token punctuation">'</span> : <span class="token punctuation">'</span><span class="token punctuation">'</span> %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> depth &lt;<span class="token punctuation">=</span> 0 ? <span class="token punctuation">'</span>category-row<span class="token punctuation">'</span> : <span class="token punctuation">'</span>category-row category-sub<span class="token punctuation">'</span> %<span class="token punctuation">></span>  row collapsible-header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span> &lt;%<span class="token punctuation">=</span> depth &lt;<span class="token punctuation">=</span> 0 ? <span class="token punctuation">'</span>category-item<span class="token punctuation">'</span> : <span class="token punctuation">'</span>category-subitem<span class="token punctuation">'</span> %<span class="token punctuation">></span> &lt;%<span class="token punctuation">=</span> subCats.length <span class="token punctuation">></span> 0 ? <span class="token punctuation">'</span><span class="token punctuation">'</span> : <span class="token punctuation">'</span>collapsed<span class="token punctuation">'</span> %<span class="token punctuation">></span> list-group-item category-item-action col s11 m11<span class="token punctuation">"</span></span>        <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heading-&lt;%<span class="token punctuation">=</span> cat._id %<span class="token punctuation">></span><span class="token punctuation">"</span></span>       <span class="token punctuation">></span></span>        &lt;%= cat.name %>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fas fa-chevron-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%<span class="token punctuation">=</span> url_for(cat.path) %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-count col s1 m1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fa fa-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>&lt;%= cat.posts.length %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">if</span> <span class="token attr-name">(subCats.length</span> <span class="token punctuation">></span></span> 0) { %>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-content collapsible-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">render_sub_categories(subCats,</span> <span class="token attr-name">cat,</span> <span class="token attr-name">depth</span> <span class="token attr-name">+</span> <span class="token attr-name">1)</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">else</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">render_posts(cat)</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">})</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">function</span> <span class="token attr-name">render_sub_categories(cats,</span> <span class="token attr-name">parent,</span> <span class="token attr-name">depth)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>collapsible expandable category-row<span class="token punctuation">"</span></span>  <span class="token attr-name">data-collapsible</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>expandable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">render_categories(cats,</span> <span class="token attr-name">depth)</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">function</span> <span class="token attr-name">render_posts(cat)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>collapse-&lt;%<span class="token punctuation">=</span> cat._id %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-content collapsible-body<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    &lt;% var limit = theme.category.list || 10 ; %>    &lt;% var posts = cat.posts.sort(config.index_generator.order_by || '-date') %>    &lt;% for (var idx = 0; idx &lt; posts.length; idx++) { %>      &lt;% var post = posts.data[idx] %>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">if</span> <span class="token attr-name">(idx</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">limit</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">idx</span> <span class="token punctuation">></span></span>= limit) { %>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%- url_for(cat.path) %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list-group-item list-group-item-action<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>More...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">break</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">else</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%- url_for(post.path) %<span class="token punctuation">></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span> list-group-item list-group-item-action<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&lt;%= post.title %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span> <span class="token attr-name">data-aos</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fade-up<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card  card-categories-list-spcail<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>categories-title center-align<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fas fa-bookmark<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span><span class="token entity" title="&nbsp;">&amp;nbsp;</span><span class="token entity" title="&nbsp;">&amp;nbsp;</span> æ–‡ç« å¤šçº§åˆ†ç±»        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card-content col s12  m12<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>  <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>card-list-zzy<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category-list collapsible expandable<span class="token punctuation">"</span></span>  <span class="token attr-name">data-collapsible</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>expandable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          &lt;% cats = site.categories.find({parent: {$exists: false}}).sort(orderBy).filter(cat => cat.length) %>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">render_categories(cats)</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.list-group-item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasClass</span><span class="token punctuation">(</span><span class="token string">'collapsed'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'collapsed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//$(this).parent().next().slideDown();</span>  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'collapsed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//$(this).parent().next().slideUp();</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.collapsible .expandable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> instance <span class="token operator">=</span> M<span class="token punctuation">.</span>Collapsible<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> <span class="token punctuation">{</span>  accordion<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>ç„¶ååœ¨ä¸»é¢˜é…ç½®ä¸­æ·»åŠ é…ç½®å‚æ•°ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">category</span><span class="token punctuation">:</span>  <span class="token key atrule">list</span><span class="token punctuation">:</span> <span class="token number">10  </span></code></pre><p>è¯¥å€¼è¡¨ç¤ºå¤šçº§åˆ†ç±»å±•å¼€æ—¶æ˜¾ç¤ºæœ€è¿‘çš„10ç¯‡æ–‡ç« åˆ—è¡¨ï¼Œ ä¸è®¾ç½®é»˜è®¤ä¼šæ˜¾ç¤º10ç¯‡ï¼Œä¿®æ”¹è¯¥å€¼å³å¯å®ç°è‡ªå®šä¹‰è®¾ç½®æ˜¾ç¤ºå¤šå°‘æ¡ã€‚</p><p>æ•ˆæœåœ¨æˆ‘çš„åˆ†ç±»é‡Œï¼Œè‡ªå·±çœ‹çœ‹å§~</p><p>  <code>category-list.ejs</code> ä¸­å¼•å…¥äº†å¦ä¸€ä¸ªç‰ˆæœ¬çš„js</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>å¦‚æœå»æ‰äº†è¿™ä¸ª js å¼•å…¥ï¼Œ é‚£ä¹ˆéœ€è¦æ”¾å¼€ js ä¸­æ³¨é‡Šäº†çš„ <code>$(this).parent().next().slideDown();</code> å’Œ <code>$(this).parent().next().slideUp();</code> , ç„¶åå°† <code>&lt;li  class=&quot;&lt;%= subCats.length &gt; 0 ? &#39;active&#39; : &#39;&#39; %&gt;&quot; &gt;</code> ä¿®æ”¹æˆ <code>&lt;li&gt;</code> ï¼Œåªæ˜¯æ•ˆæœç•¥æ˜¾ä¸åŒã€‚ å±•å¼€åä¸å†è‡ªåŠ¨æŠ˜å ã€‚ å¦‚æœä½ æ„¿æ„åŠ¨æ‰‹ï¼Œè‡ªå·±åŠ ä¸ªæŒ‰é’®ï¼Œ å¯ä»¥æä¸ªå…¨éƒ¨å±•å¼€çš„æŒ‰é’®ï¼Œ äº‹ä»¶çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><pre class=" language-html"><code class="language-html">function openOrClose(){    var disVal = $(".collapsible-body").css("display");    disVal =='none' ? $(".collapsible-body").css("display","block"); :$(".collapsible-body").css("display","none");}</code></pre><p>å…ˆå¤‡ä»½ï¼Œç„¶åå¤§èƒ†çš„æŠ˜è…¾ï¼Œå¤§èƒ†çš„æ”¹~</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo åšå®¢æ·»åŠ æ€ç»´å¯¼å›¾æ¸²æŸ“</title>
      <link href="/posts/5a2c12e2.html"/>
      <url>/posts/5a2c12e2.html</url>
      
        <content type="html"><![CDATA[<h2 id="Hexo-åšå®¢æ·»åŠ æ€ç»´å¯¼å›¾æ¸²æŸ“"><a href="#Hexo-åšå®¢æ·»åŠ æ€ç»´å¯¼å›¾æ¸²æŸ“" class="headerlink" title="Hexo åšå®¢æ·»åŠ æ€ç»´å¯¼å›¾æ¸²æŸ“"></a>Hexo åšå®¢æ·»åŠ æ€ç»´å¯¼å›¾æ¸²æŸ“</h2><p>ç†è®ºä¸Šæ˜¯ä¸åˆ†ä¸»é¢˜çš„ã€‚</p><p>ä½¿ç”¨è¿™ä¸ªæ˜¯å› ä¸ºç¾¤é‡Œçš„ä¸€ä½å°ä¼™ä¼´å¸Œæœ›æœ‰ä¸ªæ€ç»´å¯¼å›¾çš„åˆ†ç±»ã€‚ æˆ‘å°è¯•äº†ä¸€ä¸‹ï¼Œè¿™ä¸ªæ’ä»¶æ˜¯ markdown é¡µé¢æ¸²æŸ“æ”¯æŒï¼Œæ— æ³•ç›´æ¥æ”¾å…¥ ejs é¡µé¢æ¥å¾ªç¯åˆ†ç±»æ•°æ®ã€‚ è¿™ä¸ªåç»­å†ç ”ç©¶ç ”ç©¶ã€‚</p><p>è¿™ä¸ªæ’ä»¶æ˜¯å¤§ç¥ <code>HunterXuan</code> å®Œæˆçš„ <a href="https://github.com/HunterXuan/hexo-simple-mindmap" target="_blank" rel="noopener">hexo-simple-mindmap</a></p><h3 id="ä¸€ã€å®‰è£…æ’ä»¶ä¸ä½¿ç”¨"><a href="#ä¸€ã€å®‰è£…æ’ä»¶ä¸ä½¿ç”¨" class="headerlink" title="ä¸€ã€å®‰è£…æ’ä»¶ä¸ä½¿ç”¨"></a>ä¸€ã€å®‰è£…æ’ä»¶ä¸ä½¿ç”¨</h3><h4 id="1ã€å®‰è£…æ’ä»¶"><a href="#1ã€å®‰è£…æ’ä»¶" class="headerlink" title="1ã€å®‰è£…æ’ä»¶"></a>1ã€å®‰è£…æ’ä»¶</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-simple-mindmap</code></pre><h4 id="2ã€ç›´æ¥åœ¨æ–‡ç« ä¸­ä½¿ç”¨"><a href="#2ã€ç›´æ¥åœ¨æ–‡ç« ä¸­ä½¿ç”¨" class="headerlink" title="2ã€ç›´æ¥åœ¨æ–‡ç« ä¸­ä½¿ç”¨"></a>2ã€ç›´æ¥åœ¨æ–‡ç« ä¸­ä½¿ç”¨</h4><p>åœ¨ä½ çš„æ–‡ç« é¡µé¢ç›´æ¥ä½¿ç”¨å³å¯ï¼Œå®˜æ–¹ Demo :</p><pre><code>{% pullquote mindmap mindmap-md %}- [åœ¨ Hexo ä¸­ä½¿ç”¨æ€ç»´å¯¼å›¾](https://hunterx.xyz/use-mindmap-in-hexo.html)  - å‰è¨€  - æ“ä½œæŒ‡å—    - å‡†å¤‡éœ€è¦çš„æ–‡ä»¶    - ä¸ºä¸»é¢˜æ·»åŠ  CSS/JS æ–‡ä»¶  - ä½¿ç”¨æ–¹æ³•{% endpullquote %}</code></pre><p> æ•ˆæœå¦‚ä¸‹ï¼Œæœ‰ç”»å¸ƒï¼Œå¯ä»¥è‡ªç”±æ‹–æ‹½ã€‚</p><blockquote class="pullquote mindmap mindmap-md"><!-- build time:Sat Oct 03 2020 23:21:19 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><ul><li><a href="https://hunterx.xyz/use-mindmap-in-hexo.html" target="_blank" rel="noopener">åœ¨ Hexo ä¸­ä½¿ç”¨æ€ç»´å¯¼å›¾</a><ul><li>å‰è¨€</li><li>æ“ä½œæŒ‡å—<ul><li>å‡†å¤‡éœ€è¦çš„æ–‡ä»¶</li><li>ä¸ºä¸»é¢˜æ·»åŠ  CSS/JS æ–‡ä»¶</li></ul></li><li>ä½¿ç”¨æ–¹æ³•</li></ul></li></ul><!-- rebuild by neat --></blockquote><p>æä¸ªè‡ªå·±ä¾‹å­ï¼š</p><blockquote class="pullquote mindmap mindmap-md"><!-- build time:Sat Oct 03 2020 23:21:19 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><ul><li><a href="https://hut.zhangxiaocai.cn" target="_blank" rel="noopener">æˆ‘çš„å†™ä½œåšå®¢</a><ul><li>å…¬å­é’ºæ¡‰<ul><li>å¤è¯—è¯<ul><li>çƒŸç«äººé—´</li><li>æ¢¦</li></ul></li><li>ç¬¬ä¸ƒå¹´çš„æ¢¦<ul><li>ç¬¬ä¸ƒå¹´ä¹‹æ¢¦</li><li>æ¢¦é‡Œçš„æ•…äº‹</li></ul></li><li>ç™½è¯æ±Ÿæ¹–<ul><li>åŠŸåå„</li><li>åŒç”Ÿæ¢…</li><li>æ™“é£æ®‹æœˆ</li><li>æ‹ˆèŠ±ç›—</li></ul></li></ul></li><li>é—¨æ¸…<ul><li>äººé—´æ‚²å‰§<ul><li>åå…«å ¤</li><li>è¥¿å¡å¯º<ul><li>æœ›æ¡¥</li><li>å‘œå’½æ²³</li></ul></li></ul></li></ul></li></ul></li></ul><!-- rebuild by neat --></blockquote><h3 id="äºŒã€åˆ†ç±»æ€ç»´å¯¼å›¾"><a href="#äºŒã€åˆ†ç±»æ€ç»´å¯¼å›¾" class="headerlink" title="äºŒã€åˆ†ç±»æ€ç»´å¯¼å›¾"></a>äºŒã€åˆ†ç±»æ€ç»´å¯¼å›¾</h3><h4 id="1ã€ç›®å‰éœ€è¦è‡ªå·±æ‰‹å·¥ç»´æŠ¤"><a href="#1ã€ç›®å‰éœ€è¦è‡ªå·±æ‰‹å·¥ç»´æŠ¤" class="headerlink" title="1ã€ç›®å‰éœ€è¦è‡ªå·±æ‰‹å·¥ç»´æŠ¤"></a>1ã€ç›®å‰éœ€è¦è‡ªå·±æ‰‹å·¥ç»´æŠ¤</h4><p>è‡ªåŠ¨æ–¹å¼è¿˜åœ¨æ‘¸ç´¢ä¸­ã€‚å¦‚æœå«Œéº»çƒ¦å¯ä»¥è·³è¿‡ç¬¬äºŒéƒ¨åˆ†ã€‚</p><p>å¦‚æœä½ æƒ³ç”¨æ€ç»´å¯¼å›¾å±•ç¤ºï¼Œå¯ä»¥åœ¨ <code>/soure/categoties/index.md</code> ä¸­æŒ‰ä¸Šé¢çš„æ ¼å¼æ·»åŠ è‡ªå·±çš„åˆ†ç±»ã€‚</p><pre><code>{% pullquote mindmap mindmap-md %}- [å°èœè‹”åšå®¢](https://hut.zhangxiaocai.cn)  - Hexo  - Hexoç³»ç»Ÿ  - Materyä¸»é¢˜ç³»ç»Ÿ  - Materyå¸¸è§é—®é¢˜  - Hexoæ’ä»¶    - valine    - Valine-Admin    - å®¢æœä¸æ¨é€    - æ€ç»´å¯¼å›¾æ’ä»¶    - Java  - Jdk    - Jdk8 æ—¥æœŸæ—¶é—´API    - Jdk8 Optional API    - Jdk å˜åŒ–è¡¥å……å­¦ä¹     - å®šæ—¶ä»»åŠ¡      - Java Timer      - Spring Task      - Quartz    - Jvm      - å†…å­˜ç»“æ„      - GCå›æ”¶ç®—æ³•      - GCæ”¶é›†å™¨      - è°ƒè¯•å·¥å…·  - Mybatis    - ä¸»è¦ç»„ä»¶    - Mybatisé…ç½®    - åŠ¨æ€SQL    - å·¥ä½œåŸç†    - Mapperæ˜ å°„å™¨    - Mapperçº§è”    - Mybatisæ¨¡ç³ŠæŸ¥è¯¢   - æ•°æ®åº“  - SQL    - SQLæŸ¥è¯¢å‰Næ¡çº§è”    - SQLæ¨¡ç³ŠæŸ¥è¯¢     - SQLåˆ†é¡µNç§ç©æ³•  - DB2      - DB2å¸¸ç”¨å‘½ä»¤      - DB2å¸¸è§é”™è¯¯ç     - DB2å¸¸ç”¨å‡½æ•°   - Mysql    - Mysqlå¸¸ç”¨å‘½ä»¤    - Mysqlç™»å½•å¼‚å¸¸{% endpullquote %}</code></pre><h4 id="2ã€æ–°å»º-category-mindmap-ejs"><a href="#2ã€æ–°å»º-category-mindmap-ejs" class="headerlink" title="2ã€æ–°å»º category-mindmap.ejs"></a>2ã€æ–°å»º category-mindmap.ejs</h4><p>åœ¨ä¸»é¢˜ç›®å½• <code>/layout/_widget/</code>ç›®å½•ä¸‹æ–°å»º <code>category-mindmap.ejs</code> æ–‡ä»¶ã€‚ å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code>&lt;div class=&quot;container&quot; data-aos=&quot;fade-up&quot;&gt;    &lt;div class=&quot;card&quot;&gt;        &lt;div id=&quot;category-map&quot; class=&quot;card-content&quot;&gt;    &lt;%- page.content %&gt;    &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt; </code></pre><h4 id="2ã€å¼•å…¥æ”¯æŒ"><a href="#2ã€å¼•å…¥æ”¯æŒ" class="headerlink" title="2ã€å¼•å…¥æ”¯æŒ"></a>2ã€å¼•å…¥æ”¯æŒ</h4><p>æ‰¾åˆ°ä¸»é¢˜ç›®å½•ä¸‹ <code>/layout/mindmap.ejs</code> , æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><pre><code> &lt;%- partial(&#39;_widget/category-mindmap&#39;) %&gt;</code></pre><p>åŠ äº†ä¹‹åï¼Œå¤§æ¦‚æ˜¯è¿™æ ·å­ï¼š</p><pre><code>&lt;%- partial(&#39;_partial/bg-cover&#39;) %&gt;&lt;main class=&quot;content&quot;&gt;    &lt;%- partial(&#39;_widget/category-cloud&#39;) %&gt;    &lt;% if (site.categories &amp;&amp; site.categories.length &gt; 0) { %&gt;    &lt;%- partial(&#39;_widget/category-radar&#39;) %&gt;    &lt;% } %&gt;    &lt;%- partial(&#39;_widget/category-mindmap&#39;) %&gt;&lt;/main&gt;</code></pre><p>å¦‚æœä½ ä½¿ç”¨äº†å¤šçº§åˆ†ç±»ï¼ŒåŠ äº†ä¹‹åï¼Œå¤§æ¦‚æ˜¯è¿™æ ·å­ï¼š</p><pre><code>&lt;%- partial(&#39;_partial/bg-cover&#39;) %&gt;&lt;main class=&quot;content&quot;&gt;    &lt;%- partial(&#39;_widget/category-cloud&#39;) %&gt;    &lt;% if (site.categories &amp;&amp; site.categories.length &gt; 0) { %&gt;    &lt;%- partial(&#39;_widget/category-radar&#39;) %&gt;    &lt;% } %&gt;    &lt;%- partial(&#39;_widget/category-list&#39;) %&gt;    &lt;%- partial(&#39;_widget/category-mindmap&#39;) %&gt;&lt;/main&gt;</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®šæ—¶ä»»åŠ¡ä¹‹Quartz</title>
      <link href="/posts/6ddb3c14.html"/>
      <url>/posts/6ddb3c14.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦è®°å½•å­¦ä¹ Quartzçš„ç›¸å…³å†…å®¹ã€‚<br>  æ•´ç†äº2020-06-25ï¼Œæœ€åæ›´æ–°2020-07-18ã€‚</p></blockquote><h3 id="ä¸€ã€Quartzç®€è¿°"><a href="#ä¸€ã€Quartzç®€è¿°" class="headerlink" title="ä¸€ã€Quartzç®€è¿°"></a>ä¸€ã€Quartzç®€è¿°</h3><p>å…³äºè°ƒåº¦çš„å®ç°æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼š</p><p>ï¼ˆ1ï¼‰Javaè‡ªå¸¦çš„Apiæœ‰ä¸ªTimerç±»å’ŒTimerTaskç±»ã€‚</p><p>ï¼ˆ2ï¼‰Springè‡ªå¸¦çš„Spring Taskè°ƒåº¦å·¥å…·ã€‚</p><p>ï¼ˆ3ï¼‰Quartzï¼ˆè¯»é˜”å­ï¼‰å¼€æºæ¡†æ¶ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä½¿ç”¨èµ·æ¥ç¨æ˜¾å¤æ‚ã€‚</p><blockquote><p>Quartzæ˜¯ä¸€ä¸ªå®Œå…¨ç”±javaç¼–å†™çš„å¼€æºä½œä¸šè°ƒåº¦æ¡†æ¶ï¼Œç”±OpenSymphonyç»„ç»‡å¼€æºå‡ºæ¥ã€‚ä½œä¸šè°ƒåº¦å…¶å®å°±æ˜¯æŒ‰ç…§ç¨‹åºçš„è®¾å®šï¼Œæ ¹æ®å®šä¹‰çš„æ‰§è¡Œæ—¶é—´é¢‘æ¬¡è¡¨è¾¾å»æ‰§è¡ŒæŸä¸ªä½œä¸šä»»åŠ¡ã€‚</p></blockquote><p>ä¹‹å‰è¯´è¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„åŸºæœ¬ç»„ä»¶æœ‰ï¼šæ‰§è¡Œçš„ä»»åŠ¡ç±»ã€è§¦å‘ä»»åŠ¡çš„è§¦å‘å™¨ã€ç®¡ç†ä»»åŠ¡çš„ä»»åŠ¡è°ƒåº¦å™¨ã€‚</p><p>é‚£ä¹ˆQuartzåŒæ ·æœ‰è¿™ä¸‰ä¸ªåŸºæœ¬çš„ç»„ä»¶ï¼Œä½†æ˜¯é™¤æ­¤ä¹‹å¤–è¿˜æœ‰æ›´ä¸°å¯Œçš„ç»„ä»¶ã€‚åœ¨<code>Quartz-2.0</code>ä¹‹åå¢åŠ äº†æ„é€ å™¨æ¨¡å¼åˆ›å»ºç¤ºä¾‹ï¼Œç›‘å¬å™¨çš„é›†ä¸­ç®¡ç†æ¥å£ç­‰å†…å®¹ï¼Œæ‰€ä»¥æœ‰äº›åœ°æ–¹åœ¨å†™æ³•ä¸Šç¨æœ‰ä¸åŒã€‚</p><h3 id="äºŒã€Quartzçš„åŸºæœ¬ç»„ä»¶"><a href="#äºŒã€Quartzçš„åŸºæœ¬ç»„ä»¶" class="headerlink" title="äºŒã€Quartzçš„åŸºæœ¬ç»„ä»¶"></a>äºŒã€Quartzçš„åŸºæœ¬ç»„ä»¶</h3><h4 id="1ã€Schedulerè°ƒåº¦å™¨"><a href="#1ã€Schedulerè°ƒåº¦å™¨" class="headerlink" title="1ã€Schedulerè°ƒåº¦å™¨"></a>1ã€Schedulerè°ƒåº¦å™¨</h4><p><code>Scheduler</code>åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦å®ä¾‹åŒ–ã€‚ä¸€èˆ¬é€šè¿‡è°ƒåº¦å·¥å‚<code>SchedulerFactory</code>æ¥åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//å¾—åˆ°ä¸€ä¸ªé»˜è®¤çš„è°ƒåº¦å·¥å‚</span>SchedulerFactory schedulerFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StdSchedulerFactory</span>Scheduler sched <span class="token operator">=</span> schedFact<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>scheduler</code>å®ä¾‹åŒ–åï¼Œå¯ä»¥å¯åŠ¨(start)ã€æš‚åœ(stand-by)ã€åœæ­¢(shutdown)ã€è¿˜å¯ä»¥è®¾ç½®è‡ªå®šä¹‰ç›¸å…³ç›‘å¬ã€‚</p><p>ã€æ³¨æ„ï¼Œæ­¤å¤„åªæ˜¯åˆ—å‡ºä¸€äº›å¸¸è§æ–¹æ³•ï¼Œå®é™…ä½¿ç”¨å…ˆåé¡ºåºã€‘</p><pre class=" language-java"><code class="language-java">scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> simpleTrigger<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ·»åŠ è°ƒåº¦ä»»åŠ¡</span>scheduler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//å¯åŠ¨</span>scheduler<span class="token punctuation">.</span><span class="token function">standby</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æš‚åœ</span>scheduler<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å…³é—­</span>scheduler<span class="token punctuation">.</span><span class="token function">addJobListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ·»åŠ è‡ªå®šä¹‰ä»»åŠ¡æ‰§è¡Œç›‘å¬</span>scheduler<span class="token punctuation">.</span><span class="token function">addTriggerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpTriggerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ·»åŠ è‡ªå®šä¹‰è§¦å‘å™¨ç›‘å¬</span>scheduler<span class="token punctuation">.</span><span class="token function">addSchedulerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpSchedulerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ·»åŠ è‡ªå®šä¹‰è°ƒåº¦å™¨ç›‘å¬</span></code></pre><p>â€‹    éœ€è¦æ³¨æ„çš„æ˜¯ï¼šschedulerè¢«åœæ­¢åï¼Œé™¤éé‡æ–°å®ä¾‹åŒ–ï¼Œå¦åˆ™ä¸èƒ½é‡æ–°å¯åŠ¨ï¼›åªæœ‰å½“schedulerå¯åŠ¨åï¼Œå³ä½¿å¤„äºæš‚åœçŠ¶æ€ä¹Ÿä¸è¡Œï¼Œtriggeræ‰ä¼šè¢«è§¦å‘ï¼ˆjobæ‰èƒ½è¢«æ‰§è¡Œï¼‰ã€‚</p><p>â€‹       Quartz-2.0ä¹‹åçš„ç›‘å¬å™¨è°ƒæ•´ä¸ºä½¿ç”¨ç›‘å¬ç®¡ç†çš„<code>ListenerManager</code>æ¥å£è¿›è¡Œé›†ä¸­ç®¡ç†çš„ã€‚ä½¿ç”¨æ·»åŠ æˆ–ç§»é™¤éƒ½éœ€è¦å…ˆæ‹¿åˆ°<code>ListenerManager</code>ä¹‹åå†è¿›è¡Œæ“ä½œï¼Œåé¢ä¼šæœ‰å…·ä½“ç¤ºä¾‹ã€‚</p><h4 id="2ã€Jobä½œä¸šæ¥å£"><a href="#2ã€Jobä½œä¸šæ¥å£" class="headerlink" title="2ã€Jobä½œä¸šæ¥å£"></a>2ã€Jobä½œä¸šæ¥å£</h4><p>Jobæ¥å£åªæœ‰ä¸€ä¸ªexecuteæ–¹æ³•ï¼Œç±»ä¼¼çº¿ç¨‹çš„runæ–¹æ³•ï¼Œç”¨æ¥æ‰§è¡Œä¸šåŠ¡ä½œä¸šé€»è¾‘ã€‚</p><p>ä¸šåŠ¡ä½œä¸šå®ç°äº†Jobæ¥å£ä¹‹åå°±å¯ä»¥ç”±è°ƒåº¦å™¨Scheduleè¿›è¡Œç®¡ç†æ‰§è¡Œã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>job<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>Job<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobDataMap<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobExecutionContext<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobExecutionException<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span> <span class="token keyword">throws</span> JobExecutionException <span class="token punctuation">{</span>        JobDataMap dataMap <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" job executed "</span> <span class="token operator">+</span> dataMap<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="3ã€JobDetailä½œä¸šå®ä¾‹"><a href="#3ã€JobDetailä½œä¸šå®ä¾‹" class="headerlink" title="3ã€JobDetailä½œä¸šå®ä¾‹"></a>3ã€JobDetailä½œä¸šå®ä¾‹</h4><p><code>JobDetail</code>ç”¨äºå®šä¹‰ä½œä¸šçš„å®ä¾‹ï¼ˆJobå®ä¾‹ï¼‰ï¼Œä¸ºJobå®ä¾‹æä¾›å±æ€§è®¾ç½®ï¼Œç”¨æ¥å­˜å‚¨ç‰¹å®šJobå®ä¾‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œè°ƒåº¦å™¨Scheduleéœ€è¦å€ŸåŠ©<code>JobDetail</code>å¯¹è±¡æ¥æ·»åŠ Jobå®ä¾‹ã€‚</p><p><code>JobDetail</code>çš„é‡è¦å±æ€§æœ‰ï¼š</p><p>â€‹    <code>name</code>â€”- ä»»åŠ¡åç§°</p><p>â€‹    <code>group</code> â€”- ä»»åŠ¡æ‰€åœ¨ç»„åç§°</p><p>â€‹    <code>jobClass</code> â€”- ä»»åŠ¡æ‰§è¡Œç±»ï¼Œä¹Ÿå°±æ˜¯å®ç°äº†<code>Job</code>æ¥å£çš„ä¸šåŠ¡ä½œä¸šç±»ã€‚</p><p>â€‹    <code>jobDataMap</code> â€”- ä»»åŠ¡çš„çŠ¶æ€æ•°æ®ï¼Œå…¶å®å°±æ˜¯ä¸€äº›ç›¸å…³å‚æ•°ï¼Œå¯ä»¥åŠ¨æ€ä¼ å…¥ã€‚</p><pre class=" language-java"><code class="language-java">Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>Srting<span class="token punctuation">,</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>JobDetail JobDetail <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JobDetail</span><span class="token punctuation">(</span>jobName<span class="token punctuation">,</span> jobGroupName<span class="token punctuation">,</span> jobClass<span class="token punctuation">)</span><span class="token punctuation">;</span>JobDetail<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è¯¥æ•°æ®å¯ä»¥é€šè¿‡Jobä¸­çš„JobDataMap dataMap = context.getJobDetail().getJobDataMap();æ¥è¿›è¡Œå‚æ•°ä¼ é€’å€¼</span></code></pre><h4 id="4ã€Triggerè§¦å‘å™¨"><a href="#4ã€Triggerè§¦å‘å™¨" class="headerlink" title="4ã€Triggerè§¦å‘å™¨"></a>4ã€Triggerè§¦å‘å™¨</h4><p>Triggeræ˜¯ç”¨æ¥å®šä¹‰æ‰§è¡Œä¸šåŠ¡ä½œä¸šçš„è®¡åˆ’ç»„ä»¶ã€‚</p><p>Triggerçš„ç±»å‹ä¸»è¦æœ‰4ç§ï¼š</p><p>â€‹    ï¼ˆ1ï¼‰<code>SimpleTrigger</code>ï¼šä»æŸä¸€ä¸ªæ—¶é—´å¼€å§‹ï¼Œä»¥ä¸€å®šçš„æ—¶é—´é—´éš”æ¥æ‰§è¡Œä»»åŠ¡ã€‚å®ƒä¸»è¦æœ‰ä¸¤ä¸ªå±æ€§ï¼Œ<code>repeatInterval</code> é‡å¤çš„æ—¶é—´é—´éš”ï¼›<code>repeatCount</code> é‡å¤çš„æ¬¡æ•°ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ¬¡æ•°æ˜¯n+1,å› ä¸ºåœ¨<code>startTime</code>çš„æ—¶å€™ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p><p>â€‹    ï¼ˆ2ï¼‰ <code>CronTrigger</code>ï¼šé€‚åˆäºå¤æ‚çš„ä»»åŠ¡ï¼Œä½¿ç”¨<code>cron</code>è¡¨è¾¾å¼æ¥å®šä¹‰æ‰§è¡Œè§„åˆ™ã€‚</p><p>â€‹    ï¼ˆ3ï¼‰<code>CalendarIntervalTrigger</code>ï¼šç±»ä¼¼äº<code>SimpleTrigger</code>ï¼ŒæŒ‡å®šä»æŸä¸€ä¸ªæ—¶é—´å¼€å§‹ï¼Œä»¥ä¸€å®šçš„æ—¶é—´é—´éš”æ‰§è¡Œçš„ä»»åŠ¡ã€‚ä½†æ˜¯<code>CalendarIntervalTrigger</code>æ‰§è¡Œä»»åŠ¡çš„æ—¶é—´é—´éš”æ¯”<code>SimpleTrigger</code>è¦ä¸°å¯Œï¼Œå®ƒæ”¯æŒçš„é—´éš”å•ä½æœ‰ç§’ï¼Œåˆ†é’Ÿï¼Œå°æ—¶ï¼Œå¤©ï¼Œæœˆï¼Œå¹´ï¼Œæ˜ŸæœŸã€‚å®ƒçš„ä¸»è¦ä¸¤ä¸ªå±æ€§ï¼Œ<code>interval</code>æ‰§è¡Œé—´éš”ï¼›<code>intervalUnit</code>æ‰§è¡Œé—´éš”çš„å•ä½ï¼ˆç§’ï¼Œåˆ†é’Ÿï¼Œå°æ—¶ï¼Œå¤©ï¼Œæœˆï¼Œå¹´ï¼Œæ˜ŸæœŸï¼‰</p><p>ç›¸è¾ƒäº<code>SimpleTrigger</code>æœ‰ä¸¤ä¸ªä¼˜åŠ¿ï¼š</p><p>1ã€æ›´æ–¹ä¾¿ï¼Œæ¯”å¦‚æ¯éš”1å°æ—¶æ‰§è¡Œï¼Œä¸ç”¨è‡ªå·±å»è®¡ç®—1å°æ—¶ç­‰äºå¤šå°‘æ¯«ç§’ã€‚<br>2ã€æ”¯æŒä¸æ˜¯å›ºå®šé•¿åº¦çš„é—´éš”ï¼Œæ¯”å¦‚é—´éš”ä¸ºæœˆå’Œå¹´ã€‚ä½†åŠ£åŠ¿æ˜¯ç²¾åº¦åªèƒ½åˆ°ç§’ã€‚</p><p>â€‹    ï¼ˆ4ï¼‰<code>DailyTimeIntervalTrigger</code>ï¼šæŒ‡å®šæ¯å¤©çš„æŸä¸ªæ—¶é—´æ®µå†…ï¼Œä»¥ä¸€å®šçš„æ—¶é—´é—´éš”æ‰§è¡Œä»»åŠ¡ã€‚å¹¶ä¸”å®ƒå¯ä»¥æ”¯æŒæŒ‡å®šæ˜ŸæœŸã€‚</p><p>å®ƒé€‚åˆçš„ä»»åŠ¡ç±»ä¼¼äºï¼šæŒ‡å®šæ¯å¤©9:00 è‡³ 18:00ï¼Œæ¯éš”70ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”åªè¦å‘¨ä¸€è‡³å‘¨äº”æ‰§è¡Œã€‚</p><p>å®ƒçš„å±æ€§æœ‰<code>startTimeOfDay</code>æ¯å¤©å¼€å§‹æ—¶é—´ï¼›<code>endTimeOfDay</code>æ¯å¤©ç»“æŸæ—¶é—´ï¼›<code>daysOfWeek</code>éœ€è¦æ‰§è¡Œçš„æ˜ŸæœŸï¼›<code>interval</code> æ‰§è¡Œé—´éš”ï¼›<code>intervalUnit</code>æ‰§è¡Œé—´éš”çš„å•ä½ï¼ˆç§’ï¼Œåˆ†é’Ÿï¼Œå°æ—¶ï¼Œå¤©ï¼Œæœˆï¼Œå¹´ï¼Œæ˜ŸæœŸï¼‰ï¼›<code>repeatCount</code>é‡å¤æ¬¡æ•°</p><p>Triggerå…¬å…±å±æ€§ä¸»è¦æœ‰ï¼š</p><p><code>jobKey</code>å±æ€§ï¼Œå½“è§¦å‘å™¨è§¦å‘æ—¶è¢«æ‰§è¡Œçš„jobå®šä½ï¼›</p><p><code>startTime</code>å±æ€§ï¼šè®¾ç½®Triggerç¬¬ä¸€æ¬¡è§¦å‘çš„æ—¶é—´ï¼›</p><p><code>endTime</code>å±æ€§ï¼šè¡¨ç¤ºTriggerå¤±æ•ˆçš„æ—¶é—´ç‚¹ã€‚</p><p>ä¼˜å…ˆçº§(priority)ã€é”™è¿‡è§¦å‘(misfire)ã€æ—¥å†(calendar)ç­‰</p><p>â€‹    ä¼˜å…ˆçº§ï¼ˆpriorityï¼‰</p><blockquote><p>Quartzçº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹å¤ªå°‘æˆ–è€…è§¦å‘å™¨è¾ƒå¤šæ—¶ï¼ŒQuartzå¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºåŒæ—¶è§¦å‘æ‰€æœ‰çš„triggerï¼›è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¸Œæœ›æ§åˆ¶å“ªäº›triggerä¼˜å…ˆä½¿ç”¨Quartzçš„å·¥ä½œçº¿ç¨‹ï¼Œè¦è¾¾åˆ°è¯¥ç›®çš„ï¼Œå¯ä»¥åœ¨triggerä¸Šè®¾ç½®priorityå±æ€§ã€‚</p><p>æ³¨æ„ï¼šåªæœ‰åŒæ—¶è§¦å‘çš„triggerä¹‹é—´æ‰ä¼šæ¯”è¾ƒä¼˜å…ˆçº§ã€‚æ¯”å¦‚ï¼š11:59è§¦å‘çš„triggeræ€»æ˜¯åœ¨12:00è§¦å‘çš„triggerä¹‹å‰æ‰§è¡Œã€‚</p><p>æ³¨æ„ï¼šå¦‚æœtriggeræ˜¯å¯æ¢å¤çš„ï¼Œåœ¨æ¢å¤åå†è°ƒåº¦æ—¶ï¼Œä¼˜å…ˆçº§ä¸åŸtriggeræ˜¯ä¸€æ ·çš„ã€‚</p></blockquote><pre class=" language-java"><code class="language-java">SimpleTrigger simpleTrigger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleTrigger</span><span class="token punctuation">(</span>triggerName<span class="token punctuation">,</span> triggerGroupName<span class="token punctuation">)</span><span class="token punctuation">;</span>simpleTrigger<span class="token punctuation">.</span><span class="token function">setStartTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// set the interval, how often the job should run (10 seconds here) </span>simpleTrigger<span class="token punctuation">.</span><span class="token function">setRepeatInterval</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ‰§è¡Œé—´éš”æ¯«ç§’</span>simpleTrigger<span class="token punctuation">.</span><span class="token function">setRepeatCount</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//é‡å¤æ‰§è¡Œæ¬¡æ•°ï¼ˆä¸å«ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼‰</span><span class="token comment" spellcheck="true">//ç»“æŸæ—¶é—´</span>simpleTrigger<span class="token punctuation">.</span><span class="token function">setEndTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>ctime <span class="token operator">+</span> 60000L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è®¾ç½®è§¦å‘å™¨çš„ä¼˜å…ˆçº§ é»˜è®¤æ˜¯ 5</span>simpleTrigger<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>â€‹    é”™è¿‡è§¦å‘ï¼ˆmisfireï¼‰</p><blockquote><p>å¦‚æœschedulerå…³é—­äº†ï¼ˆç³»ç»Ÿå´©æºƒï¼‰ï¼Œæˆ–è€…Quartzçº¿ç¨‹æ± ä¸­æ²¡æœ‰å¯ç”¨çš„çº¿ç¨‹æ¥æ‰§è¡Œjobï¼ˆä»»åŠ¡æ—¶é—´è¿‡é•¿ï¼‰ï¼Œæ­¤æ—¶æŒä¹…æ€§çš„triggerå°±ä¼šé”™è¿‡(miss)å…¶è§¦å‘æ—¶é—´ï¼Œå³é”™è¿‡è§¦å‘(misfire)ã€‚</p><p>ä¸åŒç±»å‹çš„triggerï¼Œæœ‰ä¸åŒçš„misfireæœºåˆ¶ã€‚å®ƒä»¬é»˜è®¤éƒ½ä½¿ç”¨â€œæ™ºèƒ½æœºåˆ¶(smart policy)â€ï¼Œå³æ ¹æ®triggerçš„ç±»å‹å’Œé…ç½®åŠ¨æ€è°ƒæ•´è¡Œä¸ºã€‚å½“schedulerå¯åŠ¨çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ‰€æœ‰é”™è¿‡è§¦å‘(misfire)çš„æŒä¹…æ€§triggerã€‚ç„¶åæ ¹æ®å®ƒä»¬å„è‡ªçš„misfireæœºåˆ¶æ›´æ–°triggerçš„ä¿¡æ¯ã€‚</p></blockquote><p>â€‹    æ—¥å†ï¼ˆCalendarï¼‰</p><blockquote><p>Quartzçš„<code>org.quartz.Calendar</code>å¯¹è±¡(ä¸æ˜¯<code>java.util.Calendar</code>å¯¹è±¡)å¯ä»¥åœ¨å®šä¹‰å’Œå­˜å‚¨triggerçš„æ—¶å€™ä¸triggerè¿›è¡Œå…³è”ã€‚Calendarç”¨äºä»triggerçš„è°ƒåº¦è®¡åˆ’ä¸­æ’é™¤æ—¶é—´æ®µã€‚æ¯”å¦‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªtriggerï¼Œæ¯ä¸ªå·¥ä½œæ—¥çš„ä¸Šåˆ9:30æ‰§è¡Œï¼Œç„¶åå¢åŠ ä¸€ä¸ªCalendarï¼Œæ’é™¤æ‰æ‰€æœ‰èŠ‚å‡æ—¥ã€‚</p><p>ä»»ä½•å®ç°äº†Calendaræ¥å£çš„å¯åºåˆ—åŒ–å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºCalendarå¯¹è±¡ã€‚ä¸€ä¸ªTriggerå¯ä»¥å’Œå¤šä¸ªCalendarå…³è”ï¼Œä»¥ä¾¿æ’é™¤æˆ–åŒ…å«æŸäº›æ—¶é—´ç‚¹ã€‚</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Calendar</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//å‚æ•°æ˜¯æ¯«ç§’å•ä½çš„æ—¶é—´æˆ³</span>  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isTimeIncluded</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeStamp<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getNextIncludedTime</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeStamp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>Quartzæä¾›çš„<code>org.quartz.impl.HolidayCalendar</code>ç±»å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç°æ’é™¤æ•´ä¸ªæ—¥æœŸã€‚</p><pre class=" language-java"><code class="language-java">HolidayCalendar cal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HolidayCalendar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cal<span class="token punctuation">.</span><span class="token function">addExcludedDate</span><span class="token punctuation">(</span> someDate <span class="token punctuation">)</span><span class="token punctuation">;</span>cal<span class="token punctuation">.</span><span class="token function">addExcludedDate</span><span class="token punctuation">(</span> someOtherDate <span class="token punctuation">)</span><span class="token punctuation">;</span>scheduler<span class="token punctuation">.</span><span class="token function">addCalendar</span><span class="token punctuation">(</span><span class="token string">"myHolidaysName"</span><span class="token punctuation">,</span> cal<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Trigger t <span class="token operator">=</span> <span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"myTriggerName"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span><span class="token string">"myJobName"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">dailyAtHourAndMinute</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// execute job daily at 9:30</span>    <span class="token punctuation">.</span><span class="token function">modifiedByCalendar</span><span class="token punctuation">(</span><span class="token string">"myHolidaysName"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// but not on holidays</span>    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åªè¦çš„æ—¥å†ç±»æœ‰ï¼š</p><table><thead><tr><th>æ—¥å†ç±»</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>HolidayCalendar</td><td>æŒ‡å®šç‰¹å®šçš„æ—¥æœŸï¼Œæ¯”å¦‚20200613ã€‚ç²¾åº¦åˆ°å¤©ã€‚</td></tr><tr><td>DailyCalendar</td><td>æŒ‡å®šæ¯å¤©çš„æ—¶é—´æ®µï¼ˆrangeStartingTime, rangeEndingTime)ï¼Œæ ¼å¼æ˜¯HH:MM[:SS[:mmm]]ã€‚ä¹Ÿå°±æ˜¯æœ€å¤§ç²¾åº¦å¯ä»¥åˆ°æ¯«ç§’ã€‚</td></tr><tr><td>WeeklyCalendar</td><td>æŒ‡å®šæ¯æ˜ŸæœŸçš„æ˜ŸæœŸå‡ ï¼Œå¯é€‰å€¼æ¯”å¦‚ä¸ºjava.util.Calendar.SUNDAYã€‚ç²¾åº¦æ˜¯å¤©ã€‚</td></tr><tr><td>MonthlyCalendar</td><td>æŒ‡å®šæ¯æœˆçš„å‡ å·ã€‚å¯é€‰å€¼ä¸º1-31ã€‚ç²¾åº¦æ˜¯å¤©</td></tr><tr><td>AnnualCalendar</td><td>æŒ‡å®šæ¯å¹´çš„å“ªä¸€å¤©ã€‚ä½¿ç”¨æ–¹å¼å¦‚ä¸Šä¾‹ã€‚ç²¾åº¦æ˜¯å¤©ã€‚</td></tr><tr><td>CronCalendar</td><td>æŒ‡å®š<code>Cron</code>è¡¨è¾¾å¼ã€‚ç²¾åº¦å–å†³äº<code>Cron</code>è¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§ç²¾åº¦å¯ä»¥åˆ°ç§’ã€‚</td></tr></tbody></table><h4 id="5ã€JobBuilderæ„é€ å™¨"><a href="#5ã€JobBuilderæ„é€ å™¨" class="headerlink" title="5ã€JobBuilderæ„é€ å™¨"></a>5ã€JobBuilderæ„é€ å™¨</h4><p>[æ³¨æ„ï¼šç‰ˆæœ¬è¾ƒä½çš„å¯èƒ½æ²¡æœ‰æ„é€ å™¨æ–¹å¼ï¼Œå³å¯èƒ½æ²¡æœ‰<code>JobBuilder</code>ã€<code>TriggerBuilder</code>ç­‰Builderæ¨¡å¼]</p><p><code>JobBuilder</code>ä¹Ÿæ˜¯ç”¨äºå®šä¹‰/æ„å»º<code>JobDetail</code>å®ä¾‹ï¼Œå®šä¹‰ä½œä¸šçš„å®ä¾‹ã€‚<code>JobBuilder</code>çš„å±æ€§å’Œ<code>JobDetail</code>çš„å±æ€§åŸºæœ¬ä¸€è‡´ï¼Œè¿™æ ·å¾—ä»¥åœ¨build()æ–¹æ³•é‡Œé¢ï¼Œå®Œæˆå¯¹<code>JobDetail</code>è¿›è¡Œåˆ›å»ºã€‚æ˜¯ä¸€ä¸ªæ„é€ å™¨é£æ ¼çš„APIã€‚</p><pre class=" language-java"><code class="language-java">JobDetail job <span class="token operator">=</span> <span class="token function">newJob</span><span class="token punctuation">(</span>MyJob<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"myJob"</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Trigger trigger <span class="token operator">=</span> <span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token function">triggerKey</span><span class="token punctuation">(</span><span class="token string">"myTrigger"</span><span class="token punctuation">,</span> <span class="token string">"myTriggerGroup"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">withIntervalInHours</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> MINUTES<span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="6ã€TriggerBuilderæ„é€ å™¨"><a href="#6ã€TriggerBuilderæ„é€ å™¨" class="headerlink" title="6ã€TriggerBuilderæ„é€ å™¨"></a>6ã€TriggerBuilderæ„é€ å™¨</h4><p><code>TriggerBuilder</code>  ç”¨äºå®šä¹‰/æ„å»ºè§¦å‘å™¨å®ä¾‹ã€‚æ˜¯ä¸€ä¸ªæ„é€ å™¨é£æ ¼çš„APIã€‚</p><pre class=" language-java"><code class="language-java">JobDetail job <span class="token operator">=</span> <span class="token function">newJob</span><span class="token punctuation">(</span>TestJob<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"myJob"</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Trigger trigger <span class="token operator">=</span> <span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token function">triggerKey</span><span class="token punctuation">(</span><span class="token string">"myTrigger"</span><span class="token punctuation">,</span> <span class="token string">"myTriggerGroup"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">withIntervalInHours</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> MINUTES<span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="ä¸‰ã€è§¦å‘å™¨ä½¿ç”¨"><a href="#ä¸‰ã€è§¦å‘å™¨ä½¿ç”¨" class="headerlink" title="ä¸‰ã€è§¦å‘å™¨ä½¿ç”¨"></a>ä¸‰ã€è§¦å‘å™¨ä½¿ç”¨</h3><p>â€‹    å‰é¢å­¦ä¹ äº†ä¸åŒçš„Triggerï¼Œå¸¸ç”¨2ç§æ˜¯ï¼š<code>SimpleTrigger</code>å’Œ <code>CronTrigger</code>ã€‚</p><h4 id="1ã€SimpleTrigger"><a href="#1ã€SimpleTrigger" class="headerlink" title="1ã€SimpleTrigger"></a>1ã€SimpleTrigger</h4><p>ç®€æ˜“è§¦å‘å™¨çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼šåœ¨å…·ä½“çš„æ—¶é—´ç‚¹æ‰§è¡Œä¸€æ¬¡ï¼Œæˆ–è€…åœ¨å…·ä½“çš„æ—¶é—´ç‚¹æ‰§è¡Œå¹¶ä¸”ä»¥æŒ‡å®šçš„é—´éš”é‡å¤æ‰§è¡Œè‹¥å¹²æ¬¡ã€‚</p><p><code>SimpleTrigger</code>çš„å±æ€§åŒ…æ‹¬ï¼šå¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ã€é‡å¤æ¬¡æ•°ä»¥åŠé‡å¤çš„é—´éš”ã€‚</p><p>é‡å¤æ¬¡æ•°ï¼Œå¯ä»¥æ˜¯0ã€æ­£æ•´æ•°ï¼Œä»¥åŠå¸¸é‡<code>SimpleTrigger.REPEAT_INDEFINITELY</code>ã€‚</p><p>é‡å¤çš„é—´éš”ï¼Œå¿…é¡»æ˜¯0ï¼Œæˆ–è€…longå‹çš„æ­£æ•°ï¼Œè¡¨ç¤ºæ¯«ç§’ã€‚æ³¨æ„:ï¼Œå¦‚æœé‡å¤é—´éš”ä¸º0ï¼Œtriggerå°†ä¼šä»¥é‡å¤æ¬¡æ•°å¹¶å‘æ‰§è¡Œ(æˆ–è€…ä»¥schedulerå¯ä»¥å¤„ç†çš„è¿‘ä¼¼å¹¶å‘æ•°)ã€‚</p><p>endTimeå±æ€§çš„å€¼ä¼šè¦†ç›–è®¾ç½®é‡å¤æ¬¡æ•°çš„å±æ€§å€¼ï¼›æ¯”å¦‚ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªtriggerï¼Œåœ¨ç»ˆæ­¢æ—¶é—´ä¹‹å‰æ¯éš”10ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œä½ ä¸éœ€è¦å»è®¡ç®—åœ¨å¼€å§‹æ—¶é—´å’Œç»ˆæ­¢æ—¶é—´ä¹‹é—´çš„é‡å¤æ¬¡æ•°ï¼Œåªéœ€è¦è®¾ç½®ç»ˆæ­¢æ—¶é—´å¹¶å°†é‡å¤æ¬¡æ•°è®¾ç½®ä¸ºREPEAT_INDEFINITELY(å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å°†é‡å¤æ¬¡æ•°è®¾ç½®ä¸ºä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œå¹¶ä¿è¯è¯¥å€¼æ¯”triggeråœ¨ç»ˆæ­¢æ—¶é—´ä¹‹å‰å®é™…è§¦å‘çš„æ¬¡æ•°è¦å¤§å³å¯)ã€‚</p><h5 id="æ„å»ºSimpleTrigger"><a href="#æ„å»ºSimpleTrigger" class="headerlink" title="æ„å»ºSimpleTrigger"></a>æ„å»ºSimpleTrigger</h5><p><code>SimpleTrigger</code>å®ä¾‹é€šè¿‡<code>TriggerBuilder</code>è®¾ç½®ä¸»è¦çš„å±æ€§ï¼Œé€šè¿‡<code>SimpleScheduleBuilder</code>è®¾ç½®ä¸<code>SimpleTrigger</code>ç›¸å…³çš„å±æ€§ã€‚è¦ä½¿ç”¨è¿™äº›builderçš„é™æ€æ–¹æ³•ï¼Œéœ€è¦é™æ€å¯¼å…¥ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>TriggerBuilder<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>SimpleScheduleBuilder<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>DateBuilder<span class="token punctuation">.</span>*<span class="token operator">:</span></code></pre><h5 id="å¸¸è§çš„è§¦å‘å®ä¾‹ï¼š"><a href="#å¸¸è§çš„è§¦å‘å®ä¾‹ï¼š" class="headerlink" title="å¸¸è§çš„è§¦å‘å®ä¾‹ï¼š"></a>å¸¸è§çš„è§¦å‘å®ä¾‹ï¼š</h5><p>å¦‚ï¼šæŒ‡å®šæ—¶é—´å¼€å§‹è§¦å‘ï¼Œä¸é‡å¤ï¼š</p><pre class=" language-java"><code class="language-java">Scheduler scheduler <span class="token operator">=</span> schedulerFactory<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Date someDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>SimpleTrigger simpleTrigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTrigger<span class="token punctuation">)</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"trigger1"</span><span class="token punctuation">,</span> <span class="token string">"group1"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span>someDate<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">// some Date </span>        <span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span><span class="token string">"job1"</span><span class="token punctuation">,</span> <span class="token string">"group1"</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// identify job with name, group strings</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æŒ‡å®šæ—¶é—´è§¦å‘ï¼Œæ¯éš”10ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œé‡å¤10æ¬¡ï¼š</p><pre class=" language-java"><code class="language-java">simpleTrigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTrigger<span class="token punctuation">)</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"trigger2"</span><span class="token punctuation">,</span> <span class="token string">"group1"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span>myTimeToStartFiring<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// if a start time is not given (if this line were omitted), "now" is implied</span>        <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withIntervalInSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>         <span class="token punctuation">.</span><span class="token function">withRepeatCount</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// note that 10 repeats will give a total of 11 firings</span>        <span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span>myJob<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// identify job with handle to its JobDetail itself             </span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>5åˆ†é’Ÿä»¥åå¼€å§‹è§¦å‘ï¼Œä»…æ‰§è¡Œä¸€æ¬¡ï¼š</p><pre class=" language-java"><code class="language-java">simpleTrigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTrigger<span class="token punctuation">)</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"trigger3"</span><span class="token punctuation">,</span> <span class="token string">"group1"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span><span class="token function">futureDate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> IntervalUnit<span class="token punctuation">.</span>MINUTE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// use DateBuilder to create a date in the future</span>        <span class="token punctuation">.</span><span class="token function">forJob</span><span class="token punctuation">(</span>myJobKey<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// identify job with its JobKey</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç«‹å³è§¦å‘ï¼Œæ¯ä¸ª5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œç›´åˆ°22:00ï¼š</p><pre class=" language-java"><code class="language-java">simpleTrigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTrigger<span class="token punctuation">)</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"trigger4"</span><span class="token punctuation">,</span> <span class="token string">"group1"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">withIntervalInMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">endAt</span><span class="token punctuation">(</span><span class="token function">dateOf</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨ä¸‹ä¸€å°æ—¶æ•´ç‚¹è§¦å‘ï¼Œæ¯ä¸ª2å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä¸€ç›´é‡å¤ï¼š</p><pre class=" language-java"><code class="language-java">simpleTrigger <span class="token operator">=</span>  <span class="token punctuation">(</span>SimpleTrigger<span class="token punctuation">)</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token string">"trigger5"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ²¡æœ‰å®šä¹‰ç»„åï¼Œ"trigger5"è¿›å…¥é»˜è®¤çš„group</span>        <span class="token punctuation">.</span><span class="token function">startAt</span><span class="token punctuation">(</span><span class="token function">evenHourDate</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//æ•´ç‚¹è§¦å‘ (minutes and seconds zero ("00:00"))</span>        <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token function">simpleSchedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withIntervalInHours</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//ä¸€ç›´é‡å¤</span>        <span class="token comment" spellcheck="true">// note that in this example, 'forJob(..)' is not called which is valid </span>        <span class="token comment" spellcheck="true">// if the trigger is passed to the scheduler along with the job  </span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>trigger<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿˜æœ‰ä¸€äº›æ²¡æœ‰åˆ—ä¸¾çš„æ–¹æ³•ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­å¯ä»¥ç‚¹å¼€ä»£ç çœ‹ã€‚</p><blockquote><p>TriggerBuilder(ä»¥åŠQuartzçš„å…¶å®ƒbuilder)ä¼šä¸ºé‚£äº›æ²¡æœ‰è¢«æ˜¾å¼è®¾ç½®çš„å±æ€§é€‰æ‹©åˆç†çš„é»˜è®¤å€¼ã€‚æ¯”å¦‚ï¼šå¦‚æœä½ æ²¡æœ‰è°ƒç”¨<em>withIdentity(..)</em>æ–¹æ³•ï¼ŒTriggerBuilderä¼šä¸ºtriggerç”Ÿæˆä¸€ä¸ªéšæœºçš„åç§°ï¼›å¦‚æœæ²¡æœ‰è°ƒç”¨<em>startAt(..)</em>æ–¹æ³•ï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰æ—¶é—´ï¼Œå³triggerç«‹å³ç”Ÿæ•ˆã€‚</p></blockquote><p><strong><code>SimpleTrigger</code> Misfireç­–ç•¥ï¼š</strong></p><p>æ‰€æœ‰çš„triggeréƒ½æœ‰ä¸€ä¸ªTrigger.MISFIRE_INSTRUCTION_SMART_POLICYç­–ç•¥å¯ä»¥ä½¿ç”¨ï¼Œè¯¥ç­–ç•¥ä¹Ÿæ˜¯æ‰€æœ‰triggerçš„é»˜è®¤ç­–ç•¥ã€‚å¯¹äº<code>SimpleTrigger</code>ï¼Œè¿™ä¸ªâ€œæ™ºèƒ½æœºåˆ¶â€å°†æ ¹æ®è§¦å‘å™¨å®ä¾‹çš„çŠ¶æ€å’Œé…ç½®æ¥å†³å®šå…¶è¡Œä¸ºã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><p>å¦‚æœRepeat Count=0ï¼šåªæ‰§è¡Œä¸€æ¬¡ã€€</p><p>â€‹     instruction selected = MISFIRE_INSTRUCTION_FIRE_NOW;</p><p>å¦‚æœRepeat Count=REPEAT_INDEFINITELYï¼šæ— é™æ¬¡æ‰§è¡Œ</p><p>â€‹    instruction selected = MISFIRE_INSTRUCTION_RESCHEDULE_NEXT_WITH_REMAINING_COUNT;</p><p>å¦‚æœRepeat Count&gt;0ï¼šæ‰§è¡Œå¤šæ¬¡ï¼ˆæœ‰é™ï¼‰</p><p>ã€€ã€€instruction selected = MISFIRE_INSTRUCTION_RESCHEDULE_NOW_WITH_EXISTING_REPEAT_COUNT;</p><p><code>SimpleTrigger</code>å¸¸è§ç­–ç•¥ï¼š</p><table><thead><tr><th>å¸¸è§ç­–ç•¥</th><th>ç­–ç•¥è¯´æ˜</th></tr></thead><tbody><tr><td>MISFIRE_INSTRUCTION_IGNORE_MISFIRE_POLICY</td><td>å¿½ç•¥æ‰€æœ‰çš„è¶…æ—¶çŠ¶æ€ï¼ŒæŒ‰ç…§è§¦å‘å™¨çš„ç­–ç•¥æ‰§è¡Œã€‚</td></tr><tr><td>MISFIRE_INSTRUCTION_FIRE_NOW</td><td>ç«‹åˆ»æ‰§è¡Œã€‚å¯¹äºä¸ä¼šé‡å¤æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™æ˜¯é»˜è®¤çš„å¤„ç†ç­–ç•¥ã€‚</td></tr><tr><td>MISFIRE_INSTRUCTION_RESCHEDULE_NEXT_WITH_REMAINING_COUNT</td><td>åœ¨ä¸‹ä¸€ä¸ªæ¿€æ´»ç‚¹æ‰§è¡Œï¼Œä¸”è¶…æ—¶æœŸå†…é”™è¿‡çš„æ‰§è¡Œæœºä¼šä½œåºŸã€‚</td></tr><tr><td>MISFIRE_INSTRUCTION_RESCHEDULE_NOW_WITH_REMAINING_COUNT</td><td>ç«‹å³æ‰§è¡Œï¼Œä¸”è¶…æ—¶æœŸå†…é”™è¿‡çš„æ‰§è¡Œæœºä¼šä½œåºŸã€‚</td></tr><tr><td>MISFIRE_INSTRUCTION_RESCHEDULE_NEXT_WITH_EXISTING_COUNT</td><td>åœ¨ä¸‹ä¸€ä¸ªæ¿€æ´»ç‚¹æ‰§è¡Œï¼Œå¹¶é‡å¤åˆ°æŒ‡å®šçš„æ¬¡æ•°ã€‚</td></tr><tr><td>MISFIRE_INSTRUCTION_RESCHEDULE_NOW_WITH_EXISTING_COUNT</td><td>ç«‹å³æ‰§è¡Œï¼Œå¹¶é‡å¤åˆ°æŒ‡å®šçš„æ¬¡æ•°ã€‚</td></tr><tr><td>MISFIRE_INSTRUCTION_IGNORE_MISFIRE_POLICY</td><td>å¿½ç•¥æ‰€æœ‰çš„è¶…æ—¶çŠ¶æ€ï¼ŒæŒ‰ç…§è§¦å‘å™¨çš„ç­–ç•¥æ‰§è¡Œã€‚</td></tr></tbody></table><h4 id="2ã€CronTrigger"><a href="#2ã€CronTrigger" class="headerlink" title="2ã€CronTrigger"></a>2ã€CronTrigger</h4><p><code>Cron</code>è¡¨è¾¾å¼è§¦å‘å™¨çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼š</p><p>åŸºäºæ—¶é—´è¡¨ï¼Œåœ¨å¤æ‚çš„æ—¶é—´ç‚¹ï¼Œå¤æ‚çš„æ‰§è¡Œå‘¨æœŸæ‰§è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚</p><p>ä¾‹å¦‚ï¼šâ€œæ¯å‘¨ä¸€åˆ°å‘¨äº”ä¸Šåˆ8:00â€æˆ–â€œæ¯æœˆæœ€åä¸€ä¸ªæ˜ŸæœŸäº”å‡Œæ™¨1:30â€ã€‚ </p><p> <code>CronTrigger</code>ç±»ä¼¼äºåœ¨ç»™å®šçš„æ—¶é—´è§¦å‘ä½œä¸šï¼Œå’ŒLinuxçš„â€œ<code>cron-like</code>â€è°ƒåº¦å®šä¹‰ç›¸ä¼¼ã€‚â€œ<code>Cron Expression</code>â€å­—ç¬¦ä¸²çš„æ ¼å¼è®°å½•åœ¨<code>CronExpression</code>ç±»ä¸­ã€‚</p><h5 id="Cron-Expressions"><a href="#Cron-Expressions" class="headerlink" title="Cron Expressions"></a>Cron Expressions</h5><p><code>Cron-Expressions</code>ç”¨äºé…ç½®<code>CronTrigger</code>çš„å®ä¾‹ã€‚<code>Cron Expressions</code>æ˜¯ç”±ä¸ƒä¸ªå­è¡¨è¾¾å¼ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œç”¨äºæè¿°æ—¥ç¨‹è¡¨çš„å„ä¸ªç»†èŠ‚ã€‚è¿™äº›å­è¡¨è¾¾å¼ç”¨ç©ºæ ¼åˆ†éš”ï¼Œä¸ƒä¸ªå­è¡¨è¾¾å¼ä¾æ¬¡ä¸ºï¼š<code>ç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨ å¹´</code></p><table><thead><tr><th>ä½ç½®</th><th>è¯´æ˜</th><th>å…è®¸å€¼</th><th>ç‰¹æ®Šå€¼</th></tr></thead><tbody><tr><td>1</td><td>Seconds</td><td>0-59</td><td><code>,</code>  <code>-</code> <code>*</code>  <code>/</code></td></tr><tr><td>2</td><td>Minutes</td><td>0-59</td><td><code>,</code>  <code>-</code> <code>*</code>  <code>/</code></td></tr><tr><td>3</td><td>Hours</td><td>0-23</td><td><code>,</code>  <code>-</code> <code>*</code>  <code>/</code></td></tr><tr><td>4</td><td>Day-of-Month</td><td>1-31</td><td><code>,</code>  <code>-</code> <code>*</code>  <code>/</code> <code>?</code>  <code>L</code> <code>W</code> <code>C</code></td></tr><tr><td>5</td><td>Month</td><td>1-12</td><td><code>,</code>  <code>-</code> <code>*</code>  <code>/</code></td></tr><tr><td>6</td><td>Day-of-Week</td><td>1-7</td><td><code>,</code>  <code>-</code> <code>*</code>  <code>/</code> <code>?</code> <code>L</code> <code>C</code> <code>#</code></td></tr><tr><td>7</td><td>Year (å¯é€‰)</td><td></td><td><code>,</code>  <code>-</code> <code>*</code>  <code>/</code></td></tr></tbody></table><p><code>Cron</code>è¡¨è¾¾å¼å¯¹ç‰¹æ®Šå­—ç¬¦çš„å¤§å°å†™ä¸æ•æ„Ÿï¼Œå¯¹ä»£è¡¨æ˜ŸæœŸçš„ç¼©å†™è‹±æ–‡å¤§å°å†™ä¹Ÿä¸æ•æ„Ÿã€‚</p><p>ç‰¹æ®Šç¬¦å·è¯´æ˜ï¼š</p><table><thead><tr><th>ç¬¦å·</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ˜Ÿå·(*)</strong></td><td>å¯ç”¨åœ¨æ‰€æœ‰å­—æ®µä¸­ï¼Œè¡¨ç¤ºå¯¹åº”æ—¶é—´åŸŸçš„æ¯ä¸€ä¸ªæ—¶åˆ»ï¼Œä¾‹å¦‚ï¼Œ* åœ¨åˆ†é’Ÿå­—æ®µæ—¶ï¼Œè¡¨ç¤ºâ€œæ¯åˆ†é’Ÿâ€ï¼›</td></tr><tr><td><strong>é—®å·ï¼ˆ?ï¼‰</strong></td><td>è¯¥å­—ç¬¦åªåœ¨æ—¥æœŸå’Œæ˜ŸæœŸå­—æ®µä¸­ä½¿ç”¨ï¼Œå®ƒé€šå¸¸æŒ‡å®šä¸ºâ€œæ— æ„ä¹‰çš„å€¼â€ï¼Œç›¸å½“äºå ä½ç¬¦ï¼›</td></tr><tr><td><strong>å‡å·(-)</strong></td><td>è¡¨è¾¾ä¸€ä¸ªèŒƒå›´ï¼Œå¦‚åœ¨å°æ—¶å­—æ®µä¸­ä½¿ç”¨â€œ10-12â€ï¼Œåˆ™è¡¨ç¤ºä»10åˆ°12ç‚¹ï¼Œå³10,11,12ï¼›</td></tr><tr><td><strong>é€—å·(,)</strong></td><td>è¡¨è¾¾ä¸€ä¸ªåˆ—è¡¨å€¼ï¼Œå¦‚åœ¨æ˜ŸæœŸå­—æ®µä¸­ä½¿ç”¨â€œMON,WED,FRIâ€ï¼Œåˆ™è¡¨ç¤ºæ˜ŸæœŸä¸€ï¼Œæ˜ŸæœŸä¸‰å’Œæ˜ŸæœŸäº”ï¼›</td></tr><tr><td><strong>æ–œæ (/)</strong></td><td>x/yè¡¨è¾¾ä¸€ä¸ªç­‰æ­¥é•¿åºåˆ—ï¼Œxä¸ºèµ·å§‹å€¼ï¼Œyä¸ºå¢é‡æ­¥é•¿å€¼ã€‚å¦‚åœ¨åˆ†é’Ÿå­—æ®µä¸­ä½¿ç”¨0/15ï¼Œåˆ™è¡¨ç¤ºä¸º0,15,30å’Œ45ç§’ï¼Œè€Œ5/15åœ¨åˆ†é’Ÿå­—æ®µä¸­è¡¨ç¤º5,20,35,50ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨*/yï¼Œå®ƒç­‰åŒäº0/yï¼›</td></tr><tr><td><strong>L</strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td>è¯¥å­—ç¬¦åªåœ¨æ—¥æœŸå’Œæ˜ŸæœŸå­—æ®µä¸­ä½¿ç”¨ï¼Œä»£è¡¨â€œLastâ€çš„æ„æ€ï¼Œä½†å®ƒåœ¨ä¸¤ä¸ªå­—æ®µä¸­æ„æ€ä¸åŒã€‚<br/>Låœ¨æ—¥æœŸå­—æ®µä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªæœˆä»½çš„æœ€åä¸€å¤©ï¼Œå¦‚ä¸€æœˆçš„31å·ï¼Œéé—°å¹´äºŒæœˆçš„28å·ï¼›<br/>å¦‚æœLç”¨åœ¨æ˜ŸæœŸä¸­ï¼Œåˆ™è¡¨ç¤ºæ˜ŸæœŸå…­ï¼Œç­‰åŒäº7ã€‚<br/>ä½†æ˜¯ï¼Œå¦‚æœLå‡ºç°åœ¨æ˜ŸæœŸå­—æ®µé‡Œï¼Œè€Œä¸”åœ¨å‰é¢æœ‰ä¸€ä¸ªæ•°å€¼Xï¼Œåˆ™è¡¨ç¤ºâ€œè¿™ä¸ªæœˆçš„æœ€åXå¤©â€ï¼Œä¾‹å¦‚ï¼Œ6Lè¡¨ç¤ºè¯¥æœˆçš„æœ€åæ˜ŸæœŸäº”ï¼›</td></tr><tr><td><strong>W</strong></td><td>è¯¥å­—ç¬¦åªèƒ½å‡ºç°åœ¨æ—¥æœŸå­—æ®µé‡Œï¼Œæ˜¯å¯¹å‰å¯¼æ—¥æœŸçš„ä¿®é¥°ï¼Œè¡¨ç¤ºç¦»è¯¥æ—¥æœŸæœ€è¿‘çš„å·¥ä½œæ—¥ã€‚<br/>ä¾‹å¦‚15Wè¡¨ç¤ºç¦»è¯¥æœˆ15å·æœ€è¿‘çš„å·¥ä½œæ—¥ï¼Œå¦‚æœè¯¥æœˆ15å·æ˜¯æ˜ŸæœŸå…­ï¼Œåˆ™åŒ¹é…14å·æ˜ŸæœŸäº”ï¼›å¦‚æœ15æ—¥æ˜¯æ˜ŸæœŸæ—¥ï¼Œåˆ™åŒ¹é…16å·æ˜ŸæœŸä¸€ï¼›å¦‚æœ15å·æ˜¯æ˜ŸæœŸäºŒï¼Œé‚£ç»“æœå°±æ˜¯15å·æ˜ŸæœŸäºŒã€‚ä½†å¿…é¡»æ³¨æ„å…³è”çš„åŒ¹é…æ—¥æœŸä¸èƒ½å¤Ÿè·¨æœˆï¼Œå¦‚ä½ æŒ‡å®š1Wï¼Œå¦‚æœ1å·æ˜¯æ˜ŸæœŸå…­ï¼Œç»“æœåŒ¹é…çš„æ˜¯3å·æ˜ŸæœŸä¸€ï¼Œè€Œéä¸Šä¸ªæœˆæœ€åçš„é‚£å¤©ã€‚Wå­—ç¬¦ä¸²åªèƒ½æŒ‡å®šå•ä¸€æ—¥æœŸï¼Œè€Œä¸èƒ½æŒ‡å®šæ—¥æœŸèŒƒå›´ï¼›</td></tr><tr><td><strong>LWç»„åˆ</strong></td><td>åœ¨æ—¥æœŸå­—æ®µå¯ä»¥ç»„åˆä½¿ç”¨LWï¼Œå®ƒçš„æ„æ€æ˜¯å½“æœˆçš„æœ€åä¸€ä¸ªå·¥ä½œæ—¥ï¼›</td></tr><tr><td>*<em>äº•å·(#) *</em></td><td>è¯¥å­—ç¬¦åªèƒ½åœ¨æ˜ŸæœŸå­—æ®µä¸­ä½¿ç”¨ï¼Œè¡¨ç¤ºå½“æœˆæŸä¸ªå·¥ä½œæ—¥ã€‚å¦‚6#3è¡¨ç¤ºå½“æœˆçš„ç¬¬ä¸‰ä¸ªæ˜ŸæœŸäº”(6è¡¨ç¤ºæ˜ŸæœŸäº”ï¼Œ#3è¡¨ç¤ºå½“å‰çš„ç¬¬ä¸‰ä¸ª)ï¼Œè€Œ4#5è¡¨ç¤ºå½“æœˆçš„ç¬¬äº”ä¸ªæ˜ŸæœŸä¸‰ï¼Œå‡è®¾å½“æœˆæ²¡æœ‰ç¬¬äº”ä¸ªæ˜ŸæœŸä¸‰ï¼Œå¿½ç•¥ä¸è§¦å‘ï¼›</td></tr><tr><td>*<em>C *</em></td><td>è¯¥å­—ç¬¦åªåœ¨æ—¥æœŸå’Œæ˜ŸæœŸå­—æ®µä¸­ä½¿ç”¨ï¼Œä»£è¡¨â€œCalendarâ€çš„æ„æ€ã€‚å®ƒçš„æ„æ€æ˜¯è®¡åˆ’æ‰€å…³è”çš„æ—¥æœŸï¼Œå¦‚æœæ—¥æœŸæ²¡æœ‰è¢«å…³è”ï¼Œåˆ™ç›¸å½“äºæ—¥å†ä¸­æ‰€æœ‰æ—¥æœŸã€‚ä¾‹å¦‚5Cåœ¨æ—¥æœŸå­—æ®µä¸­å°±ç›¸å½“äºæ—¥å†5æ—¥ä»¥åçš„ç¬¬ä¸€å¤©ã€‚1Cåœ¨æ˜ŸæœŸå­—æ®µä¸­ç›¸å½“äºæ˜ŸæœŸæ—¥åçš„ç¬¬ä¸€å¤©ã€‚</td></tr></tbody></table><h5 id="å¸¸è§è¡¨è¾¾å¼ç¤ºä¾‹ï¼š"><a href="#å¸¸è§è¡¨è¾¾å¼ç¤ºä¾‹ï¼š" class="headerlink" title="å¸¸è§è¡¨è¾¾å¼ç¤ºä¾‹ï¼š"></a>å¸¸è§è¡¨è¾¾å¼ç¤ºä¾‹ï¼š</h5><table><thead><tr><th>è¡¨è¾¾å¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>&quot;0 0 12 * * ?&quot;</code></td><td>æ¯å¤©12ç‚¹è§¦å‘æ‰§è¡Œ</td></tr><tr><td><code>&quot;0 15 10 ? * *&quot;</code></td><td>æ¯å¤©10ç‚¹15åˆ†è§¦å‘æ‰§è¡Œ</td></tr><tr><td><code>&quot;0 15 10 * * ?&quot;</code></td><td>æ¯å¤©10ç‚¹15åˆ†è§¦å‘æ‰§è¡Œ</td></tr><tr><td><code>&quot;0 15 10 * * ? *&quot;</code></td><td>æ¯å¤©10ç‚¹15åˆ†è§¦å‘æ‰§è¡Œ</td></tr><tr><td><code>&quot;0 15 10 * * ? 2020&quot;</code></td><td>åœ¨2020å¹´å†…ï¼Œæ¯å¤©10ç‚¹15åˆ†è§¦å‘æ‰§è¡Œ</td></tr><tr><td><code>&quot;0 * 14 * * ?&quot;</code></td><td>æ¯å¤©ä»ä¸‹åˆ2ç‚¹å¼€å§‹åˆ°ä¸‹åˆ2ç‚¹59åˆ†ç»“æŸï¼Œæ¯åˆ†é’Ÿè§¦å‘æ‰§è¡Œä¸€æ¬¡</td></tr><tr><td><code>&quot;0 0/5 14 * * ?&quot;</code></td><td>æ¯å¤©ä»ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2ç‚¹55åˆ†ï¼Œæ¯5åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</td></tr><tr><td><code>&quot;0 0/5 14,18 * * ?&quot;</code></td><td>æ¯å¤©ä»ä¸‹åˆ2ç‚¹å¼€å§‹åˆ°ä¸‹åˆ2ç‚¹55åˆ†æ¯5åˆ†é’Ÿè§¦å‘ä¸€æ¬¡<br/>ä»ä¸‹åˆ6ç‚¹å¼€å§‹åˆ°ä¸‹åˆ6ç‚¹55åˆ†ç»“æŸï¼Œæ¯5åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</td></tr><tr><td><code>&quot;0 0-5 14 * * ?&quot;</code></td><td>æ¯å¤©ä»ä¸‹åˆ2ç‚¹å¼€å§‹åˆ°ä¸‹åˆ2ç‚¹05åˆ†ç»“æŸï¼Œæ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</td></tr><tr><td><code>&quot;0 10,44 14 ? 3 WED&quot;</code></td><td>ï¼ˆæ¯å¹´ï¼‰ä¸‰æœˆæ¯å‘¨ä¸‰ä¸‹åˆ2:10å’Œ2:44è§¦å‘</td></tr><tr><td><code>&quot;0 15 10 ? * MON-FRI&quot;</code></td><td>æ¯å‘¨ä¸€ã€äºŒã€ä¸‰ã€å››ã€äº”ä¸Šåˆ10:15è§¦å‘</td></tr><tr><td><code>&quot;0 15 10 15 * ?&quot;</code></td><td>æ¯æœˆ15æ—¥ä¸Šåˆ10:15è§¦å‘</td></tr><tr><td><code>&quot;0 15 10 L * ?&quot;</code></td><td>æ¯æœˆæœ€åä¸€å¤©ä¸Šåˆ10:15è§¦å‘</td></tr><tr><td><code>&quot;0 15 10 * ï¼Ÿ 6L&quot;</code></td><td>æ¯æœˆæœ€åä¸€ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15è§¦å‘</td></tr><tr><td><code>&quot;0 15 10 ? * 6L&quot;</code></td><td>æ¯æœˆæœ€åä¸€ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15è§¦å‘</td></tr><tr><td><code>&quot;0 15 10 ? * 6L 2012-2015&quot;</code></td><td>åœ¨ 2012, 2013, 2014,2015æœŸé—´ï¼Œæ¯æœˆæœ€åä¸€ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15è§¦å‘</td></tr><tr><td><code>&quot;0 15 10 ? * 6#3&quot;</code></td><td>æ¯æœˆç¬¬ä¸‰ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15è§¦å‘æ‰§è¡Œ</td></tr></tbody></table><h5 id="æ„å»ºCronTriggers"><a href="#æ„å»ºCronTriggers" class="headerlink" title="æ„å»ºCronTriggers"></a>æ„å»ºCronTriggers</h5><p><code>CronTrigger</code>å®ä¾‹ä½¿ç”¨<code>TriggerBuilder</code>ï¼ˆç”¨äºè§¦å‘å™¨çš„ä¸»è¦å±æ€§ï¼‰å’Œ<code>CronScheduleBuilder</code>ï¼ˆå¯¹äº<code>CronTrigger</code>ç‰¹å®šçš„å±æ€§ï¼‰æ„å»ºã€‚è¦ä»¥<code>DSL</code>é£æ ¼ä½¿ç”¨è¿™äº›æ„å»ºå™¨ï¼Œè¯·ä½¿ç”¨é™æ€å¯¼å…¥ï¼š</p><pre><code>import static org.quartz.TriggerBuilder.*;import static org.quartz.CronScheduleBuilder.*;import static org.quartz.DateBuilder.*:</code></pre><p>å»ºç«‹ä¸€ä¸ªè§¦å‘å™¨ï¼Œæ¯éš”ä¸€åˆ†é’Ÿï¼Œæ¯å¤©ä¸Šåˆ8ç‚¹è‡³ä¸‹åˆ5ç‚¹ä¹‹é—´ï¼š</p><pre><code>CronTrigger cronTrigger = newTrigger()                .withIdentity(&quot;trigger3&quot;, &quot;triggerGroupName&quot;)                .withSchedule(cronSchedule(&quot;0 0/2 8-17 * * ?&quot;))                .forJob(&quot;myJobName&quot;, &quot;groupName&quot;).build();</code></pre><p>å»ºç«‹ä¸€ä¸ªè§¦å‘å™¨ï¼Œå°†åœ¨ä¸Šåˆ10:42æ¯å¤©å‘å°„ï¼š</p><pre><code>CronTrigger cronTrigger = newTrigger()    .withIdentity(&quot;trigger3&quot;, &quot;triggerGroupName&quot;)    .withSchedule(dailyAtHourAndMinute(10, 42))    .forJob(myJobKey)    .build();</code></pre><p>æˆ–è€…ï¼š</p><pre><code>CronTrigger cronTrigger = newTrigger()    .withIdentity(&quot;trigger3&quot;, &quot;triggerGroupName&quot;)    .withSchedule(cronSchedule(&quot;0 42 10 * * ?&quot;))    .forJob(myJobKey)    .build();</code></pre><p>å»ºç«‹ä¸€ä¸ªå¸¦æ—¶åŒºçš„è§¦å‘å™¨ï¼Œå°†åœ¨æ˜ŸæœŸä¸‰ä¸Šåˆ10:42åœ¨TimeZoneï¼ˆç³»ç»Ÿé»˜è®¤å€¼ï¼‰ä¹‹å¤–è§¦å‘ï¼š</p><pre><code>  trigger = newTrigger()    .withIdentity(&quot;trigger3&quot;, &quot;triggerGroupName&quot;)    .withSchedule(weeklyOnDayAndHourAndMinute(DateBuilder.WEDNESDAY, 10, 42))    .forJob(myJobKey)    .inTimeZone(TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;))    .build();</code></pre><p>æˆ–è€…ï¼š</p><pre><code>  trigger = newTrigger()    .withIdentity(&quot;trigger3&quot;, &quot;triggerGroupName&quot;)    .withSchedule(cronSchedule(&quot;0 42 10 ? * WED&quot;))    .inTimeZone(TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;))    .forJob(myJobKey)    .build();</code></pre><h5 id="CronTrigger-Misfireè¯´æ˜"><a href="#CronTrigger-Misfireè¯´æ˜" class="headerlink" title="CronTrigger Misfireè¯´æ˜"></a>CronTrigger Misfireè¯´æ˜</h5><h5 id="CronTriggerå¸¸è§ç­–ç•¥ï¼š"><a href="#CronTriggerå¸¸è§ç­–ç•¥ï¼š" class="headerlink" title="CronTriggerå¸¸è§ç­–ç•¥ï¼š"></a>CronTriggerå¸¸è§ç­–ç•¥ï¼š</h5><table><thead><tr><th>ç­–ç•¥åç§°</th><th>ç­–ç•¥è¯´æ˜</th></tr></thead><tbody><tr><td>MISFIRE_INSTRUCTION_IGNORE_MISFIRE_POLICY</td><td>å¿½ç•¥æ‰€æœ‰çš„è¶…æ—¶çŠ¶æ€ï¼ŒæŒ‰ç…§è§¦å‘å™¨çš„ç­–ç•¥æ‰§è¡Œã€‚</td></tr><tr><td>MISFIRE_INSTRUCTION_FIRE_ONCE_NOW</td><td>ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åå°±æŒ‰ç…§æ­£å¸¸çš„è®¡åˆ’æ‰§è¡Œã€‚</td></tr><tr><td>MISFIRE_INSTRUCTION_DO_NOTHING</td><td>ç›®å‰ä¸æ‰§è¡Œï¼Œç„¶åå°±æŒ‰ç…§æ­£å¸¸çš„è®¡åˆ’æ‰§è¡Œã€‚è¿™æ„å‘³ç€å¦‚æœä¸‹æ¬¡æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†end timeï¼Œå®é™…ä¸Šå°±æ²¡æœ‰æ‰§è¡Œæœºä¼šäº†ã€‚</td></tr></tbody></table><p>æ‰€æœ‰çš„triggeréƒ½æœ‰ä¸€ä¸ªTrigger.MISFIRE_INSTRUCTION_SMART_POLICYç­–ç•¥å¯ä»¥ä½¿ç”¨ï¼Œè¯¥ç­–ç•¥ä¹Ÿæ˜¯æ‰€æœ‰triggerçš„é»˜è®¤ç­–ç•¥ã€‚å¯¹äº<code>CronTrigger</code>ï¼Œè¯¥â€œæ™ºèƒ½æœºåˆ¶â€é»˜è®¤é€‰æ‹©<code>MISFIRE_INSTRUCTION_FIRE_ONCE_NOW</code>ä»¥æŒ‡å¯¼å…¶è¡Œä¸ºã€‚</p><blockquote><p>TriggerBuilder(ä»¥åŠQuartzçš„å…¶å®ƒbuilder)ä¼šä¸ºé‚£äº›æ²¡æœ‰è¢«æ˜¾å¼è®¾ç½®çš„å±æ€§é€‰æ‹©åˆç†çš„é»˜è®¤å€¼ã€‚æ¯”å¦‚ï¼šå¦‚æœä½ æ²¡æœ‰è°ƒç”¨<em>withIdentity(..)</em>æ–¹æ³•ï¼ŒTriggerBuilderä¼šä¸ºtriggerç”Ÿæˆä¸€ä¸ªéšæœºçš„åç§°ï¼›å¦‚æœæ²¡æœ‰è°ƒç”¨<em>startAt(..)</em>æ–¹æ³•ï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰æ—¶é—´ï¼Œå³triggerç«‹å³ç”Ÿæ•ˆã€‚</p></blockquote><h3 id="å››ã€ç›‘å¬å™¨ä½¿ç”¨"><a href="#å››ã€ç›‘å¬å™¨ä½¿ç”¨" class="headerlink" title="å››ã€ç›‘å¬å™¨ä½¿ç”¨"></a>å››ã€ç›‘å¬å™¨ä½¿ç”¨</h3><p><strong>Listeners</strong>(ç›‘å¬å™¨)æ˜¯å®ç°ç›‘å¬æ¥å£åˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºæ ¹æ®è°ƒåº¦ç¨‹åºä¸­å‘ç”Ÿçš„äº‹ä»¶æ‰§è¡Œæ“ä½œã€‚</p><p>æ¯”è¾ƒå¸¸ç”¨çš„ç›‘å¬å™¨ï¼š </p><h4 id="1-è§¦å‘å™¨ç›‘å¬å’Œä»»åŠ¡æ‰§è¡Œç›‘å¬"><a href="#1-è§¦å‘å™¨ç›‘å¬å’Œä»»åŠ¡æ‰§è¡Œç›‘å¬" class="headerlink" title="1. è§¦å‘å™¨ç›‘å¬å’Œä»»åŠ¡æ‰§è¡Œç›‘å¬"></a>1. è§¦å‘å™¨ç›‘å¬å’Œä»»åŠ¡æ‰§è¡Œç›‘å¬</h4><p>TriggerListenersæ¥æ”¶åˆ°ä¸è§¦å‘å™¨ï¼ˆtriggerï¼‰ç›¸å…³çš„äº‹ä»¶ï¼ŒJobListeners æ¥æ”¶ä¸jobsç›¸å…³çš„äº‹ä»¶ã€‚</p><p>ä¸è§¦å‘ç›¸å…³çš„äº‹ä»¶åŒ…æ‹¬ï¼šè§¦å‘å™¨è§¦å‘ï¼Œè§¦å‘å¤±çµï¼Œå¹¶è§¦å‘å®Œæˆï¼ˆè§¦å‘å™¨å…³é—­çš„ä½œä¸šå®Œæˆï¼‰ã€‚</p><p><code>org.quartz.TriggerListener</code>æ¥å£</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TriggerListener</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerFired</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">,</span> JobExecutionContext context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">vetoJobExecution</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">,</span> JobExecutionContext context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerMisfired</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerComplete</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">,</span> JobExecutionContext context<span class="token punctuation">,</span>            <span class="token keyword">int</span> triggerInstructionCode<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>jobç›¸å…³äº‹ä»¶åŒ…æ‹¬ï¼šjobå³å°†æ‰§è¡Œçš„é€šçŸ¥ï¼Œä»¥åŠjobå®Œæˆæ‰§è¡Œæ—¶çš„é€šçŸ¥ã€‚</p><p>org.quartz.JobListeneræ¥å£</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">JobListener</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobToBeExecuted</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobExecutionVetoed</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobWasExecuted</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">,</span>            JobExecutionException jobException<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="2-è‡ªå®šä¹‰ç›‘å¬å™¨ï¼š"><a href="#2-è‡ªå®šä¹‰ç›‘å¬å™¨ï¼š" class="headerlink" title="2. è‡ªå®šä¹‰ç›‘å¬å™¨ï¼š"></a>2. è‡ªå®šä¹‰ç›‘å¬å™¨ï¼š</h4><p>è¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„listenerï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªå®ç°<code>org.quartz.TriggerListener</code>æˆ–<code>org.quartz.JobListener</code>æ¥å£çš„å¯¹è±¡ã€‚</p><p>å¦‚è‡ªå®šä¹‰ä¸€ä¸ªè§¦å‘ç›¸å…³ç›‘å¬å™¨ï¼š</p><pre class=" language-ava"><code class="language-ava">package com.smallrose.web.app.quartz.listener;import org.quartz.JobExecutionContext;import org.quartz.Trigger;import org.quartz.Trigger.CompletedExecutionInstruction;import org.quartz.TriggerListener;public class TestTriggerListener implements TriggerListener {    @Override    public String getName() {        return null;    }    @Override    public void triggerFired(Trigger trigger, JobExecutionContext context) {    }    @Override    public boolean vetoJobExecution(Trigger trigger, JobExecutionContext context) {        return false;    }    @Override    public void triggerMisfired(Trigger trigger) {    }    @Override    public void triggerComplete(Trigger trigger, JobExecutionContext context,            CompletedExecutionInstruction triggerInstructionCode) {    }}</code></pre><p>å¦‚è‡ªå®šä¹‰ä¸€ä¸ªä»»åŠ¡ç›¸å…³ç›‘å¬å™¨ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>smallrose<span class="token punctuation">.</span>web<span class="token punctuation">.</span>app<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>listener<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobExecutionContext<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobExecutionException<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>quartz<span class="token punctuation">.</span>JobListener<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJobListener</span> <span class="token keyword">implements</span> <span class="token class-name">JobListener</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobToBeExecuted</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobExecutionVetoed</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobWasExecuted</span><span class="token punctuation">(</span>JobExecutionContext context<span class="token punctuation">,</span> JobExecutionException jobException<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="3-ç›‘å¬å™¨çš„ä½¿ç”¨"><a href="#3-ç›‘å¬å™¨çš„ä½¿ç”¨" class="headerlink" title="3. ç›‘å¬å™¨çš„ä½¿ç”¨"></a>3. ç›‘å¬å™¨çš„ä½¿ç”¨</h4><p>æ·»åŠ ç›‘å¬ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æ—§ç‰ˆ</span>scheduler<span class="token punctuation">.</span><span class="token function">addJobListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ·»åŠ è‡ªå®šä¹‰ä»»åŠ¡æ‰§è¡Œç›‘å¬</span>scheduler<span class="token punctuation">.</span><span class="token function">addTriggerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpTriggerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ·»åŠ è‡ªå®šä¹‰è§¦å‘å™¨ç›‘å¬</span><span class="token comment" spellcheck="true">//æ–°ç‰ˆ since 2.0</span>scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addJobListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ·»åŠ ä»»åŠ¡æ‰§è¡Œç›‘å¬</span>scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTriggerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ·»åŠ ä»»åŠ¡æ‰§è¡Œè§¦å‘å™¨ç›‘å¬</span></code></pre><p>ç§»é™¤ç›‘å¬ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java">scheduler<span class="token punctuation">.</span><span class="token function">removeJobListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpJobListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ç§»é™¤è‡ªå®šä¹‰ä»»åŠ¡æ‰§è¡Œç›‘å¬</span>scheduler<span class="token punctuation">.</span><span class="token function">removeTriggerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpTriggerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ç§»é™¤è‡ªå®šä¹‰è§¦å‘å™¨ç›‘å¬</span></code></pre><pre><code>package org.quartz;import java.util.List;/** *  * @author jhouse * @since 2.0 - previously listeners were managed directly on the Scheduler interface. */public interface ListenerManager {    public void addJobListener(JobListener jobListener);    public void addJobListener(JobListener jobListener, Matcher&lt;JobKey&gt; matcher);    public void addJobListener(JobListener jobListener, Matcher&lt;JobKey&gt; ... matchers);    public void addJobListener(JobListener jobListener, List&lt;Matcher&lt;JobKey&gt;&gt; matchers);    public boolean addJobListenerMatcher(String listenerName, Matcher&lt;JobKey&gt; matcher);    public boolean removeJobListenerMatcher(String listenerName, Matcher&lt;JobKey&gt; matcher);    public boolean setJobListenerMatchers(String listenerName, List&lt;Matcher&lt;JobKey&gt;&gt; matchers);    public List&lt;Matcher&lt;JobKey&gt;&gt; getJobListenerMatchers(String listenerName);    public boolean removeJobListener(String name);    public JobListener getJobListener(String name);    public void addTriggerListener(TriggerListener triggerListener);    public void addTriggerListener(TriggerListener triggerListener, Matcher&lt;TriggerKey&gt; matcher);    public void addTriggerListener(TriggerListener triggerListener, Matcher&lt;TriggerKey&gt; ... matchers);    public void addTriggerListener(TriggerListener triggerListener, List&lt;Matcher&lt;TriggerKey&gt;&gt; matchers);    public boolean addTriggerListenerMatcher(String listenerName, Matcher&lt;TriggerKey&gt; matcher);    public boolean removeTriggerListenerMatcher(String listenerName, Matcher&lt;TriggerKey&gt; matcher);    public boolean setTriggerListenerMatchers(String listenerName, List&lt;Matcher&lt;TriggerKey&gt;&gt; matchers);    public List&lt;Matcher&lt;TriggerKey&gt;&gt; getTriggerListenerMatchers( String listenerName);    public boolean removeTriggerListener(String name);    public List&lt;TriggerListener&gt; getTriggerListeners();    public TriggerListener getTriggerListener(String name);    public void addSchedulerListener(SchedulerListener schedulerListener);    public boolean removeSchedulerListener(SchedulerListener schedulerListener);    public List&lt;SchedulerListener&gt; getSchedulerListeners();}</code></pre><h4 id="4-è°ƒåº¦ç›‘å¬å™¨"><a href="#4-è°ƒåº¦ç›‘å¬å™¨" class="headerlink" title="4. è°ƒåº¦ç›‘å¬å™¨"></a>4. è°ƒåº¦ç›‘å¬å™¨</h4><p>SchedulerListenerséå¸¸ç±»ä¼¼äºTriggerListenerså’ŒJobListenersï¼Œé™¤äº†å®ƒä»¬åœ¨Scheduleræœ¬èº«ä¸­æ¥æ”¶åˆ°äº‹ä»¶çš„é€šçŸ¥ ï¼Œä¸ä¸€å®šä¸ç‰¹å®šè§¦å‘å™¨ï¼ˆtriggerï¼‰æˆ–jobç›¸å…³çš„äº‹ä»¶ã€‚</p><p>ä¸è®¡åˆ’ç¨‹åºç›¸å…³çš„äº‹ä»¶åŒ…æ‹¬ï¼šæ·»åŠ job/è§¦å‘å™¨ï¼Œåˆ é™¤job/è§¦å‘å™¨ï¼Œè°ƒåº¦ç¨‹åºä¸­çš„ä¸¥é‡é”™è¯¯ï¼Œå…³é—­è°ƒåº¦ç¨‹åºçš„é€šçŸ¥ç­‰ã€‚</p><p><code>org.quartz.SchedulerListener</code>æ¥å£</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SchedulerListener</span> <span class="token punctuation">{</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobScheduled</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobUnscheduled</span><span class="token punctuation">(</span>String triggerName<span class="token punctuation">,</span> String triggerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggerFinalized</span><span class="token punctuation">(</span>Trigger trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggersPaused</span><span class="token punctuation">(</span>String triggerName<span class="token punctuation">,</span> String triggerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">triggersResumed</span><span class="token punctuation">(</span>String triggerName<span class="token punctuation">,</span> String triggerGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobsPaused</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">jobsResumed</span><span class="token punctuation">(</span>String jobName<span class="token punctuation">,</span> String jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerError</span><span class="token punctuation">(</span>String msg<span class="token punctuation">,</span> SchedulerException cause<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerInStandbyMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulerShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">schedulingDataCleared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  </code></pre><p>è°ƒåº¦ç›‘å¬å™¨æ³¨å†Œåˆ°è°ƒåº¦å™¨çš„ç›‘å¬ç®¡ç†å™¨ä¸­ï¼Œè°ƒåº¦ç›‘å¬å™¨å®é™…ä¸Šå¯ä»¥æ˜¯å®ç°org.quartz.SchedulerListeneræ¥å£çš„ä»»ä½•å¯¹è±¡ã€‚</p><p>æ·»åŠ è°ƒåº¦ç›‘å¬å™¨</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æ—§ç‰ˆ</span>scheduler<span class="token punctuation">.</span><span class="token function">addSchedulerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpSchedulerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ·»åŠ è‡ªå®šä¹‰è°ƒåº¦å™¨ç›‘å¬</span><span class="token comment" spellcheck="true">//æ–°ç‰ˆ since 2.0</span>scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addSchedulerListener</span><span class="token punctuation">(</span>mySchedListener<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç§»é™¤è°ƒåº¦ç›‘å¬å™¨</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//æ—§ç‰ˆ</span>scheduler<span class="token punctuation">.</span><span class="token function">removeSchedulerListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpSchedulerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ç§»é™¤è‡ªå®šä¹‰è°ƒåº¦å™¨ç›‘å¬</span><span class="token comment" spellcheck="true">//æ–°ç‰ˆ since 2.0</span>scheduler<span class="token punctuation">.</span><span class="token function">getListenerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeSchedulerListener</span><span class="token punctuation">(</span>mySchedListener<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="äº”ã€Job-Stores"><a href="#äº”ã€Job-Stores" class="headerlink" title="äº”ã€Job Stores"></a>äº”ã€Job Stores</h3><p>JobStoreè´Ÿè´£è·Ÿè¸ªæ‚¨æä¾›ç»™è°ƒåº¦ç¨‹åºçš„æ‰€æœ‰â€œå·¥ä½œæ•°æ®â€ï¼šjobsï¼Œtriggersï¼Œæ—¥å†ç­‰ã€‚ </p><p><code>JobStore</code>å…¶å®å°±æ˜¯å®šæ—¶ä»»åŠ¡çš„ç›¸å…³æ•°æ®å­˜å‚¨ã€‚</p><p>æ”¯æŒå­˜å‚¨æ–¹å¼æœ‰ï¼š</p><p>ï¼ˆ1ï¼‰RAMJobStore å†…å­˜å®šæ—¶æ•°æ®å­˜å‚¨ã€‚</p><p>ï¼ˆ2ï¼‰JDBC JobStore é€šè¿‡JDBCå°†å…¶æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚</p><p>ï¼ˆ3ï¼‰TerracottaJobStore TerracottaJobStoreç”¨äºåœ¨é›†ç¾¤æœåŠ¡å™¨å†…å­˜å‚¨è°ƒåº¦ä¿¡æ¯ï¼ˆJobsï¼ŒTriggerså’Œcalendarsï¼‰ </p><h4 id="RAMJobStore"><a href="#RAMJobStore" class="headerlink" title="RAMJobStore"></a>RAMJobStore</h4><p>RAMJobStoreæ˜¯ä½¿ç”¨æœ€ç®€å•çš„JobStoreï¼Œé…ç½®ç®€å•ï¼Œæ€§èƒ½æœ€é«˜çš„ï¼ˆåœ¨CPUæ—¶é—´æ–¹é¢ï¼‰ã€‚RAMJobStoreä»¥å…¶æ˜æ˜¾çš„æ–¹å¼è·å–å…¶åç§°ï¼Œå®ƒå°†å…¶æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨RAMä¸­ã€‚ç¼ºç‚¹æ˜¯å½“æ‚¨çš„åº”ç”¨ç¨‹åºç»“æŸï¼ˆæˆ–å´©æºƒï¼‰æ—¶ï¼Œæ‰€æœ‰è°ƒåº¦ä¿¡æ¯éƒ½å°†ä¸¢å¤±  - è¿™æ„å‘³ç€RAMJobStoreæ— æ³•å±¥è¡Œä½œä¸šå’Œtriggersä¸Šçš„â€œéæ˜“å¤±æ€§â€è®¾ç½®ã€‚</p><p>ä½¿ç”¨RAMJobStore ï¼Œåªéœ€å°†ç±»åç§°org.quartz.simpl.RAMJobStoreæŒ‡å®šä¸ºç”¨äºé…ç½®çŸ³è‹±çš„JobStoreç±»å±æ€§ï¼š</p><p>é…ç½®Quartzä»¥ä½¿ç”¨RAMJobStore</p><pre><code>org.quartz.jobStore.class = org.quartz.simpl.RAMJobStore</code></pre><p>å…¶å®åœ¨æ²¡æœ‰JDBCçš„æƒ…å†µä¸‹ï¼Œé»˜è®¤å°±æ˜¯RAMJobStoreã€‚</p><h4 id="JDBC-JobStore"><a href="#JDBC-JobStore" class="headerlink" title="JDBC JobStore"></a>JDBC JobStore</h4><p>JDBCJobStoreå‡ ä¹æ”¯æŒä¸ä»»ä½•æ•°æ®åº“ä¸€èµ·ä½¿ç”¨ï¼Œå·²è¢«å¹¿æ³›åº”ç”¨äºOracleï¼ŒPostgreSQLï¼ŒMySQLï¼ŒMS SQLServerï¼ŒHSQLDBå’ŒDB2ã€‚ </p><p>æ•°æ®åº“ä¸­å„è¡¨çš„å«ä¹‰ï¼š</p><table><thead><tr><th>è¡¨å</th><th>è¡¨å­˜å‚¨ä¿¡æ¯è¯´æ˜</th></tr></thead><tbody><tr><td>qrtz_blob_triggers</td><td>è¿™å¼ è¡¨ç¤ºå­˜å‚¨è‡ªå·±å®šä¹‰çš„triggerï¼Œä¸æ˜¯quartzè‡ªå·±æä¾›çš„trigger</td></tr><tr><td>qrtz_calendars</td><td>å­˜å‚¨Calendar</td></tr><tr><td>qrtz_cron_triggers</td><td>å­˜å‚¨cronTrigger</td></tr><tr><td>qrtz_fired_triggers</td><td>å­˜å‚¨è§¦å‘çš„Tirgger</td></tr><tr><td>qrtz_job_details</td><td>å­˜å‚¨JobDetail</td></tr><tr><td>qrtz_locks</td><td>å­˜å‚¨ç¨‹åºä¸­éæ‚²è§‚é”çš„ä¿¡æ¯</td></tr><tr><td>qrtz_paused_trigger_grps</td><td>å­˜å‚¨å·²æš‚åœçš„Triggerç»„ä¿¡æ¯</td></tr><tr><td>qrtz_scheduler_state</td><td>å­˜å‚¨é›†ç¾¤ä¸­noteå®ä¾‹ä¿¡æ¯ï¼Œquartzä¼šå®šæ—¶è¯»å–è¯¥è¡¨çš„ä¿¡æ¯åˆ¤æ–­é›†ç¾¤ä¸­ æ¯ä¸ªå®ä¾‹çš„å½“å‰çŠ¶æ€</td></tr><tr><td>qrtz_simple_triggers</td><td>å­˜å‚¨simpleTriggerçš„ä¿¡æ¯</td></tr><tr><td>qrtz_simprop_triggers</td><td>å‚¨å­˜CalendarIntervalTriggerå’ŒDailyTimeIntervalTriggerçš„ä¿¡æ¯</td></tr><tr><td>qrtz_triggers</td><td>å­˜å‚¨å·²é…ç½®çš„triggerä¿¡æ¯</td></tr></tbody></table><h3 id="å…­ã€å…¶ä»–"><a href="#å…­ã€å…¶ä»–" class="headerlink" title="å…­ã€å…¶ä»–"></a>å…­ã€å…¶ä»–</h3><p>åç»­å†è¡¥å……</p><br/><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="a516f8e8.html">å®šæ—¶ä»»åŠ¡ä¹‹Javaå®šæ—¶API</a><br><a href="5a5ab620.html">å®šæ—¶ä»»åŠ¡ä¹‹Spring Task</a><br><a href="6ddb3c14.html">å®šæ—¶ä»»åŠ¡ä¹‹quartz</a></p><br/><p>æœ¬æ–‡æ•´ç†å‚è€ƒä»¥ä¸‹å‰è¾ˆé“¾æ¥ï¼Œæ”¾ä¸ªé“¾æ¥ï¼Œä»¥ç¤ºæ„Ÿè°¢ï¼š</p><ul><li>å‚è€ƒæ–‡ç« 1ï¼š<a href="https://blog.csdn.net/chengqiuming/java/article/details/84144534" target="_blank" rel="noopener">https://blog.csdn.net/chengqiuming/java/article/details/84144534</a></li><li>å‚è€ƒæ–‡ç« 2ï¼š<a href="https://www.cnblogs.com/kyleinjava/p/10432168.html" target="_blank" rel="noopener">https://www.cnblogs.com/kyleinjava/p/10432168.html</a></li><li>å‚è€ƒæ–‡ç« 3ï¼š<a href="http://www.quartz-scheduler.org/documentation/quartz-2.3.0/" target="_blank" rel="noopener">http://www.quartz-scheduler.org/documentation/quartz-2.3.0/</a></li><li>å‚è€ƒæ–‡ç« 4ï¼š<a href="https://www.w3cschool.cn/quartz_doc/" target="_blank" rel="noopener">https://www.w3cschool.cn/quartz_doc/</a></li></ul><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> å®šæ—¶ä»»åŠ¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quartz </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®šæ—¶ä»»åŠ¡ä¹‹Spring Task</title>
      <link href="/posts/5a5ab620.html"/>
      <url>/posts/5a5ab620.html</url>
      
        <content type="html"><![CDATA[<h2 id="å®šæ—¶ä»»åŠ¡ä¹‹Spring-Task"><a href="#å®šæ—¶ä»»åŠ¡ä¹‹Spring-Task" class="headerlink" title="å®šæ—¶ä»»åŠ¡ä¹‹Spring Task"></a>å®šæ—¶ä»»åŠ¡ä¹‹Spring Task</h2><blockquote><p>æœ¬æ–‡ä¸»è¦è®°å½•å­¦ä¹ Spring Taskçš„ç›¸å…³å†…å®¹ã€‚<br>  æ•´ç†äº2020-06-25ï¼Œæœ€åæ›´æ–°2020-07-18ã€‚</p></blockquote><h2 id="ä¸€ã€ç®€è¿°"><a href="#ä¸€ã€ç®€è¿°" class="headerlink" title="ä¸€ã€ç®€è¿°"></a>ä¸€ã€ç®€è¿°</h2><blockquote><p>Spring 3.0ä»¥åæ¨å‡ºçš„å®šæ—¶å™¨ç±»è°ƒåº¦å·¥å…·ï¼ŒSpring Taskæ˜¯ä¸€ä¸ªè½»é‡çº§çš„quartzã€‚</p><p>é…ç½®ç®€å•ï¼ŒåŠŸèƒ½è¾ƒä¸ºé½å…¨ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ç»å¸¸ä¼šç”¨åˆ°ã€‚</p><p>spring taskåœ¨spring-contextçš„æ¨¡å—ä¸­ï¼Œæ— éœ€å•ç‹¬å¼•å…¥ã€‚</p><p>spring taskæ”¯æŒxmlé…ç½®ã€æ³¨è§£é…ç½®ã€javaé…ç½®ä¸‰ç§æ–¹å¼ã€‚æœ¬æ–‡åˆ†åˆ«æ¼”ç¤º3ç§ä¸åŒçš„ä½¿ç”¨æ–¹å¼ã€‚</p></blockquote><p>å…³äºè°ƒåº¦çš„å®ç°æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼š</p><p>ï¼ˆ1ï¼‰Javaè‡ªå¸¦çš„Apiæœ‰ä¸ªTimerç±»å’ŒTimerTaskç±»ã€‚</p><p>ï¼ˆ2ï¼‰Springè‡ªå¸¦çš„Spring Taskè°ƒåº¦å·¥å…·ã€‚</p><p>ï¼ˆ3ï¼‰Quartzï¼ˆè¯»é˜”å­ï¼‰å¼€æºæ¡†æ¶ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä½¿ç”¨èµ·æ¥ç¨æ˜¾å¤æ‚ã€‚</p><p>æœ¬æ–‡ä¸»è¦è®°å½•ç¬¬äºŒç§ã€‚å…¶ä»–ä¸¤ç§è¯·å‚è€ƒæ–‡ç« åº•éƒ¨ç›¸å…³æ–‡ç« ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰éœ€è¦è¯´æ˜æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„å‡ ä¸ªç»„ä»¶ï¼š</p><p>ï¼ˆAï¼‰æ‰§è¡Œçš„ä»»åŠ¡ç±»ï¼›</p><p>ï¼ˆBï¼‰è§¦å‘ä»»åŠ¡çš„è§¦å‘å™¨ï¼›</p><p>ï¼ˆCï¼‰ç®¡ç†ä»»åŠ¡çš„ä»»åŠ¡è°ƒåº¦å™¨ã€‚</p><p>åç»­é…ç½®éƒ½æ˜¯ä»¥è¿™ä¸‰ç‚¹ä¸ºä¸­å¿ƒè¿›è¡Œçš„ã€‚</p><h2 id="äºŒ-Spring-Task-ä½¿ç”¨æ–¹å¼"><a href="#äºŒ-Spring-Task-ä½¿ç”¨æ–¹å¼" class="headerlink" title="äºŒ Spring Task ä½¿ç”¨æ–¹å¼"></a>äºŒ Spring Task ä½¿ç”¨æ–¹å¼</h2><h3 id="1ã€XMLæ–¹æ³•"><a href="#1ã€XMLæ–¹æ³•" class="headerlink" title="1ã€XMLæ–¹æ³•"></a>1ã€XMLæ–¹æ³•</h3><p>XMLç®—æ˜¯æ¯”è¾ƒä¼ ç»Ÿçš„æ–¹å¼ï¼Œéœ€è¦æ‰‹å·¥é…ç½®</p><p>å®ä¾‹ï¼š</p><p>æ‰§è¡Œçš„ä»»åŠ¡ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>job<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token punctuation">.</span>out<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserTask</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" this is  user task "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>XMLé…ç½®ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userTask<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.xiaocai.job.TaskTest<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">task:</span>scheduled-tasks</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">task:</span>scheduled</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>userTask<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>doSomething<span class="token punctuation">"</span></span> <span class="token attr-name">cron</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0/5 * * * * ?<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">task:</span>scheduled-tasks</span><span class="token punctuation">></span></span></code></pre><p>cronå°±æ˜¯æ‰§è¡Œè¡¨è¾¾å¼ï¼š<code>0/5 * * * * ?</code>è¡¨ç¤ºæ¯5sæ‰§è¡Œä¸€æ¬¡ã€‚</p><p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p><p><code>scheduled-tasks</code> ï¼šè°ƒåº¦ä»»åŠ¡æ± ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªä»»åŠ¡taskï¼Œè¿™é‡ŒæŒ‡å®šäº†ä¸€ä¸ªä»»åŠ¡taskã€‚</p><p><code>scheduled</code>ï¼šå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè°ƒåº¦å®ä¾‹ã€‚å…¶ä¸­ï¼š<code>ref</code>è¡¨ç¤ºè°ƒåº¦çš„æ‰§è¡Œä»»åŠ¡ç±»ï¼Œ<code>method</code>è¡¨ç¤ºæ‰§è¡Œä»»åŠ¡ç±»ä¸­çš„è°ƒåº¦çš„æ–¹æ³•ï¼›<code>cron</code>è°ƒåº¦æ‰§è¡Œæ—¶é—´é¢‘æ¬¡è¡¨è¾¾å¼ï¼Œä¸€èˆ¬é¡ºåºæ˜¯ï¼Œ<code>ç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨ å¹´</code>ï¼Œå¹´é€šå¸¸éƒ½ä¼šçœç•¥ã€‚å…·ä½“çš„è¡¨è¾¾å¼è§„åˆ™ï¼Œå•ç‹¬å‚è€ƒã€Šå®šæ—¶ä»»åŠ¡Cronçš„ä½¿ç”¨ã€‹ã€‚</p><p><code>task</code>ä¸­ç”¨äºæŒ‡å®šæ—¶é—´é¢‘ç‡çš„æ–¹å¼ä¸»è¦æœ‰ï¼š</p><p>ï¼ˆ1ï¼‰<code>cron</code> å®šæ—¶è¡¨è¾¾å¼æ¨¡å¼ã€‚</p><p>ï¼ˆ2ï¼‰fixed-rateï¼šå›ºå®šé¢‘æ¬¡æ‰§è¡Œã€‚å•ä½æ¯«ç§’ï¼Œæ¯éš”æŒ‡å®šæ—¶é—´æ‰§è¡Œä¸€æ¬¡</p><p>ï¼ˆ3ï¼‰fixed-delayï¼šå›ºå®šå»¶è¿Ÿæ‰§è¡Œã€‚å•ä½æ¯«ç§’ï¼Œä¸Šæ¬¡æ‰§è¡Œä»»åŠ¡å®Œæˆåï¼Œé—´éš”æŒ‡å®šæ—¶é—´åæ‰§è¡Œä¸‹æ¬¡ä»»åŠ¡ã€‚</p><p>ï¼ˆ4ï¼‰initial-delayï¼šé¦–æ¬¡æ‰§è¡Œå»¶è¿Ÿã€‚å•ä½æ¯«ç§’ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œå»¶è¿ŸæŒ‡å®šæ—¶é—´å†æ‰§è¡Œã€‚</p><blockquote><p>spring task é»˜è®¤ä½¿ç”¨çš„æ˜¯åŒæ­¥æ¨¡å¼ï¼Œå³ä¸Šæ¬¡ä»»åŠ¡æ‰§è¡Œå®Œåï¼Œæ‰ä¼šæ‰§è¡Œä¸‹æ¬¡ä»»åŠ¡ã€‚ä¸Šè¿°æ—¶é—´é¢‘ç‡åªæœ‰åœ¨éåŒæ­¥æ¨¡å¼ä¸‹æ‰ä¼šå®Œå…¨ç¬¦åˆï¼Œåœ¨åŒæ­¥æ¨¡å¼ä¸‹ï¼Œå®é™…è®¡ç®—æ–¹å¼ä¸ºï¼š<br> <strong>fixed-rate</strong> ï¼šä»»åŠ¡çš„å®é™…æ‰§è¡Œæ—¶é—´+fixedRateæ—¶é—´ä¹‹åï¼Œæ‰§è¡Œä¸‹æ¬¡ä»»åŠ¡<br> <strong>fixed-delay</strong>ï¼šä»»åŠ¡çš„å®é™…æ‰§è¡Œæ—¶é—´å¦‚æœå°äºfixedDelayï¼Œåˆ™æ—¶é—´é—´éš”ä¸ºfixedDelayï¼›å¦‚æœä»»åŠ¡çš„å®é™…æ‰§è¡Œæ—¶é—´å¤§äºfixedDelayï¼Œåˆ™ä¸Šæ¬¡ä»»åŠ¡æ‰§è¡Œå®Œåï¼Œç«‹å³æ‰§è¡Œä¸‹ä¸€æ¬¡ä»»åŠ¡ã€‚</p></blockquote><p><strong>é€‚ç”¨åœºæ™¯</strong></p><p>é€‚åˆçš„å®šæ—¶ä»»åŠ¡ï¼Œæ¯”è¾ƒç¨³å®šã€ä¸ç»å¸¸å˜åŒ–ï¼Œæ“ä½œï¼Œæ—¥å¿—è¦æ±‚ä¸ä¸¥æ ¼ã€‚</p><h3 id="2ã€æ³¨è§£é…ç½®"><a href="#2ã€æ³¨è§£é…ç½®" class="headerlink" title="2ã€æ³¨è§£é…ç½®"></a>2ã€æ³¨è§£é…ç½®</h3><p>æ‰§è¡Œä»»åŠ¡ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>job<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token punctuation">.</span>out<span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserTask</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0 0/5 * * * ?"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Async</span><span class="token punctuation">(</span><span class="token string">"executor"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomethingAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" this is  user task for Annotation "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é…ç½®æ–¹å¼åˆ†æœ‰XMLå’Œæ— XMLã€‚</p><p>ï¼ˆAï¼‰æœ‰XMLçš„é…ç½®ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- å®šæ—¶ä»»åŠ¡é…ç½® scheduler æ³¨è§£æ–¹å¼  --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">task:</span>executor</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>executor<span class="token punctuation">"</span></span> <span class="token attr-name">pool-size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">task:</span>scheduler</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scheduler<span class="token punctuation">"</span></span> <span class="token attr-name">pool-size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">task:</span>annotation-driven</span> <span class="token attr-name">executor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>executor<span class="token punctuation">"</span></span> <span class="token attr-name">scheduler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scheduler<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">&lt;!-- å¯ç”¨æ³¨è§£ --></span>&lt;</code></pre><p>å‚æ•°è¯´æ˜ï¼š**</p><p><code>@Async</code>ï¼šspringå¼‚æ­¥æ¨¡å¼æ”¯æŒï¼Œ<code>@Async</code>çš„å€¼ä¸ºæ‰§è¡Œå™¨<code>executor</code>ï¼Œå†…éƒ¨é»˜è®¤ä¸ºåä¸º<code>SimpleAsyncTaskExecutor</code>çš„çº¿ç¨‹æ± æ¥æ‰§è¡Œä»»åŠ¡ã€‚åå­—éœ€è¦ä¸xmlä¸­é…ç½®çš„ä¸€è‡´ã€‚å¦‚æœä¸è¦æ±‚å¼‚æ­¥ï¼Œè¯¥æ³¨è§£å¯ç•¥ã€‚<code>@Async</code>ä½¿ç”¨ä¹‹åï¼Œæ–¹æ³•ä»ç„¶æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥åŒæ­¥æ‰§è¡Œçš„ã€‚</p><p><code>executor</code>ï¼šç”¨äºé…ç½®çº¿ç¨‹æ± ã€‚<code>pool-size</code>ï¼šçº¿ç¨‹æ± æ•°é‡ï¼Œå¯è®¾ç½®èŒƒå›´ï¼Œä¹Ÿå¯è®¾ç½®æŒ‡å®šå€¼ï¼Œå–å€¼èŒƒå›´[ 1ï¼Œ<code>Integer.MAX_VALUE</code>]ã€‚</p><p><code>scheduler</code>ï¼šç”¨äºé…ç½®ä»»åŠ¡è°ƒåº¦å™¨ã€‚<code>pool-size</code>ï¼šè°ƒåº¦æ± æ•°é‡ï¼Œå¯è®¾ç½®èŒƒå›´ï¼Œä¹Ÿå¯è®¾ç½®æŒ‡å®šå€¼ï¼Œå–å€¼èŒƒå›´[ 1ï¼Œ<code>Integer.MAX_VALUE</code>]ã€‚</p><p>å•°å—¦ä¸€å¥ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨<code>@Component</code>æˆ–<code>@Service</code>æ³¨è§£ï¼Œåˆ™yè¦é…ç½®ä¸€ä¸‹æ‰§è¡Œä»»åŠ¡æ çš„<code>bean</code>ï¼Œå¤šä¸ªæ‰§è¡Œä»»åŠ¡ç±»å¯ä»¥æ‰§è¡Œæ‰«æåŒ…ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.xiaocai.job<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> </code></pre><p>ï¼ˆBï¼‰æ— XMLé…ç½®ï¼š</p><p>å¦‚<code>springboot</code>ä¸­ä½¿ç”¨ï¼Œç›´æ¥åœ¨å¯åŠ¨ç±»æ·»åŠ è°ƒåº¦æ³¨è§£å³å¯ã€‚<code>@EnableScheduling</code>æ˜¯åœ¨Spring 3.1ä¹‹åå¯ä»¥ä½¿ç”¨ã€‚</p><p>å¦‚æœéœ€è¦å¼€å¯å¹¶è¡Œæ‰§è¡Œï¼Œä½¿ç”¨å¼‚æ­¥æ³¨è§£ã€‚åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥<code>@EnableAsync</code>ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>web<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>EnableScheduling<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>EnableTransactionManagement<span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableAsync</span><span class="token annotation punctuation">@EnableScheduling</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimeTaskApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>TimeTaskApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>web<span class="token punctuation">.</span>job<span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserTask</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//@Scheduled(cron = "0 0/5 * * * ?")</span>    <span class="token comment" spellcheck="true">//@Scheduled(fixedDelayString="3000")</span>    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>fixedRate<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doUserHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" --- "</span><span class="token operator">+</span>LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"-- task for Annotation "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ‰§è¡Œç»“æœï¼š</p><pre class=" language-txt"><code class="language-txt"> --- 2020-06-25T16:08:18.455-- task for Annotation  --- 2020-06-25T16:08:20.458-- task for Annotation --- 2020-06-25T16:08:22.460-- task for Annotation --- 2020-06-25T16:08:24.463-- task for Annotation --- 2020-06-25T16:08:26.455-- task for Annotation </code></pre><p>æ³¨è§£ä¸­ï¼Œé™¤äº†<code>@Scheduled(fixedRate=2000)</code>å’Œ<code>@Scheduled(cron = &quot;0 0/5 * * * ?&quot;)</code>è¿˜æœ‰<code>fixedRateString</code>ã€<code>fixedDelay</code>ã€<code>fixedDelayString</code>ã€<code>initialDelay</code>ã€<code>initialDelayString</code>ç­‰å¯ä»¥è‡ªè¡Œå°è¯•ã€‚</p><p><strong>é€‚ç”¨åœºæ™¯</strong></p><p>ä¸XMLä½¿ç”¨ç±»ä¼¼ï¼ŒæŠŠXMLå˜æˆäº†æ³¨è§£ã€‚å¯ä»¥é…åˆspringå¼‚æ­¥æ³¨è§£ï¼Œå®ç°ä»»åŠ¡çº¿ç¨‹çš„å¹¶è¡Œã€‚</p><h3 id="3ã€Javaæ–¹å¼"><a href="#3ã€Javaæ–¹å¼" class="headerlink" title="3ã€Javaæ–¹å¼"></a>3ã€Javaæ–¹å¼</h3><p>ä½¿ç”¨javaæ–¹æ³•å¯ä»¥å®ç°<code>SchedulingConfigurer</code>æ¥å£çš„<code>configureTasks</code>æ–¹æ³•ã€‚åˆ©ç”¨è°ƒåº¦ä»»åŠ¡æ³¨å†Œå™¨<code>ScheduledTaskRegistrar</code>æ¥æ³¨å†Œéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚æ·»åŠ ä»»åŠ¡çš„æ–¹å¼æœ‰ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/time-task/spring-task.png" alt="æ·»åŠ ä»»åŠ¡æ–¹å¼"></p><p>ç¤ºä¾‹ï¼š</p><p>ä¸šåŠ¡æ‰§è¡Œç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>job<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BuzTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//å½“å‰ä¸šåŠ¡æ‰§è¡Œå‚æ•°</span>    <span class="token keyword">private</span> String jobData <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">BuzTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token function">BuzTask</span><span class="token punctuation">(</span>String jobData<span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">this</span><span class="token punctuation">.</span>jobData <span class="token operator">=</span> jobData<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" jobData : "</span> <span class="token operator">+</span>jobData<span class="token punctuation">)</span><span class="token punctuation">;</span>           System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" execute buzz code ..."</span> <span class="token operator">+</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getJobData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> jobData<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJobData</span><span class="token punctuation">(</span>String jobData<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>jobData <span class="token operator">=</span> jobData<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è‡ªå®šä¹‰çš„è°ƒåº¦ç®¡ç†ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>job<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>Trigger<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>TriggerContext<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>SchedulingConfigurer<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>config<span class="token punctuation">.</span>ScheduledTaskRegistrar<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>support<span class="token punctuation">.</span>CronTrigger<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeTaskUtil</span> <span class="token keyword">implements</span> <span class="token class-name">SchedulingConfigurer</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//è¿™äº›å‚æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨å•ç‹¬çš„JavaBean,æˆ–ä¿å­˜åœ¨æ•°æ®åº“</span>    <span class="token keyword">private</span>  String cron <span class="token operator">=</span><span class="token string">"0/10 * * * * ?"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> String taskName <span class="token operator">=</span> <span class="token string">"Schedule_"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> String jobData <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å…¬å…±æ‰§è¡Œå‚æ•°</span>    <span class="token keyword">private</span> BuzTask buzTask<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureTasks</span><span class="token punctuation">(</span>ScheduledTaskRegistrar taskRegistrar<span class="token punctuation">)</span> <span class="token punctuation">{</span>        buzTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BuzTask</span><span class="token punctuation">(</span>jobData<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ³¨å†Œè°ƒåº¦ä»»åŠ¡</span>        taskRegistrar<span class="token punctuation">.</span><span class="token function">addTriggerTask</span><span class="token punctuation">(</span>buzTask<span class="token punctuation">,</span> <span class="token function">getTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>   <span class="token comment" spellcheck="true">/**ï¼ˆä¹Ÿå¯ä»¥åƒä»»åŠ¡æ‰§è¡Œç±»ä¸€æ ·å†™åœ¨å¤–é¢ï¼‰    * ä¸šåŠ¡è§¦å‘å™¨    * @return    */</span>   <span class="token keyword">private</span> Trigger <span class="token function">getTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token annotation punctuation">@Override</span>           <span class="token keyword">public</span> Date <span class="token function">nextExecutionTime</span><span class="token punctuation">(</span>TriggerContext triggerContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token comment" spellcheck="true">// è§¦å‘å™¨</span>               CronTrigger trigger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CronTrigger</span><span class="token punctuation">(</span>cron<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">return</span> trigger<span class="token punctuation">.</span><span class="token function">nextExecutionTime</span><span class="token punctuation">(</span>triggerContext<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>       <span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//getter setter   </span><span class="token punctuation">}</span></code></pre><p>Controllerç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>job<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Controller<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMapping<span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> SomeTaskUtil someTaskUtil <span class="token punctuation">;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/timeTask"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> String <span class="token function">timeTask</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//è¿™é‡Œè·³æµ‹è¯•é¡µé¢ï¼Œé¡µé¢å°±ä¸‰ä¸ªæ–‡æœ¬æ¡†ç”¨æ¥ä¼ ï¼ŒtaskName ï¼Œcronï¼ŒjobData</span>        <span class="token keyword">return</span> <span class="token string">"timeTask"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/timeTask/changeCron"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> <span class="token function">changeCron</span><span class="token punctuation">(</span>String taskName<span class="token punctuation">,</span>String cron<span class="token punctuation">,</span>String jobData<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" taskName "</span><span class="token operator">+</span>taskName<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" cron "</span><span class="token operator">+</span>taskName<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" jobData "</span> <span class="token operator">+</span> taskName<span class="token punctuation">)</span><span class="token punctuation">;</span>        someTaskUtil<span class="token punctuation">.</span><span class="token function">setTaskName</span><span class="token punctuation">(</span>taskName<span class="token punctuation">)</span><span class="token punctuation">;</span>        someTaskUtil<span class="token punctuation">.</span><span class="token function">setCron</span><span class="token punctuation">(</span>cron<span class="token punctuation">)</span><span class="token punctuation">;</span>        someTaskUtil<span class="token punctuation">.</span><span class="token function">getBuzTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setJobData</span><span class="token punctuation">(</span>jobData<span class="token punctuation">)</span><span class="token punctuation">;</span>        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"change success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> map<span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>ç®€å•çš„HTMLé¡µé¢ <code>timeTask.html</code>ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE HTML></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>ä¿®æ”¹å®šæ—¶å‚æ•°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://code.jquery.com/jquery-3.1.1.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../static/js/jquery-3.2.1.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bootstrap3.3.7/css/bootstrap.min.css<span class="token punctuation">"</span></span>          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>panel-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@{<span class="token punctuation">'</span>/timeTask/changeCron<span class="token punctuation">'</span>}<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group form-inline<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>txttaskName<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-md-3 control-label<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name">                   <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ä»»åŠ¡åç§°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-md-9<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-md-9 form-control<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>taskName<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>taskName<span class="token punctuation">"</span></span>                       <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>è¯·è¾“å…¥ä»»åŠ¡åç§°<span class="token punctuation">"</span></span>                       <span class="token attr-name">required</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>required<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group form-inline<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">padding-top</span><span class="token punctuation">:</span><span class="token number">45</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>txtcron<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-sm-3 control-label<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name">                   <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å®šæ—¶è¡¨è¾¾å¼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-md-9<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-sm-9 form-control<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cron<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cron<span class="token punctuation">"</span></span>                       <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>è¯·è¾“å…¥å®šæ—¶è¡¨è¾¾å¼<span class="token punctuation">"</span></span>  <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group form-inline<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">padding-top</span><span class="token punctuation">:</span><span class="token number">45</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>txtjobData<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-sm-3 control-label<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name">                   <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ä»»åŠ¡å‚æ•°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-md-9<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-sm-9 form-control<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jobData<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jobData<span class="token punctuation">"</span></span>                       <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>è¯·è¾“å…¥ä»»åŠ¡å‚æ•°<span class="token punctuation">"</span></span>  <span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-md-offset-3 col-md-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn btn-primary btn-block<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>action<span class="token punctuation">"</span></span>                        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>login<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ‰§è¡Œ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>åœ¨æµè§ˆå™¨è¾“å…¥ï¼š<code>http://localhost:8080/timeTask</code></p><p>è¾“å…¥å‚æ•°ï¼š</p><pre><code>taskName ï¼šjobName1cron ï¼š0/20 * * * * ?jobData ï¼š123</code></pre><p>é¡µé¢è¿”å›äº† {â€œresultâ€:â€change successâ€}</p><p>æ‰§è¡Œç»“æœï¼š</p><pre class=" language-txt"><code class="language-txt"> jobData :  execute buzz code ...2020-06-25T11:32:50.007 jobData :  execute buzz code ...2020-06-25T11:33:00.001 jobData :  execute buzz code ...2020-06-25T11:33:10.002 jobData :  execute buzz code ...2020-06-25T11:33:20.001 jobData :  execute buzz code ...2020-06-25T11:33:30.002 taskName ï¼šjobName1 cron ï¼š0/20 * * * * ? jobData ï¼š123 jobData : execute buzz code ...2020-06-25T11:33:40 jobData ï¼š123 execute buzz code ...2020-06-25T11:34:00.002 jobData ï¼š123 execute buzz code ...2020-06-25T11:34:20.001 jobData ï¼š123 execute buzz code ...2020-06-26T11:34:40.001</code></pre><p>åŸæ¥è®¾ç½®çš„æ‰§è¡Œé¢‘æ¬¡æ˜¯10ç§’æ‰§è¡Œä¸€æ¬¡ï¼ŒjobDataæ˜¯ç©ºå­—ç¬¦ä¸²ã€‚</p><p>é¡µé¢æ“ä½œä¹‹åæ‰§è¡Œé¢‘æ¬¡æ˜¯20ç§’æ‰§è¡Œä¸€æ¬¡ï¼ŒjobDataå€¼æ˜¯<code>123</code>ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œjavaæ–¹æ³•å®šæ—¶çš„å¥½å¤„ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹å®šæ—¶ä»»åŠ¡æ‰§è¡Œå‚æ•°ã€‚å‚æ•°å¯ä»¥ä»æ•°æ®åº“æ‹¿ï¼Œä¹Ÿå¯ä»¥åœ¨é¡µé¢åŠæ—¶è¾“å…¥ï¼Œæ€»ä¹‹æ¯”è¾ƒçµæ´»ã€‚åº”è¯¥é€‚åˆå¤§å¤šæ•°åœºæ™¯ã€‚</p><br/><p>æœ¬æ–‡æ•´ç†å‚è€ƒä»¥ä¸‹å‰è¾ˆé“¾æ¥ï¼Œæ”¾ä¸ªé“¾æ¥ï¼Œä»¥ç¤ºæ„Ÿè°¢ï¼š</p><ul><li>å‚è€ƒæ–‡ç« 1ï¼š<a href="https://www.jianshu.com/p/2996afb2c224" target="_blank" rel="noopener">https://www.jianshu.com/p/2996afb2c224</a></li><li>å‚è€ƒæ–‡ç« 2ï¼š<a href="https://blog.csdn.net/HXNLYW/article/details/88187802" target="_blank" rel="noopener">https://blog.csdn.net/HXNLYW/article/details/88187802</a></li><li>å‚è€ƒæ–‡ç« 3ï¼š<a href="https://blog.csdn.net/bjmsb/article/details/105997128" target="_blank" rel="noopener">https://blog.csdn.net/bjmsb/article/details/105997128</a></li><li>å‚è€ƒæ–‡ç« 4ï¼š<a href="https://blog.csdn.net/bjmsb/article/details/105997128" target="_blank" rel="noopener">https://blog.csdn.net/bjmsb/article/details/105997128</a></li></ul><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> å®šæ—¶ä»»åŠ¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Task </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®šæ—¶ä»»åŠ¡ä¹‹Javaå®šæ—¶API</title>
      <link href="/posts/a516f8e8.html"/>
      <url>/posts/a516f8e8.html</url>
      
        <content type="html"><![CDATA[<h2 id="å®šæ—¶ä»»åŠ¡ä¹‹Javaå®šæ—¶ä»»åŠ¡API"><a href="#å®šæ—¶ä»»åŠ¡ä¹‹Javaå®šæ—¶ä»»åŠ¡API" class="headerlink" title="å®šæ—¶ä»»åŠ¡ä¹‹Javaå®šæ—¶ä»»åŠ¡API"></a>å®šæ—¶ä»»åŠ¡ä¹‹Javaå®šæ—¶ä»»åŠ¡API</h2><blockquote><p>æœ¬æ¥è€æ—©å°±å‡†å¤‡æ•´ç†çš„ï¼Œåé¢å…ˆå»æ•´ç†Spring Task å’Œ Quartz çš„ï¼Œç„¶ååˆå»æå…¶ä»–çš„äº†ã€‚æˆ‘ä¹Ÿæœ‰ç‚¹çŠ¹è±«è¦ä¸è¦æ•´ç†è¿™ä¸ªï¼Œæ¯•ç«Ÿç°åœ¨åŸºæœ¬ä¸æ€ç”¨è¿™ä¸ªAPIäº†ã€‚ä¸ºäº†å®Œæ•´æ€§ï¼Œè¿˜æ˜¯æ•´ç†ä¸€ä¸‹å§ï¼Œä½œä¸ºçŸ¥è¯†é¢äº†è§£ä¸€ä¸‹ã€‚è€Œä¸”ä»¥å‰åœ¨é¡¹ç›®ä¸­è¿˜ä½¿ç”¨äº†ã€‚</p></blockquote><h2 id="ä¸€ã€å®šæ—¶ä»»åŠ¡ç®€è¿°"><a href="#ä¸€ã€å®šæ—¶ä»»åŠ¡ç®€è¿°" class="headerlink" title="ä¸€ã€å®šæ—¶ä»»åŠ¡ç®€è¿°"></a>ä¸€ã€å®šæ—¶ä»»åŠ¡ç®€è¿°</h2><p>å…³äºè°ƒåº¦çš„å®ç°æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼š</p><p>ï¼ˆ1ï¼‰Javaè‡ªå¸¦çš„Apiæœ‰ä¸ªTimerç±»å’ŒTimerTaskç±»ã€‚</p><p>ï¼ˆ2ï¼‰Springè‡ªå¸¦çš„Spring Taskè°ƒåº¦å·¥å…·ã€‚</p><p>ï¼ˆ3ï¼‰Quartzï¼ˆè¯»é˜”å­ï¼‰å¼€æºæ¡†æ¶ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä½¿ç”¨èµ·æ¥ç¨æ˜¾å¤æ‚ã€‚</p><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ç¬¬äºŒç§ã€‚</p><p>å…¶ä»–ä¸¤ç§è¯·å‚è€ƒï¼šã€ŠJavaå®šæ—¶ä»»åŠ¡ã€‹ã€ŠQuartzä½¿ç”¨ã€‹</p><p>åœ¨å¼€å§‹ä¹‹å‰éœ€è¦è¯´æ˜æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„å‡ ä¸ªç»„ä»¶ï¼š</p><p>ï¼ˆAï¼‰æ‰§è¡Œçš„ä»»åŠ¡ç±»ï¼›</p><p>ï¼ˆBï¼‰è§¦å‘ä»»åŠ¡çš„è§¦å‘å™¨ï¼›</p><p>ï¼ˆCï¼‰ç®¡ç†ä»»åŠ¡çš„ä»»åŠ¡è°ƒåº¦å™¨ã€‚</p><p>æœ¬æ¬¡æ•´ç†çš„æ˜¯Javaè‡ªå¸¦çš„ä»»åŠ¡è°ƒåº¦APIã€‚</p><p>Javaä¸­å®ç°å®šæ—¶ä»»åŠ¡çš„APIï¼Œæ¯”è¾ƒå¤è€äº†ï¼Œjdk3ä¹‹åæ‰æœ‰çš„ã€‚ç°åœ¨ç”¨çš„éå¸¸éå¸¸å°‘äº†ã€‚é€šè¿‡<code>Timer</code>ç±»å®ç°ä»»åŠ¡è°ƒåº¦ï¼Œä»»åŠ¡æ‰§è¡Œåˆ™å¯ä»¥ç»§æ‰¿<code>TimerTask</code>æ¥å£æˆ–è€…ç›´æ¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»ã€‚</p><p>åŸºæœ¬ç»„ä»¶</p><p>ï¼ˆ1ï¼‰ä»»åŠ¡è°ƒåº¦ç®¡ç†çš„<code>Timer</code>ç±»ï¼Œ</p><p>ï¼ˆ2ï¼‰ä»»åŠ¡æ‰§è¡Œæ¥å£<code>TimerTask</code>æ¥å£ã€‚</p><p>çœ‹åˆ°è¿™é‡Œå‘ç°ï¼Œä¸æ˜¯ä¸‰ä¸ªå¸¸ç”¨çš„å—ï¼Ÿæ€ä¹ˆæ²¡æœ‰è§¦å‘è°ƒåº¦ï¼Œæ˜¯çš„ï¼Œæ²¡æœ‰ä¸“é—¨çš„è§¦å‘è°ƒåº¦ã€‚éƒ½æ˜¯<code>schedule</code>é‡Œé¢å®ç°çš„ã€‚</p><h2 id="äºŒã€å¸¸è§API"><a href="#äºŒã€å¸¸è§API" class="headerlink" title="äºŒã€å¸¸è§API"></a>äºŒã€å¸¸è§API</h2><p><code>Timer</code>è°ƒåº¦ç±»çš„ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>void schedule(TimerTask task , long delay)</code></td><td>è°ƒåº¦ä¸€ä¸ªtaskï¼Œç»è¿‡delay(ms)åå¼€å§‹è¿›è¡Œè°ƒåº¦ï¼Œä»…ä»…è°ƒåº¦ä¸€æ¬¡ã€‚</td></tr><tr><td><code>void schedule(TimerTask task, Date firstTime)</code></td><td>åœ¨æŒ‡å®šçš„æ—¶é—´ç‚¹<code>firstTime</code>ä¸Šè°ƒåº¦ä¸€æ¬¡ã€‚</td></tr><tr><td><code>void schedule(TimerTask task, long delay, long period)</code></td><td>è°ƒåº¦ä¸€ä¸ªtaskï¼Œåœ¨delayï¼ˆmsï¼‰åå¼€å§‹è°ƒåº¦ï¼Œæ¯æ¬¡è°ƒåº¦å®Œåï¼Œæœ€å°‘ç­‰å¾…periodï¼ˆmsï¼‰åæ‰å¼€å§‹è°ƒåº¦ã€‚</td></tr><tr><td><code>void schedule(TimerTask task, Date firstTime, long period)</code></td><td>è°ƒåº¦ä¸€ä¸ªtaskï¼Œåœ¨firstTimeæ—¶ç¬¬ä¸€æ¬¡è°ƒåº¦ï¼Œè°ƒåº¦å®Œåï¼Œæœ€å°‘ç­‰å¾…periodï¼ˆmsï¼‰åæ‰å¼€å§‹è°ƒåº¦ã€‚</td></tr><tr><td><code>void scheduleAtFixedRate(TimerTask task, long delay, long period)</code></td><td>è°ƒåº¦ä¸€ä¸ªtaskï¼Œåœ¨delay(ms)åå¼€å§‹è°ƒåº¦ï¼Œç„¶åæ¯ç»è¿‡period(ms)å†æ¬¡è°ƒåº¦ ã€‚</td></tr><tr><td><code>void scheduleAtFixedRate(TimerTask task, Date firstTime, long period)</code></td><td>è°ƒåº¦ä¸€ä¸ªtaskï¼Œåœ¨<code>firstTime</code>æ—¶ç¬¬ä¸€æ¬¡è°ƒåº¦ï¼Œè°ƒåº¦å®Œåï¼Œæœ€å°‘ç­‰å¾…periodï¼ˆmsï¼‰åæ‰å¼€å§‹è°ƒåº¦ã€‚</td></tr></tbody></table><p><strong>ä¸»è¦å‚æ•°</strong></p><p><code>task</code>ï¼šè¿™æ˜¯è¢«è°ƒåº¦çš„ä»»åŠ¡ã€‚</p><p><code>firstTime</code>ï¼šè¿™æ˜¯é¦–æ¬¡åœ¨è¯¥ä»»åŠ¡å°†è¢«æ‰§è¡Œã€‚</p><p><code>delay</code>ï¼šè¿™æ˜¯ä»¥æ¯«ç§’ä¸ºå•ä½çš„å»¶è¿Ÿä¹‹å‰çš„ä»»åŠ¡æ‰§è¡Œã€‚</p><p><code>period</code>ï¼šè¿™æ˜¯åœ¨è¿ç»­æ‰§è¡Œä»»åŠ¡ä¹‹é—´çš„æ¯«ç§’çš„æ—¶é—´ã€‚ </p><p>å…³äºschedule å’Œ scheduleAtFixedRate åŒºåˆ«ã€‚</p><p>ï¼ˆ1ï¼‰scheduleæ–¹æ³• å’Œ scheduleAtFixedRate æ–¹æ³•ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½åŸºæœ¬ä¸€æ ·çš„ã€‚</p><p>ï¼ˆ2ï¼‰ å¦‚æœæŒ‡å®šçš„è®¡åˆ’æ‰§è¡Œæ—¶é—´scheduledExecutionTime&lt;= systemCurrentTimeï¼Œåˆ™taskä¼šè¢«ç«‹å³æ‰§è¡Œã€‚scheduledExecutionTimeä¸ä¼šå› ä¸ºæŸä¸€ä¸ªtaskçš„è¿‡åº¦æ‰§è¡Œè€Œæ”¹å˜ã€‚ </p><p>ï¼ˆ2ï¼‰scheduleæ³¨é‡ä¿æŒé—´éš”æ—¶é—´çš„ç¨³å®šï¼Œ åœ¨è®¡ç®—ä¸‹ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡å½“å‰æ—¶é—´ï¼ˆåœ¨ä»»åŠ¡æ‰§è¡Œå‰å¾—åˆ°ï¼‰ + æ—¶é—´ç‰‡ï¼Œè€Œ<strong>scheduleAtFixedRate</strong>æ–¹æ³•æ˜¯é€šè¿‡å½“å‰éœ€è¦æ‰§è¡Œçš„æ—¶é—´ï¼ˆä¹Ÿå°±æ˜¯è®¡ç®—å‡ºç°åœ¨åº”è¯¥æ‰§è¡Œçš„æ—¶é—´ï¼‰+ æ—¶é—´ç‰‡ã€‚å‰è€…æ˜¯è¿è¡Œçš„å®é™…æ—¶é—´ï¼Œè€Œåè€…æ˜¯ç†è®ºæ—¶é—´ç‚¹ã€‚</p><p>ä¾‹å¦‚ï¼šscheduleæ—¶é—´ç‰‡æ˜¯5sï¼Œé‚£ä¹ˆç†è®ºä¸Šä¼šåœ¨5ã€10ã€15ã€20è¿™äº›æ—¶é—´ç‰‡è¢«è°ƒåº¦ï¼Œä½†æ˜¯å¦‚æœç”±äºæŸäº›åŸå› å¯¼è‡´ç¬¬8sæ‰è¢«ç¬¬ä¸€æ¬¡è°ƒåº¦ï¼Œé‚£ä¹ˆscheduleæ–¹æ³•è®¡ç®—å‡ºæ¥çš„ä¸‹ä¸€æ¬¡æ—¶é—´åº”è¯¥æ˜¯ç¬¬13sè€Œä¸æ˜¯ç¬¬10sï¼Œè¿™æ ·æœ‰å¯èƒ½ä¸‹æ¬¡å°±è¶Šåˆ°20såè€Œè¢«å°‘è°ƒåº¦ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚  <strong>scheduleAtFixedRate</strong>æ–¹æ³•å°±æ˜¯æ¯æ¬¡ç†è®ºè®¡ç®—å‡ºä¸‹ä¸€æ¬¡éœ€è¦è°ƒåº¦çš„æ—¶é—´ç”¨ä»¥æ’åºï¼Œè‹¥ç¬¬8sè¢«è°ƒåº¦ï¼Œé‚£ä¹ˆè®¡ç®—å‡ºåº”è¯¥æ˜¯ç¬¬10sï¼Œæ‰€ä»¥å®ƒè·ç¦»å½“å‰æ—¶é—´æ˜¯2sï¼Œé‚£ä¹ˆå†è°ƒåº¦é˜Ÿåˆ—æ’åºä¸­ï¼Œä¼šè¢«ä¼˜å…ˆè°ƒåº¦ï¼Œé‚£ä¹ˆå°±<strong>å°½é‡å‡å°‘æ¼æ‰è°ƒåº¦</strong>çš„æƒ…å†µã€‚ </p><h2 id="ä¸‰ã€è¿è¡ŒåŸç†"><a href="#ä¸‰ã€è¿è¡ŒåŸç†" class="headerlink" title="ä¸‰ã€è¿è¡ŒåŸç†"></a>ä¸‰ã€è¿è¡ŒåŸç†</h2><p><code>Timer</code>è°ƒåº¦å™¨æºç ä¸­ï¼Œä¸»è¦æ˜¯ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œå’Œä¸€ä¸ª<code>TimerThread</code>çº¿ç¨‹ï¼Œ<code>TimerThread</code>ç»§æ‰¿äº†<code>Thread</code> ç±»ï¼Œç”¨æ¥è°ƒåº¦æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**     * The timer task queue.  This data structure is shared with the timer     * thread.  The timer produces tasks, via its various schedule calls,     * and the timer thread consumes, executing timer tasks as appropriate,     * and removing them from the queue when they're obsolete.     */</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> TaskQueue queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * The timer thread.     */</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> TimerThread thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimerThread</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * This object causes the timer's task execution thread to exit     * gracefully when there are no live references to the Timer object and no     * tasks in the timer queue.  It is used in preference to a finalizer on     * Timer as such a finalizer would be susceptible to a subclass's     * finalizer forgetting to call it.     */</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> Object threadReaper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>            <span class="token keyword">synchronized</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span> <span class="token punctuation">{</span>                thread<span class="token punctuation">.</span>newTasksMayBeScheduled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                queue<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// In case queue is empty.</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><code>hreadReaper</code>ï¼Œå®ƒæ˜¯Objectç±»å‹ï¼Œåªæ˜¯é‡å†™äº†<code>finalize</code>æ–¹æ³•è€Œå·²ï¼Œæ˜¯ä¸ºäº†åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œå°†ç›¸åº”çš„ä¿¡æ¯å›æ”¶æ‰ï¼ŒåšGCçš„å›è¡¥ï¼Œä¹Ÿå°±æ˜¯å½“<code>timer</code>çº¿ç¨‹ç”±äºæŸç§åŸå› æ­»æ‰äº†ï¼Œè€Œæœªè¢«<code>cancel</code>ï¼Œé‡Œé¢çš„é˜Ÿåˆ—ä¸­çš„ä¿¡æ¯éœ€è¦æ¸…ç©ºæ‰ï¼Œ </p><p><code>Timer</code>è°ƒåº¦çš„æ ¸å¿ƒæ–¹æ³•æ˜¯ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sched</span><span class="token punctuation">(</span>TimerTask task<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">,</span> <span class="token keyword">long</span> period<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal execution time."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Constrain value of period sufficiently to prevent numeric</span>        <span class="token comment" spellcheck="true">// overflow while still being effectively infinitely large.</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>period<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token punctuation">(</span>Long<span class="token punctuation">.</span>MAX_VALUE <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            period <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">synchronized</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>thread<span class="token punctuation">.</span>newTasksMayBeScheduled<span class="token punctuation">)</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Timer already cancelled."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">synchronized</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>state <span class="token operator">!=</span> TimerTask<span class="token punctuation">.</span>VIRGIN<span class="token punctuation">)</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>                        <span class="token string">"Task already scheduled or cancelled"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                task<span class="token punctuation">.</span>nextExecutionTime <span class="token operator">=</span> time<span class="token punctuation">;</span>                task<span class="token punctuation">.</span>period <span class="token operator">=</span> period<span class="token punctuation">;</span>                task<span class="token punctuation">.</span>state <span class="token operator">=</span> TimerTask<span class="token punctuation">.</span>SCHEDULED<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            queue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">getMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> task<span class="token punctuation">)</span>                queue<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span></code></pre><p><code>queue</code> åœ¨åšè¿™ä¸ªæ“ä½œçš„æ—¶å€™ï¼Œå‘ç”Ÿäº†åŒæ­¥ï¼Œæ‰€ä»¥åœ¨<code>timer</code>çº§åˆ«ï¼Œè¿™ä¸ªæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæœ€åå°†<code>task</code>ç›¸å…³çš„å‚æ•°èµ‹å€¼ï¼Œä¸»è¦åŒ…å«<code>nextExecutionTime</code>ï¼ˆä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ï¼‰ï¼Œ<code>period</code>ï¼ˆæ—¶é—´ç‰‡ï¼‰ï¼Œ<code>state</code>ï¼ˆçŠ¶æ€ï¼‰ï¼Œç„¶åå°†å®ƒæ”¾å…¥<code>queue</code>é˜Ÿåˆ—ä¸­ï¼Œåšä¸€æ¬¡<code>notify</code>æ“ä½œ ã€‚</p><p><code>TaskQueue</code>ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œåˆ™æ˜¯æœ‰ä¸€ä¸ª<code>TimerTask</code>æ•°ç»„ç”¨æ¥å­˜æ”¾æˆ‘éœ€è¦è°ƒåº¦æ‰§è¡Œçš„ä»»åŠ¡ï¼ŒåŠä¸€ä¸ª size ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> TimerTask<span class="token punctuation">[</span><span class="token punctuation">]</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimerTask</span><span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre><p>ä¸€ä¸ª<code>Timer</code>åªè¦å†…éƒ¨çš„taskä¸ªæ•°ä¸è¶…è¿‡128æ˜¯ä¸ä¼šé€ æˆæ‰©å®¹çš„ï¼›å†…éƒ¨  æä¾›äº†add(TimerTask tt)ã€size()ã€getMin()ã€get(int)ã€removeMin()ã€quickRemove(int i)ã€ rescheduleMin(long  newTime)ã€isEmpty()ã€clear()ã€fixUp()ã€fixDown()ã€heapify()ï¼› </p><h2 id="å››ã€å®é™…ä½¿ç”¨"><a href="#å››ã€å®é™…ä½¿ç”¨" class="headerlink" title="å››ã€å®é™…ä½¿ç”¨"></a>å››ã€å®é™…ä½¿ç”¨</h2><p>å®šä¹‰ä¸€ä¸ªä»»åŠ¡ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> xiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>timetask<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Timer<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>TimerTask<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoTask</span> <span class="token keyword">extends</span> <span class="token class-name">TimerTask</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">try</span><span class="token punctuation">{</span>             System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" execute time : "</span> <span class="token operator">+</span>LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Timer timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Date startDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        timer<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DemoTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> startDate <span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ç«‹å³æ‰§è¡Œï¼Œæ¯5sé‡å¤ä¸€æ¬¡</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><code>Thread.sleep(3000);</code> æ—¶æ‰§è¡Œç»“æœï¼š </p><pre class=" language-txt"><code class="language-txt">execute end time - 2020-07-18T20:00:39.836execute end time - 2020-07-18T20:00:44.817execute end time - 2020-07-18T20:00:49.817execute end time - 2020-07-18T20:00:54.816execute end time - 2020-07-18T20:00:59.817</code></pre><p><code>Thread.sleep(10000);</code> æ—¶æ‰§è¡Œç»“æœï¼š</p><pre class=" language-txt"><code class="language-txt"> execute time : 2020-07-18T18:18:47.416 execute time : 2020-07-18T18:18:57.417 execute time : 2020-07-18T18:19:07.418 execute time : 2020-07-18T18:19:17.419 execute time : 2020-07-18T18:19:27.419 execute time : 2020-07-18T18:19:37.420</code></pre><p>æ–¹æ³•æ¨¡æ‹Ÿçš„æ‰§è¡Œæ—¶é—´æ˜¯3ç§’ï¼Œ è®¾ç½®çš„é—´éš”å‚æ•°æ˜¯5ç§’ã€‚è°ƒåº¦æ˜¯æ¯5ç§’æ‰§è¡Œä¸€æ¬¡ï¼ŒæŒ‰ç…§è‡ªå·±è®¾å®šçš„é—´éš”æ¥æ‰§è¡Œã€‚</p><p>æ–¹æ³•æ¨¡æ‹Ÿçš„æ‰§è¡Œæ—¶é—´æ˜¯10ç§’ï¼Œ å¯æ˜¯æˆ‘ä»¬è®¾ç½®çš„é—´éš”æ˜¯5ç§’ã€‚è°ƒåº¦æ˜¯æ¯10ç§’æ‰§è¡Œä¸€æ¬¡ã€‚åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œä¹‹åï¼Œåç»­é—´éš”ä»ç„¶æ˜¯10sï¼Œæ²¡æœ‰åœ¨18åˆ†52ç§’ã€19åˆ†02ç§’æ—¶æ‰§è¡Œã€‚ å¯è§<code>schedule</code>æ³¨é‡è°ƒåº¦å‘¨æœŸç¨³å®šã€‚</p><p>ä¹Ÿå¯ä»¥é…åˆæ—¥å†ä½¿ç”¨</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Timer timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    DemoTask demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DemoTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    Date startDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// ç«‹å³æ‰§è¡Œï¼Œæ¯5sé‡å¤ä¸€æ¬¡</span>    timer<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>demo<span class="token punctuation">,</span> startDate <span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// é…åˆæ—¥å†</span>    Calendar cal <span class="token operator">=</span> Calendar<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>Calendar<span class="token punctuation">.</span>MINUTE<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    timer<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>demo<span class="token punctuation">,</span> cal<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å†è¯•è¯•<code>scheduleAtFixedRate</code>æ–¹æ³•ï¼Œä¿®æ”¹ä¸€ä¸‹<code>main</code>æ–¹æ³•:</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> xiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>timetask<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Timer<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>TimerTask<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoTask</span> <span class="token keyword">extends</span> <span class="token class-name">TimerTask</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">try</span><span class="token punctuation">{</span>                  Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token punctuation">}</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" execute time : "</span> <span class="token operator">+</span>LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> ParseException <span class="token punctuation">{</span>        <span class="token keyword">final</span> SimpleDateFormat dateFormatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          Date startDate <span class="token operator">=</span> dateFormatter<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"2020-07-18 18:30:00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          Timer timer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        timer<span class="token punctuation">.</span><span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DemoTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>startDate <span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre><p><code>Thread.sleep(3000);</code> æ—¶æ‰§è¡Œç»“æœï¼š </p><pre class=" language-txt"><code class="language-txt"> execute end time - 2020-07-18T20:06:37.458 execute end time - 2020-07-18T20:06:40.458 execute end time - 2020-07-18T20:06:43.459 execute end time - 2020-07-18T20:06:46.459 execute end time - 2020-07-18T20:06:49.460 execute end time - 2020-07-18T20:06:52.460</code></pre><p><code>Thread.sleep(10000);</code> æ—¶æ‰§è¡Œç»“æœï¼š </p><pre class=" language-txt"><code class="language-txt"> execute end time - 2020-07-18T20:09:14.068 execute end time - 2020-07-18T20:09:24.069 execute end time - 2020-07-18T20:09:34.069 execute end time - 2020-07-18T20:09:44.070 execute end time - 2020-07-18T20:09:54.071 execute end time - 2020-07-18T20:10:04.071</code></pre><p>ä¸Šé¢çš„è¿è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå½“æ¨¡æ‹Ÿæ‰§è¡Œæ—¶é—´10så¤§äºè®¾ç½®é—´éš”æ—¶é—´5sæ—¶ï¼ŒæŒ‰ç…§å®é™…æ‰§è¡Œé—´éš”ç«‹å³æ‰§è¡Œã€‚å½“æ¨¡æ‹Ÿæ‰§è¡Œæ—¶é—´3så°äºè®¾ç½®é—´éš”æ—¶é—´5sæ—¶ï¼Œæ²¡æœ‰ç­‰åˆ°5så°±æ‰§è¡Œäº†ï¼Œæ²¡æœ‰æŒ‰ç…§è‡ªå·±è®¾å®šçš„é—´éš”æ‰§è¡Œã€‚éš¾é“æ˜¯æˆ‘æŠŠè®¡åˆ’æ‰§è¡Œæ—¶é—´è®¾ç½®æˆå†å²æ—¶é—´çš„åŸå› ï¼Ÿå°†</p><pre class=" language-java"><code class="language-java">Date startDate <span class="token operator">=</span> dateFormatter<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"2020-07-18 18:30:00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¿®æ”¹æˆæœªæ¥æ—¶é—´</p><pre class=" language-java"><code class="language-java">Date startDate <span class="token operator">=</span> dateFormatter<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"2020-07-18 20:16:00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><pre class=" language-txt"><code class="language-txt"> execute end time - 2020-07-18T20:16:03.052 execute end time - 2020-07-18T20:16:08 execute end time - 2020-07-18T20:16:13.001 execute end time - 2020-07-18T20:16:18.001 execute end time - 2020-07-18T20:16:23.001 execute end time - 2020-07-18T20:16:28 execute end time - 2020-07-18T20:16:33.001 execute end time - 2020-07-18T20:16:38.001</code></pre><p>æœç„¶æ˜¯ï¼Œè®¡åˆ’æ‰§è¡Œæ—¶é—´æ˜¯å†å²æ—¶é—´æ—¶ï¼Œè®¾å®šçš„é—´éš”ä¼šå¤±æ•ˆã€‚è®¡åˆ’æ‰§è¡Œæ—¶é—´æ˜¯æœªæ¥æ—¶é—´æ—¶ï¼Œé—´éš”ç”Ÿæ•ˆäº†ã€‚</p><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="a516f8e8.html">å®šæ—¶ä»»åŠ¡ä¹‹Javaå®šæ—¶API</a><br><a href="5a5ab620.html">å®šæ—¶ä»»åŠ¡ä¹‹Spring Task</a><br><a href="6ddb3c14.html">å®šæ—¶ä»»åŠ¡ä¹‹quartz</a></p><br/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> å®šæ—¶ä»»åŠ¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java Timer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMå­¦ä¹ å¯¼èˆªï¼ˆç¬¬ä¸‰ç‰ˆï¼‰</title>
      <link href="/posts/2a1a7c1f.html"/>
      <url>/posts/2a1a7c1f.html</url>
      
        <content type="html"><![CDATA[<pre><code>æœ¬ç³»åˆ—ä¸»è¦è®°å½•å…³äºæ·±å…¥ç†è§£JVMï¼ˆç¬¬ä¸‰ç‰ˆï¼‰ç›¸å…³å­¦ä¹ æ¯”è¾ƒï¼Œæœ¬æ–‡ä¸ºå¯¼èˆªã€‚</code></pre><h2 id="JVMå­¦ä¹ å¯¼èˆª"><a href="#JVMå­¦ä¹ å¯¼èˆª" class="headerlink" title="JVMå­¦ä¹ å¯¼èˆª"></a>JVMå­¦ä¹ å¯¼èˆª</h2><h3 id="ä¸€-æ¦‚å†µ"><a href="#ä¸€-æ¦‚å†µ" class="headerlink" title="ä¸€ æ¦‚å†µ"></a>ä¸€ æ¦‚å†µ</h3><h4 id="1-javaå‘ç°å†ç¨‹"><a href="#1-javaå‘ç°å†ç¨‹" class="headerlink" title="1. javaå‘ç°å†ç¨‹"></a>1. javaå‘ç°å†ç¨‹</h4><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/java_tech_sys_1.jpg" alt="javaæŠ€æœ¯ä½“ç³»"></p><h4 id="2-javaæŠ€æœ¯ä½“ç³»"><a href="#2-javaæŠ€æœ¯ä½“ç³»" class="headerlink" title="2. javaæŠ€æœ¯ä½“ç³»"></a>2. javaæŠ€æœ¯ä½“ç³»</h4><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/java_tech_sys_1.jpg" alt="javaæŠ€æœ¯ä½“ç³»"></p><h3 id="äºŒ-JVMä¸»è¦å†…å®¹"><a href="#äºŒ-JVMä¸»è¦å†…å®¹" class="headerlink" title="äºŒ JVMä¸»è¦å†…å®¹"></a>äºŒ JVMä¸»è¦å†…å®¹</h3><h4 id="1-JVMå†…å­˜è‡ªåŠ¨ç®¡ç†ä¸­çš„çš„å†…å­˜ç»“æ„ã€‚"><a href="#1-JVMå†…å­˜è‡ªåŠ¨ç®¡ç†ä¸­çš„çš„å†…å­˜ç»“æ„ã€‚" class="headerlink" title="1. JVMå†…å­˜è‡ªåŠ¨ç®¡ç†ä¸­çš„çš„å†…å­˜ç»“æ„ã€‚"></a>1. JVMå†…å­˜è‡ªåŠ¨ç®¡ç†ä¸­çš„çš„å†…å­˜ç»“æ„ã€‚</h4><pre><code>ç¨‹åºè®¡æ•°å™¨javaå †ï¼ˆHeapï¼‰æ–¹æ³•åŒºè™šæ‹Ÿæœºæ ˆæœ¬åœ°æ–¹æ³•æ ˆSOF,OOM</code></pre><h4 id="2-JVMä¸­å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"><a href="#2-JVMä¸­å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="2. JVMä¸­å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"></a>2. JVMä¸­å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</h4><pre><code>æ£€æŸ¥å †ä¸­çš„ç±»ç¬¦å·æ£€æŸ¥ç±»åŠ è½½åˆ†é…æ–°å¯¹è±¡å†…å­˜ç©ºé—´â€”â€”æŒ‡é’ˆç¢°æ’ï¼Œç©ºé—²åˆ—è¡¨åˆå§‹åŒ–é›¶å€¼æ‰§è¡Œ&lt;init&gt;()æ–¹æ³•</code></pre><h4 id="3-åƒåœ¾æ”¶é›†å™¨ç®—æ³•"><a href="#3-åƒåœ¾æ”¶é›†å™¨ç®—æ³•" class="headerlink" title="3. åƒåœ¾æ”¶é›†å™¨ç®—æ³•"></a>3. åƒåœ¾æ”¶é›†å™¨ç®—æ³•</h4><p>   åˆ†ä»£å›æ”¶ç†è®º<br>   æ ‡è®°â€”â€”æ¸…é™¤ç®—æ³•<br>   æ ‡è®°â€”â€”å¤åˆ¶ç®—æ³•<br>   æ ‡è®°â€”â€”æ•´ç†ç®—æ³•<br>   åŠå¤åˆ¶ç®—æ³•</p><h4 id="4-å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨"><a href="#4-å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="4. å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨"></a>4. å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨</h4><pre><code>Serialæ”¶é›†å™¨ParNewæ”¶é›†å™¨Parallel Scavengeæ”¶é›†å™¨Serial Oldæ”¶é›†å™¨Parallel Oldæ”¶é›†å™¨CMSæ”¶é›†å™¨Garbage Firstæ”¶é›†å™¨ (Regionå¸ƒå±€)ZGC (Region/ZPageå¸ƒå±€)Shenandah (Regionå¸ƒå±€)</code></pre><h4 id="5-ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨"><a href="#5-ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨" class="headerlink" title="5. ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨"></a>5. ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨</h4><pre><code>Shenandoahæ”¶é›†å™¨ZGCæ”¶é›†å™¨</code></pre><h4 id="6-å†…å­˜åˆ†é…å›æ”¶ç­–ç•¥"><a href="#6-å†…å­˜åˆ†é…å›æ”¶ç­–ç•¥" class="headerlink" title="6. å†…å­˜åˆ†é…å›æ”¶ç­–ç•¥"></a>6. å†…å­˜åˆ†é…å›æ”¶ç­–ç•¥</h4><pre><code>å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®šç©ºé—´åˆ†é…æ‹…ä¿</code></pre><h4 id="7-æ€§èƒ½ç›‘æ§ã€æ•…éšœå¤„ç†å·¥å…·"><a href="#7-æ€§èƒ½ç›‘æ§ã€æ•…éšœå¤„ç†å·¥å…·" class="headerlink" title="7. æ€§èƒ½ç›‘æ§ã€æ•…éšœå¤„ç†å·¥å…·"></a>7. æ€§èƒ½ç›‘æ§ã€æ•…éšœå¤„ç†å·¥å…·</h4><pre><code>åŸºç¡€æ•…éšœå¤„ç†å·¥å…·å¯è§†åŒ–æ•…éšœå¤„ç†å·¥å…·Hotspotè™šæ‹Ÿæœºæ’ä»¶åŠå·¥å…·</code></pre><h4 id="8-è°ƒä¼˜åˆ†æå­¦ä¹ "><a href="#8-è°ƒä¼˜åˆ†æå­¦ä¹ " class="headerlink" title="8. è°ƒä¼˜åˆ†æå­¦ä¹ "></a>8. è°ƒä¼˜åˆ†æå­¦ä¹ </h4><h4 id="9-JVMç±»æ–‡ä»¶ç»“æ„"><a href="#9-JVMç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="9. JVMç±»æ–‡ä»¶ç»“æ„"></a>9. JVMç±»æ–‡ä»¶ç»“æ„</h4><pre><code>é­”æ•°ã€ç‰ˆæœ¬ä¿¡æ¯å¸¸é‡æ± è®¿é—®æ ‡å¿—ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç±»ç´¢å¼•é›†åˆå­—æ®µè¡¨é›†åˆæ–¹æ³•è¡¨é›†åˆå±æ€§è¡¨é›†åˆ</code></pre><h4 id="10-JVMå­—èŠ‚ç æŒ‡ä»¤"><a href="#10-JVMå­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="10. JVMå­—èŠ‚ç æŒ‡ä»¤"></a>10. JVMå­—èŠ‚ç æŒ‡ä»¤</h4><pre><code>å­—èŠ‚ç ä¸æ•°æ®ç±»å‹åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤è¿ç®—æŒ‡ä»¤ç±»å‹è½¬æ¢æŒ‡ä»¤å¯¹è±¡åˆ›å»ºä¸è®¿é—®æ“ä½œæ•°æ ˆè½¬ç§»æ§åˆ¶æŒ‡ä»¤æ–¹æ³•è°ƒç”¨ä¸è¿”å›å¼‚å¸¸æŒ‡ä»¤åŒæ­¥æŒ‡ä»¤</code></pre><h4 id="11-JVMç±»åŠ è½½æœºåˆ¶"><a href="#11-JVMç±»åŠ è½½æœºåˆ¶" class="headerlink" title="11. JVMç±»åŠ è½½æœºåˆ¶"></a>11. JVMç±»åŠ è½½æœºåˆ¶</h4><pre><code>åŠ è½½è¿æ¥ï¼ˆ éªŒè¯ - å‡†å¤‡- è§£æï¼‰åˆå§‹åŒ–ä½¿ç”¨å¸è½½ç±»å¯¹è±¡ä¸æ•°ç»„å¯¹è±¡åŠ è½½ç±»çš„æ¯”è¾ƒåŒäº²å§”æ´¾æ¨¡å‹å·¥ä½œè¿‡ç¨‹åŒäº²å§”æ´¾æ¨¡å‹ç ´å</code></pre><h4 id="12-JVMå­—èŠ‚ç æ‰§è¡Œå¼•æ“"><a href="#12-JVMå­—èŠ‚ç æ‰§è¡Œå¼•æ“" class="headerlink" title="12. JVMå­—èŠ‚ç æ‰§è¡Œå¼•æ“"></a>12. JVMå­—èŠ‚ç æ‰§è¡Œå¼•æ“</h4><table><thead><tr><th>ç¼–å·</th><th>æ–‡ç« åœ°å€</th></tr></thead><tbody><tr><td>1</td><td><a href="9f103da7.html">JVMå†…å­˜ç»“æ„</a></td></tr><tr><td>2</td><td><a href="b287f556.html">JVMçš„å¯¹è±¡åˆ›å»º</a></td></tr><tr><td>3</td><td><a href="bce48291.html">JVMçš„å¯¹è±¡ç”Ÿæ­»</a></td></tr><tr><td>4</td><td><a href="50b49e8d.html">JVMåƒåœ¾æ”¶é›†å™¨ç®—æ³•</a></td></tr><tr><td>5</td><td><a href="d01dbbb1.html">JVMå¸¸è§çš„åƒåœ¾æ”¶é›†å™¨</a></td></tr><tr><td>6</td><td><a href="f8161112.html">JVMä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼šShenandoah</a></td></tr><tr><td>7</td><td><a href="e3d9aed7.html">JVMä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨:ZGC</a></td></tr><tr><td>8</td><td><a href="96a9f88d.html">JVMä½å†…å­˜åˆ†é…å›æ”¶ç­–ç•¥</a></td></tr><tr><td>9</td><td><a href="ed0fd586.html">JVMç›‘æ§è°ƒä¼˜å·¥å…·</a></td></tr><tr><td>10</td><td><a href="bb37497b.html">JVMå¸¸è§å‚æ•°æ±‡æ€»</a></td></tr><tr><td>11</td><td>[JVMè°ƒä¼˜æŒ‡å—]</td></tr><tr><td>12</td><td><a href="a2ceb3e5.html">JVMå­—èŠ‚ç æŒ‡ä»¤</a></td></tr><tr><td>12-1</td><td><a href="ee62cca5.html">JVMå­—èŠ‚ç æŒ‡ä»¤è¡¨</a></td></tr><tr><td>13</td><td><a href="6698cab3.html">JVMç±»æ–‡ä»¶ç»“æ„</a></td></tr><tr><td>14</td><td><a href="22096143.html">JVMç±»åŠ è½½æœºåˆ¶</a></td></tr><tr><td>15</td><td><a href="49b8efd0.html">Javaæ¨¡å—åŒ–ç³»ç»Ÿ</a></td></tr><tr><td>16</td><td>[JVMå­—èŠ‚ç æ‰§è¡Œå¼•æ“]</td></tr></tbody></table><!--#### javaè™šæ‹Ÿæœºæ‰§è¡Œå­ç³»ç»Ÿ1. jvmç±»æ–‡ä»¶ç»“æ„    classç±»æ–‡ä»¶ç»“æ„    å­—èŠ‚ç æŒ‡ä»¤    å…¬æœ‰è®¾è®¡ç§æœ‰å®ç°    classç±»æ–‡ä»¶ç»“æ„å‘å±•2. jvmç±»åŠ è½½æœºåˆ¶3. å­—èŠ‚ç æ‰§è¡Œå¼•æ“#### ç¨‹åºç¼–è¯‘ä¸ä»£ç ä¼˜åŒ–1. å‰ç«¯ç¼–è¯‘ä¸ä¼˜åŒ–2. åç«¯ç¼–è¯‘ä¸ä¼˜åŒ–     å³æ—¶ç¼–è¯‘     æå‰ç¼–è¯‘     ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€æœ¯     æ·±å…¥ç†è§£ç¼–è¯‘å™¨--><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmå¸¸è§å‚æ•°æ±‡æ€»</title>
      <link href="/posts/bb37497b.html"/>
      <url>/posts/bb37497b.html</url>
      
        <content type="html"><![CDATA[<h2 id="jvmå¸¸è§å‚æ•°æ±‡æ€»"><a href="#jvmå¸¸è§å‚æ•°æ±‡æ€»" class="headerlink" title="jvmå¸¸è§å‚æ•°æ±‡æ€»"></a>jvmå¸¸è§å‚æ•°æ±‡æ€»</h2><blockquote><p>ä¸»è¦æ˜¯é’ˆå¯¹ä¹‹å‰çš„å­¦ä¹ ï¼Œè¿›è¡Œä¸€ä¸ªå‚æ•°çš„é›†ä¸­æ•´ç†ã€‚</p></blockquote><h3 id="ä¸€ã€ç¯å¢ƒå› ç´ "><a href="#ä¸€ã€ç¯å¢ƒå› ç´ " class="headerlink" title="ä¸€ã€ç¯å¢ƒå› ç´ "></a>ä¸€ã€ç¯å¢ƒå› ç´ </h3><p><strong>JVM ä¸­æœ€å¤§å †å¤§å°æœ‰ä¸‰æ–¹é¢é™åˆ¶:</strong></p><ul><li><p>ç›¸å…³æ“ä½œç³»ç»Ÿçš„æ•°æ®æ¨¡å‹ï¼ˆ32-btè¿˜æ˜¯64-bitï¼‰é™åˆ¶ï¼›</p></li><li><p>ç³»ç»Ÿçš„å¯ç”¨è™šæ‹Ÿå†…å­˜é™åˆ¶ï¼›</p></li><li><p>ç³»ç»Ÿçš„å¯ç”¨ç‰©ç†å†…å­˜é™åˆ¶ã€‚32ä½ç³»ç»Ÿä¸‹ï¼Œä¸€èˆ¬é™åˆ¶åœ¨<code>1.5G ~ 2G</code>ï¼›64ä¸ºæ“ä½œç³»ç»Ÿå¯¹å†…å­˜æ— é™åˆ¶ã€‚</p></li></ul><p>åœ¨å†…å­˜è‡ªåŠ¨ç®¡ç†è¿‡ç¨‹ä¸­ï¼Œæ–°ç”Ÿä»£ä¸­çš„98%å¯¹è±¡éƒ½æ˜¯â€æœç”Ÿå¤•æ­»â€çš„ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æŒ‰ç…§1:1çš„æ¯”ä¾‹æ¥åˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€å—æ¯”è¾ƒå¤§çš„<code>Eden</code>ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„<code>Survivor</code>ç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨<code>Eden</code>å’Œå…¶ä¸­ä¸€å—<code>Survivor</code>ã€‚å½“å›æ”¶æ—¶ï¼Œå°†<code>Eden</code>å’Œ<code>Survivor</code>ä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡ä¸€æ¬¡æ€§åœ°å¤åˆ¶åˆ°å¦å¤–ä¸€å—<code>Survivor</code>ç©ºé—´ä¸Šï¼Œæœ€åæ¸…ç†æ‰<code>Eden</code>å’Œåˆšæ‰ç”¨è¿‡çš„<code>Survivor</code>ç©ºé—´ã€‚<code>HotSpot</code>è™šæ‹Ÿæœºé»˜è®¤<code>Eden</code>å’Œ<code>Survivor</code>çš„å¤§å°æ¯”ä¾‹æ˜¯<code>8:1</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡æ–°ç”Ÿä»£ä¸­å¯ç”¨å†…å­˜ç©ºé—´ä¸ºæ•´ä¸ªæ–°ç”Ÿä»£å®¹é‡çš„90%ï¼ˆ80%+10%ï¼‰ï¼Œåªæœ‰10%çš„ç©ºé—´ä¼šè¢«æµªè´¹ã€‚</p><h3 id="äºŒã€å‚æ•°ä½¿ç”¨è¯´æ˜"><a href="#äºŒã€å‚æ•°ä½¿ç”¨è¯´æ˜" class="headerlink" title="äºŒã€å‚æ•°ä½¿ç”¨è¯´æ˜"></a>äºŒã€å‚æ•°ä½¿ç”¨è¯´æ˜</h3><p>å‚æ•°ä½¿ç”¨æ˜¯ä»¥ <code>-XX:</code>ä¸ºå‰ç¼€ï¼Œä¸­é—´ä»¥ <code>+</code> æˆ– <code>-</code> è¿æ¥ï¼Œåé¢è·Ÿå‚æ•°åï¼Œå¦‚æœéœ€è¦è®¾ç½®å‚æ•°å€¼çš„ä½¿ç”¨èµ‹å€¼ç¬¦å· <code>=</code> è¿æ¥å€¼ã€‚</p><p><code>+</code> :è¡¨ç¤ºå¯ç”¨è¯¥å‚æ•°ï¼› <code>-</code> :è¡¨ç¤ºç¦ç”¨è¯¥å‚æ•°ã€‚</p><p>å¦‚ï¼š</p><pre><code>-XX:SurvivorRatio=8</code></pre><h3 id="ä¸‰ã€é€šç”¨çš„å‚æ•°"><a href="#ä¸‰ã€é€šç”¨çš„å‚æ•°" class="headerlink" title="ä¸‰ã€é€šç”¨çš„å‚æ•°"></a>ä¸‰ã€é€šç”¨çš„å‚æ•°</h3><p>é€šç”¨çš„å‚æ•°æ˜¯ä¸éœ€è¦åŒºåˆ†æ”¶é›†å™¨çš„ã€‚</p><p>åŸºæœ¬å¸¸ç”¨å‚æ•°</p><table><thead><tr><th>å‚æ•°å…³é”®è¯</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>-Xms</code></td><td>è®¾ç½®å †çš„æœ€å°å€¼ï¼Œåˆå§‹å†…å­˜å¤§å°ã€‚</td><td><code>-Xms1024m</code>  å †çš„åˆå§‹å†…å­˜ä¸º1Gã€‚</td></tr><tr><td><code>-Xmx</code></td><td>è®¾ç½®å †çš„æœ€å¤§å€¼ ï¼Œæœ€å¤§å¯ç”¨å†…å­˜ã€‚</td><td><code>-Xms1024m</code>  å †çš„æœ€å¤§å¯ç”¨å†…å­˜ä¸º1Gã€‚ä¸€èˆ¬ä¸ºç³»ç»Ÿå¯ç”¨å†…å­˜çš„1/4å¤§å°</td></tr><tr><td><code>-Xmn</code></td><td>è®¾ç½®æ–°ç”Ÿä»£ï¼ˆå¹´è½»ä»£ï¼‰çš„å¤§å°ã€‚</td><td><code>-Xmn380m</code> ä¸è®¾ç½®åˆ™é»˜è®¤å€¼ä¸ºå †å†…å­˜çš„1/3 ã€‚</td></tr><tr><td><code>-Xss</code></td><td>è®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ã€‚</td><td></td></tr><tr><td><code>-XX:NewSize</code></td><td>æ–°ç”Ÿä»£åˆå§‹åŒ–å†…å­˜å¤§å°ï¼Œè¯¥å€¼éœ€è¦å°äº-Xmsçš„å€¼</td><td><code>-XX:NewSize=512m</code></td></tr><tr><td><code>-XX:MaxNewSize</code></td><td>æ–°ç”Ÿä»£å¯åˆ†é…å†…å­˜å¤§å°ï¼Œè¯¥å€¼éœ€è¦å°äº-Xmxçš„å€¼</td><td><code>-XX:MaxNewSiz=900m</code></td></tr><tr><td><code>-XX:SurvivorRatio</code></td><td>å¹´è½»ä»£ä¸­ Eden:SFrom:STO=n:1:1</td><td><code>-XX:SurvivorRatio=8</code></td></tr><tr><td><code>-XX:PretenureSizeThreshold</code></td><td>è®¾ç½®ç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§å°</td><td><code>-XX:PretenureSizeThreshold=4m</code> å¯¹è±¡å¦‚æœè¶…è¿‡4Må°±å¯ä»¥ç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£</td></tr><tr><td><code>-XX:MaxTenuringThreshold=0</code></td><td>åƒåœ¾æœ€å¤§å¹´é¾„,ç½®åƒåœ¾æœ€å¤§å¹´é¾„ã€‚å¤§äºè¿™ä¸ªå¹´é¾„çš„éƒ½ä¼šè¿›å…¥è€å¹´ä»£åŒºã€‚å¦‚æœè®¾ç½®ä¸º0çš„è¯ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒºï¼Œç›´æ¥è¿›å…¥å¹´è€ä»£ã€‚</td><td><code>-XX:MaxTenuringThreshold=0</code><br/><code>-XX:MaxTenuringThreshold=15</code></td></tr></tbody></table><p><strong>ç‰¹åˆ«è¯´æ˜ï¼š</strong></p><p> <code>-Xms</code> ï¼šç‰©ç†å†…å­˜çš„1/64(&lt;1GB)ã€‚é»˜è®¤(MinHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å°äº40%æ—¶ï¼ŒJVMå°±ä¼šå¢å¤§å †ç›´åˆ°-Xmxçš„æœ€å¤§é™åˆ¶ã€‚</p><p> <code>-Xmx</code> ï¼šç‰©ç†å†…å­˜çš„1/4(&lt;1GB)é»˜è®¤(MaxHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å¤§äº70%æ—¶ï¼ŒJVMä¼šå‡å°‘å †ç›´åˆ° -Xmsçš„æœ€å°é™åˆ¶ã€‚</p><p> <code>-Xmn</code> ï¼šæ•´ä¸ªå †å¤§å°=å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å° + æŒä¹…ä»£å¤§å°ã€‚ å¢å¤§å¹´è½»ä»£åï¼Œå°†ä¼šå‡å°å¹´è€ä»£å¤§ï¼Œæ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§,Sunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8ã€‚</p><p> <code>-XX:PermSize</code>ï¼šç‰©ç†å†…å­˜çš„1/64ã€‚</p><p> <code>-XX:MaxPermSize</code> ï¼šç‰©ç†å†…å­˜çš„1/4ã€‚</p><p> <code>-Xss</code>ï¼š JDK5ä»¥åæ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º1Mï¼Œä»¥å‰æ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º256Kã€‚æ›´å…·åº”ç”¨çš„çº¿ç¨‹æ‰€éœ€å†…å­˜å¤§å°è¿›è¡Œ è°ƒæ•´ã€‚åœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹ï¼Œå‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹ã€‚ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸èƒ½æ— é™ç”Ÿæˆï¼Œç»éªŒå€¼åœ¨3000~5000å·¦å³<br>ä¸€èˆ¬å°çš„åº”ç”¨ï¼Œå¦‚æœæ ˆä¸æ˜¯å¾ˆæ·±ï¼Œåº”è¯¥æ˜¯128kå¤Ÿç”¨çš„ï¼Œå¤§çš„åº”ç”¨å»ºè®®ä½¿ç”¨256kã€‚è¿™ä¸ªé€‰é¡¹å¯¹æ€§èƒ½å½±å“æ¯”è¾ƒå¤§ï¼Œéœ€è¦ä¸¥æ ¼çš„æµ‹è¯•ã€‚</p><p> <code>-XX:SurvivorRatio</code>ï¼š EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ã€‚è®¾ç½®ä¸º8,åˆ™ä¸¤ä¸ªSurvivoråŒºä¸ä¸€ä¸ªEdenåŒºçš„æ¯”å€¼ä¸º2:8,ä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªå¹´è½»ä»£çš„1/10</p><p> <code>-XX:MaxTenuringThreshold</code>ï¼šå¦‚æœè®¾ç½®ä¸º0çš„è¯,åˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒºï¼Œç›´æ¥è¿›å…¥å¹´è€ä»£ã€‚å¯¹äºå¹´è€ä»£æ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œå¯ä»¥æé«˜æ•ˆç‡ã€‚å¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§å€¼ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¼šåœ¨SurvivoråŒºè¿›è¡Œå¤šæ¬¡å¤åˆ¶,è¿™æ ·å¯ä»¥å¢åŠ å¯¹è±¡å†å¹´è½»ä»£çš„å­˜æ´»æ—¶é—´ï¼Œå¢åŠ åœ¨å¹´è½»ä»£å³è¢«å›æ”¶çš„æ¦‚ç‡ï¼Œè¯¥å‚æ•°åªæœ‰åœ¨ä¸²è¡ŒGCæ—¶æ‰æœ‰æ•ˆã€‚</p><p><strong>ç›´æ¥å†…å­˜è®¾ç½®</strong></p><p>ç›´æ¥å†…å­˜ï¼Œå°±æ˜¯å †å¤–å†…å­˜</p><pre><code>-XX:MaxDirectMemorySize=1024m</code></pre><p>å½“ç¼“å†²åŒºåˆ†é…çš„å †å¤–å†…å­˜åˆ°è¾¾æŒ‡å®šå¤§å°åï¼Œå³è§¦å‘<code>Full GC</code>ã€‚æ³¨æ„è¯¥å€¼æ˜¯æœ‰ä¸Šé™çš„ï¼Œé»˜è®¤æ˜¯64Mï¼Œæœ€å¤§ä¸º<code>sun.misc.VM.maxDirectMemory()</code>ï¼Œåœ¨ç¨‹åºä¸­ä¸­å¯ä»¥è·å¾—<code>-XX:MaxDirectMemorySize</code>çš„è®¾ç½®çš„å€¼ã€‚</p><p><strong>æ–¹æ³•åŒº/æ°¸ä¹…ä»£/éå †åŒº</strong></p><p>jdk1.7åŠä¹‹å‰:</p><pre><code>-XX:PermSize-XX:MaxPermSizeï¼›</code></pre><p>jdk1.8ä»¥å:</p><pre><code>-XX:MetaspaceSize-XX:MaxMetaspaceSize</code></pre><p><code>MetaspaceSize</code> é»˜è®¤20.8Må·¦å³(x86ä¸‹å¼€å¯c2æ¨¡å¼)ï¼Œä¸»è¦æ˜¯è®¾ç½®metaspaceGCå‘ç”Ÿçš„åˆå§‹é˜ˆå€¼ï¼Œä¹Ÿæ˜¯æœ€å°é˜ˆå€¼ï¼Œ<br><code>MaxMetaspaceSize</code>é»˜è®¤åŸºæœ¬æ˜¯æ— ç©·å¤§ï¼Œå»ºè®®è®¾ç½®ï¼Œè®¾ç½®åå‚æ•°ä¼šé™åˆ¶metaspace(åŒ…æ‹¬äº†Klass Metaspaceä»¥åŠNoKlass Metaspace)è¢«committedçš„å†…å­˜å¤§å°ï¼Œä¼šä¿è¯committedçš„å†…å­˜ä¸ä¼šè¶…è¿‡è¿™ä¸ªå€¼ï¼Œä¸€æ—¦è¶…è¿‡å°±ä¼šè§¦å‘GCã€‚</p><h3 id="å››ã€åƒåœ¾å›æ”¶ç»Ÿè®¡ä¿¡æ¯"><a href="#å››ã€åƒåœ¾å›æ”¶ç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="å››ã€åƒåœ¾å›æ”¶ç»Ÿè®¡ä¿¡æ¯"></a>å››ã€åƒåœ¾å›æ”¶ç»Ÿè®¡ä¿¡æ¯</h3><p>ç»Ÿè®¡ä¿¡æ¯å‚æ•°</p><table><thead><tr><th>å‚æ•°å…³é”®è¯</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td>-XX:+PrintGC</td><td>æ˜¾ç¤ºGC</td></tr><tr><td>-XX:+PrintGCDetails</td><td>æ˜¾ç¤ºGCè¯¦ç»†ä¿¡æ¯</td></tr><tr><td>-XX:+PrintGCTimeStamps</td><td>æ˜¾ç¤ºGC æ”¶å›æ—¶é—´æˆ³</td></tr><tr><td>-XX:+PrintGCDateStamps</td><td>æ‰“å°GC æ“ä½œçš„æ—¶é—´æˆ³</td></tr><tr><td>-Xloggc:filename</td><td>æŠŠç›¸å…³æ—¥å¿—ä¿¡æ¯è®°å½•åˆ°æ–‡ä»¶ä»¥ä¾¿åˆ†æ</td></tr><tr><td>-XX:PrintHeapAtGC</td><td>æ‰“å°GCå‰åçš„è¯¦ç»†å †æ ˆä¿¡æ¯</td></tr></tbody></table><h3 id="äº”ã€æ”¶é›†å™¨å‚æ•°"><a href="#äº”ã€æ”¶é›†å™¨å‚æ•°" class="headerlink" title="äº”ã€æ”¶é›†å™¨å‚æ•°"></a>äº”ã€æ”¶é›†å™¨å‚æ•°</h3><h4 id="Serial-ä¸²è¡Œæ”¶é›†å™¨"><a href="#Serial-ä¸²è¡Œæ”¶é›†å™¨" class="headerlink" title="Serial ä¸²è¡Œæ”¶é›†å™¨"></a>Serial ä¸²è¡Œæ”¶é›†å™¨</h4><p>Serial / Serial old</p><p>æ— éœ€å¤šçº¿ç¨‹äº¤äº’ï¼Œä½†æ— æ³•å‘æŒ¥å‡ºå¤šå¤„ç†å™¨çš„ä¼˜åŠ¿ï¼Œé€‚åˆå•å¤„ç†å™¨çš„æœºå™¨ä»¥åŠæ•°æ®é‡è¾ƒå°çš„æƒ…å†µã€‚</p><pre><code>-XX:+UseSerialGC</code></pre><p>è™šæ‹Ÿæœºè¿è¡Œåœ¨Client æ¨¡å¼ä¸‹çš„é»˜è®¤å€¼ï¼Œæ‰“å¼€æ­¤å¼€å…³åï¼Œä½¿ç”¨ <code>(æ–°ç”Ÿä»£)Serial + ï¼ˆè€å¹´ä»£ï¼‰Serial Old</code>çš„æ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ã€‚</p><h4 id="ParNew-å¹¶è¡Œæ”¶é›†å™¨"><a href="#ParNew-å¹¶è¡Œæ”¶é›†å™¨" class="headerlink" title="ParNew å¹¶è¡Œæ”¶é›†å™¨"></a>ParNew å¹¶è¡Œæ”¶é›†å™¨</h4><pre><code>-XX:+UseParNewGC</code></pre><p>å¯ç”¨è¯¥å‚æ•°åï¼Œä½¿ç”¨ParNew + Serial Old çš„æ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ã€‚</p><h4 id="Parallel-å¹¶è¡Œæ”¶é›†å™¨"><a href="#Parallel-å¹¶è¡Œæ”¶é›†å™¨" class="headerlink" title="Parallel å¹¶è¡Œæ”¶é›†å™¨"></a>Parallel å¹¶è¡Œæ”¶é›†å™¨</h4><p>Parallel / Parallel old</p><p>1ã€å¹´è½»ä»£å¼€å¯å¹¶è¡Œ</p><p>jdk5å¼•å…¥ï¼Œç”¨äºå¯¹å¹´è½»ä»£è¿›è¡Œå›æ”¶ï¼Œä¸€èˆ¬ç”¨åœ¨å¤šçº¿ç¨‹å¤„ç†å™¨ä¸Šã€‚ä½¿ç”¨ä»¥ä¸‹è®¾ç½®å¯ä»¥å¼€å¯ä½¿ç”¨ã€‚</p><pre><code>-XX:+UseParallerGC</code></pre><p>è™šæ‹Ÿæœºserveræ¨¡å¼ï¼Œä½¿ç”¨<code>Parallel Scavenge+Serial Old</code>çš„æ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ã€‚</p><p>2ã€è€å¹´ä»£å¼€å¯å¹¶è¡Œ</p><p>jdk6ä¹‹åå¯å¯¹è€å¹´ä»£è¿›è¡Œå›æ”¶ï¼Œè‹¥ä¸æ‰“å¼€é»˜è®¤æ˜¯å•çº¿ç¨‹ï¼Œä½¿ç”¨<code>-XX:+UseParallerOldGC</code>å¼€å¯ä½¿ç”¨ã€‚</p><pre><code>-XX:+UseParallerOldGC</code></pre><p>æ‰“å¼€æ­¤å¼€å…³åï¼Œä½¿ç”¨<code>Parallel Scavenge + Parallel Old</code>çš„æ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶</p><h4 id="Parallel-Scavenge-æ”¶é›†å™¨"><a href="#Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨"></a>Parallel Scavenge æ”¶é›†å™¨</h4><p>1ã€ ç›®æ ‡æœ€å¤§åœé¡¿</p><p>æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ï¼Œä¸€èˆ¬<code>200 ~ 300</code>æ¯«ç§’ã€‚</p><pre><code>-XX:MaxGCPauseMillis=200</code></pre><p>2ã€ç›®æ ‡ååé‡å‚æ•°</p><p>ç›´æ¥è®¾ç½®ååé‡å¤§å°çš„</p><pre><code>-XX:GCTimeRatio=99</code></pre><p>å€¼åˆ™åº”å½“æ˜¯ä¸€ä¸ªå¤§äº0å°äº100çš„æ•´æ•°ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ç‡ï¼Œç›¸å½“äºååé‡çš„å€’æ•°ã€‚å¦‚æŠŠæ­¤å‚æ•°è®¾ç½®ä¸º19ï¼Œé‚£å…è®¸çš„æœ€å¤§åƒåœ¾æ”¶é›†æ—¶é—´å°±å æ€»æ—¶é—´çš„5%ï¼ˆå³1/(1+19)ï¼‰ï¼Œé»˜è®¤å€¼ä¸º99ï¼Œå³å…è®¸æœ€å¤§1%ï¼ˆå³1/(1+99)ï¼‰çš„åƒåœ¾æ”¶é›†æ—¶é—´ã€‚ </p><p>3ã€è‡ªé€‚åº”ç­–ç•¥å‚æ•°</p><p>è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥å‚æ•°:</p><pre><code>-XX:+UseAdaptiveSizePolicy</code></pre><p>å‚æ•°è¢«æ¿€æ´»ä¹‹åï¼Œå°±ä¸éœ€è¦äººå·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRatioï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¤§å°ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ç»†èŠ‚å‚æ•°ã€‚è™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ã€‚è¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸ºåƒåœ¾æ”¶é›†çš„è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰ã€‚</p><h4 id="CMS-æ”¶é›†å™¨"><a href="#CMS-æ”¶é›†å™¨" class="headerlink" title="CMS æ”¶é›†å™¨"></a>CMS æ”¶é›†å™¨</h4><p>1ã€å¯ç”¨CMSæ”¶é›†å™¨</p><pre><code>-XX:+UseConcMarkSweepGC</code></pre><p>æ‰“å¼€æ­¤å¼€å…³åï¼Œä½¿ç”¨<code>ParNew + CMS + Serial Old</code>çš„æ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ã€‚<br><code>ParNew</code>æ”¶é›†å™¨æ˜¯æ¿€æ´»CMSåï¼ˆä½¿ç”¨-XX:+UseConcMarkSweepGCé€‰é¡¹ï¼‰çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚<br><code>Serial Old</code>æ”¶é›†å™¨å°†ä½œä¸º CMS æ”¶é›†å™¨å‡ºç°<code>Concurrent Mode Failure</code>å¤±è´¥åçš„åå¤‡æ”¶é›†å™¨ä½¿ç”¨ã€‚</p><p>2ã€è€å¹´ä»£é˜ˆå€¼è§¦å‘CMS</p><p>è€å¹´ä»£ä½¿ç”¨å¤šå°‘åè§¦å‘ CMS:</p><pre><code>-XX:+CMSInitiatingOccupancyFraction=68%</code></pre><p>åœ¨JDK 5çš„é»˜è®¤è®¾ç½®ä¸‹ï¼ŒCMSæ”¶é›†å™¨å½“è€å¹´ä»£ä½¿ç”¨äº†68%çš„ç©ºé—´åå°±ä¼šè¢«æ¿€æ´»ï¼Œåœ¨å®é™…åº”ç”¨ä¸­è€å¹´ä»£å¢é•¿å¹¶ä¸æ˜¯å¤ªå¿«ï¼Œå¯ä»¥é€‚å½“è°ƒé«˜å‚æ•°<code>-XX:CMSInitiatingOccu-pancyFraction</code>çš„å€¼æ¥æé«˜CMSçš„è§¦å‘ç™¾åˆ†æ¯”ï¼Œé™ä½å†…å­˜å›æ”¶é¢‘ç‡ï¼Œè·å–æ›´å¥½çš„æ€§èƒ½ã€‚</p><p>3ã€ç¢ç‰‡æ•´ç†æ¡ä»¶å‚æ•°</p><p>CMS åœ¨næ¬¡GCåï¼Œå¯åŠ¨å†…å­˜ç¢ç‰‡æ•´ç†ã€‚</p><pre><code>-XX:+CMSFullGCsBeforeCompaction=5</code></pre><p>æ˜¯ç”¨äºè®¾ç½®æ‰§è¡Œå¤šå°‘æ¬¡ä¸å‹ç¼©çš„Full GCåï¼Œè·Ÿç€æ¥ä¸€æ¬¡å¸¦å‹ç¼©çš„ï¼ˆé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºæ¯æ¬¡è¿›å…¥FullGCæ—¶éƒ½è¿›è¡Œç¢ç‰‡æ•´ç†ï¼‰ã€‚</p><p>CMS å®Œæˆåï¼Œå¯åŠ¨å†…å­˜ç¢ç‰‡æ•´ç†:</p><pre><code>-XX:+UseCMSCompactAtFullCollection   </code></pre><p>4ã€å¢é‡æ¨¡å¼å‚æ•°</p><p>å¢é‡æ¨¡å¼ï¼Œé€‚ç”¨äºå•CPUæƒ…å†µ:</p><pre><code>-XX:+CMSIncrementalMode</code></pre><p>5ã€CMS å¹´è½»ä»£æ”¶é›†å¹¶è¡Œçº¿ç¨‹æ•°å‚æ•°</p><p>CMS å¹´è½»ä»£æ”¶é›†æ–¹å¼ä¸ºå¹¶è¡Œæ”¶é›†æ—¶,ä½¿ç”¨çš„CPUæ•°ï¼Œå¹¶è¡Œæ”¶é›†çº¿ç¨‹æ•°ã€‚</p><pre><code>-XX:ParallelGCThreads=n</code></pre><h4 id="G1-æ”¶é›†å™¨"><a href="#G1-æ”¶é›†å™¨" class="headerlink" title="G1 æ”¶é›†å™¨"></a>G1 æ”¶é›†å™¨</h4><p>1ã€G1 å¯ç”¨å‚æ•°</p><pre><code>-XX:+UseG1GC</code></pre><p>2ã€ç›®æ ‡æœ€å¤§åœé¡¿æ—¶é—´</p><p>æŒ‡å®šç›®æ ‡çš„æœ€å¤§åœé¡¿æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯200æ¯«ç§’ã€‚G1å°è¯•è°ƒæ•´æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ï¼Œå †å¤§å°ï¼Œæ™‹å‡å¹´é¾„æ¥è¾¾åˆ°è¿™ä¸ªç›®æ ‡æ—¶é—´ã€‚</p><pre><code>-XX:MaxGCPauseMillis=200</code></pre><p>3ã€GCå·¥ä½œçº¿ç¨‹æ•°</p><p>è®¾ç½®GCçš„å·¥ä½œçº¿ç¨‹æ•°é‡å‚æ•°</p><pre><code>-XX:ParallerGCThreads=n</code></pre><h4 id="å…¶ä»–å‚æ•°"><a href="#å…¶ä»–å‚æ•°" class="headerlink" title="å…¶ä»–å‚æ•°"></a>å…¶ä»–å‚æ•°</h4><p>1ã€å¹´è½»ä»£EdenåŒºå æ¯”</p><p>å¹´è½»ä»£ä¸­ <code>Eden:SFrom:STO=n:1:1</code>ï¼Œç¬¬ä¸€ä¸ªè¡¨æ ¼å·²è¯´æ˜ã€‚</p><pre><code>-XX:SurvivorRatio=n</code></pre><p>2ã€ç›´æ¥æ™‹å‡è€å¹´ä»£å¤§å°</p><p>è®¾ç½®ç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§å°ï¼Œç¬¬ä¸€ä¸ªè¡¨æ ¼å·²è¯´æ˜ã€‚</p><pre><code>-XX:PretenureSizeThreshold</code></pre><p>3ã€æ‹…ä¿ç­–ç•¥å‚æ•°</p><p>è€å¹´ä»£çš„å‰©ä½™ç©ºé—´ä¸è¶³ä»¥åº”ä»˜æ–°ç”Ÿä»£çš„æ•´ä¸ªEdenå’ŒSurvivoråŒºçš„æ‰€æœ‰å¯¹è±¡éƒ½å­˜æ´»çš„æç«¯æƒ…å†µæ—¶ï¼Œæ˜¯å¦å…è®¸åˆ†é…æ‹…ä¿å¤±è´¥ï¼š</p><pre><code>-XX:HandlePromotionFailure</code></pre><p>4ã€åŠ é€Ÿç¼–è¯‘</p><p>åŠ å¿«ç¼–è¯‘å‚æ•°ï¼Œé€šå¸¸åœ¨é¡¹ç›®ç¨³å®šä¹‹åï¼Œæ”¹åŠ¨è¾ƒå°æ—¶ä½¿ç”¨ï¼Œè¯¥å‚æ•°ä¼šåœ¨ç¼–è¯‘æ—¶å¿½ç•¥ä¸€äº›Classå†…éƒ¨æ£€æŸ¥ã€‚</p><pre><code>-XX:+AggressiveOpts</code></pre><p>5ã€çº¿ç¨‹æ ˆå¤§å°å‚æ•°</p><pre><code>-XX:ThreadStackSize=0</code></pre><p>0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å †æ ˆå¤§å°ã€‚[Sparc:512ï¼›Solaris x86:320ï¼ˆ5.0åŠæ›´æ—©ç‰ˆæœ¬ä¸­ä¸º256ï¼‰ï¼›Sparc 64ä½ï¼š1024ï¼›Linux amd64:1024ï¼ˆåœ¨5.0åŠæ›´æ—©ç‰ˆæœ¬ä¸­ä¸º0ï¼‰ï¼›æ‰€æœ‰å…¶ä»–0ã€‚] </p><h3 id="å…­ã€JDK-é»˜è®¤GCæ”¶é›†å™¨"><a href="#å…­ã€JDK-é»˜è®¤GCæ”¶é›†å™¨" class="headerlink" title="å…­ã€JDK é»˜è®¤GCæ”¶é›†å™¨"></a>å…­ã€JDK é»˜è®¤GCæ”¶é›†å™¨</h3><p>jdk1.7 å’Œ jdk1.8 é»˜è®¤åƒåœ¾æ”¶é›†å™¨Parallel Scavengeï¼ˆæ–°ç”Ÿä»£ï¼‰+Parallel Oldï¼ˆè€å¹´ä»£ï¼‰ã€‚</p><p>jdk1.9 é»˜è®¤åƒåœ¾æ”¶é›†å™¨G1ã€‚</p><p>å¦‚æœæƒ³çŸ¥é“è‡ªå·±çš„è¿è¡Œç¯å¢ƒçš„JVMä½¿ç”¨äº†ä½•ç§æ”¶é›†å™¨ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>ï¼ˆ1ï¼‰ä½¿ç”¨<code>-XX:+PrintCommandLineFlagsjvm</code>å‚æ•°å¯æŸ¥çœ‹é»˜è®¤è®¾ç½®æ”¶é›†å™¨ç±»å‹ã€‚</p><pre class=" language-bash"><code class="language-bash">java -XX:+PrintCommandLineFlags -version</code></pre><p>ï¼ˆ2ï¼‰ä½¿ç”¨<code>-XX:+PrintGCDetails</code>å‚æ•°æ‰“å°çš„GCæ—¥å¿—çš„æ–°ç”Ÿä»£ã€è€å¹´ä»£åç§°åˆ¤æ–­æ”¶é›†å™¨ç±»å‹ã€‚</p><h3 id="ä¸ƒã€å‚æ•°è¡¥å……"><a href="#ä¸ƒã€å‚æ•°è¡¥å……" class="headerlink" title="ä¸ƒã€å‚æ•°è¡¥å……"></a>ä¸ƒã€å‚æ•°è¡¥å……</h3><p>å¦‚æœæ•´ç†é—æ¼ï¼Œåç»­è¡¥å……ã€‚</p><p>æœ¬æ¬¡æ•´ç†æ—¥æœŸ:2020å¹´7æœˆ16æ—¥ã€‚</p><br><p>å‚è€ƒï¼š<br><a href="https://blog.csdn.net/wangsweetkid/article/details/94310547" target="_blank" rel="noopener">https://blog.csdn.net/wangsweetkid/article/details/94310547</a><br><a href="https://www.jianshu.com/p/950e6990bd80" target="_blank" rel="noopener">https://www.jianshu.com/p/950e6990bd80</a><br><a href="https://www.cnblogs.com/redcreen/archive/2011/05/04/2037057.html" target="_blank" rel="noopener">https://www.cnblogs.com/redcreen/archive/2011/05/04/2037057.html</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 æ¥å£æ–°ç‰¹å¾</title>
      <link href="/posts/1d9dd225.html"/>
      <url>/posts/1d9dd225.html</url>
      
        <content type="html"><![CDATA[<h2 id="Java8-æ¥å£æ–°ç‰¹å¾"><a href="#Java8-æ¥å£æ–°ç‰¹å¾" class="headerlink" title="Java8 æ¥å£æ–°ç‰¹å¾"></a>Java8 æ¥å£æ–°ç‰¹å¾</h2><h3 id="1-æ¥å£é»˜è®¤æ–¹æ³•"><a href="#1-æ¥å£é»˜è®¤æ–¹æ³•" class="headerlink" title="1. æ¥å£é»˜è®¤æ–¹æ³•"></a>1. æ¥å£é»˜è®¤æ–¹æ³•</h3><p>java 8 ä¸­å…è®¸æ¥å£ä¸­åŒ…å«å…·æœ‰å…·ä½“å®ç°çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨<code>default</code>å…³é”®å­—ä¿®é¥°ï¼Œç§°ä¸ºâ€é»˜è®¤æ–¹æ³•â€ã€‚</p><h4 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h4><p>å®šä¹‰ä¸€ä¸ªæ¥å£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangxiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>deft<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>    <span class="token keyword">default</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"xiaocaiInterface"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®šä¹‰ä¸€ä¸ªå­ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangxiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>deft<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubClass</span>  <span class="token keyword">implements</span> <span class="token class-name">MyInterface</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> MyInterface<span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®šä¹‰ä¸€ä¸ªæµ‹è¯•ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangxiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>deft<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultInterfaceTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SubClass sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre class=" language-txt"><code class="language-txt">xiaocaiInterfaceæ¥å£ä¸­çš„é™æ€æ–¹æ³•</code></pre><h4 id="åŒåæ–¹æ³•è°ƒç”¨åŸåˆ™"><a href="#åŒåæ–¹æ³•è°ƒç”¨åŸåˆ™" class="headerlink" title="åŒåæ–¹æ³•è°ƒç”¨åŸåˆ™"></a>åŒåæ–¹æ³•è°ƒç”¨åŸåˆ™</h4><p>æ¥å£é»˜è®¤æ–¹æ³•çš„â€ç±»ä¼˜å…ˆâ€åŸåˆ™ï¼š</p><p>è‹¥ä¸€ä¸ªæ¥å£ä¸­å®šä¹‰äº†ä¸€ä¸ªé»˜è®¤æ–¹æ³•ï¼Œå¦ä¸€ä¸ªçˆ¶ç±»æˆ–æ¥å£ä¸­ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªåŒåæ–¹æ³•æ—¶ï¼š</p><p>ï¼ˆ1ï¼‰é€‰æ‹©çˆ¶ç±»ä¸­çš„æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªçˆ¶ç±»æä¾›äº†å…·ä½“çš„å®ç°ï¼Œé‚£ä¹ˆæ¥å£ä¸­å…·æœ‰ç›¸åŒåç§°å’Œå‚æ•°çš„é»˜è®¤æ–¹æ³•ä¼šè¢«å¿½ç•¥ã€‚</p><p>ï¼ˆ2ï¼‰æ¥å£å†²çªã€‚å¦‚æœçˆ¶æ¥å£æä¾›ä¸€ä¸ªé»˜è®¤æ–¹æ³•ï¼Œå¦ä¸€ä¸ªæ¥å£ä¹Ÿæä¾›äº†ä¸€ä¸ªå…·æœ‰ç›¸åŒåç§°å’Œå‚æ•°åˆ—è¡¨çš„æ–¹æ³•ï¼ˆä¸ç®¡æ–¹æ³•æ˜¯å¦é»˜è®¤ï¼‰ï¼Œé‚£ä¹ˆå¿…é¡»è¦†ç›–è¯¥æ–¹æ³•æ¥è§£å†³å†²çªã€‚</p><p>å¦‚ï¼š<br>å®šä¹‰æ¥å£1ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyInterFace1</span><span class="token punctuation">{</span>    <span class="token keyword">default</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"æˆ‘æ˜¯æ¥å£1"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®šä¹‰æ¥å£2ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyInterFace2</span><span class="token punctuation">{</span>    <span class="token keyword">default</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"æˆ‘æ˜¯æ¥å£2"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®šä¹‰ä¸€ä¸ªå­ç±»:</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestMyInf</span> <span class="token keyword">implements</span> <span class="token class-name">MyInterFace1</span><span class="token punctuation">,</span> MyInterFace2<span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> MyInterFace1<span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>åœ¨å®šä¹‰å­ç±»æ—¶ï¼Œå¿…é¡»é€‰æ‹©<code>getName()</code>æ–¹æ³•è¿›è¡Œè¦†ç›–ï¼Œå¯ä»¥ä½¿ç”¨<code>MyInterFace1</code>æˆ–<code>MyInterFace2</code>å‡å¯ã€‚</p><h3 id="2-æ¥å£é™æ€æ–¹æ³•"><a href="#2-æ¥å£é™æ€æ–¹æ³•" class="headerlink" title="2. æ¥å£é™æ€æ–¹æ³•"></a>2. æ¥å£é™æ€æ–¹æ³•</h3><p>java 8 ä¸­æ¥å£å…è®¸æ·»åŠ é™æ€æ–¹æ³•ã€‚</p><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangxiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>deft<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>    <span class="token keyword">default</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"xiaocaiInterface"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¥å£ä¸­çš„é™æ€æ–¹æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è°ƒç”¨ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangxiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>deft<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultInterfaceTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        MyInterface<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 ä¸­çš„Stream API</title>
      <link href="/posts/2da068d9.html"/>
      <url>/posts/2da068d9.html</url>
      
        <content type="html"><![CDATA[<h2 id="Java8-ä¸­çš„Stream-API"><a href="#Java8-ä¸­çš„Stream-API" class="headerlink" title="Java8 ä¸­çš„Stream API"></a>Java8 ä¸­çš„Stream API</h2><p>Stream æ˜¯ Java8 ä¸­å¤„ç†é›†åˆçš„å…³é”®æŠ½è±¡æ¦‚å¿µã€‚å¯ä»¥å¯¹é›†åˆè¿›è¡Œæ“ä½œï¼Œæ‰§è¡Œå¤æ‚çš„æŸ¥æ‰¾ã€è¿‡æ»¤ã€æ˜ å°„æ•°æ®ç­‰ç›¸å…³æ“ä½œã€‚ä½¿ç”¨Stream API å¯¹é›†åˆæ“ä½œç±»ä¼¼äºSQLæŸ¥è¯¢ã€‚</p><h2 id="ä¸€-ã€Stream-ï¼ˆæµï¼‰æ˜¯ä»€ä¹ˆ"><a href="#ä¸€-ã€Stream-ï¼ˆæµï¼‰æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ ã€Stream ï¼ˆæµï¼‰æ˜¯ä»€ä¹ˆ"></a>ä¸€ ã€Stream ï¼ˆæµï¼‰æ˜¯ä»€ä¹ˆ</h2><p>stream æ˜¯ä¸€ç§æ•°æ®æ¸ é“ï¼Œç”¨æ¥æ“ä½œæ•°æ®æºå¹¶ç”Ÿæˆæ–°çš„å…ƒç´ åºåˆ—çš„è¿‡ç¨‹ã€‚æ˜¯ä¸€ä¸ªæ¥è‡ªæ•°æ®æºçš„å…ƒç´ é˜Ÿåˆ—å¹¶æ”¯æŒæŸ¥æ‰¾è¿‡æ»¤æ˜ å°„ç­‰èšåˆæ“ä½œã€‚</p><p>éœ€è¦æ³¨æ„ç‚¹ï¼š<br>ï¼ˆ1ï¼‰Stream è‡ªå·±ä¸ä¼šå­˜å­˜å‚¨å…ƒç´ ã€‚ï¼ˆæ‰€ä»¥ä¸æ˜¯é›†åˆï¼‰<br>ï¼ˆ2ï¼‰Stream çš„æ¥æºå¯ä»¥æ˜¯é›†åˆã€æ•°ç»„ã€IOæ¨å¯¼ã€äº§ç”Ÿå™¨generatorç­‰ã€‚<br>ï¼ˆ3ï¼‰Stream ä¸ä¼šæ”¹å˜æºå¯¹è±¡ï¼Œåœ¨ Stream ç»“æŸæ“ä½œä¹‹åä¼šè¿”å›ä¸€ä¸ªæŒæœ‰æ“ä½œç»“æœçš„æ–° Stream ã€‚<br>ï¼ˆ4ï¼‰Stream çš„èšåˆæ“ä½œç±»ä¼¼SQLè¯­å¥ï¼Œå¦‚ï¼šfilterã€mapã€reduceã€findã€matchã€sortedç­‰<br>ï¼ˆ4ï¼‰Stream æ“ä½œæ˜¯ä¸€ç§ Pipelining ï¼ˆæµæ°´çº¿æŠ€æœ¯ï¼‰ï¼Œä¸­é—´æ“ä½œè¿”å›æµå¯¹è±¡æœ¬èº«ï¼Œè¿™æ ·å¯ä»¥å°†å¤šä¸ªæ“ä½œä¸²è”æˆä¸€ä¸ªç®¡é“ï¼Œå¦‚<code>fluent style(æµå¼é£æ ¼)</code>ï¼Œå¯ä»¥å®ç°å»¶è¿Ÿæ‰§è¡Œï¼ˆLazinessï¼‰å’ŒçŸ­è·¯ï¼ˆShort-Circuitingï¼‰çš„ä¼˜åŒ–ã€‚<br>ï¼ˆ5ï¼‰Stream é€šè¿‡è®¿é—®è€…æ¨¡å¼(Visitor)å®ç°å†…éƒ¨è¿­ä»£æ–¹å¼ï¼Œæ— é¡»é€šè¿‡Iteratoræˆ–Forè¿›è¡Œå¤–éƒ¨æ˜¾ç¤ºè¿­ä»£ã€‚</p><h2 id="äºŒã€Stream-æ“ä½œæ­¥éª¤"><a href="#äºŒã€Stream-æ“ä½œæ­¥éª¤" class="headerlink" title="äºŒã€Stream æ“ä½œæ­¥éª¤"></a>äºŒã€Stream æ“ä½œæ­¥éª¤</h2><p>Stream æ“ä½œåˆ†ä¸‰æ­¥ï¼š</p><p>ï¼ˆ1ï¼‰åˆ›å»º Stream </p><p>åˆ©ç”¨æ•°æ®æºï¼ˆé›†åˆã€æ•°ç»„ã€IOæ¨å¯¼ã€äº§ç”Ÿå™¨generatorç­‰ï¼‰è·å–æµã€‚</p><p>ï¼ˆ2ï¼‰ä¸­é—´æ“ä½œ </p><p>ä¸­é—´æ“ä½œï¼ˆintermediate operationï¼‰ å¯ä»¥æ˜¯ä¸€ä¸ªä¸­é—´é“¾ï¼Œå¯¹æ•°æ®æºçš„æ•°æ®è¿›è¡Œå¤„ç†</p><p>ï¼ˆ3ï¼‰æœ€ç»ˆæ“ä½œ(terminal operation) </p><p>æœ€ç»ˆæ“ä½œï¼Œä¹Ÿå¯ä»¥å«ç»ˆæ­¢æ“ä½œã€ç»ˆç«¯æ“ä½œã€‚æœ€ç»ˆæ“ä½œæ‰§è¡Œä¸­é—´æ“ä½œé“¾ï¼Œå¹¶ç”Ÿæˆç»“æœã€‚</p><p>æµç¨‹å¤§æ¦‚å¦‚å›¾ï¼š</p><pre class=" language-txt"><code class="language-txt">+--------------------+       +------+   +------+   +---+   +-------+       +--------+| stream of elements +-----> |filter+-> |sorted+-> |map+-> |flatMap|-----> |collect ++--------------------+       +------+   +------+   +---+   +-------+       +--------+</code></pre><h3 id="1ã€åˆ›å»ºæµ"><a href="#1ã€åˆ›å»ºæµ" class="headerlink" title="1ã€åˆ›å»ºæµ"></a>1ã€åˆ›å»ºæµ</h3><h4 id="ï¼ˆ1ï¼‰Collectionæ¥å£è·å–æµ"><a href="#ï¼ˆ1ï¼‰Collectionæ¥å£è·å–æµ" class="headerlink" title="ï¼ˆ1ï¼‰Collectionæ¥å£è·å–æµ"></a>ï¼ˆ1ï¼‰Collectionæ¥å£è·å–æµ</h4><p>java8 çš„<code>Collection</code>æ¥å£è¢«æ‰©å±•ï¼Œæä¾›äº†ä¸¤ä¸ªè·å–æµçš„æ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">default</span> Stream<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//è¿”å›ä¸€ä¸ªä¸²è¡Œæµ</span><span class="token keyword">default</span> Stream<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//è¿”å›ä¸€ä¸ªå¹¶è¡Œæµ</span></code></pre><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Collection æä¾›äº†ä¸¤ä¸ªæ–¹æ³•  stream() ä¸ parallelStream()</span>List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è·å–ä¸€ä¸ªé¡ºåºæµ</span>Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> parallelStream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è·å–ä¸€ä¸ªå¹¶è¡Œæµ</span></code></pre><h4 id="ï¼ˆ2ï¼‰æ•°ç»„è·å–æ•°ç»„æµ"><a href="#ï¼ˆ2ï¼‰æ•°ç»„è·å–æ•°ç»„æµ" class="headerlink" title="ï¼ˆ2ï¼‰æ•°ç»„è·å–æ•°ç»„æµ"></a>ï¼ˆ2ï¼‰æ•°ç»„è·å–æ•°ç»„æµ</h4><p>java8 ä¸­çš„<code>Arrays</code>çš„é™æ€æ–¹æ³•<code>stream()</code>è·å–æ•°ç»„æµ</p><pre class=" language-java"><code class="language-java"><span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> Stream<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">stream</span><span class="token punctuation">(</span>T<span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//è¿”å›æ•°ç»„æµ</span></code></pre><p>è¿˜é‡è½½å½¢å¼ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> IntStream <span class="token function">stream</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">static</span> LongStream <span class="token function">stream</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">static</span> DoubleStream <span class="token function">stream</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span></code></pre><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//é€šè¿‡ Arrays ä¸­çš„ stream() è·å–ä¸€ä¸ªæ•°ç»„æµ</span>Integer<span class="token punctuation">[</span><span class="token punctuation">]</span> nums <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>Stream<span class="token operator">&lt;</span>Integer<span class="token operator">></span> stream1 <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="ï¼ˆ3ï¼‰æ ¹æ®å€¼è·å–æµ"><a href="#ï¼ˆ3ï¼‰æ ¹æ®å€¼è·å–æµ" class="headerlink" title="ï¼ˆ3ï¼‰æ ¹æ®å€¼è·å–æµ"></a>ï¼ˆ3ï¼‰æ ¹æ®å€¼è·å–æµ</h4><p>å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³•<code>Stream.of()</code>åˆ©ç”¨æ˜¾ç¤ºå€¼åˆ›å»ºæµï¼Œå®ƒå¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span><span class="token operator">&lt;</span>T<span class="token operator">></span> Stream<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">stream</span><span class="token punctuation">(</span>T<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span></code></pre><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// é€šè¿‡ Stream ç±»ä¸­é™æ€æ–¹æ³• of()</span>Stream<span class="token operator">&lt;</span>Integer<span class="token operator">></span> stream2 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="ï¼ˆ4ï¼‰åˆ›å»ºæ— é™æµ"><a href="#ï¼ˆ4ï¼‰åˆ›å»ºæ— é™æµ" class="headerlink" title="ï¼ˆ4ï¼‰åˆ›å»ºæ— é™æµ"></a>ï¼ˆ4ï¼‰åˆ›å»ºæ— é™æµ</h4><p>å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³•<code>Stream.iterate()</code>å’Œ<code>Stream.generate()</code>åˆ›å»ºæ— é™æµã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span><span class="token operator">&lt;</span>T<span class="token operator">></span> Stream<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">iterate</span><span class="token punctuation">(</span><span class="token keyword">final</span> T seed<span class="token punctuation">,</span> <span class="token keyword">final</span> UnaryOperator<span class="token operator">&lt;</span>T<span class="token operator">></span> f<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">static</span><span class="token operator">&lt;</span>T<span class="token operator">></span> Stream<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">generate</span><span class="token punctuation">(</span>Supplier<span class="token operator">&lt;</span>T<span class="token operator">></span> s<span class="token punctuation">)</span></code></pre><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//è¿­ä»£</span>Stream<span class="token operator">&lt;</span>Integer<span class="token operator">></span> stream3 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stream3<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç”Ÿæˆ</span>Stream<span class="token operator">&lt;</span>Double<span class="token operator">></span> stream4 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>Math<span class="token operator">:</span><span class="token operator">:</span>random<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stream4<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2ã€ä¸­é—´æ“ä½œ"><a href="#2ã€ä¸­é—´æ“ä½œ" class="headerlink" title="2ã€ä¸­é—´æ“ä½œ"></a>2ã€ä¸­é—´æ“ä½œ</h3><p>ä¸­é—´æ“ä½œæ˜¯å¯¹æ•°æ®æºè¿›è¡Œå¤„ç†çš„æ“ä½œï¼Œ<font color=â€œredâ€>å¤šä¸ªä¸­é—´æ“ä½œè¿æ¥èµ·æ¥å½¢æˆä¸­é—´é“¾/æµæ°´çº¿ï¼Œé™¤éä¸­é—´é“¾ä¸Šè§¦å‘ç»ˆæ­¢æ“ä½œï¼Œå¦åˆ™ä¸­é—´æ“ä½œä¸ä¼šæ‰§è¡Œä»»ä½•å¤„ç†ï¼Œè€Œæ˜¯åœ¨ç»ˆæ­¢æ“ä½œæ—¶ä¸€æ¬¡æ€§å…¨éƒ¨å¤„ç†ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€å»¶è¿ŸåŠ è½½â€æˆ–â€œæƒ°æ€§æ±‚å€¼â€ã€‚</font></p><h4 id="ï¼ˆ1ï¼‰ç­›é€‰å’Œåˆ‡ç‰‡"><a href="#ï¼ˆ1ï¼‰ç­›é€‰å’Œåˆ‡ç‰‡" class="headerlink" title="ï¼ˆ1ï¼‰ç­›é€‰å’Œåˆ‡ç‰‡"></a>ï¼ˆ1ï¼‰ç­›é€‰å’Œåˆ‡ç‰‡</h4><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>filter(Predicate p)</td><td>æ¥æ”¶Lambaï¼Œä»æµä¸­æ’é™¤æŸäº›å…ƒç´ </td></tr><tr><td>distinct()</td><td>ç­›é€‰ï¼Œé€šè¿‡æµæ‰€ç”Ÿæˆå…ƒç´ çš„hashCode()å’Œequals()å»é™¤é‡å¤å…ƒç´ </td></tr><tr><td>limit(long maxsize)</td><td>æˆªæ–­æµï¼Œä½¿å…¶å…ƒç´ ä¸è¶…è¿‡ç»™å®šæ•°é‡</td></tr><tr><td>skip(long n)</td><td>è·³è¿‡å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ‰”æ‰äº†å‰nä¸ªå…ƒç´ çš„æµã€‚<br/>è‹¥æµä¸­å…ƒç´ ä¸è¶³nä¸ªï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºæµã€‚ä¸limit(n)äº’è¡¥ã€‚</td></tr></tbody></table><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>User<span class="token operator">></span> users <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">"æå››"</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">6666.66</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">9999.99</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token string">"ç‹äº”"</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">3333.33</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token string">"èµµå…­"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7777.77</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token string">"èµµå…­"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7777.77</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token string">"èµµå…­"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7777.77</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span> <span class="token string">"ç”°ä¸ƒ"</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">5555.55</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ‰€æœ‰çš„ä¸­é—´æ“ä½œä¸ä¼šåšä»»ä½•çš„å¤„ç†</span>Stream<span class="token operator">&lt;</span>User<span class="token operator">></span> stream <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æµ‹è¯•ä¸­é—´æ“ä½œæ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">30</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åªæœ‰å½“åšç»ˆæ­¢æ“ä½œæ—¶ï¼Œæ‰€æœ‰çš„ä¸­é—´æ“ä½œä¼šä¸€æ¬¡æ€§çš„å…¨éƒ¨æ‰§è¡Œï¼Œç§°ä¸ºâ€œæƒ°æ€§æ±‚å€¼â€</span>stream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å»é‡å¤</span>users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çŸ­è·¯ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &amp;&amp;  ||</span>                <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5000</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>users<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5000</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="ï¼ˆ2ï¼‰æ˜ å°„"><a href="#ï¼ˆ2ï¼‰æ˜ å°„" class="headerlink" title="ï¼ˆ2ï¼‰æ˜ å°„"></a>ï¼ˆ2ï¼‰æ˜ å°„</h4><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>map(Function f)</td><td>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œ<br/>å¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ ã€‚</td></tr><tr><td>mapToDouble(ToDoubleFunction df)</td><td>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œ<br/>äº§ç”Ÿä¸€ä¸ªæ–°çš„DoubleStreamã€‚</td></tr><tr><td>mapToInt(ToIntFunction f)</td><td>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œ<br/>äº§ç”Ÿä¸€ä¸ªæ–°çš„IntStreamã€‚</td></tr><tr><td>mapToLong(ToLongFunction f)</td><td>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œ<br/>äº§ç”Ÿä¸€ä¸ªæ–°çš„LongStreamã€‚</td></tr><tr><td>flatMap(Function f)</td><td>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œ<br/>ç„¶åæŠŠæ‰€æœ‰çš„æµè¿æ¥æˆä¸€ä¸ªæ–°çš„æµã€‚</td></tr></tbody></table><p><code>map(Function f)</code>å’Œ<code>flatMap(Function f)</code>çš„åŒºåˆ«å…³äºæœ‰ç‚¹ç±»ä¼¼äº<code>List</code>çš„<code>add(Object o)</code>å’Œ<code>addAll(Collection&lt;?&gt; c)</code>çš„å…³ç³»åŒºåˆ«ï¼›ç±»ä¼¼äº<code>Map</code>çš„ <code>put(K key, V value)</code>å’Œ<code>putAll(Map&lt;?&gt; m)</code>çš„å…³ç³»åŒºåˆ«ã€‚</p><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangxiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>stream<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Stream<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamAPITest1</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">mapTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> str <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        List<span class="token operator">&lt;</span>String<span class="token operator">></span> strList <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"stream"</span><span class="token punctuation">,</span> <span class="token string">"API"</span><span class="token punctuation">,</span> <span class="token string">"small"</span><span class="token punctuation">,</span> <span class="token string">"rose"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Stream<span class="token operator">&lt;</span>String<span class="token operator">></span> stream <span class="token operator">=</span> strList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>String<span class="token operator">:</span><span class="token operator">:</span>toUpperCase<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ‰“å°ç»“æœ</span>        stream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        Stream<span class="token operator">&lt;</span>Stream<span class="token operator">&lt;</span>Character<span class="token operator">>></span> stream2 <span class="token operator">=</span> strList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>TestStreamAPI1<span class="token operator">:</span><span class="token operator">:</span>filterCharacter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ˜¾ç¤ºè¿­ä»£ï¼Œæ‰“å°ç»“æœ</span>        stream2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sm<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>                    sm<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ‰å¹³åŒ–çš„è¿æ¥æµ</span>        Stream<span class="token operator">&lt;</span>Character<span class="token operator">></span> stream3 <span class="token operator">=</span> strList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>TestStreamAPI1<span class="token operator">:</span><span class="token operator">:</span>filterCharacter<span class="token punctuation">)</span><span class="token punctuation">;</span>        stream3<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> Stream<span class="token operator">&lt;</span>Character<span class="token operator">></span> <span class="token function">filterCharacter</span><span class="token punctuation">(</span>String str<span class="token punctuation">)</span><span class="token punctuation">{</span>        List<span class="token operator">&lt;</span>Character<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>Character ch <span class="token operator">:</span> str<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="ï¼ˆ3ï¼‰æ’åº"><a href="#ï¼ˆ3ï¼‰æ’åº" class="headerlink" title="ï¼ˆ3ï¼‰æ’åº"></a>ï¼ˆ3ï¼‰æ’åº</h4><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>sorted()</td><td>äº§ç”Ÿä¸€ä¸ªæ–°æµï¼Œå…¶ä¸­æŒ‰è‡ªç„¶é¡ºåºæ’åº</td></tr><tr><td>sorted(Comparator comp)</td><td>äº§ç”Ÿä¸€ä¸ªæ–°æµï¼Œå…¶ä¸­æŒ‰è‡ªå®šä¹‰æ¯”è¾ƒå™¨é¡ºåºæ’åº</td></tr></tbody></table><p>å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//è‡ªç„¶æ’åº</span>users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ¯”è¾ƒå™¨æ’åº</span>users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> y<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> Integer<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="3ã€ç»ˆæ­¢æ“ä½œ"><a href="#3ã€ç»ˆæ­¢æ“ä½œ" class="headerlink" title="3ã€ç»ˆæ­¢æ“ä½œ"></a>3ã€ç»ˆæ­¢æ“ä½œ</h3><p>ç»ˆç«¯æ“ä½œæ˜¯è®©æµçš„ä¸­é—´é“¾ç”Ÿæˆç»“æœã€‚å®ƒçš„ç»“æœå¯ä»¥æ˜¯ä»»ä½•ä¸æ˜¯æµçš„å€¼ï¼Œæ¯”å¦‚ï¼š<code>List</code>ã€<code>Integer</code>ã€<code>Map</code>ï¼Œä¹Ÿå¯ä»¥æ˜¯<code>void</code>ã€‚</p><h4 id="ï¼ˆ1ï¼‰æŸ¥æ‰¾åŒ¹é…"><a href="#ï¼ˆ1ï¼‰æŸ¥æ‰¾åŒ¹é…" class="headerlink" title="ï¼ˆ1ï¼‰æŸ¥æ‰¾åŒ¹é…"></a>ï¼ˆ1ï¼‰æŸ¥æ‰¾åŒ¹é…</h4><table><thead><tr><th>æ–¹æ³•</th><th>è¿”å›ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>allMatch(Predicate p)</td><td><code>Boolean</code></td><td>æ£€æŸ¥æ˜¯å¦åŒ¹é…æ‰€æœ‰å…ƒç´ </td></tr><tr><td>anyMatch(Predicate p)</td><td><code>Boolean</code></td><td>æ£€æŸ¥æ˜¯å¦è‡³å°‘åŒ¹é…ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>noneMatch(Predicate p)</td><td><code>Boolean</code></td><td>æ£€æŸ¥æ˜¯å¦æ²¡æœ‰åŒ¹é…æ‰€æœ‰å…ƒç´ </td></tr><tr><td>findFirst()</td><td><code>Optional&lt;T&gt;</code></td><td>è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>findAny()</td><td><code>Optional&lt;T&gt;</code></td><td>è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ </td></tr></tbody></table><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>User<span class="token operator">></span> users <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">"æå››"</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">6666.66</span><span class="token punctuation">,</span> Status<span class="token punctuation">.</span>BUSY<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">9999.99</span><span class="token punctuation">,</span> Status<span class="token punctuation">.</span>FREE<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token string">"ç‹äº”"</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">3333.33</span><span class="token punctuation">,</span> Status<span class="token punctuation">.</span>VOCATION<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token string">"èµµå…­"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7777.77</span><span class="token punctuation">,</span> Status<span class="token punctuation">.</span>BUSY<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token string">"èµµå…­"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7777.77</span><span class="token punctuation">,</span> Status<span class="token punctuation">.</span>FREE<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token string">"èµµå…­"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7777.77</span><span class="token punctuation">,</span> Status<span class="token punctuation">.</span>FREE<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span> <span class="token string">"ç”°ä¸ƒ"</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">5555.55</span><span class="token punctuation">,</span> Status<span class="token punctuation">.</span>BUSY<span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">boolean</span> bl <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allMatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Status<span class="token punctuation">.</span>BUSY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//false</span><span class="token keyword">boolean</span> bl1 <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Status<span class="token punctuation">.</span>BUSY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bl1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//true</span><span class="token keyword">boolean</span> bl2 <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noneMatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Status<span class="token punctuation">.</span>BUSY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bl2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//false</span>Optional<span class="token operator">&lt;</span>User<span class="token operator">></span> op <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Double<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>e1<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e2<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>op<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>User<span class="token operator">></span> op2 <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Status<span class="token punctuation">.</span>FREE<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">findAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>op2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="ï¼ˆ2ï¼‰èšåˆ"><a href="#ï¼ˆ2ï¼‰èšåˆ" class="headerlink" title="ï¼ˆ2ï¼‰èšåˆ"></a>ï¼ˆ2ï¼‰èšåˆ</h4><table><thead><tr><th>æ–¹æ³•</th><th>è¿”å›ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>count()</td><td><code>Long</code></td><td>è¿”å›æµä¸­å…ƒç´ æ€»æ•°</td></tr><tr><td>max(Comparator c)</td><td><code>Optional&lt;T&gt;</code></td><td>è¿”å›æµä¸­æœ€å¤§å€¼</td></tr><tr><td>min(Comparator c)</td><td><code>Optional&lt;T&gt;</code></td><td>è¿”å›æµä¸­æœ€å°å€¼</td></tr><tr><td>forEach(Consumer c)</td><td></td><td>Stream APIçš„å†…éƒ¨è¿­ä»£</td></tr></tbody></table><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">long</span> count <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Status<span class="token punctuation">.</span>FREE<span class="token punctuation">)</span><span class="token punctuation">)</span>                         <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>Double<span class="token operator">></span> op <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getSalary<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>Double<span class="token operator">:</span><span class="token operator">:</span>compare<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>op<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>User<span class="token operator">></span> op2 <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Double<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>e1<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e2<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>op2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Stream<span class="token operator">&lt;</span>User<span class="token operator">></span> stream <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Status<span class="token punctuation">.</span>FREE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> count <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æµè¿›è¡Œäº†ç»ˆæ­¢æ“ä½œåï¼Œä¸èƒ½å†æ¬¡ä½¿ç”¨</span>stream<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getSalary<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>Double<span class="token operator">:</span><span class="token operator">:</span>compare<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="ï¼ˆ3ï¼‰å½’çº¦"><a href="#ï¼ˆ3ï¼‰å½’çº¦" class="headerlink" title="ï¼ˆ3ï¼‰å½’çº¦"></a>ï¼ˆ3ï¼‰å½’çº¦</h4><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>reduce(T iden, BinaryOperator b)</td><td>å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ï¼Œè¿”å›T</td></tr><tr><td>reduce(BinaryOperator b)</td><td>å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ï¼Œè¿”å›<code>Optional&lt;T&gt;</code></td></tr></tbody></table><p><code>map</code>å’Œ<code>reduce</code>çš„è¿æ¥é€šå¸¸ç§°ä¸º<code>map-reduce</code>æ¨¡å¼ï¼Œå› Googleç”¨å®ƒæ¥è¿›è¡Œç½‘ç»œæœç´¢è€Œå‡ºåã€‚</p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Integer sum <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Optional<span class="token operator">&lt;</span>Double<span class="token operator">></span> op <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getSalary<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>Double<span class="token operator">:</span><span class="token operator">:</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>op<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æŸ¥åå­—é‡Œå‡ºç°"å…­"çš„æ¬¡æ•°</span>Optional<span class="token operator">&lt;</span>Integer<span class="token operator">></span> sum <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>TestStreamAPI1<span class="token operator">:</span><span class="token operator">:</span>filterCharacter<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">'å…­'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">else</span>                     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>Integer<span class="token operator">:</span><span class="token operator">:</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="ï¼ˆ4ï¼‰æ”¶é›†"><a href="#ï¼ˆ4ï¼‰æ”¶é›†" class="headerlink" title="ï¼ˆ4ï¼‰æ”¶é›†"></a>ï¼ˆ4ï¼‰æ”¶é›†</h4><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>collect(Collector c)</td><td>å°†æµè½¬æ¢ä¸ºå…¶ä»–å½¢å¼ã€‚æ¥å—ä¸€ä¸ª<code>Collector</code>æ¥å£çš„å®ç°ï¼Œç”¨äºç»™Streamä¸­å…ƒç´ åšæ±‡æ€»çš„æ–¹æ³•ã€‚</td></tr></tbody></table><p><code>Collector</code>æ¥å£ä¸­æ–¹æ³•çš„å®ç°å†³å®šäº†å¦‚ä½•å¯¹æµæ‰§è¡Œæ”¶é›†æ“ä½œï¼ˆå¦‚ä½•æ”¶é›†åˆ°<code>List</code>ã€<code>Set</code>ã€<code>Map</code>ï¼‰ã€‚ä½†æ˜¯<code>Collectors</code>å®ç”¨ç±»æä¾›äº†å¾ˆå¤šé™æ€æ–¹æ³•ï¼Œå¯ä»¥æ–¹ä¾¿åˆ›å»ºå¸¸è§æ”¶é›†å™¨å®ä¾‹ï¼Œå…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>è¿”å›ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>toList</td><td><code>List&lt;T&gt;</code></td><td>æŠŠæµä¸­å…ƒç´ æ”¶é›†åˆ°<code>List</code>é›†åˆ</td></tr><tr><td>toSet</td><td><code>Set&lt;T&gt;</code></td><td>æŠŠæµä¸­å…ƒç´ æ”¶é›†åˆ°<code>Set</code>é›†åˆ</td></tr><tr><td>toCollection</td><td><code>Collection&lt;T&gt;</code></td><td>æŠŠæµä¸­å…ƒç´ æ”¶é›†åˆ°åˆ›å»ºçš„é›†åˆ</td></tr><tr><td>counting</td><td><code>Long</code></td><td>è®¡ç®—æµä¸­å…ƒç´ çš„ä¸ªæ•°</td></tr><tr><td>summingInt</td><td><code>Integer</code></td><td>å¯¹æµä¸­å…ƒç´ çš„æ•´æ•°å±æ€§æ±‚å’Œ</td></tr><tr><td>averagingInt</td><td><code>Double</code></td><td>è®¡ç®—æµä¸­å…ƒç´ <code>Intger</code>å±æ€§çš„å¹³å‡å€¼</td></tr><tr><td>sunmarizingInt</td><td><code>IntSummaryStatistics</code></td><td>æ”¶é›†æµä¸­<code>Intger</code>å±æ€§çš„ç»Ÿè®¡å€¼ã€‚å¦‚ï¼šå¹³å‡å€¼</td></tr><tr><td>joining</td><td><code>String</code></td><td>è¿æ¥æµä¸­æ¯ä¸ªå­—ç¬¦ä¸²</td></tr><tr><td>maxBy</td><td><code>Optional&lt;T&gt;</code></td><td>æ ¹æ®æ¯”è¾ƒå™¨é€‰æ‹©æœ€å¤§å€¼</td></tr><tr><td>minBy</td><td><code>Optional&lt;T&gt;</code></td><td>æ ¹æ®æ¯”è¾ƒå™¨é€‰æ‹©æœ€å°å€¼</td></tr><tr><td>reducing</td><td>å½’çº¦äº§ç”Ÿçš„ç±»å‹</td><td>ä»ä¸€ä¸ªä½œä¸ºç´¯åŠ å™¨çš„åˆå§‹å€¼å¼€å§‹ï¼Œåˆ©ç”¨<code>BinaryOperator</code>ä¸æµä¸­å…ƒç´ é€ä¸ªç»“åˆï¼Œä»è€Œå½’çº¦æˆå•ä¸ªå€¼</td></tr><tr><td>CollectingAndThen</td><td>è½¬æ¢å‡½æ•°è¿”å›çš„ç±»å‹</td><td>åŒ…è£¹å¦ä¸€ä¸ªæ”¶é›†å™¨ï¼Œå¯¹å…¶ç»“æœè½¬æ¢å‡½æ•°</td></tr><tr><td>groupingBy</td><td><code>Map&lt;K,List&lt;T&gt;&gt;</code></td><td>æ ¹æ®æŸå±æ€§å€¼å¯¹æµåˆ†ç»„ï¼Œå±æ€§ä¸ºKï¼Œç»“æœä¸ºV</td></tr><tr><td>partitioningBy</td><td><code>Map&lt;Boolean,List&lt;T&gt;&gt;</code></td><td>æ ¹æ®<code>true</code>æˆ–<code>false</code>è¿›è¡Œåˆ†åŒº</td></tr></tbody></table><p>æ–¹å¼ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// toList</span>List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// toSet</span>Set<span class="token operator">&lt;</span>String<span class="token operator">></span> set <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>set<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// toCollection</span>HashSet<span class="token operator">&lt;</span>String<span class="token operator">></span> hs <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toCollection</span><span class="token punctuation">(</span>HashSet<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// maxBy æœ€å¤§å€¼</span>Optional<span class="token operator">&lt;</span>Double<span class="token operator">></span> max <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getSalary<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">maxBy</span><span class="token punctuation">(</span>Double<span class="token operator">:</span><span class="token operator">:</span>compare<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>max<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// minBy æœ€å°å€¼</span>Optional<span class="token operator">&lt;</span>User<span class="token operator">></span> op <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">minBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Double<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>e1<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e2<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>op<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// summingDouble</span>Double sum <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">summingDouble</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getSalary<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// averagingDouble  å¹³å‡å€¼</span>Double avg <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">averagingDouble</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getSalary<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>avg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// counting æ€»æ•°</span>Long count <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">counting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// summarizingDouble  æ€»å’Œ</span>DoubleSummaryStatistics dss <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">summarizingDouble</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getSalary<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dss<span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dss<span class="token punctuation">.</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dss<span class="token punctuation">.</span><span class="token function">getAverage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// groupingBy åˆ†ç»„</span>Map<span class="token operator">&lt;</span>Status<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>User<span class="token operator">>></span> map <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getStatus<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å¤šçº§åˆ†ç»„</span>Map<span class="token operator">&lt;</span>Status<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>User<span class="token operator">>>></span> map <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getStatus<span class="token punctuation">,</span> Collectors<span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">60</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span> <span class="token string">"è€å¹´"</span><span class="token punctuation">;</span>                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">35</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span> <span class="token string">"ä¸­å¹´"</span><span class="token punctuation">;</span>                <span class="token keyword">else</span>                    <span class="token keyword">return</span> <span class="token string">"æˆå¹´"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// partitioningBy åˆ†åŒº</span>Map<span class="token operator">&lt;</span>Boolean<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>User<span class="token operator">>></span> map <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">partitioningBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> e<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// joining è¿æ¥</span>String str <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">","</span> <span class="token punctuation">,</span> <span class="token string">"----"</span><span class="token punctuation">,</span> <span class="token string">"----"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ä»¥é€—å·åˆ†éš”ï¼Œå‰ååŠ  ------</span><span class="token comment" spellcheck="true">// reducing å½’çº¦</span>Optional<span class="token operator">&lt;</span>Double<span class="token operator">></span> sum <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getSalary<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">reducing</span><span class="token punctuation">(</span>Double<span class="token operator">:</span><span class="token operator">:</span>sum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="ä¸‰ã€å¹¶è¡Œæµä¸ä¸²è¡Œæµ"><a href="#ä¸‰ã€å¹¶è¡Œæµä¸ä¸²è¡Œæµ" class="headerlink" title="ä¸‰ã€å¹¶è¡Œæµä¸ä¸²è¡Œæµ"></a>ä¸‰ã€å¹¶è¡Œæµä¸ä¸²è¡Œæµ</h2><p><strong>å¹¶è¡Œæµ</strong> å°±æ˜¯æŠŠä¸€ä¸ªå†…å®¹åˆ†æˆå¤šä¸ªæ•°æ®åº“ï¼Œå¹¶ç”¨ä¸åŒçš„çº¿ç¨‹åˆ†åˆ«å¤„ç†æ¯ä¸ªæ•°æ®å—çš„æµã€‚</p><p>java8 ä¸­å°†å¹¶è¡Œè¿›è¡Œä¼˜åŒ–ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å¯¹æ•°æ®è¿›è¡Œå¹¶è¡Œæ“ä½œã€‚Stream API å¯ä»¥å£°æ˜æ€§åœ°é€šè¿‡<code>parallel()</code>å’Œ<code>sequential()</code>åœ¨å¹¶è¡Œæµå’Œä¸²è¡Œæµä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚</p><p>ä¸€ä¸ªæ•´æ•°ç´¯åŠ çš„ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">paralleltTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">long</span> start <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Long sum <span class="token operator">=</span> LongStream<span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span>0L<span class="token punctuation">,</span> 10000000000L<span class="token punctuation">)</span>                             <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> end <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è€—è´¹çš„æ—¶é—´ä¸º: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span></code></pre><h2 id="å››ã€ForK-Join-æ¡†æ¶ç®€ä»‹"><a href="#å››ã€ForK-Join-æ¡†æ¶ç®€ä»‹" class="headerlink" title="å››ã€ForK /Join æ¡†æ¶ç®€ä»‹"></a>å››ã€ForK /Join æ¡†æ¶ç®€ä»‹</h2><p>ForK /Join æ¡†æ¶ï¼š å°±æ˜¯åœ¨æ¯”è¦æ—¶ï¼Œå¯ä»¥å°†ä¸€ä¸ªå¤§ä»»åŠ¡ï¼Œè¿›è¡Œæ‹†åˆ†ï¼ˆ<code>fork</code>ï¼‰æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼ˆæ‹†åˆ°ä¸å¯å†æ‹†æ—¶ï¼‰ï¼Œå†å°†ä¸€ä¸ªä¸ªçš„å°ä»»åŠ¡è¿ç®—çš„ç»“æœè¿›è¡Œ<code>Join</code>æ±‡æ€»ã€‚</p><p>ForK / Join æ¡†æ¶å’Œä¼ ç»Ÿçº¿ç¨‹æ± åŒºåˆ«ï¼š</p><p>ForK / Join æ¡†æ¶é‡‡ç”¨çš„æ˜¯<code>â€œWorking-Stealingï¼ˆå·¥ä½œçªƒå–ï¼‰â€</code>æ¨¡å¼ï¼šå½“æ‰§è¡Œæ–°çš„ä»»åŠ¡æ—¶å®ƒå¯ä»¥å°†å…¶æ‹†åˆ†æˆæ›´å°é¢—ç²’çš„ä»»åŠ¡æ‰§è¡Œï¼Œå¹¶å°†å°ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹é˜Ÿåˆ—ä¸­ï¼Œç„¶åå†ä»ä¸€ä¸ªéšæœºçº¿ç¨‹çš„é˜Ÿåˆ—ä¸­å·ä¸€ä¸ªå¹¶æŠŠå®ƒæ”¾åœ¨è‡ªå·±é˜Ÿåˆ—ä¸­ã€‚</p><p>ç›¸æ¯”äºä¸€èˆ¬çº¿ç¨‹æ± å®ç°ï¼ŒForK / Join çš„ä¼˜åŠ¿æ˜¯åœ¨å¯¹å…¶ä¸­åŒ…å«çš„ä»»åŠ¡çš„å¤„ç†æ–¹å¼ä¸Šï¼Œåœ¨ä¸€èˆ¬çš„çº¿ç¨‹æ± ä¸­ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æœ‰ä½™æŸäº›åŸå› æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šå¤„äºç­‰å¾…çŠ¶æ€ã€‚è€ŒForK / Join æ¡†æ¶å®ç°ä¸­ï¼Œå¦‚æœæŸä¸ªå­é—®é¢˜ç”±äºç­‰å¾…å¦ä¸€ä¸ªå­é—®é¢˜çš„å®Œæˆè€Œæ— æ³•ç»§ç»­æ‰§è¡Œæ—¶ï¼Œå¤„ç†è¯¥å­é—®é¢˜çš„çº¿ç¨‹ä¼šä¸»åŠ¨å¯»æ‰¾å…¶ä»–å°šæœªè¿è¡Œçš„å­é—®é¢˜æ¥æ‰§è¡Œã€‚è¿™ç§æ–¹å¼å‡å°‘äº†çº¿ç¨‹çš„ç­‰å¾…æ—¶é—´ï¼Œå¯ä»¥æœ‰æ•ˆçš„æé«˜æ€§èƒ½ã€‚</p><p>Fork/Joinæ¡†æ¶ä¸»è¦ç±»</p><table><thead><tr><th>åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>ForkJoinPool</td><td>ç”¨æ¥æ‰§è¡ŒTaskï¼Œæˆ–ç”Ÿæˆæ–°çš„ForkJoinWorkerThreadï¼Œæ‰§è¡Œ ForkJoinWorkerThread é—´çš„ work-stealing é€»è¾‘ã€‚ForkJoinPool ä¸æ˜¯ä¸ºäº†æ›¿ä»£ ExecutorServiceï¼Œè€Œæ˜¯å®ƒçš„è¡¥å……ï¼Œåœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹æ€§èƒ½æ¯” ExecutorService æ›´å¥½ã€‚</td></tr><tr><td>ForkJoinTask</td><td>æ‰§è¡Œå…·ä½“çš„åˆ†æ”¯é€»è¾‘ï¼Œå£°æ˜ä»¥åŒæ­¥/å¼‚æ­¥æ–¹å¼è¿›è¡Œæ‰§è¡Œ</td></tr><tr><td>ForkJoinWorkerThread</td><td>æ˜¯ ForkJoinPool å†…çš„ worker threadï¼Œæ‰§è¡ŒForkJoinTask, å†…éƒ¨æœ‰ ForkJoinPool.WorkQueueæ¥ä¿å­˜è¦æ‰§è¡Œçš„ForkJoinTaskã€‚</td></tr><tr><td>ForkJoinPool.WorkQueue</td><td>ä¿å­˜è¦æ‰§è¡Œçš„ForkJoinTaskã€‚</td></tr></tbody></table><p>Fork/Joinæ¡†æ¶ä¸»è¦é€»è¾‘ï¼š</p><p>ForkJoinPool çš„æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½ç»´æŠ¤ç€ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼ˆWorkQueueï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼ˆDequeï¼‰ï¼Œé‡Œé¢å­˜æ”¾çš„å¯¹è±¡æ˜¯ä»»åŠ¡ï¼ˆForkJoinTaskï¼‰ã€‚</p><p>æ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨è¿è¡Œä¸­äº§ç”Ÿæ–°çš„ä»»åŠ¡ï¼ˆé€šå¸¸æ˜¯å› ä¸ºè°ƒç”¨äº†<br><code>fork()</code>ï¼‰æ—¶ï¼Œä¼šæ”¾å…¥å·¥ä½œé˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹åœ¨å¤„ç†è‡ªå·±çš„å·¥ä½œé˜Ÿåˆ—æ—¶ï¼Œä½¿ç”¨çš„æ˜¯<code>LIFO</code>æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡ä»é˜Ÿå°¾å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚</p><p>æ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨å¤„ç†è‡ªå·±çš„å·¥ä½œé˜Ÿåˆ—åŒæ—¶ï¼Œä¼šå°è¯•çªƒå–ä¸€ä¸ªä»»åŠ¡ï¼ˆæˆ–æ˜¯æ¥è‡ªäºåˆšåˆšæäº¤åˆ° pool çš„ä»»åŠ¡ï¼Œæˆ–æ˜¯æ¥è‡ªäºå…¶ä»–å·¥ä½œçº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—ï¼‰ï¼Œçªƒå–çš„ä»»åŠ¡ä½äºå…¶ä»–çº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—çš„é˜Ÿé¦–ï¼Œä¹Ÿå°±æ˜¯è¯´å·¥ä½œçº¿ç¨‹åœ¨çªƒå–å…¶ä»–å·¥ä½œçº¿ç¨‹çš„ä»»åŠ¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ FIFO æ–¹å¼ã€‚</p><p>åœ¨é‡åˆ° join() æ—¶ï¼Œå¦‚æœéœ€è¦ join çš„ä»»åŠ¡å°šæœªå®Œæˆï¼Œåˆ™ä¼šå…ˆå¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆã€‚</p><p>åœ¨æ—¢æ²¡æœ‰è‡ªå·±çš„ä»»åŠ¡ï¼Œä¹Ÿæ²¡æœ‰å¯ä»¥çªƒå–çš„ä»»åŠ¡æ—¶ï¼Œè¿›å…¥ä¼‘çœ ã€‚</p><p>ä¸€ä¸ªæ•´æ•°ç´¯åŠ çš„ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>java8<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>RecursiveTask<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForkJoinHandle</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token operator">&lt;</span>Long<span class="token operator">></span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> 13475679780L<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> start<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> end<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> THRESHOLD <span class="token operator">=</span> 10000L<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ä¸´ç•Œå€¼</span>    <span class="token keyword">public</span> <span class="token function">ForkJoinHandle</span><span class="token punctuation">(</span><span class="token keyword">long</span> start<span class="token punctuation">,</span> <span class="token keyword">long</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> Long <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">long</span> length <span class="token operator">=</span> end <span class="token operator">-</span> start<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>length <span class="token operator">&lt;=</span> THRESHOLD<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">long</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> sum<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token keyword">long</span> middle <span class="token operator">=</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>            ForkJoinHandle left <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinHandle</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> middle<span class="token punctuation">)</span><span class="token punctuation">;</span>            left<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ‹†åˆ†ï¼Œå¹¶å°†è¯¥å­ä»»åŠ¡å‹å…¥çº¿ç¨‹é˜Ÿåˆ—</span>            ForkJoinHandle right <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinHandle</span><span class="token punctuation">(</span>middle<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>            right<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> left<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> right<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æµ‹è¯•ç±»ï¼š</p><pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forkJoinTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">long</span> start <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ForkJoinPool pool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ForkJoinTask<span class="token operator">&lt;</span>Long<span class="token operator">></span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinHandle</span><span class="token punctuation">(</span>0L<span class="token punctuation">,</span> 20000000000L<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> sum <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> end <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è€—è´¹çš„æ—¶é—´ä¸º: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forkJoinTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        ForkJoinPool forkjoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ForkJoinHandle task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinHandle</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ‰§è¡Œä¸€ä¸ªä»»åŠ¡</span>        Future<span class="token operator">&lt;</span>Integer<span class="token operator">></span> result <span class="token operator">=</span> forkjoinPool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"result"</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printstacktrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span></code></pre><p>æ³¨æ„äº‹å®œï¼š<br>ï¼ˆ1ï¼‰ForkJoinPool ä½¿ç”¨submit æˆ– invoke æäº¤çš„åŒºåˆ«ï¼šinvokeæ˜¯åŒæ­¥æ‰§è¡Œï¼Œè°ƒç”¨ä¹‹åéœ€è¦ç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„ä»£ç ï¼›submitæ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œåªæœ‰åœ¨Futureè°ƒç”¨getçš„æ—¶å€™ä¼šé˜»å¡ã€‚</p><p>ï¼ˆ2ï¼‰è¿™é‡Œç»§æ‰¿çš„æ˜¯RecursiveTaskï¼Œè¿˜å¯ä»¥ç»§æ‰¿RecursiveActionã€‚å‰è€…é€‚ç”¨äºæœ‰è¿”å›å€¼çš„åœºæ™¯ï¼Œè€Œåè€…é€‚åˆäºæ²¡æœ‰è¿”å›å€¼çš„åœºæ™¯</p><p>ï¼ˆ3ï¼‰è¿™é‡Œæ‰§è¡Œå­ä»»åŠ¡è°ƒç”¨forkæ–¹æ³•å¹¶ä¸æ˜¯æœ€ä½³çš„é€‰æ‹©ï¼Œæœ€ä½³çš„é€‰æ‹©æ˜¯invokeAllæ–¹æ³•ã€‚</p><pre class=" language-java"><code class="language-java">left<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> right<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ›¿æ¢ä¸º</p><pre class=" language-java"><code class="language-java"><span class="token function">invokeAll</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://www.imooc.com/article/24822" target="_blank" rel="noopener">ã€Šå¹¶å‘ä¹‹Fork/Joinæ¡†æ¶ä½¿ç”¨åŠæ³¨æ„ç‚¹ã€‹</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</title>
      <link href="/posts/a53a9069.html"/>
      <url>/posts/a53a9069.html</url>
      
        <content type="html"><![CDATA[<h2 id="Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜"><a href="#Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜" class="headerlink" title="Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜"></a>Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</h2><p>æœ¬æ–‡ä¸»è¦é’ˆå¯¹æ–°æ‰‹å…¥é—¨çš„å¸¸è§é—®é¢˜è¿›è¡Œç®€å•æ•´ç†ã€‚å¤§éƒ¨é—¨é—®é¢˜éƒ½å¯ä»¥é˜…è¯»ä¸»é¢˜readmeè§£å†³ï¼Œå¦‚æœä½ çœ‹ä¸æ‡‚è‹±æ–‡,ç‚¹å‡»è¿™ä¸ªé“¾æ¥å°±å¯ä»¥åˆ‡æ¢ä¸­æ–‡é˜…è¯»:</p><p><a href="https://github.com/small-rose/hexo-theme-matery/blob/develop/README_CN.md" target="_blank" rel="noopener">Matery ä¸­æ–‡è¯´æ˜</a></p><p><strong>é‡åˆ°é—®é¢˜å…ˆçœ‹readme!!!</strong><br><strong>é‡åˆ°é—®é¢˜å…ˆçœ‹readme!!!</strong><br><strong>é‡åˆ°é—®é¢˜å…ˆçœ‹readme!!!</strong></p><p>çœ‹å³ä¾§ç›®å½•å¯ä»¥å¿«é€Ÿå®šä½ä½ çš„é—®é¢˜ã€‚</p><h3 id="æ”¹ä»£ç ä¸ç”Ÿæ•ˆ"><a href="#æ”¹ä»£ç ä¸ç”Ÿæ•ˆ" class="headerlink" title="æ”¹ä»£ç ä¸ç”Ÿæ•ˆ"></a>æ”¹ä»£ç ä¸ç”Ÿæ•ˆ</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong>ä»£ç éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä¿®æ”¹ä¹‹åä¸ç”Ÿæ•ˆæ€ä¹ˆåŠ?</p><p>ï¼ˆ1ï¼‰ä½¿ç”¨ Ctrl + F5 å¼ºåˆ¶åˆ·æ–°ä¹‹åå†çœ‹ã€‚</p><p>ï¼ˆ2ï¼‰è‡ªå·±æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œå„ä¸ªæµè§ˆå™¨å¯èƒ½ä¸ä¸€æ ·ï¼Œè¯·è‡ªå·±æœç´¢æ€ä¹ˆæ¸…é™¤ç¼“å­˜ã€‚</p><p>ï¼ˆ3ï¼‰å¦‚æœä½ ä½¿ç”¨äº†CDNåŠ é€Ÿï¼Œæœ¬åœ°è°ƒè¯•åƒä¸‡è®°å¾—å…ˆå…³é—­åŠ é€Ÿã€‚</p><p>ï¼ˆ4ï¼‰å¦‚æœä½ ä¿®æ”¹ <code>_config.yml</code>ï¼Œè°ƒè¯•å‰è¦æ‰§è¡Œ <code>hexo clean</code> å‘½ä»¤ã€‚</p><h3 id="favicon-ico-æ›´æ¢ä¹‹åä¸æ˜¾ç¤º"><a href="#favicon-ico-æ›´æ¢ä¹‹åä¸æ˜¾ç¤º" class="headerlink" title="favicon.ico æ›´æ¢ä¹‹åä¸æ˜¾ç¤º"></a>favicon.ico æ›´æ¢ä¹‹åä¸æ˜¾ç¤º</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong> favicon.ico å·²ç»æ›´æ¢æˆè‡ªå·±çš„å›¾æ ‡ä¹‹åä¸ç”Ÿæ•ˆæ€ä¹ˆåŠ?</p><p>ï¼ˆ1ï¼‰ç¡®ä¿ <code>favicon.ico</code>è·¯å¾„æ²¡æœ‰é—®é¢˜ã€‚</p><p>ï¼ˆ2ï¼‰æœ‰äº›æµè§ˆå™¨ä¸æ”¯æŒ<code>localhost</code>æ˜¾ç¤º<code>favicon.ico</code>å›¾æ ‡,æ›´æ¢æµè§ˆå™¨è¯•è¯•ã€‚</p><p>ï¼ˆ3ï¼‰æ›´æ¢æµè§ˆå™¨è¿˜æ˜¯ä¸èƒ½æ˜¾ç¤ºï¼Œå°†è®¿é—®è·¯å¾„<code>http://localhost:4000</code>æ”¹ä¸º<code>http://127.0.0.1:4000</code>è®¿é—®ã€‚</p><h3 id="å¤åˆ¶ä»£ç ç²˜è´´ä¸èƒ½æ¢è¡Œ"><a href="#å¤åˆ¶ä»£ç ç²˜è´´ä¸èƒ½æ¢è¡Œ" class="headerlink" title="å¤åˆ¶ä»£ç ç²˜è´´ä¸èƒ½æ¢è¡Œ"></a>å¤åˆ¶ä»£ç ç²˜è´´ä¸èƒ½æ¢è¡Œ</h3><p>ä¿®æ”¹ <code>themes\matery\layout\_partial\post-detail.ejs</code></p><p>å°†</p><pre class=" language-html"><code class="language-html">if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {    newdiv.innerHTML = "<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">></span></span>" + newdiv.innerHTML + "<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span>";}</code></pre><p>ä¿®æ”¹æˆ</p><pre class=" language-html"><code class="language-html">// if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {//     newdiv.innerHTML = "<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">></span></span>" + newdiv.innerHTML + "<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span>";// }//æ³¨é‡Šæ‰ä¸Šé¢çš„ifï¼Œå°†ifä¸­çš„å†…å®¹é‡Šæ”¾å‡ºæ¥newdiv.innerHTML = "<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">></span></span>" + newdiv.innerHTML + "<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span>";</code></pre><h3 id="æ–‡ç« å¤šä¸ªæ ‡ç­¾"><a href="#æ–‡ç« å¤šä¸ªæ ‡ç­¾" class="headerlink" title="æ–‡ç« å¤šä¸ªæ ‡ç­¾"></a>æ–‡ç« å¤šä¸ªæ ‡ç­¾</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong>æ–‡ç« æ ‡ç­¾æˆ–åˆ†ç±»æƒ³æ·»åŠ å¤šä¸ªï¼Œä¸çŸ¥é“æ€ä¹ˆå†™ï¼Ÿ</p><p>å†™æ³•ä¸€ï¼š</p><pre class=" language-txt"><code class="language-txt">tags:   - Hexo  - Github  - åšå®¢</code></pre><p>å†™æ³•äºŒï¼š</p><pre><code>tags: [Hexo,Github,åšå®¢]</code></pre><p>åˆ†ç±»å†™æ³•åŒç†ã€‚</p><h3 id="æç¤º-prism-plugin-é…ç½®é”™è¯¯ã€‚"><a href="#æç¤º-prism-plugin-é…ç½®é”™è¯¯ã€‚" class="headerlink" title="æç¤º prism-plugin é…ç½®é”™è¯¯ã€‚"></a>æç¤º <code>prism-plugin</code> é…ç½®é”™è¯¯ã€‚</h3><p>é—®é¢˜æè¿°ï¼š é«˜äº Hexo 4.2 çš„ç‰ˆæœ¬ ï¼ˆ ä¸ä¸€å®šå‡†å¤‡ï¼Œå› ä¸ºæˆ‘çš„4.2 ç‰ˆæœ¬æ²¡æœ‰é—®é¢˜ï¼‰ï¼Œ ç›®å‰åœ¨æ‰§è¡Œ <code>hexo clean</code> æ—¶æç¤º <code>prism-plugin</code> é…ç½®é”™è¯¯ã€‚</p><p>æ–¹æ¡ˆ1ï¼šä½ å¯ä»¥å¿½ç•¥è¿™ä¸ªé”™è¯¯ï¼Œå› ä¸ºè¿™å¯¹å®é™…å±•ç¤ºä¸é€ æˆå½±å“ã€‚ åŸå› æ²¡æœ‰å»ç»†ç©¶ã€‚</p><p>æ–¹æ¡ˆ2ï¼šä½ æ— æ³•å¿å—æŠ¥é”™æç¤ºï¼Œå¯ä»¥å¸è½½é«˜äº®æ’ä»¶ä½¿ç”¨ æ–°ç‰ˆHexo è‡ªå¸¦çš„é«˜äº®ã€‚</p><p>æ‰§è¡Œå¸è½½é«˜äº®æ’ä»¶ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> uninstall -S hexo-prism-plugin</code></pre><p>å¤§å†™sæ˜¯åœ¨æœ¬åœ°å®‰è£…ï¼Œä¹Ÿå°±æ˜¯åªåœ¨ä½ çš„åšå®¢æ–‡ä»¶æ‰€åœ¨ç›®å½•çš„æœ¬åœ°è¿›è¡Œå®‰è£…ã€‚å¸è½½ä¹Ÿæ˜¯åœ¨æœ¬åœ°å¸è½½ã€‚</p><p>å¸è½½åä½¿ç”¨hexo è‡ªå¸¦çš„é«˜äº®æ’ä»¶ã€‚<a href="https://hexo.io/docs/syntax-highlight" target="_blank" rel="noopener">è‡ªå¸¦çš„é«˜äº®æ’ä»¶ç”¨æ³•</a></p><p><font coloer="red"><strong>æ³¨æ„ï¼š</strong> </font>è¯¥é—®é¢˜æ˜¯ç¾¤å‹é‡åˆ°äº†ï¼Œè®¨è®ºå°è¯•çš„è§£å†³æ–¹æ³•ã€‚å¯ä»¥è‡ªè¡Œå°è¯•ã€‚</p><h3 id="ä»£ç å—æ˜¾ç¤ºé—®é¢˜"><a href="#ä»£ç å—æ˜¾ç¤ºé—®é¢˜" class="headerlink" title="ä»£ç å—æ˜¾ç¤ºé—®é¢˜"></a>ä»£ç å—æ˜¾ç¤ºé—®é¢˜</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong> ä»£ç å—ä¸­çš„ <code>{  }</code> è¢«è½¬ä¹‰<br><strong>é—®é¢˜æè¿°ï¼š</strong> ä»£ç å—çš„è¡Œå·å’Œå†…å®¹åˆ†å¼€æˆä¸¤å—äº†ï¼Œä¸å®Œæ•´æ€ä¹ˆåŠï¼Ÿå°±åƒä¸‹å›¾è¿™æ ·ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/hexo/hexo-error.png" alt="ä»£ç å—æ˜¾ç¤ºä¸æ­£å¸¸ç¤ºä¾‹å›¾"></p><p>æ€ä¹ˆè§£å†³ï¼ŸæŒ‰æ­¥éª¤æ¥ï¼š</p><p>ï¼ˆ1ï¼‰ä»£ç é«˜äº®æ’ä»¶</p><p>å®‰è£…å®˜æ–¹æ¨èçš„<code>hexo-prism-plugin</code>çš„ Hexo ä»£ç é«˜äº®æ’ä»¶</p><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> i -S hexo-prism-plugin</code></pre><p>ï¼ˆ2ï¼‰ä¿®æ”¹é…ç½®</p><p>ä¿®æ”¹ Hexo æ ¹ç›®å½•ä¸‹ <code>_config.yml</code> æ–‡ä»¶ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">highlight</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">line_number</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">auto_detect</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">tab_replace</span><span class="token punctuation">:</span> <span class="token string">''</span>  <span class="token key atrule">wrap</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">hljs</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token comment" spellcheck="true"># å…³é—­åŸæœ‰ çš„ä»£ç é«˜äº®ï¼Œä½¿ç”¨è‡ªå·±çš„</span><span class="token key atrule">prism_plugin</span><span class="token punctuation">:</span>  <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">'preprocess'</span>    <span class="token comment" spellcheck="true"># realtime/preprocess</span>  <span class="token key atrule">theme</span><span class="token punctuation">:</span> <span class="token string">'tomorrow'</span>  <span class="token key atrule">line_number</span><span class="token punctuation">:</span> <span class="token boolean important">false    </span><span class="token comment" spellcheck="true"># default false</span>  <span class="token key atrule">custom_css</span><span class="token punctuation">:</span></code></pre><p>å¯ä»¥è‡ªå·±æ¯”è¾ƒä¸€ä¸‹ï¼Œ<code>highlight</code>ä¸‹çš„ <code>enable</code>çš„å€¼è®¾ç½®æˆ <code>false</code> ï¼›<code>prism_plugin</code> å„ä¸ªå€¼å¯ä»¥é€‰ï¼Œå¦‚æœçœ‹ä¸æ‡‚æ„æ€å°±ä¸æ”¹ï¼Œæˆ–è€…æ”¹ä¸€ä¸ªè¯•è¯•æ•ˆæœï¼Œ<code>theme</code> çš„å€¼å®˜æ–¹æ¨èæ˜¯ <code>tomorrow</code>ï¼Œå¦‚æœä½ æ— æ³•æ˜¾ç¤ºï¼Œå°±åœ¨ä¸‹é¢çš„åˆ—è¡¨é‡Œæ¢ä¸ªå€¼è¯•è¯•ã€‚</p><table><thead><tr><th>å‚æ•°KEY</th><th>å¯é€‰å€¼</th></tr></thead><tbody><tr><td>mode</td><td>realtime (Parse code on browser in real time) <br/>preprocess (Preprocess code in node)</td></tr><tr><td>theme</td><td>default<br/> coy<br/> dark<br/> funky <br/> okaidia <br/> solarizedlight <br/> tomorrow <br/> twilight <br/> å¦‚æœè¦æ›´å¤šçš„é€‰æ‹©è®¿é—®ï¼š <a href="https://github.com/ele828/hexo-prism-plugin" target="_blank" rel="noopener">hexo-prism-plugin</a></td></tr><tr><td>line_number</td><td>true (Show line numbers) <br/> false (Default, Hide line numbers)</td></tr><tr><td>no_assets</td><td>true (Stop loading asset files)<br/> false (Default, load script and stylesheets files)<br/></td></tr></tbody></table><p>åˆ°æ­¤åŸºæœ¬èƒ½è§£å†³ã€‚å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œåˆ°ç¾¤é‡Œå’¨è¯¢<code>971887688</code> ï¼Œæè¿°æˆ–è€…æˆªå›¾ä½ çš„é—®é¢˜ï¼Œç„¶åç»™å‡ºç›¸å…³é…ç½®ä»£ç ã€‚</p><p>2020å¹´8æœˆ14æ—¥è¿½åŠ ï¼š</p><p>å¯¹äº ä»£ç å—ä¸­çš„ <code>{  }</code> è¢«è½¬ä¹‰çš„é—®é¢˜ï¼Œæœ‰äº›äººæ˜¯å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è§£å†³çš„ï¼Œå¦‚æœæ— æ³•è§£å†³å¯ä»¥å°è¯•ä½¿ç”¨ <a href="https://hexo.io/docs/syntax-highlight" target="_blank" rel="noopener">è‡ªå¸¦çš„é«˜äº®æ’ä»¶</a>ï¼Œæˆ–è€…å°† Hexo é™çº§åˆ°4.2ç‰ˆæœ¬ã€‚</p><p>2020å¹´9æœˆ18æ—¥è¿½åŠ ï¼š</p><p>å¯¹äº ä»£ç å—ä¸­çš„ <code>{  }</code> è¢«è½¬ä¹‰çš„é—®é¢˜ï¼Œæœ‰çš„å°ä¼™ä¼´è¯´å¯ä»¥å‡çº§åˆ°hexo5.2 ä¹Ÿå¯ä»¥è§£å†³ã€‚</p><h3 id="é¦–é¡µæ²¡æœ‰è½®æ’­"><a href="#é¦–é¡µæ²¡æœ‰è½®æ’­" class="headerlink" title="é¦–é¡µæ²¡æœ‰è½®æ’­"></a>é¦–é¡µæ²¡æœ‰è½®æ’­</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong>ä¸ºä»€ä¹ˆåˆ«äººé¦–é¡µå¯ä»¥è½®æ’­ï¼Œæœ‰ä¸¤ä¸ªå°ç®­å¤´ï¼Œä½ çš„åªæœ‰ä¸€å¼ å›¾ç‰‡æ²¡æœ‰è½®æ’­ä¹Ÿæ²¡æœ‰ç®­å¤´ï¼Ÿ</p><p>å› ä¸ºä½ æ²¡æœ‰åœ¨æ–‡ç« å¤´éƒ¨è®¾ç½®<code>cover</code>å±æ€§ã€‚</p><p><code>cover</code> è®¾ç½®æˆ <code>true</code> ,è¡¨ç¤ºè¯¥æ–‡ç« éœ€è¦åŠ å…¥åˆ°é¦–é¡µè½®æ’­å°é¢ä¸­ã€‚</p><p><code>coverImg</code>,è¡¨ç¤ºè¯¥æ–‡ç« åœ¨é¦–é¡µè½®æ’­å°é¢éœ€è¦æ˜¾ç¤ºçš„å›¾ç‰‡è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤ä½¿ç”¨æ–‡ç« çš„ç‰¹è‰²å›¾ç‰‡ã€‚<code>coverImg</code>å°±æ˜¯ç”¨æ¥è®¾ç½®è½®æ’­æ—¶çš„å›¾ç‰‡çš„ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥ä¸è®¾ç½®ï¼Œå°±ç”¨é»˜è®¤çš„ã€‚</p><p>æ¯”å¦‚æˆ‘è¿™ç¯‡æ–‡å­—çš„å¤´éƒ¨è®¾ç½®ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜<span class="token key atrule">tags</span><span class="token punctuation">:</span> Hexo<span class="token key atrule">categories</span><span class="token punctuation">:</span> Hexo<span class="token key atrule">summary</span><span class="token punctuation">:</span> Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜ã€‚<span class="token key atrule">excerpt</span><span class="token punctuation">:</span> Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜<span class="token key atrule">keywords</span><span class="token punctuation">:</span> <span class="token string">'hexo,matery,valine'</span><span class="token key atrule">author</span><span class="token punctuation">:</span> Small<span class="token punctuation">-</span>Rose /å¼ å°èœ<span class="token key atrule">abbrlink</span><span class="token punctuation">:</span> a53a9069<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2020-06-30 22:00:00</span><span class="token key atrule">cover</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">coverImg</span><span class="token punctuation">:</span> /images/hexo/cover_1.jpg<span class="token punctuation">---</span></code></pre><p>è®¾ç½®å®Œæˆä¹‹åï¼Œè®°å¾—æŠŠå›¾ç‰‡æ”¾åˆ°ä¸»é¢˜ä¸‹çš„ <code>source/images</code> ç›®å½•,ç„¶å <code>hexo  clean &amp; hexo g hexo s</code></p><h3 id="ä¿®æ”¹ä¸»é¢˜é¢œè‰²"><a href="#ä¿®æ”¹ä¸»é¢˜é¢œè‰²" class="headerlink" title="ä¿®æ”¹ä¸»é¢˜é¢œè‰²"></a>ä¿®æ”¹ä¸»é¢˜é¢œè‰²</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong>ä¸å–œæ¬¢é»˜è®¤çš„é¢œè‰²ï¼Œæƒ³æ¢æˆè‡ªå·±æ€ä¹ˆæ”¹ï¼Ÿ</p><p>åœ¨ä¸»é¢˜æ–‡ä»¶çš„ <code>/source/css/matery.css</code>æ–‡ä»¶ä¸­ï¼Œæœç´¢ <code>.bg-color</code>æ¥ä¿®æ”¹èƒŒæ™¯é¢œè‰²ï¼š</p><pre class=" language-css"><code class="language-css"><span class="token comment" spellcheck="true">/* æ•´ä½“èƒŒæ™¯é¢œè‰²ï¼ŒåŒ…æ‹¬å¯¼èˆªã€ç§»åŠ¨ç«¯çš„å¯¼èˆªã€é¡µå°¾ã€æ ‡ç­¾é¡µç­‰çš„èƒŒæ™¯é¢œè‰². */</span><span class="token selector"><span class="token class">.bg-color</span> </span><span class="token punctuation">{</span>    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to right, <span class="token hexcode">#4cbf30</span> <span class="token number">0%</span>, <span class="token hexcode">#0f9d58</span> <span class="token number">100%</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="å…³é—­é¦–é¡µé¢œè‰²å˜æ¢"><a href="#å…³é—­é¦–é¡µé¢œè‰²å˜æ¢" class="headerlink" title="å…³é—­é¦–é¡µé¢œè‰²å˜æ¢"></a>å…³é—­é¦–é¡µé¢œè‰²å˜æ¢</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong>ä¸å–œæ¬¢é¦–é¡µçš„é¢œè‰²å˜æ¢ï¼Œæ€ä¹ˆå…³é—­ï¼Ÿ</p><p>åœ¨ä¸»é¢˜æ–‡ä»¶çš„ <code>/source/css/matery.css</code>æ–‡ä»¶ä¸­ï¼Œæœç´¢ <code>rainbow</code>æ¥å…³é—­é¢œè‰²å˜æ¢ï¼š</p><pre class=" language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@-webkit-keyframes</span> rainbow</span> <span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">/* åŠ¨æ€åˆ‡æ¢èƒŒæ™¯é¢œè‰².å³æ»¤é•œé¢œè‰²ï¼Œä¸æƒ³è¦å¯ä»¥å…¨éƒ¨æ³¨é‡Šï¼Œæˆ–è€…æ¢æˆä½ å–œæ¬¢çš„é¢œè‰² */</span><span class="token punctuation">}</span><span class="token atrule"><span class="token rule">@keyframes</span> rainbow</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/* åŠ¨æ€åˆ‡æ¢èƒŒæ™¯é¢œè‰².ï¼Œä¸æƒ³è¦å¯ä»¥å…¨éƒ¨æ³¨é‡Šï¼Œæˆ–è€…æ¢æˆä½ å–œæ¬¢çš„é¢œè‰² */</span><span class="token punctuation">}</span></code></pre><h3 id="é¦–é¡µbanerå›¾ä¸æ˜¾ç¤ºæˆ–ä¸åˆ‡æ¢"><a href="#é¦–é¡µbanerå›¾ä¸æ˜¾ç¤ºæˆ–ä¸åˆ‡æ¢" class="headerlink" title="é¦–é¡µbanerå›¾ä¸æ˜¾ç¤ºæˆ–ä¸åˆ‡æ¢"></a>é¦–é¡µbanerå›¾ä¸æ˜¾ç¤ºæˆ–ä¸åˆ‡æ¢</h3><p>ä¹‹å‰çš„ç‰ˆæœ¬æœ‰<code>BUG</code>ï¼Œä¸è¿‡ä½œè€…å·²ç»ä¿®å¤ï¼Œå¦‚æœä½ æ²¡æœ‰åŒæ­¥ä»£ç ï¼Œå°±æ‰¾åˆ°ä¸»é¢˜ä¸‹çš„<code>/layout/_partial/</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>bg-cover-content.ejs</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°æ–‡ä»¶æœ«å°¾ï¼Œè·Ÿä¸‹é¢çš„ç‰‡æ®µç‰‡æ®µæ¯”è¾ƒä¸€ä¸‹ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">if</span> <span class="token attr-name">(theme.banner.enable)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token comment" spellcheck="true">//) æ¯å¤©åˆ‡æ¢ banner å›¾.  Switch banner image every day.</span>    <span class="token keyword">var</span> bannerUrl <span class="token operator">=</span> <span class="token string">"&lt;%- theme.jsDelivr.url %>&lt;%- url_for('/medias/banner/') %>"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">;</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.bg-cover'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'background-image'</span><span class="token punctuation">,</span> <span class="token string">'url('</span> <span class="token operator">+</span> bannerUrl <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">else</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.bg-cover'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'background-image'</span><span class="token punctuation">,</span> <span class="token string">'url(&lt;%- theme.jsDelivr.url %>&lt;%- url_for('</span><span class="token operator">/</span>medias<span class="token operator">/</span>banner<span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">.</span>jpg<span class="token string">') %>)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span></code></pre><h3 id="ç»™å¡ç‰‡åŒºæ·»åŠ èƒŒæ™¯"><a href="#ç»™å¡ç‰‡åŒºæ·»åŠ èƒŒæ™¯" class="headerlink" title="ç»™å¡ç‰‡åŒºæ·»åŠ èƒŒæ™¯"></a>ç»™å¡ç‰‡åŒºæ·»åŠ èƒŒæ™¯</h3><p>åœ¨ä¸»é¢˜æ–‡ä»¶çš„ <code>/source/css/matery.css</code>æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸ª <code>body</code> é€‰æ‹©å™¨ï¼ŒåŠ äº†ä¸­é—´ä¸¤è¡Œä¹‹åé•¿è¿™æ ·ï¼š</p><pre class=" language-css"><code class="language-css"><span class="token selector">body </span><span class="token punctuation">{</span> <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#eaeaea</span><span class="token punctuation">;</span>  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span><span class="token number">60</span>deg, <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">224</span>,<span class="token number">255</span>,<span class="token number">125</span>, <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token number">5%</span>, <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">228</span>, <span class="token number">255</span>, <span class="token number">0.35</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">0%</span> <span class="token number">0%</span> / coverï¼›<span class="token property">background-attachment</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#34495e</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ä¹Ÿå¯ä»¥åŠ  <code>url</code> ç”¨å›¾ç‰‡åšèƒŒæ™¯ï¼š</p><pre class=" language-css"><code class="language-css"><span class="token selector">body </span><span class="token punctuation">{</span> <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token hexcode">#eaeaea</span><span class="token punctuation">;</span>  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url">url('ä½ çš„å›¾ç‰‡åœ°å€')</span>ï¼›  <span class="token property">background-attachment</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#34495e</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="æ·»åŠ åŠ è½½åŠ¨ç”»"><a href="#æ·»åŠ åŠ è½½åŠ¨ç”»" class="headerlink" title="æ·»åŠ åŠ è½½åŠ¨ç”»"></a>æ·»åŠ åŠ è½½åŠ¨ç”»</h3><p>å‚è€ƒï¼š<a href="7496029d.html">Matery æ·»åŠ åŠ è½½åŠ¨ç”»</a></p><h3 id="ä¸æƒ³æ˜¾ç¤ºè‹±æ–‡æ€ä¹ˆåŠ"><a href="#ä¸æƒ³æ˜¾ç¤ºè‹±æ–‡æ€ä¹ˆåŠ" class="headerlink" title="ä¸æƒ³æ˜¾ç¤ºè‹±æ–‡æ€ä¹ˆåŠ"></a>ä¸æƒ³æ˜¾ç¤ºè‹±æ–‡æ€ä¹ˆåŠ</h3><p>(1) æŠŠ Hexo æ ¹ç›®å½•çš„ <code>_config.yml</code> æ–‡ä»¶è¯­è¨€ <code>language</code> è®¾ç½®æˆ <code>zh-CN</code></p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">author</span><span class="token punctuation">:</span> <span class="token string">'Small Rose /) å¼ å°èœè‹”'</span><span class="token key atrule">language</span><span class="token punctuation">:</span> zh<span class="token punctuation">-</span>CN<span class="token key atrule">timezone</span><span class="token punctuation">:</span> <span class="token string">'Asia/Shanghai'</span></code></pre><p>(2)è®¾ç½®äº†ä¸èµ·ä½œç”¨ï¼Ÿ </p><p>æ‰¾åˆ° <code>themes/matery/languages/</code>ç›®å½•ä¸‹çš„ <code>zh-CN.yml</code> æ–‡ä»¶ï¼Œé‡Œé¢çš„ä¸­è‹±æ–‡æ˜¯å¦å¯¹å¥½äº†ã€‚æˆ‘è®°å¾—æœ‰äº›è¿˜æ˜¯è‹±æ–‡éœ€è¦è‡ªå·±è‡ªå·±æ”¹ä¸‹ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">index</span><span class="token punctuation">:</span> é¦–é¡µ<span class="token key atrule">posts</span><span class="token punctuation">:</span> æ–‡ç« <span class="token key atrule">category</span><span class="token punctuation">:</span> åˆ†ç±»<span class="token key atrule">categories</span><span class="token punctuation">:</span> åˆ†ç±»<span class="token key atrule">tag</span><span class="token punctuation">:</span> æ ‡ç­¾<span class="token key atrule">tags</span><span class="token punctuation">:</span> æ ‡ç­¾<span class="token key atrule">archives</span><span class="token punctuation">:</span> å½’æ¡£<span class="token key atrule">about</span><span class="token punctuation">:</span> å…³äº<span class="token key atrule">contact</span><span class="token punctuation">:</span> ç•™è¨€<span class="token key atrule">friends</span><span class="token punctuation">:</span> å‹æƒ…é“¾æ¥<span class="token key atrule">navigate</span><span class="token punctuation">:</span> å¯¼èˆª<span class="token key atrule">startRead</span><span class="token punctuation">:</span> å¼€å§‹é˜…è¯»<span class="token key atrule">recommendedPosts</span><span class="token punctuation">:</span> æ¨èæ–‡ç« <span class="token key atrule">publishDate</span><span class="token punctuation">:</span> å‘å¸ƒæ—¥æœŸ<span class="token key atrule">updateDate</span><span class="token punctuation">:</span> æ›´æ–°æ—¥æœŸ<span class="token key atrule">readCount</span><span class="token punctuation">:</span> é˜…è¯»æ¬¡æ•°<span class="token key atrule">wordCount</span><span class="token punctuation">:</span> æ–‡ç« å­—æ•°<span class="token key atrule">readTimes</span><span class="token punctuation">:</span> é˜…è¯»æ—¶é•¿<span class="token key atrule">Minutes</span><span class="token punctuation">:</span> åˆ†<span class="token key atrule">readMore</span><span class="token punctuation">:</span> é˜…è¯»æ›´å¤š<span class="token key atrule">toc</span><span class="token punctuation">:</span> ç›®å½•<span class="token key atrule">curr</span><span class="token punctuation">:</span> æœ¬ç¯‡<span class="token key atrule">prev</span><span class="token punctuation">:</span> ä¸Šä¸€ç¯‡<span class="token key atrule">next</span><span class="token punctuation">:</span> ä¸‹ä¸€ç¯‡<span class="token key atrule">search</span><span class="token punctuation">:</span> æœç´¢<span class="token key atrule">searchTip</span><span class="token punctuation">:</span> è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—<span class="token key atrule">postTagTitle</span><span class="token punctuation">:</span> æ–‡ç« æ ‡ç­¾<span class="token key atrule">postCategoryTitle</span><span class="token punctuation">:</span> æ–‡ç« åˆ†ç±»<span class="token key atrule">categoryRadarTitle</span><span class="token punctuation">:</span> æ–‡ç« åˆ†ç±»é›·è¾¾å›¾<span class="token key atrule">categoryNumber</span><span class="token punctuation">:</span> æ–‡ç« åˆ†ç±»æ•°é‡<span class="token key atrule">categoryEmptyTip</span><span class="token punctuation">:</span> ä½ ç›®å‰è¿˜æ²¡æœ‰å¯¹æ–‡ç« è¿›è¡Œåˆ†ç±».<span class="token key atrule">postCharts</span><span class="token punctuation">:</span> æ–‡ç« ç»Ÿè®¡å›¾<span class="token key atrule">postPublishChart</span><span class="token punctuation">:</span> æ–‡ç« å‘å¸ƒç»Ÿè®¡å›¾<span class="token key atrule">categoriesChart</span><span class="token punctuation">:</span> æ–‡ç« åˆ†ç±»ç»Ÿè®¡å›¾<span class="token key atrule">top10TagsChart</span><span class="token punctuation">:</span> TOP10 æ ‡ç­¾ç»Ÿè®¡å›¾<span class="token key atrule">postsNumberName</span><span class="token punctuation">:</span> æ–‡ç« ç¯‡æ•°<span class="token key atrule">maximum</span><span class="token punctuation">:</span> æœ€å¤§å€¼<span class="token key atrule">minimum</span><span class="token punctuation">:</span> æœ€å°å€¼<span class="token key atrule">average</span><span class="token punctuation">:</span> å¹³å‡å€¼<span class="token key atrule">myProjects</span><span class="token punctuation">:</span> æˆ‘çš„é¡¹ç›®<span class="token key atrule">mySkills</span><span class="token punctuation">:</span> æˆ‘çš„æŠ€èƒ½<span class="token key atrule">otherSkills</span><span class="token punctuation">:</span> å…¶ä»–æŠ€èƒ½<span class="token key atrule">gallery</span><span class="token punctuation">:</span> ç›¸å†Œ<span class="token key atrule">notag</span><span class="token punctuation">:</span> æ— æ ‡ç­¾<span class="token key atrule">from</span><span class="token punctuation">:</span> æ¥æº<span class="token key atrule">reprint</span><span class="token punctuation">:</span> ç‰ˆæƒå£°æ˜<span class="token key atrule">author</span><span class="token punctuation">:</span> æ–‡ç« ä½œè€…<span class="token key atrule">link</span><span class="token punctuation">:</span> æ–‡ç« é“¾æ¥<span class="token key atrule">use</span><span class="token punctuation">:</span> æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<span class="token key atrule">licensed</span><span class="token punctuation">:</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº<span class="token key atrule">cc_by_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//creativecommons.org/licenses/by/4.0/deed.zh<span class="token key atrule">cc_by_name</span><span class="token punctuation">:</span> CC BY 4.0<span class="token key atrule">cc_by_nd_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//creativecommons.org/licenses/by<span class="token punctuation">-</span>nd/4.0/deed.zh<span class="token key atrule">cc_by_nd_name</span><span class="token punctuation">:</span> CC BY<span class="token punctuation">-</span>ND 4.0<span class="token key atrule">cc_by_sa_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//creativecommons.org/licenses/by<span class="token punctuation">-</span>sa/4.0/deed.zh<span class="token key atrule">cc_by_sa_name</span><span class="token punctuation">:</span> CC BY<span class="token punctuation">-</span>SA 4.0<span class="token key atrule">cc_by_nc_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//creativecommons.org/licenses/by<span class="token punctuation">-</span>nc/4.0/deed.zh<span class="token key atrule">cc_by_nc_name</span><span class="token punctuation">:</span> CC BY<span class="token punctuation">-</span>NC 4.0<span class="token key atrule">cc_by_nc_nd_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//creativecommons.org/licenses/by<span class="token punctuation">-</span>nc<span class="token punctuation">-</span>nd/4.0/deed.zh<span class="token key atrule">cc_by_nc_nd_name</span><span class="token punctuation">:</span> CC BY<span class="token punctuation">-</span>NC<span class="token punctuation">-</span>ND 4.0<span class="token key atrule">cc_by_nc_sa_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//creativecommons.org/licenses/by<span class="token punctuation">-</span>nc<span class="token punctuation">-</span>sa/4.0/deed.zh<span class="token key atrule">cc_by_nc_sa_name</span><span class="token punctuation">:</span> CC BY<span class="token punctuation">-</span>NC<span class="token punctuation">-</span>SA 4.0<span class="token key atrule">cc_0_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//creativecommons.org/publicdomain/zero/1.0/deed.zh<span class="token key atrule">toTheExtentPossibleUnderLaw</span><span class="token punctuation">:</span> åœ¨æ³•å¾‹å…è®¸çš„èŒƒå›´å†…ï¼Œ<span class="token key atrule">hasWaivedAllCopyrightAndRelatedOrNeighboringRightsTo</span><span class="token punctuation">:</span> å·²æ”¾å¼ƒæ­¤ä½œå“çš„æ‰€æœ‰ç‰ˆæƒã€ç›¸å…³æˆ–ç›¸é‚»çš„æƒåˆ©<span class="token key atrule">workPublishedFrom</span><span class="token punctuation">:</span> ã€‚æ­¤ä½œå“å‘å¸ƒåœ¨ï¼š<span class="token key atrule">cc_0_country</span><span class="token punctuation">:</span> ä¸­å›½å¤§é™†ã€‚<span class="token key atrule">cc_0_content</span><span class="token punctuation">:</span> CN<span class="token key atrule">noreprint</span><span class="token punctuation">:</span> æœ¬æ–‡ä¸å…è®¸è½¬è½½ã€‚<span class="token key atrule">paycontact</span><span class="token punctuation">:</span> è¯·è”ç³»ä½œè€…<span class="token key atrule">payreprint</span><span class="token punctuation">:</span> ä»˜è´¹è½¬è½½ã€‚<span class="token key atrule">pleaseFollowReprintPolicy</span><span class="token punctuation">:</span> å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™<span class="token key atrule">checkPolicy</span><span class="token punctuation">:</span> æŸ¥çœ‹</code></pre><h3 id="åœç®—å­æ˜¾ç¤ºæ•°å­—ç‰¹åˆ«å¤§"><a href="#åœç®—å­æ˜¾ç¤ºæ•°å­—ç‰¹åˆ«å¤§" class="headerlink" title="åœç®—å­æ˜¾ç¤ºæ•°å­—ç‰¹åˆ«å¤§"></a>åœç®—å­æ˜¾ç¤ºæ•°å­—ç‰¹åˆ«å¤§</h3><p>æœ¬åœ°å¯åŠ¨åï¼Œå‘ç° åœç®—å­æ˜¾ç¤ºæ•°å­—ç‰¹åˆ«å¤§ï¼Œä¸è¦æƒŠæ…Œï¼Œ<code>localhost</code> æ˜¯ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„åŸŸåï¼Œåªè¦çœŸæ­£éƒ¨ç½²ä¸Šå»ä¹‹åè‡ªç„¶å°±æ­£å¸¸äº†ã€‚</p><h3 id="æƒ³æ›´æ¢å›¾æ ‡æ€ä¹ˆåŠ"><a href="#æƒ³æ›´æ¢å›¾æ ‡æ€ä¹ˆåŠ" class="headerlink" title="æƒ³æ›´æ¢å›¾æ ‡æ€ä¹ˆåŠ"></a>æƒ³æ›´æ¢å›¾æ ‡æ€ä¹ˆåŠ</h3><p>Matery ä¸»é¢˜ä½¿ç”¨çš„æ˜¯ <code>font-awesome</code> çš„å›¾æ ‡åº“ Font Awesome Free 5.11.1ã€‚</p><p>å¦‚æœä½ æƒ³ç®€å•çš„æ›´æ¢å›¾ç‰‡ï¼Œæ‰¾åˆ°ä¸»é¢˜ç›®å½•ä¸‹ <code>/source/libs/awesome/css/</code> ç›®å½•çš„ <code>all.css</code> æ–‡ä»¶ã€‚ æ–‡ä»¶ä¸­ä» 192è¡Œåˆ°4373è¡Œéƒ½æ˜¯å›¾ç‰‡ç›¸å…³çš„ã€‚</p><p>ä½ åªéœ€è¦æŒ‰ç…§æ ¼å¼æŠŠ <code>fa-xxx</code>  æˆ– <code>fa-xxx-xxx</code> å†™åˆ°å¯¹åº”çš„ä½ç½®å°±å¯ä»¥æ›´æ¢å›¾æ ‡äº†ã€‚</p><p>å¦‚æœä½ æƒ³åœ¨æ–‡ç« ä¸­ä½¿ç”¨å›¾æ ‡ï¼Œå¯ä»¥å†™ä¸ªæ ‡ç­¾</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span>  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fas fa-home<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span></code></pre><p>æ•ˆæœå¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p><p><i  class="fas fa-home" ></i></p><p>å¯ä»¥å…ˆå» <a href="http://www.fontawesome.com.cn" target="_blank" rel="noopener">fontawesome å®˜ç½‘</a> æ‰¾ï¼Œæ‰¾å¥½ä¹‹å F12  ï¼Œæ‰¾åˆ°å…ƒç´ ä¹‹åçœ‹çœ‹<code>&lt;i&gt;</code>æ ‡ç­¾çš„ <code>class</code> çš„å€¼æ˜¯ <code>fa-xxx-xx</code> çš„è¯å†åˆ° all.css æ–‡ä»¶é‡Œæœä¸€ä¸‹ï¼Œä¸è¿‡è¿™ä¹Ÿæ— æ³•ä¿è¯å®Œå…¨ä¸€æ ·ï¼Œå› ä¸ºç‰ˆæœ¬ä¸ä¸€è‡´æœ‰çš„æ—¶å€™åå­—ä¸ä¸€å®šä¸€è‡´ã€‚ å¤šè¯•è¯•å§ã€‚</p><h3 id="æƒ³æ·»åŠ ç‰¹æ•ˆ"><a href="#æƒ³æ·»åŠ ç‰¹æ•ˆ" class="headerlink" title="æƒ³æ·»åŠ ç‰¹æ•ˆ"></a>æƒ³æ·»åŠ ç‰¹æ•ˆ</h3><p>æœ‰äº›åŒå­¦æ¯”è¾ƒå–œæ¬¢ç‰¹æ•ˆï¼Œå‚è€ƒå¤§ä½¬å†™çš„ä¿®æ”¹æ–¹æ³•ï¼š<br><a href="https://yafine-blog.cn/posts/12b4.html" target="_blank" rel="noopener">Matery ä¸»é¢˜ä¸ªæ€§åŒ–ä¿®æ”¹</a></p><h3 id="ä¿®æ”¹ä¸»é¢˜ç›¸å†Œ"><a href="#ä¿®æ”¹ä¸»é¢˜ç›¸å†Œ" class="headerlink" title="ä¿®æ”¹ä¸»é¢˜ç›¸å†Œ"></a>ä¿®æ”¹ä¸»é¢˜ç›¸å†Œ</h3><p>æœ‰äº›åŒå­¦æ¯”è¾ƒå–œæ¬¢ç‹¬ç«‹ç›¸å†Œï¼ŒMatery ç›¸å†Œåœ¨ä¸ªäººé‡Œé¢ã€‚å¦‚æœä½ æƒ³æ”¹æˆç‹¬ç«‹ç›¸å†Œï¼Œå‚è€ƒå¤§ä½¬å†™çš„ä¿®æ”¹æ–¹æ³•ï¼š<br><a href="https://yafine-blog.cn/posts/3b98.html" target="_blank" rel="noopener">ä¿®æ”¹ matery åŸæœ‰ä¸»é¢˜ç›¸å†Œ</a></p><h3 id="æƒ³æ·»åŠ å¯¼èˆªé¡µ"><a href="#æƒ³æ·»åŠ å¯¼èˆªé¡µ" class="headerlink" title="æƒ³æ·»åŠ å¯¼èˆªé¡µ"></a>æƒ³æ·»åŠ å¯¼èˆªé¡µ</h3><p>å‚è€ƒå¤§ä½¬çš„ï¼š<a href="https://yafine-blog.cn/posts/e925.html" target="_blank" rel="noopener">Hexoæ·»åŠ å¯¼èˆªé¡µ</a></p><h3 id="æƒ³æ›´æ¢å­—ä½“æ€ä¹ˆåŠ"><a href="#æƒ³æ›´æ¢å­—ä½“æ€ä¹ˆåŠ" class="headerlink" title="æƒ³æ›´æ¢å­—ä½“æ€ä¹ˆåŠ"></a>æƒ³æ›´æ¢å­—ä½“æ€ä¹ˆåŠ</h3><p>(1)  é€‰ä¸ªè‡ªå·±å–œæ¬¢çš„å­—ä½“ä¸‹è½½ï¼Œä¸€èˆ¬æ˜¯<code>.ttf</code>æ ¼å¼çš„ã€‚</p><p>å¸¸è§çš„å¼€æºå­—ä½“æœ‰ï¼š</p><p>æ€æºé»‘ä½“ ã€ æ–‡æ³‰é©¿ ã€ æ–‡é¼å¼€æ”¾å­—ä½“ ã€ æŸ³ä½“ ã€ cwTeXä¸­æ–‡å­—ä½“ ã€ æ¿‘æˆ·å­—ä½“ã€æ±Ÿè¥¿æ‹™æ¥·ä½“ç­‰ã€‚</p><p>å…è´¹å¯å•†ç”¨çš„ä¸­æ–‡å­—ä½“æ•´ç†ï¼š</p><p><strong>å…è´£å£°æ˜ï¼š</strong></p><p><font color="red">ä»¥ä¸‹è¡¨æ ¼å†…å®¹æ”¶é›†æ•´ç†æ¥è‡ªç½‘ç»œï¼Œ ä¸ä¿è¯å®æ—¶æ€§ï¼Œ ä½¿ç”¨æ—¶å»ºè®®æŸ¥æ¸…å­—ä½“ä½¿ç”¨ç›¸å…³æˆæƒè¯´æ˜ã€‚æœ¬ç«™å¯¹è¯»è€…ä½¿ç”¨ä¸ä½œä»»ä½•å»ºè®®ã€‚</font></p><table><thead><tr><th>å­—ä½“</th><th>æˆæƒæˆ–ä¸‹è½½</th></tr></thead><tbody><tr><td>æ€æºç³»åˆ—</td><td>æ€æºé»‘ä½“ã€æ€æºå®‹ä½“ã€‚<a href="https://www.google.com/get/noto/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ€æºç³»åˆ—</td><td>æ€æºæŸ”é»‘ä½“ã€‚<a href="http://jikasei.me/font/genjyuu/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ€æºç³»åˆ—</td><td>æ€æºçœŸé»‘ä½“ã€‚<a href="http://jikasei.me/font/genshin/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ˜æœç³»åˆ—</td><td>App Minchoæ˜æºã€‚<a href="www.flopdesign.com/blog/font/5852/">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ˜æœç³»åˆ—</td><td>èŠ±å›­å­—ä½“ã€‚<a href="http://fonts.jp/hanazono/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ˜æœç³»åˆ—</td><td>Oradano-Minchoæ˜æœã€‚<a href="http://www.asahi-net.or.jp/~sd5a-ucd/freefonts/Oradano-Mincho/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ˜æœç³»åˆ—</td><td>è£…ç”²æ˜æœã€‚<a href="www.flopdesign.com/blog/font/5228/">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ˜æœç³»åˆ—</td><td>æºç•Œæ˜æœã€‚<a href="www.flopdesign.com/blog/font/5146/">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ˜æœç³»åˆ—</td><td>æºæ˜æœã€‚<a href="www.flopdesign.com/blog/font/7163/">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ–¹æ­£ç³»åˆ—</td><td>æ–¹æ­£é»‘ä½“ã€æ–¹æ­£ä¹¦å®‹ã€æ–¹æ­£ä»¿å®‹ã€æ–¹æ­£æ¥·ä½“ã€‚<br><a href="http://www.foundertype.com/index.php/About/bookAuth/key/my_sysq.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ˜ä½“ç³»åˆ—</td><td>æºæ ·é»‘ä½“ã€æºæµæ˜ä½“ã€æºçŸ³é»‘ä½“ã€æºæ ·æ˜ä½“ã€æºäº‘æ˜ä½“ã€æºæ³‰åœ†ä½“ã€‚ <br><a href="https://github.com/ButTaiwan?tab=stars" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>M Plusã€‚<a href="http://mplus-fonts.osdn.jp/about.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>é”å­—çœŸè¨€ä½“ã€‚<a href="http://reeji.com/font/rui_zi_zhen_yan_ti/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>å¯ä»¥å•†ç”¨ï¼Œä½†ä¸èƒ½åœ¨éAppleç¡¬ä»¶ä¸Šä½¿ç”¨ï¼Œå¦åˆ™å°±æ˜¯ä¾µæƒã€‚<br>è‹¹æœå®˜æ–¹è¯´æ˜é“¾æ¥ <a href="https://discussions.apple.com/thread/7493969" target="_blank" rel="noopener">https://discussions.apple.com/thread/7493969</a></td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>è”ç›Ÿèµ·è‰ºå¢å¸…æ­£é”é»‘ä½“ã€‚<a href="https://www.zcool.com.cn/work/ZMzUxMzUzNzY=.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>Droid Sans Fallbackã€‚<a href="https://code.google.com/archive/p/droid-sans-mono-py/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>åºé—¨æ­£é“æ ‡é¢˜ä½“ã€‚<a href="https://mp.weixin.qq.com/s/BGXeAXrEo6CM5-gtdQOuYA" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>åºé—¨æ­£é“ç²—ä¹¦ä½“ã€‚<a href="https://mp.weixin.qq.com/s/LZ_PMNc-3uX-Atmri4OLGQ" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>é—®è—ä¹¦æˆ¿å“ç‰Œå­—ä½“ã€‚<a href="http://www.wencang.com/font.jsp" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>å»»æƒ³ä½“ã€‚<a href="https://moji-waku.com/kaiso/" target="_blank" rel="noopener">https://moji-waku.com/kaiso/</a>)</td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>é›»å­—éŠæˆ¯ã€‚<a href="https://moji-waku.com/denjiyugi/" target="_blank" rel="noopener">https://moji-waku.com/denjiyugi/</a>)</td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>Mogihaç”¨é’¢ç¬”å†™çš„å­—ä½“ã€‚<a href="http://ahito.com/item/desktop/font/mogihaPen/#kiyaku" target="_blank" rel="noopener">http://ahito.com/item/desktop/font/mogihaPen/#kiyaku</a></td></tr><tr><td>ä¸­æ–‡ç³»åˆ—</td><td>KHåƒç´ å­—ä½“ç³»åˆ—ã€‚<a href="http://jikasei.me/font/kh-dotfont/" target="_blank" rel="noopener">http://jikasei.me/font/kh-dotfont/</a>)</td></tr><tr><td>ç«™é…·ç³»åˆ—</td><td>ç«™é…·é…·é»‘ã€ç«™é…·å¿«ä¹ä½“ã€ç«™é…·é«˜ç«¯é»‘ã€åº†ç§‘é»„æ²¹ä½“ã€ç«™é…·å°è–‡LOGOä½“ã€ç«™é…·æ–‡è‰ºä½“ã€‚<a href="https://www.zcool.com.cn/special/zcoolfonts/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>TanukiMagic éº¥å…‹ç­†æ‰‹ç¹ª POPã€‚<a href="https://tanukifont.com/tanuki-permanent-marker" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>ãƒ©ãƒãƒ™POP ã€‚<a href="http://www.fontna.com/blog/1706/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>æ€–ã„æ˜æœä½“ã€‚<a href="http://www.fontna.com/blog/1371/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>æš—é»‘æå­—ä½“ã€‚<a href="www.ankokukoubou.com/font/ankokuzonji.htm">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>å¹»ãƒã«ã˜ã¿æ˜æœã€‚<a href="http://www.fontna.com/blog/1912/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>Rings Of Saturnã€‚<a href="https://flopdesign.booth.pm/items/605389" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>Smartfontã€‚<a href="https://flopdesign.com/freefont/smartfont.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>KanjyukuGothicã€‚<a href="www.flopdesign.com/freefont/kanjyukugothic-freefont.html">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>Shirokumaã€‚<a href="https://lazypolarbear.com/entry/font-shirokuma" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>è¶…æ¥µç´°ã‚´ã‚·ãƒƒã‚¯ä½“ã€‚<a href="https://font.websozai.jp/line-font-mihon.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>å¹³æˆæœ€å¾Œã€‚<a href="https://flopdesign.com/blog/photo/7499/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ãƒˆãƒ»ãƒ­ã‚´ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰ã€‚<a href="https://moji-waku.com/ronde/" target="_blank" rel="noopener">https://moji-waku.com/ronde/</a>)</td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>ãƒˆã‚¬ãƒªãƒ†ã€‚<a href="https://moji-waku.com/pigmo/" target="_blank" rel="noopener">https://moji-waku.com/pigmo/</a>)</td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>ãƒãƒ¡ãƒ­ãƒ³ã€‚<a href="https://moji-waku.com/mamelon/" target="_blank" rel="noopener">https://moji-waku.com/mamelon/</a>)</td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>ãƒã‚­ãƒŠã‚¹ 4 ã‚·ãƒªãƒ¼ã‚ºã€‚<a href="https://moji-waku.com/makinas/" target="_blank" rel="noopener">https://moji-waku.com/makinas/</a>)</td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>ãƒ”ã‚°ãƒ¢ã€‚<a href="https://moji-waku.com/pigmo01/" target="_blank" rel="noopener">https://moji-waku.com/pigmo01/</a>)</td></tr><tr><td>æ—¥å¼ç³»åˆ—</td><td>Karakazeã€‚<a href="https://enuoka.booth.pm/items/1219316" target="_blank" rel="noopener">https://enuoka.booth.pm/items/1219316</a></td></tr><tr><td>851ç³»åˆ—</td><td>851æ‰‹å†™æ‚ä½“ã€‚<a href="https://pm85122.onamae.jp/851fontpage.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>851ç³»åˆ—</td><td>851 mkpopã€‚<a href="https://pm85122.onamae.jp/851mkpop.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>851ç³»åˆ—</td><td>851 letrogopageã€‚<a href="https://pm85122.onamae.jp/851letrogopage.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>851ç³»åˆ—</td><td>851 ãƒ†ã‚¬ã‚­ã‚«ã‚¯ãƒƒãƒˆã€‚<a href="https://pm85122.onamae.jp/851H_kktt.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>851ç³»åˆ—</td><td>851 Chikuru Yokuã€‚<a href="https://pm85122.onamae.jp/851ch-dz.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>851ç³»åˆ—</td><td>851 ãƒã‚«ãƒ©ãƒ¨ãƒ¯ã‚¯ã€‚<a href="https://pm85122.onamae.jp/851ch-yw.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>851ç³»åˆ—</td><td>851 ã‚´ãƒã‚«ã‚¯ãƒƒãƒˆã€‚<a href="https://pm85122.onamae.jp/851Gkktt.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ‰‹å†™ç³»åˆ—</td><td>æ¿‘æˆ·å­—ä½“ã€‚<a href="https://www.justfont.com/fontdetail/147" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ‰‹å†™ç³»åˆ—</td><td>æ²ç‘¶è½¯ç¬”æ‰‹å†™ä½“ã€‚<a href="https://www.zcool.com.cn/work/ZMjg5MjAwMDQ=.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ‰‹å†™ç³»åˆ—</td><td>æ¨ä»»ä¸œç«¹çŸ³ä½“ã€‚<a href="https://mp.weixin.qq.com/s/7kv3i_YEs7x9_9IrCDYvBA" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ‰‹å†™ç³»åˆ—</td><td>åŒ…å›¾å°ç™½ä½“ã€‚<a href="https://act.ibaotu.com/activity/1.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ‰‹å†™ç³»åˆ—</td><td>æ‰‹å†™ä½“ã€‚<a href="www.zhihu.com/question/19889152/answer/245685101">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ‰‹å†™ç³»åˆ—</td><td>è´¤äºŒä½“ã€‚<a href="https://www.zcool.com.cn/article/ZNjk4NDM2.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ‰‹å†™ç³»åˆ—</td><td>æ¸…æ¾æ‰‹å¯«é«”ã€‚<a href="https://www.facebook.com/groups/549661292148791/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ‰‹å†™ç³»åˆ—</td><td>å°åŒ—é»‘ä½“ã€‚<a href="https://sites.google.com/view/jtfoundry/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>åˆ»çŸ³éŒ„ç³»åˆ—</td><td>åˆ»çŸ³éŒ„é¡é«”ã€åˆ»çŸ³éŒ„é‹¼ç­†é¶´é«”ã€åˆ»çŸ³éŒ„æ˜é«”<br/><a href="http://founder.acgvlyric.org/iu/doku.php/%E8%A8%98%E4%BA%8B:%E6%9C%AC%E9%8C%84%E6%96%87%E7%AB%A0%E7%B8%BD%E8%A6%BD" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å°æ¹¾æ•™è‚²éƒ¨ç³»åˆ—</td><td>å°æ¹¾æ•™è‚²éƒ¨æ ‡å‡†æ¥·ä¹¦<br/><a href="https://depart.moe.edu.tw/ED2400/News_Content.aspx?n=8940E5C0456177C3&sms=893AAA1CBFE149DE&s=DFBE7BE3EE0DB6AE" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å°æ¹¾æ•™è‚²éƒ¨ç³»åˆ—</td><td>å°æ¹¾æ•™è‚²éƒ¨æ ‡å‡†å®‹ä½“<br/><a href="https://depart.moe.edu.tw/ED2400/News_Content.aspx?n=8940E5C0456177C3&sms=893AAA1CBFE149DE&s=161DEBC9EACEA333" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å°æ¹¾æ•™è‚²éƒ¨ç³»åˆ—</td><td>å°æ¹¾æ•™è‚²éƒ¨å›½å­—éš¶ä¹¦<br/><a href="https://depart.moe.edu.tw/ED2400/News_Content.aspx?n=8940E5C0456177C3&sms=893AAA1CBFE149DE&s=AA29AF7FE3BAD13F" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å°æ¹¾æ•™è‚²éƒ¨ç³»åˆ—</td><td>å…¨å­—åº“æ­£å®‹é«”ã€å…¨å­—åº“æ­£æ¥·é«”<br/><a href="http://data.gov.tw/node/5961" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>ç‹æ±‰å®—ç³»åˆ—</td><td>å…è´¹å­—ä½“ï¼šç»†æ˜ã€è¶…æ˜ã€ç»†é»‘ã€ç‰¹é»‘ã€é¢œä½“ã€é…·ä¿ªæµ·æŠ¥ã€æ­£æµ·æŠ¥ã€é’¢ç¬”è¡Œæ¥·ã€è¶…é»‘ä¿çš®åŠ¨ç‰©ã€ä¸­æ˜æ³¨éŸ³ä½“ã€ä¸­æ˜ç ´éŸ³å­—ã€ä¸­æ¥·æ³¨éŸ³ä½“ã€ä¸­æ¥·ç ´éŸ³å­—ã€ä¸­é­ç¢‘ç®€ä½“ã€ç»†æ–°å®‹ç®€ä½“<br/><a href="https://zh.wikipedia.org/wiki/%E7%8E%8B%E6%BC%A2%E5%AE%97%E8%87%AA%E7%94%B1%E5%AD%97%E5%9E%8B" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ–‡æ³‰é©¿ç³»åˆ—</td><td>æ–‡æ³‰é©¿æ­£é»‘ä½“ã€æ–‡æ³‰é©¿å¾®ç±³é»‘ã€æ–‡æ³‰é©¿ç‚¹é˜µå®‹ä½“ï¼ˆæ­¤å®‹ä½“æ— Winç‰ˆæœ¬â€¦ï¼‰<br/><a href="https://wenq.org/wqy2/index.cgi?FontGuide" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>é˜¿é‡Œç³»åˆ—</td><td>é˜¿é‡Œå·´å·´æ™®æƒ ä½“ã€‚<a href="https://ics.alibaba.com/project/Hn8mXx" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>é˜¿é‡Œç³»åˆ—</td><td>é˜¿é‡Œæ±‰ä»ªæ™ºèƒ½é»‘ä½“ï¼ˆä»…é˜¿é‡Œå¹³å°å…è´¹å•†ç”¨ï¼‰ã€‚<a href="https://mp.weixin.qq.com/s/Y_c_0COqWnUo90G3QJ2ojA" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>45æ¬¾ååº·å­—ä½“</td><td>ï¼ˆä»…é˜¿é‡Œå¹³å°å…è´¹å•†ç”¨ï¼‰ååº·å¸ƒä¸ä½“ã€ååº·å½©å¸¦ä½“ ã€ååº·å„¿é£ä½“ã€ååº·æ–¹åœ†ä½“ã€ååº·é’¢ç¬”ä½“ã€ååº·æµ·æŠ¥ä½“ã€ååº·æ‰‹æœ­ä½“ã€ååº·æ‰‹æœ­ä½“ã€ååº·ç¿©ç¿©ä½“ã€ååº·é»‘ä½“ ã€ååº·é‡‘æ–‡ä½“ã€ååº·æ¥·ä½“ã€ååº·å‹˜äº­æµã€ååº·ä¿ªé‡‘é»‘ã€ååº·éš¶ä¹¦ä½“ã€ååº·é¾™é—¨çŸ³ç¢‘ã€ååº·å¢¨å­—ä½“ã€ååº·POP1ä½“ã€ååº·POP2ä½“ã€ååº·POP3ä½“ã€ååº·å°‘å¥³æ–‡å­—ã€ååº·é¥°è‰ºä½“ã€ååº·ç˜¦é‡‘ä½“ã€ååº·æ ‡é¢˜å®‹ã€ååº·å®‹ä½“ã€ååº·å”é£éš¶ã€ååº·å¨ƒå¨ƒä½“ã€ååº·é­ç¢‘ã€ååº·æ­£é¢œæ¥·ä½“ã€ååº·é›…å®‹ä½“ã€ååº·é›…è‰ºä½“ã€ååº·åœ†ä½“ã€ååº·æ–°ç»¼è‰ºä½“<br/><a href="https://helpcenter.tmall.com/learn/knowledge?spm=a225r.8199751.0.0.759e443dtXIoLr&id=24179433&xttkn=00ecadba403ca9a7" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>æ±‰ä»ªç³»åˆ—</td><td>18æ¬¾æ±‰ä»ªå­—ä½“ï¼ˆä»…äº¬ä¸œå¹³å°å…è´¹ä½¿ç”¨ï¼‰<br/>æ±‰ä»ªä¸­é»‘(ç®€/ç¹)ã€æ±‰ä»ªç»†ç®€é»‘(ç®€)ã€æ±‰ä»ªä¸­ç®€é»‘(ç®€)ã€æ±‰ä»ªæ¥·ä½“(ç®€/ç¹)ã€æ±‰ä»ªä¹¦å®‹ä¸€(ç®€)ã€æ±‰ä»ªä¹¦å®‹äºŒ(ç¹)ã€æ±‰ä»ªç²—ä»¿å®‹(ç®€)ã€æ±‰ä»ªæ°´æ»´ä½“(ç®€/ç¹)ã€æ±‰ä»ªçç éš¶(ç®€/ç¹)<br/><a href="http://fw.jd.com/449421.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>ç™½èˆŸæ›¸ä½“å››å­£è¯</td><td>è¿™æ¬¾å­—ä½“å…±28æ¬¾ï¼Œåˆ†æ˜¥å¤ç§‹å†¬å››å­£ï¼Œå¾ˆæ¼‚äº®ã€‚ä½†åªèƒ½åœ¨ç”¨äºèŠ‚æ—¥åº†ç¥çš„åˆ›ä½œä¸Šã€‚æƒ³å…è´¹å•†ç”¨çš„éœ€è¦å‘é‚®ä»¶è”ç³»<br/><a href="www.hakusyu.com/download_shiki_spring.htm">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>å¯’è‰æ‰‹æ‹™ä½“ã€‚ <a href="https://www.zcool.com.cn/work/ZMzAzODE0MTI=.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>å“å¥æ©„æ¦„ç®€ä½“ã€‚<a href="https://www.zcool.com.cn/work/ZNDA2MzA3ODQ=.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>åº·åº·ä½“ã€‚<a href="http://www.sucaijishi.com/font-37-792-1.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>ä»¤ä¸œé½æ±²ä½“ã€‚<a href="https://github.com/LingDong-/qiji-font" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>é˜¿æœ±æ³¡æ³¡å­—ã€‚<a href="https://www.zcool.com.cn/work/ZNDA2MzkyNTY=.html" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>é©¬å–„æ”¿æ¯›ç¬”æ¥·ä¹¦ã€‚<a href="https://fonts.google.com/specimen/Ma+Shan+Zheng" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>å°æ‰ã€‚<a href="https://fonts.google.com/specimen/Kosugi%20Maru?selection.family=Kosugi%20Maru" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>é’Ÿé½å¿—è½è¡Œä¹¦ã€‚<a href="https://fonts.google.com/specimen/Zhi+Mang+Xing" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>é’Ÿé½æµæ±Ÿæ¯›è‰ã€‚<a href="https://fonts.google.com/specimen/Liu+Jian+Mao+Cao" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>è‹±æ¤æ¥·æ›¸ã€‚<a href="https://www.ac-font.com/jp/detail_jb_007.php" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>è‹±æ¤è¡Œæ›¸ã€‚<a href="https://www.ac-font.com/jp/detail_jb_006.php" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>è¡¡å±±æ¯›ç­†ãƒ•ã‚©ãƒ³ãƒˆã€‚<a href="https://www.ac-font.com/jp/detail_jb_002.php" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>é’æŸ³ç–çŸ³ãƒ•ã‚©ãƒ³ãƒˆã€‚<a href="https://www.ac-font.com/jp/detail_jb_001.php" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>é’æŸ³è¡¡å±±ãƒ•ã‚©ãƒ³ãƒˆTã€‚<a href="https://www.ac-font.com/jp/detail_jb_003.php" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>è¡¡å±±æ¯›ç­†ãƒ•ã‚©ãƒ³ãƒˆè‰æ›¸ã€‚<a href="https://www.ac-font.com/jp/detail_jb_005.php" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>ä¸­æ–‡åƒç´ å­—ä½“ã€‚<a href="https://purestudio.itch.io/ipix" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>é¦™æ¸¯æ°‘é–“å­—é›†ã€‚<a href="https://github.com/hfhchan/hkcs/blob/master/LICENSE.txt" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>æœ‰çˆ±é­”å…½é»‘ä½“ã€‚<a href="https://github.com/nowar-fonts/Nowar-Sans/blob/wow/LICENSE.txt" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>æœ‰çˆ±é­”å…½é”æ–¹ã€‚<a href="https://github.com/nowar-fonts/Nowar-CnC/blob/master/LICENSE.txt" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>æœ‰çˆ±é­”å…½åœ†ä½“ã€‚<a href="https://github.com/nowar-fonts/Nowar-Rounded/blob/master/LICENSE.txt" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>æœ‰çˆ±åœ†ä½“ã€‚<a href="https://github.com/nowar-fonts/Nowar-Rounded/blob/master/LICENSE.txt" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>è‡ªç”±é¦™æ¸¯æ¥·æ›¸ã€‚<a href="https://freehkfonts.opensource.hk/download/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>jf open ç²‰åœ“å­—å‹ã€‚<a href="https://justfont.com/huninn/" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr><tr><td>å…¶ä»–</td><td>æ€æºå±æ˜¾è‡»å®‹.<a href="https://bbs.themex.net/showthread.php?t=16906226" target="_blank" rel="noopener">æˆæƒå‡ºå¤„,ç‚¹æˆ‘æŸ¥çœ‹</a></td></tr></tbody></table><p>(2) å°†å­—ä½“æ”¾åˆ°ä½ åšå®¢çš„ç›¸å…³ç›®å½•ï¼Œç†è®ºä¸Šå“ªé‡Œéƒ½å¯ä»¥ï¼Œä½†æ˜¯è¦æ³¨æ„å¼•å…¥è·¯å¾„ã€‚</p><p>æ¯”å¦‚æˆ‘å·å·å°†<a href="https://cxj660.gitee.io/" target="_blank" rel="noopener">å´”å»ºåšå®¢</a>çš„<code>hl.ttf</code>å­—ä½“ ï¼ˆ æ±Ÿè¥¿æ‹™æ¥·ä½“ ï¼‰ æ‰’è¿‡æ¥äº†ï¼ˆå˜¿å˜¿~ åƒä¸‡ä¸è¦å‘Šè¯‰ä»–ï¼‰<br>æˆ‘æ”¾åœ¨å·¥ä½œç›®å½•ä¸‹çš„ <code>/source/box/font/</code> æ–‡ä»¶å¤¹å†…ï¼Œå³æ–‡ä»¶è·¯å¾„ä¸º <code>/source/box/font/hl.ttf</code> ï¼Œå¦‚æœä½ è¦ç”¨å¤šç§å­—ä½“å¯ä»¥åœ¨<code>font</code>ç›®å½•ç»Ÿä¸€å­˜æ”¾ã€‚</p><p>(3)  æ·»åŠ å¼•å…¥å’Œä½¿ç”¨</p><p>æ‰¾åˆ°ä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹çš„ <code>my.css</code> æ–‡ä»¶ï¼Œè·¯å¾„ä¸º <code>/themes/matery/source/css/my.css</code> ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸‹é¢çš„ä»£ç </p><pre class=" language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@font-face</span></span><span class="token punctuation">{</span>    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'hl'</span><span class="token punctuation">;</span>    <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url">url('../box/font/hl.ttf')</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** è¡¨ç¤ºå…¨å±€ä½¿ç”¨ï¼Œå¦‚æœä¸æƒ³å…¨å±€ä½¿ç”¨ä¸è¦æ·»åŠ è¯¥æ®µ */</span><span class="token selector">body</span><span class="token punctuation">{</span>    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'hl'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/* å¯ä»¥å±€éƒ¨ä½¿ç”¨ï¼Œå»ºè®®æ·»åŠ  */</span><span class="token selector"><span class="token class">.diyFont</span></span><span class="token punctuation">{</span>    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'hl'</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>åœ¨ä½ æƒ³è¦ä½¿ç”¨çš„å…ƒç´ çš„ <code>class</code>  é‡Œé¢åŠ ä¸Š <code>diyFont</code> å³å¯ã€‚</p><ul><li><p>ç›´æ¥ä½¿ç”¨</p><p>F12ï¼Œæ‰¾åˆ°å¯¹åº”çš„ä»£ç ç‰‡æ®µå³å¯ï¼š</p></li></ul><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logo-span diyFont<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å¼ å°èœè‹”<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><ul><li><p>æ¨¡æ¿ä½¿ç”¨</p><p>æ‰¾åˆ°å¯¹åº”çš„æ¨¡æ¿ <code>header.ejs</code>ä¸­çš„ä»£ç ç‰‡æ®µä½¿ç”¨å³å¯ï¼š</p></li></ul><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logo-span diyFont<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&lt;%= config.title %><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code></pre><br/><h3 id="å¦‚æœæœ‰å…¶ä»–é—®é¢˜æ¬¢è¿ç•™è¨€æˆ–é‚®ä»¶æé—®"><a href="#å¦‚æœæœ‰å…¶ä»–é—®é¢˜æ¬¢è¿ç•™è¨€æˆ–é‚®ä»¶æé—®" class="headerlink" title="å¦‚æœæœ‰å…¶ä»–é—®é¢˜æ¬¢è¿ç•™è¨€æˆ–é‚®ä»¶æé—®"></a>å¦‚æœæœ‰å…¶ä»–é—®é¢˜æ¬¢è¿ç•™è¨€æˆ–é‚®ä»¶æé—®</h3><p>QQ:970175021<br>Email:<a href="mailto:small-rose@qq.com">small-rose@qq.com</a></p><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><ul><li><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a></li><li><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a></li><li><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a></li><li><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a></li><li><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a></li><li><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a></li><li><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a></li><li><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a></li><li><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a></li><li><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a></li><li><a href="a53a9069.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></li><li><a href="5a99eb4d.html">Hexoåšå®¢Materyä¸»é¢˜æ·»åŠ å¤šçº§åˆ†ç±»</a></li><li><a href="5a2c12e2.html">Hexoåšå®¢æ·»åŠ æ€ç»´å¯¼å›¾æ¸²æŸ“</a></li></ul><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybtis(äº”)Mapperæ˜ å°„å™¨</title>
      <link href="/posts/ae8510ea.html"/>
      <url>/posts/ae8510ea.html</url>
      
        <content type="html"><![CDATA[<h2 id="Mybatisæ˜ å°„å™¨"><a href="#Mybatisæ˜ å°„å™¨" class="headerlink" title="Mybatisæ˜ å°„å™¨"></a>Mybatisæ˜ å°„å™¨</h2><p>Mybatisé€šè¿‡æ˜ å°„å™¨æ„é€ çš„SQLï¼Œå¹¶ä¸”é€šè¿‡é…ç½®ç”Ÿæˆå¯¹åº”çš„JavaBeanè¿”å›ç»™è°ƒç”¨è€…ï¼Œè¿™äº›é…ç½®ä¸»è¦æ˜¯æ˜ å°„å™¨ã€‚æ˜ å°„å™¨çš„ XML æ–‡ä»¶ï¼Œé€šä¿—çš„è¯´å°±æ˜¯Mapper.xmlæ–‡ä»¶å°±æ˜¯å±äºXMLæ˜ å°„å™¨ï¼Œæ³¨è§£çš„<code>@Select(&quot;sql&quot;)</code>é…ç½®æ–¹å¼åˆ™æ˜¯æ³¨è§£æ˜ å°„å™¨ã€‚å­¦ä¹ ä»¥XMLæ˜ å°„å™¨è®°å½•ä¸ºä¸»ã€‚</p><h3 id="æ˜ å°„å™¨çš„ä¸»è¦å…ƒç´ "><a href="#æ˜ å°„å™¨çš„ä¸»è¦å…ƒç´ " class="headerlink" title="æ˜ å°„å™¨çš„ä¸»è¦å…ƒç´ :"></a>æ˜ å°„å™¨çš„ä¸»è¦å…ƒç´ :</h3><p>XMLæ˜ å°„æ–‡ä»¶ä¸»è¦é…ç½®ï¼š</p><table><thead><tr><th>å…ƒç´ /æ ‡ç­¾</th><th>ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>select</td><td>æ˜ å°„æŸ¥è¯¢è¯­å¥ï¼Œæœ€å¸¸ç”¨çš„å¤æ‚çš„çš„å…ƒç´ ä¹‹ä¸€</td><td>å¯ä»¥è‡ªå®šä¹‰å‚æ•°ï¼Œè¿”å›ç»“æœé›†ç­‰</td></tr><tr><td>insert</td><td>æ˜ å°„æ’å…¥è¯­å¥</td><td>æ‰§è¡Œåè¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œä»£è¡¨æ’å…¥çš„æ¡æ•°</td></tr><tr><td>update</td><td>æ˜ å°„æ›´æ–°è¯­å¥</td><td>æ‰§è¡Œåè¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œä»£è¡¨æ›´æ–°çš„æ¡æ•°</td></tr><tr><td>delete</td><td>æ˜ å°„åˆ é™¤è¯­å¥</td><td>æ‰§è¡Œåè¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œä»£è¡¨æ›´æ–°çš„æ¡æ•°</td></tr><tr><td>sql</td><td>å…è®¸å®šä¹‰çš„å¯é‡ç”¨SQLè¯­å¥å—</td><td>å¦‚è¡¨çš„åˆ—åï¼Œä¸€æ¬¡å®šä¹‰ï¼Œå¤šä¸ªSQLè¯­å¥éƒ½å¯ä»¥ä½¿ç”¨</td></tr><tr><td>resultMap</td><td>æè¿°ä»æ•°æ®åº“ç»“æœé›†ä¸­æ¥åŠ è½½å¯¹è±¡ï¼Œæ˜¯æœ€å¤æ‚ä¹Ÿæ˜¯æœ€å¼ºå¤§çš„å…ƒç´ </td><td>æä¾›æ˜ å°„è§„åˆ™</td></tr><tr><td>cache</td><td>æŒ‡å®šå‘½åç©ºé—´çš„ç¼“å­˜é…ç½®ã€‚</td><td>-</td></tr><tr><td>cache-ref</td><td>å¼•ç”¨å…¶å®ƒå‘½åç©ºé—´çš„ç¼“å­˜é…ç½®ã€‚</td><td>-</td></tr></tbody></table><h3 id="ä¸€ã€SELECT-å…ƒç´ "><a href="#ä¸€ã€SELECT-å…ƒç´ " class="headerlink" title="ä¸€ã€SELECT å…ƒç´ "></a>ä¸€ã€SELECT å…ƒç´ </h3><p>selectå…ƒç´ é…ç½®</p><p> select å…ƒç´ å…è®¸ä½ é…ç½®å¾ˆå¤šå±æ€§æ¥é…ç½®æ¯æ¡è¯­å¥çš„è¡Œä¸ºç»†èŠ‚ã€‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span>  <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectPerson<span class="token punctuation">"</span></span>  <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span>  <span class="token attr-name">parameterMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deprecated<span class="token punctuation">"</span></span>  <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hashmap<span class="token punctuation">"</span></span>  <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>personResultMap<span class="token punctuation">"</span></span>  <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>  <span class="token attr-name">useCache</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>  <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span>  <span class="token attr-name">fetchSize</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>256<span class="token punctuation">"</span></span>  <span class="token attr-name">statementType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>PREPARED<span class="token punctuation">"</span></span>  <span class="token attr-name">resultSetType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>FORWARD_ONLY<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><h4 id="SELECTä¸»è¦å±æ€§ï¼š"><a href="#SELECTä¸»è¦å±æ€§ï¼š" class="headerlink" title="SELECTä¸»è¦å±æ€§ï¼š"></a>SELECTä¸»è¦å±æ€§ï¼š</h4><table><thead><tr><th>å±æ€§</th><th>è¯´æ˜</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>id</td><td>å’ŒMapperçš„å‘½åç©ºé—´ç»„åˆæˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæä¾›ç»™Mybatisè°ƒç”¨</td><td>å¦‚æœå‘½åç©ºé—´å’Œidç»„åˆä¹‹åå­˜åœ¨é‡å¤ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>parameterType</td><td>å‚æ•°ç±»å‹ï¼Œå¯ä»¥æ˜¯åŸºæœ¬ç±»å‹ï¼Œå¯ä»¥Mapï¼Œå¯ä»¥æ˜¯ç±»çš„å…¨å‘½åæˆ–åˆ«åï¼Œåˆ«åå¿…é¡»æ˜¯å†…éƒ¨å®šä¹‰æˆ–è‡ªå®šä¹‰çš„</td><td>å¦‚int,Mapï¼ŒJavaBeanç­‰å¤æ‚çš„å‚æ•°ç±»å‹</td></tr><tr><td>resultType</td><td>JavaBeançš„è§„èŒƒæ˜ å°„ï¼›å¯ä»¥æ˜¯int,doubleç­‰å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»çš„å…¨å‘½åæˆ–ç¬¦åˆè§„èŒƒçš„åˆ«å</td><td>ä¸èƒ½å’ŒresultMapåŒæ—¶ä½¿ç”¨ï¼Œå¦‚æœè¿”å›é›†åˆï¼Œåˆ™å€¼ä¸ºé›†åˆé‡Œçš„ç±»å‹ã€‚</td></tr><tr><td>resultMap</td><td>æ˜¯æ˜ å°„é›†çš„å¼•ç”¨ï¼Œå°†æ‰§è¡Œå¼ºå¤§çš„æ˜ å°„åŠŸèƒ½ï¼Œå¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰æ˜ å°„è§„åˆ™</td><td>å¯ä»¥é…ç½®æ˜ å°„çº§è”ã€ç±»å‹è½¬æ¢å™¨ç­‰</td></tr><tr><td>flushCache</td><td>å°†å€¼è®¾ç½®ä¸º true ååœ¨è°ƒç”¨SQLåï¼Œè¦æ±‚Mybatisæ¸…ç©ºä¹‹å‰çš„æŸ¥è¯¢æœ¬åœ°ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜</td><td>é»˜è®¤å€¼ä¸ºfalseï¼Œå³ä¸æ¸…ç©ºç¼“å­˜</td></tr><tr><td>useCache</td><td>å°†å…¶è®¾ç½®ä¸º true åï¼Œå°†ä¼šè¯¥æ¡è¯­å¥çš„ç»“æœè¢«äºŒçº§ç¼“å­˜ç¼“å­˜èµ·æ¥ã€‚</td><td>é»˜è®¤å€¼ï¼šå¯¹ select å…ƒç´ ä¸º trueã€‚å³å¼€å¯äºŒçº§ç¼“å­˜</td></tr><tr><td>timeout</td><td>è®¾ç½®ç­‰å¾…æ•°æ®åº“è¿”å›è¯·æ±‚ç»“æœçš„è¶…æ—¶ç§’æ•°ï¼Œè¶…æ—¶åæŠ›å¼‚å¸¸</td><td>é»˜è®¤å€¼ä¸ºæœªè®¾ç½®ï¼ˆunsetï¼‰ï¼ˆä¾èµ–æ•°æ®åº“é©±åŠ¨ï¼‰</td></tr><tr><td>fetchSize</td><td>è®¾ç½®è·å–è®°å½•æ€»æ¡æ•°</td><td>é»˜è®¤å€¼ä¸ºæœªè®¾ç½®ï¼ˆunsetï¼‰ï¼ˆä¾èµ–é©±åŠ¨ï¼‰</td></tr><tr><td>statementType</td><td>å¯é€‰ STATEMENTï¼ŒPREPARED æˆ– CALLABLEã€‚è¿™ä¼šè®© MyBatis åˆ†åˆ«ä½¿ç”¨ Statementï¼ŒPreparedStatement æˆ– CallableStatement</td><td>é»˜è®¤å€¼ï¼šPREPARED</td></tr><tr><td>resultSetType</td><td>è¿™æ˜¯å’ŒJDBCçš„resultSetæ¥å£å¯¹åº”ï¼Œå€¼åŒ…æ‹¬FORWARD_ONLYï¼ˆæ¸¸æ ‡å…è®¸å‘å‰è®¿é—®ï¼‰ï¼ŒSCROLL_SENSITIVEï¼ˆåŒå‘æ»šåŠ¨ï¼Œä½†ä¸åŠæ—¶æ›´æ–°ï¼Œå³æ•°æ®åº“é‡Œçš„æ•°æ®ä¿®æ”¹ä¹‹åä¸å†resultSetä¸­ååº”å‡ºæ¥ï¼‰, SCROLL_INSENSITIVEï¼ˆåŒå‘æ»šåŠ¨å¹¶åŠæ—¶åŒæ­¥æ•°æ®åº“çš„æ›´æ–°ä»¥æ›´æ”¹resultSetä¸­çš„æ•°æ®ï¼‰ æˆ– DEFAULTï¼ˆç­‰ä»·äº unsetï¼‰</td><td>é»˜è®¤å€¼ä¸º unset ï¼ˆä¾èµ–æ•°æ®åº“é©±åŠ¨ï¼‰</td></tr><tr><td>databaseId</td><td>é…ç½®äº†æ•°æ®åº“å‚å•†æ ‡è¯†ï¼ˆdatabaseIdProviderï¼‰çš„è§„åˆ™</td><td>å¤šæ•°æ®åº“æ”¯æŒ</td></tr><tr><td>resultOrdered</td><td>è¿™ä¸ªè®¾ç½®ä»…é’ˆå¯¹åµŒå¥—ç»“æœ select è¯­å¥ï¼šå¦‚æœä¸º trueï¼Œå°†ä¼šå‡è®¾åŒ…å«äº†åµŒå¥—ç»“æœé›†æˆ–æ˜¯åˆ†ç»„äº†ï¼Œå½“è¿”å›ä¸€ä¸ªä¸»ç»“æœè¡Œæ—¶ï¼Œå°±ä¸ä¼šäº§ç”Ÿå¯¹å‰é¢ç»“æœé›†çš„å¼•ç”¨ã€‚ è¿™å°±ä½¿å¾—åœ¨è·å–åµŒå¥—ç»“æœé›†çš„æ—¶å€™ä¸è‡³äºå†…å­˜ä¸å¤Ÿç”¨ã€‚</td><td>é»˜è®¤å€¼ï¼šfalse</td></tr><tr><td>resultSets</td><td>è¿™ä¸ªè®¾ç½®ä»…é€‚ç”¨äºå¤šç»“æœé›†çš„æƒ…å†µã€‚å®ƒå°†åˆ—å‡ºè¯­å¥æ‰§è¡Œåè¿”å›çš„ç»“æœé›†å¹¶èµ‹äºˆæ¯ä¸ªç»“æœé›†ä¸€ä¸ªåç§°ï¼Œå¤šä¸ªåç§°ä¹‹é—´ä»¥é€—å·åˆ†éš”ã€‚</td><td>å¾ˆå°‘ä½¿ç”¨</td></tr></tbody></table><h4 id="selecè‡ªåŠ¨æ˜ å°„"><a href="#selecè‡ªåŠ¨æ˜ å°„" class="headerlink" title="selecè‡ªåŠ¨æ˜ å°„"></a>selecè‡ªåŠ¨æ˜ å°„</h4><p>åœ¨settingså…ƒç´ ä¸­é…ç½®autoMappingBehaviorå±æ€§å€¼è®¾ç½®å…¶ç­–ç•¥ã€‚æœ‰ä¸‰ä¸ªå€¼ï¼š<br>(1)NONE - è¡¨ç¤ºå–æ¶ˆè‡ªåŠ¨æ˜ å°„<br>(2)PARTIAL - ç®€å•æ˜ å°„ï¼Œåªä¼šè‡ªåŠ¨æ˜ å°„é‚£äº›æ²¡æœ‰å®šä¹‰åµŒå¥—ç»“æœé›†æ˜ å°„çš„ç»“æœé›†ã€‚<br>(3)FULL - å®Œæ•´æ˜ å°„ï¼Œä¼šè‡ªåŠ¨æ˜ å°„ä»»æ„å¤æ‚çš„ç»“æœé›†ï¼Œä¸è®ºæ˜¯å¦åµŒå¥—ã€‚</p><p>é»˜è®¤å€¼ä¸ºPARTIALï¼Œé»˜è®¤æƒ…å†µå¯ä»¥å®ç°ä¸€èˆ¬å¯¹è±¡çš„æ˜ å°„ï¼Œä½¿ç”¨FULLåµŒå¥—æ˜ å°„ï¼Œæ€§èƒ½ä¼šä¸‹é™ã€‚</p><p>å½“autoMappingBehaviorè®¾ç½®ä¸ä¸ºNONEæ—¶ï¼ŒMybatisæä¾›è‡ªåŠ¨æ˜ å°„åŠŸèƒ½ã€‚è¦æ±‚è¿”å›SQLåˆ—åå’ŒJavaBeançš„å±æ€§ä¸€è‡´ï¼Œæˆ–è€…å¼€å¯é‡‡ç”¨é©¼å³°å‘½åæ–¹å¼ã€‚</p><p>å¦‚æœæ•°æ®åº“è§„èŒƒå‘½åï¼Œæ¯ä¸ªå•è¯éƒ½ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†å‰²ï¼ŒPOJOé‡‡ç”¨é©¼å³°å¼å‘½åæ–¹æ³•ï¼Œå¯ä»¥è®¾ç½®mapUnderscoreToCamelCaseä¸ºtrueï¼Œå®ç°DBåˆ°POJOçš„è‡ªåŠ¨æ˜ å°„ã€‚</p><h4 id="selectå¤šå‚æ•°ä¼ é€’"><a href="#selectå¤šå‚æ•°ä¼ é€’" class="headerlink" title="selectå¤šå‚æ•°ä¼ é€’"></a>selectå¤šå‚æ•°ä¼ é€’</h4><p>ï¼ˆ1ï¼‰ä½¿ç”¨Mapä¼ é€’å‚æ•°<br>æ˜ å°„æ–‡ä»¶ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByMap<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>select id, name,email from empleewhere name like concat('%',#{name},'%') and email like  concat('%',#{email},'%') <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>Mapperæ¥å£ï¼š</p><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> <span class="token function">selectByMap</span><span class="token punctuation">(</span>HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> params<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è°ƒç”¨ï¼š</p><pre class=" language-java"><code class="language-java">Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Obejct<span class="token operator">></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Obejct<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"å¼ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">,</span><span class="token string">"@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>Employee<span class="token operator">></span>  empList <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">selectByMap</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä½¿ç”¨Mapä¼ é€’ä¼˜ç¼ºç‚¹ï¼š</p><table><thead><tr><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>å¯ä»¥è‡ªå®šä¹‰é”®ï¼Œå‚æ•°ä¸ªæ•°ä»»æ„æ‰©å±•</td><td>é”®å€¼ä½¿ç”¨å¯èƒ½ç¼ºå°‘ä¸šåŠ¡å…³è”æ€§ï¼Œä»£ç å¯è¯»æ€§ç›¸å¯¹è¾ƒå·®ï¼Œä¸çœ‹è°ƒç”¨åœ°æ–¹ï¼Œä¸çŸ¥é“Mapé‡Œä¼šæœ‰å“ªäº›ä¸šåŠ¡æ•°æ®</td></tr></tbody></table><p>ï¼ˆ2ï¼‰ä½¿ç”¨æ³¨è§£ä¼ é€’å‚æ•°<br>ä½¿ç”¨å‚æ•°æ³¨è§£<code>@Param</code>(org.apache.ibatis.annotations.Param)æ¥å®ç°å‚æ•°ä¼ é€’ã€‚</p><p>Mapperæ¥å£ï¼š</p><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> <span class="token function">selectByAnnotation</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>String name<span class="token punctuation">,</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">)</span>String email<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>XMLæ˜ å°„æ— é¡»å®šä¹‰å‚æ•°ç±»å‹ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByAnnotation<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>select id, name,email from empleewhere name like concat('%',#{name},'%') and email like  concat('%',#{email},'%') <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>è°ƒç”¨ï¼š</p><pre class=" language-java"><code class="language-java">Sring name <span class="token operator">=</span> <span class="token string">"å¼ "</span><span class="token punctuation">;</span>Sring email<span class="token operator">=</span> <span class="token string">"@qq.com"</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> empList <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">selectByAnnotation</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å‚æ•°ä¼ é€’ä¼˜ç¼ºç‚¹<br>|ä¼˜ç‚¹|ç¼ºç‚¹|<br>|@Paramæä¾›çš„åå­—çŸ¥é“ä¼ é€’å‚æ•°çš„ä¸šåŠ¡æ•°æ®ï¼Œå¯è¯»æ€§è¾ƒå¥½|å‚æ•°è¾ƒå¤šæ—¶æ¯”è¾ƒå¤æ‚ï¼Œä¸”ä¸èƒ½æ‰©å±•|</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨JavaBeanä¼ é€’å‚æ•°</p><p>å®šä¹‰ä¸ªJavaBeanï¼Œå¦‚æœåªåšæŸ¥è¯¢ç”¨å¯ä»¥å«xxxVO,xxxQueryä¹‹ç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>emp<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> Integer empId<span class="token punctuation">;</span>    <span class="token keyword">private</span> String empName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String email<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//getter setter ...</span><span class="token punctuation">}</span></code></pre><p>XMLæ˜ å°„æ— é¡»å®šä¹‰å‚æ•°ç±»å‹ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByAnnotation<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span>  <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>select id, name,email from empleewhere name like concat('%',#{empName},'%') and email like  concat('%',#{email},'%') <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>Mapperæ¥å£ï¼š</p><pre class=" language-java"><code class="language-java">List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> <span class="token function">selectByJavaBean</span><span class="token punctuation">(</span>Employee<span class="token punctuation">,</span>emp<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è°ƒç”¨åŒç†ï¼š</p><pre class=" language-java"><code class="language-java">Employee empQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>empQuery<span class="token punctuation">.</span><span class="token function">setEmpName</span><span class="token punctuation">(</span><span class="token string">"å¼ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>empQuery<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> empList <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">selectByJavaBean</span><span class="token punctuation">(</span>empQuery<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ€»ç»“ï¼š<br>ï¼ˆ1ï¼‰ä½¿ç”¨Mapä¼ é€’å‚æ•°å¯¼è‡´ä¸šåŠ¡å¯è¯»æ€§è¾ƒå·®ï¼Œå‚æ•°ä¼¸ç¼©æ€§é€‚å®œï¼Œå¯¹å«å›ºå®šä¸šåŠ¡çš„ä¸šåŠ¡å¯è§†æƒ…å†µä½¿ç”¨ã€‚è¦æ±‚æ‰©å±•æ€§å˜åŠ¨çš„ä¸šåŠ¡è§†æƒ…å†µä½¿ç”¨ã€‚<br>ï¼ˆ2ï¼‰ä½¿ç”¨@Paramæ³¨è§£ä¼ é€’å‚æ•°ï¼Œå—ä¸ªæ•°Nå½±å“ï¼Œä¸šåŠ¡æ„ä¹‰æ˜ç¡®ï¼Œå¯è¯»æ€§è¾ƒå¥½ï¼Œå‚æ•°è¾ƒå°‘ï¼ˆN&lt;=5ï¼‰æ—¶æœ€ä½³æ–¹å¼ï¼Œå‚æ•°å˜åŠ¨æ—¶ï¼Œéœ€ä¿®æ”¹æ–¹æ³•å®šä¹‰ã€‚<br>ï¼ˆ3ï¼‰ä½¿ç”¨JavaBeanæ–¹å¼ï¼Œå‚æ•°è¾ƒå¤šæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨JavaBeanæ–¹å¼ï¼Œä¸šåŠ¡æ€§æ˜æ˜¾ï¼Œä¼¸ç¼©å¯è°ƒã€‚</p><h3 id="äºŒã€resultMapæ˜ å°„ç»“æœé›†"><a href="#äºŒã€resultMapæ˜ å°„ç»“æœé›†" class="headerlink" title="äºŒã€resultMapæ˜ å°„ç»“æœé›†"></a>äºŒã€resultMapæ˜ å°„ç»“æœé›†</h3><p>resultMapå’Œselectå…³è”æå¼ºã€‚</p><p>ResultMap çš„è®¾è®¡æ€æƒ³æ˜¯ï¼šå¯¹ç®€å•çš„è¯­å¥åšåˆ°é›¶é…ç½®ï¼Œå¯¹äºå¤æ‚ä¸€ç‚¹çš„è¯­å¥ï¼Œåªéœ€è¦æè¿°è¯­å¥ä¹‹é—´çš„å…³ç³»ã€‚<br>Mybatisæä¾›äº†resultTypeå±æ€§æŒ‡å®šé¢†åŸŸæ¨¡å‹ï¼Œå®Œæˆè‡ªåŠ¨æ˜ å°„ã€‚å¸¸è§çš„é¢†åŸŸæ¨¡å‹å¦‚ï¼š<code>HashMap</code>ï¼Œ<code>JavaBean</code>ï¼Œ<code>POJO</code>ã€‚</p><p>å®Œæ•´çš„ç»“æœæ˜ å°„ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>idArg</span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Arg</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discriminator</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discriminator</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><h4 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h4><p>å…¶ä¸­<code>constructor</code>å…ƒç´ ç”¨äºé…ç½®æ„é€ æ–¹æ³•ã€‚é€šå¸¸æ˜¯æ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•æ—¶ï¼Œå¯¹åº”ä¸€ä¸ªæœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ã€‚å¦‚æœé…ç½®äº†æ„é€ æ–¹æ³•Mybatiså°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ„é€ æ–¹æ³•æ¥æ„é€ POJOäº†ã€‚å®é™…ä¸­ä½¿ç”¨è¾ƒå°‘ï¼Œå› ä¸ºæœ‰äº›æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨ä¸å¯å˜ç±»ï¼Œæ„é€ æ–¹æ³•æ³¨å…¥å…è®¸ä½ åœ¨åˆå§‹åŒ–æ—¶ä¸ºç±»è®¾ç½®å±æ€§çš„å€¼ï¼Œè€Œä¸ç”¨æš´éœ²å‡ºå…¬æœ‰æ–¹æ³•ã€‚ </p><blockquote><p>ä»ç‰ˆæœ¬ 3.4.3 å¼€å§‹ï¼Œå¯ä»¥åœ¨æŒ‡å®šå‚æ•°åç§°çš„å‰æä¸‹ï¼Œä»¥ä»»æ„é¡ºåºç¼–å†™ arg å…ƒç´ ã€‚ </p></blockquote><h4 id="idå’Œresult"><a href="#idå’Œresult" class="headerlink" title="idå’Œresult"></a>idå’Œresult</h4><p>idå…ƒç´ ï¼šè¡¨ç¤ºå“ªä¸ªåˆ—æ˜¯ç«¹å‰‘ï¼Œå…è®¸å¤šä¸ªä¸»é”®ï¼ˆå³è”åˆä¸»é”®ï¼‰ã€‚</p><p>resultå…ƒç´ ï¼šé…ç½®POJOåˆ°SQLåˆ—åçš„æ˜ å°„å…³ç³»ã€‚</p><h4 id="idå’Œresultå…ƒç´ å±ï¼š"><a href="#idå’Œresultå…ƒç´ å±ï¼š" class="headerlink" title="idå’Œresultå…ƒç´ å±ï¼š"></a>idå’Œresultå…ƒç´ å±ï¼š</h4><table><thead><tr><th>å±æ€§</th><th align="left">æè¿°</th><th align="left">å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>property</code></td><td align="left">æ˜ å°„åˆ°åˆ—ç»“æœçš„å­—æ®µæˆ–å±æ€§ã€‚å¦‚æœ JavaBean/POJO æœ‰è¿™ä¸ªåå­—çš„å±æ€§ï¼ˆpropertyï¼‰ï¼Œä¼šå…ˆä½¿ç”¨è¯¥å±æ€§ã€‚å¦åˆ™ MyBatis å°†ä¼šå¯»æ‰¾ç»™å®šåç§°çš„å­—æ®µï¼ˆfieldï¼‰ã€‚</td><td align="left">å¯ä»¥ä½¿ç”¨ç‚¹å¼åˆ†éš”å½¢å¼è¿›è¡Œå¤æ‚å±æ€§å¯¼èˆªã€‚ æ¯”å¦‚ï¼Œè®¿é—®å­¦ç”Ÿå¯¹è±¡ï¼ˆStudentï¼‰éœ€è¦è®¿é—®å­¦ç”Ÿè¯(SelfCard)çš„å‘è¯æ—¥æœŸï¼ˆissueDateï¼‰å¯ä»¥å†™æˆï¼šselfCard.issueDate</td></tr><tr><td><code>column</code></td><td align="left">æ•°æ®åº“ä¸­çš„åˆ—åï¼Œæˆ–è€…æ˜¯åˆ—çš„åˆ«åã€‚</td><td align="left">ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™å’Œä¼ é€’ç»™                 <code>resultSet.getString(columnName)</code> æ–¹æ³•çš„å‚æ•°ä¸€æ ·ã€‚</td></tr><tr><td><code>javaType</code></td><td align="left">ä¸€ä¸ª Java ç±»çš„å…¨é™å®šåï¼Œæˆ–ä¸€ä¸ªç±»å‹åˆ«åï¼ˆå…³äºå†…ç½®çš„ç±»å‹åˆ«åï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„è¡¨æ ¼ï¼‰ã€‚</td><td align="left">å¦‚æœä½ æ˜ å°„åˆ°ä¸€ä¸ª JavaBeanï¼ŒMyBatis é€šå¸¸å¯ä»¥æ¨æ–­ç±»å‹ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ˜ å°„åˆ°çš„æ˜¯HashMapï¼Œé‚£ä¹ˆä½ åº”è¯¥æ˜ç¡®åœ°æŒ‡å®š javaType æ¥ä¿è¯è¡Œä¸ºä¸æœŸæœ›çš„ç›¸ä¸€è‡´ã€‚</td></tr><tr><td><code>jdbcType</code></td><td align="left">JDBC ç±»å‹ï¼Œæ‰€æ”¯æŒçš„ JDBC ç±»å‹å‚è§è¿™ä¸ªè¡¨æ ¼ä¹‹åçš„â€œæ”¯æŒçš„ JDBC ç±»å‹â€ã€‚</td><td align="left">åªéœ€è¦åœ¨å¯èƒ½æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤çš„ä¸”å…è®¸ç©ºå€¼çš„åˆ—ä¸ŠæŒ‡å®š JDBC ç±»å‹ã€‚è¿™æ˜¯JDBC çš„è¦æ±‚è€Œé MyBatis çš„è¦æ±‚ã€‚å¦‚æœä½ ç›´æ¥é¢å‘ JDBC                 ç¼–ç¨‹ï¼Œä½ éœ€è¦å¯¹å¯ä»¥ä¸ºç©ºå€¼çš„åˆ—æŒ‡å®šè¿™ä¸ªç±»å‹ã€‚</td></tr><tr><td><code>typeHandler</code></td><td align="left">ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨è¦†ç›–é»˜è®¤çš„ç±»å‹å¤„ç†å™¨ã€‚</td><td align="left">è¿™ä¸ªå±æ€§å€¼æ˜¯ä¸€ä¸ªç±»å‹å¤„ç†å™¨å®ç°ç±»çš„å…¨é™å®šåï¼Œæˆ–è€…æ˜¯ç±»å‹åˆ«åã€‚ç”¨æ¥å®šåˆ¶jdbcType å’ŒJavaTypeç›¸äº’è½¬åŒ–çš„è§„åˆ™ã€‚</td></tr></tbody></table><h4 id="æ”¯æŒçš„-JDBC-ç±»å‹"><a href="#æ”¯æŒçš„-JDBC-ç±»å‹" class="headerlink" title="æ”¯æŒçš„ JDBC ç±»å‹"></a>æ”¯æŒçš„ JDBC ç±»å‹</h4><p>MyBatis é€šè¿‡å†…ç½®çš„ jdbcType æšä¸¾ç±»å‹æ”¯æŒä¸‹é¢çš„ JDBC ç±»å‹ã€‚</p><table><thead><tr><th><code>BIT</code></th><th><code>FLOAT</code></th><th><code>CHAR</code></th><th><code>TIMESTAMP</code></th><th><code>OTHER</code></th><th><code>UNDEFINED</code></th></tr></thead><tbody><tr><td><code>TINYINT</code></td><td><code>REAL</code></td><td><code>VARCHAR</code></td><td><code>BINARY</code></td><td><code>BLOB</code></td><td><code>NVARCHAR</code></td></tr><tr><td><code>SMALLINT</code></td><td><code>DOUBLE</code></td><td><code>LONGVARCHAR</code></td><td><code>VARBINARY</code></td><td><code>CLOB</code></td><td><code>NCHAR</code></td></tr><tr><td><code>INTEGER</code></td><td><code>NUMERIC</code></td><td><code>DATE</code></td><td><code>LONGVARBINARY</code></td><td><code>BOOLEAN</code></td><td><code>NCLOB</code></td></tr><tr><td><code>BIGINT</code></td><td><code>DECIMAL</code></td><td><code>TIME</code></td><td><code>NULL</code></td><td><code>CURSOR</code></td><td><code>ARRAY</code></td></tr></tbody></table><h4 id="resultMapç»“æœæ˜ å°„é›†ï¼š"><a href="#resultMapç»“æœæ˜ å°„é›†ï¼š" class="headerlink" title="resultMapç»“æœæ˜ å°„é›†ï¼š"></a>resultMapç»“æœæ˜ å°„é›†ï¼š</h4><p>ï¼ˆ1ï¼‰ä½¿ç”¨<code>Map</code>å­˜å‚¨ç»“æœé›†ã€‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectEmps<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span>  <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Map<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>select id, name,email from empleewhere name like concat('%',#{empName},'%') and email like  concat('%',#{email},'%') <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ‰€æœ‰çš„<code>select</code>è¯­å¥éƒ½å¯ä»¥ä½¿ç”¨<code>Map</code>ï¼Œæ˜¯ä¸€ç§æ¯”è¾ƒé€šç”¨çš„æ–¹å¼ã€‚</p><p>ï¼ˆ2ï¼‰ä½¿ç”¨POJOå­˜å‚¨ç»“æœé›†ã€‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>did<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectEmp<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span>  <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select emp_id, emp_name,sex,email,dept_id from tbl_emp    where emp_id=#{empId}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p><code>resultMap</code>çš„idä»£è¡¨ä¸€ä¸ª<code>resultMap</code>æ ‡è¯†ï¼Œ<code>type</code>å°±æ˜¯éœ€è¦æ˜ å°„çš„POJOã€‚å¯ä»¥ä½¿ç”¨Mybatisé…ç½®ä¸­å®šä¹‰åˆ«åï¼Œæˆ–è€…ä½¿ç”¨ç±»çš„å…¨é™å®šåã€‚æ˜ å°„å…³ç³»ä¸­çš„idå°±æ˜¯å¯¹è±¡çš„ä¸»é”®ï¼Œ<code>property</code>å¯¹åº”POJOçš„å±æ€§åç§°ï¼Œ<code>column</code>å¯¹åº”çš„æ˜¯æ•°æ®åº“SQLçš„åˆ—åï¼Œè¿™æ ·ç»“æœå°±å¯¹åº”èµ·æ¥äº†ã€‚ä¸Šé¢çš„ä¾‹å­åˆ—åå’Œ<code>column</code>æ˜¯å¯¹åº”çš„ï¼Œå½“ç„¶è¿˜å¯ä»¥é…ç½®ç±»å‹è½¬æ¢å™¨<code>typeHandler</code>ã€<code>javaType</code>ã€<code>jdbcType</code>ã€‚éœ€è¦æ³¨æ„ï¼šé…ç½®äº†<code>resultMap</code>å°±ä¸èƒ½é…ç½®<code>resultType</code>ã€‚</p><h4 id="Mybatisçº§è”"><a href="#Mybatisçº§è”" class="headerlink" title="Mybatisçº§è”"></a>Mybatisçº§è”</h4><p>Mybatisçº§è”ä¸»è¦æœ‰3ç§ï¼š<code>association</code>(ä¸€å¯¹ä¸€)ï¼Œ<code>collection</code>ï¼ˆä¸€å¯¹å¤šï¼‰,<code>discriminator</code>ï¼ˆé‰´åˆ«å™¨ï¼‰ã€‚</p><p>çº§è”éœ€è¦ç¤ºä¾‹è¯´æ˜ï¼Œå› ç¯‡å¹…è¾ƒé•¿å•ä½œä¸€ç¯‡ï¼š<a href="44c4c800.html">ã€ŠMybtis(äº”)Mapperçº§è”ã€‹</a></p><h3 id="ä¸‰ã€INSERTå…ƒç´ "><a href="#ä¸‰ã€INSERTå…ƒç´ " class="headerlink" title="ä¸‰ã€INSERTå…ƒç´ "></a>ä¸‰ã€INSERTå…ƒç´ </h3><p>insertå…ƒç´ ï¼ŒMybatisä¼šåœ¨æ‰§è¡Œæ’å…¥åè¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ“ä½œåæ’å…¥çš„è®°å½•æ•°ã€‚</p><p>insertã€updateã€deleteå…ƒç´ å±æ€§ï¼š</p><table><thead><tr><th>å±æ€§</th><th>æè¿°</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>id</code></td><td>åœ¨å‘½åç©ºé—´ä¸­å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¯ä»¥è¢«ç”¨æ¥å¼•ç”¨è¿™æ¡è¯­å¥ã€‚</td><td>ä¸å”¯ä¸€æ—¶MybatisæŠ›å‡ºå¼‚å¸¸</td></tr><tr><td><code>parameterType</code></td><td>å°†ä¼šä¼ å…¥è¿™æ¡è¯­å¥çš„å‚æ•°çš„ç±»å…¨é™å®šåæˆ–åˆ«åï¼Œä½¿ç”¨åˆ«åå¿…é¡»æ˜¯Mybatiså†…éƒ¨å®šä¹‰æˆ–é…ç½®çš„è‡ªå®šä¹‰åˆ«åã€‚è¿™ä¸ªå±æ€§æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºMyBatis å¯ä»¥é€šè¿‡ç±»å‹å¤„ç†å™¨ï¼ˆTypeHandlerï¼‰æ¨æ–­å‡ºå…·ä½“ä¼ å…¥è¯­å¥çš„å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºæœªè®¾ç½®ï¼ˆunsetï¼‰ã€‚</td><td>å¦‚JavaBeanã€Mapã€JavaTypeç­‰ç±»å‹ä¼ é€’ç»™SQL</td></tr><tr><td><code>parameterMap</code></td><td>ç”¨äºå¼•ç”¨å¤–éƒ¨ parameterMap çš„å±æ€§ï¼Œç›®å‰å·²è¢«åºŸå¼ƒã€‚</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td><code>flushCache</code></td><td>å°†å…¶è®¾ç½®ä¸º true åï¼Œåªè¦è¯­å¥è¢«è°ƒç”¨ï¼Œéƒ½ä¼šå¯¼è‡´æœ¬åœ°ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜è¢«æ¸…ç©ºï¼Œé»˜è®¤å€¼ï¼šï¼ˆå¯¹ insertã€update å’Œ delete è¯­å¥ï¼‰trueã€‚</td><td></td></tr><tr><td><code>timeout</code></td><td>è®¾ç½®è¶…æ—¶å‚æ•°ï¼Œæ˜¯åœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œé©±åŠ¨ç¨‹åºç­‰å¾…æ•°æ®åº“è¿”å›è¯·æ±‚ç»“æœçš„ç§’æ•°ã€‚é»˜è®¤å€¼ä¸ºæœªè®¾ç½®ï¼ˆunsetï¼‰ï¼ˆä¾èµ–æ•°æ®åº“é©±åŠ¨ï¼‰ã€‚</td><td>é»˜è®¤å€¼æ˜¯æ•°æ®åº“å‚å•†æä¾›çš„JDBCé©±åŠ¨æ‰€è®¾ç½®çš„ç§’æ•°ã€‚</td></tr><tr><td><code>statementType</code></td><td>å¯é€‰ STATEMENTï¼ŒPREPARED æˆ– CALLABLEã€‚è¿™ä¼šè®© MyBatis åˆ†åˆ«ä½¿ç”¨Statementï¼ŒPreparedStatement æˆ– CallableStatementï¼Œ</td><td>é»˜è®¤å€¼ï¼šPREPAREDã€‚</td></tr><tr><td><code>useGeneratedKeys</code></td><td>ï¼ˆ<strong>ä»…é€‚ç”¨äº insert å’Œ update</strong>ï¼‰è¿™ä¼šä»¤ MyBatis ä½¿ç”¨ JDBC çš„ getGeneratedKeys æ–¹æ³•æ¥å–å‡ºç”±æ•°æ®åº“å†…éƒ¨ç”Ÿæˆçš„ä¸»é”®ï¼ˆæ¯”å¦‚ï¼šåƒ MySQL å’Œ SQL Server è¿™æ ·çš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„è‡ªåŠ¨é€’å¢å­—æ®µï¼‰ã€‚</td><td>é»˜è®¤å€¼ï¼šfalseã€‚å¦‚æœè¦ä½¿ç”¨éœ€è¦è®¾ç½®æˆtrue</td></tr><tr><td><code>keyProperty</code></td><td>ï¼ˆ<strong>ä»…é€‚ç”¨äº insert å’Œ update</strong>ï¼‰æŒ‡å®šèƒ½å¤Ÿå”¯ä¸€è¯†åˆ«å¯¹è±¡çš„å±æ€§ï¼ŒMyBatis ä¼šä½¿ç”¨getGeneratedKeys çš„è¿”å›å€¼æˆ– insert è¯­å¥çš„ selectKey å­å…ƒç´ è®¾ç½®å®ƒçš„å€¼ï¼Œé»˜è®¤å€¼ï¼šæœªè®¾ç½®ï¼ˆ<code>unset</code>ï¼‰ã€‚å¦‚æœç”Ÿæˆåˆ—ä¸æ­¢ä¸€ä¸ªï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”å¤šä¸ªå±æ€§åç§°ã€‚</td><td>è®¾ç½®å“ªä¸ªåˆ—ä¸ºä¸»é”®ï¼Œå¦‚æœæ˜¯è”åˆä¸»é”®å¯ä»¥ç”¨é€—å·éš”å¼€</td></tr><tr><td><code>keyColumn</code></td><td>ï¼ˆ<strong>ä»…é€‚ç”¨äº insert å’Œ update</strong>ï¼‰è®¾ç½®ç”Ÿæˆé”®å€¼åœ¨è¡¨ä¸­çš„åˆ—åï¼Œåœ¨æŸäº›æ•°æ®åº“ï¼ˆåƒ PostgreSQLï¼‰ä¸­ï¼Œå½“ä¸»é”®åˆ—ä¸æ˜¯è¡¨ä¸­çš„ç¬¬ä¸€åˆ—çš„æ—¶å€™ï¼Œæ˜¯å¿…é¡»è®¾ç½®çš„ã€‚å¦‚æœç”Ÿæˆåˆ—ä¸æ­¢ä¸€ä¸ªï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”å¤šä¸ªå±æ€§åç§°ã€‚</td><td>å¦‚æœæ˜¯è”åˆä¸»é”®å¯ä»¥ç”¨é€—å·éš”å¼€</td></tr><tr><td><code>databaseId</code></td><td>å¦‚æœé…ç½®äº†æ•°æ®åº“å‚å•†æ ‡è¯†ï¼ˆdatabaseIdProviderï¼‰ï¼ŒMyBatis ä¼šåŠ è½½æ‰€æœ‰ä¸å¸¦databaseId æˆ–åŒ¹é…å½“å‰ databaseId çš„è¯­å¥ï¼›å¦‚æœå¸¦å’Œä¸å¸¦çš„è¯­å¥éƒ½æœ‰ï¼Œåˆ™ä¸å¸¦çš„ä¼šè¢«å¿½ç•¥ã€‚</td><td>å¤šç§æ•°æ®åº“æ”¯æŒ</td></tr></tbody></table><h4 id="INSERTå›å¡«ä¸»é”®"><a href="#INSERTå›å¡«ä¸»é”®" class="headerlink" title="INSERTå›å¡«ä¸»é”®"></a>INSERTå›å¡«ä¸»é”®</h4><p>å¦‚æœä½ å¸Œæœ›insertè¯­å¥æ‰§è¡Œåè¿”å›è®°å½•çš„ä¸»é”®ï¼š</p><p>ï¼ˆ1ï¼‰æ•°æ®åº“æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®çš„å­—æ®µï¼ˆæ¯”å¦‚ MySQL å’Œ SQL Serverï¼‰</p><p>ç›´æ¥è®¾ç½® <code>useGeneratedKeys=&quot;true&quot;</code>ï¼Œç„¶åå†æŠŠ keyProperty è®¾ç½®ä¸ºç›®æ ‡å±æ€§å°±å¯ä»¥äº†ã€‚ å¦‚ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>insertEmployee<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span>  <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  insert into tbl_emp (emp_name,sex,email,dept_id )  values (#{empName},#{sex},#{email},#{dept_id})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></code></pre><p>è¿™æ ·ä¼ å…¥çš„<code>employee</code>å¯¹è±¡å°±ä¸éœ€è¦è®¾ç½®empIdå±æ€§ï¼ŒMybatisä¼šç”¨æ•°æ®åº“è®¾ç½®è¿›è¡Œå¤„ç†ã€‚</p><p>å¦‚æœæ•°æ®åº“æ”¯æŒæ‰¹é‡æ’å…¥ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>insertManyEmployees<span class="token punctuation">"</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  insert into Author (username, password, email, bio) values  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    (#{empName},#{sex},#{email},#{dept_id})  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></code></pre><p>ï¼ˆ2ï¼‰æ•°æ®åº“ä¸æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®åˆ—ï¼Œæˆ–è€…JDBC é©±åŠ¨ä¸æ”¯æŒç”Ÿæˆä¸»é”®ã€‚</p><p>å¯¹äºä¸æ”¯æŒçš„æƒ…å†µï¼ŒMyBatis æ”¯æŒè‡ªå®šä¹‰ä¸»é”®ç”Ÿæˆ</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>insertEmp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selectKey</span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BEFORE<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select if(max(id) is null, 1 , max(id)+2) as  newId a from tbl_emp  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selectKey</span><span class="token punctuation">></span></span>  insert into tbl_emp   (emp_Id,emp_name,sex,email,dept_id )  values    (#{empId},#{empName},#{sex},#{email},#{dept_id})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></code></pre><p>ç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆä¼šè¿è¡Œ selectKey å…ƒç´ ä¸­çš„è¯­å¥ï¼Œå¹¶è®¾ç½® <code>Employee</code>çš„ empIdï¼Œç„¶åæ‰ä¼šè°ƒç”¨æ’å…¥è¯­å¥ã€‚è¿™æ ·å°±å®ç°äº†æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆä¸»é”®ç±»ä¼¼çš„è¡Œä¸ºï¼ŒåŒæ—¶ä¿æŒäº† Java ä»£ç çš„ç®€æ´ã€‚ çœ‹ä¸€çœ‹çš„ MyBatis å¤„ç†ä¸»é”®ç”Ÿæˆçš„çµæ´»æ€§å’Œå®½å®¹åº¦ ã€‚</p><p>selectKey å…ƒç´ æè¿°å¦‚ä¸‹ï¼š         </p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selectKey</span>    <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BEFORE<span class="token punctuation">"</span></span> <span class="token attr-name">statementType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>PREPARED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selectKey</span><span class="token punctuation">></span></span></code></pre><p>selectKey å±æ€§ï¼š</p><table><thead><tr><th>å±æ€§</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>keyProperty</code></td><td><code>selectKey</code> è¯­å¥ç»“æœåº”è¯¥è¢«è®¾ç½®åˆ°çš„ç›®æ ‡å±æ€§ã€‚å¦‚æœç”Ÿæˆåˆ—ä¸æ­¢ä¸€ä¸ªï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”å¤šä¸ªå±æ€§åç§°ã€‚</td></tr><tr><td><code>keyColumn</code></td><td>è¿”å›ç»“æœé›†ä¸­ç”Ÿæˆåˆ—å±æ€§çš„åˆ—åã€‚å¦‚æœç”Ÿæˆåˆ—ä¸æ­¢ä¸€ä¸ªï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”å¤šä¸ªå±æ€§åç§°ã€‚</td></tr><tr><td><code>resultType</code></td><td>ç»“æœçš„ç±»å‹ã€‚é€šå¸¸ MyBatis å¯ä»¥æ¨æ–­å‡ºæ¥ï¼Œä½†æ˜¯ä¸ºäº†æ›´åŠ å‡†ç¡®ï¼Œå†™ä¸Šä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚MyBatis                 å…è®¸å°†ä»»ä½•ç®€å•ç±»å‹ç”¨ä½œä¸»é”®çš„ç±»å‹ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€‚å¦‚æœç”Ÿæˆåˆ—ä¸æ­¢ä¸€ä¸ªï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŒ…å«æœŸæœ›å±æ€§çš„ Object æˆ– Mapã€‚</td></tr><tr><td><code>order</code></td><td>å¯è®¾ç½®ä¸º <code>BEFORE</code> æˆ– <code>AFTER</code>ã€‚å¦‚æœè®¾ç½®ä¸º<code>BEFORE</code>ï¼Œé‚£ä¹ˆå®ƒé¦–å…ˆä¼šç”Ÿæˆä¸»é”®ï¼Œè®¾ç½® <code>keyProperty</code>å†æ‰§è¡Œæ’å…¥è¯­å¥ã€‚å¦‚æœè®¾ç½®ä¸º<code>AFTER</code>ï¼Œé‚£ä¹ˆå…ˆæ‰§è¡Œæ’å…¥è¯­å¥ï¼Œç„¶åæ˜¯ <code>selectKey</code> ä¸­çš„è¯­å¥ - è¿™å’Œ Oracle  æ•°æ®åº“çš„è¡Œä¸ºç›¸ä¼¼ï¼Œåœ¨æ’å…¥è¯­å¥å†…éƒ¨å¯èƒ½æœ‰åµŒå…¥ç´¢å¼•è°ƒç”¨ã€‚</td></tr><tr><td><code>statementType</code></td><td>å’Œå‰é¢ä¸€æ ·ï¼ŒMyBatis æ”¯æŒ <code>STATEMENT</code>ï¼Œ<code>PREPARED</code> å’Œ <code>CALLABLE</code> ç±»å‹çš„æ˜ å°„è¯­å¥ï¼Œåˆ†åˆ«ä»£è¡¨ <code>Statement</code>, <code>PreparedStatement</code> å’Œ  <code>CallableStatement</code> ç±»å‹ã€‚</td></tr></tbody></table><h4 id="å‚æ•°ä½¿ç”¨"><a href="#å‚æ•°ä½¿ç”¨" class="headerlink" title="å‚æ•°ä½¿ç”¨"></a>å‚æ•°ä½¿ç”¨</h4><p>å¦‚æœä¹‹å‰åœ¨é…ç½®é‡Œæåˆ°çš„ç±»å‹è½¬æ¢å™¨typeHandler</p><pre class=" language-xml"><code class="language-xml">#{sex,javaType=string, jdbcType=NUMERIC,typeHandler=org.apache.ibatis.type.EnumOrdinalTypeHandler}</code></pre><h4 id="å­˜å‚¨è¿‡ç¨‹æ”¯æŒ"><a href="#å­˜å‚¨è¿‡ç¨‹æ”¯æŒ" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹æ”¯æŒ"></a>å­˜å‚¨è¿‡ç¨‹æ”¯æŒ</h4><p>å­˜å‚¨è¿‡ç¨‹å­˜åœ¨3ç§å‚æ•°ï¼šè¾“å…¥å‚æ•°ï¼ˆINï¼‰ã€è¾“å‡ºå‚æ•°ï¼ˆOUTï¼‰ã€è¾“å…¥è¾“å‡ºå‚æ•°ï¼ˆINOUTï¼‰ã€‚Mybatisçš„å‚æ•°è§„åˆ™å‡æä¾›æ”¯æŒã€‚é€šè¿‡è®¾ç½®<code>mode</code>å±æ€§æ¥ç¡®å®šå‚æ•°ç±»å‹ï¼Œ<code>mode</code>çš„å€¼å¯¹åº”ä¹Ÿæœ‰ä¸‰ç§ï¼šINã€OUTã€INOUTã€‚</p><p>å½“<code>mode</code>å‚æ•°è®¾ç½®OUTæˆ–INOUTæ—¶ï¼ŒMybatisä¼šå°†å­˜å‚¨è¿‡ç¨‹è¿”å›çš„ç»“æœç¤¾ä¼šç»„åˆ°æŒ‡å®šçš„å‚æ•°ä¸­ã€‚</p><p>å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªæ¸¸æ ‡ï¼ˆjdbcType=CURSORï¼‰æ—¶ï¼Œè¿˜éœ€è¦è®¾ç½®resultMapï¼Œæ–¹ä¾¿Mybatiså°†å­˜å‚¨è¿‡ç¨‹å‚æ•°æ˜ å°„åˆ°å¯¹åº”çš„ç±»å‹ï¼Œè¿™æ ·Mybatiså°±å¯ä»¥é€šè¿‡è®¾ç½®çš„resultMapè‡ªåŠ¨è®¾ç½®æ˜ å°„ç»“æœã€‚</p><pre class=" language-xml"><code class="language-xml">#{employee, mode=OUT,jdbcType=CURSOR,javaType=ResultSet,resultMap=empResultMap}</code></pre><p>javaTypeå¯é€‰ï¼Œå› ä¸ºMybatiså¯ä»¥è‡ªåŠ¨æ£€æµ‹å®ƒã€‚</p><p>Mybatisè¿˜æ”¯æŒä¸€ä¸‹é«˜çº§ç‰¹æ€§ï¼Œå¦‚ç»“æ„ä½“ï¼Œå½“æ³¨å†Œå‚æ•°æ—¶éœ€è¦æŒ‡å®šè¯­å¥ç±»å‹åç§°ï¼ˆjdbcTypeNameï¼‰:</p><pre class=" language-xml"><code class="language-xml">#{emp,mode=OUT,jdbcType=STRUCT,jdbcTypeName=MY_TYPE,resultMap=dempResultMap}</code></pre><p>åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒMyBatiséƒ½ä¼šè‡ªåŠ¨æ¨æ–­è¿”å›æ•°æ®ç±»å‹ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½ä¸éœ€è¦é…ç½®å‚æ•°ç±»å‹å’Œç»“æœç±»å‹ã€‚éœ€è¦è®¾ç½®çš„æ˜¯å®¹æ˜“è¿”å›ä¸ºnullçš„å­—æ®µç±»å‹ï¼Œnullå€¼Mybatisæ— æ³•åˆ¤æ–­ç±»å‹ã€‚å¦‚å¤‡æ³¨å­—æ®µ</p><pre class=" language-xml"><code class="language-xml">#{mark,jdbcType=VARCHAR}</code></pre><h4 id="ç‰¹æ®Šå­—ç¬¦ä¸²æ›¿æ¢å¤„ç†ï¼ˆ-å’Œ-ï¼‰"><a href="#ç‰¹æ®Šå­—ç¬¦ä¸²æ›¿æ¢å¤„ç†ï¼ˆ-å’Œ-ï¼‰" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦ä¸²æ›¿æ¢å¤„ç†ï¼ˆ#å’Œ$ï¼‰"></a>ç‰¹æ®Šå­—ç¬¦ä¸²æ›¿æ¢å¤„ç†ï¼ˆ#å’Œ$ï¼‰</h4><p>è®¾ç½®å‚æ•°å¸¸ç”¨<code>#{empName}</code>åœ¨å¤§éƒ¨åˆ†æƒ…å†µMybatiséƒ½ä¼šè¿›è¡Œé¢„ç¼–è¯‘å¤„ç†ï¼Œç„¶åå†èµ‹å€¼ã€‚</p><p>å¦‚æœéœ€è¦ä¼ é€’æ˜¯SQLè¯­å¥æœ¬èº«ï¼Œä¸æ˜¯SQLå‚æ•°ï¼Œå¦‚åŠ¨æ€è¡¨æ ¼ï¼Œæ ¹æ®æ¡ä»¶æ˜¾ç¤ºä¸åŒçš„åˆ—ï¼Œä¼ é€’SQLåˆ—åï¼Œæ ¹æ®æŸäº›åˆ—æ’åºç­‰ä½¿ç”¨åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨<code>$</code>ç¬¦å·ï¼Œå¦‚ä¼ é€’å˜é‡<code>columns=&quot;col1,col2,col3&quot;</code>ç»™SQL,ç»„è£…SQLè¯­å¥åˆ™å¯ä»¥ä½¿ç”¨ï¼š</p><pre class=" language-xml"><code class="language-xml">select ${columns} from t_table</code></pre><p>è¿™æ ·columnså°±ä¸ä¼šè¢«Mybatisè¿›è¡Œé¢„ç¼–è¯‘è§£æï¼Œè€Œå˜ä¸ºç›´æ¥æ›¿æ¢ã€‚åªæ˜¯è¿™æ ·å­˜åœ¨SQLæ³¨å…¥çš„é£é™©é—®é¢˜ã€‚Mybatisç»™äºˆè¶³å¤Ÿçš„çµæ´»æ€§ï¼Œéœ€è¦è‡ªå·±ä¿è¯SQLçš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§ã€‚</p><h3 id="å››ã€UPDATEå…ƒç´ "><a href="#å››ã€UPDATEå…ƒç´ " class="headerlink" title="å››ã€UPDATEå…ƒç´ "></a>å››ã€UPDATEå…ƒç´ </h3><p>å‚æ•°è§INSERTå…ƒç´ å¤„ã€‚ç¤ºä¾‹ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>updateByExample<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    update tbl_emp    set emp_id = #{record.empId,jdbcType=INTEGER},      emp_name = #{record.empName,jdbcType=VARCHAR},      sex = #{record.sex,jdbcType=CHAR},      email = #{record.email,jdbcType=VARCHAR}    where emp_id = #{empId,jdbcType=INTEGER}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>updateByPrimaryKeySelective<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    update tbl_emp    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName !<span class="token punctuation">=</span> null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        emp_name = #{empName,jdbcType=VARCHAR},      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex !<span class="token punctuation">=</span> null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        sex = #{sex,jdbcType=CHAR},      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email !<span class="token punctuation">=</span> null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        email = #{email,jdbcType=VARCHAR},      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>    where emp_id = #{empId,jdbcType=INTEGER}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span></code></pre><h3 id="äº”ã€DELETEå…ƒç´ "><a href="#äº”ã€DELETEå…ƒç´ " class="headerlink" title="äº”ã€DELETEå…ƒç´ "></a>äº”ã€DELETEå…ƒç´ </h3><p>å‚æ•°è§INSERTå…ƒç´ å¤„ã€‚ç¤ºä¾‹ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deleteByPrimaryKey<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    delete from tbl_emp    where emp_id = #{empId,jdbcType=INTEGER}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">></span></span></code></pre><h3 id="å…­ã€SQLå…ƒç´ "><a href="#å…­ã€SQLå…ƒç´ " class="headerlink" title="å…­ã€SQLå…ƒç´ "></a>å…­ã€SQLå…ƒç´ </h3><p>SQLå…ƒç´ ç”¨æ¥å®šä¹‰ä¸€ä¸²SQLè¯­å¥ç‰‡æ®µï¼Œä½¿ä¹‹å¯ä»¥åœ¨å…¶ä»–çš„è¯­å¥é€šè¿‡å¼•ç”¨æ¥ä½¿ç”¨å®ƒã€‚ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†SQLä»£ç ç‰‡æ®µå¤ç”¨ã€‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sql</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_columns<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    emp_id, emp_name, sex, email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sql</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectEmployee<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hashMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_columns<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  FROM tbl_emp  WHERE emp_id = #{empId}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>ä¹Ÿå¯ä»¥é…åˆæŒ‡å®šå‚æ•°æ¥ä½¿ç”¨ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sql</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_columns<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    #{prefix}.emp_id, #{prefix}.emp_name, #{prefix}.sex, #{prefix}.email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sql</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectEmployee<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hashMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_columns<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>prefix<span class="token punctuation">"</span></span> <span class="token attr-name">vaule</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>e<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>  FROM tbl_emp e  WHERE e.emp_id = #{empId}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>è¿˜å¯ä»¥ç»™<code>refid</code>å‚æ•°å€¼ç”±ç¨‹åºå¼•å…¥ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sql</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>someinclude<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select * from <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${tableName}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sql</span><span class="token punctuation">></span></span></code></pre><h3 id="ä¸ƒã€Cacheç¼“å­˜"><a href="#ä¸ƒã€Cacheç¼“å­˜" class="headerlink" title="ä¸ƒã€Cacheç¼“å­˜"></a>ä¸ƒã€Cacheç¼“å­˜</h3><p>ç¼“å­˜æ˜¯äº’è”ç½‘ç³»ç»Ÿå¸¸å¸¸ç”¨åˆ°çš„ï¼Œç‰¹ç‚¹æ˜¯è®²æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å¸¸è§çš„æµè¡Œç¼“å­˜æœåŠ¡å™¨æœ‰MongoDBã€Redisã€Ehcacheç­‰ã€‚ç¼“å­˜ä»è®¡ç®—æœºå†…å­˜è¯»å–æ•°æ®ï¼Œæ— éœ€ä»ç£ç›˜è¯»å…¥ï¼Œå…·æœ‰å¿«é€Ÿè¯»å–ä½¿ç”¨çš„ç‰¹ç‚¹ï¼Œå¦‚æœç¼“å­˜å‘½ä¸­ç‡é«˜ï¼Œå¯ä»¥æå¤§æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚å¦‚æœç¼“å­˜å‘½ä¸­ç‡å¾ˆä½ï¼Œç¼“å­˜å°±ä¸å­˜åœ¨ä½¿ç”¨çš„æ„ä¹‰äº†ï¼Œæ‰€ä»¥ä½¿ç”¨ç¼“å­˜çš„å…³é”®æ˜¯å­˜å‚¨å†…å®¹è®¿é—®çš„å‘½ä¸­ç‡ã€‚</p><h4 id="ç³»ç»Ÿç¼“å­˜"><a href="#ç³»ç»Ÿç¼“å­˜" class="headerlink" title="ç³»ç»Ÿç¼“å­˜"></a>ç³»ç»Ÿç¼“å­˜</h4><p>MyBatisç³»ç»Ÿç¼“å­˜åˆ†ï¼šä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ã€‚</p><h5 id="ä¸€çº§ç¼“å­˜"><a href="#ä¸€çº§ç¼“å­˜" class="headerlink" title="ä¸€çº§ç¼“å­˜"></a>ä¸€çº§ç¼“å­˜</h5><p>MyBatisåœ¨æ²¡æœ‰é…ç½®çš„é»˜è®¤æƒ…å†µä¸‹ï¼Œå€¼å¼€å¯ä¸€çº§ç¼“å­˜ï¼ˆä¸€çº§ç¼“å­˜å€¼ç›¸å¯¹äºåŒä¸€ä¸ªSqlSessionè€Œè¨€ï¼‰ã€‚</p><p>åœ¨å‚æ•°å’ŒSQLå®Œå…¨ä¸€æ ·æ—¶ï¼Œä½¿ç”¨SqlSessionç¬¬ä¸€æ¬¡æŸ¥è¯¢åï¼ŒMybatisä¼šå°†å…¶æ”¾å…¥ç¼“å­˜ä¸­ï¼Œåç»­æŸ¥è¯¢æ—¶å¦‚æ²¡æœ‰å£°æ˜éœ€è¦åˆ·æ–°ç¼“å­˜ï¼Œä¸”ç¼“å­˜æ²¡æœ‰è¶…æ—¶çš„æƒ…å†µä¸‹ï¼ŒSqlSessionéƒ½åªä¼šå–å‡ºå½“å‰ç¼“å­˜æ•°æ®ï¼Œä¸ä¼šå‘ç”ŸSQLåˆ°æ•°æ®åº“æ‰§è¡ŒæŸ¥è¯¢ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸åŒçš„ SqlSessionéƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œå¦‚æœæ›´æ¢äº†æ–°çš„SqlSessionï¼Œå³ä½¿æ˜¯ç›¸åŒçš„Mapperã€å‚æ•°å’Œæ–¹æ³•ï¼Œè¿˜æ˜¯ä¼šå‘é€SQLåˆ°æ•°æ®åº“æ‰§è¡Œï¼Œè¿”å›ç»“æœã€‚</p><h5 id="äºŒçº§ç¼“å­˜"><a href="#äºŒçº§ç¼“å­˜" class="headerlink" title="äºŒçº§ç¼“å­˜"></a>äºŒçº§ç¼“å­˜</h5><p>ä¸ºäº†å…‹æœSqlSessionç›¸äº’éš”ç¦»é—®é¢˜ï¼Œéœ€è¦é…ç½®äºŒçº§ç¼“å­˜ï¼Œä½¿ç”¨åœ¨SqlSessionFactoryå±‚é¢ä¸Šç»™å„ä¸ªSqlSessionå¯¹è±¡å…±äº«æ•°æ®ã€‚SqlSessionFactoryæ›¾çš„äºŒçº§ç¼“å­˜é»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œå¦‚æœå¼€å¯éœ€è¦è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸”å®ç°äºŒçº§ç¼“å­˜çš„æ—¶å€™ï¼ŒMyBatisè¦æ±‚è¿”å›çš„POJOå¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼ˆå³å®ç°Serializableæ¥å£ï¼‰ï¼Œé…ç½®æ¯”è¾ƒç®€å•ï¼š</p><p>ï¼ˆ1ï¼‰ç¬¬ä¸€æ­¥ï¼Œåœ¨XMLæ–‡ä»¶ä¸­é…ç½®å³å¯ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token punctuation">/></span></span></code></pre><p>è¿™æ ·çš„é…ç½®ï¼Œè®¸å¤šè®¾ç½®æ˜¯é»˜è®¤çš„ï¼Œå…¶å«ä¹‰ä¸ºï¼š</p><p>ï¼ˆaï¼‰æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰<code>select</code>è¯­å¥å°†ä¼šè¢«ç¼“å­˜ã€‚</p><p>ï¼ˆbï¼‰æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰<code>insert</code>ã€<code>update</code>ã€<code>delete</code>è¯­å¥å°†ä¼šè¢«ç¼“å­˜ã€‚</p><p>ï¼ˆcï¼‰ç¼“å­˜ä¼šä½¿ç”¨é»˜è®¤çš„<code>Least Recently Usedï¼ˆLRUï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ï¼‰</code>ç®—æ³•æ¥æ”¶å›ç¼“å­˜ã€‚</p><p>ï¼ˆdï¼‰æ ¹æ®æ—¶é—´è¡¨ï¼Œæ¯”å¦‚<code>No Flush Intervalï¼ˆCNFIï¼Œæ²¡æœ‰åˆ·æ–°é—´éš”ï¼‰</code>ï¼Œç¼“å­˜ä¸ä¼šä»¥ä»»ä½•æ—¶é—´é¡ºåºæ¥åˆ·æ–°ã€‚</p><p>ï¼ˆeï¼‰ç¼“å­˜ä¼šå­˜å‚¨åˆ—è¡¨é›†åˆæˆ–å¯¹è±¡ï¼ˆæ— è®ºæŸ¥è¯¢æ–¹æ³•è¿”å›ä»€ä¹ˆï¼‰çš„1024ä¸ªå¼•ç”¨ã€‚</p><p>ï¼ˆfï¼‰ç¼“å­˜ä¼šè¢«è§†ä¸º <code>read/write(å¯è¯»å¯å†™)</code>ç¼“å­˜ï¼Œæ„å‘³ç€å¯¹è±¡æ£€ç´¢ä¸æ˜¯å…±äº«çš„ï¼Œè€Œæ˜¯å¯ä»¥å®‰å…¨åœ°è¢«è°ƒç”¨è€…ä¿®æ”¹ï¼Œä¸å¹²æ‰°å…¶ä»–è°ƒç”¨è€…æˆ–çº¿ç¨‹æ‰€åšçš„æ½œåœ¨ä¿®æ”¹ã€‚</p><p>ï¼ˆ2ï¼‰ç¬¬äºŒæ­¥ï¼Œè®©ä½ POJOå¯¹è±¡å®ç°<code>Serializableæ¥å£</code>ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>emp<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">implements</span> <span class="token class-name">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> 6654960072154305288L<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer empId<span class="token punctuation">;</span>    <span class="token keyword">private</span> String empName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String sex<span class="token punctuation">;</span>    <span class="token keyword">private</span> String email<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> did<span class="token punctuation">;</span>    <span class="token keyword">private</span> Department department <span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//setter getter ...</span><span class="token punctuation">}</span></code></pre><p><strong>ç‰¹åˆ«è¯´æ˜</strong>ï¼š</p><p>ç¼“å­˜åªä½œç”¨äº cache æ ‡ç­¾æ‰€åœ¨çš„æ˜ å°„æ–‡ä»¶ä¸­çš„è¯­å¥ã€‚å¦‚æœä½ æ··åˆä½¿ç”¨ Java API å’Œ XML æ˜ å°„æ–‡ä»¶ï¼Œåœ¨å…±ç”¨æ¥å£ä¸­çš„è¯­å¥å°†ä¸ä¼šè¢«é»˜è®¤ç¼“å­˜ã€‚ä½ éœ€è¦ä½¿ç”¨ <code>@CacheNamespaceRef</code>æ³¨è§£æŒ‡å®šç¼“å­˜ä½œç”¨åŸŸã€‚ </p><p>å…³äº <code>cache</code>å…ƒç´ çš„å±æ€§ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span>  <span class="token attr-name">eviction</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>FIFO<span class="token punctuation">"</span></span> <span class="token attr-name">flushInterval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>60000<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>512<span class="token punctuation">"</span></span> <span class="token attr-name">readOnly</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>è¿™ä¸ªé…ç½®åˆ›å»ºäº†ä¸€ä¸ª FIFO ç¼“å­˜ï¼Œæ¯éš” 60 ç§’åˆ·æ–°ï¼Œæœ€å¤šå¯ä»¥å­˜å‚¨ç»“æœå¯¹è±¡æˆ–åˆ—è¡¨çš„ 512 ä¸ªå¼•ç”¨ï¼Œè€Œä¸”è¿”å›çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯åªè¯»çš„ï¼Œå› æ­¤å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹å¯èƒ½ä¼šåœ¨ä¸åŒçº¿ç¨‹ä¸­çš„è°ƒç”¨è€…äº§ç”Ÿå†²çªã€‚ </p><p>å¯ç”¨çš„æ¸…é™¤ç­–ç•¥æœ‰ï¼š         </p><ul><li><code>LRU</code> â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼šç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚</li><li><code>FIFO</code> â€“ å…ˆè¿›å…ˆå‡ºï¼šæŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ã€‚</li><li><code>SOFT</code> â€“ è½¯å¼•ç”¨ï¼šåŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚</li><li><code>WEAK</code> â€“ å¼±å¼•ç”¨ï¼šæ›´ç§¯æåœ°åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚</li></ul><p>é»˜è®¤çš„æ¸…é™¤ç­–ç•¥æ˜¯ <code>LRU : Least Recently Usedï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ï¼‰</code>ã€‚</p><p><code>flushIntervalï¼ˆåˆ·æ–°é—´éš”ï¼‰</code>å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„çš„æ­£æ•´æ•°ï¼Œè®¾ç½®çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªä»¥æ¯«ç§’ä¸ºå•ä½çš„åˆç†æ—¶é—´é‡ã€‚é»˜è®¤æƒ…å†µæ˜¯ä¸è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åˆ·æ–°é—´éš”ï¼Œç¼“å­˜ä»…ä»…ä¼šåœ¨è°ƒç”¨è¯­å¥æ—¶åˆ·æ–°ã€‚ </p><p><code>sizeï¼ˆå¼•ç”¨æ•°ç›®ï¼‰</code>å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„æ­£æ•´æ•°ï¼Œè¦æ³¨æ„æ¬²ç¼“å­˜å¯¹è±¡çš„å¤§å°å’Œè¿è¡Œç¯å¢ƒä¸­å¯ç”¨çš„å†…å­˜èµ„æºã€‚é»˜è®¤å€¼æ˜¯ 1024ã€‚ </p><p>readOnlyï¼ˆåªè¯»ï¼‰å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸º true æˆ– falseã€‚åªè¯»çš„ç¼“å­˜ä¼šç»™æ‰€æœ‰è°ƒç”¨è€…è¿”å›ç¼“å­˜å¯¹è±¡çš„ç›¸åŒå®ä¾‹ã€‚å› æ­¤è¿™äº›å¯¹è±¡ä¸èƒ½è¢«ä¿®æ”¹ã€‚è¿™å°±æä¾›äº†å¯è§‚çš„æ€§èƒ½æå‡ã€‚è€Œå¯è¯»å†™çš„ç¼“å­˜ä¼šï¼ˆé€šè¿‡åºåˆ—åŒ–ï¼‰è¿”å›ç¼“å­˜å¯¹è±¡çš„æ‹·è´ã€‚é€Ÿåº¦ä¸Šæ…¢ä¸€äº›ï¼Œä½†æ˜¯æ›´å®‰å…¨ï¼Œå› æ­¤é»˜è®¤å€¼æ˜¯ falseã€‚  </p><p><strong>ç‰¹åˆ«æç¤ºï¼š</strong>äºŒçº§ç¼“å­˜æ˜¯äº‹åŠ¡æ€§çš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ SqlSession å®Œæˆå¹¶æäº¤æ—¶ï¼Œæˆ–æ˜¯å®Œæˆå¹¶å›æ»šï¼Œä½†æ²¡æœ‰æ‰§è¡Œ flushCache=true çš„ insert/delete/update è¯­å¥æ—¶ï¼Œç¼“å­˜ä¼šè·å¾—æ›´æ–°ã€‚ </p><h4 id="è‡ªå®šä¹‰ç¼“å­˜"><a href="#è‡ªå®šä¹‰ç¼“å­˜" class="headerlink" title="è‡ªå®šä¹‰ç¼“å­˜"></a>è‡ªå®šä¹‰ç¼“å­˜</h4><p>ä¸Šè¿°Mybatisè‡ªå¸¦ç¼“å­˜çš„æ–¹å¼ï¼Œæ˜¯åœ¨åº”ç”¨éƒ¨ç½²æœºå™¨ä¸Šæœ¬åœ°ç¼“å­˜ã€‚ä½†æ˜¯ç°åœ¨åˆ†å¸ƒå¼ã€å¾®æœåŠ¡ã€å„ç±»ç¼“å­˜æœåŠ¡å™¨å‡ºç°ï¼Œä¹‹åå¯ä»¥è¿›è¡Œè‡ªå®šä¹‰ç¼“å­˜ã€‚ä¹Ÿå¯ä»¥é€šè¿‡å®ç°è‡ªå®šä¹‰çš„ç¼“å­˜ï¼Œæˆ–ä¸ºå…¶ä»–ç¬¬ä¸‰æ–¹ç¼“å­˜æ–¹æ¡ˆåˆ›å»ºé€‚é…å™¨ï¼Œæ¥å®Œå…¨è¦†ç›–ç³»ç»Ÿç¼“å­˜è¡Œä¸ºã€‚</p><p>æ¯”å¦‚ï¼šRedisç¼“å­˜ï¼Œè¦å®ç°è‡ªå®šä¹‰ç¼“å­˜éœ€è¦å®ç°MyBatisæä¾›çš„æ¥å£<code>org.apache.ibatis.cache.Cache</code> ï¼Œç¼“å­˜æ¥å£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>cache<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Cache</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//è·å–ç¼“å­˜ç¼–å·</span>      String <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è·å–ç¼“å­˜å¯¹è±¡å¤§å°</span>     <span class="token keyword">int</span> <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//ä¿å­˜Keyå€¼ç¼“å­˜å¯¹è±¡</span>      <span class="token keyword">void</span> <span class="token function">putObject</span><span class="token punctuation">(</span>Object key<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è·å–Keyå€¼ç¼“å­˜å¯¹è±¡</span>      Object <span class="token function">getObject</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//åˆ¤æ–­Keyå€¼ç¼“å­˜å¯¹è±¡</span>      <span class="token keyword">boolean</span> <span class="token function">hasKey</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//åˆ é™¤Keyå€¼ç¼“å­˜å¯¹è±¡</span>      Object <span class="token function">removeObject</span><span class="token punctuation">(</span>Object key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ¸…ç©ºç¼“å­˜</span>      <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è·å–è¯»å†™é”</span>    ReadWriteLock <span class="token function">getReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼›<span class="token punctuation">}</span></code></pre><p>å¦‚è‡ªå®šä¹‰ç¼“å­˜</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>example<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>ReadWriteLock<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>Cache<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCustomCache</span> <span class="token keyword">implements</span> <span class="token class-name">Cache</span><span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span></code></pre><p>é…ç½®ç¼“å­˜ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.example.MyCustomCache<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>host<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>localhost<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cacheFile<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/tmp/my-custom-cache.tmp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cache</span><span class="token punctuation">></span></span></code></pre><p>å¯ä»¥åœ¨ç¼“å­˜è¿™æ·»åŠ å…¬æœ‰çš„JavaBeanå±æ€§ï¼Œé‚£ä¹ˆåœ¨è‡ªå®šä¹‰çš„<code>MyCustomCache</code>ç±»ä¸­å¢åŠ <code>setHost(String host)</code>å’Œ<code>setCachefile(String file)</code>æ–¹æ³•ï¼Œåœ¨<code>MyCustomCache</code>åˆå§‹åŒ–çš„æ—¶å€™æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œè¿™æ ·å°±å¯ä»¥è®¾ç½®è‡ªå®šä¹‰çš„å‚æ•°ã€‚</p><p> ä»ç‰ˆæœ¬ 3.4.2 å¼€å§‹ï¼ŒMyBatis å·²ç»æ”¯æŒåœ¨æ‰€æœ‰å±æ€§è®¾ç½®å®Œæ¯•ä¹‹åï¼Œè°ƒç”¨ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œè¯·åœ¨ä½ çš„è‡ªå®šä¹‰ç¼“å­˜ç±»é‡Œå®ç° org.apache.ibatis.builder.InitializingObject` æ¥å£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InitializingObject</span> <span class="token punctuation">{</span>  <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><strong>æ³¨æ„ï¼š</strong>ä¸Šä¸€èŠ‚ä¸­å¯¹ç¼“å­˜çš„é…ç½®ï¼ˆå¦‚æ¸…é™¤ç­–ç•¥ã€å¯è¯»æˆ–å¯è¯»å†™ç­‰ï¼‰ï¼Œä¸èƒ½åº”ç”¨äºè‡ªå®šä¹‰ç¼“å­˜ã€‚  </p><p>ç¼“å­˜çš„é…ç½®å’Œç¼“å­˜å®ä¾‹ä¼šè¢«ç»‘å®šåˆ° SQL æ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´ä¸­ã€‚å› æ­¤ï¼ŒåŒä¸€å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰è¯­å¥å’Œç¼“å­˜å°†é€šè¿‡å‘½åç©ºé—´ç»‘å®šåœ¨ä¸€èµ·ã€‚</p><p>å¢åˆ æŸ¥æ”¹çš„æ¯æ¡è¯­å¥å¯ä»¥è‡ªå®šä¹‰ä¸ç¼“å­˜äº¤äº’çš„æ–¹å¼ï¼Œæˆ–å°†å®ƒä»¬å®Œå…¨æ’é™¤äºç¼“å­˜ä¹‹å¤–ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨æ¯æ¡è¯­å¥ä¸Šä½¿ç”¨ä¸¤ä¸ªç®€å•å±æ€§æ¥è¾¾æˆã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯­å¥ä¼šè¿™æ ·æ¥é…ç½®ï¼š         </p><pre><code>&lt;select ... flushCache=&quot;false&quot; useCache=&quot;true&quot;/&gt;&lt;insert ... flushCache=&quot;true&quot;/&gt;&lt;update ... flushCache=&quot;true&quot;/&gt;&lt;delete ... flushCache=&quot;true&quot;/&gt;</code></pre><p>é‰´äºè¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ˜¾ç„¶ä½ æ°¸è¿œä¸åº”è¯¥ä»¥è¿™æ ·çš„æ–¹å¼æ˜¾å¼é…ç½®ä¸€æ¡è¯­å¥ã€‚ä½†å¦‚æœä½ æƒ³æ”¹å˜é»˜è®¤çš„è¡Œä¸ºï¼Œåªéœ€è¦è®¾ç½® flushCache å’Œ  useCache å±æ€§ã€‚æ¯”å¦‚ï¼ŒæŸäº›æƒ…å†µä¸‹ä½ å¯èƒ½å¸Œæœ›ç‰¹å®š select è¯­å¥çš„ç»“æœæ’é™¤äºç¼“å­˜ä¹‹å¤–ï¼Œæˆ–å¸Œæœ›ä¸€æ¡ select  è¯­å¥æ¸…ç©ºç¼“å­˜ã€‚ç±»ä¼¼åœ°ï¼Œä½ å¯èƒ½å¸Œæœ›æŸäº› update è¯­å¥æ‰§è¡Œæ—¶ä¸è¦åˆ·æ–°ç¼“å­˜ã€‚         </p><h4 id="cache-ref"><a href="#cache-ref" class="headerlink" title="cache-ref"></a>cache-ref</h4><p>å¯¹æŸä¸€å‘½åç©ºé—´çš„è¯­å¥ï¼Œåªä¼šä½¿ç”¨è¯¥å‘½åç©ºé—´çš„ç¼“å­˜è¿›è¡Œç¼“å­˜æˆ–åˆ·æ–°ã€‚å¦‚æœæƒ³è¦åœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­å…±äº«ç›¸åŒçš„ç¼“å­˜é…ç½®å’Œå®ä¾‹ã€‚è¦å®ç°è¿™ç§éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨<code>cache-ref</code>å…ƒç´ æ¥å¼•ç”¨å¦ä¸€ä¸ªç¼“å­˜ã€‚å‡å¦‚åœ¨<code>DepartmentMapper.xml</code>ä½¿ç”¨<code>EmployeeMapper.xml</code>é‡Œçš„ç¼“å­˜é…ç½®ï¼Œåˆ™<code>cache-ref</code>çš„<code>namespace</code>å±æ€§æŒ‡å‘<code>EmployeeMapper.xml</code>çš„å‘½åç©ºé—´å³å¯ã€‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache-ref</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.dao.emp.EmployeeMapper<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><br/><p><strong>ç›¸å…³æ–‡ç« ï¼š</strong></p><table><thead><tr><th>æ–‡ç« åç§°</th></tr></thead><tbody><tr><td><a href="b802139a.html">ã€ŠMybatis(ä¸€)ä¸»è¦ç»„ä»¶ã€‹</a></td></tr><tr><td><a href="5d11555a.html">ã€ŠMybatis(äºŒ)é…ç½®ã€‹</a></td></tr><tr><td><a href="d467df29.html">ã€ŠMybatis(ä¸‰)åŠ¨æ€SQLã€‹</a></td></tr><tr><td><a href="3bfa75b5.html">ã€ŠMybtis(å››)å·¥ä½œåŸç†ã€‹</a></td></tr><tr><td><a href="ae8510ea.html">ã€ŠMybtis(äº”)Mapperæ˜ å°„å™¨ã€‹</a></td></tr><tr><td><a href="44c4c800.html">ã€ŠMybtis(å…­)Mapperçº§è”ã€‹</a></td></tr></tbody></table><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybtis(å…­)Mapperçº§è”</title>
      <link href="/posts/44c4c800.html"/>
      <url>/posts/44c4c800.html</url>
      
        <content type="html"><![CDATA[<h2 id="Mybtis-å…­-Mapperçº§è”"><a href="#Mybtis-å…­-Mapperçº§è”" class="headerlink" title="Mybtis(å…­)Mapperçº§è”"></a>Mybtis(å…­)Mapperçº§è”</h2><blockquote><p>åŸæœ¬æ˜¯æ”¾åœ¨æ˜ å°„å™¨å…ƒç´ resultMapæ˜ å°„ç»“æœé›†çš„å†…å®¹ï¼Œå› ä¸ºç¯‡å¹…å¤ªé•¿ï¼Œå•ç‹¬å¦åšä¸€ç¯‡ï¼ŒæŸ¥è¯¢ä¹Ÿæ–¹ä¾¿æŸ¥æ‰¾ã€‚</p></blockquote><p>Mybatisæ˜ å°„å™¨é‡Œçš„resultMapå…ƒç´ ï¼š</p><pre class=" language-txt"><code class="language-txt">1ã€select å…ƒç´ 2ã€resultMapå…ƒç´ 3ã€insert/updateå…ƒç´ 4ã€deleteå…ƒç´ 5ã€sqlå…ƒç´ 5ã€cacheå…ƒç´ </code></pre><p>æœ¬æ–‡ä¸»è¦è¯´æ˜resultMapä¸­çº§è”ä½¿ç”¨</p><p>MyBatisçº§è”ä¸»è¦æœ‰ï¼š</p><p>ï¼ˆ1ï¼‰associationï¼š<code>ä¸€å¯¹ä¸€</code>ã€‚</p><p>ï¼ˆ2ï¼‰collectionï¼š<code>ä¸€å¯¹å¤š</code>ã€‚</p><p>ï¼ˆ3ï¼‰discriminator ï¼šé‰´åˆ«å™¨ã€‚</p><p>ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œå»ºä¸¤å¼ è¡¨ï¼ŒåŸæœ¬æƒ³ç»™å‡ºå»ºè¡¨è„šæœ¬ï¼Œå¥ˆä½•ç³»ç»Ÿé‡è£…äº†ï¼Œæ•°æ®åº“æ²¡æœ‰äº†ã€‚å°±æ ¹æ®æ•°æ®åº“å­—å­—æ®µå»ºä¸€äº›ï¼Œå­—æ®µæ¯”è¾ƒå°‘ä¹Ÿä¸éš¾ã€‚</p><h3 id="ä¸€ã€associationå…³è”"><a href="#ä¸€ã€associationå…³è”" class="headerlink" title="ä¸€ã€associationå…³è”"></a>ä¸€ã€associationå…³è”</h3><p>associationå¯ä»¥è¯´æ˜¯æ¯”è¾ƒç®€å•çš„ä¸€å¯¹ä¸€çº§è”ã€‚</p><p>çº§è”çš„å†™æ³•ä¹Ÿæœ‰ä¸åŒï¼š</p><h4 id="1ã€çº§è”çš„åµŒå¥—ç»“æœæ˜ å°„"><a href="#1ã€çº§è”çš„åµŒå¥—ç»“æœæ˜ å°„" class="headerlink" title="1ã€çº§è”çš„åµŒå¥—ç»“æœæ˜ å°„"></a>1ã€çº§è”çš„åµŒå¥—ç»“æœæ˜ å°„</h4><p>çº§è”çš„åµŒå¥—ç»“æœæ˜ å°„å…¶å®å°±æ˜¯ç›´æ¥æŠŠç»“æœé›†æ˜ å°„å†™åœ¨å¯¹è±¡ä¸­ï¼ŒSQLä½¿ç”¨è”åˆæŸ¥è¯¢æŸ¥å‡ºæ‰€æœ‰æ˜ å°„åˆ—ã€‚ç›´æ¥çœ‹ä¾‹å­ï¼šæŸ¥è¯¢å‘˜å·¥å‘æ—¶å€™è¦æ±‚åŒæ—¶æŸ¥è¯¢å‡ºæ‰€åœ¨çš„éƒ¨é—¨ä¿¡æ¯ã€‚</p><p>javaç±»æœ‰ä¸¤ä¸ªï¼š</p><p>Employeeç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>emp<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">implements</span> <span class="token class-name">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> 6654960072154305288L<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer empId<span class="token punctuation">;</span>    <span class="token keyword">private</span> String empName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String sex<span class="token punctuation">;</span>    <span class="token keyword">private</span> String email<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> did<span class="token punctuation">;</span>    <span class="token keyword">private</span> Department department <span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Employee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token function">Employee</span><span class="token punctuation">(</span>Integer empId<span class="token punctuation">,</span> String empName<span class="token punctuation">,</span> String sex<span class="token punctuation">,</span> String email<span class="token punctuation">,</span><span class="token keyword">int</span> did<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>empId <span class="token operator">=</span> empId<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>empName <span class="token operator">=</span> empName<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>email <span class="token operator">=</span> email<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>did <span class="token operator">=</span> did<span class="token punctuation">;</span>    <span class="token punctuation">}</span>     <span class="token comment" spellcheck="true">// getter setter  toString ...</span><span class="token punctuation">}</span></code></pre><p>Departmentç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>emp<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span>  <span class="token keyword">implements</span> <span class="token class-name">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> 4969741886389350881L<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer deptId<span class="token punctuation">;</span>    <span class="token keyword">private</span> String deptName<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// getter setter  toString ...</span><span class="token punctuation">}</span></code></pre><p>XMLæ˜ å°„å™¨ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>did<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WithDeptResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>department<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Department<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>å¾ˆæ˜æ˜¾è¦æ±‚<code>Employee</code>å¯¹è±¡å­˜åœ¨<code>department</code>ç±»å‹å±æ€§ã€‚</p><p>å¦‚æœ<code>WithDeptResultMap</code>çš„resultMapä¸æƒ³å†™é‚£ä¹ˆå¤šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>extends</code>æ¥å‡å°‘ä»£ç ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>did<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WithDeptResultMap<span class="token punctuation">"</span></span>  <span class="token attr-name">extends</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>department<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Department<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>è¿™æ ·å°±ç›´æ¥æŠŠå…³è”çš„<code>Department</code>å¯¹è±¡å†™åˆ°<code>Employee</code>å¯¹è±¡ä¸­ï¼Œå¯¹åº”çš„<code>SELECT</code>æ ‡ç­¾ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKeyWithDepart<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WithDeptResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      select    e.emp_id, e.emp_name, e.sex, e.email,d.dept_id,d.dept_name    from tbl_emp e    left join tbl_dept d on e.dept_id=d.dept_id    where emp_id = #{empId,jdbcType=INTEGER}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>è¿™æ ·æŸ¥è¯¢çš„æ—¶å€™ç›´æ¥æŸ¥è¯¢ç»“æœé‡Œçš„<code>Department</code>ä¿¡æ¯ä¼šç›´æ¥æ˜ å°„åˆ°<code>Employee</code>çš„<code>department</code>å±æ€§é‡Œã€‚</p><h4 id="2ã€çº§è”çš„åµŒå¥—-Select-æŸ¥è¯¢"><a href="#2ã€çº§è”çš„åµŒå¥—-Select-æŸ¥è¯¢" class="headerlink" title="2ã€çº§è”çš„åµŒå¥— Select æŸ¥è¯¢"></a>2ã€çº§è”çš„åµŒå¥— Select æŸ¥è¯¢</h4><p>å…³è”çš„åµŒå¥— Select æŸ¥è¯¢å…¶å®å°±æ˜¯åˆ©ç”¨å­æŸ¥è¯¢è¿›è¡Œç»“æœå°è£…ã€‚è¿˜æ˜¯æŸ¥è¯¢å‘˜å·¥çš„ä¾‹å­ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>did<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WithDeptResultMap<span class="token punctuation">"</span></span>  <span class="token attr-name">extends</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>department<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Department<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span>  <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectDept<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKeyWithDepart<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WithDeptResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select    e.emp_id, e.emp_name, e.sex, e.email,e.dept_id    from tbl_emp    where emp_id = #{empId,jdbcType=INTEGER}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectDept<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span>  <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Department<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select    *    from tbl_dept    where dept_id = #{dept_id,jdbcType=INTEGER}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>     </code></pre><p>è¿™æ ·å°±å¯ä»¥é€šè¿‡<code>select</code>å­æŸ¥è¯¢æ¥æ˜ å°„<code>department</code>çš„å±æ€§äº†ã€‚</p><p>è¿™ç§æ–¹å¼è™½ç„¶å¾ˆç®€å•ï¼Œä½†åœ¨å¤§å‹æ•°æ®é›†æˆ–å¤§å‹æ•°æ®è¡¨ä¸Šè¡¨ç°ä¸ä½³ã€‚ è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸ºâ€œN+1 æŸ¥è¯¢é—®é¢˜â€ã€‚N+1 æŸ¥è¯¢æ˜¯è¿™æ ·çš„ï¼š         </p><ul><li>ä½ æ‰§è¡Œäº†ä¸€ä¸ªå•ç‹¬çš„ SQL è¯­å¥æ¥è·å–ç»“æœçš„ä¸€ä¸ªåˆ—è¡¨ï¼ˆå°±æ˜¯â€œ+1â€ï¼‰ã€‚</li><li>å¯¹åˆ—è¡¨è¿”å›çš„æ¯æ¡è®°å½•ï¼Œä½ æ‰§è¡Œä¸€ä¸ª select æŸ¥è¯¢è¯­å¥æ¥ä¸ºæ¯æ¡è®°å½•åŠ è½½è¯¦ç»†ä¿¡æ¯ï¼ˆå°±æ˜¯â€œNâ€ï¼‰ã€‚           </li></ul><p>è¿™ä¸ªé—®é¢˜ä¼šå¯¼è‡´æˆç™¾ä¸Šåƒçš„ SQL è¯­å¥è¢«æ‰§è¡Œã€‚ä½†å¸¦æ¥çš„å¥½å¤„æ˜¯ï¼ŒMyBatis èƒ½å¤Ÿå¯¹è¿™æ ·çš„æŸ¥è¯¢è¿›è¡Œå»¶è¿ŸåŠ è½½ï¼Œå› æ­¤å¯ä»¥å°†å¤§é‡è¯­å¥åŒæ—¶è¿è¡Œçš„å¼€é”€åˆ†æ•£å¼€æ¥ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ åŠ è½½è®°å½•åˆ—è¡¨ä¹‹åç«‹åˆ»å°±éå†åˆ—è¡¨ä»¥è·å–åµŒå¥—çš„æ•°æ®ï¼Œå°±ä¼šè§¦å‘æ‰€æœ‰çš„å»¶è¿ŸåŠ è½½æŸ¥è¯¢ï¼Œæ€§èƒ½å¯èƒ½ä¼šå˜å¾—å¾ˆç³Ÿç³•ã€‚ </p><p>æ‰€ä»¥å°½å¯èƒ½æ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯æ¥å†³å®šç”¨å“ªç§æ–¹å¼ï¼Œåœ¨æ•°æ®åˆ—è¾ƒå¤šæˆ–æ•°æ®é›†è¾ƒå¤§æ—¶ä¼˜å…ˆä½¿ç”¨å…³è”çš„åµŒå¥—ç»“æœæ˜ å°„ã€‚å¦‚æœå®é™…éœ€è¦ä½¿ç”¨çš„æ˜¯ä¸€å¼ å¤§è¡¨ï¼Œä½†æ˜¯çœŸæ­£ä½¿ç”¨çš„å¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®ï¼Œå¯ä»¥å•ç‹¬å®šä¹‰ä¸€ä¸ªPOJOæ¥æ˜ å°„ç»“æœé›†ï¼Œ<code>resultMap</code>å…¶å®å¯ä»¥æ ¹æ®POJOå±æ€§æ¥é‡æ–°å®šä¹‰ï¼Œä¹Ÿå¯ä»¥ä¸å†™ï¼Œå› ä¸ºMybatiSå¯ä»¥æ ¹æ®POJOé¢†åŸŸæ¨¡å‹ï¼Œå®Œæˆè‡ªåŠ¨æ˜ å°„ã€‚è¿™æ ·å°±æœ‰äº†ç¬¬ä¸‰ç§æ–¹å¼ï¼Œåˆ©ç”¨POJOåˆ«åè‡ªåŠ¨æ˜ å°„ã€‚</p><h4 id="3ã€åˆ©ç”¨POJOåˆ«åè‡ªåŠ¨æ˜ å°„ã€‚"><a href="#3ã€åˆ©ç”¨POJOåˆ«åè‡ªåŠ¨æ˜ å°„ã€‚" class="headerlink" title="3ã€åˆ©ç”¨POJOåˆ«åè‡ªåŠ¨æ˜ å°„ã€‚"></a>3ã€åˆ©ç”¨POJOåˆ«åè‡ªåŠ¨æ˜ å°„ã€‚</h4><p>è¿˜æ˜¯åˆšæ‰çš„ä¾‹å­ï¼š</p><p>å…ˆçœ‹POJOï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmpInfoVO</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> empId<span class="token punctuation">;</span>    <span class="token keyword">private</span> String empName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String sex <span class="token punctuation">;</span>    <span class="token keyword">private</span> String email<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> did<span class="token punctuation">;</span>    <span class="token keyword">private</span> String deptName<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// getter  and setter</span><span class="token punctuation">}</span></code></pre><p>å†çœ‹XMLï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKeyWithDepart<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WithDeptResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      select    e.emp_id as  empId,     e.emp_name as empName,     e.sex as sex,     e.email as email,    d.dept_id as did,    d.dept_name as department.deptName    from tbl_emp e    left join tbl_dept d on e.dept_id=d.dept_id    where emp_id = #{empId,jdbcType=INTEGER}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåˆ«åè¦å’ŒPOJOçš„å±æ€§å¯¹åº”ã€‚Mybatisé»˜è®¤æ²¡æœ‰å¤§å°å†™æ•æ„Ÿï¼Œä½†æ˜¯æ–¹ä¾¿é˜…è¯»å°½é‡å’ŒPOJOçš„å±æ€§å†™ä¸€è‡´ï¼Œå¦‚æœå¼€å¯äº†é©¼å³°å¼å‘½åè§„èŒƒ</p><p>é‡æ–°å®šä¹‰POJOçš„å¥½å¤„æ˜¯ï¼Œè¦ä½¿ç”¨å“ªäº›å°±ç›´æ¥å®šä¹‰å¥½ï¼Œä¸éœ€è¦æŸ¥è¯¢æ‰€æœ‰å­—æ®µå‡ºæ¥ï¼Œå¯¹äºå¤§è¡¨æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒå®ç”¨çš„ã€‚å¦‚æœä½ ä¸ç¡®å®šæˆ–å°±æ˜¯ä¸æƒ³æ–°å»ºPOJOæˆ–VOæ¥è‡ªåŠ¨æ˜ å°„ï¼Œéå¾—ä½¿ç”¨åŸæœ‰çš„<code>Employee</code>ç±»ï¼Œä¹Ÿå¯ä»¥ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKeyWithDepart<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WithDeptResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      select    e.emp_id as  empId,     e.emp_name as empName,     e.sex as sex,     e.email as email,    d.dept_id as department.deptId,    d.dept_name as department.deptName    from tbl_emp e    left join tbl_dept d on e.dept_id=d.dept_id    where emp_id = #{empId,jdbcType=INTEGER}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>è¿™æ ·å°±å¯ä»¥å®ç°å’Œ<code>Employee</code>ç±»å±æ€§è‡ªåŠ¨æ˜ å°„äº†ã€‚å¯¼èˆªå¼åˆ«åä¹Ÿè¦æ±‚å’ŒPOJOçš„å±æ€§å¯¹åº”ã€‚å¯¼èˆªåˆ«å<code>department.deptName</code>æ˜¯ç‚¹å¼åˆ†éš”ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†å‰²å¦‚ï¼š<code>department_deptName</code>è¿™ç§å†™æ³•ä¹Ÿå¯ä»¥ã€‚</p><h4 id="4ã€å…³è”å¤šç»“æœé›†"><a href="#4ã€å…³è”å¤šç»“æœé›†" class="headerlink" title="4ã€å…³è”å¤šç»“æœé›†"></a>4ã€å…³è”å¤šç»“æœé›†</h4><p>å…³è”çš„å¤šç»“æœé›†ï¼ˆResultSetï¼‰</p><table><thead><tr><th align="left">å±æ€§</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">column</td><td align="left">å½“ä½¿ç”¨å¤šä¸ªç»“æœé›†æ—¶ï¼Œè¯¥å±æ€§æŒ‡å®šç»“æœé›†ä¸­ç”¨äºä¸ <code>foreignColumn</code>  åŒ¹é…çš„åˆ—ï¼ˆå¤šä¸ªåˆ—åä»¥é€—å·éš”å¼€ï¼‰ï¼Œä»¥è¯†åˆ«å…³ç³»ä¸­çš„çˆ¶ç±»å‹ä¸å­ç±»å‹ã€‚</td></tr><tr><td align="left">foreignColumn</td><td align="left">æŒ‡å®šå¤–é”®å¯¹åº”çš„åˆ—åï¼ŒæŒ‡å®šçš„åˆ—å°†ä¸çˆ¶ç±»å‹ä¸­ <code>column</code> çš„ç»™å‡ºçš„åˆ—è¿›è¡ŒåŒ¹é…ã€‚</td></tr><tr><td align="left">resultSet</td><td align="left">æŒ‡å®šç”¨äºåŠ è½½å¤æ‚ç±»å‹çš„ç»“æœé›†åå­—ã€‚</td></tr></tbody></table><p>ä¾‹å¦‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectEmployee<span class="token punctuation">"</span></span> <span class="token attr-name">resultSets</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>employees,depts<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>EmpResult<span class="token punctuation">"</span></span> <span class="token attr-name">statementType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CALLABLE<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  {call getDeptsAndEmplyees(#{id,jdbcType=INTEGER,mode=IN})}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>å¯¹åº”çš„å­˜å‚¨è¿‡ç¨‹é‡Œçš„æŸ¥è¯¢ï¼š</p><pre class=" language-SQL"><code class="language-SQL">SELECT * FROM tbl_dept WHERE dept_id = #{id}SELECT * FROM tbl_emp WHERE emp_id = #{id}</code></pre><p>å¯¹åº”çš„<code>resultMap</code>ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>EmpResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>did<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>department<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Department<span class="token punctuation">"</span></span> <span class="token attr-name">resultSet</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>depts<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">foreignColumn</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>è™½ç„¶ä½¿ç”¨äº†ä¸¤ä¸ªç»“æœé›†ï¼Œå…¶å®æ˜¯æŒ‡å®šä½¿ç”¨ â€œdeptsâ€ ç»“æœé›†çš„æ•°æ®æ¥å¡«å…… â€œdepartmentâ€ å…³è”ã€‚</p><h3 id="äºŒã€collectionçº§è”"><a href="#äºŒã€collectionçº§è”" class="headerlink" title="äºŒã€collectionçº§è”"></a>äºŒã€collectionçº§è”</h3><p>collectionçº§è”ï¼Œé›†åˆçº§è”ã€‚é€šå¸¸å¯¹åº”çš„é›†åˆç±»å‹å±æ€§ï¼Œå¦‚<code>List</code>,<code>Set</code>ç­‰å½¢å¼çš„å±æ€§ã€‚é›†åˆå…ƒç´ å’Œå…³è”å…ƒç´ å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚</p><p>è¿˜æ˜¯ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œä¸€ä¸ªå‘˜å·¥é€šå¸¸åªå±äºä¸€ä¸ªéƒ¨é—¨ï¼Œé‚£ä¹ˆä¸€ä¸ªéƒ¨é—¨å¯ä»¥æœ‰å¾ˆå¤šå‘˜å·¥ã€‚å‡è®¾ç°åœ¨éœ€è¦æ ¹æ®éƒ¨é—¨æŸ¥è¯¢å‘˜å·¥ï¼Œé¦–å…ˆåœ¨<code>Department</code>ç±»ä¸­æ·»åŠ å‘˜å·¥é›†åˆï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span>  <span class="token keyword">implements</span> <span class="token class-name">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> Integer deptId<span class="token punctuation">;</span>    <span class="token keyword">private</span> String deptName<span class="token punctuation">;</span>    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> empList<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//setter getter tostring ...</span><span class="token punctuation">}</span></code></pre><p>ç„¶ååœ¨æ˜ å°„å™¨ä¸­æ˜ å°„åµŒå¥—ç»“æœé›†åˆåˆ°ä¸€ä¸ª List ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é›†åˆå…ƒç´ <code>collection</code>ã€‚ </p><h4 id="1ã€é›†åˆçº§è”åµŒå¥—Select"><a href="#1ã€é›†åˆçº§è”åµŒå¥—Select" class="headerlink" title="1ã€é›†åˆçº§è”åµŒå¥—Select"></a>1ã€é›†åˆçº§è”åµŒå¥—Select</h4><p>å…ˆçœ‹XML</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Department<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empList<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ArrayList<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_Id<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectEmpsForDept<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectDept<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptResult<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM tbl_dept WHERE dept_Id = #{id}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectEmpsForDept<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM tbl_emp WHERE dept_Id = #{id}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>é›†åˆå…ƒç´ ä¸­æœ‰ä¸€ä¸ªæ–°çš„ â€œofTypeâ€ å±æ€§ã€‚è¿™ä¸ªå±æ€§éå¸¸é‡è¦ï¼Œå®ƒç”¨æ¥å°† JavaBeanï¼ˆæˆ–å­—æ®µï¼‰å±æ€§çš„ç±»å‹å’Œé›†åˆå­˜å‚¨çš„ç±»å‹åŒºåˆ†å¼€æ¥ã€‚ æ‰€ä»¥ä½ å¯ä»¥æŒ‰ç…§ä¸‹é¢è¿™æ ·æ¥é˜…è¯»æ˜ å°„ï¼š </p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empList<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ArrayList<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_Id<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectEmpsForDept<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><p>å«ä¹‰æ˜¯ï¼š â€œ<code>empList</code>æ˜¯ä¸€ä¸ªå­˜å‚¨ <code>com.ssm.web.demo.entity.emp.Employee</code>çš„ <code>ArrayList</code>é›†åˆâ€ ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒMyBatis å¯ä»¥æ¨æ–­ javaType å±æ€§ï¼Œå› æ­¤å¯ä»¥ä¸éœ€è¦å¡«å†™ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™ä½ å¯ä»¥ç®€ç•¥æˆï¼š         </p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empList<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_Id<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectEmpsForDept<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre><h4 id="2ã€é›†åˆçš„åµŒå¥—ç»“æœæ˜ å°„"><a href="#2ã€é›†åˆçš„åµŒå¥—ç»“æœæ˜ å°„" class="headerlink" title="2ã€é›†åˆçš„åµŒå¥—ç»“æœæ˜ å°„"></a>2ã€é›†åˆçš„åµŒå¥—ç»“æœæ˜ å°„</h4><p>é›†åˆçš„åµŒå¥—ç»“æœæ˜ å°„å’Œçº§è”çš„åµŒå¥—ç»“æœæ˜ å°„ç±»ä¼¼ï¼Œå°±æ˜¯å¤šäº†ä¸€ä¸ª<code>ofType</code>å±æ€§ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Department<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empList<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectDepart<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptResult<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      select    d.dept_id as deptId,    d.dept_name as deptNameï¼Œ    e.emp_id as  empId,     e.emp_name as empName,     e.sex as sex,     e.email as email    from tbl_dept d    left join tbl_emp e on e.dept_id=d.dept_id    where d.tbl_dept = #{deptId,jdbcType=INTEGER}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>å¦‚æœå¸Œæœ›æ›´ç»†èŠ‚åŒ–ã€å¯é‡ç”¨ä¹Ÿå¯ä»¥æ‹†å¼€äº†å†™ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Department<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empList<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptEmpsResult<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptEmpsResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘å‘½åçš„æ—¶å€™æ²¡æœ‰è§„èŒƒåŒ–ï¼Œå¦‚æœè¿›è¡Œè§„èŒƒåŒ–å‘½åï¼Œå¯ä»¥æŒ‡å®šå‰ç¼€å±æ€§ï¼š<code>columnPrefix</code></p><pre class=" language-xml"><code class="language-xml"> &lt;collection property="empList" ofType="com.ssm.web.demo.entity.emp.Employee" resultMap="deptEmpsResult"  columnPrefix="Emp_"`/></code></pre><p>è¿™æ ·å¯¹åº”çš„<code>id=&quot;deptEmpsResult&quot;</code>çš„<code>resultMap</code>é‡Œçš„<code>column</code>çš„å€¼å°±å¯ä»¥çœç•¥å‰ç¼€ã€‚</p><h4 id="3ã€é›†åˆçš„å¤šç»“æœé›†"><a href="#3ã€é›†åˆçš„å¤šç»“æœé›†" class="headerlink" title="3ã€é›†åˆçš„å¤šç»“æœé›†"></a>3ã€é›†åˆçš„å¤šç»“æœé›†</h4><p>å’Œå…³è”å…ƒç´ é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹å®ç°ï¼Œå®ƒä¼šæ‰§è¡Œä¸¤ä¸ªæŸ¥è¯¢å¹¶è¿”å›ä¸¤ä¸ªç»“æœé›†ï¼Œåœ¨æ˜ å°„è¯­å¥ä¸­ï¼Œå¿…é¡»é€šè¿‡ <code>resultSets</code> å±æ€§ä¸ºæ¯ä¸ªç»“æœé›†æŒ‡å®šä¸€ä¸ªåå­—ï¼Œå¤šä¸ªåå­—ä½¿ç”¨é€—å·éš”å¼€ã€‚ </p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectDepart<span class="token punctuation">"</span></span> <span class="token attr-name">resultSets</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>depts,emps<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DeptResult<span class="token punctuation">"</span></span> <span class="token attr-name">statementType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CALLABLE<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  {call getDeptsAndEmplyees(#{id,jdbcType=INTEGER,mode=IN})}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>å¯¹åº”çš„å­˜å‚¨è¿‡ç¨‹é‡Œçš„æŸ¥è¯¢ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl_dept <span class="token keyword">WHERE</span> dept_id <span class="token operator">=</span> <span class="token comment" spellcheck="true">#{id}</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl_emp <span class="token keyword">WHERE</span> emp_id <span class="token operator">=</span> <span class="token comment" spellcheck="true">#{id}</span></code></pre><p>å¯¹åº”çš„<code>resultMap</code>ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DeptResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Department<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deptName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empList<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span> <span class="token attr-name">resultSet</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emps<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">foreignColumn</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>did<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p><code>ofType</code>çš„å«ä¹‰æ˜¯æŒ‡å®š â€œempListâ€ é›†åˆå°†ä¼šä½¿ç”¨å­˜å‚¨åœ¨ â€œempsâ€ ç»“æœé›†ä¸­çš„æ•°æ®è¿›è¡Œå¡«å……ã€‚  </p><p>å…³è”æˆ–é›†åˆçš„æ˜ å°„ï¼Œå¹¶æ²¡æœ‰æ·±åº¦ã€å¹¿åº¦æˆ–ç»„åˆä¸Šçš„è¦æ±‚ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­æ˜ å°„æ—¶è¦ç•™æ„æ€§èƒ½é—®é¢˜ã€‚ </p><h3 id="ä¸‰ã€discriminator-çº§è”"><a href="#ä¸‰ã€discriminator-çº§è”" class="headerlink" title="ä¸‰ã€discriminator çº§è”"></a>ä¸‰ã€discriminator çº§è”</h3><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discriminator</span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DraftPost<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discriminator</span><span class="token punctuation">></span></span></code></pre><p>é‰´åˆ«å™¨çš„æ¦‚å¿µå¾ˆå¥½ç†è§£â€”â€”å®ƒå¾ˆåƒ Java è¯­è¨€ä¸­çš„ switch è¯­å¥ã€‚ </p><p>æœ‰æ—¶å€™ï¼Œä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢å¯èƒ½ä¼šè¿”å›å¤šä¸ªä¸åŒçš„ç»“æœé›†ï¼ˆä½†æ€»ä½“ä¸Šè¿˜æ˜¯æœ‰ä¸€å®šçš„è”ç³»çš„ï¼‰ã€‚ é‰´åˆ«å™¨ï¼ˆdiscriminatorï¼‰å…ƒç´ å°±æ˜¯è¢«è®¾è®¡æ¥åº”å¯¹è¿™ç§æƒ…å†µçš„ï¼Œå¦å¤–ä¹Ÿèƒ½å¤„ç†å…¶å®ƒæƒ…å†µï¼Œä¾‹å¦‚ç±»çš„ç»§æ‰¿å±‚æ¬¡ç»“æ„ã€‚ </p><p>ä¸€ä¸ªé‰´åˆ«å™¨çš„å®šä¹‰éœ€è¦æŒ‡å®š column å’Œ javaType å±æ€§ã€‚column æŒ‡å®šäº† MyBatis æŸ¥è¯¢è¢«æ¯”è¾ƒå€¼çš„åœ°æ–¹ã€‚ è€Œ javaType ç”¨æ¥ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç›¸ç­‰æµ‹è¯•ï¼ˆè™½ç„¶å¾ˆå¤šæƒ…å†µä¸‹å­—ç¬¦ä¸²çš„ç›¸ç­‰æµ‹è¯•éƒ½å¯ä»¥å·¥ä½œï¼‰ã€‚ä¾‹å¦‚ï¼š </p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vehicleResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Vehicle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vin<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vin<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>year<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>year<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>make<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>make<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>model<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>model<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discriminator</span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vehicle_type<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>carResult<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>truckResult<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vanResult<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>suvResult<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discriminator</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒMyBatis ä¼šä»ç»“æœé›†ä¸­å¾—åˆ°æ¯æ¡è®°å½•ï¼Œç„¶åæ¯”è¾ƒå®ƒçš„ vehicle type å€¼ã€‚ å¦‚æœå®ƒåŒ¹é…ä»»æ„ä¸€ä¸ªé‰´åˆ«å™¨çš„ caseï¼Œå°±ä¼šä½¿ç”¨è¿™ä¸ª case æŒ‡å®šçš„ç»“æœæ˜ å°„ã€‚ è¿™ä¸ªè¿‡ç¨‹æ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‰©ä½™çš„ç»“æœæ˜ å°„å°†è¢«å¿½ç•¥ï¼ˆé™¤éå®ƒæ˜¯æ‰©å±•çš„ï¼Œæˆ‘ä»¬å°†åœ¨ç¨åè®¨è®ºå®ƒï¼‰ã€‚ å¦‚æœä¸èƒ½åŒ¹é…ä»»ä½•ä¸€ä¸ª caseï¼ŒMyBatis å°±åªä¼šä½¿ç”¨é‰´åˆ«å™¨å—å¤–å®šä¹‰çš„ç»“æœæ˜ å°„ã€‚ æ‰€ä»¥ï¼Œå¦‚æœ carResult çš„å£°æ˜å¦‚ä¸‹ï¼š         </p><pre><code>&lt;resultMap id=&quot;carResult&quot; type=&quot;Car&quot;&gt;  &lt;result property=&quot;doorCount&quot; column=&quot;door_count&quot; /&gt;&lt;/resultMap&gt;</code></pre><p>é‚£ä¹ˆåªæœ‰ doorCount å±æ€§ä¼šè¢«åŠ è½½ã€‚å¦‚æœå¸Œæœ›å‰©ä½™çš„å±æ€§ä¹Ÿèƒ½è¢«åŠ è½½ï¼Œä½¿ç”¨<code>extends</code>å±æ€§å¯ä»¥å®ç° ã€‚         </p><pre><code>&lt;resultMap id=&quot;carResult&quot; type=&quot;Car&quot; extends=&quot;vehicleResult&quot;&gt;  &lt;result property=&quot;doorCount&quot; column=&quot;door_count&quot; /&gt;&lt;/resultMap&gt;</code></pre><p>ç°åœ¨ vehicleResult å’Œ carResult çš„å±æ€§éƒ½ä¼šè¢«åŠ è½½äº†ã€‚         </p><p>ç®€æ´å®Œæ•´å†™æ³•:</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vehicleResult<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Vehicle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vin<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vin<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>year<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>year<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>make<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>make<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>model<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>model<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discriminator</span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vehicle_type<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>carResult<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>doorCount<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>door_count<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>case</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>truckResult<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>boxSize<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box_size<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>extendedCab<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>extended_cab<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>case</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vanResult<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>powerSlidingDoor<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>power_sliding_door<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>case</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>case</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>suvResult<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>allWheelDrive<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>all_wheel_drive<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>case</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discriminator</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre><p>è¿™äº›éƒ½æ˜¯ç»“æœæ˜ å°„ï¼Œå¦‚æœä½ å®Œå…¨ä¸è®¾ç½®ä»»ä½•çš„ result å…ƒç´ ï¼ŒMyBatis å°†ä¸ºä½ è‡ªåŠ¨åŒ¹é…åˆ—å’Œå±æ€§ã€‚ éœ€è¦æ³¨æ„å®é™…ä½¿ç”¨åœºæ™¯ã€‚</p><br/><p><strong>ç›¸å…³æ–‡ç« ï¼š</strong></p><table><thead><tr><th>æ–‡ç« åç§°</th></tr></thead><tbody><tr><td><a href="b802139a.html">ã€ŠMybatis(ä¸€)ä¸»è¦ç»„ä»¶ã€‹</a></td></tr><tr><td><a href="5d11555a.html">ã€ŠMybatis(äºŒ)é…ç½®ã€‹</a></td></tr><tr><td><a href="d467df29.html">ã€ŠMybatis(ä¸‰)åŠ¨æ€SQLã€‹</a></td></tr><tr><td><a href="3bfa75b5.html">ã€ŠMybtis(å››)å·¥ä½œåŸç†ã€‹</a></td></tr><tr><td><a href="ae8510ea.html">ã€ŠMybtis(äº”)Mapperæ˜ å°„å™¨ã€‹</a></td></tr><tr><td><a href="44c4c800.html">ã€ŠMybtis(å…­)Mapperçº§è”ã€‹</a></td></tr></tbody></table><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</title>
      <link href="/posts/caf66d5e.html"/>
      <url>/posts/caf66d5e.html</url>
      
        <content type="html"><![CDATA[<h2 id="Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†"><a href="#Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†" class="headerlink" title="Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†"></a>Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</h2><p>æœ¬æ–‡ä¸»è¦å†…å®¹ï¼š</p><p>Hexoåšå®¢åœ¨ç½‘é¡µæ·»åŠ live2dã€‚</p><blockquote><p>æ·»åŠ ä¸»è¦æœ‰2ç§æ–¹å¼ï¼š<br>ï¼ˆ1ï¼‰ä½¿ç”¨hexoæ’ä»¶ï¼›ä½¿ç”¨è¯¥ç§æ–¹å¼æ·»åŠ ï¼Œéœ€è¦é€‰æ‹©æŸä¸€æ ·æ¨¡å‹ï¼Œä»…æ˜¾ç¤ºlive2dï¼Œæ— æç¤ºè¯­ã€æ— ä¸€è¨€ã€ä»Šæ—¥è¯—è¯ç­‰é™„åŠ åŠŸèƒ½ã€‚<br>ï¼ˆ2ï¼‰æ‰‹åŠ¨æ·»åŠ ; ä½¿ç”¨è¯¥ç§æ–¹å¼æ·»åŠ ï¼Œæ˜¾ç¤ºlive2dï¼Œå¯ä»¥åˆ‡æ¢æ¨¡å‹ã€çš®è‚¤ï¼Œæœ‰æç¤ºè¯­ã€ä¸€è¨€ã€ä»Šæ—¥è¯—è¯ç­‰é™„åŠ åŠŸèƒ½ã€‚<br>ï¼ˆ3ï¼‰å°†æ‰‹åŠ¨æ·»åŠ å¹¶å…¥materyä¸»é¢˜æ’ä»¶åŒ–ã€‚</p></blockquote><p><font coloer="red"><strong>ç‰¹åˆ«è¯´æ˜ï¼š</strong></font><br>å¦‚æœä½ æ—¢æƒ³å®‰è£…Hexoçš„Live2dæ’ä»¶ï¼Œåˆæƒ³æ‰‹åŠ¨å¼•å…¥çš„æ–¹å¼æ·»åŠ ï¼Œä¸ºäº†é˜²æ­¢é€ æˆä¸å¯é¢„çŸ¥å†²çªï¼Œæˆ‘ä¸å»ºè®®è¿™ä¹ˆåšã€‚å¦‚æœä¸€å®šè¦å°è¯•ï¼Œä¹Ÿå¯ä»¥æ‘¸ç´¢ä¸€ä¸‹ï¼Œæˆ‘æ²¡æœ‰è¯•è¿‡2ä¸ªlive2dåŒæ—¶æ˜¾ç¤ºï¼Œæœ‰å…´è¶£å¯ä»¥è¯•è¯•ï¼Œæ¯•ç«Ÿè¿™æ ·ä½ å°±å¯ä»¥æœ‰ä¸¤ä¸ªè€å©†äº†~</p><p>æœ¬æ–‡ä¸»è¦å›´ç»•ä»¥ä¸Šä¸‰ç‚¹ä»‹ç»ã€‚æ„Ÿè°¢<code>Tokisaki Galaxy</code>æç¤ºè¡¥å……ä¼˜ç¼ºç‚¹ä»‹ç»ã€‚</p><p>å¦‚æœä½ è¦è¿›è¡Œæ“ä½œï¼Œä¸‰é€‰ä¸€å°±è¡Œï¼Œä¸è¦ä»å¤´åˆ°å°¾ä¸€é¡¿æ“ä½œã€‚éè¦è¿™æ ·ä¹Ÿè¡Œï¼Œæœ‰ä¸¤ä¸ªè€å©†åŠ è½½è¶…çº§æ…¢å’¯~</p><h3 id="ä¸€ã€ä½¿ç”¨Hexoæ’ä»¶"><a href="#ä¸€ã€ä½¿ç”¨Hexoæ’ä»¶" class="headerlink" title="ä¸€ã€ä½¿ç”¨Hexoæ’ä»¶"></a>ä¸€ã€ä½¿ç”¨Hexoæ’ä»¶</h3><h4 id="1ã€å®‰è£…æ’ä»¶"><a href="#1ã€å®‰è£…æ’ä»¶" class="headerlink" title="1ã€å®‰è£…æ’ä»¶"></a>1ã€å®‰è£…æ’ä»¶</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save hexo-helper-live2d</code></pre><h4 id="2ã€æ·»åŠ é…ç½®"><a href="#2ã€æ·»åŠ é…ç½®" class="headerlink" title="2ã€æ·»åŠ é…ç½®"></a>2ã€æ·»åŠ é…ç½®</h4><p>hexoçš„é…ç½®æ–‡ä»¶<code>_config.yml</code>ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®:</p><pre class=" language-yml"><code class="language-yml">live2d:  enable: true  scriptFrom: local  pluginRootPath: live2dw/  pluginJsPath: lib/  pluginModelPath: assets/  tagMode: false  debug: false  model:    use: live2d-widget-model-shizuku  display:    position: right    width: 150    height: 300  mobile:    show: true</code></pre><p>å¦‚æœè¦çœ‹æ›´ç»†èŠ‚çš„é…ç½®ï¼ŒåŸæ’ä»¶åœ¨è¿™é‡Œ<a href="https://github.com/EYHN/hexo-helper-live2d/blob/master/README.zh-CN.md" target="_blank" rel="noopener">hexo-helper-live2d</a></p><h4 id="3ã€å®‰è£…æ¨¡å‹"><a href="#3ã€å®‰è£…æ¨¡å‹" class="headerlink" title="3ã€å®‰è£…æ¨¡å‹"></a>3ã€å®‰è£…æ¨¡å‹</h4><p>å®‰è£…ä¹‹åé€‰æ‹©å–œæ¬¢çš„æ¨¡å‹ï¼š</p><pre class=" language-bash"><code class="language-bash">use <span class="token function">npm</span> <span class="token function">install</span> --save live2d-widget-model-hibiki</code></pre><p>å¯é€‰æ¨¡å‹ï¼š</p><p>éœ€è¦æ³¨æ„çš„æ˜¯<code>live2d-widget-model-haru</code>ä¸‹é¢æœ‰ä¸¤ä¸ªï¼Œè¦å°å¿ƒã€‚</p><pre><code>live2d-widget-model-chitoselive2d-widget-model-epsilon2_1live2d-widget-model-gflive2d-widget-model-harulive2d-widget-model-harutolive2d-widget-model-hibikilive2d-widget-model-hijikilive2d-widget-model-izumilive2d-widget-model-koharulive2d-widget-model-mikulive2d-widget-model-ni-jlive2d-widget-model-nicolive2d-widget-model-nietzschelive2d-widget-model-nipsilonlive2d-widget-model-nitolive2d-widget-model-shizukulive2d-widget-model-tororolive2d-widget-model-tsumikilive2d-widget-model-unitychanlive2d-widget-model-wankolive2d-widget-model-z16</code></pre><p>å¦‚æœä½ ä¸æƒ³æŒ¨ä¸ªè¯•ï¼Œå¯ä»¥æŸ¥çœ‹æ¨¡å‹é¢„è§ˆï¼š</p><p><a href="https://huaji8.top/post/live2d-plugin-2.0/" target="_blank" rel="noopener">æ¨¡å‹é¢„è§ˆç‚¹è¿™é‡Œ</a></p><h3 id="äºŒã€æ‰‹åŠ¨å®‰è£…"><a href="#äºŒã€æ‰‹åŠ¨å®‰è£…" class="headerlink" title="äºŒã€æ‰‹åŠ¨å®‰è£…"></a>äºŒã€æ‰‹åŠ¨å®‰è£…</h3><p>æ‰‹åŠ¨å®‰è£…æ˜¯æ¯”è¾ƒé€šç”¨åŠæ³•ï¼Œæ— æ‰€è°“æ˜¯hexoæˆ–è€…å…¶ä»–çš„æ¶æ„ã€‚</p><h4 id="1ã€ä¸‹è½½æ¨¡å‹ç­‰æ–‡ä»¶"><a href="#1ã€ä¸‹è½½æ¨¡å‹ç­‰æ–‡ä»¶" class="headerlink" title="1ã€ä¸‹è½½æ¨¡å‹ç­‰æ–‡ä»¶"></a>1ã€ä¸‹è½½æ¨¡å‹ç­‰æ–‡ä»¶</h4><p><a href="https://github.com/fghrsh/live2d_demo" target="_blank" rel="noopener">GitHubå®˜æ–¹æºç ä¸‹è½½</a></p><p>å¦‚æœä½ ä¸‹è½½ä¸äº†ï¼Œè¿™é‡Œæä¾›<a href="https://pan.baidu.com/s/1Ep4DhB6H6Aeb1Nio7maxYw" target="_blank" rel="noopener">ç™¾åº¦äº‘é“¾æ¥ä¸‹è½½</a></p><p>æå–ç ï¼šot85</p><h4 id="2ã€æ·»åŠ åˆ°ç½‘ç«™ç›®å½•"><a href="#2ã€æ·»åŠ åˆ°ç½‘ç«™ç›®å½•" class="headerlink" title="2ã€æ·»åŠ åˆ°ç½‘ç«™ç›®å½•"></a>2ã€æ·»åŠ åˆ°ç½‘ç«™ç›®å½•</h4><p>å°†assetsæ–‡ä»¶å¤¹è§£å‹ä½ ç½‘ç«™ç›®å½•ã€‚<br>å¦‚è·¯å¾„ä¸ºï¼š<code>D:\hexo\public\live2d\assets\</code></p><h4 id="3ã€é¡µé¢å¼•å…¥"><a href="#3ã€é¡µé¢å¼•å…¥" class="headerlink" title="3ã€é¡µé¢å¼•å…¥"></a>3ã€é¡µé¢å¼•å…¥</h4><p>é¡µé¢å¼•å…¥æ–¹å¼æœ‰ä¸‰ç§ï¼Œä»»é€‰å…¶ä¸€å³å¯ã€‚</p><p>ï¼ˆ1ï¼‰æ™®é€šæ–¹å¼å¼•å…¥</p><pre><code>åœ¨ &quot;&lt;/head&gt;&quot; å‰å¼•å…¥ waifu.css æ ·å¼è¡¨   åœ¨ &quot;&lt;/body&gt;&quot; å‰å¼•å…¥ waifu-tips.js å’Œ live2d.jsåœ¨ &quot;&lt;/body&gt;&quot; å‰æ’å…¥ åˆå§‹åŒ– JSï¼Œå¯åœ¨ åˆå§‹åŒ–å‰ è®¾ç½®å‚æ•°</code></pre><p>å¦‚ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        Â· Â· Â·   Â· Â· Â·    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://www.domain.com/live2d/assets/waifu.css<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        Â· Â· Â·   Â· Â· Â·    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>waifu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>waifu-tips<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>live2d<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>live2d<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>waifu-tool<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-home<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-chat<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-eye<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-user<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-photo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-info-circle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-cross<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://www.domain.com/live2d/assets/waifu-tips.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://www.domain.com/live2d/assets/live2d.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">        live2d_settings<span class="token punctuation">[</span><span class="token string">'modelId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        live2d_settings<span class="token punctuation">[</span><span class="token string">'modelTexturesId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">87</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> waifuTips <span class="token operator">=</span> <span class="token string">"https://www.domain.com/live2d/assets/waifu-tips.json"</span><span class="token punctuation">;</span>        <span class="token function">initModel</span><span class="token punctuation">(</span>waifuTips<span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>ï¼ˆ2ï¼‰autoload.js å¼•å…¥<br> å¯ä»¥åœ¨é¡µé¢æœ€ä¸‹åº•æˆ–footå…ƒç´ é‡Œå¼•å…¥<code>autoload.js</code>å³å¯ã€‚</p><p>ï¼ˆ3ï¼‰ç›´æ¥åµŒå…¥åˆ°é¡µé¢</p><p> ä»£ç è¾ƒå¤šï¼Œä¸‹è½½åæœ‰ä¸‰ä¸ªå¼•å…¥ç¤ºä¾‹ï¼Œå¯ä»¥å‚è€ƒå¼•å…¥ç¤ºä¾‹ã€‚</p><h4 id="3ã€å®šåˆ¶ä¸ªæ€§åŒ–"><a href="#3ã€å®šåˆ¶ä¸ªæ€§åŒ–" class="headerlink" title="3ã€å®šåˆ¶ä¸ªæ€§åŒ–"></a>3ã€å®šåˆ¶ä¸ªæ€§åŒ–</h4><p>ä¿®æ”¹ waifu-tips.js é¡¶éƒ¨çš„è®¾ç½®å‚æ•°(æˆ–åˆå§‹åŒ–å‰è®¾ç½®)ï¼Œå‡æœ‰æ³¨é‡Šï¼Œçœ‹æ³¨é‡Šå³å¯ç†è§£æ„æ€ï¼Œä¸è¡Œå°±æ”¹è¿‡ç„¶åè¿è¡Œçœ‹æ•ˆæœã€‚</p><p>ä¿®æ”¹ waifu-tips.jsonï¼Œå®šåˆ¶live2dçš„æç¤ºè¯­ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹æˆä¸ªæ€§åŒ–æç¤ºè¯­ã€‚</p><p>åœ¨é¡µé¢åˆ‡æ¢æ¨¡å‹ä¹‹åå¦‚æœæœ‰å–œæ¬¢çš„å°±F12ï¼Œçœ‹çœ‹åˆ†ç»„idå’Œæ¨¡å‹id<br>live2d_settings[â€˜modelIdâ€™] = 1;<br>live2d_settings[â€˜modelTexturesIdâ€™] = 87;</p><p>è¿˜æœ‰ä¸€ä¸ªå‚æ•°ä½¿ç”¨éœ€è¦æ³¨æ„ï¼š</p><p>live2d_settings[â€˜waifuDraggableâ€™] =â€™disableâ€™ï¼›</p><p>æ‹–æ‹½æ ·å¼ï¼Œå¯é€‰ â€˜disableâ€™ (ç¦ç”¨)ï¼Œâ€™axis-xâ€™ (åªèƒ½æ°´å¹³æ‹–æ‹½)ï¼Œâ€™unlimitedâ€™ (è‡ªç”±æ‹–æ‹½)ï¼Œå¦‚æœæƒ³è¦è‡ªç”±æ‹–æ‹½ï¼Œéœ€è¦å¼•å…¥jquery-uiè„šæ­¥ï¼Œ<code>jquery-ui.js</code>æˆ–å‹ç¼©ç‰ˆ<code>jquery-ui.min.js</code></p><h3 id="ä¸‰ã€Materyä¸‹æ‰‹åŠ¨æ’ä»¶åŒ–"><a href="#ä¸‰ã€Materyä¸‹æ‰‹åŠ¨æ’ä»¶åŒ–" class="headerlink" title="ä¸‰ã€Materyä¸‹æ‰‹åŠ¨æ’ä»¶åŒ–"></a>ä¸‰ã€Materyä¸‹æ‰‹åŠ¨æ’ä»¶åŒ–</h3><p>å‰æï¼šæ‰‹åŠ¨å®‰è£…æ–¹å¼ä¸­ä¸‹è½½äº†æºç ï¼Œå°†ä»£ç æ”¾åˆ°ä¸»é¢˜ç›®å½•ä¸‹ã€‚å¦‚æ”¾ç½®åˆ°ï¼š<code>/source/js/live2d_assets/</code>,ä¸‹é¢çš„å¼•å…¥ï¼Œä»¥æ­¤è·¯å¾„ä¸ºä¾‹ã€‚</p><p>è¯´æ˜¯Materyä¸»é¢˜ï¼Œå…¶å®å…¶ä»–ä¸»é¢˜åŸç†ä¸€æ ·ã€‚ä¸ºäº†å°†æ‰‹åŠ¨æ–¹å¼æ’ä»¶åŒ–ï¼Œä¹Ÿè®¾ç½®ä¸€ä¸ªå¯åŠ¨å¼€å…³ã€‚</p><h4 id="1ã€å¢åŠ live2dé…ç½®"><a href="#1ã€å¢åŠ live2dé…ç½®" class="headerlink" title="1ã€å¢åŠ live2dé…ç½®"></a>1ã€å¢åŠ live2dé…ç½®</h4><p>åœ¨ä¸»é¢˜ç›®å½•çš„<code>_config.yml</code> ä¸­å¢åŠ ï¼š</p><pre class=" language-yml"><code class="language-yml">live2d:  enable: true</code></pre><p><code>true</code>è¡¨ç¤ºå¯ç”¨äºŒæ¬¡å…ƒè€å©†ï¼Œ<code>false</code>è¡¨ç¤ºä¸å¯ç”¨äºŒæ¬¡å…ƒè€å©†ã€‚</p><h4 id="2ã€å¤´éƒ¨å¼•å…¥CSSæ–‡ä»¶"><a href="#2ã€å¤´éƒ¨å¼•å…¥CSSæ–‡ä»¶" class="headerlink" title="2ã€å¤´éƒ¨å¼•å…¥CSSæ–‡ä»¶"></a>2ã€å¤´éƒ¨å¼•å…¥CSSæ–‡ä»¶</h4><p>å› ä¸ºCSSæ–‡ä»¶ä¸€èˆ¬åœ¨å¤´éƒ¨å¼•å…¥ï¼Œåœ¨<code>layout/_partial</code>ç›®å½•æ‰¾åˆ°<code>head.ejs</code>,æ·»åŠ live2dçš„æ ·å¼æ–‡ç« <code>waifu.css</code>,å› ä¸ºæœ‰äº†å¼€å…³ï¼Œå¯ä»¥æ ¹æ®å¼€å…³æ˜¯å¦å¼•å…¥<code>waifu.css</code>æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><p>(ejsä»£ç å—ä¸èƒ½æ˜¾ç¤ºï¼Œæ‰€ä»¥æ”¹ç”¨htmlä»£ç å—ï¼Œä¸å½±å“å¤åˆ¶)</p><pre class=" language-html"><code class="language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">if</span> <span class="token attr-name">(theme.live2d</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">theme.live2d.enable)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;%- theme.jsDelivr.url %<span class="token punctuation">></span>&lt;%- url_for(<span class="token punctuation">'</span>/js/live2d_assets/waifu.css<span class="token punctuation">'</span>) %<span class="token punctuation">></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">}</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span></code></pre><h4 id="3ã€å¢åŠ æ¨¡å—æ–‡ä»¶"><a href="#3ã€å¢åŠ æ¨¡å—æ–‡ä»¶" class="headerlink" title="3ã€å¢åŠ æ¨¡å—æ–‡ä»¶"></a>3ã€å¢åŠ æ¨¡å—æ–‡ä»¶</h4><p>åœ¨<code>layout/_partial</code>ç›®å½•æ–°å»º<code>live2d.ejs</code>,å†…å®¹å¦‚ä¸‹ï¼š</p><p>(ejsä»£ç å—ä¸èƒ½æ˜¾ç¤ºï¼Œæ‰€ä»¥æ”¹ç”¨htmlä»£ç å—ï¼Œä¸å½±å“å¤åˆ¶)</p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- waifu-tips.js ä¾èµ– JQuery åº“  å¤´éƒ¨å·²ç»å¼•ç”¨äº†JQueryï¼Œæ­¤å¤„ä¸å¼•å…¥--></span><span class="token comment" spellcheck="true">&lt;!-- å®ç°æ‹–åŠ¨æ•ˆæœï¼Œéœ€å¼•å…¥ JQuery UI --></span>&lt;script src="<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">theme.jsDelivr.url</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> <span class="token function">url_for</span><span class="token punctuation">(</span><span class="token string">'/js/jquery-ui.min.js'</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">></span>"<span class="token operator">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>waifu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>waifu-tips<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>live2d<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>live2d<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>waifu-tool<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-home<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-chat<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-eye<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-user<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-photo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-info-circle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fui-cross<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>&lt;script src="<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">theme.jsDelivr.url</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> <span class="token function">url_for</span><span class="token punctuation">(</span><span class="token string">'/js/live2d_assets/waifu-tips.js'</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">></span>"<span class="token operator">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>&lt;script src="<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%-</span> <span class="token attr-name">theme.jsDelivr.url</span> <span class="token attr-name">%</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> <span class="token function">url_for</span><span class="token punctuation">(</span><span class="token string">'/js/live2d_assets/live2d.js'</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">></span>"<span class="token operator">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">    live2d_settings<span class="token punctuation">[</span><span class="token string">'modelId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    live2d_settings<span class="token punctuation">[</span><span class="token string">'modelTexturesId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">87</span><span class="token punctuation">;</span>     <span class="token keyword">var</span> waifuTips <span class="token operator">=</span> <span class="token string">"&lt;%- theme.jsDelivr.url %>&lt;%- url_for('/js/live2d_assets/waifu-tips.json') %>"</span><span class="token punctuation">;</span>    <span class="token function">initModel</span><span class="token punctuation">(</span>waifuTips<span class="token punctuation">)</span> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h4 id="4ã€å¼•å…¥æ¨¡å—ä½¿ç”¨"><a href="#4ã€å¼•å…¥æ¨¡å—ä½¿ç”¨" class="headerlink" title="4ã€å¼•å…¥æ¨¡å—ä½¿ç”¨"></a>4ã€å¼•å…¥æ¨¡å—ä½¿ç”¨</h4><p>åœ¨ä½ æƒ³å±•ç¤ºäºŒæ¬¡å…ƒè€å©†çš„é¡µé¢çš„æœ«å°¾å¢åŠ ä»¥ä¸‹ä»£ç ï¼š</p><pre class=" language-ejs"><code class="language-ejs"><% if (theme.live2d.enable) { %>    <%- partial('_partial/live2d') %><% } %></code></pre><p>å¦‚ï¼š<br>åœ¨é¦–é¡µå±•ç¤ºäºŒæ¬¡å…ƒè€å©†å°±æ‰¾çš„ä¸»é¢˜ä¸‹çš„<code>layout/index.ejs</code>æ–‡ä»¶ï¼Œåœ¨index.ejsæœ«å°¾åŠ ä¸Šä¸Šè¿°ä»£ç ç‰‡æ®µå³å¯ã€‚<br>å¦‚æœè¦åœ¨å…¶ä»–é¡µé¢ä¹Ÿå±•ç¤ºï¼Œæ¯”å¦‚æ ‡ç­¾ä¹Ÿï¼Œå°±æ‰¾åˆ°<code>layout/tag.ejs</code>æ–‡ä»¶ï¼Œåœ¨tag.ejsæœ«å°¾åŠ ä¸Šä¸Šè¿°ä»£ç ç‰‡æ®µï¼Œå…¶ä»–ä½ æƒ³å±•ç¤ºçš„é¡µé¢åŒæ ·çš„æ“ä½œã€‚</p><h4 id="4ã€é‡æ–°ç¼–è¯‘å¯åŠ¨"><a href="#4ã€é‡æ–°ç¼–è¯‘å¯åŠ¨" class="headerlink" title="4ã€é‡æ–°ç¼–è¯‘å¯åŠ¨"></a>4ã€é‡æ–°ç¼–è¯‘å¯åŠ¨</h4><pre class=" language-bash"><code class="language-bash">hexo clean <span class="token operator">&amp;</span> hexo g <span class="token operator">&amp;</span> hexo s</code></pre><p>çœ‹çœ‹æœ‰æ²¡æœ‰æ•ˆæœå§ï¼</p><h4 id="5ã€live2dåŠ è½½è°ƒæ•´"><a href="#5ã€live2dåŠ è½½è°ƒæ•´" class="headerlink" title="5ã€live2dåŠ è½½è°ƒæ•´"></a>5ã€live2dåŠ è½½è°ƒæ•´</h4><p>å› ä¸ºå¼•å…¥æ‰‹åŠ¨æ·»åŠ çš„ç‰ˆæœ¬é™„åŠ åŠŸèƒ½æ¯”è¾ƒå¤šï¼Œåšå®¢éƒ¨ç½²ä¹‹åå¯èƒ½ä¼šå­˜åœ¨å¡é¡¿é—®é¢˜ã€‚</p><p>è§£å†³åŠæ³•ï¼š</p><p>ï¼ˆ1ï¼‰ç¬¬ä¸€æ­¥ï¼Œè°ƒæ•´é™„åŠ åŠŸèƒ½ï¼ŒæŠŠä¸å¿…è¦çš„æˆ–è€…ä¸å–œæ¬¢çš„æš‚æ—¶å…³é—­ã€‚</p><p>æˆ‘æœ€å¼€çš„æ—¶å€™ï¼Œæœ‰äººåæ˜ çš„åšå®¢ç‰¹åˆ«å¡ï¼Œæ»‘åŠ¨æ—¶è¿˜å­˜åœ¨å¡é¡¿ï¼Œå› ä¸ºé¼ æ ‡çš„æ»‘åŠ¨è§¦å‘äº†live2dçš„äº‹ä»¶ï¼Œè°ƒç”¨äº†åå°APIï¼Œæ‰€ä»¥æˆ‘å°±è°ƒæ•´äº†ä¸€ä¸‹ï¼Œæƒ…å†µæœ‰æ‰€å¥½è½¬ï¼Œå¦‚æœä½ ä¹Ÿæƒ³è¿™æ ·ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„é…ç½®ï¼Œæˆ–è€…è‡ªå·±çœ‹<code>waifu.js</code>æ–‡ä»¶çš„å‚æ•°è¯´æ˜è‡ªå·±è°ƒè¯•ä¼˜åŒ–.</p><p>æˆ‘ä¿®æ”¹ä¹‹å<code>waifu.js</code>æ–‡ä»¶çš„å‚æ•°é…ç½®å¦‚ä¸‹ï¼š</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// å·¥å…·æ è®¾ç½®</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'showToolMenu'</span><span class="token punctuation">]</span>         <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤º å·¥å…·æ           ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'canCloseLive2d'</span><span class="token punctuation">]</span>       <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤º å…³é—­çœ‹æ¿å¨˜  æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'canSwitchModel'</span><span class="token punctuation">]</span>       <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤º æ¨¡å‹åˆ‡æ¢    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'canSwitchTextures'</span><span class="token punctuation">]</span>    <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤º æè´¨åˆ‡æ¢    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'canSwitchHitokoto'</span><span class="token punctuation">]</span>    <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤º ä¸€è¨€åˆ‡æ¢    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'canTakeScreenshot'</span><span class="token punctuation">]</span>    <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤º çœ‹æ¿å¨˜æˆªå›¾  æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'canTurnToHomePage'</span><span class="token punctuation">]</span>    <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤º è¿”å›é¦–é¡µ    æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'canTurnToAboutPage'</span><span class="token punctuation">]</span>   <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤º è·³è½¬å…³äºé¡µ  æŒ‰é’®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span><span class="token comment" spellcheck="true">// æ¨¡å‹åˆ‡æ¢æ¨¡å¼</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'modelStorage'</span><span class="token punctuation">]</span>         <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// è®°å½• ID (åˆ·æ–°åæ¢å¤)ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'modelRandMode'</span><span class="token punctuation">]</span>        <span class="token operator">=</span> <span class="token string">'switch'</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// æ¨¡å‹åˆ‡æ¢ï¼Œå¯é€‰ 'rand'(éšæœº), 'switch'(é¡ºåº)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'modelTexturesRandMode'</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token string">'switch'</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// æè´¨åˆ‡æ¢ï¼Œå¯é€‰ 'rand'(éšæœº), 'switch'(é¡ºåº)</span><span class="token comment" spellcheck="true">// æç¤ºæ¶ˆæ¯é€‰é¡¹</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'showHitokoto'</span><span class="token punctuation">]</span>         <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤ºä¸€è¨€</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'showF12Status'</span><span class="token punctuation">]</span>        <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤ºåŠ è½½çŠ¶æ€</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'showF12Message'</span><span class="token punctuation">]</span>       <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æ˜¾ç¤ºçœ‹æ¿å¨˜æ¶ˆæ¯</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'showF12OpenMsg'</span><span class="token punctuation">]</span>       <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤ºæ§åˆ¶å°æ‰“å¼€æç¤º</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'showCopyMessage'</span><span class="token punctuation">]</span>      <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤º å¤åˆ¶å†…å®¹ æç¤º</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'showWelcomeMessage'</span><span class="token punctuation">]</span>   <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ˜¾ç¤ºè¿›å…¥é¢é¡µæ¬¢è¿è¯</span><span class="token comment" spellcheck="true">//çœ‹æ¿å¨˜æ ·å¼è®¾ç½®</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'waifuSize'</span><span class="token punctuation">]</span>            <span class="token operator">=</span> <span class="token string">'280x250'</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// çœ‹æ¿å¨˜å¤§å°ï¼Œä¾‹å¦‚ '280x250', '600x535'</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'waifuTipsSize'</span><span class="token punctuation">]</span>        <span class="token operator">=</span> <span class="token string">'250x70'</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// æç¤ºæ¡†å¤§å°ï¼Œä¾‹å¦‚ '250x70', '570x150'</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'waifuFontSize'</span><span class="token punctuation">]</span>        <span class="token operator">=</span> <span class="token string">'12px'</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// æç¤ºæ¡†å­—ä½“ï¼Œä¾‹å¦‚ '12px', '30px'</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'waifuToolFont'</span><span class="token punctuation">]</span>        <span class="token operator">=</span> <span class="token string">'14px'</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// å·¥å…·æ å­—ä½“ï¼Œä¾‹å¦‚ '14px', '36px'</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'waifuToolLine'</span><span class="token punctuation">]</span>        <span class="token operator">=</span> <span class="token string">'20px'</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// å·¥å…·æ è¡Œé«˜ï¼Œä¾‹å¦‚ '20px', '36px'</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'waifuToolTop'</span><span class="token punctuation">]</span>         <span class="token operator">=</span> <span class="token string">'0px'</span>         <span class="token comment" spellcheck="true">// å·¥å…·æ é¡¶éƒ¨è¾¹è·ï¼Œä¾‹å¦‚ '0px', '-60px'</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'waifuMinWidth'</span><span class="token punctuation">]</span>        <span class="token operator">=</span> <span class="token string">'768px'</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// é¢é¡µå°äº æŒ‡å®šå®½åº¦ éšè—çœ‹æ¿å¨˜ï¼Œä¾‹å¦‚ 'disable'(ç¦ç”¨), '768px'</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'waifuEdgeSide'</span><span class="token punctuation">]</span>        <span class="token operator">=</span> <span class="token string">'left:0'</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// çœ‹æ¿å¨˜è´´è¾¹æ–¹å‘ï¼Œä¾‹å¦‚ 'left:0'(é å·¦ 0px), 'right:30'(é å³ 30px)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'waifuDraggable'</span><span class="token punctuation">]</span>       <span class="token operator">=</span> <span class="token string">'unlimited'</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ‹–æ‹½æ ·å¼ï¼Œä¾‹å¦‚ 'disable'(ç¦ç”¨), 'axis-x'(åªèƒ½æ°´å¹³æ‹–æ‹½), 'unlimited'(è‡ªç”±æ‹–æ‹½)</span>live2d_settings<span class="token punctuation">[</span><span class="token string">'waifuDraggableRevert'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// æ¾å¼€é¼ æ ‡è¿˜åŸæ‹–æ‹½ä½ç½®ï¼Œå¯é€‰ true(çœŸ), false(å‡)</span></code></pre><p>å¦‚æœåªæ˜¯æ˜¯åŠ è½½ä¹Ÿå¡é¡¿ï¼Œå°±æ¥ç»§ç»­ç¬¬äºŒæ­¥ã€‚</p><p>ï¼ˆ2ï¼‰ç¬¬äºŒæ­¥ï¼Œæ·»åŠ åšå®¢åŠ è½½åŠ¨ç”» ã€‚</p><p>éœ€è¦è¯´æ˜ï¼ŒåŠ è½½åŠ¨ç”»åªæ˜¯ä¸ºäº†å»¶è¿Ÿè¿›å…¥é¡µé¢ ï¼Œå¦‚æœæ˜¯é¼ æ ‡æ»‘åŠ¨å¸¦æ¥çš„å¡é¡¿ï¼Œè¿˜æ˜¯è€è€å®å®æ”¹ç¬¬ä¸€æ­¥çš„å‚æ•°å§ï¼Œä¸ä¸å¿…è¦åŠŸèƒ½èƒ½å…³å°±å…³ç‚¹å§ã€‚</p><p>åœ¨ä½ çš„å·¥ä½œç©ºé—´ï¼Œä¹Ÿæœ‰ç§°ä¹‹ä¸ºç«™ç‚¹æ ¹ç›®å½•çš„ä½ç½®ï¼Œæ–°å»ºä¸€ä¸ª<code>scripts</code>æ–‡ä»¶å¤¹ï¼Œä¸‹é¢æ”¾å…¥l<code>oading-pages.js</code>,æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* global hexo */</span><span class="token string">"use strict"</span><span class="token punctuation">;</span>hexo<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>filter<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'after_render:html'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>htmlContent<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">const</span> injectHead <span class="token operator">=</span> <span class="token template-string"><span class="token string">`&lt;style type="text/css" lang="css">    #loading-container{        position: fixed;        top: 0;        left: 0;        min-height: 100vh;        width: 100vw;        z-index: 9999;        display: flex;        flex-direction: column;        justify-content: center;        align-items: center;        background: #FFF;        text-align: center;        /* loaderé¡µé¢æ¶ˆå¤±é‡‡ç”¨æ¸éšçš„æ–¹å¼*/        -webkit-transition: opacity 1s ease;        -moz-transition: opacity 1s ease;        -o-transition: opacity 1s ease;        transition: opacity 1s ease;    }    .loading-image{        width: 120px;        height: 50px;        transform: translate(-50%);    }    .loading-image div:nth-child(2) {        -webkit-animation: pacman-balls 1s linear 0s infinite;        animation: pacman-balls 1s linear 0s infinite    }    .loading-image div:nth-child(3) {        -webkit-animation: pacman-balls 1s linear .33s infinite;        animation: pacman-balls 1s linear .33s infinite    }    .loading-image div:nth-child(4) {        -webkit-animation: pacman-balls 1s linear .66s infinite;        animation: pacman-balls 1s linear .66s infinite    }    .loading-image div:nth-child(5) {        -webkit-animation: pacman-balls 1s linear .99s infinite;        animation: pacman-balls 1s linear .99s infinite    }   .loading-image div:first-of-type {        width: 0;        height: 0;        border: 25px solid #49b1f5;        border-right-color: transparent;        border-radius: 25px;        -webkit-animation: rotate_pacman_half_up .5s 0s infinite;        animation: rotate_pacman_half_up .5s 0s infinite;    }    .loading-image div:nth-child(2) {        width: 0;        height: 0;        border: 25px solid #49b1f5;        border-right-color: transparent;        border-radius: 25px;        -webkit-animation: rotate_pacman_half_down .5s 0s infinite;        animation: rotate_pacman_half_down .5s 0s infinite;        margin-top: -50px;    }    @-webkit-keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}    @keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}    @-webkit-keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}    @keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}    @-webkit-keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}    @keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}    .loading-image div:nth-child(3),    .loading-image div:nth-child(4),    .loading-image div:nth-child(5),    .loading-image div:nth-child(6){        background-color: #49b1f5;        width: 15px;        height: 15px;        border-radius: 100%;        margin: 2px;        width: 10px;        height: 10px;        position: absolute;        transform: translateY(-6.25px);        top: 25px;        left: 100px;    }    .loading-text{        margin-bottom: 20vh;        text-align: center;        color: #2c3e50;        font-size: 2rem;        box-sizing: border-box;        padding: 0 10px;        text-shadow: 0 2px 10px rgba(0,0,0,0.2);    }    @media only screen and (max-width: 500px) {         .loading-text{            font-size: 1.5rem;         }    }    .fadeout {        opacity: 0;        filter: alpha(opacity=0);    }    /* logoå‡ºç°åŠ¨ç”» */    @-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}    @keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);}} &lt;/style> &lt;script>(function () {    const loaded = function(){       setTimeout(function(){            const loader = document.getElementById("loading-container");            loader.className="fadeout" ;//ä½¿ç”¨æ¸éšçš„æ–¹æ³•æ·¡å‡ºloading page            document.getElementById("body-wrap").style.display="flex";            setTimeout(function(){                loader.style.display="none";            },2000);         },2000);//å¼ºåˆ¶æ˜¾ç¤ºloading page 1s      };    loaded();})() &lt;/script>`</span></span><span class="token punctuation">;</span>     <span class="token keyword">const</span> injectBody <span class="token operator">=</span> <span class="token template-string"><span class="token string">` &lt;div id="loading-container">     &lt;p class="loading-text">ç©å‘½åŠ è½½ä¸­ . . . &lt;/p>      &lt;div class="loading-image">         &lt;div>&lt;/div>         &lt;div>&lt;/div>         &lt;div>&lt;/div>         &lt;div>&lt;/div>          &lt;div>&lt;/div>     &lt;/div> &lt;/div>`</span></span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/&lt;\/head>/gi</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>htmlContent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">let</span> lastIndex <span class="token operator">=</span> htmlContent<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'&lt;/head>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         htmlContent <span class="token operator">=</span> htmlContent<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lastIndex<span class="token punctuation">)</span> <span class="token operator">+</span> injectHead <span class="token operator">+</span> htmlContent<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>lastIndex<span class="token punctuation">,</span> htmlContent<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/&lt;body>/gi</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>htmlContent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">let</span> index <span class="token operator">=</span> htmlContent<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'&lt;body>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         htmlContent <span class="token operator">=</span> htmlContent<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">+</span> injectBody <span class="token operator">+</span> htmlContent<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> htmlContent<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">return</span> htmlContent<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å…³äºé¡µé¢åŠ è½½åŠ¨ç”»ï¼Œæˆ‘æ˜¯å‚è€ƒè¿‡å®¢ï½åŠ±ã‚€<a href="https://yafine-blog.cn/posts/7400.html" target="_blank" rel="noopener">ã€ŠMatery ä¸»é¢˜æ·»åŠ  loading-pagesã€‹</a>ä¸€æ–‡ã€‚</p><p>(3)é‡æ–°ç¼–è¯‘å¯åŠ¨æµ‹è¯•ä¸€ä¸‹</p><pre class=" language-bash"><code class="language-bash">hexo clean <span class="token operator">&amp;</span> hexo g <span class="token operator">&amp;</span> hexo s</code></pre><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://www.jianshu.com/p/4b61d8702cfa" target="_blank" rel="noopener">ã€Šåœ¨Hexoåšå®¢ä¸Šæ·»åŠ å¯çˆ±çš„Live 2Dæ¨¡å‹ã€‹</a><br><a href="https://blog.hclonely.com/posts/e1f9f17c/" target="_blank" rel="noopener">ã€Šç»™ç½‘é¡µæ·»åŠ ä¸€ä¸ªLive2Dçœ‹æ¿å¨˜ï¼ˆå‰ç«¯ï¼‰ã€‹</a><br><a href="https://yafine-blog.cn/posts/7400.html" target="_blank" rel="noopener">ã€ŠMatery ä¸»é¢˜æ·»åŠ  loading-pagesã€‹</a></p><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a><br><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a><br><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a><br><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a><br><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a><br><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a><br><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a><br><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a><br><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a><br><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a><br><a href="a53a9069.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Valine-Adminè¸©å‘è®°å½•</title>
      <link href="/posts/358175a6.html"/>
      <url>/posts/358175a6.html</url>
      
        <content type="html"><![CDATA[<h2 id="valine-adminè¸©å‘è®°å½•"><a href="#valine-adminè¸©å‘è®°å½•" class="headerlink" title="valine-adminè¸©å‘è®°å½•"></a>valine-adminè¸©å‘è®°å½•</h2><blockquote><p>æœ¬æ–‡ä¸»è¦è®°å½•valine-adminè¸©å‘è®°å½•ã€‚</p></blockquote><h3 id="1ã€å®‰è£…æ­¥éª¤"><a href="#1ã€å®‰è£…æ­¥éª¤" class="headerlink" title="1ã€å®‰è£…æ­¥éª¤"></a>1ã€å®‰è£…æ­¥éª¤</h3><p>ä½œè€… DesertsP å·²ç»å†™äº†å°±ä¸å†é‡å¤äº†ã€‚</p><p>è¯·å‚è€ƒï¼š<a href="https://github.com/DesertsP/Valine-Admin" target="_blank" rel="noopener">https://github.com/DesertsP/Valine-Admin</a></p><p>ä¸»è¦åˆ†äº«ä¸€ä¸‹æˆ‘è‡ªå·±ä¿®æ”¹çš„æ¨¡æ¿ï¼š</p><p>@é‚®ä»¶é€šçŸ¥æ•ˆæœï¼š</p><hr/><div style="border-radius: 10px 10px 10px 10px;font-size:13px;    color: #555555;width: 666px;font-family:'Century Gothic','Trebuchet MS','Hiragino Sans GB',å¾®è½¯é›…é»‘,'Microsoft Yahei',Tahoma,Helvetica,Arial,'SimSun',sans-serif;margin:50px auto;border:1px solid #eee;max-width:100%;background: #ffffff repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);"><div style="width:100%;background:#49BDAD;color:#ffffff;border-radius: 10px 10px 0 0;background-image: -moz-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));background-image: -webkit-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));height: 66px;"><p style="font-size:15px;word-break:break-all;padding: 23px 32px;margin:0;background-color: hsla(0,0%,100%,.4);border-radius: 10px 10px 0 0;">æ‚¨åœ¨<a style="text-decoration:none;color: #ffffff;" href="${SITE_URL}"> ${SITE_NAME}</a>ä¸Šçš„ç•™è¨€æœ‰æ–°å›å¤å•¦ï¼</p></div><div style="margin:40px auto;width:90%"><p>${PARENT_NICK} åŒå­¦ï¼Œæ‚¨æ›¾åœ¨æ–‡ç« ä¸Šå‘è¡¨è¯„è®ºï¼š</p><div style="background: #fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:14px;color:#555555;">${PARENT_COMMENT}</div><p>${NICK} ç»™æ‚¨çš„å›å¤å¦‚ä¸‹ï¼š</p><div style="background: #fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:14px;color:#555555;">${COMMENT}</div><p>æ‚¨å¯ä»¥ç‚¹å‡»<a style="text-decoration:none; color:#12addb" href="${POST_URL}#comments">æŸ¥çœ‹å›å¤çš„å®Œæ•´å…§å®¹</a>ï¼Œæ¬¢è¿å†æ¬¡å…‰ä¸´<a style="text-decoration:none; color:#12addb"                href="${SITE_URL}"> ${SITE_NAME}</a>ã€‚</p><style type="text/css">a:link{text-decoration:none}a:visited{text-decoration:none}a:hover{text-decoration:none}a:active{text-decoration:none}</style></div><div style="width:100%;background:#49BDAD;color:#ffffff;border-radius:  0 0 10px 10px;background-image: -moz-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));background-image: -webkit-linear-gradient(0deg,rgb(67, 198, 184), rgb(255, 209, 244));height: 66px;"></div></div><p>@é‚®ä»¶é€šçŸ¥æ¨¡æ¿ä»£ç ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">10</span>px <span class="token number">10</span>px <span class="token number">10</span>px <span class="token number">10</span>px<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span><span class="token number">13</span>px<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#555555</span><span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">666</span>px<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span><span class="token string">'Century Gothic'</span>,<span class="token string">'Trebuchet MS'</span>,<span class="token string">'Hiragino Sans GB'</span>,å¾®è½¯é›…é»‘,<span class="token string">'Microsoft Yahei'</span>,Tahoma,Helvetica,Arial,<span class="token string">'SimSun'</span>,sans-serif<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span><span class="token number">50</span>px auto<span class="token punctuation">;</span><span class="token property">border</span><span class="token punctuation">:</span><span class="token number">1</span>px solid <span class="token hexcode">#eee</span><span class="token punctuation">;</span><span class="token property">max-width</span><span class="token punctuation">:</span><span class="token number">100%</span><span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode">#ffffff</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>-<span class="token number">45</span>deg,<span class="token hexcode">#fff</span>,<span class="token hexcode">#fff</span> <span class="token number">1.125</span>rem,transparent <span class="token number">1.125</span>rem,transparent <span class="token number">2.25</span>rem<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">1</span>px <span class="token number">5</span>px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">100%</span><span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span><span class="token hexcode">#49BDAD</span><span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#ffffff</span><span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">10</span>px <span class="token number">10</span>px <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-moz-linear-gradient</span><span class="token punctuation">(</span><span class="token number">0</span>deg, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">67</span>, <span class="token number">198</span>, <span class="token number">184</span><span class="token punctuation">)</span>, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">209</span>, <span class="token number">244</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span><span class="token number">0</span>deg, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">67</span>, <span class="token number">198</span>, <span class="token number">184</span><span class="token punctuation">)</span>, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">209</span>, <span class="token number">244</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">66</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">font-size</span><span class="token punctuation">:</span><span class="token number">15</span>px<span class="token punctuation">;</span><span class="token property">word-break</span><span class="token punctuation">:</span>break-all<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">23</span>px <span class="token number">32</span>px<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">hsla</span><span class="token punctuation">(</span><span class="token number">0</span>,<span class="token number">0%</span>,<span class="token number">100%</span>,<span class="token number">.4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">10</span>px <span class="token number">10</span>px <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ‚¨åœ¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#ffffff</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${SITE_URL}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> ${SITE_NAME}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>ä¸Šçš„ç•™è¨€æœ‰æ–°å›å¤å•¦ï¼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin</span><span class="token punctuation">:</span><span class="token number">40</span>px auto<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">90%</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>${PARENT_NICK} åŒå­¦ï¼Œæ‚¨æ›¾åœ¨æ–‡ç« ä¸Šå‘è¡¨è¯„è®ºï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode">#fafafa</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>-<span class="token number">45</span>deg,<span class="token hexcode">#fff</span>,<span class="token hexcode">#fff</span> <span class="token number">1.125</span>rem,transparent <span class="token number">1.125</span>rem,transparent <span class="token number">2.25</span>rem<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">2</span>px <span class="token number">5</span>px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span><span class="token number">20</span>px <span class="token number">0</span>px<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span><span class="token number">15</span>px<span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span><span class="token number">5</span>px<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span><span class="token number">14</span>px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#555555</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>${PARENT_COMMENT}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>${NICK} ç»™æ‚¨çš„å›å¤å¦‚ä¸‹ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode">#fafafa</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>-<span class="token number">45</span>deg,<span class="token hexcode">#fff</span>,<span class="token hexcode">#fff</span> <span class="token number">1.125</span>rem,transparent <span class="token number">1.125</span>rem,transparent <span class="token number">2.25</span>rem<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">2</span>px <span class="token number">5</span>px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span><span class="token number">20</span>px <span class="token number">0</span>px<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span><span class="token number">15</span>px<span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span><span class="token number">5</span>px<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span><span class="token number">14</span>px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#555555</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>${COMMENT}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>æ‚¨å¯ä»¥ç‚¹å‡»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#12addb</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${POST_URL}#comments<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æŸ¥çœ‹å›å¤çš„å®Œæ•´å…§å®¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>ï¼Œæ¬¢è¿å†æ¬¡å…‰ä¸´<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#12addb</span></span><span class="token punctuation">"</span></span>                <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${SITE_URL}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> ${SITE_NAME}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector">a<span class="token pseudo-class">:link</span></span><span class="token punctuation">{</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">}</span><span class="token selector">a<span class="token pseudo-class">:visited</span></span><span class="token punctuation">{</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">}</span><span class="token selector">a<span class="token pseudo-class">:hover</span></span><span class="token punctuation">{</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">}</span><span class="token selector">a<span class="token pseudo-class">:active</span></span><span class="token punctuation">{</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">100%</span><span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span><span class="token hexcode">#49BDAD</span><span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#ffffff</span><span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span>  <span class="token number">0</span> <span class="token number">0</span> <span class="token number">10</span>px <span class="token number">10</span>px<span class="token punctuation">;</span><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-moz-linear-gradient</span><span class="token punctuation">(</span><span class="token number">0</span>deg, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">67</span>, <span class="token number">198</span>, <span class="token number">184</span><span class="token punctuation">)</span>, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">209</span>, <span class="token number">244</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span><span class="token number">0</span>deg,<span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">67</span>, <span class="token number">198</span>, <span class="token number">184</span><span class="token punctuation">)</span>, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">209</span>, <span class="token number">244</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">66</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>åšä¸»é€šçŸ¥æ•ˆæœï¼š</p><hr/><div style="border-radius: 10px 10px 10px 10px;font-size:13px;    color: #555555;width: 666px;font-family:'Century Gothic','Trebuchet MS','Hiragino Sans GB',å¾®è½¯é›…é»‘,'Microsoft Yahei',Tahoma,Helvetica,Arial,'SimSun',sans-serif;margin:50px auto;border:1px solid #eee;max-width:100%;background: #ffffff repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);"><div style="width:100%;background:#49BDAD;color:#ffffff;border-radius: 10px 10px 0 0;background-image: -moz-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));background-image: -webkit-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));height: 66px;"><p style="font-size:15px;word-break:break-all;padding: 23px 32px;margin:0;background-color: hsla(0,0%,100%,.4);border-radius: 10px 10px 0 0;">æ‚¨åœ¨<a style="text-decoration:none;color: #ffffff;" href="${SITE_URL}"> ${SITE_NAME}</a>ä¸Šçš„æ–‡ç« æœ‰äº†æ–°çš„è¯„è®ºï¼</p></div><div style="margin:40px auto;width:90%"><p><strong>${NICK}</strong> åŒå­¦ï¼Œå‘è¡¨è¯„è®ºè¯´ï¼š</p><div style="background: #fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:14px;color:#555555;">${COMMENT}</div><p>æ‚¨å¯ä»¥ç‚¹å‡»<a style="text-decoration:none; color:#12addb" href="${POST_URL}#comments">æŸ¥çœ‹å›å¤çš„å®Œæ•´å…§å®¹</a>ã€‚</p><style type="text/css">a:link{text-decoration:none}a:visited{text-decoration:none}a:hover{text-decoration:none}a:active{text-decoration:none}</style></div><div style="width:100%;background:#49BDAD;color:#ffffff;border-radius: 0 0 10px 10px ;background-image: -moz-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));background-image: -webkit-linear-gradient(0deg,rgb(67, 198, 184), rgb(255, 209, 244));height: 66px;"></div></div><p>åšä¸»é€šçŸ¥æ¨¡æ¿ä»£ç ï¼š</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">10</span>px <span class="token number">10</span>px <span class="token number">10</span>px <span class="token number">10</span>px<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span><span class="token number">13</span>px<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#555555</span><span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">666</span>px<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span><span class="token string">'Century Gothic'</span>,<span class="token string">'Trebuchet MS'</span>,<span class="token string">'Hiragino Sans GB'</span>,å¾®è½¯é›…é»‘,<span class="token string">'Microsoft Yahei'</span>,Tahoma,Helvetica,Arial,<span class="token string">'SimSun'</span>,sans-serif<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span><span class="token number">50</span>px auto<span class="token punctuation">;</span><span class="token property">border</span><span class="token punctuation">:</span><span class="token number">1</span>px solid <span class="token hexcode">#eee</span><span class="token punctuation">;</span><span class="token property">max-width</span><span class="token punctuation">:</span><span class="token number">100%</span><span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode">#ffffff</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>-<span class="token number">45</span>deg,<span class="token hexcode">#fff</span>,<span class="token hexcode">#fff</span> <span class="token number">1.125</span>rem,transparent <span class="token number">1.125</span>rem,transparent <span class="token number">2.25</span>rem<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">1</span>px <span class="token number">5</span>px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">100%</span><span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span><span class="token hexcode">#49BDAD</span><span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#ffffff</span><span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">10</span>px <span class="token number">10</span>px <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-moz-linear-gradient</span><span class="token punctuation">(</span><span class="token number">0</span>deg, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">67</span>, <span class="token number">198</span>, <span class="token number">184</span><span class="token punctuation">)</span>, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">209</span>, <span class="token number">244</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span><span class="token number">0</span>deg, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">67</span>, <span class="token number">198</span>, <span class="token number">184</span><span class="token punctuation">)</span>, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">209</span>, <span class="token number">244</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">66</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">font-size</span><span class="token punctuation">:</span><span class="token number">15</span>px<span class="token punctuation">;</span><span class="token property">word-break</span><span class="token punctuation">:</span>break-all<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">23</span>px <span class="token number">32</span>px<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">hsla</span><span class="token punctuation">(</span><span class="token number">0</span>,<span class="token number">0%</span>,<span class="token number">100%</span>,<span class="token number">.4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">10</span>px <span class="token number">10</span>px <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ‚¨åœ¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode">#ffffff</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${SITE_URL}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> ${SITE_NAME}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>ä¸Šçš„æ–‡ç« æœ‰äº†æ–°çš„è¯„è®ºï¼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin</span><span class="token punctuation">:</span><span class="token number">40</span>px auto<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">90%</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span>${NICK}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span> åŒå­¦ï¼Œå‘è¡¨è¯„è®ºè¯´ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode">#fafafa</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>-<span class="token number">45</span>deg,<span class="token hexcode">#fff</span>,<span class="token hexcode">#fff</span> <span class="token number">1.125</span>rem,transparent <span class="token number">1.125</span>rem,transparent <span class="token number">2.25</span>rem<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">2</span>px <span class="token number">5</span>px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span><span class="token number">20</span>px <span class="token number">0</span>px<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span><span class="token number">15</span>px<span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span><span class="token number">5</span>px<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span><span class="token number">14</span>px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#555555</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>${COMMENT}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>æ‚¨å¯ä»¥ç‚¹å‡»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#12addb</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${POST_URL}#comments<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æŸ¥çœ‹å›å¤çš„å®Œæ•´å…§å®¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css"><span class="token selector">a<span class="token pseudo-class">:link</span></span><span class="token punctuation">{</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">}</span><span class="token selector">a<span class="token pseudo-class">:visited</span></span><span class="token punctuation">{</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">}</span><span class="token selector">a<span class="token pseudo-class">:hover</span></span><span class="token punctuation">{</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">}</span><span class="token selector">a<span class="token pseudo-class">:active</span></span><span class="token punctuation">{</span><span class="token property">text-decoration</span><span class="token punctuation">:</span>none<span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">100%</span><span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span><span class="token hexcode">#49BDAD</span><span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span><span class="token hexcode">#ffffff</span><span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">10</span>px <span class="token number">10</span>px <span class="token punctuation">;</span><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-moz-linear-gradient</span><span class="token punctuation">(</span><span class="token number">0</span>deg, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">67</span>, <span class="token number">198</span>, <span class="token number">184</span><span class="token punctuation">)</span>, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">209</span>, <span class="token number">244</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span><span class="token number">0</span>deg,<span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">67</span>, <span class="token number">198</span>, <span class="token number">184</span><span class="token punctuation">)</span>, <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">209</span>, <span class="token number">244</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">66</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><h3 id="2ã€é‡åˆ°çš„é—®é¢˜"><a href="#2ã€é‡åˆ°çš„é—®é¢˜" class="headerlink" title="2ã€é‡åˆ°çš„é—®é¢˜"></a>2ã€é‡åˆ°çš„é—®é¢˜</h3><p>æ­£å¸¸æ“ä½œä¸€èˆ¬ä¸ä¼šé‡åˆ°é—®é¢˜å§ï¼Ÿ</p><p>å¦‚æœé‡åˆ°äº†ï¼Œé‚£ä¹ˆä½ å¯ä»¥å¾€ä¸‹çœ‹ã€‚</p><p>ï¼ˆ1ï¼‰æŒ‰æ­¥éª¤æ“ä½œå®Œäº†ï¼Œä½†æ˜¯è®¿é—®<code>https://small-rose.leanapp.cn</code>æŠ¥é”™ï¼š</p><pre class=" language-txt"><code class="language-txt">Application not Foundæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„äº‘å¼•æ“åº”ç”¨ï¼Œè¯·ç¡®è®¤åº”ç”¨å·²ç»æ­£ç¡®éƒ¨ç½²ã€‚</code></pre><p>å¦‚æœå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆä½ åº”è¯¥ä½¿ç”¨çš„ä¸æ˜¯å›½é™…ç‰ˆï¼Œè€Œæ˜¯åä¸œèŠ‚ç‚¹æˆ–ååŒ—èŠ‚ç‚¹ï¼Œç°åœ¨æ²¡æœ‰ç»‘å®šå¤‡æ¡ˆçš„åŸŸåæ˜¯ä¸èƒ½è®¿é—®çš„ã€‚å¦‚æœä½ çš„åŸŸåå·²ç»å¤‡æ¡ˆè¿‡ï¼Œç™»å½•Leancloudä¹‹ååˆ°â€œè®¾ç½®â€ï¼Œâ€œåŸŸåç»‘å®šä¸­â€,â€œäº‘å¼•æ“åŸŸåâ€å¤„ç»‘å®šä½ åŸŸåï¼Œè‡ªå·±è®¾ç½®ä¸€ä¸‹ä½ çš„DNSè§£æå³å¯ã€‚ç»‘å®šå®Œæˆä¹‹åï¼Œåœ¨ç”¨åŸŸåè®¿é—®ã€‚</p><p>å¦‚æœä½ æ˜¯ç”¨å›½é™…ç‰ˆï¼Œå°±ä¸è¦æ±‚åŸŸåå¤‡æ¡ˆç»‘å®šã€‚</p><p>ï¼ˆ2ï¼‰è¯„è®ºç³»ç»Ÿå¯ä»¥è®¿é—®ä¹‹åï¼Œæ— æ³•è¿›æ³¨å†Œé¡µé¢</p><p>åˆ é™¤<code>_User</code>è¡¨æ•°æ®å³å¯ï¼Œè¿™æ ·å°±å¯ä»¥æ³¨å†Œç®¡ç†å‘˜ä¿¡æ¯äº†ã€‚ </p><p>ï¼ˆ3ï¼‰ç®¡ç†å‘˜ä¿¡æ¯æ³¨å†ŒæˆåŠŸï¼Œè¿˜æ˜¯æ— æ³•ç™»å½•ã€‚</p><p>è¯·åˆ°â€œå­˜å‚¨â€ï¼Œâ€œç”¨æˆ·â€ï¼Œâ€œè®¾ç½®â€å¤„æ£€æŸ¥è®¾ç½® â€œæœªéªŒè¯é‚®ç®±çš„ç”¨æˆ·ï¼Œç¦æ­¢ç™»å½•â€æŠŠå‰é¢çš„å‹¾é€‰å»æ‰ã€‚å¦‚æœä¸æƒ³å»æ‰å‹¾é€‰ï¼Œä¹Ÿå¯ä»¥åˆ° â€œå­˜å‚¨â€ï¼Œâ€œç»“æ„åŒ–æ•°æ®â€ï¼Œ<code>_User</code>è¡¨ï¼Œæ‰¾åˆ°<code>emailVerified</code>å­—æ®µï¼ŒåŒå‡»ä½ çš„æ•°æ®å€¼ï¼Œæ”¹æˆ<code>true</code>å³å¯ã€‚</p><h3 id="3ã€å®Œç»“"><a href="#3ã€å®Œç»“" class="headerlink" title="3ã€å®Œç»“"></a>3ã€å®Œç»“</h3><p>è‡ªå·±è·‘äº†è®°å¾—æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹é‚®ä»¶èƒ½å¦æ­£å¸¸å‘é€ã€‚è¯„è®ºè¿˜èƒ½ä¸èƒ½æ­£å¸¸ç©è€äº†ã€‚</p><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a><br><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a><br><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a><br><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a><br><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a><br><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a><br><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a><br><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a><br><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a><br><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a><br><a href="a53a9069.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Materyä¸»é¢˜valineä½¿ç”¨ä¸å‡çº§</title>
      <link href="/posts/40099453.html"/>
      <url>/posts/40099453.html</url>
      
        <content type="html"><![CDATA[<h2 id="Matery-ä¸»é¢˜è¯„è®ºåŠŸèƒ½valineä½¿ç”¨ä¸å‡çº§"><a href="#Matery-ä¸»é¢˜è¯„è®ºåŠŸèƒ½valineä½¿ç”¨ä¸å‡çº§" class="headerlink" title="Matery ä¸»é¢˜è¯„è®ºåŠŸèƒ½valineä½¿ç”¨ä¸å‡çº§"></a>Matery ä¸»é¢˜è¯„è®ºåŠŸèƒ½valineä½¿ç”¨ä¸å‡çº§</h2><blockquote><p>Matery é»˜è®¤è‡ªå¸¦äº†<a href="https://gitalk.github.io/" target="_blank" rel="noopener">Gitalk</a>ã€<a href="https://imsun.github.io/gitment/" target="_blank" rel="noopener">Gitment</a>ã€<a href="https://valine.js.org/" target="_blank" rel="noopener">Valine</a> å’Œ <a href="https://disqus.com/" target="_blank" rel="noopener">Disqus</a> è¯„è®ºæ¨¡å—ï¼ˆæ¨èä½¿ç”¨ <code>Gitalk</code>ï¼‰ä½†æ˜¯gittalkæœ‰æ—¶å€™åŠ è½½ä¸å‡ºæ¥ã€‚å°±ä¼˜å…ˆä½¿ç”¨äº†Valineã€‚<br>valineä½¿ç”¨æ•™ç¨‹ä¸å°‘ï¼Œç®€å•è¯´ä¸€ä¸‹ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯æŠŠmateryè‡ªå¸¦çš„<code>valine1.3</code> å‡çº§åˆ°<code>valine 1.4</code>çš„è¿‡ç¨‹ã€‚</p></blockquote><p>ç‚¹å‡»æœ¬ç«™çš„<a href="https://zhangxiaocai.cn/contact/" target="_blank" rel="noopener">ç•™è¨€è–„</a>å¯ä»¥çœ‹åˆ°æ•ˆæœã€‚</p><p>å¤šäº†æµè§ˆå™¨å’Œç³»ç»Ÿå›¾æ ‡ï¼Œè¿˜æœ‰åšä¸»å°ä¼™ä¼´æ ‡è¯†ã€‚</p><h3 id="ä¸€ã€valineå¯ç”¨"><a href="#ä¸€ã€valineå¯ç”¨" class="headerlink" title="ä¸€ã€valineå¯ç”¨"></a>ä¸€ã€valineå¯ç”¨</h3><h4 id="1ã€ä¸»è¦æµç¨‹"><a href="#1ã€ä¸»è¦æµç¨‹" class="headerlink" title="1ã€ä¸»è¦æµç¨‹"></a>1ã€ä¸»è¦æµç¨‹</h4><p>valineå’ŒminiValineä½¿ç”¨åŸºæœ¬ç±»ä¼¼ã€‚</p><p>ï¼ˆ1ï¼‰å» <a href="https://leancloud.cn/dashboard/login.html#/signup" target="_blank" rel="noopener">Leancloud</a>æ³¨å†Œã€‚</p><p>æ³¨æ„äº‹é¡¹ï¼š</p><p>èŠ‚ç‚¹é€‰æ‹©ï¼šåä¸œèŠ‚ç‚¹ã€ååŒ—èŠ‚ç‚¹ã€å›½é™…ç‰ˆã€‚</p><p>å¦‚æœä½ çš„åŸŸåæ²¡æœ‰å¤‡æ¡ˆï¼Œå»ºè®®é€‰æ‹©å›½é™…ç‰ˆã€‚ å› ä¸ºåä¸œæˆ–ååŒ—èŠ‚ç‚¹åœ¨å®‰è£…è¯„è®ºç³»ç»Ÿä¹‹åè®¿é—®è¦æ±‚åŸŸåå¤‡æ¡ˆã€‚</p><p>ï¼ˆ2ï¼‰åœ¨â€œè®¾ç½®â€œï¼Œâ€åº”ç”¨ Keysâ€ï¼Œæ‰¾åˆ°ä½ çš„<code>appid</code>å’Œ<code>appkey</code>ï¼Œé…ç½®åˆ°ä¸»é¢˜ä¸­<code>valine</code>é…ç½®çš„åœ°æ–¹ï¼Œå¯ç”¨<code>valine</code>ã€‚</p><p>ï¼ˆ3ï¼‰åœ¨â€œè®¾ç½®â€œï¼Œâ€å®‰å…¨ä¸­å¿ƒâ€ï¼Œâ€Web å®‰å…¨åŸŸåâ€ï¼Œæ·»åŠ è‡ªå·±çš„åŸŸåã€‚</p><p>ï¼ˆ4ï¼‰åœ¨â€œè®¾ç½®â€œï¼Œâ€å®‰å…¨ä¸­å¿ƒâ€ï¼Œâ€æœåŠ¡å¼€å…³â€ï¼Œæ•°æ®å­˜å‚¨è¦æ‰“å¼€ã€‚</p><p>ï¼ˆ5ï¼‰åœ¨â€œå­˜å‚¨â€œï¼Œâ€ç”¨é‡ç»Ÿè®¡â€ï¼Œâ€HTTPçŠ¶æ€ç â€ï¼Œå¯ç”¨ï¼Œæ–¹ä¾¿åç»­æŠ¥é”™æŸ¥é”™è¯¯ç ã€‚</p><p>ï¼ˆ6ï¼‰é‡æ–°ç¼–è¯‘éƒ¨ç½²<code>hexo clean &amp; hexo g &amp; hexo d</code>  </p><h4 id="2ã€é‡åˆ°é—®é¢˜"><a href="#2ã€é‡åˆ°é—®é¢˜" class="headerlink" title="2ã€é‡åˆ°é—®é¢˜"></a>2ã€é‡åˆ°é—®é¢˜</h4><p>æè¿™ä¸ªä¸œè¥¿é‡‡å‘ä¸å°‘ï¼Œæœ‰äº›å‘éƒ½æ˜¯è‡ªå·±ä¸å°å¿ƒé€ æˆçš„ã€‚æˆ‘åœ¨ç½‘ä¸ŠæŸ¥äº†ï¼Œäº¤æµç¾¤é‡Œä¹Ÿå’¨è¯¢è¯·æ•™äº†ï¼Œæ²¡æœ‰äººèƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¯•ç«Ÿè¿™ä¸ªå‘æ˜¯è‡ªå·±é€ æˆçš„ã€‚</p><p>å¸¸è§Code 403é—®é¢˜ï¼š</p><pre class=" language-txt"><code class="language-txt">Code 403: è®¿é—®è¢«apiåŸŸåç™½åå•æ‹’ç»ï¼Œè¯·æ£€æŸ¥ä½ çš„å®‰å…¨åŸŸåè®¾ç½®.</code></pre><p>ç½‘ä¸Šå¤šæ•°çš„è¯´æ³•æ˜¯åœ¨webå®‰å…¨åŸŸåä¸­æ·»åŠ è‡ªå·±çš„åŸŸåã€‚å¯æ˜¯å¦‚æœæ·»åŠ ä¹‹åè¿˜æ˜¯è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><p>å…¶å®ä¸€èˆ¬ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æœ‰è¿™ä¸ªé—®é¢˜æ˜¯æˆ‘æ”¹äº†æƒé™é€ æˆäº†ã€‚</p><p>å®˜æ–¹ç»™çš„è§£é‡Šï¼š</p><pre class=" language-txt"><code class="language-txt">åº”ç”¨åœ¨æ§åˆ¶å°ä¸­çš„ç›¸å…³æœåŠ¡é€‰é¡¹æœªæ‰“å¼€ï¼Œå¦‚ Class å…³é—­äº†æƒé™ï¼Œæˆ–æ˜¯ User ç¼ºå¤±äº† session ä¿¡æ¯ç­‰æƒ…å†µä¸‹ï¼Œäº‘ç«¯ä¼šç»Ÿä¸€åœ°è¿”å› 403 é”™è¯¯ç åŠä¸åŒçš„é”™è¯¯ä¿¡æ¯ï¼Œä»£è¡¨å½“å‰è¯·æ±‚å› æƒé™ä¸å¤Ÿè€Œè¢«æ‹’ã€‚ä¾‹å¦‚ï¼š    ä¿¡æ¯ - Forbidden to read/write by class permissions    å«ä¹‰ - æ“ä½œè¢«ç¦æ­¢ï¼Œå› ä¸º Class è¡¨æ²¡æœ‰æ‰“å¼€ã€Œè¯»ã€æˆ–è€…ã€Œå†™ã€çš„æƒé™ã€‚è¿›å…¥ æ§åˆ¶å° > å­˜å‚¨ï¼Œç‚¹å‡»ç›¸åº”çš„ Classï¼Œä»å³ä¾§é€‰æ‹© å…¶ä»– ä¸‹æ‹‰èœå•ï¼Œè¿›å…¥ æƒé™ç®¡ç† æ¥è°ƒæ•´ã€‚    ä¿¡æ¯ - The user cannot be altered by a client without the session.    å«ä¹‰ - ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œæ— æ³•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ã€‚</code></pre><p>è§£å†³ï¼š</p><p>ï¼ˆ1ï¼‰é¦–æ¬¡ä½¿ç”¨ï¼Œæ·»åŠ ä¸€æ¡è¯„è®ºï¼Œä¸€èˆ¬æ·»åŠ ä¹‹åå°±ä¼šå¥½äº†ã€‚</p><p>ï¼ˆ2ï¼‰åç»­ä½¿ç”¨ï¼Œ403ï¼Œè¯·æ£€æŸ¥<code>comment</code>è¡¨çš„add_fields/create/findæƒé™å¼€æ”¾ã€‚</p><p>ï¼ˆ3ï¼‰å¦‚æœè¿˜æ˜¯ä¸è¡Œå°†<code>_use</code>è¡¨çš„add_fields/create/findæƒé™å¼€æ”¾ã€‚</p><p>ï¼ˆ4ï¼‰å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œåˆ°â€œå­˜å‚¨â€œï¼Œâ€ç”¨é‡ç»Ÿè®¡â€ï¼Œâ€HTTPçŠ¶æ€ç â€å¤„ï¼Œæ£€æŸ¥ä½ çš„é”™è¯¯ç ï¼Œç„¶åå»<a href="https://leancloud.cn/docs/error_code.html#hash1392104" target="_blank" rel="noopener">LeanCloudçš„é”™è¯¯</a>æ‰¾åº”ç”¨çš„é”™è¯¯ç ï¼Œæ’æŸ¥åŸå› å§ã€‚</p><h3 id="äºŒã€valineå‡çº§"><a href="#äºŒã€valineå‡çº§" class="headerlink" title="äºŒã€valineå‡çº§"></a>äºŒã€valineå‡çº§</h3><h4 id="1ã€å¼•å…¥1-4ç‰ˆçš„jsæ–‡ä»¶"><a href="#1ã€å¼•å…¥1-4ç‰ˆçš„jsæ–‡ä»¶" class="headerlink" title="1ã€å¼•å…¥1.4ç‰ˆçš„jsæ–‡ä»¶"></a>1ã€å¼•å…¥1.4ç‰ˆçš„jsæ–‡ä»¶</h4><p>ï¼ˆ1ï¼‰ç›´æ¥ä½¿ç”¨æˆ‘ CDN é“¾æ¥</p><p>å¦‚æœä½ æ²¡æœ‰,å¯ä»¥ç›´æ¥åœ¨ä½ çš„ <code>valine.ejs</code> æ–‡ä»¶ä¸­ä½¿ç”¨æˆ‘çš„é“¾æ¥ï¼š</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io/libs/valine/Valine.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>ä½ç½®åœ¨ï¼š</p><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"&lt;%- theme.jsDelivr.url %>&lt;%- url_for('/libs/valine/av-min.js') %>"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io/libs/valine/Valine.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>è®°å¾—æŠŠä¸»é¢˜è‡ªå¸¦çš„</p><pre><code>&lt;script src=&quot;&lt;%- theme.jsDelivr.url %&gt;&lt;%- url_for(theme.libs.js.valine) %&gt;&quot;&gt;&lt;/script&gt;</code></pre><p>åˆ æ‰ï¼Œæˆ–ç›´æ¥å‰ªåˆ‡åˆ°åˆ«çš„åœ°æ–¹å¤‡ä»½ç€ã€‚</p><p>ï¼ˆ2ï¼‰å°†æ–‡ä»¶æ”¾ä½ è‡ªå·±çš„ä»“åº“</p><p>ä¸‹è½½æˆ‘çš„ <code>Valine.min.js</code> æ–‡ä»¶ï¼Œç›´æ¥æ›¿æ¢ä½ ä¸»é¢˜ç›®å½• <code>/source/libs/valine/</code> ä¸‹çš„ <code>Valine.min.js</code> æ–‡ä»¶ã€‚</p><p>æ³¨æ„ï¼Œå¦‚æœä½ æ‹…å¿ƒæ›¿æ¢æœ‰é—®é¢˜ï¼Œå¯ä»¥å…ˆå¤‡ä»½ä¸€ä¸‹ä½ è‡ªå·±çš„ <code>Valine.min.js</code> æ–‡ä»¶ã€‚</p><h4 id="2ã€å¢åŠ valineçš„é…ç½®ï¼š"><a href="#2ã€å¢åŠ valineçš„é…ç½®ï¼š" class="headerlink" title="2ã€å¢åŠ valineçš„é…ç½®ï¼š"></a>2ã€å¢åŠ valineçš„é…ç½®ï¼š</h4><p>1.4çš„ç‰ˆæœ¬æœ‰äº›å±æ€§è°ƒæ•´äº†ï¼Œä¸»é¢˜ä¸‹çš„<code>_config.yml</code>valineå±æ€§å¦‚ä¸‹ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">valine</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">appId</span><span class="token punctuation">:</span> iTxfqh5e9IaRfiiVOTbIWoKa<span class="token punctuation">-</span>XXXXXX  <span class="token key atrule">appKey</span><span class="token punctuation">:</span> C5s5xGFErD1EtXXXXXXXX  <span class="token key atrule">verify</span><span class="token punctuation">:</span> <span class="token boolean important">true  </span><span class="token comment" spellcheck="true"># æ˜¯å¦å¯ç”¨é˜²åƒåœ¾éªŒè¯</span>  <span class="token key atrule">notify</span><span class="token punctuation">:</span> <span class="token boolean important">true  </span><span class="token comment" spellcheck="true"># æ˜¯å¦å¼€å¯é‚®ä»¶æé†’(https://valine.js.org/notify.html)</span>  <span class="token key atrule">visitor</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">avatar</span><span class="token punctuation">:</span> monsterid  <span class="token comment" spellcheck="true"># å¤´åƒæ ·å¼(https://valine.js.org/avatar.html) </span>  <span class="token key atrule">pageSize</span><span class="token punctuation">:</span> <span class="token number">10</span>  <span class="token key atrule">placeholder</span><span class="token punctuation">:</span> <span class="token string">'ãƒ¾ï¾‰â‰§âˆ€â‰¦)oæ¥å•Šï¼Œå¿«æ´»å•Š!'</span> <span class="token comment" spellcheck="true"># Comment Box placeholder</span>  <span class="token key atrule">background</span><span class="token punctuation">:</span> /medias/comment_bg.png <span class="token comment" spellcheck="true">#èƒŒæ™¯å›¾</span>  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">enableQQ</span><span class="token punctuation">:</span> <span class="token number">970175021</span>  <span class="token key atrule">recordIP</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">requiredFields</span><span class="token punctuation">:</span>     <span class="token punctuation">-</span> nick    <span class="token punctuation">-</span> mail  <span class="token key atrule">guest_info</span><span class="token punctuation">:</span>     <span class="token punctuation">-</span> nick    <span class="token punctuation">-</span> mail    <span class="token punctuation">-</span> link  <span class="token key atrule">master</span><span class="token punctuation">:</span>     <span class="token punctuation">-</span> 123abc508165c8eba9a77f872xxxx046  <span class="token comment" spellcheck="true"># md5åŠ å¯†åçš„åšä¸»é‚®ç®±</span>  <span class="token key atrule">metaPlaceholder</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># è¾“å…¥æ¡†çš„èƒŒæ™¯æ–‡å­—</span>    <span class="token key atrule">nick</span><span class="token punctuation">:</span> æ˜µç§°/QQå·(å¿…å¡«)    <span class="token key atrule">mail</span><span class="token punctuation">:</span> é‚®ç®±(å¿…å¡«)    <span class="token key atrule">link</span><span class="token punctuation">:</span> ç½‘å€(https<span class="token punctuation">:</span>//)  <span class="token key atrule">lang</span><span class="token punctuation">:</span> zh<span class="token punctuation">-</span>CN  <span class="token key atrule">tagMeta</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># The String Array of Words to show Flag.[Just Only xCss Style mode]</span>    <span class="token punctuation">-</span> åšä¸»    <span class="token punctuation">-</span> å°ä¼™ä¼´    <span class="token punctuation">-</span> è®¿å®¢  <span class="token key atrule">friends</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># The MD5 String Array of friends Email to show friends Flag.[Just Only xCss Style mode]</span>    <span class="token punctuation">-</span> c08508165c8eba9a77f8c2853xxxx09e    <span class="token punctuation">-</span> 901345d4c91ddfd8db0f175bbcfff0c8    <span class="token punctuation">-</span> 1512958e18378c98b498d5effe3e76ff</code></pre><p>å¤åˆ¶ä»£ç æ³¨æ„ç¼©è¿›å¯¹é½ï¼Œä¸å¯¹é½å¯èƒ½ä¼šæŠ¥é”™ï¼Œè¯·è‡ªè¡Œæ£€æŸ¥å¯¹é½ã€‚</p><h4 id="3ã€ä¿®æ”¹valine-ejsï¼š"><a href="#3ã€ä¿®æ”¹valine-ejsï¼š" class="headerlink" title="3ã€ä¿®æ”¹valine.ejsï¼š"></a>3ã€ä¿®æ”¹<code>valine.ejs</code>ï¼š</h4><p>Matery ä¸»é¢˜ä½¿ç”¨çš„<code>ejs</code>æ¨¡æ¿é¢„ç¼–è¯‘ï¼Œå¦‚æœä½ ä½¿ç”¨äº†<code>pug</code>æˆ–è€…<code>swig</code>ç­‰å…¶ä»–çš„æ¨¡æ¿è¯­è¨€ï¼Œè¯·ä¿®æ”¹æˆå¯¹åº”è¯­è¨€è¯­æ³•å³å¯ã€‚</p><p>åŸå§‹çš„<code>valine.ejs</code></p><pre class=" language-ejs"><code class="language-ejs">new Valine({        el: '#vcomments',        appId: '<%- theme.valine.appId %>',        appKey: '<%- theme.valine.appKey %>',        notify: '<%- theme.valine.notify %>' === 'true',        verify: '<%- theme.valine.verify %>' === 'true',        visitor: '<%- theme.valine.visitor %>' === 'true',        avatar: '<%- theme.valine.avatar %>',        pageSize: '<%- theme.valine.pageSize %>',        lang: '<% if (config.language == "zh-CN") {  %>zh-cn<% } else { %>en<% } %>',        placeholder: '<%= theme.valine.placeholder %>'    });</code></pre><p>å‡çº§åçš„<code>valine.ejs</code></p><pre class=" language-ejs"><code class="language-ejs">let metaPlaceholder = <%-  JSON.stringify(theme.valine.metaPlaceholder) %> ;//è¿™é‡Œè¦æ¢è¡Œnew Valine({        el: '#vcomments',        appId: '<%- theme.valine.appId %>',        appKey: '<%- theme.valine.appKey %>',        notify: '<%- theme.valine.notify %>' === 'true',        verify: '<%- theme.valine.verify %>' === 'true',        visitor: '<%- theme.valine.visitor %>' === 'true',        avatar: '<%- theme.valine.avatar %>',        pageSize: '<%- theme.valine.pageSize %>',        lang: '<%- theme.valine.lang %>',        placeholder: '<%= theme.valine.placeholder %>',        meta: <%- '["' + theme.valine.guest_info.join('", "') + '"]' %>,        recordIP: '<%- theme.valine.recordIP %>' === 'true',        enableQQ: '<%- theme.valine.avatar %>',        requiredFields: <%- '["' + theme.valine.master.join('", "') + '"]' %>,        master: <%- '["' + theme.valine.master.join('", "') + '"]' %>,        friends: <%- '["' + theme.valine.friends.join('", "') + '"]' %>,        tagMeta: <%- '["' + theme.valine.tagMeta.join('", "') + '"]' %>,        metaPlaceholder: metaPlaceholder,    });</code></pre><p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œåšä¸»äº²è‡ªé‡‡å‘äº²è‡ªçˆ¬å‘è®°å½•ã€‚</p><p>å¦‚æœéœ€è¦éªŒè¯æ˜µç§°å’Œé‚®ç®±å¯ä»¥åŠ ä¸Šä»¥ä¸‹ä»£ç ï¼š</p><pre class=" language-html"><code class="language-html">document.body.addEventListener('click', function(e) {    if (e.target.classList.contains('vsubmit')) {        const email = document.querySelector('input[type=email]');        const nick = document.querySelector('input[name=nick]');        const reg = /^[A-Za-z0-9_-\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;        if (!email.value || !nick.value || !reg.test(email.value)) {            const str = `<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>valert txt-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vtext<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>è¯·å¡«å†™æ­£ç¡®çš„æ˜µç§°å’Œé‚®ç®±ï¼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>`;            const vmark = document.querySelector('.vmark');            vmark.innerHTML = str;            vmark.style.display = 'block';            e.stopPropagation();            setTimeout(function() {                vmark.style.display = 'none';                vmark.innerHTML = '';            }, 2500);        }    }    }, true);</code></pre><p>è¯´æ˜ï¼šä»£ç éåŸåˆ›ï¼ŒJSæ­£åˆ™éªŒè¯æœ¬èº«ä¹Ÿä¸éš¾ã€‚</p><p>å¥½äº†å¯ä»¥éƒ¨ç½²ä¹‹åè‡ªå·±æµ‹è¯•ä¸€ä¸‹ã€‚</p><p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¡«å†™æ˜µç§°é‚®ç®±å’Œç½‘å€çš„åœ°æ–¹å¦‚æœæŠ˜è¡Œäº†å°±æŒ‰æˆ‘çš„æ ·å¼æ”¹ä¸€ä¸‹å°±å¥½ï¼š</p><p>åœ¨ <code>valine.ejs</code> æ˜¯ä¸Šé¢å¯¹ç€æ”¹ä¸€ä¸‹å°±å¥½äº†ï¼š</p><pre class=" language-html"><code class="language-html">.v[data-class="v"] .vwrap .vheader .vinput {  width: 32%;  border-bottom: 1px dashed #dedede;}</code></pre><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a><br><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a><br><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a><br><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a><br><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a><br><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a><br><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a><br><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a><br><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a><br><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a><br><a href="5a99eb4d.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a><br><a href="5a99eb4d.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</title>
      <link href="/posts/1c633c7e.html"/>
      <url>/posts/1c633c7e.html</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å®¢æœèŠå¤©çª—å£"><a href="#ä¸€ã€å®¢æœèŠå¤©çª—å£" class="headerlink" title="ä¸€ã€å®¢æœèŠå¤©çª—å£"></a>ä¸€ã€å®¢æœèŠå¤©çª—å£</h2><blockquote><p>è¿™ä¸ªæ˜¯æˆ‘åœ¨Sky03çš„åšå®¢å‘ç°çš„ï¼Œæœ€åˆæ„Ÿè§‰é—®é—®é¢˜æ–¹é¢ï¼Œæˆ‘å®é™…ä½¿ç”¨ä¹‹åï¼Œä¸»è¦æ„Ÿè§‰è¿˜æ˜¯å¯ä»¥ç›‘æ§æ˜¯å¦æœ‰äººè®¿é—®ç½‘ç«™ã€‚è¿˜æœ‰å°±æ˜¯å¦‚æœæœ‰é—®é¢˜ä¹Ÿå¯ä»¥æé—®ï¼Œåªæ˜¯æ¶ˆæ¯ç•¥æœ‰å»¶è¿Ÿã€‚</p></blockquote><p>1ã€åœ¨å®˜ç½‘æ³¨å†Œè´¦å·</p><p>å®˜ç½‘åœ°å€ï¼š<a href="https://app.crisp.chat/initiate/signup/" target="_blank" rel="noopener">ç‚¹æˆ‘å»crispå®˜ç½‘æ³¨å†Œ</a></p><p>2ã€æ³¨å†Œå®Œæˆåè®¾ç½®</p><p>ç™»å½•åˆšæ‰æ³¨å†Œçš„è´¦æˆ·â€”â€”è®¾ç½®â€”â€”ç½‘ç«™è®¾ç½®â€”â€”æ·»åŠ ç½‘ç«™ã€‚</p><p>æ·»åŠ å®Œæˆä¹‹åå°±å¤šäº†ä¸€è¡Œç½‘ç«™ä¿¡æ¯ã€‚ç‚¹ç½‘ç«™æ•´åˆï¼Œå°±æœ‰ä¸åŒçš„ç«™çš„æ•´åˆæ–¹å¼ã€‚</p><p>æ¯”å¦‚ï¼šhtmlæ–¹å¼</p><p>å°±æ˜¯å¤åˆ¶JSä»£ç ç‰‡æ®µåˆ°ä½ çš„åˆ°<code>head</code>æ ‡ç­¾é‡Œã€‚</p><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>window<span class="token punctuation">.</span>$crisp<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>CRISP_WEBSITE_ID<span class="token operator">=</span><span class="token string">"xxxxxxx-097e-402f-bb6b-xxxxxxx"</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>d<span class="token operator">=</span>document<span class="token punctuation">;</span>s<span class="token operator">=</span>d<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token string">"https://client.crisp.chat/l.js"</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span><span class="token keyword">async</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>d<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"head"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>3ã€å…¶ä»–çš„è®¾ç½®ä¹Ÿ<br>ç™»å½•åˆšæ‰æ³¨å†Œçš„è´¦æˆ·â€”â€”è®¾ç½®â€”â€”ç½‘ç«™è®¾ç½®ã€‚<br>ç½‘ç«™ä¿¡æ¯è¡Œâ€”â€”è®¾ç½®ï¼Œè‡ªå·±æ ¹æ®éœ€è¦è®¾ç½®å³å¯ï¼Œæ¯”å¦‚æ˜¾ç¤ºä½ç½®ï¼Œé¢œè‰²ï¼Œè‡ªå·±çš„å¤´åƒç­‰ã€‚</p><p>æ•´ä¸ªä½¿ç”¨éå¸¸ç®€å•çš„ã€‚</p><h2 id="äºŒã€ç½‘é¡µæ¨é€æ’ä»¶"><a href="#äºŒã€ç½‘é¡µæ¨é€æ’ä»¶" class="headerlink" title="äºŒã€ç½‘é¡µæ¨é€æ’ä»¶"></a>äºŒã€ç½‘é¡µæ¨é€æ’ä»¶</h2><blockquote><p>è¿™ä¸ªæ˜¯æˆ‘åœ¨è¿‡å®¢åŠ±ã‚€çš„åšå®¢å‘ç°çš„ï¼Œæ„Ÿè§‰è¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚ Web Push Notification ,æµè§ˆå™¨é€šçŸ¥æ¨é€</p></blockquote><p>1ã€å®‰è£…æ’ä»¶</p><p>æ’ä»¶çš„GitHubä»“åº“: <a href="https://github.com/glazec/hexo-web-push-notification" target="_blank" rel="noopener">hexo-web-push-notification</a></p><p>æ‰§è¡Œå‘½ä»¤å®‰è£…ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> i hexo-web-push-notification --save</code></pre><p>2ã€ä¿®æ”¹æ ¹ç›®å½•çš„<code>_config.yml</code>é…ç½®æ–‡ä»¶</p><pre class=" language-yml"><code class="language-yml">webPushNotification:  webpushrKey: "your webpushr rest api key"  webpushrAuthToken: "your webpushr authorize token"  trackingCode: "AEGlpbdgvBCWXqXI6PtsUzobY7TLV9gwJU8bzMktrwfrSERg_xnLVbjpCw8x2GmFmi1ZcLTz0ni6OnX5MAwoM88"</code></pre><p>å…¶ä¸­<code>webpushrKey</code>,<code>webpushrAuthToken</code>å’Œ<code>trackingCode</code>çš„å€¼åœ¨å®˜ç½‘æ³¨å†Œå¾—åˆ°ã€‚</p><p>3ã€æ³¨å†Œwebpushr</p><p>æ³¨å†Œå®˜ç½‘ï¼š<a href="https://app.webpushr.com/signup" target="_blank" rel="noopener">ç‚¹æˆ‘å»webpushræ³¨å†Œä¹Ÿ</a></p><p><strong>ç‰¹åˆ«è¯´æ˜ï¼š</strong><br>æ³¨å†Œè´¦å·å’Œç™»å½•éœ€è¦è¿›è¡Œäººæœºèº«ä»½éªŒè¯ï¼Œè¿™ä¸ªéœ€è¦ä½¿ç”¨è¿‡å®¢åŠ±ã‚€çš„æ’ä»¶ï¼Œæ°¸ä¹…ç ´è§£ç‰ˆçš„ã€‚</p><p>æ’ä»¶åœ°å€ï¼š [å¤§ä½¬çš„æ’ä»¶]ï¼ˆ<a href="https://72k.us/file/19365016-441665146ï¼‰" target="_blank" rel="noopener">https://72k.us/file/19365016-441665146ï¼‰</a></p><p>å¦‚æœä¸Šé¢é“¾æ¥å¤±æ•ˆå°±æ¥<a href="https://pan.baidu.com/s/1D7n6xvPZUxRuZsGP9doarw" target="_blank" rel="noopener">ç™¾åº¦äº‘é“¾æ¥</a></p><p>æå–ç ï¼šbp7s</p><p>ç„¶åæ”¾åœ¨æµè§ˆå™¨çš„æ‰©å±•ä¸­ï¼Œåœ¨å¼ºåˆ¶åˆ·æ–°ç½‘ç«™(Ctrl + F5),åº”è¯¥å°±å¯ä»¥çœ‹åˆ°äº†ã€‚å¦‚æœçœ‹ä¸æ‡‚å°±å…ˆç‚¹æ³¨å†Œæˆ–ç™»å½•ï¼Œå°±å¯ä»¥è‡ªå·±å‡ºæ¥äº†ã€‚</p><p>4ã€å®‰è£…</p><p>å°±æ˜¯æŒ‰é¡ºåºï¼Œå¡«å†™ä¿¡æ¯ï¼Œä¸Šä¼ å›¾ç‰‡ï¼Œä¸‰æ­¥èµ°ã€‚</p><p>å®‰è£…æˆåŠŸåï¼Œè¿›å…¥ä¸»ç•Œé¢ã€‚</p><p>ç‚¹å‡»<code>Integration</code>ä¸‹çš„ <code>REST APIå¯†é’¥</code>å°±å¯ä»¥çœ‹åˆ°<code>webpushrKey</code>å’Œ<code>webpushrAuthToken</code>çš„å€¼äº†ã€‚</p><p>ç‚¹å‡»<code>Setting</code>ä¸‹çš„ <code>Tracking code</code></p><p>æœ‰ä¸ª <code>Step 2: Add Tracking Code</code>åœ°ä¸‹ä¹Ÿæ˜¯JSä»£ç ç‰‡æ®µ</p><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- start webpushr tracking code --></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span>d<span class="token punctuation">,</span> s<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>webpushr<span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>w<span class="token punctuation">.</span>webpushr<span class="token operator">=</span>w<span class="token punctuation">.</span>webpushr<span class="token operator">||</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>webpushr<span class="token punctuation">.</span>q<span class="token operator">=</span>w<span class="token punctuation">.</span>webpushr<span class="token punctuation">.</span>q<span class="token operator">||</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">var</span> js<span class="token punctuation">,</span> fjs <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>js <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> js<span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>js<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"https://cdn.webpushr.com/app.min.js"</span><span class="token punctuation">;</span>fjs<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>js<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span>document<span class="token punctuation">,</span> <span class="token string">'script'</span><span class="token punctuation">,</span> <span class="token string">'webpushr-jssdk'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">webpushr</span><span class="token punctuation">(</span><span class="token string">'setup'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'key'</span><span class="token punctuation">:</span><span class="token string">'xxxx_BJKMKcoDBNWov5xxxhl3p0eFxxxxgogE5bQRheUA7eytp5rcZXYHdodyiVfbOxxxxPfv4'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>æœ€åkeyçš„å€¼å°±æ˜¯ <code>trackingCode</code>ã€‚</p><p>5ã€è®¾ç½®æ¨é€ç›¸å…³</p><p>ä¸»è¦è®¾ç½®åœ¨<code>Setting</code>ä¸‹çš„å‰é¢ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼š<br>ï¼ˆAï¼‰Opt-In Prompts â€”-é€‰æ‹©åŠ å…¥æç¤º<br>ï¼ˆBï¼‰Subscription Bell   â€”-è®¢é˜…é“ƒ<br>ï¼ˆCï¼‰Welcome Push   â€”â€”æ¬¢è¿æ¨é€</p><p>å› ä¸ºæˆ‘å·²ç»æ“ä½œå®Œæˆå°±ä¸æˆªå›¾äº†ï¼Œåªåšäº†ä¸€ä¸ªè®°å½•ã€‚ä½¿ç”¨è°·æ­Œæœ‰è°·æ­Œç¿»è¯‘ï¼Œåº”è¯¥æ²¡æœ‰çœ‹ä¸æ‡‚çš„ã€‚<br>å¦‚æœä¸æƒ³è‡ªå·±æ‘¸ç´¢ï¼Œå¯ä»¥å‚è€ƒè¿‡å®¢åŠ±ã‚€å†™çš„ç»†èŠ‚æ“ä½œçš„æˆªå›¾æ–‡<a href="https://yafine-blog.cn/posts/ebb2.html" target="_blank" rel="noopener">ã€ŠHexoåšå®¢è®¢é˜…æ–‡ç« é€šçŸ¥åŠŸèƒ½ã€‹</a>ã€‚</p><p>æœ€åæ„Ÿè°¢å¤§ä½¬è®©æˆ‘è§è¯†äº†æ–°æŠ€æœ¯ã€‚</p><p>6ã€é‡åˆ°çš„é—®é¢˜</p><p>ä½¿ç”¨materyä¸»é¢˜ï¼š</p><p>å¦‚æœä»¥ä¸Šé…ç½®éƒ½å¥½äº†ï¼Œé‚£ä¹ˆå¯ä»¥é‡æ–°éƒ¨ç½²äº†ï¼Œä¸€å®šè¦éƒ¨ç½²ä¸¤æ¬¡ï¼Œæ˜¯å¦æ¨é€æ–°æ–‡ç« ï¼Œæ˜¯æ¯”è¾ƒ<code>public/newPost.json</code>æ–‡ä»¶çš„å˜åŒ–ã€‚å¦‚æœèµ°åˆ°è¿™ä¸€æ­¥ï¼Œä½ æ¨é€OKäº†ï¼Œé‚£ä¹ˆæ­å–œä½ æ²¡æœ‰é—®é¢˜ã€‚</p><p>å¦‚æœä½ éƒ¨ç½²ä¹‹åå‘ç°ä¸æ¨é€ï¼Ÿ</p><p>é¦–å…ˆæ£€æŸ¥æµè§ˆå™¨é€šçŸ¥æ˜¯å¦ç¦ç”¨ï¼Œå¦‚æœç¦ç”¨äº†ï¼Œæ˜¯æ— æ³•é€šçŸ¥çš„ã€‚</p><p>å…¶æ¬¡æ£€æŸ¥ä½ çš„<code>public/newPost.json</code>æ–‡ä»¶ï¼Œçœ‹çœ‹é”®å€¼æ˜¯å¦é½å…¨ã€‚å¦‚æœä½ çš„summaryæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä½ é‡åˆ°äº†è·Ÿæˆ‘ä¸€æ ·çš„é—®é¢˜ã€‚</p><p>è§£å†³ï¼š ä¿®æ”¹ <code>node_modules/hexo-web-push-notification/index.js</code>æ–‡ä»¶ä¸­ç¬¬22è¡Œ<code>&#39;summary&#39;: util.stripHTML(newPost.excerpt),</code>è¿™é‡Œå–å€¼å–çš„æ˜¯excerptï¼Œæ”¹æˆsummaryå³å¯ã€‚</p><pre class=" language-java"><code class="language-java">var JSONFeed <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">'title'</span><span class="token operator">:</span> newPost<span class="token punctuation">.</span>title<span class="token punctuation">,</span>        <span class="token string">'id'</span><span class="token operator">:</span> newPost<span class="token punctuation">.</span>path<span class="token punctuation">,</span>        <span class="token string">'date_published'</span><span class="token operator">:</span> newPost<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'summary'</span><span class="token operator">:</span> util<span class="token punctuation">.</span><span class="token function">stripHTML</span><span class="token punctuation">(</span>newPost<span class="token punctuation">.</span>excerpt<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'url'</span><span class="token operator">:</span> newPost<span class="token punctuation">.</span>permalink<span class="token punctuation">,</span>        <span class="token string">'tags'</span><span class="token operator">:</span> newPost<span class="token punctuation">.</span>tags<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">function</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'categories'</span><span class="token operator">:</span> newPost<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">function</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span></code></pre><p>å¦‚æœä½ æ‹…å¿ƒæ”¹é”™äº†ï¼Œä¹Ÿå¯ä»¥åœ¨ä½ çš„æ–‡ç« å¤´éƒ¨æ·»åŠ å±æ€§excerptï¼Œå€¼å’Œsummaryä¸€æ ·å³å¯ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€<span class="token key atrule">tags</span><span class="token punctuation">:</span> Hexo<span class="token key atrule">categories</span><span class="token punctuation">:</span> Hexo<span class="token key atrule">summary</span><span class="token punctuation">:</span> hexoåšå®¢çš„å®¢æœæ’ä»¶å’Œæ¨é€æ’ä»¶ç›¸å…³ã€‚<span class="token key atrule">excerpt</span><span class="token punctuation">:</span> hexoåšå®¢çš„å®¢æœæ’ä»¶å’Œæ¨é€æ’ä»¶ç›¸å…³ã€‚<span class="token key atrule">keywords</span><span class="token punctuation">:</span> <span class="token string">'hexo,hexoä¸»é¢˜'</span><span class="token key atrule">author</span><span class="token punctuation">:</span> Small<span class="token punctuation">-</span>Rose / å¼ å°èœè‹”<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2020-06-27 00:00:00</span></code></pre><p>ä½¿ç”¨å…¶ä»–ä¸»é¢˜ï¼š</p><p>ä½¿ç”¨å…¶ä»–ä¸»é¢˜ï¼Œ<code>newPost.json</code>æ–‡ä»¶é‡Œçš„<code>summary</code>è·å–çš„åˆ™æ˜¯â€”å’Œ<code>&lt;!-- more --&gt;</code>ä¹‹é—´çš„æ–‡æœ¬å†…å®¹ã€‚åŸºæœ¬ä¸Šé€‚ç”¨äºå¤§éƒ¨åˆ†ä¸»é¢˜ã€‚</p><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a><br><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a><br><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a><br><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a><br><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a><br><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a><br><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a><br><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a><br><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a><br><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a><br><a href="a53a9069.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql-Access denied for</title>
      <link href="/posts/7c170969.html"/>
      <url>/posts/7c170969.html</url>
      
        <content type="html"><![CDATA[<h2 id="Linuxä¸‹MySQLçš„Access-denied-for-user"><a href="#Linuxä¸‹MySQLçš„Access-denied-for-user" class="headerlink" title="Linuxä¸‹MySQLçš„Access denied for user"></a>Linuxä¸‹MySQLçš„Access denied for user</h2><blockquote><p>ä½¿ç”¨ç¯å¢ƒï¼šCentos7.4 ï¼ŒMysql5.7</p></blockquote><h3 id="1ã€rootä¸èƒ½åœ¨ç‰ˆæœ¬åœ°ç™»å½•"><a href="#1ã€rootä¸èƒ½åœ¨ç‰ˆæœ¬åœ°ç™»å½•" class="headerlink" title="1ã€rootä¸èƒ½åœ¨ç‰ˆæœ¬åœ°ç™»å½•"></a>1ã€rootä¸èƒ½åœ¨ç‰ˆæœ¬åœ°ç™»å½•</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong></p><p>åœ¨linuxå‘½ä»¤è¡Œç”¨mysql -uroot -ppasswaord ç™»å½•å´æŠ¥äº†è¿™ä¹ˆä¸ªé”™ï¼š</p><p>ERROR 1045 (28000): Access denied for user â€˜rootâ€™@â€™localhostâ€™ (using password: YES)</p><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><p>ï¼ˆ1ï¼‰é¦–å…ˆè¦ç¡®å®šç™»å½•å¯†ç æ­£ç¡®ï¼Œå¦‚æœå¯†ç ä¸å¯¹ä¹Ÿä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ã€‚ï¼ˆå¯ä»¥çœ‹åº”ç”¨é‡Œè¿æ¥é…ç½®ç¡®è®¤ï¼‰</p><p>ï¼ˆ2ï¼‰å¦‚æœå¯†ç æ­£ç¡®ä¹‹åè¿˜æ˜¯ä¸èƒ½è¿æ¥ï¼š</p><p>â€‹    ï¼ˆaï¼‰ç¼–è¾‘<code>/etc/my.cnf</code>çš„mysqldä¸‹ æ·»åŠ <code>skip-grant-tables</code></p><p>â€‹    ï¼ˆbï¼‰é‡å¯MySQLæœåŠ¡ï¼Œæ ¹æ®ç‰ˆæœ¬é€‰æ‹©ã€‚</p><pre class=" language-bash"><code class="language-bash"><span class="token function">service</span> mysqld restartsystemctl restart mysqld.service</code></pre><p>â€‹    ï¼ˆcï¼‰ç›´æ¥mysql -uroot ç™»å½•</p><p>â€‹    ï¼ˆdï¼‰ä¿®æ”¹MySQLå¯†ç </p><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true"># 5.7ä¹‹å‰</span><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> password<span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">'your_password'</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">'root'</span> <span class="token operator">and</span> host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"># 5.7ä¹‹å</span><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> authentication_string<span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">'your_password'</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">'root'</span> <span class="token operator">and</span> host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">;</span>flush <span class="token keyword">privileges</span><span class="token punctuation">;</span></code></pre><p>â€‹    ï¼ˆeï¼‰æ³¨é‡Šæ‰<code>skip-grant-table</code>ã€é‡å¯MySQLæœåŠ¡ã€‚å†æ¬¡ç™»å½•éªŒè¯å³å¯ã€‚</p><h3 id="2ã€ç”¨æˆ·ä¸èƒ½åœ¨éæœ¬åœ°ç™»å½•"><a href="#2ã€ç”¨æˆ·ä¸èƒ½åœ¨éæœ¬åœ°ç™»å½•" class="headerlink" title="2ã€ç”¨æˆ·ä¸èƒ½åœ¨éæœ¬åœ°ç™»å½•"></a>2ã€ç”¨æˆ·ä¸èƒ½åœ¨éæœ¬åœ°ç™»å½•</h3><p><strong>é—®é¢˜æè¿°ï¼š</strong></p><p>ä¸€èˆ¬å‡ºç°åœ¨å®¢æˆ·ç«¯è¿æ¥mysqlæœåŠ¡çš„æ—¶å€™ï¼š</p><p>mysql access denied for user root@ip useing password</p><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><p>ï¼ˆ1ï¼‰é¦–å…ˆç¡®ä¿å¯†ç æ­£ç¡®</p><p>ï¼ˆ2ï¼‰å¦‚æœå¯†ç æ­£ç¡®è¿˜æ˜¯ä¸èƒ½è¿æ¥ï¼Œè¯´æ˜ç¼ºå°‘æˆæƒã€‚</p><p>â€‹    ï¼ˆaï¼‰mysql -uroot åœ¨æœåŠ¡ç«¯ç™»å½•</p><p>â€‹    ï¼ˆbï¼‰æŸ¥è¯¢ç”¨æˆ·ç™»å½•çš„æˆæƒçŠ¶æ€</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">use</span> mysql<span class="token punctuation">;</span><span class="token keyword">select</span> host<span class="token punctuation">,</span><span class="token keyword">user</span> <span class="token keyword">from</span> <span class="token keyword">user</span><span class="token punctuation">;</span></code></pre><p>â€‹    ï¼ˆcï¼‰ç¡®è®¤ç”¨æˆ·åœ¨æŒ‡å®šIPæ²¡æœ‰æˆæƒï¼Œå°±æˆæƒ</p><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- é€‚ç”¨äºå¼€å‘è´¦æˆ·ï¼Œæˆæƒrootåœ¨ä»»æ„ä¸»æœºç™»å½•ï¼Œæ‹¥æœ‰å…¨éƒ¨schemaçš„å…¨éƒ¨è¡¨çš„å…¨éƒ¨æƒé™</span><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'root'</span>@'<span class="token operator">%</span><span class="token string">' IDENTIFIED BY '</span>your_password' <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- åˆ·æ–°æƒé™ï¼Œåˆ·æ–°ä¹‹åå®¢æˆ·ç«¯éœ€è¦é‡æ–°è¿æ¥æ–¹å¯ç”Ÿæ•ˆ</span>FLUSH   <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span></code></pre><p>â€‹    ï¼ˆdï¼‰å®¢æˆ·ç«¯é‡æ–°è¿æ¥å³å¯ã€‚</p><p><font color="red" >ç‰¹åˆ«è¯´æ˜ï¼š</font>å¦‚æœå¯¹æƒé™ç®¡ç†æ¯”è¾ƒä¸¥æ ¼ï¼Œå¯ä»¥æŒ‰IPæˆæƒï¼Œä¹Ÿå¯ä»¥æŒ‰ç½‘æ®µæˆæƒï¼Œå¯ä»¥æˆæƒä¸åŒçš„æƒé™çº§åˆ«ï¼Œå¯ä»¥æˆæƒä¸åŒæ“ä½œæƒé™ç­‰ç›¸å…³æ“ä½œï¼Œå¯ä»¥å‚è€ƒå…³äºMysqlæˆæƒçš„çš„å†…å®¹åœ¨ã€ŠMysqlå¸¸ç”¨å‘½ä»¤ã€‹ä¸­çš„æˆæƒéƒ¨åˆ†ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DB2-å¸¸è§ERRORCODE</title>
      <link href="/posts/9f154069.html"/>
      <url>/posts/9f154069.html</url>
      
        <content type="html"><![CDATA[<h2 id="DB2-å¸¸è§ERRORCODE"><a href="#DB2-å¸¸è§ERRORCODE" class="headerlink" title="DB2-å¸¸è§ERRORCODE"></a>DB2-å¸¸è§ERRORCODE</h2><p>å¯¹äºå¸¸è§çš„é”™è¯¯ç ï¼Œç†Ÿæ‚‰ä¹‹åå°±å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜ï¼Œä»£ç æ£€æŸ¥ã€‚</p><h4 id="1ã€sqlcode-407"><a href="#1ã€sqlcode-407" class="headerlink" title="1ã€sqlcode -407"></a>1ã€sqlcode -407</h4><p>ä¸èƒ½æŠŠNULLå€¼æ’å…¥åˆ°å®šä¹‰ä¸ºNOT NULLçš„åˆ—</p><pre class=" language-txt"><code class="language-txt">DB2 SQL Error: SQLCODE=-407, SQLSTATE=23502, SQLERRMC=TBSPACEID=2, TABLEID=19, COLNO=5, DRIVER=4.15.134</code></pre><p> å¯ä»¥æ‰§è¡ŒSQLï¼Œå°±å¯ä»¥å¿«é€Ÿå®šä½å“ªä¸ªåˆ—å‡ºäº†é—®é¢˜ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> C<span class="token punctuation">.</span>TABSCHEMA<span class="token punctuation">,</span> C<span class="token punctuation">.</span>TABNAME<span class="token punctuation">,</span> C<span class="token punctuation">.</span>COLNAME <span class="token keyword">FROM</span> SYSCAT<span class="token punctuation">.</span><span class="token keyword">TABLES</span> <span class="token keyword">AS</span> T<span class="token punctuation">,</span> SYSCAT<span class="token punctuation">.</span><span class="token keyword">COLUMNS</span> <span class="token keyword">AS</span> C <span class="token keyword">WHERE</span> T<span class="token punctuation">.</span>TBSPACEID <span class="token operator">=</span> <span class="token number">2</span>  <span class="token operator">AND</span> T<span class="token punctuation">.</span>TABLEID <span class="token operator">=</span><span class="token number">19</span> <span class="token operator">AND</span> C<span class="token punctuation">.</span>COLNO <span class="token operator">=</span> <span class="token number">5</span>  <span class="token operator">AND</span> C<span class="token punctuation">.</span>TABSCHEMA <span class="token operator">=</span> T<span class="token punctuation">.</span>TABSCHEMA <span class="token operator">AND</span> C<span class="token punctuation">.</span>TABNAME <span class="token operator">=</span> T<span class="token punctuation">.</span>TABNAME</code></pre><p>2ã€å…¶ä»–å¸¸è§é”™è¯¯ç </p><table><thead><tr><th>sqlcode</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-104</td><td>SQLä¸­æœ‰éæ³•å­—ç¬¦ï¼Œå¤šåŠæ˜¯æ ‡ç‚¹ç¬¦å·é—®é¢˜</td></tr><tr><td>-205</td><td>æŒ‡å®šè¡¨çš„åˆ—åæ— æ•ˆ</td></tr><tr><td>-206</td><td>æŸ¥è¯¢çš„åˆ—ä¸åœ¨FROMåçš„è¡¨é‡Œ,å³åˆ—å’Œè¡¨é‡Œçš„åˆ—ä¸å¯¹åº”</td></tr><tr><td>-208</td><td>ä¸èƒ½order by æŒ‡å®šçš„åˆ—ï¼Œåˆ—ä¸åœ¨selectåˆ—è¡¨ä¸­</td></tr><tr><td>-302 22003</td><td>è¾“å…¥å˜é‡å€¼å¯¹åˆ—æ¥è¯´</td></tr><tr><td>-412</td><td>å­æŸ¥è¯¢çš„selectåˆ—è¡¨é‡åˆ°å¤šä¸ªåˆ—</td></tr><tr><td>-415</td><td>ä½¿ç”¨UNIONæ“ä½œï¼ŒæŒ‡å®šçš„åˆ—ç±»å‹ä¸å…¼å®¹</td></tr><tr><td>-918</td><td>è¿æ¥ä¸¢å¤±ï¼ŒSQLä¸èƒ½æ‰§è¡Œ</td></tr></tbody></table><p>3ã€DB2é”™è¯¯ç å¤§å…¨</p><p>å¯ä»¥ä¸‹è½½<a href="https://github.com/small-rose/papers/blob/master/DB2%20SQLCODE%20%E5%A4%A7%E5%85%A8.pdf" target="_blank" rel="noopener">DB2 SQLCODE.pdf</a>æŸ¥çœ‹æ›´å¤šé”™è¯¯ç è¯´æ˜ã€‚</p><br/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> DB2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DB2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybtis(å››)å·¥ä½œåŸç†</title>
      <link href="/posts/3bfa75b5.html"/>
      <url>/posts/3bfa75b5.html</url>
      
        <content type="html"><![CDATA[<h2 id="Mybtis-å››-å·¥ä½œåŸç†"><a href="#Mybtis-å››-å·¥ä½œåŸç†" class="headerlink" title="Mybtis(å››)å·¥ä½œåŸç†"></a>Mybtis(å››)å·¥ä½œåŸç†</h2><h3 id="ä¸€ã€Mybatisæ¶‰åŠæŠ€æœ¯"><a href="#ä¸€ã€Mybatisæ¶‰åŠæŠ€æœ¯" class="headerlink" title="ä¸€ã€Mybatisæ¶‰åŠæŠ€æœ¯"></a>ä¸€ã€Mybatisæ¶‰åŠæŠ€æœ¯</h3><p>mybatisè¿è¡Œä¸»è¦ä¸¤éƒ¨åˆ†ï¼š</p><p>ï¼ˆ1ï¼‰è¯»å–é…ç½®æ–‡ä»¶æ¢ä¹˜åˆ°Configurationå¯¹è±¡ï¼Œç”¨ä»¥åˆ›å»ºSqlSessionFactory</p><p>ï¼ˆ2ï¼‰SqlSessionæ‰§è¡Œè¿‡ç¨‹ã€‚</p><p>SqlSessionæ‰§è¡Œè¿‡ç¨‹æ¶‰åŠæŠ€æœ¯ï¼š</p><p>åå°„æŠ€æœ¯ã€åŠ¨æ€ä»£ç†æŠ€æœ¯ã€‚</p><p>ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼ï¼Ÿ</p><p>ä»£ç†æ¨¡å¼å°±æ˜¯åœ¨åŸæœ‰çš„æœåŠ¡ä¸Šå¤šåŠ ä¸€ä¸ªå ä½ï¼Œé€šè¿‡å ä½å»æ§åˆ¶æœåŠ¡çš„è®¿é—®ã€‚</p><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Ÿ</p><p>é€šè¿‡ä»£ç†ä¸€æ–¹é¢å¯ä»¥æ§åˆ¶å¦‚ä½•è®¿é—®çœŸæ­£çš„æœåŠ¡å¯¹è±¡ï¼Œæä¾›é¢å¤–æœåŠ¡ã€‚å¦ä¸€æ–¹é¢æœ‰æœºä¼šé€šè¿‡é‡å†™ä¸€äº›ç±»æ¥æ»¡è¶³ç‰¹å®šçš„éœ€è¦ã€‚</p><p>ä¸€èˆ¬åŠ¨æ€ä»£ç†åˆ†ä¸¤ç§ï¼š</p><p>ï¼ˆAï¼‰JDKåå°„æœºåˆ¶æä¾›çš„ä»£ç†ã€‚å¿…é¡»æä¾›æ¥å£ã€‚</p><p>ï¼ˆBï¼‰CGLIBä»£ç†ã€‚ä¸éœ€è¦æä¾›æ¥å£ã€‚ CGlibåº•å±‚æ˜¯åŠ¨æ€çš„åœ¨å†…å­˜ä¸­ç”Ÿæˆäº†ç›®æ ‡å¯¹è±¡çš„å­ç±»çš„å­—èŠ‚ç ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„å¯¹è±¡ ã€‚</p><h4 id="1ã€åå°„ç®€å•çš„ç¤ºä¾‹"><a href="#1ã€åå°„ç®€å•çš„ç¤ºä¾‹" class="headerlink" title="1ã€åå°„ç®€å•çš„ç¤ºä¾‹"></a>1ã€åå°„ç®€å•çš„ç¤ºä¾‹</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">.</span>reflect<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>InvocationTargetException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SayService</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>String someOne<span class="token punctuation">)</span><span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" hello ,"</span> <span class="token operator">+</span>someOne <span class="token operator">+</span><span class="token string">" !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> InstantiationException<span class="token punctuation">,</span> IllegalAccessException<span class="token punctuation">,</span> ClassNotFoundException<span class="token punctuation">,</span> NoSuchMethodException<span class="token punctuation">,</span> SecurityException<span class="token punctuation">,</span> IllegalArgumentException<span class="token punctuation">,</span> InvocationTargetException <span class="token punctuation">{</span>             <span class="token comment" spellcheck="true">//é€šè¿‡åå°„åˆ›å»ºSayServiceå¯¹è±¡</span>            Object service <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>SayService<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">//è·å–æœåŠ¡çš„æ–¹æ³•</span>            Method method <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"sayHello"</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">//åå°„è°ƒç”¨æœåŠ¡çš„æ–¹æ³•    </span>            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> <span class="token string">"zhangxiaocai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œè¾“å‡ºï¼š</p><pre><code> hello ,zhangxiaocai !</code></pre><p>åå°„çš„å¥½å‡ºæ˜¯é…ç½®æ€§æé«˜ï¼ŒspringIOCå®¹å™¨ä¹Ÿæ˜¯ä½¿ç”¨åå°„æœºåˆ¶å®ç°ã€‚</p><h4 id="2ã€JDKåŠ¨æ€ä»£ç†"><a href="#2ã€JDKåŠ¨æ€ä»£ç†" class="headerlink" title="2ã€JDKåŠ¨æ€ä»£ç†"></a>2ã€JDKåŠ¨æ€ä»£ç†</h4><p>æ”¯æŒåŒ…ï¼š<code>java.lang.reflect.*</code></p><p>å®ç°JDKåŠ¨æ€ä»£ç†æ­¥éª¤ï¼š</p><p>ï¼ˆ1ï¼‰ç¼–å†™æœåŠ¡ç±»å’Œæ¥å£ï¼Œæ˜¯çœŸæ­£çš„æœåŠ¡æä¾›è€…ï¼Œåœ¨JDKä»£ç†è¿™æ¥å£æ˜¯å¿…é¡»çš„ã€‚</p><p>ï¼ˆ2ï¼‰ç¼–å†™ä»£ç†ç±»ï¼Œæä¾›ç»‘å®šå’Œä»£ç†æ–¹æ³•ã€‚</p><p>æœåŠ¡æ¥å£ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">.</span>jdktest<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SayServiceI</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>String someOne<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æœåŠ¡å®ç°ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">.</span>jdktest<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SayServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SayServiceI</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>String someOne<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" hello ,"</span> <span class="token operator">+</span> someOne <span class="token operator">+</span> <span class="token string">" !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æœåŠ¡ä»£ç†ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">.</span>jdktest<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>InvocationHandler<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Proxy<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SayServiceProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//éœ€è¦æŒæœ‰çœŸå®çš„ç›®æ ‡æœåŠ¡</span>    <span class="token keyword">private</span> Object target<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">SayServiceProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//æ„é€ æ³•ç»‘å®šå§”æ‰˜å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token function">SayServiceProxy</span><span class="token punctuation">(</span>Object object<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> object<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//ç»‘å®šå§”æ‰˜å¯¹è±¡å¹¶è¿”å›ä»£ç†ç±»</span>    <span class="token keyword">public</span> Object <span class="token function">bind</span><span class="token punctuation">(</span>Object object<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> object<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å–å¾—ä»£ç†å¯¹è±¡</span>        Object proxy <span class="token operator">=</span> Proxy<span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  proxy<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•é¦–å…ˆä¼šè¿›å…¥æ­¤æ–¹æ³•     * @param proxy -----ä»£ç†å¯¹è±¡     * @param method ------è°ƒç”¨æ–¹æ³•     * @param args ----æ–¹æ³•å‚æ•°     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Object <span class="token function">invoke</span><span class="token punctuation">(</span>Object proxy<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>        Object result <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//System.out.println("----proxy = " + proxy.toString());</span>        <span class="token comment" spellcheck="true">//System.out.println("----proxy = " + proxy.hashCode());</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----proxy = "</span> <span class="token operator">+</span> proxy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----method = "</span> <span class="token operator">+</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---åå°„æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---åå°„æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è°ƒç”¨æµ‹è¯•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">.</span>jdktest<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>InvocationHandler<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Proxy<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SayServiceTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SayServiceProxy proxyHandle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SayServiceProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è°ƒç”¨bindç»‘å®šçš„æ–¹å¼</span>        SayServiceI service <span class="token operator">=</span> <span class="token punctuation">(</span>SayServiceI<span class="token punctuation">)</span> proxyHandle<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SayServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        service<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">"zhangxiaocai.cn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        SayServiceI mysay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SayServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è°ƒç”¨æ„é€ æ–¹æ³•</span>        InvocationHandler handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SayServiceProxy</span><span class="token punctuation">(</span>mysay<span class="token punctuation">)</span><span class="token punctuation">;</span>        SayServiceI proxyHello <span class="token operator">=</span> <span class="token punctuation">(</span>SayServiceI<span class="token punctuation">)</span> Proxy<span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>mysay<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mysay<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>        proxyHello<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">"zhangxiaocai.cn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼Œä¸¤ç§å†™æ³•çš„è°ƒç”¨ç»“æœä¸€è‡´ï¼š</p><pre><code> ----proxy = com.sun.proxy.$Proxy0----method = public abstract void com.ssm.web.demo.test.jdktest.SayServiceI.sayHello(java.lang.String)---åå°„æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨---- hello ,zhangxiaocai.cn !---åå°„æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨--------proxy = com.sun.proxy.$Proxy0----method = public abstract void com.ssm.web.demo.test.jdktest.SayServiceI.sayHello(java.lang.String)---åå°„æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨---- hello ,zhangxiaocai.cn !---åå°„æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨----</code></pre><p>æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœå‡ºç°æ­»å¾ªç¯å¯¼è‡´æ ˆæº¢å‡ºï¼ˆSOFï¼‰ï¼Œæ³¨æ„ä¸‹åˆ—å†™æ³•ä¼šå¯¼è‡´æ­»å¾ªç¯ã€‚</p><pre class=" language-java"><code class="language-java">result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç¬¬ä¸€ä¸ªå‚æ•°å†™å‡ºproxy</span></code></pre><pre class=" language-java"><code class="language-java">System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----proxy = "</span> <span class="token operator">+</span> proxy<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è°ƒç”¨äº†ä»£ç†å¯¹è±¡çš„æ–¹æ³•</span></code></pre><pre class=" language-java"><code class="language-java">System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----proxy = "</span> <span class="token operator">+</span> proxy<span class="token punctuation">.</span><span class="token function">hashcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è°ƒç”¨äº†ä»£ç†å¯¹è±¡çš„æ–¹æ³•</span></code></pre><p>ä»£ç†å¯¹è±¡æ˜¯æ²¡æœ‰è‡ªå·±çš„æ–¹æ³•çš„ï¼Œå®ƒçš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åŸºäºè¢«ä»£ç†å¯¹è±¡ï¼Œ<strong>è€Œè°ƒç”¨ä»£ç†å¯¹è±¡æ–¹æ³•çš„æ—¶å€™ï¼Œéƒ½ä¼šç»è¿‡æ‹¦æˆªå™¨æ–¹æ³•ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨æ‹¦æˆªå™¨ä¸­å†è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼ˆå¦‚toStringï¼Œhashcodeï¼Œequalsç­‰ï¼‰ï¼Œå°±ä¼šå†æ¬¡è¿›å…¥æ‹¦æˆªå™¨ï¼Œè¿™æ ·å°±å½¢æˆäº†æ­»å¾ªç¯ã€‚</strong> </p><p>è¿˜å¯ä»¥</p><blockquote><p>åœ¨jvmå¯åŠ¨æ—¶åŠ ä¸Š-Dsun.misc.ProxyGenerator.saveGeneratedFiles=trueå‚æ•°ï¼Œä¿å­˜ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»å­—èŠ‚ç $Proxy0.class</p><p>ç„¶åå†åˆ©ç”¨åç¼–è¯‘å·¥å…·æŸ¥çœ‹ä»£ç†ç±»$Proxy0.classæºç </p></blockquote><p>å…³äº <code>newProxyInstance</code>fæ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java">Proxy<span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>mysay<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mysay<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç¬¬ä¸€ä¸ªå‚æ•°mysay.getClass().getClassLoader()ï¼Œæ˜¯ç±»åŠ è½½å™¨ã€‚</p><p>ç¬¬äºŒä¸ªå‚æ•°mysay.getClass().getInterfaces()ï¼Œæ˜¯æ¥å£ï¼Œä»£ç†å¯¹è±¡æŒ‚åœ¨å“ªä¸ªæ¥å£ä¸‹é¢ã€‚</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°InvocationHandlerå®ä¾‹ï¼Œå†™åœ¨ä»£ç†ç±»ä¸­æ—¶ç›´æ¥ä½¿ç”¨thisï¼Œè¡¨ç¤ºå½“å‰ä»£ç†ç±»ï¼›å†™åœ¨éä»£ç†ç±»ä¸­åˆ™æ˜¯InvocationHandlerå­ç±»æŒ‡å‘InvocationHandlerè‡ªå·±çš„å¼•ç”¨ã€‚ä¾‹å­ä¸­ä½¿ç”¨äº†ä¸¤ç§ä¸åŒçš„å†™æ³•ã€‚</p><h4 id="3ã€CGLIBåŠ¨æ€ä»£ç†"><a href="#3ã€CGLIBåŠ¨æ€ä»£ç†" class="headerlink" title="3ã€CGLIBåŠ¨æ€ä»£ç†"></a>3ã€CGLIBåŠ¨æ€ä»£ç†</h4><p>å› JDKåŠ¨æ€ä»£ç†å¿…é¡»æä¾›æ¥å£æ‰å¯ä»¥ä½¿ç”¨ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªéš¾é¢˜ï¼ŒCGLIBå‡ºç°äº†ã€‚</p><p>CGLIBæ˜¯å¼€æºæ¡†æ¶ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒæµè¡Œçš„åŠ¨æ€ä»£ç†ã€‚</p><p>CGLIBçš„ä»£ç†ç±»éœ€è¦å®ç°<code>org.springframework.cglib.proxy.MethodInterceptor</code>æ¥å£ã€‚</p><p>ä¸Šä¾‹å­ä¸­çš„æœåŠ¡æ¥å£ç±»å’ŒæœåŠ¡å®ç°ç±»ä¸å˜ï¼Œæ·»åŠ CGLIBä»£ç†ç±»ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">.</span>jdktest<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>Enhancer<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>MethodInterceptor<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>MethodProxy<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SayServiceCglib</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//éœ€è¦æŒæœ‰çœŸå®çš„ç›®æ ‡æœåŠ¡</span>    <span class="token keyword">private</span> Object target<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// åˆ›å»ºä»£ç†å¯¹è±¡</span>    <span class="token keyword">public</span> Object <span class="token function">getInstance</span><span class="token punctuation">(</span>Object object<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> object<span class="token punctuation">;</span>        Enhancer enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è®¾ç½®å›è°ƒæ–¹æ³•</span>        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//åˆ›å»ºä»£ç†å¯¹è±¡å¹¶è¿”å›</span>        <span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Object <span class="token function">intercept</span><span class="token punctuation">(</span>Object proxy<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> MethodProxy methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>        Object result <span class="token operator">=</span> null<span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----proxy = "</span> <span class="token operator">+</span> proxy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----method = "</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---åå°„æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---åå°„æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æµ‹è¯•è¿è¡Œç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">.</span>jdktest<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>InvocationHandler<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Proxy<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>MethodInterceptor<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SayServiceCglibTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        SayServiceI mysay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SayServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MethodInterceptor handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SayServiceCglib</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        SayServiceI proxyHello <span class="token operator">=</span><span class="token punctuation">(</span>SayServiceI<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>SayServiceCglib<span class="token punctuation">)</span> handler<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>mysay<span class="token punctuation">)</span><span class="token punctuation">;</span>        proxyHello<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">"zhangxiaocai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ‰§è¡Œç»“æœ</p><pre><code>----proxy = com.ssm.web.demo.test.jdktest.SayServiceImpl$$EnhancerByCGLIB$$71af915d----method = public void com.ssm.web.demo.test.jdktest.SayServiceImpl.sayHello(java.lang.String)---åå°„æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨---- hello ,zhangxiaocai.cn !---åå°„æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨----</code></pre><p>Mybatisä¸­åœ¨å»¶è¿ŸåŠ è½½æ—¶ä¼šä½¿ç”¨CGLIBåŠ¨æ€ä»£ç†ã€‚</p><h3 id="äºŒã€æ„å»ºSqlSessionFactoryè¿‡ç¨‹"><a href="#äºŒã€æ„å»ºSqlSessionFactoryè¿‡ç¨‹" class="headerlink" title="äºŒã€æ„å»ºSqlSessionFactoryè¿‡ç¨‹"></a>äºŒã€æ„å»ºSqlSessionFactoryè¿‡ç¨‹</h3><p>SqlSessionFactory æ˜¯Mybatisçš„æ ¸å¿ƒç±»ä¹‹ä¸€ï¼Œå®ƒæœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯æä¾›Mybatisæ ¸å¿ƒæ¥å£SqlSessionã€‚</p><h4 id="1ã€æ„å»ºæ­¥éª¤"><a href="#1ã€æ„å»ºæ­¥éª¤" class="headerlink" title="1ã€æ„å»ºæ­¥éª¤"></a>1ã€æ„å»ºæ­¥éª¤</h4><p>Mybatisä½¿ç”¨æ„é€ æ¨¡å¼å»åˆ›å»ºSqlSessionFactoryï¼Œå¤§è‡´è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š</p><p>ï¼ˆ1ï¼‰é€šè¿‡<code>org.apache.ibatis.builder.xml.XMLConfigBuilder</code>è§£æé…ç½®XMLæ–‡ä»¶è¯»å‡ºé…ç½®å‚æ•°ï¼Œå¹¶å°†è¯»å¾—çš„æ•°æ®å­˜å…¥<code>org.apache.ibatis.session.Configuration</code>ç±»ä¸­ã€‚ï¼ˆå‡ ä¹æ‰€æœ‰é…ç½®éƒ½åœ¨è¿™ä¸ªConfigurationç±»ä¸­ï¼‰</p><p>ï¼ˆ2ï¼‰ä½¿ç”¨Configurationå¯¹è±¡åˆ›å»ºSqlSessionFactory ã€‚SqlSessionFactoryæ˜¯æ¥å£ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œä¸€èˆ¬ä½¿ç”¨å®ƒé»˜è®¤çš„å®ç°ç±»<code>org.apache.ibatis.session.defaults.DefaultSqlSessionFactory</code>ã€‚</p><pre class=" language-java"><code class="language-java">sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™ç§åˆ›å»ºæ–¹å¼å°±æ˜¯ä¸€ç§Buidleræ¨¡å¼ã€‚å¯¹äºå¤æ‚çš„å¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨æ„é€ æ–¹æ³•æ„å»ºæ¯”è¾ƒå›°éš¾çš„ï¼Œè¿™ä¼šå¯¼è‡´å¤§é‡çš„é€»è¾‘æ”¾åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œè¿‡ç¨‹åŠå…¶å¤æ‚ã€‚è¿™ç§Builderæ¨¡å¼å€¼å¾—æˆ‘ä»¬å­¦ä¹ ã€‚</p><p>æ„å»ºSqlSessionFactory è¿‡ç¨‹ä¸­ï¼ŒConfigurationæœ€é‡è¦ã€‚</p><h4 id="2ã€Configurationçš„ä¸»è¦ä½œç”¨ï¼š"><a href="#2ã€Configurationçš„ä¸»è¦ä½œç”¨ï¼š" class="headerlink" title="2ã€Configurationçš„ä¸»è¦ä½œç”¨ï¼š"></a>2ã€Configurationçš„ä¸»è¦ä½œç”¨ï¼š</h4><p>ï¼ˆAï¼‰è¯»å…¥é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬åŸºç¡€é…ç½®XMLå’Œæ˜ å°„å™¨XMLæ–‡ä»¶ã€‚</p><p>ï¼ˆBï¼‰åˆå§‹åŒ–åŸºç¡€é…ç½®ï¼Œå¦‚åˆ«åã€æ˜ å°„å™¨ã€å¯¹è±¡å·¥å‚ã€ç±»å‹è½¬æ¢å™¨ç­‰</p><p>ï¼ˆCï¼‰æä¾›å•ä¾‹ï¼Œä¸ºåç»­åˆ›å»ºSessionFactoryæœåŠ¡æä¾›é…ç½®å‚æ•°ã€‚</p><p>ï¼ˆDï¼‰æ‰§è¡Œé‡è¦çš„å¯¹è±¡æ–¹æ³•ï¼Œåˆå§‹åŒ–é…ç½®ä¿¡æ¯ã€‚</p><p>Configurationæºç æœ‰å…«ç™¾å¤šè¡Œï¼Œå°±ä¸è´´äº†ã€‚</p><p>å…·ä½“ç›¸å…³é…ç½®å¯ä»¥å‚è€ƒ<a href="#">ã€ŠMybatisé…ç½®å¤§å…¨ã€‹</a></p><h4 id="3ã€æ˜ å°„å™¨ç»„æˆ"><a href="#3ã€æ˜ å°„å™¨ç»„æˆ" class="headerlink" title="3ã€æ˜ å°„å™¨ç»„æˆ"></a>3ã€æ˜ å°„å™¨ç»„æˆ</h4><p>æ˜ å°„å™¨ä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><p>ï¼ˆ1ï¼‰MappedStatement - ä¿å­˜æ˜ å°„å™¨çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆselect | inset | delete | updateï¼‰ã€‚åŒ…æ‹¬é…ç½®çš„SQLã€SQLçš„idã€ç¼“å­˜ä¿¡æ¯ã€resultMapã€parameterTypeã€resultTypeã€languageDriverç­‰é‡è¦é…ç½®å†…å®¹ã€‚</p><p>ï¼ˆ2ï¼‰SqlSource - æä¾›BoundSql å¯¹è±¡çš„åœ°æ–¹ï¼Œæ˜¯MappedStatement çš„ä¸€ä¸ªå±æ€§ã€‚æœ¬è´¨ä¸Šä¸€ä¸ªæ¥å£ï¼Œä¸»è¦ä½œç”¨æ˜¯æ ¹æ®å‚æ•°å’Œå…¶ä»–è§„åˆ™ç»„è£…SQLã€‚</p><p>ï¼ˆ3ï¼‰BoundSql - å»ºç«‹SQLå’Œå‚æ•°çš„åœ°æ–¹ã€‚å¸¸ç”¨å±æ€§æœ‰3ä¸ªï¼šSQLã€parameterObjectã€parameterMappingã€‚</p><p>â€‹    ï¼ˆAï¼‰parameterObject è¡¨ç¤ºå‚æ•°æœ¬èº«ã€‚ä¼ é€’åŸºç¡€ç±»å‹å¯¹è±¡æ—¶ï¼ŒMybatisä¼šæŠŠå‚æ•°å˜æˆåŸºç¡€ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»å‹å¯¹ä¼ é€’ï¼Œå¦‚ä¼ intç±»å‹ï¼Œå‚æ•°ä¼šå˜æˆIntegerç±»å‹ã€‚</p><p>â€‹    ï¼ˆBï¼‰å¦‚æœä¼ é€’çš„æ˜¯POJOæˆ–Mapï¼Œé‚£ä¹ˆparameterObject å°±ä¼ å…¥çš„POJOæˆ–Mapã€‚</p><p>â€‹    ï¼ˆCï¼‰ä¼ é€’å¤šä¸ªå‚æ•°æ—¶ï¼Œä¸ä½¿ç”¨<code>@Param</code>æ³¨è§£ï¼ŒMybatisä¼šæŠŠparameterObjectå˜æˆMap&lt;String,Object&gt;å¯¹è±¡ï¼ŒMapé‡Œçš„é”®å€¼å…³ç³»æŒ‰ç…§å‚æ•°é¡ºåºå­˜æ”¾ï¼š</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"1"</span><span class="token operator">:</span>value1<span class="token punctuation">,</span><span class="token string">"2"</span><span class="token punctuation">,</span>value2<span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span>value3......<span class="token punctuation">,</span><span class="token property">"param1"</span><span class="token operator">:</span>value1<span class="token punctuation">,</span><span class="token property">"param2"</span><span class="token operator">:</span>value2<span class="token punctuation">,</span><span class="token property">"param3"</span><span class="token operator">:</span>value3......<span class="token punctuation">}</span></code></pre><p>å¯ä»¥ä½¿ç”¨æ—¶å¯ä»¥é€šè¿‡<code>#{param1}</code> æˆ– <code>#{1}</code>å–ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//å‡è®¾ä¼ å…¥idçš„å€¼ä¸º 10010, nameçš„å€¼ä¸º zhangxiaocai</span>List<span class="token operator">&lt;</span>T<span class="token operator">></span>  <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">,</span> String name<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åˆ™parameterObjectå˜æˆMap&lt;String,Object&gt;å¯¹è±¡åå†…å®¹ä¸ºï¼š</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"1"</span><span class="token operator">:</span><span class="token number">10010</span><span class="token punctuation">,</span><span class="token string">"2"</span><span class="token punctuation">,</span><span class="token string">"zhangxiaocai"</span><span class="token punctuation">,</span><span class="token property">"param1"</span><span class="token operator">:</span><span class="token number">10010</span><span class="token punctuation">,</span><span class="token property">"param2"</span><span class="token operator">:</span><span class="token string">"zhangxiaocai"</span><span class="token punctuation">}</span></code></pre><p>â€‹    ï¼ˆDï¼‰ä¼ é€’å¤šä¸ªå‚æ•°æ—¶ï¼Œä½¿ç”¨<code>@Param</code>æ³¨è§£ï¼ŒMybatisä¹Ÿä¼šæŠŠparameterObjectå˜æˆMap&lt;String,Object&gt;å¯¹è±¡ï¼ŒMapé‡Œçš„é”®å€¼å…³ç³»æŒ‰ç…§å‚æ•°é¡ºåºå­˜æ”¾ï¼š</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"key1"</span><span class="token operator">:</span>value1<span class="token punctuation">,</span><span class="token string">"key2"</span><span class="token punctuation">,</span>value2<span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span>value3......<span class="token punctuation">,</span><span class="token property">"param1"</span><span class="token operator">:</span>value1<span class="token punctuation">,</span><span class="token property">"param2"</span><span class="token operator">:</span>value2<span class="token punctuation">,</span><span class="token property">"param3"</span><span class="token operator">:</span>value3......<span class="token punctuation">}</span></code></pre><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//å‡è®¾ä¼ å…¥idçš„å€¼ä¸º 10010, nameçš„å€¼ä¸º zhangxiaocai</span>List<span class="token operator">&lt;</span>T<span class="token operator">></span>  <span class="token function">selectList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>  String name<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>é‚£ä¹ˆå¯¹äºçš„parameterObjectå˜æˆçš„Map&lt;String,Object&gt;å¯¹è±¡ä¸ºï¼š</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token number">10010</span><span class="token punctuation">,</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"zhangxiaocai"</span><span class="token punctuation">,</span><span class="token property">"param1"</span><span class="token operator">:</span><span class="token number">10010</span><span class="token punctuation">,</span><span class="token property">"param2"</span><span class="token operator">:</span><span class="token string">"zhangxiaocai"</span><span class="token punctuation">}</span></code></pre><p>â€‹    ï¼ˆEï¼‰parameterMappingsæ˜¯ç”±å…ƒç´ ä¸ºParameterMappingå¯¹è±¡ç»„æˆçš„Listé›†åˆã€‚ParameterMappingå¯¹è±¡æè¿°çš„æ˜¯å‚æ•°ï¼Œå‚æ•°åŒ…æ‹¬å±æ€§ã€åç§°ã€è¡¨è¾¾å¼ã€JavaTypeã€jdbcTypeã€typeHandlerç­‰ä¿¡æ¯ã€‚é€šè¿‡ParameterMappingå¯¹è±¡å®ç°å‚æ•°å’ŒSQLçš„ç»“åˆï¼Œæ–¹ä¾¿PreparedStatementèƒ½é€šè¿‡ParameterMappingæ‰¾åˆ°parameterObjectå¯¹è±¡çš„å±æ€§å¹¶è®¾ç½®å‚æ•°ã€‚<br>â€‹    ï¼ˆFï¼‰SQLå°±æ˜¯æ˜ å°„å™¨çš„ä¸€æ¡SQLã€‚</p><h3 id="ä¸‰ã€SqlSessionè¿è¡Œè¿‡ç¨‹"><a href="#ä¸‰ã€SqlSessionè¿è¡Œè¿‡ç¨‹" class="headerlink" title="ä¸‰ã€SqlSessionè¿è¡Œè¿‡ç¨‹"></a>ä¸‰ã€SqlSessionè¿è¡Œè¿‡ç¨‹</h3><p>æœ‰äº†SqlSessionFactoryå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°SqlSessionã€‚</p><pre class=" language-java"><code class="language-java">sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>SqlSessionå¯ä»¥è¿›è¡ŒæŸ¥è¯¢ã€å†™å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ–¹æ³•ï¼Œæ–°ç‰ˆMybatisä½¿ç”¨Mapperæ˜ å°„å™¨è¿›è¡Œæ“ä½œã€‚</p><h4 id="1ã€Mapperæ˜ å°„å™¨åŠ¨æ€ä»£ç†"><a href="#1ã€Mapperæ˜ å°„å™¨åŠ¨æ€ä»£ç†" class="headerlink" title="1ã€Mapperæ˜ å°„å™¨åŠ¨æ€ä»£ç†"></a>1ã€Mapperæ˜ å°„å™¨åŠ¨æ€ä»£ç†</h4><p>åœ¨Mybatisæºç <code>org.apache.ibatis.binding.MapperProxy&lt;T&gt;</code>ç±»ä¸­å¯ä»¥çœ‹å‡ºMapperæ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®ç°çš„ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>binding<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>InvocationHandler<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>reflection<span class="token punctuation">.</span>ExceptionUtil<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSession<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperProxy</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">,</span> Serializable <span class="token punctuation">{</span>  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span>6424540398559729838L<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> SqlSession sqlSession<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span> mapperInterface<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> Map<span class="token operator">&lt;</span>Method<span class="token punctuation">,</span> MapperMethod<span class="token operator">></span> methodCache<span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token function">MapperProxy</span><span class="token punctuation">(</span>SqlSession sqlSession<span class="token punctuation">,</span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span> mapperInterface<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>Method<span class="token punctuation">,</span> MapperMethod<span class="token operator">></span> methodCache<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>sqlSession <span class="token operator">=</span> sqlSession<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>mapperInterface <span class="token operator">=</span> mapperInterface<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>methodCache <span class="token operator">=</span> methodCache<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> Object <span class="token function">invoke</span><span class="token punctuation">(</span>Object proxy<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> ExceptionUtil<span class="token punctuation">.</span><span class="token function">unwrapThrowable</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">final</span> MapperMethod mapperMethod <span class="token operator">=</span> <span class="token function">cachedMapperMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> mapperMethod<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">private</span> MapperMethod <span class="token function">cachedMapperMethod</span><span class="token punctuation">(</span>Method method<span class="token punctuation">)</span> <span class="token punctuation">{</span>    MapperMethod mapperMethod <span class="token operator">=</span> methodCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>mapperMethod <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>      mapperMethod <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapperMethod</span><span class="token punctuation">(</span>mapperInterface<span class="token punctuation">,</span> method<span class="token punctuation">,</span> sqlSession<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      methodCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> mapperMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> mapperMethod<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä½†æ˜¯åŠ¨æ€ä»£ç†çš„ç‰¹ç‚¹æ˜¯ï¼š<br>ï¼ˆ1ï¼‰å®ç°InvocationHandlerçš„æ¥å£ï¼Œé‡å†™invokeæ–¹æ³•ã€‚<br>ï¼ˆ2ï¼‰ä½¿ç”¨ç»‘å®šæˆ–æ„é€ æ–¹æ³•å»ºç«‹ä¸è¢«ä»£ç†å¯¹è±¡çš„ç»ƒä¹ ã€‚<br>ï¼ˆ3ï¼‰Proxy.newProxyInstance(â€¦)å–å¾—ä»£ç†å¯¹è±¡ã€‚<br>æŒ‰ä»¥ä¸Šä¸‰ç‚¹æ¥çœ‹ï¼Œä»£ç†ç±»é‡Œæ²¡æœ‰çœ‹åˆ°Proxy.newProxyInstanceçš„è°ƒç”¨ï¼Œå› ä¸ºMybatisä½¿ç”¨MapperProxyFactoryæ¥å®ç°ä»£ç†ç±»ç®¡ç†çš„,åœ¨è¿™é‡Œæ‰¾åˆ°äº†Proxy.newProxyInstanceçš„è°ƒç”¨ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>binding<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Proxy<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>ConcurrentHashMap<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSession<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperProxyFactory</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span> mapperInterface<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> Map<span class="token operator">&lt;</span>Method<span class="token punctuation">,</span> MapperMethod<span class="token operator">></span> methodCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token operator">&lt;</span>Method<span class="token punctuation">,</span> MapperMethod<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token function">MapperProxyFactory</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span>T<span class="token operator">></span> mapperInterface<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>mapperInterface <span class="token operator">=</span> mapperInterface<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">getMapperInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> mapperInterface<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> Map<span class="token operator">&lt;</span>Method<span class="token punctuation">,</span> MapperMethod<span class="token operator">></span> <span class="token function">getMethodCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> methodCache<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>  <span class="token keyword">protected</span> T <span class="token function">newInstance</span><span class="token punctuation">(</span>MapperProxy<span class="token operator">&lt;</span>T<span class="token operator">></span> mapperProxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> Proxy<span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>mapperInterface<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> mapperInterface <span class="token punctuation">}</span><span class="token punctuation">,</span> mapperProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> T <span class="token function">newInstance</span><span class="token punctuation">(</span>SqlSession sqlSession<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">final</span> MapperProxy<span class="token operator">&lt;</span>T<span class="token operator">></span> mapperProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapperProxy</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> mapperInterface<span class="token punctuation">,</span> methodCache<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">newInstance</span><span class="token punctuation">(</span>mapperProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä¸€æ—¦Mapperæ¥å£è°ƒç”¨SQLæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šè¿è¡Œåˆ°invokeæ–¹æ³•ä¸­ï¼Œinvokeé¦–å…ˆåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªç±»ï¼ŒMapperæ˜¯æ¥å£ä¸æ˜¯ç±»ï¼Œæ‰€ä»¥ä¼šèµ°åˆ°ä¸‹é¢ï¼Œç”ŸæˆMapperMethodå¯¹è±¡ï¼Œé€šè¿‡cachedMapperMethodæ–¹æ³•å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åæ‰§è¡Œexecuteæ–¹æ³•ï¼Œå§SQLSessionå’Œå½“å‰è¿è¡Œçš„å‚æ•°ä¼ é€’è¿›è¡Œã€‚<br>MapperMethodçš„executeçš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>binding<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//MapperMethod ç±»å†…å®¹è¾ƒå¤šï¼Œåªè´´äº†executeçš„æ–¹æ³•ã€‚</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapperMethod</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> Object <span class="token function">execute</span><span class="token punctuation">(</span>SqlSession sqlSession<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Object result<span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">case</span> INSERT<span class="token operator">:</span> <span class="token punctuation">{</span>            Object param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>            result <span class="token operator">=</span> <span class="token function">rowCountResult</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">case</span> UPDATE<span class="token operator">:</span> <span class="token punctuation">{</span>            Object param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>            result <span class="token operator">=</span> <span class="token function">rowCountResult</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">case</span> DELETE<span class="token operator">:</span> <span class="token punctuation">{</span>            Object param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>            result <span class="token operator">=</span> <span class="token function">rowCountResult</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">case</span> SELECT<span class="token operator">:</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">returnsVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> method<span class="token punctuation">.</span><span class="token function">hasResultHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token function">executeWithResultHandler</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>              result <span class="token operator">=</span> null<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">returnsMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              result <span class="token operator">=</span> <span class="token function">executeForMany</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">returnsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              result <span class="token operator">=</span> <span class="token function">executeForMap</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">returnsCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              result <span class="token operator">=</span> <span class="token function">executeForCursor</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>              Object param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>              result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>          <span class="token keyword">case</span> FLUSH<span class="token operator">:</span>            result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">flushStatements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>          <span class="token keyword">default</span><span class="token operator">:</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BindingException</span><span class="token punctuation">(</span><span class="token string">"Unknown execution method for: "</span> <span class="token operator">+</span> command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> null <span class="token operator">&amp;&amp;</span> method<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>method<span class="token punctuation">.</span><span class="token function">returnsVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BindingException</span><span class="token punctuation">(</span><span class="token string">"Mapper method '"</span> <span class="token operator">+</span> command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token operator">+</span> <span class="token string">" attempted to return null from a method with a primitive return type ("</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token comment" spellcheck="true">//æŸ¥è¯¢Listçš„æ“ä½œ</span>      <span class="token keyword">private</span> <span class="token operator">&lt;</span>E<span class="token operator">></span> Object <span class="token function">executeForMany</span><span class="token punctuation">(</span>SqlSession sqlSession<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        List<span class="token operator">&lt;</span>E<span class="token operator">></span> result<span class="token punctuation">;</span>        Object param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">hasRowBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          RowBounds rowBounds <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">extractRowBounds</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>          result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span>&lt;E<span class="token operator">></span><span class="token function">selectList</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">,</span> rowBounds<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span>&lt;E<span class="token operator">></span><span class="token function">selectList</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// issue #510 Collections &amp; arrays support</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>method<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">convertToArray</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">convertToDeclaredCollection</span><span class="token punctuation">(</span>sqlSession<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>MapperMethodæ˜¯é‡‡ç”¨å‘½ä»¤æ¨¡å¼è¿è¡Œï¼Œæ ¹æ®ä¸Šä¸‹æ–‡è·³è½¬çš„ã€‚<br>executeé‡Œéƒ½æ˜¯å¸¸è§çš„<code>IUDS</code>æ“ä½œ,æ ¹æ®ä¸åŒçš„SQLç±»å‹è¿›è¡Œå¤„ç†ã€‚<br>æ¯”å¦‚SELECTé‡Œæœ‰ä¸ª result = executeForMany(sqlSession, args); å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„æŸ¥è¯¢Listç»“æœçš„è°ƒç”¨ï¼Œä»æºä»£ç é‡Œå¯ä»¥çœ‹åˆ°æœ€åéƒ½æ˜¯é€šè¿‡è°ƒç”¨sqlSessionå»æ‰§è¡Œçš„å¯¹è±¡çš„SQLã€‚</p><p>Mapperæ¥å£èƒ½å¤Ÿæ‰§è¡ŒSQL,å°±æ˜¯å› ä¸ºæ˜ å°„å™¨çš„XMLæ–‡ä»¶å‘½åç©ºé—´å¯¹åº”çš„æ˜¯è¿™ä¸ªæ¥å£çš„å…¨è·¯å¾„ï¼Œæ ¹æ®å…¨è·¯å¾„å’Œæ–¹æ³•è¿›è¡Œç»‘å®šï¼Œé€šè¿‡åŠ¨æ€ä»£ç†æŠ€æœ¯è®©è¿™ä¸ªæ¥å£è¿è¡Œèµ·æ¥ã€‚ç„¶åé‡‡ç”¨å‘½ä»¤æ¨¡å¼ï¼Œæ ¹æ®SQLç±»å‹è·³è½¬ä¸åŒæ–¹æ³•ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯ä½¿ç”¨SqlSessionæ¥å£çš„æ–¹æ³•ä½¿ç”¨æ‰§è¡Œå¯¹åº”SQLè¿”å›ç»“æœã€‚</p><h4 id="2ã€-SqlSessionçš„å››å¤§å¯¹è±¡"><a href="#2ã€-SqlSessionçš„å››å¤§å¯¹è±¡" class="headerlink" title="2ã€ SqlSessionçš„å››å¤§å¯¹è±¡"></a>2ã€ SqlSessionçš„å››å¤§å¯¹è±¡</h4><p>Mapperæ‰§è¡Œçš„è¿‡ç¨‹æ˜¯é€šè¿‡<code>Excutor</code>ã€<code>StatementHandler</code>ã€<code>ParameterHandler</code>ã€<code>ResultHandler</code>æ¥å®Œæˆæ•°æ®åº“æ“ä½œå’Œç»“æœè¿”å›ã€‚<br>ï¼ˆ1ï¼‰<code>Excutor</code> ä»£è¡¨æ‰§è¡Œå™¨ï¼Œè´Ÿè´£è°ƒåº¦<code>StatementHandler</code>ã€<code>ParameterHandler</code>ã€<code>ResultHandler</code>ç­‰æ¥æ‰§è¡Œå¯¹åº”SQLã€‚<br>ï¼ˆ2ï¼‰<code>StatementHandler</code>ä½œç”¨æ˜¯ä½¿ç”¨æ•°æ®åº“çš„<code>Statement(PreparedStatement)</code>æ‰§è¡Œæ“ä½œï¼Œæ˜¯å››å¤§å¯¹è±¡çš„æ ¸å¿ƒï¼Œèµ·åˆ°æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ã€‚<br>ï¼ˆ3ï¼‰<code>ParameterHandler</code>ç”¨äºSQLå‚æ•°çš„å¤„ç†ã€‚<br>ï¼ˆ4ï¼‰<code>ResultHandler</code>æ˜¯è¿›è¡Œæœ€åæ•°æ®é›†ï¼ˆResultSetï¼‰çš„å°è£…è¿”å›å¤„ç†ã€‚</p><h5 id="1ã€Excutoræ‰§è¡Œå™¨"><a href="#1ã€Excutoræ‰§è¡Œå™¨" class="headerlink" title="1ã€Excutoræ‰§è¡Œå™¨"></a>1ã€Excutoræ‰§è¡Œå™¨</h5><p>æ‰§è¡Œå™¨Excutoræ˜¯çœŸæ­£æ‰§è¡ŒJavaå’Œæ•°æ®äº¤äº’çš„ä¸œè¥¿ï¼Œä¸»è¦æœ‰ä¸‰ç§æ‰§è¡Œå™¨ã€‚å¯ä»¥åœ¨é…ç½®settingå…ƒç´ çš„å±æ€§defaultExcutorTypeæ¥è¿›è¡Œé…ç½®ã€‚<br>ï¼ˆAï¼‰SIMPLE - ç®€å•æ‰§è¡Œå™¨ï¼Œä¸é…åšå°±æ˜¯é»˜è®¤æ‰§è¡Œå™¨ã€‚<br>ï¼ˆBï¼‰REUSE - æ˜¯ä¸€ç§æ‰§è¡Œå™¨é‡ç”¨é¢„å¤„ç†è¯­å¥ã€‚<br>ï¼ˆCï¼‰BATCH - æ‰§è¡Œå™¨é‡ç”¨è¯­å¥å’Œæ‰¹é‡æ›´æ–°ï¼Œæ˜¯é’ˆå¯¹æ‰¹é‡ä¸“ç”¨çš„æ‰§è¡Œå™¨ã€‚</p><p>ä¸‰è€…éƒ½æä¾›äº†æŸ¥è¯¢å’Œæ›´æ–°çš„æ–¹æ³•ï¼Œäº‹åŠ¡æ–¹æ³•ã€‚</p><p><code>Configuration</code>ä¸­å¯ä»¥çœ‹åˆ°åˆ›å»ºæ‰§è¡Œå™¨çš„è¿‡ç¨‹ï¼š</p><pre class=" language-java"><code class="language-java">  <span class="token keyword">public</span> Executor <span class="token function">newExecutor</span><span class="token punctuation">(</span>Transaction transaction<span class="token punctuation">,</span> ExecutorType executorType<span class="token punctuation">)</span> <span class="token punctuation">{</span>    executorType <span class="token operator">=</span> executorType <span class="token operator">==</span> null <span class="token operator">?</span> defaultExecutorType <span class="token operator">:</span> executorType<span class="token punctuation">;</span>    executorType <span class="token operator">=</span> executorType <span class="token operator">==</span> null <span class="token operator">?</span> ExecutorType<span class="token punctuation">.</span>SIMPLE <span class="token operator">:</span> executorType<span class="token punctuation">;</span>    Executor executor<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ExecutorType<span class="token punctuation">.</span>BATCH <span class="token operator">==</span> executorType<span class="token punctuation">)</span> <span class="token punctuation">{</span>      executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BatchExecutor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ExecutorType<span class="token punctuation">.</span>REUSE <span class="token operator">==</span> executorType<span class="token punctuation">)</span> <span class="token punctuation">{</span>      executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReuseExecutor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleExecutor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>      executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CachingExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    executor <span class="token operator">=</span> <span class="token punctuation">(</span>Executor<span class="token punctuation">)</span> interceptorChain<span class="token punctuation">.</span><span class="token function">pluginAll</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> executor<span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre><p>å…¶ä¸­<code>interceptorChain.pluginAll</code>æ˜¯Mybatisæ’ä»¶ï¼Œç”¨æ¥æ„å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œåœ¨è°ƒåº¦çœŸæ­£çš„Executoræ–¹æ³•æ‰§è¡Œæ‰§è¡Œé…ç½®æ’ä»¶ä»£ç å¯ä»¥ä¿®æ”¹ã€‚</p><p>å¦‚SimpleExecutorä»£ç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>Cursor<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>statement<span class="token punctuation">.</span>StatementHandler<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>Log<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>BoundSql<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>MappedStatement<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>ResultHandler<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>RowBounds<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>Transaction<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Connection<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>SQLException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Statement<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Collections<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleExecutor</span> <span class="token keyword">extends</span> <span class="token class-name">BaseExecutor</span> <span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token function">SimpleExecutor</span><span class="token punctuation">(</span>Configuration configuration<span class="token punctuation">,</span> Transaction transaction<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">doUpdate</span><span class="token punctuation">(</span>MappedStatement ms<span class="token punctuation">,</span> Object parameter<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    Statement stmt <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      Configuration configuration <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      StatementHandler handler <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newStatementHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> RowBounds<span class="token punctuation">.</span>DEFAULT<span class="token punctuation">,</span> null<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>      stmt <span class="token operator">=</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> ms<span class="token punctuation">.</span><span class="token function">getStatementLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>      <span class="token function">closeStatement</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token operator">&lt;</span>E<span class="token operator">></span> List<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">doQuery</span><span class="token punctuation">(</span>MappedStatement ms<span class="token punctuation">,</span> Object parameter<span class="token punctuation">,</span> RowBounds rowBounds<span class="token punctuation">,</span> ResultHandler resultHandler<span class="token punctuation">,</span> BoundSql boundSql<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    Statement stmt <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      Configuration configuration <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      StatementHandler handler <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newStatementHandler</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>      stmt <span class="token operator">=</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> ms<span class="token punctuation">.</span><span class="token function">getStatementLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> handler<span class="token punctuation">.</span>&lt;E<span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> resultHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>      <span class="token function">closeStatement</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">protected</span> <span class="token operator">&lt;</span>E<span class="token operator">></span> Cursor<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">doQueryCursor</span><span class="token punctuation">(</span>MappedStatement ms<span class="token punctuation">,</span> Object parameter<span class="token punctuation">,</span> RowBounds rowBounds<span class="token punctuation">,</span> BoundSql boundSql<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    Configuration configuration <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    StatementHandler handler <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newStatementHandler</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> null<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>    Statement stmt <span class="token operator">=</span> <span class="token function">prepareStatement</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> ms<span class="token punctuation">.</span><span class="token function">getStatementLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> handler<span class="token punctuation">.</span>&lt;E<span class="token operator">></span><span class="token function">queryCursor</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> List<span class="token operator">&lt;</span>BatchResult<span class="token operator">></span> <span class="token function">doFlushStatements</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isRollback<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    <span class="token keyword">return</span> Collections<span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">private</span> Statement <span class="token function">prepareStatement</span><span class="token punctuation">(</span>StatementHandler handler<span class="token punctuation">,</span> Log statementLog<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    Statement stmt<span class="token punctuation">;</span>    Connection connection <span class="token operator">=</span> <span class="token function">getConnection</span><span class="token punctuation">(</span>statementLog<span class="token punctuation">)</span><span class="token punctuation">;</span>    stmt <span class="token operator">=</span> handler<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> transaction<span class="token punctuation">.</span><span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    handler<span class="token punctuation">.</span><span class="token function">parameterize</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> stmt<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä»ä»£ç å¯ä»¥çœ‹åˆ°å¸¸è§çš„doUpdateå’ŒdoQueryæ“ä½œã€‚ä»¥doQueryä¸ºä¾‹ï¼Œå…¶è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹:<br>æ ¹æ®Configurationæ¥æ„å»ºStatementHandler,ç„¶åä½¿ç”¨prepareStatementæ–¹æ³•å¯¹è±¡SQLç¼–è¯‘å¹¶å¯¹å‚æ•°åˆå§‹åŒ–ï¼Œå®ƒçš„å®ç°è¿‡ç¨‹è°ƒç”¨StatementHandlerçš„prepare()è¿›è¡Œé¢„ç¼–è¯‘å’ŒåŸºç¡€è®¾ç½®ï¼Œç„¶åé€šè¿‡æ ¹æ®StatementHandlerçš„parameterize()æ¥è®¾ç½®å‚æ•°å¹¶æ‰§è¡Œï¼ŒResultHandlerå†ç»„è£…æŸ¥è¯¢ç»“æœè¿”å›ç»™è°ƒç”¨è€…æ¥å®ŒæˆæŸ¥è¯¢ã€‚</p><h5 id="2ã€æ•°æ®åº“ä¼šè¯å™¨"><a href="#2ã€æ•°æ®åº“ä¼šè¯å™¨" class="headerlink" title="2ã€æ•°æ®åº“ä¼šè¯å™¨"></a>2ã€æ•°æ®åº“ä¼šè¯å™¨</h5><p>æ•°æ®åº“ä¼šè¯å™¨StatementHandlerä¸»è¦è´Ÿè´£ä¸æ•°æ®åº“ä¼šè¯æ“ä½œã€‚<br>è‹¥è¦æŒ‡å®šä½¿ç”¨ï¼Œå¯ä»¥åœ¨SQLä¸Šè¿›è¡Œé…ç½®ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- statementType ï¼ˆå¯é€‰é…ç½®ï¼Œé»˜è®¤é…ç½®ä¸ºPREPAREDï¼‰    STATEMENTï¼ŒPREPARED æˆ– CALLABLE çš„ä¸€ä¸ªã€‚    åˆ†åˆ«å¯¹åº”ä½¿ç”¨ Statementï¼ŒPreparedStatement æˆ– CallableStatement --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>save<span class="token punctuation">"</span></span>  <span class="token attr-name">statementType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>STATEMENT<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></code></pre><p><code>Configuration</code>ä¸­å¯ä»¥çœ‹åˆ°åˆ›å»ºæ•°æ®åº“ä¼šè¯å™¨çš„è¿‡ç¨‹ï¼š</p><pre class=" language-java"><code class="language-java">  <span class="token keyword">public</span> StatementHandler <span class="token function">newStatementHandler</span><span class="token punctuation">(</span>Executor executor<span class="token punctuation">,</span> MappedStatement mappedStatement<span class="token punctuation">,</span> Object parameterObject<span class="token punctuation">,</span> RowBounds rowBounds<span class="token punctuation">,</span> ResultHandler resultHandler<span class="token punctuation">,</span> BoundSql boundSql<span class="token punctuation">)</span> <span class="token punctuation">{</span>    StatementHandler statementHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoutingStatementHandler</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> mappedStatement<span class="token punctuation">,</span> parameterObject<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>    statementHandler <span class="token operator">=</span> <span class="token punctuation">(</span>StatementHandler<span class="token punctuation">)</span> interceptorChain<span class="token punctuation">.</span><span class="token function">pluginAll</span><span class="token punctuation">(</span>statementHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> statementHandler<span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre><p>å¯ä»¥çœ‹åˆ°åˆ›å»ºstatementHandlerçš„åŠ¨ä½œæ˜¯ç”±RoutingStatementHandleræ¥å®Œæˆï¼Œå®ƒå®ç°äº†statementHandleræ¥å£ï¼Œå’ŒExecutorç±»ä¼¼ç”¨ä»£ç†å¯¹è±¡è¿›è¡Œå°è£…ã€‚</p><p>åœ¨<code>RoutingStatementHandler</code>çš„æºä»£ç ä¸­ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>statement<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Connection<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>SQLException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Statement<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>Cursor<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>Executor<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>ExecutorException<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>parameter<span class="token punctuation">.</span>ParameterHandler<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>BoundSql<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>MappedStatement<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>ResultHandler<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>RowBounds<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoutingStatementHandler</span> <span class="token keyword">implements</span> <span class="token class-name">StatementHandler</span> <span class="token punctuation">{</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> StatementHandler delegate<span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token function">RoutingStatementHandler</span><span class="token punctuation">(</span>Executor executor<span class="token punctuation">,</span> MappedStatement ms<span class="token punctuation">,</span> Object parameter<span class="token punctuation">,</span> RowBounds rowBounds<span class="token punctuation">,</span> ResultHandler resultHandler<span class="token punctuation">,</span> BoundSql boundSql<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>ms<span class="token punctuation">.</span><span class="token function">getStatementType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">case</span> STATEMENT<span class="token operator">:</span>        delegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleStatementHandler</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>      <span class="token keyword">case</span> PREPARED<span class="token operator">:</span>        delegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PreparedStatementHandler</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>      <span class="token keyword">case</span> CALLABLE<span class="token operator">:</span>        delegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CallableStatementHandler</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> ms<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> rowBounds<span class="token punctuation">,</span> resultHandler<span class="token punctuation">,</span> boundSql<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>      <span class="token keyword">default</span><span class="token operator">:</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExecutorException</span><span class="token punctuation">(</span><span class="token string">"Unknown statement type: "</span> <span class="token operator">+</span> ms<span class="token punctuation">.</span><span class="token function">getStatementType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//some code ...</span>  <span class="token punctuation">}</span></code></pre><p>å¯ä»¥çœ‹å‡ºRoutingStatementHandlerä¹Ÿä¸æ˜¯çœŸæ­£æœåŠ¡å¯¹è±¡ï¼Œå®ƒæ˜¯é€šè¿‡é€‚é…æ¨¡å¼æ‰¾åˆ°å¯¹åº”çš„StatementHandleræ¥æ‰§è¡Œã€‚Mybatisä¸­StatementHandlerå’ŒExecutorä¸€æ ·ä¹Ÿæœ‰ä¸‰ç§ï¼š<br>ï¼ˆAï¼‰SimpleStatementHandler - å¯¹åº”JDBCä¸­Statementæ¥å£ï¼Œæ‰§è¡Œæ™®é€šSQL<br>ï¼ˆBï¼‰PreparedStatementHandler - å¯¹åº”JDBCä¸­çš„PreparedStatementï¼Œé¢„ç¼–è¯‘SQLçš„æ¥å£ï¼›<br>ï¼ˆcï¼‰CallableStatementHandler - å¯¹åº”JDBCä¸­CallableStatementï¼Œç”¨äºæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ç›¸å…³çš„æ¥å£ï¼›</p><p>RoutingStatementHandlerä¸­å®šä¹‰äº†ä¸€ä¸ªdelegateï¼Œå®ƒæ˜¯ä¸€ä¸ªStatementHandleræ¥å£å¯¹è±¡ï¼Œæ„é€ æ–¹æ³•æ ¹æ®é…ç½®æ¥é€‚é…å¯¹åº”çš„StatementHandlerå¯¹è±¡ã€‚</p><p>RoutingStatementHandlerçš„ä½œç”¨æ˜¯ç»™å®ç°ç±»å¯¹è±¡çš„ä½¿ç”¨æä¾›ä¸€ä¸ªç»Ÿä¸€ç®€æ˜“çš„ä½¿ç”¨é€‚é…å™¨ï¼Œè¿™æ˜¯å¯¹è±¡çš„é€‚é…æ¨¡å¼ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨ç°æœ‰çš„ç±»å’Œæ–¹æ³•å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚å¯¹å¤–å±è”½æ–¹æ³•ï¼ŒåŠ å…¥æ–°æ–¹æ³•ã€‚</p><p>å¦‚PreparedSatementHandleræ‰§è¡ŒMybatisæ‰§è¡ŒæŸ¥è¯¢ï¼Œæœ‰ä¸‰ä¸ªä¸»è¦çš„æ–¹æ³•ï¼š<br>prepareã€parameterizeã€query</p><p>å¦‚ä¸‹æ˜¯BaseStatementHandlerçš„prepareæ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>statement<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseStatementHandler</span> <span class="token keyword">implements</span> <span class="token class-name">StatementHandler</span> <span class="token punctuation">{</span>      <span class="token annotation punctuation">@Override</span>      <span class="token keyword">public</span> Statement <span class="token function">prepare</span><span class="token punctuation">(</span>Connection connection<span class="token punctuation">,</span> Integer transactionTimeout<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>        ErrorContext<span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sql</span><span class="token punctuation">(</span>boundSql<span class="token punctuation">.</span><span class="token function">getSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Statement statement <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>          statement <span class="token operator">=</span> <span class="token function">instantiateStatement</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">setStatementTimeout</span><span class="token punctuation">(</span>statement<span class="token punctuation">,</span> transactionTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">setFetchSize</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> statement<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">closeStatement</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">throw</span> e<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">closeStatement</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExecutorException</span><span class="token punctuation">(</span><span class="token string">"Error preparing statement.  Cause: "</span> <span class="token operator">+</span> e<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>instantiateStatement()æ–¹æ³•æ˜¯å¯¹SQLè¿›è¡Œé¢„ç¼–è¯‘ã€‚<br>ä¸‹é¢æ˜¯PreparedSatementHandleré‡Œçš„instantiateStatement()å’Œparameterize()æ–¹æ³•:</p><pre class=" language-java"><code class="language-java"> <span class="token annotation punctuation">@Override</span>  <span class="token keyword">protected</span> Statement <span class="token function">instantiateStatement</span><span class="token punctuation">(</span>Connection connection<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    String sql <span class="token operator">=</span> boundSql<span class="token punctuation">.</span><span class="token function">getSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>mappedStatement<span class="token punctuation">.</span><span class="token function">getKeyGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Jdbc3KeyGenerator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      String<span class="token punctuation">[</span><span class="token punctuation">]</span> keyColumnNames <span class="token operator">=</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getKeyColumns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>keyColumnNames <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> PreparedStatement<span class="token punctuation">.</span>RETURN_GENERATED_KEYS<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> keyColumnNames<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mappedStatement<span class="token punctuation">.</span><span class="token function">getResultSetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getResultSetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ResultSet<span class="token punctuation">.</span>CONCUR_READ_ONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">parameterize</span><span class="token punctuation">(</span>Statement statement<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    parameterHandler<span class="token punctuation">.</span><span class="token function">setParameters</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PreparedStatement<span class="token punctuation">)</span> statement<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token operator">&lt;</span>E<span class="token operator">></span> List<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">query</span><span class="token punctuation">(</span>Statement statement<span class="token punctuation">,</span> ResultHandler resultHandler<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    PreparedStatement ps <span class="token operator">=</span> <span class="token punctuation">(</span>PreparedStatement<span class="token punctuation">)</span> statement<span class="token punctuation">;</span>    ps<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> resultSetHandler<span class="token punctuation">.</span>&lt;E<span class="token operator">></span> <span class="token function">handleResultSets</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre><p>prepare()æ–¹æ³•é¦–å…ˆè¿›è¡Œä¸€äº›åŸºç¡€é…ç½®ï¼Œå¦‚è¶…æ—¶ã€è·å–æœ€å¤§è¡Œæ•°ç­‰è®¾ç½®ã€‚ç„¶åExecutorä¼šè°ƒç”¨parameterize()æ–¹æ³•è®¾ç½®å‚æ•°ã€‚ä»ä»£ç å¯ä»¥çœ‹åˆ°è®¾ç½®å‚æ•°æ˜¯ç”±ParameterHandleræ¥å®Œæˆçš„ã€‚</p><p>SatementHandleræ‰§è¡ŒæŸ¥è¯¢çš„æ–¹æ³•é‡Œï¼Œç”±äºæ‰§è¡Œå‰å‚æ•°å’ŒSQLéƒ½è¢«prepare()æ–¹æ³•é¢„ç¼–è¯‘ï¼Œå‚æ•°åœ¨parameterize()æ–¹æ³•å®Œæˆäº†è®¾ç½®ï¼Œåªè¦æ‰§è¡ŒSQLè¿”å›ç»“æœå³å¯ã€‚æ‰§è¡Œä¹‹åå°±æ˜¯ResultHandlerå¯¹ç»“æœçš„å°è£…å’Œè¿”å›ã€‚</p><p><strong>SQLæ‰§è¡Œè¿‡ç¨‹æ€»ç»“</strong>ï¼š<br>Executorä¼šå…ˆè°ƒç”¨StatementHandlerçš„prepare()æ–¹æ³•é¢„ç¼–è¯‘SQLè¯­å¥ï¼Œå¹¶è®¾ç½®åŸºæœ¬è¿è¡Œå‚æ•°ã€‚<br>ç„¶åä½¿ç”¨parameterize()æ–¹æ³•å¯ç”¨ParameterHandlerè®¾ç½®æˆæ¡‰æ ‘ï¼Œå®Œæˆé¢„ç¼–è¯‘ï¼Œè·Ÿç€å°±æ˜¯æ‰§è¡ŒSQLæ“ä½œï¼ˆquery/updateï¼‰<br>æœ€åï¼Œå¦‚æœæœ‰ç»“æœé›†å°±ä½¿ç”¨ResultHandlerå°è£…ç»“æœè¿”å›ç»™è°ƒç”¨è€…ã€‚</p><h5 id="3ã€å‚æ•°å¤„ç†å™¨"><a href="#3ã€å‚æ•°å¤„ç†å™¨" class="headerlink" title="3ã€å‚æ•°å¤„ç†å™¨"></a>3ã€å‚æ•°å¤„ç†å™¨</h5><p>å‚æ•°å¤„ç†å™¨ParameterHandlerä¸»è¦ä½œç”¨å°±æ˜¯å®Œæˆå¯¹é¢„ç¼–è¯‘å‚æ•°çš„è®¾ç½®ã€‚<br>ParameterHandleræºç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>parameter<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>PreparedStatement<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>SQLException<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ParameterHandler</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//è¿”å›å‚æ•°å¯¹è±¡</span>    Object <span class="token function">getParameterObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è®¾ç½®é¢„ç¼–è¯‘SQLè¯­å¥çš„å‚æ•°</span>    <span class="token keyword">void</span> <span class="token function">setParameters</span><span class="token punctuation">(</span>PreparedStatement ps<span class="token punctuation">)</span><span class="token keyword">throws</span> SQLException<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ParameterHandleræ¥å£ä¸­ï¼ŒgetParameterObject()æ–¹æ³•çš„ä½œç”¨æ˜¯è¿”å›å‚æ•°å¯¹è±¡ï¼ŒsetParameters()æ–¹æ³•çš„ä½œç”¨æ˜¯è®¾ç½®é¢„ç¼–è¯‘SQLè¯­å¥çš„å‚æ•°ã€‚<br>Mybatisä¸ºParameterHandleræä¾›äº†ä¸€ä¸ªå®ç°ç±»DefaultParameterHandlerï¼ŒsetParameters()æ–¹æ³•æºç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span>defaults<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>PreparedStatement<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>SQLException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>ErrorContext<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>parameter<span class="token punctuation">.</span>ParameterHandler<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>BoundSql<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>MappedStatement<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>ParameterMapping<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>ParameterMode<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>reflection<span class="token punctuation">.</span>MetaObject<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>type<span class="token punctuation">.</span>JdbcType<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>type<span class="token punctuation">.</span>TypeException<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>type<span class="token punctuation">.</span>TypeHandler<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>type<span class="token punctuation">.</span>TypeHandlerRegistry<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultParameterHandler</span> <span class="token keyword">implements</span> <span class="token class-name">ParameterHandler</span> <span class="token punctuation">{</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> TypeHandlerRegistry typeHandlerRegistry<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> MappedStatement mappedStatement<span class="token punctuation">;</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> Object parameterObject<span class="token punctuation">;</span>  <span class="token keyword">private</span> BoundSql boundSql<span class="token punctuation">;</span>  <span class="token keyword">private</span> Configuration configuration<span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token function">DefaultParameterHandler</span><span class="token punctuation">(</span>MappedStatement mappedStatement<span class="token punctuation">,</span> Object parameterObject<span class="token punctuation">,</span> BoundSql boundSql<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>mappedStatement <span class="token operator">=</span> mappedStatement<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>configuration <span class="token operator">=</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>typeHandlerRegistry <span class="token operator">=</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTypeHandlerRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>parameterObject <span class="token operator">=</span> parameterObject<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>boundSql <span class="token operator">=</span> boundSql<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> Object <span class="token function">getParameterObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> parameterObject<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParameters</span><span class="token punctuation">(</span>PreparedStatement ps<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ErrorContext<span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">activity</span><span class="token punctuation">(</span><span class="token string">"setting parameters"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span>mappedStatement<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>ParameterMapping<span class="token operator">></span> parameterMappings <span class="token operator">=</span> boundSql<span class="token punctuation">.</span><span class="token function">getParameterMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>parameterMappings <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parameterMappings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ParameterMapping parameterMapping <span class="token operator">=</span> parameterMappings<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>parameterMapping<span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> ParameterMode<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span> <span class="token punctuation">{</span>          Object value<span class="token punctuation">;</span>          String propertyName <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>boundSql<span class="token punctuation">.</span><span class="token function">hasAdditionalParameter</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// issue #448 ask first for additional params</span>            value <span class="token operator">=</span> boundSql<span class="token punctuation">.</span><span class="token function">getAdditionalParameter</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parameterObject <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            value <span class="token operator">=</span> null<span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>typeHandlerRegistry<span class="token punctuation">.</span><span class="token function">hasTypeHandler</span><span class="token punctuation">(</span>parameterObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            value <span class="token operator">=</span> parameterObject<span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            MetaObject metaObject <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">newMetaObject</span><span class="token punctuation">(</span>parameterObject<span class="token punctuation">)</span><span class="token punctuation">;</span>            value <span class="token operator">=</span> metaObject<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          TypeHandler typeHandler <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          JdbcType jdbcType <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getJdbcType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> null <span class="token operator">&amp;&amp;</span> jdbcType <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            jdbcType <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getJdbcTypeForNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>          <span class="token keyword">try</span> <span class="token punctuation">{</span>            typeHandler<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>ps<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> jdbcType<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TypeException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeException</span><span class="token punctuation">(</span><span class="token string">"Could not set parameters for mapping: "</span> <span class="token operator">+</span> parameterMapping <span class="token operator">+</span> <span class="token string">". Cause: "</span> <span class="token operator">+</span> e<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeException</span><span class="token punctuation">(</span><span class="token string">"Could not set parameters for mapping: "</span> <span class="token operator">+</span> parameterMapping <span class="token operator">+</span> <span class="token string">". Cause: "</span> <span class="token operator">+</span> e<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ä»parameterObjectå¯¹è±¡è·å–å‚æ•°ï¼Œç„¶åä½¿ç”¨ç±»å‹è½¬æ¢å™¨typeHandlerè¿›è¡Œå‚æ•°å¤„ç†ã€‚å¦‚æœè‡ªå®šä¹‰äº†ç±»å‹è½¬æ¢å™¨ï¼Œå°±ä¼šæ ¹æ®ç­¾åæ³¨å†ŒtypeHandlerå¯¹å‚æ•°è¿›è¡Œå¤„ç†ã€‚ç±»å‹è½¬æ¢å™¨ä¹Ÿæ˜¯åœ¨Mybatisåˆå§‹åŒ–çš„æ—¶å€™æ³¨å†Œåœ¨Configurationé‡Œé¢ã€‚</p><h5 id="4ã€ç»“æœå¤„ç†å™¨"><a href="#4ã€ç»“æœå¤„ç†å™¨" class="headerlink" title="4ã€ç»“æœå¤„ç†å™¨"></a>4ã€ç»“æœå¤„ç†å™¨</h5><p>ResultHandleræ˜¯å°è£…ç»“æœé›†çš„ã€‚<br>ResultHandlerçš„æºç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>resultset<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>Cursor<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>CallableStatement<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>SQLException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Statement<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResultSetHandler</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//åŒ…è£…ç»“æœé›†</span>    <span class="token operator">&lt;</span>E<span class="token operator">></span> List<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">handleResultSets</span><span class="token punctuation">(</span>Statement stmt<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException<span class="token punctuation">;</span>    <span class="token operator">&lt;</span>E<span class="token operator">></span> Cursor<span class="token operator">&lt;</span>E<span class="token operator">></span> <span class="token function">handleCursorResultSets</span><span class="token punctuation">(</span>Statement stmt<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å¤„ç†å­˜å‚¨è¿‡ç¨‹è¾“å‡ºå‚æ•°</span>    <span class="token keyword">void</span> <span class="token function">handleOutputParameters</span><span class="token punctuation">(</span>CallableStatement cs<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å…¶ä¸­handleOutputParameters()æ–¹æ³•æ˜¯å¤„ç†å­˜å‚¨è¿‡ç¨‹è¾“å‡ºå‚æ•°ã€‚handleResultSets()æ–¹æ³•æ˜¯åŒ…è£…ç»“æœé›†çš„ã€‚<br>Mybatisæä¾›äº†ä¸€ä¸ªå®ç°ç±»DefaultResultSetHandlerç±»ï¼Œé»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯é€šè¿‡è¿™ä¸ªç±»è¿›è¡Œå¤„ç†ã€‚å®ƒçš„å®ç°æ¶‰åŠJavaSSISTæˆ–CGLIBä½œä¸ºå»¶è¿ŸåŠ è½½çš„ï¼Œç„¶åé€šè¿‡typeHandlerå’ŒObjectFacortyè¿›è¡Œç»„è£…ç»“æœå†è¿”å›çš„ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultResultSetHandler</span> <span class="token keyword">implements</span> <span class="token class-name">ResultSetHandler</span> <span class="token punctuation">{</span>      <span class="token annotation punctuation">@Override</span>      <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token function">handleResultSets</span><span class="token punctuation">(</span>Statement stmt<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>        ErrorContext<span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">activity</span><span class="token punctuation">(</span><span class="token string">"handling results"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span>mappedStatement<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> List<span class="token operator">&lt;</span>Object<span class="token operator">></span> multipleResults <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> resultSetCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        ResultSetWrapper rsw <span class="token operator">=</span> <span class="token function">getFirstResultSet</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>        List<span class="token operator">&lt;</span>ResultMap<span class="token operator">></span> resultMaps <span class="token operator">=</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getResultMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> resultMapCount <span class="token operator">=</span> resultMaps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">validateResultMapsCount</span><span class="token punctuation">(</span>rsw<span class="token punctuation">,</span> resultMapCount<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>rsw <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> resultMapCount <span class="token operator">></span> resultSetCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>          ResultMap resultMap <span class="token operator">=</span> resultMaps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>resultSetCount<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">handleResultSet</span><span class="token punctuation">(</span>rsw<span class="token punctuation">,</span> resultMap<span class="token punctuation">,</span> multipleResults<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>          rsw <span class="token operator">=</span> <span class="token function">getNextResultSet</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">cleanUpAfterHandlingResultSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          resultSetCount<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        String<span class="token punctuation">[</span><span class="token punctuation">]</span> resultSets <span class="token operator">=</span> mappedStatement<span class="token punctuation">.</span><span class="token function">getResultSets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>resultSets <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">while</span> <span class="token punctuation">(</span>rsw <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> resultSetCount <span class="token operator">&lt;</span> resultSets<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>            ResultMapping parentMapping <span class="token operator">=</span> nextResultMaps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>resultSets<span class="token punctuation">[</span>resultSetCount<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>parentMapping <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>              String nestedResultMapId <span class="token operator">=</span> parentMapping<span class="token punctuation">.</span><span class="token function">getNestedResultMapId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              ResultMap resultMap <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">getResultMap</span><span class="token punctuation">(</span>nestedResultMapId<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token function">handleResultSet</span><span class="token punctuation">(</span>rsw<span class="token punctuation">,</span> resultMap<span class="token punctuation">,</span> null<span class="token punctuation">,</span> parentMapping<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            rsw <span class="token operator">=</span> <span class="token function">getNextResultSet</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">cleanUpAfterHandlingResultSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            resultSetCount<span class="token operator">++</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token function">collapseSingleResultList</span><span class="token punctuation">(</span>multipleResults<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="3ã€SqlSessionè¿è¡Œæ€»ç»“ï¼š"><a href="#3ã€SqlSessionè¿è¡Œæ€»ç»“ï¼š" class="headerlink" title="3ã€SqlSessionè¿è¡Œæ€»ç»“ï¼š"></a>3ã€SqlSessionè¿è¡Œæ€»ç»“ï¼š</h4><p><img src="/medias/loading-animated.gif" data-original="/images/mybatis-imgs/Mybatis-SqlSession-executing.png" alt="SqlSessionå†…éƒ¨å…è®¸å›¾"></p><p>SqlSessionæ˜¯é€šè¿‡Executorè°ƒåº¦StatementHandleræ¥è¿è¡Œï¼ŒStatementHandlerè¦ç»“æœä¸‰æ­¥ï¼š<br>ï¼ˆAï¼‰preparedé¢„ç¼–è¯‘SQLã€‚<br>ï¼ˆBï¼‰parameterizeè®¾ç½®å‚æ•°<br>ï¼ˆCï¼‰queryæˆ–updateæ‰§è¡ŒSQL<br>parameterizeæ˜¯è°ƒç”¨ParameterHandlerçš„æ–¹æ³•å»è®¾ç½®ï¼Œå‚æ•°æ˜¯æ ¹æ®ç±»å‹å¤„ç†å™¨typeHandlerå¤„ç†çš„ã€‚queryæˆ–updateæ–¹æ³•é€šè¿‡ResultHandlerè¿›è¡Œå¤„ç†ç»“æœçš„å°è£…ã€‚updateè¿”å›æ•´æ•°ï¼Œqueryè¿”å›çš„ç»“æœé›†åˆ™æ˜¯é€šè¿‡typeHandlerå¤„ç†ç»“æœç±»å‹ï¼Œç„¶åä½¿ç”¨ObjectFactoryæä¾›çš„è§„åˆ™ç»„è£…å¯¹è±¡ï¼Œè¿”å›ç»™è°ƒç”¨è€…ã€‚</p><br/><p><strong>ç›¸å…³æ–‡ç« ï¼š</strong></p><table><thead><tr><th>æ–‡ç« åç§°</th></tr></thead><tbody><tr><td><a href="b802139a.html">ã€ŠMybatis(ä¸€)ä¸»è¦ç»„ä»¶ã€‹</a></td></tr><tr><td><a href="5d11555a.html">ã€ŠMybatis(äºŒ)é…ç½®ã€‹</a></td></tr><tr><td><a href="d467df29.html">ã€ŠMybatis(ä¸‰)åŠ¨æ€SQLã€‹</a></td></tr><tr><td><a href="3bfa75b5.html">ã€ŠMybtis(å››)å·¥ä½œåŸç†ã€‹</a></td></tr><tr><td><a href="ae8510ea.html">ã€ŠMybtis(äº”)Mapperæ˜ å°„å™¨ã€‹</a></td></tr><tr><td><a href="44c4c800.html">ã€ŠMybtis(å…­)Mapperçº§è”ã€‹</a></td></tr></tbody></table><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql-å¸¸ç”¨å‘½ä»¤ä¸æˆæƒ</title>
      <link href="/posts/523aed6c.html"/>
      <url>/posts/523aed6c.html</url>
      
        <content type="html"><![CDATA[<h2 id="Mysql-å¸¸ç”¨å‘½ä»¤"><a href="#Mysql-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Mysql å¸¸ç”¨å‘½ä»¤"></a>Mysql å¸¸ç”¨å‘½ä»¤</h2><blockquote><p>è™½ç„¶ç°åœ¨å·²ç»æœ‰å¾ˆå¤šç•Œé¢åŒ–çš„è¿æ¥å·¥å…·å¯ä»¥ç›´æ¥é¼ æ ‡æ“ä½œã€‚ä½†æ˜¯è‹¥ç¯å¢ƒä¸å…è®¸è¿œç¨‹è¿æ¥æ€ä¹ˆå‘¢ï¼Ÿæ‰€ä»¥å¸¸ç”¨å‘½ä»¤è¿˜æ˜¯æœ‰ç”¨æ­¦ä¹‹åœ°çš„ã€‚æ•´ç†ä¸€ä¸‹ã€‚</p></blockquote><h3 id="ä¸€ã€è¿æ¥å‘½ä»¤"><a href="#ä¸€ã€è¿æ¥å‘½ä»¤" class="headerlink" title="ä¸€ã€è¿æ¥å‘½ä»¤"></a>ä¸€ã€è¿æ¥å‘½ä»¤</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## mysqlç»ˆç«¯è¿æ¥</span>mysql  <span class="token punctuation">[</span> -h  <span class="token operator">&lt;</span>hostname <span class="token operator">|</span> ip<span class="token operator">></span> <span class="token punctuation">]</span> -u <span class="token operator">&lt;</span>username<span class="token operator">></span> <span class="token punctuation">[</span>-P <span class="token operator">&lt;</span>port<span class="token operator">></span><span class="token punctuation">]</span> -p <span class="token punctuation">[</span><span class="token operator">&lt;</span>userpass<span class="token operator">></span><span class="token punctuation">]</span></code></pre><p>å‚æ•°å«ä¹‰ï¼š</p><p><strong>-h:</strong> ä¸»æœºåï¼Œè¡¨ç¤ºè¿æ¥çš„ç›®æ ‡æ•°æ®åº“ä¸»æœºåæˆ–è€…IPåœ°å€ã€‚</p><p><strong>-u:</strong> ç”¨æˆ·åï¼Œè¡¨ç¤ºè¿æ¥çš„ç›®æ ‡æ•°æ®åº“çš„ç”¨æˆ·åã€‚</p><p><strong>-P:</strong> ç«¯å£ï¼Œè¡¨ç¤ºè¿æ¥çš„ç›®æ ‡æ•°æ®åº“çš„ç«¯å£ï¼Œä¸å†™é»˜è®¤æ˜¯3306ï¼Œéé»˜è®¤é¡»ç¡®å®šç«¯å£å·ã€‚</p><p><strong>-p:</strong> è¡¨ç¤ºè¿æ¥çš„ç›®æ ‡æ•°æ®åº“çš„å¯†ç ï¼Œ-påé¢å¯ä»¥ç›´æ¥è¾“å…¥å¯†ç ï¼Œä¹Ÿå¯ä»¥ä¸å†™æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™è¾“å…¥å¯†ç ï¼Œä¸‹æ–‡åŒç†ã€‚</p><p>å…³äº <code>-u</code>å’Œ<code>username</code>æ˜¯å¦ä¸€å®šè¦è¿åœ¨ä¸€èµ·ï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°ç­”æ¡ˆã€‚</p><h3 id="äºŒã€åŸºç¡€æŸ¥è¯¢å‘½ä»¤"><a href="#äºŒã€åŸºç¡€æŸ¥è¯¢å‘½ä»¤" class="headerlink" title="äºŒã€åŸºç¡€æŸ¥è¯¢å‘½ä»¤"></a>äºŒã€åŸºç¡€æŸ¥è¯¢å‘½ä»¤</h3><p>æ‰§è¡Œç™»å½•ä¹‹åä½¿ç”¨ã€‚</p><pre class=" language-mysql"><code class="language-mysql">-- åˆ—å‡ºå…¨éƒ¨å·²æœ‰æ•°æ®åº“show databases;-- åˆ›å»ºæ–°æ•°æ®åº“create database <database_name>; -- åˆ›å»ºæŒ‡å®šæ•°æ®åº“drop database <database_name>;-- æ‰“å¼€/ä½¿ç”¨æŒ‡å®šæ•°æ®åº“use <database_name>;-- åˆ—å‡ºæ‰“å¼€çš„æ•°æ®åº“æ‰€æœ‰çš„è¡¨åshow tables;-- æŸ¥çœ‹æ•°æ®åº“æŒ‡å®šçš„è¡¨ç»“æ„desc <table_name>;-- åˆ é™¤è¡¨drop table <table_name>;</code></pre><h3 id="ä¸‰ã€æ•°æ®åº“å¤‡ä»½"><a href="#ä¸‰ã€æ•°æ®åº“å¤‡ä»½" class="headerlink" title="ä¸‰ã€æ•°æ®åº“å¤‡ä»½"></a>ä¸‰ã€æ•°æ®åº“å¤‡ä»½</h3><h4 id="1ã€ç›´æ¥å¤‡ä»½åº“"><a href="#1ã€ç›´æ¥å¤‡ä»½åº“" class="headerlink" title="1ã€ç›´æ¥å¤‡ä»½åº“"></a>1ã€ç›´æ¥å¤‡ä»½åº“</h4><p>ï¼ˆAï¼‰å¤‡ä»½ä¸€ä¸ªåº“</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## å¤‡ä»½æŒ‡å®šä¸»æœºæŸä¸ªåº“</span>mysqldump -h host_name -P port -u user_name -p user_pass â€“database database_name <span class="token operator">></span> bak_file_name.sql<span class="token comment" spellcheck="true">## å¤‡ä»½æœ¬åœ°æ•°æ®åº“ï¼Œæ‰§è¡Œæ—¶è¾“å¯†ç </span>mysqldump -u user_name â€“p â€“database database_name  <span class="token operator">></span>  bak_file_name.suffix</code></pre><p>å®ä¾‹å¦‚ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## å¤‡ä»½192.168.66.82ä¸Šçš„æ•°æ®åº“DBCM</span>mysqldump -h 192.168.66.82 -u root â€“p123456  â€“database dbcm  <span class="token operator">></span>  dbcm_20200617.sql<span class="token comment" spellcheck="true">## å¤‡ä»½æ•°æ®åº“DBCMï¼Œæ‰§è¡Œæ—¶è¾“å¯†ç </span>mysqldump -u root â€“p  â€“database dbcm  <span class="token operator">></span>  dbcm_20200617.sql</code></pre><p>ï¼ˆBï¼‰å¤‡ä»½å¤šä¸ªåº“:</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## å¤‡ä»½æŒ‡å®šä¸»æœºé‡Œçš„å¤šä¸ªåº“</span>mysqldump -h <span class="token function">hostname</span> -u username -p user_pass â€“databases db_name1 db_name2 db_name3 <span class="token operator">></span> more_dbname_file.suffix</code></pre><p>å¦‚å¤‡ä»½ç³»ç»Ÿè‡ªå¸¦åº“ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## å¤‡ä»½192.168.66.82ä¸Šçš„æ•°æ®åº“è‡ªå¸¦ç³»ç»Ÿåº“</span>mysqldump -h 192.168.66.82 -u root â€“p123456  â€“databases information_schema mysql <span class="token operator">></span> sys_bak.sql</code></pre><p>è¯´æ˜ï¼šåç»­åˆ—ä¸¾å°±ä¸å†åˆ†åˆ«åˆ—è¿œç¨‹ä¸æœ¬åœ°äº†ï¼ŒåŒºåˆ«åªæ˜¯<code>-h host_name</code>åŠ<code>-P host_port</code>ï¼Œç»Ÿä¸€ç”¨æœ¬åœ°åˆ—ä¸¾ã€‚</p><h4 id="2ã€ç›´æ¥å¤‡ä»½åº“çš„è¡¨"><a href="#2ã€ç›´æ¥å¤‡ä»½åº“çš„è¡¨" class="headerlink" title="2ã€ç›´æ¥å¤‡ä»½åº“çš„è¡¨"></a>2ã€ç›´æ¥å¤‡ä»½åº“çš„è¡¨</h4><p>å¤‡ä»½æŒ‡å®šåº“çš„æŒ‡å®šè¡¨ </p><pre class=" language-bash"><code class="language-bash">mysqldump -u user_name â€“p â€“database database_name  table_name1  table_name2 <span class="token operator">></span>  bak_fileName.suffix</code></pre><p>ä¾‹å¦‚ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">##å¤‡ä»½æ•°æ®åº“DBCMé‡Œçš„loginfoè¡¨</span>mysqldump -u root â€“p â€“database dbcm loginfo  <span class="token operator">></span>  dbcm_loginfo_20200617.sql<span class="token comment" spellcheck="true">## å¤šå¼ è¡¨</span>mysqldump -u root â€“p â€“database dbcm loginfo user <span class="token operator">></span>  dbcm_log_user_20200617.sql</code></pre><h4 id="3ã€å‹ç¼©å¤‡ä»½"><a href="#3ã€å‹ç¼©å¤‡ä»½" class="headerlink" title="3ã€å‹ç¼©å¤‡ä»½"></a>3ã€å‹ç¼©å¤‡ä»½</h4><pre class=" language-bash"><code class="language-bash">mysqldump -h host_name -u user_name -p user_pass -database db_name <span class="token operator">|</span> <span class="token function">gzip</span> <span class="token operator">></span> backup_file.sql.gz</code></pre><h4 id="4ã€åªå¤‡ä»½æ•°æ®åº“è¡¨ç»“æ„"><a href="#4ã€åªå¤‡ä»½æ•°æ®åº“è¡¨ç»“æ„" class="headerlink" title="4ã€åªå¤‡ä»½æ•°æ®åº“è¡¨ç»“æ„"></a>4ã€åªå¤‡ä»½æ•°æ®åº“è¡¨ç»“æ„</h4><pre class=" language-bash"><code class="language-bash">mysqldump  â€“no-data -u user_name -p user_pass â€“databases db_name1 db_name2 db_name3 <span class="token operator">></span> db_table_bak.sql</code></pre><h4 id="5ã€å¤‡ä»½æ‰€æœ‰æ•°æ®åº“"><a href="#5ã€å¤‡ä»½æ‰€æœ‰æ•°æ®åº“" class="headerlink" title="5ã€å¤‡ä»½æ‰€æœ‰æ•°æ®åº“"></a>5ã€å¤‡ä»½æ‰€æœ‰æ•°æ®åº“</h4><pre class=" language-bash"><code class="language-bash">mysqldump â€“all-databases -u user_name -p user_pass <span class="token operator">></span> all_db.sql</code></pre><h4 id="6ã€å¸¦åˆ é™¤çš„å¤‡ä»½"><a href="#6ã€å¸¦åˆ é™¤çš„å¤‡ä»½" class="headerlink" title="6ã€å¸¦åˆ é™¤çš„å¤‡ä»½"></a>6ã€å¸¦åˆ é™¤çš„å¤‡ä»½</h4><p>å¤‡ä»½<code>MySQL</code>æ•°æ®åº“ä¸ºå¸¦åˆ é™¤è¡¨çš„æ ¼å¼ï¼Œèƒ½å¤Ÿè®©è¯¥å¤‡ä»½è¦†ç›–å·²æœ‰æ•°æ®åº“è€Œä¸éœ€è¦æ‰‹åŠ¨åˆ é™¤åŸæœ‰æ•°æ®åº“</p><p>é€šä¿—çš„è¯´å°±æ˜¯<code>CREATE TABLE table_name</code>ä¹‹å‰æœ‰<code>DROP TABLE IF EXISTS table_name</code>çš„åŠ¨ä½œã€‚mysqlé»˜è®¤å¤‡ä»½å°±æ”¯æŒã€‚</p><pre class=" language-bash"><code class="language-bash">mysqldump --add-drop-table -u username -p password -database databasename <span class="token operator">></span> backup_file.sql</code></pre><h4 id="7ã€binlogå¢é‡å¤‡ä»½"><a href="#7ã€binlogå¢é‡å¤‡ä»½" class="headerlink" title="7ã€binlogå¢é‡å¤‡ä»½"></a>7ã€binlogå¢é‡å¤‡ä»½</h4><p>å¢é‡å¤‡ä»½æ˜¯ä½¿ç”¨<code>mysql</code>çš„<code>binlog</code>æ—¥å¿—ä½œä¸ºè®°å½•æ–°å¢çš„å˜åŒ–ã€‚</p><p><code>--master-data</code>ï¼š</p><p>åœ¨<code>mysqldump</code>å‘½ä»¤ä¸­ä½¿ç”¨<code>--master-data=2</code>ï¼Œä¼šè®°å½•<code>binlog</code>æ–‡ä»¶å’Œ<code>position</code>çš„ä¿¡æ¯ã€‚</p><p><code>--single-transaction</code>ï¼š</p><p><code>--single-transaction</code>ä¼šå°†éš”ç¦»çº§åˆ«è®¾ç½®æˆ<code>repeatable-commited</code></p><p>é¦–å…ˆè¿›è¡Œå…¨å¤‡</p><pre><code>mysqldump -u username -p password --single-transaction --master-data=2 db_name &gt; backup_all_file.sql</code></pre><p>å¤‡ä»½æ–‡ä»¶ä¸­ä¼šæœ‰</p><p><code>-- CHANGE MASTER TO MASTER_LOG_FILE=&#39;bin-log.000002&#39;, MASTER_LOG_POS=xxx;</code></p><p>æ˜¯æŒ‡å¤‡ä»½åæ‰€æœ‰çš„æ›´æ”¹å°†ä¼šä¿å­˜åˆ°æ–°æ–‡ä»¶bin-log.000002äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚</p><h3 id="å››ã€æ•°æ®åº“è¿˜åŸ"><a href="#å››ã€æ•°æ®åº“è¿˜åŸ" class="headerlink" title="å››ã€æ•°æ®åº“è¿˜åŸ"></a>å››ã€æ•°æ®åº“è¿˜åŸ</h3><h4 id="1ã€ç›´æ¥è¿˜åŸ"><a href="#1ã€ç›´æ¥è¿˜åŸ" class="headerlink" title="1ã€ç›´æ¥è¿˜åŸ"></a>1ã€ç›´æ¥è¿˜åŸ</h4><pre class=" language-bash"><code class="language-bash">mysql -h <span class="token function">hostname</span> -u user_name -p user_pass database_name <span class="token operator">&lt;</span> backup_file.sql</code></pre><h4 id="2ã€å‹ç¼©è¿˜åŸ"><a href="#2ã€å‹ç¼©è¿˜åŸ" class="headerlink" title="2ã€å‹ç¼©è¿˜åŸ"></a>2ã€å‹ç¼©è¿˜åŸ</h4><pre class=" language-bash"><code class="language-bash">gunzip <span class="token operator">&lt;</span> backup_file.sql.gz <span class="token operator">|</span> mysql -u user_pass -p password database_name</code></pre><h4 id="3ã€sourceå¯¼å…¥"><a href="#3ã€sourceå¯¼å…¥" class="headerlink" title="3ã€sourceå¯¼å…¥"></a>3ã€sourceå¯¼å…¥</h4><p>ä½¿ç”¨sourceå‘½ä»¤ï¼Œéœ€è¦ä½¿ç”¨å‘½ä»¤ç™»å½•mysqlï¼Œç”¨useè¿›å…¥åˆ°æŸä¸ªæ•°æ®åº“åæ‰§è¡Œ</p><pre class=" language-mysql"><code class="language-mysql">source d:\backup_file.sql</code></pre><h4 id="4ã€æ•°æ®åº“è½¬ç§»"><a href="#4ã€æ•°æ®åº“è½¬ç§»" class="headerlink" title="4ã€æ•°æ®åº“è½¬ç§»"></a>4ã€æ•°æ®åº“è½¬ç§»</h4><pre class=" language-bash"><code class="language-bash">mysqldump -u user_name -p user_pass db_name <span class="token operator">|</span> mysql â€“host<span class="token operator">=</span>*.*.*.* -C db_name</code></pre><h4 id="5ã€å¢é‡è¿˜åŸ-æ¢å¤"><a href="#5ã€å¢é‡è¿˜åŸ-æ¢å¤" class="headerlink" title="5ã€å¢é‡è¿˜åŸ/æ¢å¤"></a>5ã€å¢é‡è¿˜åŸ/æ¢å¤</h4><p>é¦–å…ˆå¯¼å…¥å…¨å¤‡æ•°æ®ï¼Œsourceäº¦å¯ã€‚</p><pre class=" language-bash"><code class="language-bash">mysql -h host_name -u user_name -p user_pass  <span class="token operator">&lt;</span> backup_all_file.sql</code></pre><p>ç„¶åï¼Œæ¢å¤bin-log.000002</p><pre class=" language-bash"><code class="language-bash">mysqlbinlog bin-log.000002 <span class="token operator">|</span> mysql -h host_name -u user_name -p user_pass</code></pre><p>å¦‚æœè¿˜æœ‰åç»­æ–°å¢åŒç†æ¢å¤ã€‚</p><p>æ¢å¤éƒ¨åˆ†ï¼Œæ¢å¤åˆ°æŸä¸ªæ“ä½œçš„å‰é¢ä¸€ä¸ªpositionç‚¹ã€‚</p><p>æ§åˆ¶<code>binlog</code>çš„åŒºé—´çš„å‚æ•°æœ‰ï¼š</p><pre class=" language-mysql"><code class="language-mysql">--start-position  # å¼€å§‹ç‚¹ --stop-position # ç»“æŸç‚¹--start-date  # å¼€å§‹æ—¶é—´ --stop-date  # ç»“æŸæ—¶é—´</code></pre><p>æ‰¾åˆ°éœ€è¦æ“çš„æ¢å¤ç‚¹ï¼Œåè¿›è¡Œæ¢å¤</p><pre class=" language-bash"><code class="language-bash">mysqlbinlog mysql-bin.000003 --stop-position<span class="token operator">=</span>308 <span class="token operator">|</span>mysql -h host_name -u user_name -p user_pass </code></pre><p>æ‰¾åˆ°éœ€è¦çš„æ¢å¤æ—¶é—´åŒºé—´ï¼Œè¿›è¡Œæ¢å¤æŒ‡å®šæ—¶é—´åŒºé—´æ•°æ®</p><pre class=" language-bash"><code class="language-bash">mysqlbinlog mysql-bin.000003 --start-datetime<span class="token operator">=</span><span class="token string">'2019-12-01 00:00:00'</span> --stop-datetime<span class="token operator">=</span><span class="token string">'2019-12-31 23:59:59'</span> <span class="token operator">|</span>mysql -h host_name -u user_name -p user_pass</code></pre><p>æŸ¥çœ‹<code>binlog</code>å†…å®¹ï¼Œå¯ä»¥å°†<code>binlog</code>å†…å®¹å†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶æŸ¥çœ‹ï¼š</p><pre><code>mysqlbinlog --no-defaults --database=db   --base64-output=decode-rows -v --start-datetime=&#39;2019-12-01 00:00:00&#39; --stop-datetime=&#39;2019-12-31 23:59:59&#39;  mysql-bin.000003 &gt;  binlog003.sql</code></pre><h3 id="äº”ã€æˆæƒç®¡ç†"><a href="#äº”ã€æˆæƒç®¡ç†" class="headerlink" title="äº”ã€æˆæƒç®¡ç†"></a>äº”ã€æˆæƒç®¡ç†</h3><p>ç»å¸¸è§åˆ°æˆ–è‡ªå·±è®¾ç½®ä½¿ç”¨çš„æˆæƒé•¿è¿™æ ·ï¼š</p><pre class=" language-mysql"><code class="language-mysql">##ç»™æŒ‡å®šrootç”¨æˆ·åœ¨æœ¬æœºç™»å½•è¿æ¥åŠæ“ä½œæ‰€æœ‰Schemaçš„æ‰€æœ‰è¡¨çš„æƒé™grant all privileges on *.* to 'root'@'localhost' identified by 'user_pass';## åˆ·æ–°æƒé™è®¾ç½®flush privileges;</code></pre><p>å®é™…ä½¿ç”¨çš„æ—¶å€™å¯èƒ½ä¼šè¿›è¡Œä¸€äº›æ›´ç»†èŠ‚çš„æˆæƒé™åˆ¶ï¼Œé‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h4 id="1ã€æŸ¥çœ‹ç”¨æˆ·æƒé™"><a href="#1ã€æŸ¥çœ‹ç”¨æˆ·æƒé™" class="headerlink" title="1ã€æŸ¥çœ‹ç”¨æˆ·æƒé™"></a>1ã€æŸ¥çœ‹ç”¨æˆ·æƒé™</h4><pre class=" language-mysql"><code class="language-mysql">##æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·æƒé™show grants;## æŸ¥çœ‹å…¶ä»– MySQL ç”¨æˆ·æƒé™,æ³¨æ„user_nameå’Œlocalhostè¦åŠ å¼•å·show grants for user_name@localhost;</code></pre><h4 id="2ã€åŸºæœ¬æˆæƒå‘½ä»¤"><a href="#2ã€åŸºæœ¬æˆæƒå‘½ä»¤" class="headerlink" title="2ã€åŸºæœ¬æˆæƒå‘½ä»¤"></a>2ã€åŸºæœ¬æˆæƒå‘½ä»¤</h4><pre class=" language-mysql"><code class="language-mysql">grant <privileges>  on schema.table to user_name@host_name identified by user_pass</code></pre><p><strong>privileges</strong> ï¼šåŒ…æ‹¬å¸¸è§çš„æŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ“ä½œå¤–ï¼Œè¿˜åŒ…æ‹¬åˆ›å»ºè¡¨ã€ç´¢å¼•ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ç­‰æƒé™ã€‚ä½¿ç”¨æ—¶å…³é”®å­— â€œprivilegesâ€ å¯ä»¥çœç•¥ã€‚</p><p><strong>schema.table</strong> ï¼šå¯ä»¥ç»†èŠ‚åˆ°æŒ‡å®šåº“æŒ‡å®šè¡¨ï¼Œ<code>*.*</code> è¡¨ç¤ºæ‰€æœ‰çš„åº“ä¸‹æ‰€æœ‰çš„è¡¨ã€‚</p><p><strong>user_name@host_name identified by user_pass</strong>ï¼šè¡¨ç¤ºå…è®¸å“ªä¸ªç”¨æˆ·ä½¿ç”¨æŒ‡å®šå¯†ç ä»å“ªä¸ªä¸»æœºç™»å½•ï¼›å¸¸è§çš„å†™æ³•å¦‚ä¸‹ï¼šï¼ˆ<code>identified by user_pass</code>å®é™…ä½¿ç”¨æ—¶è®°å¾—åŠ ä¸Šï¼‰</p><table><thead><tr><th>å†™æ³•</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>â€˜rootâ€™@â€™localhostâ€™</td><td>å…è®¸rootç”¨æˆ·ä»æœ¬æœºè¿æ¥ç™»å½•</td></tr><tr><td>â€˜rootâ€™@â€™%â€™</td><td>å…è®¸rootç”¨æˆ·ä»ä»»æ„æœºå™¨è¿æ¥ç™»å½•</td></tr><tr><td>â€˜rootâ€™@â€™192.168.0.221â€™</td><td>å…è®¸rootç”¨æˆ·ä»<code>IP</code>ä¸º<code>192.168.0.221</code>çš„æœºå™¨è¿æ¥ç™»å½•</td></tr><tr><td>â€˜rootâ€™@â€™192.168.0.%â€™</td><td>å…è®¸rootç”¨æˆ·ä»<code>IP</code>ç½‘æ®µä¸º<code>192.168.0.*</code>çš„æœºå™¨è¿æ¥ç™»å½•</td></tr></tbody></table><blockquote><p>ä¸å†™@é€‰é¡¹æ—¶ï¼Œæ•ˆæœä¸åŠ @â€™%â€™æ˜¯ä¸€æ ·ã€‚</p><p>â€˜%â€™ä»åä¹‰ä¸ŠåŒ…æ‹¬ä»»ä½•ä¸»æœºï¼Œæ®è¯´æœ‰äº›ç‰ˆæœ¬â€™%â€™ä¸åŒ…æ‹¬<code>localhost</code>ï¼Œåˆ™éœ€è¦å•ç‹¬å¯¹<code>@&#39;localhost&#39;</code>è¿›è¡Œèµ‹å€¼ã€‚</p></blockquote><p>ï¼ˆ1ï¼‰ç»™æ™®é€šç”¨æˆ·æˆæƒ</p><p>æ™®é€šç”¨æˆ·ä¸€èˆ¬å¯ä»¥æˆæƒåŸºæœ¬æ•°æ®çš„æŸ¥è¯¢ã€å†™å…¥ã€ä¿®æ”¹ã€åˆ é™¤æ“ä½œï¼Œä¿®æ”¹ã€åˆ é™¤è§†å®é™…è¦æ±‚æƒ…å†µæˆæƒã€‚</p><p><code>bus_dbname</code> ï¼šè¡¨ç¤ºä¸šåŠ¡æ•°æ®åº“ã€‚<code>common_user</code>ï¼šæ™®é€šç”¨æˆ·è¿æ¥è´¦æˆ·ã€‚</p><pre class=" language-mysql"><code class="language-mysql">## åˆ†åˆ«æˆæƒgrant select on bus_dbname.* to common_user@'%'grant insert on bus_dbname.* to common_user@'%'grant update on bus_dbname.* to common_user@'%'grant delete on bus_dbname.* to common_user@'%'## åˆå¹¶æ“ä½œï¼Œä½¿ç”¨è‹±æ–‡é€—å·åˆ†éš”grant select, insert, update, delete on bus_dbname.* to common_user@'%'</code></pre><p>ï¼ˆ2ï¼‰ç»™é«˜æƒç”¨æˆ·æˆæƒ</p><p>å¦‚å¼€å‘äººå‘˜ï¼Œ<code>DBA</code>ç­‰ï¼Œå…è®¸å»ºè¡¨ç»“æ„ï¼Œåˆ è¡¨ï¼Œæ”¹è¡¨ç»“æ„ï¼Œæ”¹å¤–é”®ï¼Œå»ºè§†å›¾ï¼Œä¸´æ—¶è¡¨ï¼Œç´¢å¼•ï¼Œå­˜å‚¨è¿‡ç¨‹ç­‰ã€‚</p><p><code>bus_dbname</code> ï¼šè¡¨ç¤ºä¸šåŠ¡æ•°æ®åº“ã€‚<code>dev_userr</code>ï¼šå¼€å‘æˆ–ç®¡ç†ç”¨æˆ·è¿æ¥è´¦æˆ·ã€‚</p><pre class=" language-mysql"><code class="language-mysql">## æˆæƒdev_userç”¨æˆ· åœ¨MySQLçš„æ•°æ®åº“bus_dbnameä¸­å»ºè¡¨æ“ä½œ grant create on bus_dbname.* to dev_user@'192.168.0.%';## æˆæƒ æ”¹è¡¨grant alter on bus_dbname.* to dev_user@'192.168.0.%';## æˆæƒ åˆ è¡¨grant drop on bus_dbname.* to dev_user@'192.168.0.%';## æˆæƒ å¤–é”®æƒé™ã€‚grant references on bus_dbname.* to dev_user@'192.168.0.%';## æˆæƒ ä¸´æ—¶è¡¨æƒé™ã€‚grant create temporary tables on bus_dbname.* to dev_user@'192.168.0.%';## æˆæƒ ç´¢å¼•æƒé™ã€‚grant index on bus_dbname.* to dev_user@'192.168.0.%';## æˆæƒ è§†å›¾åˆ›å»ºã€‚grant create view on bus_dbname.* to dev_user@'192.168.0.%';## æˆæƒ è§†å›¾æŸ¥çœ‹ä»£ç ã€‚grant show view on bus_dbname.* to dev_user@'192.168.0.%';##ç»™æ™®é€š DBA/dev_useræˆæƒgrant all privileges on bus_dbname.* to dev_user@'localhost'##å¯ä»¥çœç•¥privilegesgrant all on bus_dbname.* to dev_user@'localhost' ##å…¶å®æ˜¯ç»™dev_useræˆæƒæ‰€æœ‰åº“å’Œæ‰€ä»¥è¡¨ï¼Œä¸€èˆ¬å¯ä»¥ç»™DBAgrant all on *.* to dev_user@'localhost'</code></pre><p>å…³äºå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„ä½¿ç”¨å…³é”®å­—ï¼š<code>create routine</code>ã€‚</p><p>æˆæƒ<code>create  routine</code>è¡¨ç¤ºå¯ä»¥åˆ›å»º<code>procedure</code> å’Œ<code>function</code> ã€‚</p><p>å¦‚æœç”¨æˆ·åˆ›å»ºäº†<code>procedure</code>æˆ–<code>function</code>é‚£ä¹ˆ<code>mysql</code>ä¼šè‡ªåŠ¨èµ‹äºˆè¯¥ç”¨æˆ·å¯¹<code>procedure</code> æˆ– <code>function</code> çš„<code>alter routine</code>å’Œ<code>execute</code> æƒé™ã€‚</p><pre class=" language-mysql"><code class="language-mysql">grant create routine on bus_dbname.* to dev_user@'192.168.0.%'; </code></pre><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ï¼š</p><pre class=" language-mysql"><code class="language-mysql">delimiter $create procedure sp_hello_mysql()begin    select 'hello mysql';end $</code></pre><p>å†å»æŸ¥è¯¢æˆæƒ</p><pre class=" language-mysql"><code class="language-mysql">show grants;</code></pre><p>å°±å¯ä»¥çœ‹åˆ°ç”¨æˆ·<code>alter routine</code>å’Œ<code>execute</code> æƒé™ã€‚</p><p>ï¼ˆ3ï¼‰æˆæƒåˆ†å±‚</p><p><code>grant</code>çš„æˆæƒå¯ä»¥æˆæƒç»™æ•´ä¸ª<code>mysql</code>åº“ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæŸä¸ªåº“ï¼ŒæŒ‡å®šæŸä¸ªåº“çš„æŸä¸ªè¡¨ï¼ŒæŒ‡å®šè¡¨çš„åˆ—ï¼ŒæŒ‡å®šè§†å›¾ã€æŒ‡å®šå‡½æ•°ã€æŒ‡å®šå­˜å‚¨è¿‡ç¨‹ç­‰</p><pre class=" language-mysql"><code class="language-mysql">## æˆæƒ MySQLä¸­çš„æ‰€æœ‰æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨ï¼Œä¹Ÿå°±æ˜¯å®Œæ•´çš„å…¨éƒ¨æƒé™grant all on *.* to 'root'@'localhost'; ## æˆæƒuser_name ç»™æŸä¸ªæŒ‡å®šçš„æ•°æ®åº“çš„æŸ¥è¯¢æƒé™grant select  on bus_dbname.* to user_name@localhost; ## æˆæƒ ç»™æŸä¸ªæŒ‡å®šçš„æ•°æ®åº“çš„æŒ‡å®šè¡¨select, insert, update, deleteæƒé™grant select, insert, update, delete on bus_dbname.table_name to user_name@localhost; ## æˆæƒ ç»™æŸä¸ªæŒ‡å®šçš„æ•°æ®åº“çš„æŒ‡å®šè¡¨æŸ¥è¯¢æŒ‡å®šåˆ—çš„æƒé™grant select(id, name, rank) on bus_dbname.table_name to user_name@localhost;## æˆæƒ æŒ‡å®šçš„å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œæƒé™grant execute on procedure bus_dbname.pr_procname to user_name@localhost;## æˆæƒ æŒ‡å®šçš„å‡½æ•°æ‰§è¡Œæƒé™grant execute on function bus_dbname.fn_funcname to user_name@localhost;</code></pre><h4 id="3ã€æ’¤é”€æˆæƒå‘½ä»¤"><a href="#3ã€æ’¤é”€æˆæƒå‘½ä»¤" class="headerlink" title="3ã€æ’¤é”€æˆæƒå‘½ä»¤"></a>3ã€æ’¤é”€æˆæƒå‘½ä»¤</h4><p>æ’¤é”€æˆæƒä½¿ç”¨<code>revoke</code>å‘½ä»¤ã€‚</p><p><code>revoke</code> å’Œ<code>grant</code> çš„è¯­æ³•ç›¸ä¼¼ï¼Œéœ€è¦æŠŠå…³é”®å­— <code>to</code> æ¢æˆ <code>from</code>,å‘½ä»¤æ ¼å¼ï¼š</p><pre class=" language-mysql"><code class="language-mysql">## æˆæƒdev_userç”¨æˆ·åœ¨æœ¬åœ°ç™»å½•åçš„ æ“ä½œæ‰€æœ‰åº“æ‰€æœ‰è¡¨çš„æ‰€æœ‰æƒé™grant all on *.* to dev_user@localhost ;## æ’¤é”€dev_userç”¨æˆ·åœ¨æœ¬åœ°ç™»å½•åçš„ æ“ä½œæ‰€æœ‰åº“æ‰€æœ‰è¡¨çš„æ‰€æœ‰æƒé™revoke all on *.* from dev_user@localhost;</code></pre><h4 id="4ã€æ³¨æ„äº‹é¡¹"><a href="#4ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="4ã€æ³¨æ„äº‹é¡¹"></a>4ã€æ³¨æ„äº‹é¡¹</h4><p>ï¼ˆ1ï¼‰æ‰§è¡Œ<code>grant</code>,<code>revoke</code> æ“ä½œæƒé™åï¼Œç›¸å…³ç”¨æˆ·ï¼Œé‡æ–°è¿æ¥<code>MySQL</code> æ•°æ®åº“åï¼Œæƒé™æ‰èƒ½ç”Ÿæ•ˆã€‚</p><p>ï¼ˆ2ï¼‰ç”¨æˆ·è¢«æˆäºˆäº†æŸä¸ªæƒé™ï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥ç”¨æˆ·æ˜¯ä¸èƒ½æŠŠè¿™ä¸ªæƒé™æˆäºˆç»™å…¶ä»–äººçš„.ã€‚</p><p>å¯ä»¥ä½¿ç”¨<code>WITH GRANT OPTION</code>è¿™ä¸ªå­å¥æ¥è®©è¯¥ç”¨æˆ·å¯ä»¥å°†æƒé™å†æˆäºˆç»™å…¶ä»–äººã€‚</p><p><code>WITH GRANT OPTION</code>ï¼šè¡¨ç¤ºå…è®¸æƒé™ä¼ é€’ã€‚ç”¨äºå¯¹è±¡æˆæƒã€‚åŒºåˆ«äº ç”¨äºç³»ç»Ÿæƒé™æˆæƒçš„<code>with admin option</code>ã€‚</p><p>è¿˜å¯ä»¥é€šè¿‡ç›´æ¥æˆäºˆGRANT OPTIONæƒé™æ¥è¾¾åˆ°è¿™ä¸ªæ•ˆæœã€‚</p><pre class=" language-mysql"><code class="language-mysql">##ä½¿ç”¨ WITH GRANT OPTIONå…è®¸æƒé™ä¼ é€’grant select, insert, update, delete on bus_dbname.table_name to user_name@localhost WITH  GRANT OPTION; ## ç›´æ¥æˆæƒGRANT OPTIONgrant select,grant option on bus_dbname.table_name to user_name@localhost ; </code></pre><p>ï¼ˆ3ï¼‰æƒé™ä¼ é€’<code>WITH  GRANT OPTION</code>ç”¨æˆ·çš„æƒé™è¢«æ”¶å›æ—¶ï¼Œå…¶ä»–è¢«ä¼ é€’çš„ç›¸åŒæƒé™è‡ªåŠ¨æ”¶å›ã€‚</p><p>ï¼ˆ4ï¼‰æƒé™ä¿¡æ¯ç”¨userã€dbã€hostã€<code>tables_priv</code>å’Œ<code>columns_priv</code>è¡¨è¢«å­˜å‚¨åœ¨<code>mysql</code>æ•°æ®åº“ä¸­</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLä¹‹SQLåˆ†é¡µçš„Nç§ç©æ³•</title>
      <link href="/posts/2cbe04e7.html"/>
      <url>/posts/2cbe04e7.html</url>
      
        <content type="html"><![CDATA[<h2 id="SQLåˆ†é¡µçš„Nç§ç©æ³•"><a href="#SQLåˆ†é¡µçš„Nç§ç©æ³•" class="headerlink" title="SQLåˆ†é¡µçš„Nç§ç©æ³•"></a>SQLåˆ†é¡µçš„Nç§ç©æ³•</h2><p>æ•´ç†è¯´æ˜ï¼š</p><blockquote><p>å¤§æ¦‚ä»¥å–å‰3é¡µä¸ºä¾‹ã€‚</p><p>page_size â€” &gt;æ¯é¡µæ˜¾ç¤ºæ¡æ•° 10ï¼Œåé¢ä¸å†é‡å¤è¯´æ˜ã€‚</p><p>page_num  â€”&gt; é¡µç   1,2,3 å–å‰é¢çš„2é¡µæˆ–3é¡µ</p><p>ä»<a href="3c74f69f.html">ã€ŠSQLä¹‹æŸ¥è¯¢å‰Næ¡è®°å½•ã€‹</a>ä¸€æ–‡æ•´ç†çš„<code>â€œæ•°æ®åº“å’Œåˆ†é¡µå…³é”®å­—/å‡½æ•°å¯¹åº”å…³ç³»è¡¨â€</code>å¯ä»¥çœ‹åˆ°åˆ†é¡µå¤§è‡´åˆ†4ç±»æ•°æ®åº“ï¼Œå°±ä»¥ä»£è¡¨æ€§çš„æ•°æ®åº“æ¥åˆ—ä¸¾ï¼Œç›¸åŒå…³é”®å­—æˆ–å‡½æ•°çš„æ•°æ®åº“ç”¨æ³•ç›¸ä¼¼ï¼Œä¸å†å•åˆ—ã€‚</p><p>æƒ³äº†è§£Mybtatisæ¨¡ç³ŠæŸ¥è¯¢ï¼Ÿè¯·å‚è€ƒ<a href="4c7816b.html">ã€ŠMybatis-æ¨¡ç³ŠæŸ¥è¯¢çš„Nç§ç©æ³•ã€‹</a>ã€‚</p></blockquote><h3 id="ä¸€ã€SQL-Server-åˆ†é¡µ"><a href="#ä¸€ã€SQL-Server-åˆ†é¡µ" class="headerlink" title="ä¸€ã€SQL Server åˆ†é¡µ"></a>ä¸€ã€SQL Server åˆ†é¡µ</h3><h4 id="ï¼ˆ1ï¼‰TOPæ–¹å¼"><a href="#ï¼ˆ1ï¼‰TOPæ–¹å¼" class="headerlink" title="ï¼ˆ1ï¼‰TOPæ–¹å¼"></a>ï¼ˆ1ï¼‰TOPæ–¹å¼</h4><p>æŸ¥è¯¢ç¬¬ä¸€é¡µçš„æ—¶å€™ï¼Œç”¨topæ–¹æ³•ï¼Œæ•ˆç‡æœ€é«˜ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>  <span class="token keyword">top</span> <span class="token number">10</span>  pagesize   <span class="token keyword">from</span> table_name <span class="token keyword">where</span> id <span class="token operator">not</span> <span class="token operator">in</span><span class="token punctuation">(</span> <span class="token keyword">select</span> <span class="token keyword">top</span>  page_size <span class="token operator">*</span><span class="token punctuation">(</span>page_num  <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>   id <span class="token keyword">from</span> table_name<span class="token punctuation">)</span></code></pre><p>å¦‚ï¼š</p><p>ç¬¬1é¡µï¼špage_num  =1 æ—¶</p><pre><code>select top 10  *  from loginfo where id not in(select top 0  id from loginfo)</code></pre><p>ç¬¬2é¡µï¼špage_num  =2 æ—¶</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">10</span>  <span class="token operator">*</span>  <span class="token keyword">from</span> loginfo <span class="token keyword">where</span> id <span class="token operator">not</span> <span class="token operator">in</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">10</span> id <span class="token keyword">from</span> loginfo<span class="token punctuation">)</span></code></pre><p>ç¬¬2é¡µï¼špage_num  =3 æ—¶</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">10</span>  <span class="token operator">*</span>  <span class="token keyword">from</span> loginfo <span class="token keyword">where</span> id <span class="token operator">not</span> <span class="token operator">in</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">20</span> id <span class="token keyword">from</span> loginfo<span class="token punctuation">)</span></code></pre><h4 id="ï¼ˆ2ï¼‰row-number-åˆ†é¡µ"><a href="#ï¼ˆ2ï¼‰row-number-åˆ†é¡µ" class="headerlink" title="ï¼ˆ2ï¼‰row_number()åˆ†é¡µ"></a>ï¼ˆ2ï¼‰row_number()åˆ†é¡µ</h4><p> SQLServer2005ä»¥åå‡ºç°ã€‚å…¶å®å°±æ˜¯æŠŠæ•°æ®ç¼–å·ï¼Œå†æ ¹æ®ç¼–å·åˆ†é¡µæ˜¾ç¤ºã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>Rn<span class="token operator">=</span>row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">asc</span><span class="token punctuation">)</span> <span class="token keyword">from</span> loginfo<span class="token punctuation">)</span> <span class="token keyword">as</span> t<span class="token keyword">where</span> t<span class="token punctuation">.</span>Rn <span class="token operator">between</span> <span class="token punctuation">(</span>page_num <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span> page_size <span class="token operator">+</span><span class="token number">1</span> <span class="token operator">and</span> page_num <span class="token operator">*</span> page_size <span class="token punctuation">;</span></code></pre><p>å¦‚ï¼š</p><p>ç¬¬1é¡µï¼špage_num=1 æ—¶</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span> row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">asc</span><span class="token punctuation">)</span> <span class="token keyword">as</span> rownum <span class="token keyword">from</span> loginfo<span class="token punctuation">)</span> <span class="token keyword">as</span> t<span class="token keyword">where</span> t<span class="token punctuation">.</span>rownum <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span>  <span class="token number">10</span></code></pre><p>ç¬¬2é¡µï¼špage_num=2 æ—¶</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">asc</span><span class="token punctuation">)</span> <span class="token keyword">as</span> rownum <span class="token keyword">from</span> loginfo<span class="token punctuation">)</span> <span class="token keyword">as</span> t<span class="token keyword">where</span> t<span class="token punctuation">.</span>rownum <span class="token operator">between</span> <span class="token number">11</span> <span class="token operator">and</span>  <span class="token number">20</span></code></pre><p>ç¬¬2é¡µï¼špage_num=3 æ—¶</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>Rn<span class="token operator">=</span>row_number<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">asc</span><span class="token punctuation">)</span> <span class="token keyword">from</span> loginfo<span class="token punctuation">)</span> <span class="token keyword">as</span> t<span class="token keyword">where</span> t<span class="token punctuation">.</span>Rn <span class="token operator">between</span> <span class="token number">21</span> <span class="token operator">and</span>  <span class="token number">30</span></code></pre><h4 id="ï¼ˆ3ï¼‰offset-fetch-next-æ–¹å¼"><a href="#ï¼ˆ3ï¼‰offset-fetch-next-æ–¹å¼" class="headerlink" title="ï¼ˆ3ï¼‰offset  fetch next æ–¹å¼"></a>ï¼ˆ3ï¼‰offset  fetch next æ–¹å¼</h4><p>Sqlserve2012å¼€å§‹æ”¯æŒã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token keyword">offset</span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span> <span class="token operator">*</span> page_size <span class="token keyword">rows</span> <span class="token keyword">fetch</span> <span class="token keyword">next</span> page_size <span class="token keyword">rows</span> only</code></pre><p>å¦‚ï¼š</p><p>ç¬¬1é¡µï¼špage_num=1 æ—¶</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> loginfo <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">offset</span> <span class="token number">0</span> <span class="token keyword">rows</span> <span class="token keyword">fetch</span> <span class="token keyword">next</span> <span class="token number">10</span> <span class="token keyword">rows</span> only</code></pre><p>ç¬¬2é¡µï¼špage_num=2 æ—¶</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> loginfo <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">offset</span> <span class="token number">10</span> <span class="token keyword">rows</span> <span class="token keyword">fetch</span> <span class="token keyword">next</span> <span class="token number">10</span> <span class="token keyword">rows</span> only</code></pre><p>ç¬¬2é¡µï¼špage_num=3 æ—¶</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> loginfo <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">offset</span> <span class="token number">20</span> <span class="token keyword">rows</span> <span class="token keyword">fetch</span> <span class="token keyword">next</span> <span class="token number">10</span> <span class="token keyword">rows</span> only</code></pre><p>è¡¨ç¤ºä»ç¬¬10è¡Œå¼€å§‹å–æ¥ä¸‹æ¥çš„10è¡Œæ•°æ®ã€‚</p><h3 id="äºŒã€Mysqlåˆ†é¡µ"><a href="#äºŒã€Mysqlåˆ†é¡µ" class="headerlink" title="äºŒã€Mysqlåˆ†é¡µ"></a>äºŒã€Mysqlåˆ†é¡µ</h3><h4 id="ï¼ˆ1ï¼‰Limit"><a href="#ï¼ˆ1ï¼‰Limit" class="headerlink" title="ï¼ˆ1ï¼‰Limit"></a>ï¼ˆ1ï¼‰Limit</h4><p>Limité€‚ç”¨äºæ•°æ®é‡è¾ƒå°‘çš„æƒ…å†µï¼Œæ•°æ®é‡åœ¨ä¸‡ä»¥ä¸‹ï¼Œä¼šè¿›è¡Œå…¨è¡¨æ‰«æã€‚</p><p>mysqlæ•°æ®åº“ä½¿ç”¨limitåˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œç´¢å¼•æ˜¯ä»0å¼€å§‹çš„ï¼Œè¡¨ä¸­ç¬¬1æ¡æ•°æ®çš„ç´¢å¼•æ˜¯0ï¼Œç¬¬2æ¡æ•°æ®çš„ç´¢å¼•æ˜¯1ï¼Œç¬¬3æ¡æ•°æ®çš„ç´¢å¼•æ˜¯2ï¼Œä»¥æ­¤ç±»æ¨â€¦</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">limit</span> <span class="token keyword">index</span><span class="token punctuation">,</span> pagesize<span class="token punctuation">;</span></code></pre><p>indexè¡¨ç¤ºç»“æœé›†ç´¢å¼•å¼€å§‹è¡Œæå‰æ•°æ®ï¼›</p><p>pagesizeè¡¨ç¤ºç»“æœé›†ç´¢å¼•å¼€å§‹è¡Œ,å–å‡ºpagesizeæ¡è®°å½•æ•°æ®ã€‚</p><p>å®é™…ä½¿ç”¨æ—¶ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">limit</span>  <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span> page_size<span class="token punctuation">,</span> page_size<span class="token punctuation">;</span> </code></pre><p>å¦‚ï¼š</p><p>ç¬¬1é¡µï¼špage_num  =1 æ—¶</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> loginfo <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ä»ç¬¬1è¡Œå¼€å§‹ï¼Œå–10æ¡æ•°æ®ï¼Œç´¢å¼•æ˜¯[0-9]</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> loginfo <span class="token keyword">limit</span> <span class="token number">10</span> <span class="token punctuation">;</span></code></pre><p>ç¬¬2é¡µï¼špage_num  =2 æ—¶</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> loginfo <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ä»ç¬¬11è¡Œå¼€å§‹ï¼Œå–10æ¡æ•°æ®ï¼Œç´¢å¼•æ˜¯[10-19]</span></code></pre><p>ç¬¬3é¡µã€ç¬¬4é¡µä»¥æ­¤ç±»æ¨â€¦</p><h4 id="ï¼ˆ2ï¼‰ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•åˆ†é¡µ"><a href="#ï¼ˆ2ï¼‰ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•åˆ†é¡µ" class="headerlink" title="ï¼ˆ2ï¼‰ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•åˆ†é¡µ"></a>ï¼ˆ2ï¼‰ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•åˆ†é¡µ</h4><p>åˆ©ç”¨ç´¢å¼•æ‰«æï¼Œå¯ä»¥æå‡æŸ¥è¯¢é€Ÿåº¦ï¼Œå¯ç”¨äºä¸‡çº§æ•°æ®é‡ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> id_primarykey <span class="token operator">></span> <span class="token punctuation">(</span>page_num<span class="token operator">*</span>page_size<span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> id_primarykey <span class="token keyword">asc</span> <span class="token keyword">limit</span> page_size</code></pre><p>å¦‚ï¼š</p><p>ç¬¬1é¡µï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_s_log <span class="token keyword">where</span> id <span class="token operator">></span> <span class="token number">10</span> <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">asc</span> <span class="token keyword">limit</span> <span class="token number">10</span></code></pre><p>ç¬¬2é¡µï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_s_log <span class="token keyword">where</span> id <span class="token operator">></span> <span class="token number">20</span> <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">asc</span> <span class="token keyword">limit</span> <span class="token number">10</span></code></pre><h4 id="ï¼ˆ3ï¼‰ç´¢å¼•é¢„æ‰§è¡ŒPREPARE"><a href="#ï¼ˆ3ï¼‰ç´¢å¼•é¢„æ‰§è¡ŒPREPARE" class="headerlink" title="ï¼ˆ3ï¼‰ç´¢å¼•é¢„æ‰§è¡ŒPREPARE"></a>ï¼ˆ3ï¼‰ç´¢å¼•é¢„æ‰§è¡ŒPREPARE</h4><p>è¯­æ³•</p><pre class=" language-sql"><code class="language-sql">PREPARE stmt_name <span class="token keyword">FROM</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_name <span class="token keyword">WHERE</span> id_primarykey <span class="token operator">></span> <span class="token punctuation">(</span>page_num <span class="token operator">*</span> page_size<span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id_primarykey <span class="token keyword">asc</span> <span class="token keyword">limit</span> page_sizeã€‚</code></pre><p>ã€ŠMysqlé¢„æ‰§è¡ŒPREPAREã€‹</p><h4 id="ï¼ˆ4ï¼‰åˆ©ç”¨å­æŸ¥è¯¢-åµŒå¥—æŸ¥è¯¢"><a href="#ï¼ˆ4ï¼‰åˆ©ç”¨å­æŸ¥è¯¢-åµŒå¥—æŸ¥è¯¢" class="headerlink" title="ï¼ˆ4ï¼‰åˆ©ç”¨å­æŸ¥è¯¢/åµŒå¥—æŸ¥è¯¢"></a>ï¼ˆ4ï¼‰åˆ©ç”¨å­æŸ¥è¯¢/åµŒå¥—æŸ¥è¯¢</h4><p>åˆ©ç”¨å­æŸ¥è¯¢ï¼Œå¦‚æœæœ‰ç´¢å¼•æˆ–ä¸»é”®å°½é‡ä½¿ç”¨ç´¢å¼•æˆ–ä¸»é”®æ’åºï¼Œå­æŸ¥è¯¢æ˜¯åœ¨ç´¢å¼•ä¸Šå®Œæˆã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span><span class="token operator">*</span> <span class="token keyword">FROM</span> table_name <span class="token keyword">WHERE</span>  id <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> table_name <span class="token keyword">ORDER</span><span class="token keyword">BY</span> id <span class="token keyword">desc</span> <span class="token keyword">LIMIT</span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id <span class="token keyword">desc</span> <span class="token keyword">LIMIT</span>  page_size</code></pre><p>æˆ‘æµ‹è¯•å®é™…è¿è¡Œæ•°æ®åº“ä¸€å¼ æ—¥å¿—è¡¨ä¸­4ä¸‡æ¡æ•°æ®çš„æƒ…å†µä¸‹æŸ¥è¯¢é€Ÿåº¦å¯¹æ¯”ï¼Œæˆ‘çš„ä¸»é”®idæ˜¯32ä½å­—ç¬¦ä¸²ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--æ‰§è¡Œæ—¶é—´çº¦ï¼š0.030 sec</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_s_log <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">30000</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--æ‰§è¡Œæ—¶é—´çº¦ï¼š0.012 sec</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_s_log <span class="token keyword">WHERE</span> ID <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> ID <span class="token keyword">FROM</span> T_S_LOG <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ID   <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">30000</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span>  <span class="token number">10</span><span class="token punctuation">;</span></code></pre><p>å­æŸ¥è¯¢æ˜æ˜¾æ¯”å•çº¯çš„<code>limit index, page_size</code>å¿«ã€‚</p><h4 id="ï¼ˆ5ï¼‰åˆ©ç”¨è¿æ¥æŸ¥è¯¢"><a href="#ï¼ˆ5ï¼‰åˆ©ç”¨è¿æ¥æŸ¥è¯¢" class="headerlink" title="ï¼ˆ5ï¼‰åˆ©ç”¨è¿æ¥æŸ¥è¯¢"></a>ï¼ˆ5ï¼‰åˆ©ç”¨è¿æ¥æŸ¥è¯¢</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_name <span class="token keyword">AS</span> t1<span class="token keyword">JOIN</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> table_name <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id <span class="token keyword">desc</span> <span class="token keyword">LIMIT</span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size <span class="token punctuation">)</span><span class="token keyword">AS</span> t2<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>id <span class="token operator">&lt;=</span> t2<span class="token punctuation">.</span>id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>id <span class="token keyword">desc</span> <span class="token keyword">LIMIT</span> page_size<span class="token punctuation">;</span></code></pre><p>ä»æŸ¥è¯¢çš„ä¸´æ—¶è¡¨t2å¯ä»¥çœ‹å¾—å‡ºå½“é¡µç è¶Šå¤§é€Ÿåº¦ä¼šè¶Šæ…¢ï¼Œæ­¤æ–¹æ³•æ…ç”¨ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--æ‰§è¡Œæ—¶é—´çº¦ï¼š11.193 sec</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_s_log <span class="token keyword">AS</span> t1 <span class="token keyword">JOIN</span> <span class="token punctuation">(</span>     <span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> t_s_log <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">100</span> <span class="token punctuation">)</span><span class="token keyword">AS</span> t2<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>id <span class="token operator">&lt;=</span> t2<span class="token punctuation">.</span>id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>id <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span></code></pre><h4 id="ï¼ˆ6ï¼‰BETWEEN-ANDåˆ†é¡µ"><a href="#ï¼ˆ6ï¼‰BETWEEN-ANDåˆ†é¡µ" class="headerlink" title="ï¼ˆ6ï¼‰BETWEEN ANDåˆ†é¡µ"></a>ï¼ˆ6ï¼‰BETWEEN ANDåˆ†é¡µ</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_name <span class="token keyword">where</span> id <span class="token operator">BETWEEN</span> start_id <span class="token operator">AND</span> end_id<span class="token punctuation">;</span></code></pre><p>å¯ä»¥çœ‹å‡ºè¿™æ˜¯ç›´æ¥å®šä½IDçš„èŒƒå›´çš„æ–¹å¼ï¼Œå®ƒååˆ†ä¾èµ–idçš„ï¼Œå¦‚idçš„è¿ç»­æ€§é—®é¢˜ï¼Œä½†æ˜¯ä½œä¸ºæ— åˆ é™¤çš„åº”ç”¨ç¯å¢ƒä¸‹æ˜¯ååˆ†å®ç”¨çš„ä¸”é«˜æ•ˆçš„ã€‚<code>BETWEEN  ADN</code>çš„æ–¹å¼æ”¯æŒå­—ç¬¦ä¸²IDã€‚ä½†æ˜¯ä½œä¸ºä¸€ç§åˆ†é¡µæŸ¥è¯¢çš„æ–¹å¼ï¼Œé‡‡ç”¨ç›´æ¥å®šä½IDèŒƒå›´çš„æ–¹å¼ï¼Œä¾æ—§æ˜¯æ¯”è¾ƒæœ‰æ•ˆç‡çš„ã€‚</p><h3 id="ä¸‰ã€Oracle-åˆ†é¡µ"><a href="#ä¸‰ã€Oracle-åˆ†é¡µ" class="headerlink" title="ä¸‰ã€Oracle åˆ†é¡µ"></a>ä¸‰ã€Oracle åˆ†é¡µ</h3><p>oracleä¸»è¦è¿˜æ˜¯ä½¿ç”¨<code>ROWNUM</code>è¿›è¡Œåˆ†é¡µã€‚</p><h4 id="ï¼ˆ1ï¼‰ç›´æ¥ç®€å•ç²—æš´çš„æ–¹å¼"><a href="#ï¼ˆ1ï¼‰ç›´æ¥ç®€å•ç²—æš´çš„æ–¹å¼" class="headerlink" title="ï¼ˆ1ï¼‰ç›´æ¥ç®€å•ç²—æš´çš„æ–¹å¼"></a>ï¼ˆ1ï¼‰ç›´æ¥ç®€å•ç²—æš´çš„æ–¹å¼</h4><p>å…ˆæ’åºå†å–éœ€è¦çš„æ•°æ®ï¼Œæ•°æ®è¶Šå¤šè¶Šæ…¢ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>    <span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rownum num <span class="token keyword">from</span> table_name t<span class="token punctuation">)</span> <span class="token keyword">where</span> t<span class="token punctuation">.</span>num <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>page_num <span class="token operator">*</span> page_size<span class="token punctuation">)</span> <span class="token operator">and</span>  t<span class="token punctuation">.</span>num<span class="token operator">>=</span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size <span class="token operator">+</span><span class="token number">1</span><span class="token comment" spellcheck="true">--where BETWEEN (page_num-1)*page_size +1 AND  (page_num * page_size) </span></code></pre><p>æ’åºå¥½äº†ç›´æ¥æ‹¿ï¼Œ</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>  <span class="token operator">*</span>ï¼ŒROWNUM  rn  <span class="token keyword">FROM</span> table_name <span class="token keyword">where</span> rm <span class="token operator">BETWEEN</span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size <span class="token operator">+</span><span class="token number">1</span> <span class="token operator">AND</span>  <span class="token punctuation">(</span>page_num <span class="token operator">*</span> page_size<span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--æ³¨æ„ï¼šoracle æ²¡æœ‰ as</span></code></pre><h4 id="ï¼ˆ2ï¼‰å­æŸ¥è¯¢-åµŒå¥—æŸ¥è¯¢"><a href="#ï¼ˆ2ï¼‰å­æŸ¥è¯¢-åµŒå¥—æŸ¥è¯¢" class="headerlink" title="ï¼ˆ2ï¼‰å­æŸ¥è¯¢/åµŒå¥—æŸ¥è¯¢"></a>ï¼ˆ2ï¼‰å­æŸ¥è¯¢/åµŒå¥—æŸ¥è¯¢</h4><p>å­æŸ¥è¯¢éƒ½æ˜¯é€šè¿‡é™å®šæŸ¥è¯¢èŒƒå›´çš„æ–¹å¼ç¼©å°æŸ¥è¯¢èŒƒå›´ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span>    <span class="token keyword">SELECT</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>ROWNUM r <span class="token keyword">FROM</span> table_name t <span class="token keyword">WHERE</span> r <span class="token operator">&lt;=</span> page_num<span class="token operator">*</span>page_size<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> r <span class="token operator">></span><span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size<span class="token comment" spellcheck="true">--æ²¡æœ‰+1æ˜¯å› ä¸ºç”¨çš„å¤§äºå·</span></code></pre><p>â€‹    ï¼ˆaï¼‰ä¸æ’åºçš„å­æŸ¥è¯¢</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> tmp<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>    <span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>ROWNUM rn <span class="token keyword">from</span> table_name t <span class="token keyword">where</span> t<span class="token punctuation">.</span>rn <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>page_num <span class="token operator">*</span> page_size<span class="token punctuation">)</span><span class="token punctuation">)</span> tmp <span class="token keyword">where</span> tmp<span class="token punctuation">.</span>rn <span class="token operator">>=</span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size <span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">;</span><span class="token comment" spellcheck="true">-- +1æ˜¯å› ä¸ºç”¨çš„å¤§äºæˆ–ç­‰äºå·</span></code></pre><p>â€‹    ï¼ˆbï¼‰å¸¦ <code>order by</code>çš„æ’åº</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> tmp<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>    <span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> rownum rn <span class="token keyword">from</span> <span class="token punctuation">(</span>        <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> T_BASE_PROVINCE <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">asc</span>    <span class="token punctuation">)</span> t     <span class="token keyword">where</span> t<span class="token punctuation">.</span>rn <span class="token operator">&lt;=</span>  <span class="token punctuation">(</span>page_num <span class="token operator">*</span> page_size<span class="token punctuation">)</span><span class="token punctuation">)</span> tmp<span class="token keyword">where</span> tmp<span class="token punctuation">.</span>rn <span class="token operator">>=</span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size <span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">;</span></code></pre><h4 id="ï¼ˆ3ï¼‰ä½¿ç”¨minusä½œå·®"><a href="#ï¼ˆ3ï¼‰ä½¿ç”¨minusä½œå·®" class="headerlink" title="ï¼ˆ3ï¼‰ä½¿ç”¨minusä½œå·®"></a>ï¼ˆ3ï¼‰ä½¿ç”¨minusä½œå·®</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> rownum<span class="token operator">&lt;=</span><span class="token punctuation">(</span>page_num <span class="token operator">*</span> page_size<span class="token punctuation">)</span>minus <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> rownum<span class="token operator">&lt;=</span><span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size</code></pre><h4 id="ï¼ˆ4ï¼‰WITH-ASæ–¹å¼"><a href="#ï¼ˆ4ï¼‰WITH-ASæ–¹å¼" class="headerlink" title="ï¼ˆ4ï¼‰WITH  ASæ–¹å¼"></a>ï¼ˆ4ï¼‰WITH  ASæ–¹å¼</h4><p><code>WITH  AS</code>å°†SQLè¯­å¥ä¸­å•ç‹¬çš„å­æŸ¥è¯¢è¯­å¥æå–å‡ºæ¥ï¼Œä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ä¸´æ—¶è¡¨æ¥ç»„ç»‡å‘½åã€‚åœ¨åŸæ¥çš„è¯­å¥ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨æ–°çš„åˆ«åæ¥æ›¿ä»£å­æŸ¥è¯¢ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">WITH</span> tmp1 <span class="token keyword">AS</span><span class="token punctuation">(</span><span class="token punctuation">(</span>      <span class="token keyword">SELECT</span> ROWNUM <span class="token keyword">AS</span> rowno<span class="token punctuation">,</span> tt<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span>           <span class="token keyword">SELECT</span> <span class="token operator">*</span>  <span class="token keyword">FROM</span> table_name t              <span class="token keyword">WHERE</span> <span class="token keyword">some</span> conditions              <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> fact_up_time<span class="token punctuation">,</span> flight_no     <span class="token punctuation">)</span> tt    <span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> page_num<span class="token operator">*</span>page_size<span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tmp1<span class="token punctuation">.</span>rowno <span class="token operator">></span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size</code></pre><p>è¿™é‡Œæ˜¯æœ‰æ’åºçš„ï¼Œæ— æ’åºçš„å†™æ³•åŒç†ã€‚</p><p>æ€»ç»“ï¼š<strong>èƒ½ä¸æŸ¥å…¨è¡¨å°½é‡ä¸å»æŸ¥å…¨è¡¨ï¼Œå°½å¿«ç¼©å°æŸ¥è¯¢èŒƒå›´ï¼Œå†æå–åˆ†é¡µæ•°æ®ã€‚</strong></p><h3 id="å››ã€DB2åˆ†é¡µ"><a href="#å››ã€DB2åˆ†é¡µ" class="headerlink" title="å››ã€DB2åˆ†é¡µ"></a>å››ã€DB2åˆ†é¡µ</h3><h4 id="ï¼ˆ1ï¼‰BETWEEN-ANDåˆ†é¡µ"><a href="#ï¼ˆ1ï¼‰BETWEEN-ANDåˆ†é¡µ" class="headerlink" title="ï¼ˆ1ï¼‰BETWEEN ANDåˆ†é¡µ"></a>ï¼ˆ1ï¼‰BETWEEN ANDåˆ†é¡µ</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>    <span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">asc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> rowid <span class="token keyword">from</span> table_name<span class="token punctuation">)</span><span class="token keyword">as</span> <span class="token number">a</span><span class="token keyword">where</span> <span class="token number">a</span><span class="token punctuation">.</span>rowid <span class="token operator">>=</span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size<span class="token operator">+</span><span class="token number">1</span>  <span class="token operator">AND</span> <span class="token number">a</span><span class="token punctuation">.</span>rowid <span class="token operator">&lt;=</span> page_num<span class="token operator">*</span>page_size<span class="token comment" spellcheck="true">--where a.rowid  between (page_num-1)*page_size+1  and  page_num*page_size</span></code></pre><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œtable_nameå¯èƒ½ä¼šæ˜¯ä¸€ä¸ªçœŸæ­£ä¸šåŠ¡æ•°æ®å­æŸ¥è¯¢ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>    <span class="token keyword">select</span> tmp_page<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> row_id <span class="token keyword">from</span> <span class="token punctuation">(</span>         <span class="token keyword">select</span>  ID<span class="token punctuation">,</span> LOG_MSG<span class="token punctuation">,</span> OPACCOUNT<span class="token punctuation">,</span> OP_TIME<span class="token punctuation">,</span> OPTYPE<span class="token punctuation">,</span> VERIFY_ACCOUNT<span class="token punctuation">,</span> ADDRIP<span class="token punctuation">,</span> DBAPP <span class="token keyword">from</span> LOGINFO <span class="token keyword">WHERE</span> <span class="token punctuation">(</span> OP_TIME <span class="token operator">>=</span> <span class="token string">'2020-06-15 17:05:52'</span> <span class="token operator">and</span> OPTYPE <span class="token operator">=</span> <span class="token string">'ç™»å½•'</span> <span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">desc</span>    <span class="token punctuation">)</span> <span class="token keyword">as</span> tmp_page<span class="token punctuation">)</span> <span class="token keyword">where</span> row_id <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">30</span> </code></pre><h4 id="ï¼ˆ2ï¼‰WITH-AS-æ–¹å¼"><a href="#ï¼ˆ2ï¼‰WITH-AS-æ–¹å¼" class="headerlink" title="ï¼ˆ2ï¼‰WITH  AS æ–¹å¼"></a>ï¼ˆ2ï¼‰WITH  AS æ–¹å¼</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">WITH</span> TMP <span class="token keyword">AS</span><span class="token punctuation">(</span>    <span class="token comment" spellcheck="true">--å…ˆæ‰¾å‡ºéœ€è¦çš„æ•°æ®</span>   <span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">asc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> row_id <span class="token keyword">from</span> table_name<span class="token punctuation">)</span><span class="token comment" spellcheck="true">--æœ€åæ ¹æ®åºå·å–æ•°æ®</span><span class="token keyword">SELECT</span> TMP<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> TMP <span class="token keyword">WHERE</span>  row_id <span class="token operator">between</span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size <span class="token operator">and</span> page_num<span class="token operator">*</span>page_size</code></pre><p>æœ¬è´¨è¿˜æ˜¯å€ŸåŠ©<code>rownumber() over()</code>æ’å¥½åºï¼Œæ˜æ˜¾å¯ä»¥çœ‹åˆ°ç¼ºç‚¹æ˜¯ä¸´æ—¶è¡¨è¾ƒå¤§ã€‚</p><p>å®é™…ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">with</span> tmp <span class="token keyword">as</span><span class="token punctuation">(</span>    <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>        <span class="token keyword">select</span> tmp_page<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> row_id <span class="token keyword">from</span> <span class="token punctuation">(</span>                 <span class="token keyword">select</span>  ID<span class="token punctuation">,</span> LOG_MSG<span class="token punctuation">,</span> OPACCOUNT<span class="token punctuation">,</span>OP_TIME<span class="token punctuation">,</span> OPTYPE                 <span class="token keyword">from</span> LOGINFO <span class="token keyword">WHERE</span> <span class="token punctuation">(</span> OPTYPE <span class="token operator">>=</span><span class="token string">'2020-06-15 17:05:52'</span> <span class="token operator">and</span> OPTYPE <span class="token operator">=</span> <span class="token string">'ç™»é™†'</span>                     <span class="token punctuation">)</span>  <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">desc</span>         <span class="token punctuation">)</span> <span class="token keyword">as</span> tmp_page      <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tmp <span class="token keyword">where</span> row_id <span class="token operator">between</span> <span class="token number">30</span> <span class="token operator">and</span> <span class="token number">40</span></code></pre><h4 id="ï¼ˆ3ï¼‰Fetch-first-rows-only"><a href="#ï¼ˆ3ï¼‰Fetch-first-rows-only" class="headerlink" title="ï¼ˆ3ï¼‰Fetch first rows only"></a>ï¼ˆ3ï¼‰Fetch first rows only</h4><p>ä½¿ç”¨Fetch first rows onlyåˆ†é¡µä¾æ—§å€ŸåŠ©<code>WITH  AS</code>ä½†æ˜¯å¯ä»¥ä¸æ–­ç¼©å°ä¸´æ—¶è¡¨çš„èŒƒå›´ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">WITH</span> TMP <span class="token keyword">AS</span><span class="token punctuation">(</span>    <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>            <span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">asc</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> row_id <span class="token keyword">from</span> table_name    <span class="token punctuation">)</span>     <span class="token keyword">where</span>  row_id <span class="token operator">></span> <span class="token punctuation">(</span>page_num<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>page_size<span class="token punctuation">)</span><span class="token keyword">SELECT</span> TMP<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> TMP <span class="token keyword">WHERE</span>   <span class="token keyword">fetch</span> <span class="token keyword">first</span>  pagesize  <span class="token keyword">rows</span> only</code></pre><p>å®é™…ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">with</span> tmp <span class="token keyword">as</span><span class="token punctuation">(</span>    <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>        <span class="token keyword">select</span> tmp_page<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> row_id <span class="token keyword">from</span> <span class="token punctuation">(</span>             <span class="token keyword">select</span>  ID<span class="token punctuation">,</span>  LOG_MSG<span class="token punctuation">,</span> OPACCOUNT<span class="token punctuation">,</span> OP_APPNAME<span class="token punctuation">,</span> OP_DATABASE<span class="token punctuation">,</span> OP_TIME<span class="token punctuation">,</span> OPTYPE             <span class="token keyword">from</span> LOGINFO <span class="token keyword">WHERE</span> <span class="token punctuation">(</span> OPTYPE <span class="token operator">>=</span><span class="token string">'2020-06-15 17:05:52'</span> <span class="token operator">and</span> OPTYPE <span class="token operator">=</span> <span class="token string">'ç™»å½•'</span> <span class="token punctuation">)</span>               <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">desc</span>         <span class="token punctuation">)</span> <span class="token keyword">as</span> tmp_page     <span class="token punctuation">)</span> <span class="token keyword">where</span> row_id <span class="token operator">></span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tmp <span class="token keyword">fetch</span> <span class="token keyword">first</span>  <span class="token number">10</span> <span class="token keyword">rows</span> only</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> SQLåˆ†é¡µ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLä¹‹æŸ¥è¯¢å‰Næ¡è®°å½•</title>
      <link href="/posts/3c74f69f.html"/>
      <url>/posts/3c74f69f.html</url>
      
        <content type="html"><![CDATA[<h2 id="SQLæŸ¥è¯¢å‰Næ¡è®°å½•çš„ä¸åŒç©æ³•"><a href="#SQLæŸ¥è¯¢å‰Næ¡è®°å½•çš„ä¸åŒç©æ³•" class="headerlink" title="SQLæŸ¥è¯¢å‰Næ¡è®°å½•çš„ä¸åŒç©æ³•"></a>SQLæŸ¥è¯¢å‰Næ¡è®°å½•çš„ä¸åŒç©æ³•</h2><h3 id="æŸ¥è¯¢å‰Næ¡è®°å½•"><a href="#æŸ¥è¯¢å‰Næ¡è®°å½•" class="headerlink" title="æŸ¥è¯¢å‰Næ¡è®°å½•"></a>æŸ¥è¯¢å‰Næ¡è®°å½•</h3><p>è¯´æ˜ï¼š</p><blockquote><p>N â€”å°±æ˜¯æˆ‘ä»¬è¦æŸ¥è¯¢çš„Næ¡è®°å½•ã€‚</p><p>ç¤ºä¾‹é»˜è®¤æŸ¥è¯¢å‰10æ¡è®°å½•ã€‚</p><p>è¯­æ³•æ¼”ç¤ºçš„éƒ½æ˜¯ç®€å•æŸ¥è¯¢ï¼Œå¦‚æœæœ‰æ¡ä»¶å’Œæ’åºè¯·è‡ªè¡Œæ·»åŠ ï¼Œç¤ºä¾‹é»˜è®¤ä¸ºæ— æ¡ä»¶å’Œé»˜è®¤æ’åºã€‚</p><p>æƒ³äº†è§£å„ä¸ªæ•°æ®åº“SQLåˆ†é¡µï¼Ÿè¯·å‚è€ƒ<a href="2cbe04e7.html">ã€ŠSQLä¹‹SQLåˆ†é¡µçš„Nç§ç©æ³•ã€‹</a>ã€‚</p><p>æƒ³äº†è§£Mybtatisæ¨¡ç³ŠæŸ¥è¯¢ï¼Ÿè¯·å‚è€ƒ<a href="4c7816b.html">ã€ŠMybatis-æ¨¡ç³ŠæŸ¥è¯¢çš„Nç§ç©æ³•ã€‹</a>ã€‚</p></blockquote><h4 id="1ã€TOP-å…³é”®å­—"><a href="#1ã€TOP-å…³é”®å­—" class="headerlink" title="1ã€TOP å…³é”®å­—"></a>1ã€TOP å…³é”®å­—</h4><p>TOP å…³é”®å­—æ”¯æŒçš„æ•°æ®åº“ï¼š <code>SQL Server</code> ã€ <code>Access</code> ã€‚</p><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>  <span class="token keyword">top</span>  N  <span class="token operator">*</span>  <span class="token keyword">from</span> table_name <span class="token punctuation">;</span></code></pre><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>  <span class="token keyword">top</span> <span class="token number">10</span>  <span class="token operator">*</span>  <span class="token keyword">from</span> loginfo <span class="token punctuation">;</span></code></pre><h4 id="2ã€Limit-å…³é”®å­—"><a href="#2ã€Limit-å…³é”®å­—" class="headerlink" title="2ã€Limit å…³é”®å­—"></a>2ã€Limit å…³é”®å­—</h4><p>Limitå…³é”®å­—æ”¯æŒçš„æ•°æ®åº“ï¼š <code>MySQLr</code> ã€<code>MariaDB</code>ã€<code>PostgreSQL</code>ã€ <code>SQLite</code>ã€‚</p><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>  <span class="token operator">*</span>  <span class="token keyword">from</span> table_name  <span class="token keyword">limit</span> N <span class="token punctuation">;</span></code></pre><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>  <span class="token operator">*</span>  <span class="token keyword">from</span> loginfo <span class="token keyword">limit</span> <span class="token number">10</span> <span class="token punctuation">;</span></code></pre><h4 id="3ã€ROWNUM-è¡Œè®¡æ•°å™¨"><a href="#3ã€ROWNUM-è¡Œè®¡æ•°å™¨" class="headerlink" title="3ã€ROWNUM è¡Œè®¡æ•°å™¨"></a>3ã€ROWNUM è¡Œè®¡æ•°å™¨</h4><p>ROWNUM æ”¯æŒçš„æ•°æ®åº“ï¼š<code>Oracle</code></p><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>  <span class="token operator">*</span>  <span class="token keyword">from</span> table_name <span class="token keyword">where</span> ROWNUM <span class="token operator">&lt;=</span> N <span class="token punctuation">;</span></code></pre><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>  <span class="token operator">*</span>  <span class="token keyword">from</span> loginfo <span class="token keyword">where</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">10</span> <span class="token punctuation">;</span></code></pre><h4 id="4ã€Fetch-frist-N-rows-only"><a href="#4ã€Fetch-frist-N-rows-only" class="headerlink" title="4ã€Fetch frist  N   rows  only"></a>4ã€Fetch frist  N   rows  only</h4><p>Fetch first  N   rows  only æ”¯æŒçš„æ•°æ®åº“ï¼š<code>DB2</code></p><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>  <span class="token operator">*</span>  <span class="token keyword">from</span> table_name  <span class="token keyword">Fetch</span> <span class="token keyword">first</span>  N  <span class="token keyword">rows</span>  only <span class="token punctuation">;</span></code></pre><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span>  <span class="token operator">*</span>  <span class="token keyword">from</span> loginfo <span class="token keyword">Fetch</span> <span class="token keyword">first</span>  <span class="token number">10</span>  <span class="token keyword">rows</span>  only <span class="token punctuation">;</span></code></pre><h3 id="æ•°æ®åº“å’Œåˆ†é¡µå…³é”®å­—-å‡½æ•°å¯¹åº”å…³ç³»è¡¨"><a href="#æ•°æ®åº“å’Œåˆ†é¡µå…³é”®å­—-å‡½æ•°å¯¹åº”å…³ç³»è¡¨" class="headerlink" title="æ•°æ®åº“å’Œåˆ†é¡µå…³é”®å­—/å‡½æ•°å¯¹åº”å…³ç³»è¡¨"></a>æ•°æ®åº“å’Œåˆ†é¡µå…³é”®å­—/å‡½æ•°å¯¹åº”å…³ç³»è¡¨</h3><p>æ•°æ®åº“æŸ¥è¯¢å’Œåˆ†é¡µå…³é”®å­—/å‡½æ•°å¯¹åº”å…³ç³»ï¼š</p><table><thead><tr><th>æ•°æ®åº“</th><th>åˆ†é¡µå…³é”®å­—/å‡½æ•°</th></tr></thead><tbody><tr><td>SQL Server ã€ Access</td><td>TOP</td></tr><tr><td>MySQLr ã€MariaDBã€PostgreSQLã€ SQLite</td><td>Limit</td></tr><tr><td>Oracle</td><td>ROWNUM</td></tr><tr><td>DB2</td><td>Fetch frist  N   rows  only</td></tr></tbody></table><br/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis-æ¨¡ç³ŠæŸ¥è¯¢çš„Nç§ç©æ³•</title>
      <link href="/posts/4c7816b.html"/>
      <url>/posts/4c7816b.html</url>
      
        <content type="html"><![CDATA[<h2 id="Mybatisæ¨¡ç³ŠæŸ¥è¯¢çš„Nç§ç©æ³•"><a href="#Mybatisæ¨¡ç³ŠæŸ¥è¯¢çš„Nç§ç©æ³•" class="headerlink" title="Mybatisæ¨¡ç³ŠæŸ¥è¯¢çš„Nç§ç©æ³•"></a>Mybatisæ¨¡ç³ŠæŸ¥è¯¢çš„Nç§ç©æ³•</h2><blockquote><p>å¾ˆå¤šæ—¶å€™æ¨¡ç³ŠæŸ¥è¯¢åœ¨å„ä¸ªå‚å•†æ•°æ®åº“ä¸ŠåŸºæœ¬å¯ä»¥é€šç”¨ã€‚</p><p>åŸæ¥é€šé…ç¬¦ä¸æ­¢<code>like</code></p></blockquote><h3 id="ä¸€ã€æ¨¡ç³ŠæŸ¥è¯¢é€šé…ç¬¦"><a href="#ä¸€ã€æ¨¡ç³ŠæŸ¥è¯¢é€šé…ç¬¦" class="headerlink" title="ä¸€ã€æ¨¡ç³ŠæŸ¥è¯¢é€šé…ç¬¦"></a>ä¸€ã€æ¨¡ç³ŠæŸ¥è¯¢é€šé…ç¬¦</h3><p>æ¨¡ç³ŠæŸ¥è¯¢ä¸€èˆ¬å°±æ˜¯é€šè¿‡å­—é¢é‡å’Œé€šé…ç¬¦å¯¹æ¡ä»¶è¿›è¡Œéƒ¨åˆ†è¿‡æ»¤ã€‚</p><p><strong>å¸¸è§é€šé…ç¬¦ï¼š</strong></p><table><thead><tr><th align="center">é€šé…ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td align="center">%</td><td>ç™¾åˆ†å·é€šé…ç¬¦ï¼Œæ”¯æŒç»å¤§éƒ¨åˆ†æ•°æ®åº“ã€‚<br/> % çš„ç»™å®šä½ç½®å¯ä»¥åŒ¹é…0ä¸ªå­—ç¬¦ã€1ä¸ªå­—ç¬¦æˆ–å¤šä¸ªå­—ç¬¦ã€‚ä¸èƒ½åŒ¹é…null</td></tr><tr><td align="center">*</td><td>Accessä½¿ç”¨çš„é€šé…ç¬¦ã€‚</td></tr><tr><td align="center">_</td><td>ä¸‹åˆ’çº¿é€šé…ç¬¦ï¼Œåªèƒ½åŒ¹é…å•ä¸ªå­—ç¬¦ã€‚<br/>DB2ä¸æ”¯æŒæ­¤ç”¨æ³•ã€‚Accessä¸­åˆ™ä½¿ç”¨ï¼Ÿä»£æ›¿_</td></tr><tr><td align="center">[ ]</td><td>æ–¹æ‹¬å·é€šé…ç¬¦ï¼ŒæŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†ï¼Œå¿…é¡»åŒ¹é…æŒ‡å®šä½ç½®çš„ä¸€ä¸ªå­—ç¬¦ã€‚<br/>åªæœ‰Accesså’ŒSQL Serveræ”¯æŒã€‚å¦‚ï¼š<code>like &#39;[zx]%&#39;</code> è¡¨ç¤ºä»¥zæˆ–è€…xå¼€å¤´çš„åŒ¹é…æ¡ä»¶ã€‚<br/>^å¯ä»¥ä½œä¸ºé€šé…ç¬¦å‰ç¼€è„±å­—å·è¿›è¡Œå¦å®šã€‚<br/><code>SQL Server</code>å†™æ³•ï¼š<code>like &#39;[^zx]%&#39;</code>è¡¨ç¤ºä¸ä»¥zæˆ–è€…xå¼€å¤´çš„åŒ¹é…æ¡ä»¶ã€‚<br/>Accessçš„å†™æ³•åˆ™æ˜¯<code>like &#39;[!zx]%&#39;</code></td></tr></tbody></table><h3 id="äºŒã€Mybatisæ¨¡ç³ŠæŸ¥è¯¢Nä¸­ç©æ³•"><a href="#äºŒã€Mybatisæ¨¡ç³ŠæŸ¥è¯¢Nä¸­ç©æ³•" class="headerlink" title="äºŒã€Mybatisæ¨¡ç³ŠæŸ¥è¯¢Nä¸­ç©æ³•"></a>äºŒã€Mybatisæ¨¡ç³ŠæŸ¥è¯¢Nä¸­ç©æ³•</h3><blockquote><p>è™½ç„¶æ˜¯<code>SQL</code>æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä½¿ç”¨<code>Mybatis</code>æµ‹è¯•å°±æš‚å½’ç±»åˆ°<code>Mybatis</code>ä¸‹ï¼Œä½†å…¶å®æœ‰ä¸å°‘æŸ¥è¯¢åŸºæœ¬ä¸Šå¯ä»¥é€šç”¨ã€‚</p><p>è¯´æ˜ï¼šä¸‹åˆ—å†™æ³•æ˜¯ä½¿ç”¨<code>DB2</code>æ•°æ®åº“æµ‹è¯•ï¼Œå…¶ä»–æ•°æ®åº“æœªä¸€ä¸€éªŒè¯ï¼Œæœ‰æ¡ä»¶å¯ä»¥è‡ªå·±å°è¯•ã€‚</p></blockquote><p>æ¯”å¦‚ï¼Œè¦æŸ¥è¯¢æ—¥å¿—è¡¨é‡Œ<code>LOG_MSG</code>å­—æ®µæœ‰<code>å½•å…¥</code>å­—æ ·çš„æ•°æ®ï¼š</p><h4 id="1ã€æ‰‹å·¥æ‹¼æ¥å¥½â€œ-â€å†ä¼ å…¥å‚æ•°"><a href="#1ã€æ‰‹å·¥æ‹¼æ¥å¥½â€œ-â€å†ä¼ å…¥å‚æ•°" class="headerlink" title="1ã€æ‰‹å·¥æ‹¼æ¥å¥½â€œ%â€å†ä¼ å…¥å‚æ•°"></a>1ã€æ‰‹å·¥æ‹¼æ¥å¥½â€œ%â€å†ä¼ å…¥å‚æ•°</h4><pre class=" language-java"><code class="language-java">LogInfo log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LogInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">setLogMsg</span><span class="token punctuation">(</span><span class="token string">"%å½•å…¥%"</span><span class="token punctuation">)</span>ï¼›</code></pre><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectLogInfo<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logInfo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM DBCM.LOGINFO WHERE LOG_MSG LIKE #{logMsg}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>å¦å¤–è¿™é‡Œ#{}å’Œ${}çš„æ˜¯æœ‰åŒºåˆ«çš„ï¼Œæˆ‘çœ‹æœ‰çš„åšå®¢é‡Œå°†æ¨¡ç³ŠæŸ¥è¯¢#{}å’Œ${}å†™æ³•åˆ—ä¸ºä¸¤ç§ï¼Œæ­¤æ–‡å¹¶ä¸åˆ†åˆ«åˆ—å‡ºï¼š</p><p>ï¼ˆaï¼‰éƒ½æ”¯æŒåŸºæœ¬ç±»å‹å’Œå¯¹è±¡ç±»å‹ã€‚</p><p>ï¼ˆbï¼‰#{}å¯ä»¥é˜²æ­¢<code>sql</code>æ³¨å…¥ï¼Œå¯ä»¥è‡ªåŠ¨ç»™Stringç±»å‹åŠ ä¸Š<code>&#39; &#39;</code></p><p>ï¼ˆcï¼‰${} åŸæ ·è¾“å‡ºï¼Œé€‚åˆäº åŠ¨æ€æ’åºï¼ˆåŠ¨æ€å­—æ®µï¼‰</p><h4 id="2ã€ä½¿ç”¨CONCATè¿æ¥å‡½æ•°"><a href="#2ã€ä½¿ç”¨CONCATè¿æ¥å‡½æ•°" class="headerlink" title="2ã€ä½¿ç”¨CONCATè¿æ¥å‡½æ•°"></a>2ã€ä½¿ç”¨<code>CONCAT</code>è¿æ¥å‡½æ•°</h4><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectLogInfo<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logInfo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  SELECT * FROM DBCM.LOGINFO WHERE LOG_MSG LIKE CONCAT('%', CONCAT(#{logMsg}),'%')<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><h4 id="3ã€ä½¿ç”¨Mybatisçš„bindæ ‡ç­¾"><a href="#3ã€ä½¿ç”¨Mybatisçš„bindæ ‡ç­¾" class="headerlink" title="3ã€ä½¿ç”¨Mybatisçš„bindæ ‡ç­¾"></a>3ã€ä½¿ç”¨Mybatisçš„<code>bind</code>æ ‡ç­¾</h4><p>åœ¨ç³»ç»Ÿå­¦ä¹ <code>Mybatis</code>çš„çš„åŠ¨æ€<code>SQL</code>ä¸­ï¼Œæœ‰ä¸ªbindæ ‡ç­¾ï¼Œæ”¯æŒå‚æ•°ç»‘å®šã€‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectLogInfo<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logInfo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bind</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pattern<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>%<span class="token punctuation">'</span> + _parameter.getLogMsg() + <span class="token punctuation">'</span>%<span class="token punctuation">'</span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  SELECT * FROM DBCM.LOGINFO WHERE LOG_MSG LIKE #{pattern}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><h4 id="4ã€ä½¿ç”¨LOCATEå‡½æ•°"><a href="#4ã€ä½¿ç”¨LOCATEå‡½æ•°" class="headerlink" title="4ã€ä½¿ç”¨LOCATEå‡½æ•°"></a>4ã€ä½¿ç”¨<code>LOCATE</code>å‡½æ•°</h4><blockquote><p>LOCATEæ˜¯å­—ç¬¦ä¸²æŸ¥è¯¢å‡½æ•°ã€‚è¿™ä¸ªå…¶å®å’Œ<code>Mybatis</code>æ²¡ä»€ä¹ˆå…³ç³»äº†ï¼Œåªè¦æ•°æ®åº“æ”¯æŒè¯¥å‡½æ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ï¼Œä¸‹åŒã€‚</p></blockquote><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> DBCM<span class="token punctuation">.</span>LOGINFO <span class="token keyword">WHERE</span>  LOCATE<span class="token punctuation">(</span><span class="token string">'å½•å…¥'</span><span class="token punctuation">,</span> LOG_MSG<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span></code></pre><h4 id="5ã€ä½¿ç”¨POSITIONå‡½æ•°"><a href="#5ã€ä½¿ç”¨POSITIONå‡½æ•°" class="headerlink" title="5ã€ä½¿ç”¨POSITIONå‡½æ•°"></a>5ã€ä½¿ç”¨<code>POSITION</code>å‡½æ•°</h4><p>positionåŠŸèƒ½è·ŸlocateåŠŸèƒ½ç›¸ä¼¼ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> DBCM<span class="token punctuation">.</span>LOGINFO <span class="token keyword">WHERE</span>  POSITION<span class="token punctuation">(</span><span class="token string">'å½•å…¥'</span> <span class="token operator">IN</span> LOG_MSG<span class="token punctuation">)</span></code></pre><h4 id="6ã€ä½¿ç”¨INSTRå‡½æ•°"><a href="#6ã€ä½¿ç”¨INSTRå‡½æ•°" class="headerlink" title="6ã€ä½¿ç”¨INSTRå‡½æ•°"></a>6ã€ä½¿ç”¨<code>INSTR</code>å‡½æ•°</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> DBCM<span class="token punctuation">.</span>LOGINFO <span class="token keyword">WHERE</span>  INSTR<span class="token punctuation">(</span>LOG_MSG<span class="token punctuation">,</span><span class="token string">'å½•å…¥'</span><span class="token punctuation">)</span></code></pre><h4 id="7ã€ä½¿ç”¨FIND-IN-SETå‡½æ•°"><a href="#7ã€ä½¿ç”¨FIND-IN-SETå‡½æ•°" class="headerlink" title="7ã€ä½¿ç”¨FIND_IN_SETå‡½æ•°"></a>7ã€ä½¿ç”¨<code>FIND_IN_SET</code>å‡½æ•°</h4><p><code>FIND_IN_SET</code>æ˜¯<code>Mysql</code>é‡Œçš„å‡½æ•°ã€‚è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql">FIND_IN_SET<span class="token punctuation">(</span>str<span class="token punctuation">,</span>strlist<span class="token punctuation">)</span></code></pre><p>å‡å¦‚å­—ç¬¦ä¸²<code>str</code> åœ¨ç”±Nä¸ªå­é“¾ç»„æˆçš„å­—ç¬¦ä¸²åˆ—è¡¨<code>strlist</code> ä¸­ï¼Œåˆ™è¿”å›å€¼çš„èŒƒå›´åœ¨ 1 åˆ° N ä¹‹é—´ã€‚</p><p>å­—ç¬¦ä¸²åˆ—è¡¨<code>strlist</code> å°±æ˜¯ä¸€ä¸ªç”±ä¸€äº›è¢«<code>&quot;,&quot;</code>ç¬¦å·åˆ†å¼€çš„è‡ªé“¾ç»„æˆçš„å­—ç¬¦ä¸²ã€‚</p><p>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¸¸é‡å­—ç¬¦ä¸²ï¼Œè€Œç¬¬äºŒä¸ªæ˜¯æœç´¢åˆ—ï¼Œåˆ™FIND_IN_SET() å‡½æ•°è¢«ä¼˜åŒ–ï¼Œä½¿ç”¨æ¯”ç‰¹è®¡ç®—ã€‚</p><p>å¦‚æœ<code>str</code>ä¸åœ¨<code>strlist</code> æˆ–<code>strlist</code>ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›å€¼ä¸º 0 ã€‚</p><p>å¦‚ä»»æ„ä¸€ä¸ªå‚æ•°ä¸ºNULLï¼Œåˆ™è¿”å›å€¼ä¸º NULLã€‚è¿™ä¸ªå‡½æ•°åœ¨ç¬¬ä¸€ä¸ªå‚æ•°åŒ…å«ä¸€ä¸ªé€—å·<code>&quot;,&quot;</code>æ—¶å°†æ— æ³•æ­£å¸¸è¿è¡Œã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> FIND_IN_SET<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'a,b,c,d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼š2</span></code></pre><p>ä½¿ç”¨è¯¥ç§æŸ¥è¯¢æ—¶ï¼Œæ¡ä»¶æ¯”è¾ƒä¸¥è‹›ï¼š<code>Mysql</code>æ•°æ®åº“ï¼›åŒ¹é…åˆ—å†…å®¹ä»¥<code>â€œ,â€</code>åˆ†å‰²ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--ä½¿ç”¨Mysqlæµ‹è¯•</span><span class="token keyword">select</span>  <span class="token operator">*</span> <span class="token keyword">from</span>  DBCM<span class="token punctuation">.</span>LOGINFO <span class="token keyword">where</span> FIND_IN_SET<span class="token punctuation">(</span><span class="token string">'å½•å…¥'</span><span class="token punctuation">,</span>LOG_MSG<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><br/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> Mybatis </tag>
            
            <tag> æ¨¡ç³ŠæŸ¥è¯¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaæ¨¡å—åŒ–ç³»ç»Ÿ</title>
      <link href="/posts/49b8efd0.html"/>
      <url>/posts/49b8efd0.html</url>
      
        <content type="html"><![CDATA[<h2 id="Javaæ¨¡å—åŒ–ç³»ç»Ÿ"><a href="#Javaæ¨¡å—åŒ–ç³»ç»Ÿ" class="headerlink" title="Javaæ¨¡å—åŒ–ç³»ç»Ÿ"></a>Javaæ¨¡å—åŒ–ç³»ç»Ÿ</h2><p>Javaæ¨¡å—åŒ–ç³»ç»Ÿï¼ˆJava Platform Module Systemï¼ŒJPMSï¼‰æ˜¯åœ¨JDK 9ä¸­å¼•å…¥çš„ã€‚</p><h3 id="1ã€å°è£…éš”ç¦»æœºåˆ¶"><a href="#1ã€å°è£…éš”ç¦»æœºåˆ¶" class="headerlink" title="1ã€å°è£…éš”ç¦»æœºåˆ¶"></a>1ã€å°è£…éš”ç¦»æœºåˆ¶</h3><p>ä¸»è¦æ˜¯ä¸ºäº†å®ç°å¯é…ç½®çš„å°è£…éš”ç¦»æœºåˆ¶ã€‚</p><p>Javaè™šæ‹Ÿæœºå¯¹ç±»åŠ è½½æ¶æ„ä¹Ÿåšå‡ºäº†ç›¸åº”çš„å˜åŠ¨è°ƒæ•´ï¼Œæ‰ä½¿æ¨¡å—åŒ–ç³»ç»Ÿå¾—ä»¥é¡ºåˆ©åœ°è¿ä½œã€‚</p><p>JDK 9çš„æ¨¡å—ä¸ä»…ä»…åƒä¹‹å‰çš„JARåŒ…é‚£æ ·åªæ˜¯ç®€å•åœ°å……å½“ä»£ç çš„å®¹å™¨ï¼Œé™¤äº†ä»£ç å¤–ï¼ŒJavaçš„æ¨¡å—å®šä¹‰è¿˜åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><p>ï¼ˆ1ï¼‰ä¾èµ–å…¶ä»–æ¨¡å—çš„åˆ—è¡¨ã€‚</p><p>ï¼ˆ2ï¼‰å¯¼å‡ºçš„åŒ…åˆ—è¡¨ï¼Œå³å…¶ä»–æ¨¡å—å¯ä»¥ä½¿ç”¨çš„åˆ—è¡¨ã€‚</p><p>ï¼ˆ3ï¼‰å¼€æ”¾çš„åŒ…åˆ—è¡¨ï¼Œå³å…¶ä»–æ¨¡å—å¯åå°„è®¿é—®æ¨¡å—çš„åˆ—è¡¨ã€‚</p><p>ï¼ˆ4ï¼‰ä½¿ç”¨çš„æœåŠ¡åˆ—è¡¨ã€‚</p><p>ï¼ˆ5ï¼‰æä¾›æœåŠ¡çš„å®ç°åˆ—è¡¨ã€‚</p><p>å¯é…ç½®çš„å°è£…éš”ç¦»æœºåˆ¶ä½œç”¨ï¼š</p><p>ï¼ˆ1ï¼‰è§£å†³JDK 9ä¹‹å‰åŸºäºç±»è·¯å¾„ï¼ˆClassPathï¼‰æ¥æŸ¥æ‰¾ä¾èµ–çš„å¯é æ€§é—®é¢˜ã€‚</p><blockquote><p>åœ¨JDK 9ä¹‹å‰å‰ï¼Œå¦‚æœç±»è·¯å¾„ä¸­ç¼ºå¤±äº†è¿è¡Œæ—¶ä¾èµ–çš„ç±»å‹ï¼Œé‚£å°±åªèƒ½ç­‰ç¨‹åºè¿è¡Œåˆ°å‘ç”Ÿè¯¥ç±»å‹çš„åŠ è½½ã€é“¾æ¥æ—¶æ‰ä¼šæŠ¥å‡ºè¿è¡Œçš„å¼‚å¸¸ã€‚</p><p>åœ¨JDK 9ä»¥åï¼Œå¦‚æœå¯ç”¨äº†æ¨¡å—åŒ–è¿›è¡Œå°è£…ï¼Œæ¨¡å—å°±å¯ä»¥å£°æ˜å¯¹å…¶ä»–æ¨¡å—çš„æ˜¾å¼ä¾èµ–ï¼ŒJavaè™šæ‹Ÿæœºå°±èƒ½å¤Ÿåœ¨å¯åŠ¨æ—¶éªŒè¯åº”ç”¨ç¨‹åºå¼€å‘é˜¶æ®µè®¾å®šå¥½çš„ä¾èµ–å…³ç³»åœ¨è¿è¡ŒæœŸæ˜¯å¦å®Œå¤‡ï¼Œå¦‚æœ‰ç¼ºå¤±é‚£å°±ç›´æ¥å¯åŠ¨å¤±è´¥ï¼Œä»è€Œé¿å…äº†å¤§éƒ¨åˆ†ç”±äºç±»å‹ä¾èµ–è€Œå¼•å‘çš„è¿è¡Œæ—¶å¼‚å¸¸ã€‚</p></blockquote><p>ï¼ˆ2ï¼‰è§£å†³åŸæ¥ç±»è·¯å¾„ä¸Šè·¨JARæ–‡ä»¶çš„publicç±»å‹çš„å¯è®¿é—®æ€§é—®é¢˜ã€‚</p><blockquote><p>JDK 9ä¸­çš„publicç±»å‹ä¸å†æ„å‘³ç€ç¨‹åºçš„æ‰€æœ‰åœ°æ–¹çš„ä»£ç éƒ½å¯ä»¥éšæ„è®¿é—®åˆ°å®ƒä»¬ï¼Œæ¨¡å—æä¾›äº†æ›´ç²¾ç»†çš„å¯è®¿é—®æ€§æ§åˆ¶ï¼Œå¿…é¡»æ˜ç¡®å£°æ˜å…¶ä¸­å“ªä¸€äº›publicçš„ç±»å‹å¯ä»¥è¢«å…¶ä»–å“ªä¸€äº›æ¨¡å—è®¿é—®ï¼Œè¿™ç§è®¿é—®æ§åˆ¶ä¹Ÿä¸»è¦æ˜¯åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­å®Œæˆçš„ã€‚</p></blockquote><h3 id="2ã€æ¨¡å—çš„å…¼å®¹æ€§"><a href="#2ã€æ¨¡å—çš„å…¼å®¹æ€§" class="headerlink" title="2ã€æ¨¡å—çš„å…¼å®¹æ€§"></a>2ã€æ¨¡å—çš„å…¼å®¹æ€§</h3><p>ï¼ˆä¸€ï¼‰å‘ä¸‹å…¼å®¹</p><p>ä¸ºäº†å®ç°å¯é…ç½®çš„å°è£…éš”ç¦»æœºåˆ¶èƒ½å¤Ÿå…¼å®¹ä¼ ç»Ÿçš„ç±»è·¯å¾„æŸ¥æ‰¾æœºåˆ¶ï¼ŒJDK 9æå‡ºäº†ä¸â€œç±»è·¯å¾„â€ï¼ˆClassPathï¼‰ç›¸å¯¹åº”çš„â€œæ¨¡å—è·¯å¾„â€ï¼ˆModulePathï¼‰çš„æ¦‚å¿µã€‚</p><blockquote><p>å°±æ˜¯ä¸€ä¸ªç±»åº“åˆ°åº•æ˜¯æ¨¡å—è¿˜æ˜¯ä¼ ç»Ÿçš„JARåŒ…ï¼Œåªå–å†³äºå®ƒå­˜æ”¾åœ¨å“ªç§è·¯å¾„ä¸Šã€‚</p><p>åªè¦æ”¾åœ¨ç±»è·¯å¾„ä¸Šçš„JARæ–‡ä»¶ï¼Œæ— è®ºå…¶ä¸­æ˜¯å¦åŒ…å«æ¨¡å—åŒ–ä¿¡æ¯ï¼ˆæ˜¯å¦åŒ…å«äº†module-info.classæ–‡ä»¶ï¼‰ï¼Œå®ƒéƒ½ä¼šè¢«å½“ä½œä¼ ç»Ÿçš„JARåŒ…æ¥å¯¹å¾…ï¼›</p><p>åªè¦æ”¾åœ¨æ¨¡å—è·¯å¾„ä¸Šçš„JARæ–‡ä»¶ï¼Œå³ä½¿æ²¡æœ‰ä½¿ç”¨JMODåç¼€ï¼Œç”šè‡³è¯´å…¶ä¸­å¹¶ä¸åŒ…å«module-info.classæ–‡ä»¶ï¼Œå®ƒä¹Ÿä»ç„¶ä¼šè¢«å½“ä½œä¸€ä¸ªæ¨¡å—æ¥å¯¹å¾…ã€‚</p></blockquote><p>ä¼ ç»Ÿç±»è·¯å¾„ä¾èµ–çš„Javaç¨‹åºå¯ä»¥ä¸ç»ä¿®æ”¹åœ°ç›´æ¥è¿è¡Œåœ¨JDK 9åŠä»¥åçš„Javaç‰ˆæœ¬ä¸Šï¼Œæ¨¡å—åŒ–ç³»ç»Ÿæä¾›çš„è¿è¡Œè§„åˆ™ï¼š</p><p>ï¼ˆ1ï¼‰JARæ–‡ä»¶åœ¨ç±»è·¯å¾„çš„è®¿é—®è§„åˆ™ã€‚</p><blockquote><p>æ‰€æœ‰ç±»è·¯å¾„ä¸‹çš„JARæ–‡ä»¶åŠå…¶ä»–èµ„æºæ–‡ä»¶ï¼Œéƒ½è¢«è§†ä¸ºè‡ªåŠ¨æ‰“åŒ…åœ¨ä¸€ä¸ªåŒ¿åæ¨¡å—ï¼ˆUnnamed Moduleï¼‰é‡Œï¼Œè¿™ä¸ªåŒ¿åæ¨¡å—å‡ ä¹æ˜¯æ²¡æœ‰ä»»ä½•éš”ç¦»çš„ï¼Œå®ƒå¯ä»¥çœ‹åˆ°å’Œä½¿ç”¨ç±»è·¯å¾„ä¸Šæ‰€æœ‰çš„åŒ…ã€JDKç³»ç»Ÿæ¨¡å—ä¸­æ‰€æœ‰çš„å¯¼å‡ºåŒ…ï¼Œä»¥åŠæ¨¡å—è·¯å¾„ä¸Šæ‰€æœ‰æ¨¡å—ä¸­å¯¼å‡ºçš„åŒ…ã€‚</p></blockquote><p>ï¼ˆ2ï¼‰æ¨¡å—åœ¨æ¨¡å—è·¯å¾„çš„è®¿é—®è§„åˆ™</p><blockquote><p>æ¨¡å—è·¯å¾„ä¸‹çš„å…·åæ¨¡å—ï¼ˆNamed Moduleï¼‰åªèƒ½è®¿é—®åˆ°å®ƒä¾èµ–å®šä¹‰ä¸­åˆ—æ˜ä¾èµ–çš„æ¨¡å—å’ŒåŒ…ï¼ŒåŒ¿åæ¨¡å—é‡Œæ‰€æœ‰çš„å†…å®¹å¯¹å…·åæ¨¡å—æ¥è¯´éƒ½æ˜¯ä¸å¯è§çš„ï¼Œå³å…·åæ¨¡å—çœ‹ä¸è§ä¼ ç»ŸJARåŒ…çš„å†…å®¹ã€‚</p></blockquote><p>ï¼ˆ3ï¼‰JARæ–‡ä»¶åœ¨æ¨¡å—è·¯å¾„çš„è®¿é—®è§„åˆ™</p><blockquote><p>å¦‚æœæŠŠä¸€ä¸ªä¼ ç»Ÿçš„ã€ä¸åŒ…å«æ¨¡å—å®šä¹‰çš„JARæ–‡ä»¶æ”¾ç½®åˆ°æ¨¡å—è·¯å¾„ä¸­ï¼Œå®ƒå°±ä¼šå˜æˆä¸€ä¸ªè‡ªåŠ¨æ¨¡å—ï¼ˆAutomatic Moduleï¼‰ã€‚å°½ç®¡ä¸åŒ…å«module-info.classï¼Œä½†è‡ªåŠ¨æ¨¡å—å°†é»˜è®¤ä¾èµ–äºæ•´ä¸ªæ¨¡å—è·¯å¾„ä¸­çš„æ‰€æœ‰æ¨¡å—ï¼Œå› æ­¤å¯ä»¥è®¿é—®åˆ°æ‰€æœ‰æ¨¡å—å¯¼å‡ºçš„åŒ…ï¼Œè‡ªåŠ¨æ¨¡å—ä¹Ÿé»˜è®¤å¯¼å‡ºè‡ªå·±æ‰€æœ‰çš„åŒ…ã€‚</p></blockquote><p>è¿™3æ¡è§„åˆ™ä¿è¯äº†å³ä½¿Javaåº”ç”¨ä¾ç„¶ä½¿ç”¨ä¼ ç»Ÿçš„ç±»è·¯å¾„ï¼Œå‡çº§åˆ°JDK 9å¯¹åº”ç”¨æ¥è¯´å‡ ä¹ä¸ä¼šæœ‰ä»»ä½•æ„Ÿè§‰ï¼Œé¡¹ç›®ä¹Ÿä¸éœ€è¦ä¸“é—¨ä¸ºäº†å‡çº§JDKç‰ˆæœ¬è€Œå»æŠŠä¼ ç»ŸJARåŒ…å‡çº§æˆæ¨¡å—ã€‚</p><p>ï¼ˆäºŒï¼‰æ¨¡å—ç›´æ¥çš„å…¼å®¹</p><p>æ¨¡å—é—´çš„ç®¡ç†å’Œå…¼å®¹æ€§é—®é¢˜ï¼š</p><p>å½“åŒä¸€ä¸ªæ¨¡å—å‘è¡Œäº†å¤šä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼Œé‚£åªèƒ½ç”±å¼€å‘è€…åœ¨ç¼–è¯‘æ‰“åŒ…æ—¶äººå·¥é€‰æ‹©å¥½æ­£ç¡®ç‰ˆæœ¬çš„æ¨¡å—æ¥ä¿è¯ä¾èµ–çš„æ­£ç¡®æ€§ã€‚</p><p>æš‚ä¸æ”¯æŒåœ¨æ¨¡å—å®šä¹‰ä¸­åŠ å…¥ç‰ˆæœ¬å·æ¥ç®¡ç†å’Œçº¦æŸä¾èµ–ï¼Œæœ¬èº«ä¹Ÿä¸æ”¯æŒå¤šç‰ˆæœ¬å·çš„æ¦‚å¿µå’Œç‰ˆæœ¬é€‰æ‹©åŠŸèƒ½ã€‚</p><p>ä½†æ˜¯æŸ¥çœ‹æ¨¡å—åˆ—è¡¨ï¼ˆ<code>java--list-modules</code>ï¼‰æ—¶å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯ã€‚</p><p>ç¼–è¯‘æ—¶ä½¿ç”¨â€œjavacâ€“module-versionâ€å¯ä»¥ç”¨æ¥æŒ‡å®šæ¨¡å—ç‰ˆæœ¬ã€‚</p><p><code>java.lang.module.ModuleDescriptor.Version</code>æ¥å£å¯ä»¥åœ¨è¿è¡Œæ—¶è·å–åˆ°æ¨¡å—çš„ç‰ˆæœ¬å·ã€‚</p><h3 id="3ã€æ¨¡å—åŒ–ä¸‹çš„ç±»åŠ è½½å™¨"><a href="#3ã€æ¨¡å—åŒ–ä¸‹çš„ç±»åŠ è½½å™¨" class="headerlink" title="3ã€æ¨¡å—åŒ–ä¸‹çš„ç±»åŠ è½½å™¨"></a>3ã€æ¨¡å—åŒ–ä¸‹çš„ç±»åŠ è½½å™¨</h3><p>ä¸ºäº†ä¿è¯å…¼å®¹æ€§ï¼ŒJDK 9ç±»åŠ è½½ä¾æ—§ä½¿ç”¨ä¸‰å±‚ç±»åŠ è½½å™¨æ¶æ„ä»¥åŠåŒäº²å§”æ´¾æ¨¡å‹ã€‚</p><p>ï¼ˆä¸€ï¼‰æ¨¡å—ç±»åŠ è½½å™¨å˜åŠ¨</p><p>ä½†æ¨¡å—åŒ–ä¸‹çš„ç±»åŠ è½½å™¨æœ‰å˜åŒ–ï¼š</p><p>ï¼ˆ1ï¼‰æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension Class Loaderï¼‰è¢«å¹³å°ç±»åŠ è½½å™¨ï¼ˆPlatform ClassLoaderï¼‰å–ä»£ã€‚</p><p>å–æ¶ˆ <code>&lt;JAVA_HOME&gt;\lib\ext</code>ç›®å½•ã€<code>&lt;JAVA_HOME&gt;\jre</code>ç›®å½•ï¼Œå¯ä»¥å€ŸåŠ©æ¨¡å—ä»¥ç»„åˆæ„å»ºå‡ºç¨‹åºè¿è¡Œæ‰€éœ€çš„JRE,å¦‚åªä½¿ç”¨java.baseæ¨¡å—ä¸­çš„ç±»å‹ï¼Œå¯ä»¥æ„å»ºéœ€è¦çš„åŒ…ï¼š</p><pre class=" language-bash"><code class="language-bash">jlink -p <span class="token variable">$JAVA_HOME</span>/jmods --add-modules java.base --output jre</code></pre><p>ï¼ˆ2ï¼‰å¹³å°ç±»åŠ è½½å™¨å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨éƒ½ä¸å†æ´¾ç”Ÿè‡ªjava.net.URLClassLoaderã€‚</p><p>ç°åœ¨å¯åŠ¨ç±»åŠ è½½å™¨ã€å¹³å°ç±»åŠ è½½å™¨ã€åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å…¨éƒ½ç»§æ‰¿äºjdk.internal.loader.BuiltinClassLoaderï¼Œåœ¨BuiltinClassLoaderä¸­å®ç°äº†æ–°çš„æ¨¡å—åŒ–æ¶æ„ä¸‹ç±»å¦‚ä½•ä»æ¨¡å—ä¸­åŠ è½½çš„é€»è¾‘ï¼Œä»¥åŠæ¨¡å—ä¸­èµ„æºå¯è®¿é—®æ€§çš„å¤„ç†ã€‚</p><blockquote><p>å¦‚æœæœ‰ç¨‹åºç›´æ¥ä¾èµ–äº†è¿™ç§ç»§æ‰¿å…³ç³»ï¼Œæˆ–è€…ä¾èµ–äº†URLClassLoaderç±»çš„ç‰¹å®šæ–¹æ³•ï¼Œé‚£ä»£ç å¾ˆå¯èƒ½ä¼šåœ¨JDK9åŠæ›´é«˜ç‰ˆæœ¬çš„JDKä¸­å´©æºƒã€‚</p></blockquote><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-module/jdk-9-before.jpg" alt="JDK9ä¹‹å‰çš„ç±»åŠ è½½å™¨ç»§æ‰¿ç»“æ„"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-module/jdk-9-after.jpg" alt="JDK9ä¹‹åçš„ç±»åŠ è½½å™¨ç»§æ‰¿ç»“æ„"></p><p>ï¼ˆ3ï¼‰JDK 9ä¸­ç±»åŠ è½½çš„å§”æ´¾å…³ç³»ä¹Ÿå‘ç”Ÿäº†å˜åŠ¨ã€‚</p><p>å½“å¹³å°åŠåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚ï¼Œåœ¨å§”æ´¾ç»™çˆ¶åŠ è½½å™¨åŠ è½½å‰ï¼Œè¦å…ˆåˆ¤æ–­è¯¥ç±»æ˜¯å¦èƒ½å¤Ÿå½’å±åˆ°æŸä¸€ä¸ªç³»ç»Ÿæ¨¡å—ä¸­ï¼Œå¦‚æœå¯ä»¥æ‰¾åˆ°è¿™æ ·çš„å½’å±å…³ç³»ï¼Œå°±è¦ä¼˜å…ˆå§”æ´¾ç»™è´Ÿè´£é‚£ä¸ªæ¨¡å—çš„åŠ è½½å™¨å®ŒæˆåŠ è½½ï¼Œä¹Ÿè®¸è¿™å¯ä»¥ç®—æ˜¯å¯¹åŒäº²å§”æ´¾çš„ç¬¬å››æ¬¡ç ´åã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-module/jdk-9-classLoad.jpg" alt="JDK9åçš„ç±»åŠ è½½å™¨å§”æ´¾å…³ç³»"></p><p>ï¼ˆäºŒï¼‰ç±»åŠ è½½å™¨è´Ÿè´£æ¨¡å—</p><p>ä¸‰ä¸ªç±»åŠ è½½å™¨è´Ÿè´£å„è‡ªåŠ è½½çš„æ¨¡å—:</p><p>ï¼ˆaï¼‰å¯åŠ¨ç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½çš„æ¨¡å—ï¼š</p><pre class=" language-txt"><code class="language-txt">java.base                        java.security.sasljava.datatransfer                java.xmljava.desktop                     jdk.httpserverjava.instrument                  jdk.internal.vm.cijava.logging                     jdk.managementjava.management                  jdk.management.agentjava.management.rmi              jdk.naming.rmijava.naming                      jdk.netjava.prefs                       jdk.sctpjava.rmi                         jdk.unsupported</code></pre><p>ï¼ˆbï¼‰å¹³å°ç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½çš„æ¨¡å—ï¼š</p><pre class=" language-txt"><code class="language-txt">java.activation*                jdk.accessibilityjava.compiler*                  jdk.charsetsjava.corba*                     jdk.crypto.cryptokijava.scripting                  jdk.crypto.ecjava.se                         jdk.dynalinkjava.se.ee                      jdk.incubator.httpclientjava.security.jgss              jdk.internal.vm.compiler*java.smartcardio                jdk.jsobjectjava.sql                        jdk.localedatajava.sql.rowset                 jdk.naming.dnsjava.transaction*               jdk.scripting.nashornjava.xml.bind*                  jdk.security.authjava.xml.crypto                 jdk.security.jgssjava.xml.ws*                    jdk.xml.domjava.xml.ws.annotation*         jdk.zipfs</code></pre><p>ï¼ˆcï¼‰åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½çš„æ¨¡å—ï¼š</p><pre class=" language-txt"><code class="language-txt">jdk.aot                         jdk.jdepsjdk.attach                      jdk.jdijdk.compiler                    jdk.jdwp.agentjdk.editpad                     jdk.jlinkjdk.hotspot.agent               jdk.jshelljdk.internal.ed                 jdk.jstatdjdk.internal.jvmstat            jdk.packjdk.internal.le                 jdk.policytooljdk.internal.opt                jdk.rmicjdk.jartool                     jdk.scripting.nashorn.shelljdk.javadoc                     jdk.xml.bind*jdk.jcmd                        jdk.xml.ws*jdk.jconsole</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> æ¨¡å—åŒ–ç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DB2å¸¸ç”¨å‘½ä»¤</title>
      <link href="/posts/7f06fe17.html"/>
      <url>/posts/7f06fe17.html</url>
      
        <content type="html"><![CDATA[<h2 id="DB2-å¸¸ç”¨å‘½ä»¤"><a href="#DB2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="DB2 å¸¸ç”¨å‘½ä»¤"></a>DB2 å¸¸ç”¨å‘½ä»¤</h2><h3 id="1ã€å¯åœå‘½ä»¤"><a href="#1ã€å¯åœå‘½ä»¤" class="headerlink" title="1ã€å¯åœå‘½ä»¤"></a>1ã€å¯åœå‘½ä»¤</h3><p>å…ˆåˆ‡æ¢ç”¨æˆ·</p><pre class=" language-bash"><code class="language-bash"><span class="token function">su</span> - db2inst1  //åˆ‡æ¢ç”¨æˆ·</code></pre><p>å†æ“ä½œå¯åœè¿æ¥</p><pre class=" language-bash"><code class="language-bash">db2start  //å¯åŠ¨æ•°æ®åº“db2stop   //åœæ­¢æ•°æ®åº“db2stop force   //å¼ºåˆ¶åœæ­¢æ•°æ®åº“</code></pre><p>è¿æ¥ç›¸å…³æ“ä½œ</p><pre class=" language-bash"><code class="language-bash">db2 connect to  <span class="token operator">&lt;</span>databaseName <span class="token operator">></span>  //è¡¨ç¤ºé»˜è®¤ä½¿ç”¨db2inst1è¿æ¥db2çš„<span class="token operator">&lt;</span>dbName<span class="token operator">></span>db2 disconnect  <span class="token operator">&lt;</span>databaseName <span class="token operator">></span>  //æ–­å¼€ä¸<span class="token operator">&lt;</span>dbName<span class="token operator">></span>çš„è¿æ¥db2 connect to <span class="token operator">&lt;</span>databaseName<span class="token operator">></span> user <span class="token operator">&lt;</span>userName<span class="token operator">></span> using <span class="token operator">&lt;</span>password<span class="token operator">></span> //ä½¿ç”¨æœ¬åœ°åˆ«åè¿æ¥è¿œç«¯æ•°æ®åº“</code></pre><h3 id="2ã€Schema-å‘½ä»¤"><a href="#2ã€Schema-å‘½ä»¤" class="headerlink" title="2ã€Schema å‘½ä»¤"></a>2ã€Schema å‘½ä»¤</h3><p>DB2ä¸­çš„schemaå¹¶ä¸ç›´æ¥å’Œä¸€ä¸ªæ•°æ®åº“ç”¨æˆ·ç»‘å®šï¼Œè™½ç„¶ä»–ä»¬ä¼šæœ‰é»˜è®¤çš„ç»‘å®šå…³ç³»ï¼Œä½†æ˜¯DB2å¯ä»¥ç‹¬ç«‹åˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨ç”¨æˆ·å…³è”çš„schemaæ¥è¿›è¡Œä½¿ç”¨ã€‚</p><p>æŸ¥çœ‹å½“å‰çš„ <code>schema</code> :</p><pre class=" language-bash"><code class="language-bash">db2 <span class="token string">"values current schema"</span> </code></pre><p>æŸ¥çœ‹å½“å‰å­˜åœ¨çš„schema </p><pre class=" language-bash"><code class="language-bash">db2 <span class="token string">"select SCHEMANAME from syscat.SCHEMATA"</span> </code></pre><p>åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„<code>schema</code></p><pre class=" language-bash"><code class="language-bash">db2 <span class="token string">"create schema test"</span> </code></pre><p>åˆ‡æ¢ <code>shame</code> :</p><pre class=" language-bash"><code class="language-bash">db2 <span class="token string">"set current schema='TEST'"</span> db2 <span class="token string">"values current schema"</span> </code></pre><p>è¦ä½¿ç”¨å‘½ä»¤è¡Œæ¥åˆ é™¤æ¨¡å¼ï¼Œè¯·è¾“å…¥ï¼š</p><pre class=" language-bash"><code class="language-bash">DROP SCHEMA <span class="token operator">&lt;</span>name<span class="token operator">></span> RESTRICT</code></pre><p>å…¶å®å¤§éƒ¨é—¨æƒ…å†µéƒ½ä¸å¿…ç‰¹æ„æ‰§è¡Œå‘½ä»¤åˆ›å»º <code>schema</code> çš„ï¼Œåªè¦åœ¨å»ºè¡¨çš„æ—¶å€™å¸¦ä¸Š<code>SCHEMA</code>å‰ç¼€ï¼Œç³»ç»Ÿä¸­å¦‚æœä¸å­˜åœ¨å°±ä¼šè‡ªåŠ¨åˆ›å»º<code>schema</code>çš„ã€‚ä¸‹é¢ä¼šæœ‰å»ºè¡¨ç¤ºä¾‹ã€‚</p><h3 id="2ã€å»ºåº“å‘½ä»¤"><a href="#2ã€å»ºåº“å‘½ä»¤" class="headerlink" title="2ã€å»ºåº“å‘½ä»¤"></a>2ã€å»ºåº“å‘½ä»¤</h3><pre class=" language-bash"><code class="language-bash">db2 create db <span class="token operator">&lt;</span>databaseName <span class="token operator">></span>     //åˆ›å»ºæ•°æ®åº“db2 create db <span class="token operator">&lt;</span>databaseName<span class="token operator">></span> using codeset utf-8 territory CN  //åˆ›å»ºæ•°æ®åº“ä½¿ç”¨utf-8ç¼–ç db2 drop db <span class="token operator">&lt;</span>databaseName <span class="token operator">></span>  //åˆ›å»ºæ•°æ®åº“ä½¿ç”¨utf-8ç¼–ç </code></pre><h3 id="3ã€æŸ¥çœ‹ä¿¡æ¯"><a href="#3ã€æŸ¥çœ‹ä¿¡æ¯" class="headerlink" title="3ã€æŸ¥çœ‹ä¿¡æ¯"></a>3ã€æŸ¥çœ‹ä¿¡æ¯</h3><pre class=" language-bash"><code class="language-bash">db2 get db cfg  <span class="token comment" spellcheck="true">## æŸ¥çœ‹æ•°æ®åº“é…ç½®</span>db2 get db cfg <span class="token keyword">for</span> DBCM  <span class="token comment" spellcheck="true">## æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“çš„é…ç½®</span>db2 list db directory   <span class="token comment" spellcheck="true">## åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“</span>db2 list active databases <span class="token comment" spellcheck="true">## åˆ—å‡ºæ‰€æœ‰æ´»åŠ¨çš„æ•°æ®åº“</span>db2 list tables <span class="token keyword">for</span> all <span class="token comment" spellcheck="true">## åˆ—å‡ºå½“å‰æ•°æ®åº“ä¸‹æ‰€æœ‰çš„è¡¨</span>db2 list tables <span class="token keyword">for</span> schema dbcm <span class="token comment" spellcheck="true">## åˆ—å‡ºå½“å‰æ•°æ®åº“ä¸­schemaä¸ºdbcmçš„è¡¨</span>db2 list tablespaces show detail <span class="token comment" spellcheck="true">## æ˜¾ç¤ºæ•°æ®åº“ç©ºé—´ä½¿ç”¨æƒ…å†µ</span>db2 list tablespaces  <span class="token comment" spellcheck="true">## åˆ—å‡ºè¡¨ç©ºé—´</span>db2 list tables    <span class="token comment" spellcheck="true">## æŸ¥çœ‹æ•°æ®åº“ä¸­æ‰€æœ‰è¡¨ç»“æ„</span>db2 list tables <span class="token keyword">for</span> system   <span class="token comment" spellcheck="true">## åˆ—å‡ºæ‰€æœ‰ç³»ç»Ÿè¡¨</span>db2 describe table <span class="token operator">&lt;</span>tableName<span class="token operator">></span>  <span class="token comment" spellcheck="true">## æŸ¥çœ‹è¡¨ç»“æ„</span></code></pre><h3 id="4ã€æŸ¥è¯¢æ“ä½œ"><a href="#4ã€æŸ¥è¯¢æ“ä½œ" class="headerlink" title="4ã€æŸ¥è¯¢æ“ä½œ"></a>4ã€æŸ¥è¯¢æ“ä½œ</h3><p><code>DB2</code>å‘½ä»¤æŸ¥è¯¢ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token number">db2</span> <span class="token string">"select ... "</span>db2level</code></pre><p><code>SQL</code>ç³»ç»Ÿä¿¡æ¯æŸ¥è¯¢ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--æŸ¥æ‰¾æ‰€æœ‰è¡¨ çš„ä¸­æ–‡åé‡ŒåŒ…å«'%æ—¥å¿—%'çš„è¡¨ï¼Œå‰æå»ºè¡¨æ—¶æœ‰ä¸­æ–‡æ³¨é‡Š</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> SYSCAT<span class="token punctuation">.</span><span class="token keyword">TABLES</span> <span class="token keyword">where</span> REMARKS <span class="token operator">like</span> <span class="token string">'%æ—¥å¿—%'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">--æŸ¥è¯¢ç°æœ‰çš„Schema</span><span class="token keyword">select</span> SCHEMANAME<span class="token punctuation">,</span>owner<span class="token punctuation">,</span>CREATE_TIME <span class="token keyword">from</span> syscat<span class="token punctuation">.</span>schemata<span class="token variable">@desc</span> LOGINFO  <span class="token comment" spellcheck="true">--æŸ¥è¯¢LOGINFOè¡¨çš„è¡¨ç»“æ„ï¼ŒDBVisualizer ä¸­å¯ä»¥ç•Œé¢æ“ä½œã€‚</span><span class="token comment" spellcheck="true">--æŸ¥è¯¢DB2ç‰ˆæœ¬</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sysibm<span class="token punctuation">.</span>sysvERSIONS </code></pre><p>æŸ¥è¯¢å‰100æ¡æ•°æ®ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--æŸ¥æ‰¾å‰100æ¡æ—¥å¿—æ•°æ®</span><span class="token keyword">Select</span> <span class="token operator">*</span> <span class="token keyword">from</span> DBCM<span class="token punctuation">.</span>LOGINFO  <span class="token keyword">fetch</span> <span class="token keyword">first</span> <span class="token number">100</span> <span class="token keyword">rows</span> only<span class="token punctuation">;</span></code></pre><p>åˆ†é¡µæŸ¥è¯¢ï¼š</p><pre class=" language-sql"><code class="language-sql">rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>ç®€å•æŸ¥è¯¢å®ä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> row_id <span class="token keyword">from</span>  LOGINFO  <span class="token punctuation">)</span> <span class="token keyword">where</span> row_id <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">10</span></code></pre><p>å¤æ‚æŸ¥è¯¢ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨å¯èƒ½è¾ƒå¤šï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>    <span class="token keyword">select</span> tmp_page<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> row_id <span class="token keyword">from</span> <span class="token punctuation">(</span>         <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> LOGINFO <span class="token keyword">where</span> OPTYPE<span class="token operator">=</span><span class="token string">'1'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> id <span class="token keyword">desc</span>     <span class="token punctuation">)</span> <span class="token keyword">as</span> tmp_page<span class="token punctuation">)</span> <span class="token keyword">where</span> row_id <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">10</span></code></pre><h3 id="5ã€å»ºè¡¨æ“ä½œ"><a href="#5ã€å»ºè¡¨æ“ä½œ" class="headerlink" title="5ã€å»ºè¡¨æ“ä½œ"></a>5ã€å»ºè¡¨æ“ä½œ</h3><p>å®é™…é¡¹ç›®ä¸­ï¼Œç›¸å¯¹æ¯”è¾ƒå®Œæ•´çš„å»ºè¡¨çš„æ“ä½œåŒ…æ‹¬å»ºè¡¨ã€å­—æ®µã€æ³¨é‡Šï¼ˆå»ºè®®æœ‰ï¼‰ã€ç´¢å¼•ï¼ˆéå¿…é¡»ï¼‰ï¼Œæœ¬æ¬¡ä¸ºç¤ºä¾‹å®Œæ•´æ€§å»ºä¸€ä¸‹ç´¢å¼•ï¼Œå¦‚ä¸‹ï¼š</p><p>å…¶ä¸­<code>DBCM</code>æ˜¯SCHEMAï¼Œ<code>DBCM_APP</code>æ˜¯å¯¹åº”çš„è¡¨ç©ºé—´ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">(</span>     ID <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> GENERATED <span class="token keyword">BY</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">AS</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">,</span>     <span class="token keyword">ENABLE</span> <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span>     USER_ID CHARACTER<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     COUNT_AMT <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     LOG_MSG <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     OP_DATE <span class="token keyword">DATE</span> <span class="token keyword">default</span> <span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span>     OP_TIME TIME <span class="token keyword">default</span>  <span class="token keyword">CURRENT</span>  TIME<span class="token punctuation">,</span>     OP_TIMESTAMP <span class="token keyword">TIMESTAMP</span> <span class="token keyword">default</span>  <span class="token keyword">CURRENT</span>  <span class="token keyword">timestamp</span><span class="token punctuation">,</span>     OP_TYPE CHAR<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>ID<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">in</span> DBCM_APP <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--è¡¨ä¸å­—æ®µç›¸å…³æ³¨é‡Š</span><span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO <span class="token operator">IS</span> <span class="token string">"æ“ä½œæ—¥å¿—è¡¨"</span><span class="token punctuation">;</span><span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">.</span><span class="token keyword">ENABLE</span> <span class="token operator">IS</span> <span class="token string">"æŸ¥è¯¢é™åˆ¶ï¼ˆ1-å¯æŸ¥ï¼Œ0-ç¦æŸ¥ï¼‰"</span><span class="token punctuation">;</span><span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">.</span>USER_ID <span class="token operator">IS</span> <span class="token string">"ç”¨æˆ·ID"</span><span class="token punctuation">;</span><span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">.</span>COUNT_AMT <span class="token operator">IS</span> <span class="token string">"æ“ä½œé‡‘é¢"</span><span class="token punctuation">;</span><span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">.</span>LOG_MSG <span class="token operator">IS</span> <span class="token string">"æ“ä½œä¿¡æ¯"</span><span class="token punctuation">;</span><span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">.</span>OP_DATE <span class="token operator">IS</span> <span class="token string">"æ“ä½œæ—¥æœŸ"</span><span class="token punctuation">;</span><span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">.</span>OP_TIME <span class="token operator">IS</span> <span class="token string">"æ“ä½œæ—¶é—´"</span><span class="token punctuation">;</span><span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">.</span>OP_TIMESTAMP <span class="token operator">IS</span> <span class="token string">"æ“ä½œæ—¶é—´æˆ³"</span><span class="token punctuation">;</span><span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">.</span>OP_TYPE <span class="token operator">IS</span> <span class="token string">"æ“ä½œæ—¶ç±»å‹"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">--åˆ›å»ºè¡¨ç´¢å¼•</span><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx1_dbcm_user_id <span class="token keyword">ON</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">(</span>USER_ID<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx1_dbcm_opdate <span class="token keyword">ON</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">(</span>OP_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¦‚æœæ•°æ®åº“ä¸­ä¸å­˜åœ¨åä¸º<code>DBCM</code>çš„SCHEMAï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</p><p>å¯¹åº”çš„ï¼Œå¦‚æœè¦åˆ é™¤ç´¢å¼•</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> idx1_dbcm_opdate <span class="token keyword">ON</span> DBCM<span class="token punctuation">.</span>LOGINFO<span class="token punctuation">(</span>OP_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="6ã€æ”¹è¡¨æ“ä½œ"><a href="#6ã€æ”¹è¡¨æ“ä½œ" class="headerlink" title="6ã€æ”¹è¡¨æ“ä½œ"></a>6ã€æ”¹è¡¨æ“ä½œ</h3><p>æ”¹è¡¨æ“ä½œåœ¨å®é™…ä¸­ä¹Ÿä¼šé‡åˆ°ï¼Œä¸šåŠ¡å˜æ›´å¯¼è‡´å­—æ®µå˜åŒ–ã€‚</p><h4 id="å¢åŠ åˆ—-ï¼š"><a href="#å¢åŠ åˆ—-ï¼š" class="headerlink" title="å¢åŠ åˆ— ï¼š"></a>å¢åŠ åˆ— ï¼š</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span><span class="token keyword">schema</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token operator">&lt;</span>tableName<span class="token operator">></span> <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> <span class="token operator">&lt;</span>columnName<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token keyword">type</span><span class="token operator">></span></code></pre><p>å¦‚ç»™åˆšæ‰çš„<code>LOGINFO</code>è¡¨è¿½åŠ ä¸€ä¸ªå¤‡ç”¨å­—æ®µ<code>MARK_1</code>ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> MARK_1 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ·»åŠ å¸¦é»˜è®¤å€¼çš„å±æ€§ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>table_name<span class="token punctuation">]</span> <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> <span class="token punctuation">[</span>column_name<span class="token punctuation">]</span> <span class="token punctuation">[</span>column_type<span class="token punctuation">]</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">WITH</span> <span class="token keyword">DEFAULT</span> <span class="token punctuation">[</span><span class="token keyword">value</span><span class="token punctuation">]</span></code></pre><p>å¦‚æ–°å¢å¸¦é»˜è®¤å€¼çš„æ—¶é—´æˆ³åˆ—:</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO  <span class="token keyword">ALTER</span> <span class="token keyword">column</span> test_timestamp  <span class="token keyword">SET</span> <span class="token keyword">DEFAULT</span>  <span class="token keyword">current</span> <span class="token keyword">timestamp</span><span class="token punctuation">;</span></code></pre><h4 id="ä¿®æ”¹åˆ—-ï¼š"><a href="#ä¿®æ”¹åˆ—-ï¼š" class="headerlink" title="ä¿®æ”¹åˆ— ï¼š"></a>ä¿®æ”¹åˆ— ï¼š</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span><span class="token keyword">schema</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token operator">&lt;</span>table_name<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span> <span class="token operator">&lt;</span>columnName<span class="token operator">></span> <span class="token keyword">SET</span> <span class="token keyword">DATA</span> <span class="token keyword">TYPE</span> <span class="token operator">&lt;</span>columnType<span class="token operator">></span></code></pre><p>å¦‚ç»™åˆšæ‰çš„<code>LOGINFO</code>è¡¨ä¿®æ”¹<code>OP_TYPE</code>å­—æ®µï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO  <span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span> OP_TYPE <span class="token keyword">SET</span> <span class="token keyword">DATA</span> <span class="token keyword">TYPE</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></code></pre><p>å¦‚ä¿®æ”¹<code>OP_TYPE</code>å­—æ®µï¼Œåˆ é™¤éç©ºå±æ€§ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO  <span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span> OP_TYPE <span class="token keyword">DROP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></code></pre><p>ä¿®æ”¹åˆ—é»˜è®¤å€¼ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span>  <span class="token operator">&lt;</span><span class="token keyword">schema</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token operator">&lt;</span>table_name<span class="token operator">></span>  <span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span> <span class="token punctuation">[</span>column_name<span class="token punctuation">]</span> <span class="token keyword">SET</span> <span class="token keyword">default</span> <span class="token punctuation">[</span><span class="token keyword">value</span><span class="token punctuation">]</span></code></pre><h4 id="é‡å‘½ååˆ—ï¼š"><a href="#é‡å‘½ååˆ—ï¼š" class="headerlink" title="é‡å‘½ååˆ—ï¼š"></a>é‡å‘½ååˆ—ï¼š</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>table_name<span class="token punctuation">]</span>  <span class="token keyword">RENAME</span> <span class="token keyword">COLUMN</span> <span class="token punctuation">[</span>column_name<span class="token punctuation">]</span>  <span class="token keyword">TO</span> <span class="token punctuation">[</span>new_column_name<span class="token punctuation">]</span>  <span class="token punctuation">;</span></code></pre><p>å¦‚é‡å‘½å<code>OP_TYPE</code>å­—æ®µï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> DBCM<span class="token punctuation">.</span>LOGINFO  <span class="token keyword">RENAME</span> <span class="token keyword">COLUMN</span> OP_TYPE <span class="token keyword">TO</span> NEW_OP_TYPE<span class="token punctuation">;</span></code></pre><h4 id="åˆ é™¤åˆ—ï¼š"><a href="#åˆ é™¤åˆ—ï¼š" class="headerlink" title="åˆ é™¤åˆ—ï¼š"></a>åˆ é™¤åˆ—ï¼š</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span>  <span class="token operator">&lt;</span><span class="token keyword">schema</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token operator">&lt;</span>tableName<span class="token operator">></span>  <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span>  <span class="token operator">&lt;</span>columnName<span class="token operator">></span>  </code></pre><p>å¦‚ç»™åˆšæ‰çš„<code>LOGINFO</code>è¡¨åˆ é™¤å¤‡ç”¨å­—æ®µ<code>MARK_1</code>ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span>  DBCM<span class="token punctuation">.</span>LOGINFO   <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span>  MARK_1 <span class="token punctuation">;</span></code></pre><p>ä½ ä»¥ä¸ºè¿™æ ·å°±å®Œç¾äº†å—ï¼Ÿä¸ï¼Œè¿˜è¦è¿›è¡Œé‡æ„è¡¨ã€‚</p><h4 id="é‡æ„è¡¨ï¼š"><a href="#é‡æ„è¡¨ï¼š" class="headerlink" title="é‡æ„è¡¨ï¼š"></a>é‡æ„è¡¨ï¼š</h4><p>é‡æ„è¡¨æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>SQL</code>æ“ä½œï¼š</p><p>ï¼ˆ1ï¼‰å‘½ä»¤æ“ä½œæ¨¡å¼ï¼š</p><pre class=" language-BASH"><code class="language-BASH">REORG TABLE  <schema>.<tableName> </code></pre><p>ä»¥ä¸Šé¢çš„<code>LOGINFO</code>è¡¨ä¸ºä¾‹ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p><pre class=" language-bash"><code class="language-bash">REORG TABLE DBCM.LOGINFO <span class="token punctuation">;</span></code></pre><p>ï¼ˆ2ï¼‰<code>SQL</code>æ“ä½œæ¨¡å¼ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">CALL</span> SYSPROC<span class="token punctuation">.</span>admin_cmd<span class="token punctuation">(</span><span class="token string">'reorg table  &lt;schema>.&lt;tableName>  '</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä»¥ä¸Šé¢çš„<code>LOGINFO</code>è¡¨ä¸ºä¾‹ï¼Œæ‰§è¡Œ<code>SQL</code>ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">CALL</span> SYSPROC<span class="token punctuation">.</span>admin_cmd<span class="token punctuation">(</span><span class="token string">'reorg table DB2INST1.DATA_BASE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="REORGæ‰©å±•ï¼š"><a href="#REORGæ‰©å±•ï¼š" class="headerlink" title="REORGæ‰©å±•ï¼š"></a><code>REORG</code>æ‰©å±•ï¼š</h4><p>ä»€ä¹ˆæ˜¯<code>REORG</code>?</p><p>å¯¹è¡¨æ•°æ®è¿›è¡Œå¢åˆ æ”¹ç­‰æ“ä½œï¼Œç»è¿‡ä¸€ç³»åˆ—æ›´æ”¹åï¼Œé€»è¾‘ä¸Šè¿ç»­çš„æ•°æ®å¯èƒ½ä¼šä½äºä¸è¿ç»­çš„ç‰©ç†æ•°æ®é¡µä¸Šï¼Œåœ¨è®¸å¤šæ’å…¥æ“ä½œåˆ›å»ºäº†æº¢å‡ºè®°å½•æ—¶å°¤å…¶å¦‚æ­¤ã€‚æŒ‰è¿™ç§æ–¹å¼ç»„ç»‡æ•°æ®æ—¶ï¼Œæ•°æ®åº“ç®¡ç†å™¨å¿…é¡»æ‰§è¡Œå…¶ä»–è¯»æ“ä½œæ‰èƒ½è®¿é—®é¡ºåºæ•°æ®ã€‚è€Œåœ¨åˆ é™¤å¤§é‡è¡Œåï¼Œä¹Ÿéœ€è¦æ‰§è¡Œå…¶ä»–çš„è¯»æ“ä½œã€‚</p><p><code>REORG</code>ï¼ˆé‡ç»„/é‡æ„ï¼‰è¡¨çš„æ“ä½œä¼šæ•´ç†æ•°æ®ç¢ç‰‡æ¥å‡å°‘æµªè´¹çš„ç©ºé—´ï¼Œå¹¶å¯¹è¡Œè¿›è¡Œé‡æ–°æ’åºä»¥åˆå¹¶æº¢å‡ºè®°å½•ï¼Œä»è€ŒåŠ å¿«æ•°æ®è®¿é—®é€Ÿåº¦å¹¶æœ€ç»ˆæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p><p>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ<code>REORG</code> ?</p><p>ï¼ˆaï¼‰å¢åŠ åˆ—ï¼Œæ‰©é•¿åº¦ï¼Œä¿®æ”¹åˆ—ç±»å‹ç­‰ã€‚</p><p>ï¼ˆbï¼‰è¡¨ä¸­çš„è®°å½•å˜åŒ–é‡å¾ˆå¤§æ—¶ï¼Œåˆ™éœ€è¦åœ¨è¡¨ä¸Šåš<code>REORG</code>æ“ä½œæ¥ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½ã€‚</p><p>ï¼ˆcï¼‰å¯¹æ•°æ®åº“å¯¹è±¡çš„å¤§é‡æ“ä½œï¼Œå¦‚åå¤åœ°åˆ é™¤è¡¨ï¼Œåˆ é™¤ç´¢å¼•ï¼Œå­˜å‚¨è¿‡ç¨‹ï¼Œä¼šå¼•èµ·ç³»ç»Ÿè¡¨ä¸­æ•°æ®çš„é¢‘ç¹æ”¹å˜ï¼Œå¯¼è‡´è¡¨æˆ–ç´¢å¼•ç¢ç‰‡å¤ªå¤šæ—¶éœ€è¦<code>REORG</code>ã€‚å¯ä»¥ä½¿ç”¨<code>db2</code>å·¥å…·<code>reorgchk</code>æ£€æŸ¥ã€‚</p><br/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> DB2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DB2 </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DB2å¸¸ç”¨å‡½æ•°</title>
      <link href="/posts/d22e90ef.html"/>
      <url>/posts/d22e90ef.html</url>
      
        <content type="html"><![CDATA[<h2 id="DB2å¸¸ç”¨å‡½æ•°"><a href="#DB2å¸¸ç”¨å‡½æ•°" class="headerlink" title="DB2å¸¸ç”¨å‡½æ•°"></a>DB2å¸¸ç”¨å‡½æ•°</h2><h3 id="ä¸€ã€å¯„å­˜å™¨ä½¿ç”¨"><a href="#ä¸€ã€å¯„å­˜å™¨ä½¿ç”¨" class="headerlink" title="ä¸€ã€å¯„å­˜å™¨ä½¿ç”¨"></a>ä¸€ã€å¯„å­˜å™¨ä½¿ç”¨</h3><p>ä½¿ç”¨æ–¹å¼ï¼š<code>SYSIBM.SYSDUMMY1</code>ã€<code>SYSIBM.DUAL</code>ã€<code>values</code></p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token string">'hello db2'</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>SYSDUMMY1<span class="token punctuation">;</span> <span class="token keyword">SELECT</span> <span class="token string">'hello db2'</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token keyword">VALUES</span> <span class="token string">'hello db2'</span><span class="token punctuation">;</span> </code></pre><h3 id="äºŒã€æ—¶é—´å¤„ç†ç›¸å…³"><a href="#äºŒã€æ—¶é—´å¤„ç†ç›¸å…³" class="headerlink" title="äºŒã€æ—¶é—´å¤„ç†ç›¸å…³"></a>äºŒã€æ—¶é—´å¤„ç†ç›¸å…³</h3><h4 id="1ã€æ—¥æœŸä¸æ—¶é—´"><a href="#1ã€æ—¥æœŸä¸æ—¶é—´" class="headerlink" title="1ã€æ—¥æœŸä¸æ—¶é—´"></a>1ã€æ—¥æœŸä¸æ—¶é—´</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ä½¿ç”¨å¯„å­˜å™¨æ–¹å¼</span><span class="token keyword">VALUES</span> <span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span> <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">--æŸ¥æ—¥æœŸ</span><span class="token keyword">VALUES</span> <span class="token keyword">CURRENT</span> TIME <span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">--æŸ¥æ—¶é—´</span><span class="token keyword">VALUES</span> <span class="token keyword">CURRENT</span> <span class="token keyword">TIMESTAMP</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--æŸ¥æ—¶é—´æˆ³</span></code></pre><h4 id="2ã€å¹´æœˆæ—¥æ—¶åˆ†ç§’"><a href="#2ã€å¹´æœˆæ—¥æ—¶åˆ†ç§’" class="headerlink" title="2ã€å¹´æœˆæ—¥æ—¶åˆ†ç§’"></a>2ã€å¹´æœˆæ—¥æ—¶åˆ†ç§’</h4><p>å¹´æœˆæ—¥æ—¶åˆ†ç§’ç›¸å…³å‡½æ•°</p><pre class=" language-sql"><code class="language-sql">YEAR<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">--è·å–å¹´ï¼›</span>MONTH<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">--è·å–æœˆï¼›</span>DAY<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">--è·å–æ—¥ï¼›</span>HOUR<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">--è·å–å°æ—¶ï¼›</span>MINUTE<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">--è·å–åˆ†é’Ÿï¼›</span>SECOND<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">--è·å–ç§’ï¼›</span><span class="token keyword">DATE</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">--è·å–æ—¥æœŸï¼›</span>TIME<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">--è·å–æ—¶é—´ï¼›</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">--è·å–æ—¶é—´æˆ³ã€‚</span></code></pre><p>ç¤ºä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"> <span class="token comment" spellcheck="true">--ä½¿ç”¨å¯„å­˜å™¨æ–¹å¼è·å–å½“å‰å¹´ä»½</span><span class="token keyword">SELECT</span> YEAR<span class="token punctuation">(</span><span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span><span class="token comment" spellcheck="true">--valuesæ–¹å¼è·å–å½“å‰æœˆä»½</span><span class="token keyword">VALUES</span> MONTHï¼ˆ<span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> </code></pre><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--è¡¨ç¤ºæŸ¥å½“å‰æœˆä»½çš„æ—¥å¿—è®°å½•</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> DBCM<span class="token punctuation">.</span>LOGINFO L <span class="token keyword">WHERE</span> MONTH<span class="token punctuation">(</span>L<span class="token punctuation">.</span>OP_TIME<span class="token punctuation">)</span><span class="token operator">=</span> MONTH<span class="token punctuation">(</span><span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span> <span class="token operator">and</span> MONTH<span class="token punctuation">(</span>L<span class="token punctuation">.</span>OP_TIME<span class="token punctuation">)</span> <span class="token operator">=</span> MONTH<span class="token punctuation">(</span><span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span></code></pre><p>å‚æ•°ä¹Ÿå¯ä»¥æ˜¯æŒ‡å®šå­—ç¬¦ä¸²</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> YEAR<span class="token punctuation">(</span><span class="token string">'2020-06-01'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span><span class="token keyword">VALUES</span> HOURï¼ˆ<span class="token string">'2020-06-01 20:20:06'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> </code></pre><h4 id="3ã€å¹´æœˆæ—¥æ—¶åˆ†ç§’åŠ å‡è¿è¡Œ"><a href="#3ã€å¹´æœˆæ—¥æ—¶åˆ†ç§’åŠ å‡è¿è¡Œ" class="headerlink" title="3ã€å¹´æœˆæ—¥æ—¶åˆ†ç§’åŠ å‡è¿è¡Œ"></a>3ã€å¹´æœˆæ—¥æ—¶åˆ†ç§’åŠ å‡è¿è¡Œ</h4><p>è¿˜å¯ä»¥ç›´æ¥è¿è¡Œæ“ä½œï¼šè¦æ±‚åŠ å‡å¸¦å•ä½çš„æ—¶é—´é•¿åº¦ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> <span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token string">'2020-06-01 22:18:12'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span> YEAR <span class="token operator">+</span><span class="token number">1</span> MONTH <span class="token operator">+</span><span class="token number">1</span> DAY <span class="token operator">+</span><span class="token number">1</span> HOUR <span class="token operator">+</span><span class="token number">1</span> MINUTE <span class="token operator">+</span><span class="token number">1</span> SECOND <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š2021-07-02 23:19:13</span><span class="token keyword">VALUES</span> <span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token string">'2020-05-30 21:18:12'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> YEAR <span class="token operator">-</span><span class="token number">1</span> MONTH <span class="token operator">-</span><span class="token number">1</span> DAY <span class="token operator">-</span><span class="token number">1</span> HOUR <span class="token operator">-</span><span class="token number">1</span> MINUTE <span class="token operator">-</span><span class="token number">1</span> SECOND <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š2019-04-29 20:17:11</span><span class="token comment" spellcheck="true">--è¡¨ç¤ºæŸ¥è¯¢å½“å‰æœˆä»½çš„è‹±æ–‡åç§°</span><span class="token keyword">SELECT</span> MONTHNAME<span class="token punctuation">(</span><span class="token keyword">CURRENT</span> <span class="token keyword">date</span><span class="token punctuation">)</span>  <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span></code></pre><p>ä»¥<code>LOGINFO</code>è¡¨ä¸ºä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--æŸ¥è¯¢ä»Šå¹´ä¸Šä¸ªæœˆçš„æ—¥å¿—</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> DBCM<span class="token punctuation">.</span>LOGINFO L <span class="token keyword">WHERE</span> YEAR<span class="token punctuation">(</span>L<span class="token punctuation">.</span>OP_TIME<span class="token punctuation">)</span><span class="token operator">=</span> YEAR<span class="token punctuation">(</span><span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span> <span class="token operator">and</span> MONTH<span class="token punctuation">(</span>L<span class="token punctuation">.</span>OP_TIME<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token punctuation">(</span>MONTH<span class="token punctuation">(</span><span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span></code></pre><p>4ã€æ—¥æœŸç›¸å…³ç›¸å…³å‡½æ•°</p><pre class=" language-sql"><code class="language-sql">WEEK<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">--åˆ¤æ–­æ—¶é—´å¹´ä»½åŠå½“å‰è¯¥å¹´ç¬¬å‡ å‘¨</span>MONTHNAME<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">--è·å–æœˆä»½è‹±æ–‡åç§°</span>DAY<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment" spellcheck="true">--åˆ¤æ–­æ—¶é—´æ˜¯è¯¥æœˆçš„ç¬¬å‡ å¤©</span>DAYNAME<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">--åˆ¤æ–­ä¼ å…¥æ—¶é—´æ˜¯å‘¨å‡ çš„è‹±æ–‡åç§°</span>DAYOFYEAR<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">--åˆ¤æ–­ä¼ å…¥æ—¶é—´æ˜¯è¯¥å¹´çš„ç¬¬å‡ å¤©</span>DAYOFMONTH<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">--åˆ¤æ–­ä¼ å…¥æ—¶é—´æ˜¯è¯¥æœˆçš„ç¬¬å‡ å¤©</span>DAYOFWEEK<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">--åˆ¤æ–­ä¼ å…¥æ—¶é—´æ˜¯è¯¥å‘¨çš„ç¬¬å‡ å¤©</span>days<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true">--å¯ä»¥è·å–ä¸¤ä¸ªæ—¶é—´ç›¸å·®å¤©æ•°</span></code></pre><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><p><code>WEEK()</code>:</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> week<span class="token punctuation">(</span><span class="token string">'2020-06-10'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼š24,è¡¨ç¤ºä¼ å…¥æ—¶é—´æ˜¯2020å¹´ç¬¬24å‘¨</span></code></pre><p><code>MONTHNAME()</code>ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> MONTHNAME<span class="token punctuation">(</span><span class="token string">'2020-06-10'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼šJune</span></code></pre><p><code>DAY()</code>:</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> day<span class="token punctuation">(</span><span class="token string">'2020-06-10'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼š10ï¼Œ6æœˆçš„ç¬¬10å¤©</span></code></pre><p><code>DAYNAME()</code>:</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> DAYNAME<span class="token punctuation">(</span><span class="token string">'2020-06-10'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼šWednesday</span></code></pre><p><code>DAYOFYEAR()</code>:</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> DAYOFYEAR<span class="token punctuation">(</span><span class="token string">'2020-06-10'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š162</span></code></pre><p><code>DAYOFMONTH()</code>:</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> DAYOFMONTH<span class="token punctuation">(</span><span class="token string">'2020-06-10'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š10ï¼Œ6æœˆçš„ç¬¬10å¤©</span></code></pre><p><code>DAYOFWEEK()</code>:</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> DAYOFWEEK<span class="token punctuation">(</span><span class="token string">'2020-06-10'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š4, é»˜è®¤ä¸€å‘¨æ—¥ä¸ºç¬¬ä¸€å¤©ï¼Œå‘¨ä¸‰æ˜¯ç¬¬4å¤©</span><span class="token keyword">VALUES</span> DAYOFWEEK<span class="token punctuation">(</span><span class="token string">'2020-06-14'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š1</span></code></pre><p><code>DAYOFWEEK_ISO()</code>:å¯ä»¥å’Œ<code>DAYOFWEEK()</code>æ¯”è¾ƒä¸€ä¸‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> DAYOFWEEK_ISO<span class="token punctuation">(</span><span class="token string">'2020-06-10'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š3</span><span class="token keyword">VALUES</span> DAYOFWEEK_ISO<span class="token punctuation">(</span><span class="token string">'2020-06-14'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š7</span></code></pre><p><code>DAYS()</code>:</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> DAYS<span class="token punctuation">(</span><span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token operator">-</span>DAYS<span class="token punctuation">(</span><span class="token keyword">CURRENT</span> <span class="token keyword">DATE</span><span class="token operator">-</span><span class="token number">10</span> DAY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š10 ï¼Œå¯ä»¥è®¡ç®—æ—¥æœŸå·®å¤šå°‘å¤©</span></code></pre><pre><code>values DAYNAME(current timestamp)</code></pre><p><code>TIMESTAMPDIFF</code>:</p><pre class=" language-sql"><code class="language-sql">TIMESTAMPDIFF<span class="token punctuation">(</span>n<span class="token punctuation">,</span>CHAR<span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token string">'2012-05-25 10:23:24'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token string">'2012-05-25 10:20:24'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>æ ¹æ®ä¸¤ä¸ªæ—¶é—´æˆ³è®°ä¹‹é—´çš„æ—¶å·®ï¼Œè¿”å›ç”±ç¬¬ä¸€ä¸ªå‚æ•°å®šä¹‰çš„ç±»å‹è¡¨ç¤ºçš„ä¼°è®¡æ—¶å·®ã€‚ï¼ˆæ•´é™¤éƒ¨åˆ†ï¼Œä¸ä¼šå››èˆäº”å…¥ï¼‰å…¶ä¸­nçš„å«ä¹‰å¦‚ä¸‹ï¼š</p><p>n=2ï¼šç§’ ï¼›    n=4 ï¼šåˆ†ï¼›     n=8ï¼šæ—¶ï¼›</p><p>n=16 ï¼šå¤©ï¼›    n=32 ï¼šå‘¨ï¼›</p><p>n=64ï¼šæœˆï¼›    n=128 ï¼šå­£åº¦ï¼›     n=256:å¹´ï¼›</p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUES</span> TIMESTAMPDIFF<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> char<span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token string">'2020-06-14 12:12:12'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token string">'2020-06-10 12:12:12'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š4 ï¼Œè¡¨ç¤ºç›¸å·®4å¤©</span></code></pre><h4 id="4ã€æ—¶é—´çš„æ ¼å¼"><a href="#4ã€æ—¶é—´çš„æ ¼å¼" class="headerlink" title="4ã€æ—¶é—´çš„æ ¼å¼"></a>4ã€æ—¶é—´çš„æ ¼å¼</h4><p>ISOï¼Œä½¿ç”¨å›½é™…æ ‡å‡†ç»„ç»‡ï¼ˆISOï¼‰åˆ¶è®¢çš„æ—¥æœŸå’Œæ—¶é—´æ ¼å¼ï¼›USAï¼Œä½¿ç”¨ç¾å›½æ—¥æœŸå’Œæ—¶é—´çš„ IBM æ ‡å‡†æ ¼å¼ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">values</span> char<span class="token punctuation">(</span><span class="token keyword">current</span> <span class="token keyword">date</span><span class="token punctuation">,</span>iso<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--2020-06-10</span><span class="token keyword">values</span> char<span class="token punctuation">(</span><span class="token keyword">current</span> <span class="token keyword">date</span><span class="token punctuation">,</span>usa<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--06/10/2020</span><span class="token keyword">values</span> char<span class="token punctuation">(</span><span class="token keyword">current</span> time<span class="token punctuation">,</span>iso<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--18.08.53</span></code></pre><h3 id="ä¸‰ã€å­—ç¬¦ä¸²å‡½æ•°"><a href="#ä¸‰ã€å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="ä¸‰ã€å­—ç¬¦ä¸²å‡½æ•°"></a>ä¸‰ã€å­—ç¬¦ä¸²å‡½æ•°</h3><h4 id="1ã€æ—¥æœŸæ—¶é—´è½¬æ¢"><a href="#1ã€æ—¥æœŸæ—¶é—´è½¬æ¢" class="headerlink" title="1ã€æ—¥æœŸæ—¶é—´è½¬æ¢"></a>1ã€æ—¥æœŸæ—¶é—´è½¬æ¢</h4><p>ï¼ˆ1ï¼‰<code>TO_CHAR()</code>æŠŠæ—¶é—´è½¬æ¢æˆæŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸²ç±»å‹ã€‚ä½ç‰ˆæœ¬<code>DB2</code>ä¸æ”¯æŒã€‚</p><p><code>â€œYYYY-MM-DD HH:MI:SSâ€</code> åäºŒå°æ—¶åˆ¶ï¼›</p><p><code>â€œYYYY-MM-DD HH24:MI:SSâ€</code>äºŒåå››å°æ—¶åˆ¶ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> TO_CHAR<span class="token punctuation">(</span><span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token string">'2020-06-10 12:18:12'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'YYYY-MM-DD HH24:MI:SS'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š2020-06-10 12:18:12</span></code></pre><p>ï¼ˆ2ï¼‰<code>char(arg)</code>æŠŠå‚æ•°è½¬åŒ–æˆå­—ç¬¦ä¸²</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">values</span> char<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">--æŠŠ100è½¬åŒ–ä¸º100å­—ç¬¦ä¸²å†…å®¹</span></code></pre><h4 id="2ã€LENGTHå‡½æ•°"><a href="#2ã€LENGTHå‡½æ•°" class="headerlink" title="2ã€LENGTHå‡½æ•°"></a>2ã€LENGTHå‡½æ•°</h4><p>è¯­æ³•</p><pre><code>LENGTH(ARG)</code></pre><p>LENGTHå‡½æ•°è¿”å›å‚æ•°<code>ARG</code>çš„é•¿åº¦ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> LENGTH<span class="token punctuation">(</span>LOG_MSG<span class="token punctuation">)</span> <span class="token keyword">FROM</span> DBCM<span class="token punctuation">.</span>LOGINFO</code></pre><h4 id="3ã€CONCATå‡½æ•°"><a href="#3ã€CONCATå‡½æ•°" class="headerlink" title="3ã€CONCATå‡½æ•°"></a>3ã€<code>CONCAT</code>å‡½æ•°</h4><p>å­—ç¬¦ä¸²è¿æ¥å‡½æ•°ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span><span class="token string">' world'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">' !'</span><span class="token punctuation">)</span>  <span class="token keyword">as</span> test<span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼šhello world !</span></code></pre><h4 id="4ã€å»ç©ºæ ¼å‡½æ•°"><a href="#4ã€å»ç©ºæ ¼å‡½æ•°" class="headerlink" title="4ã€å»ç©ºæ ¼å‡½æ•°"></a>4ã€å»ç©ºæ ¼å‡½æ•°</h4><p><code>LTRIM</code>ã€<code>RTRIM</code>å‡½æ•°å»ç©ºæ ¼</p><p><code>DB2</code>ä¸­æ— <code>trim()</code>å‡½æ•°ï¼Œæ‰€ä»¥è¦å»ç©ºæ ¼è¦æ‰§è¡Œå·¦å³å»ç©ºæ ¼ã€‚</p><p><code>LTRIM()</code>ï¼š<code>LTRIM</code>å‡½æ•°ä»<code>CHAR</code>ã€<code>VARCHAR</code>ã€<code>GRAPHIC</code>æˆ–è€…<code>VARGRAPHIC</code>ä¸­å»æ‰å·¦ä¾§ç©ºæ ¼ã€‚<br><code>RTRIM()</code>ï¼š<code>RTRIM</code>å‡½æ•°åˆ™å»å»æ‰å³ä¾§çš„ç©ºæ ¼ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> LTRIM<span class="token punctuation">(</span><span class="token string">'   hello 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>RTRIM<span class="token punctuation">(</span><span class="token string">' 2world !  '</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span></code></pre><h4 id="5ã€æˆªå–-æˆªæ–­å‡½æ•°"><a href="#5ã€æˆªå–-æˆªæ–­å‡½æ•°" class="headerlink" title="5ã€æˆªå–/æˆªæ–­å‡½æ•°"></a>5ã€æˆªå–/æˆªæ–­å‡½æ•°</h4><p>ï¼ˆ1ï¼‰<code>SUBSTR</code>å‡½æ•°</p><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql">SUBSTR<span class="token punctuation">(</span>ARG1<span class="token punctuation">,</span>POS<span class="token punctuation">,</span><span class="token operator">&lt;</span>LENGTH<span class="token operator">></span><span class="token punctuation">)</span></code></pre><p><code>SUBSTR</code>å‡½æ•°è¿”å›<code>ARG1</code>ä¸­<code>POS</code>ä½ç½®å¼€å§‹çš„<code>LENGTH</code>ä¸ªå­—ç¬¦ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š<code>LENGTH</code>ï¼Œåˆ™è¿”å›å‰©ä½™çš„å­—ç¬¦ã€‚</p><p><code>substr()</code>æ˜¯æŒ‡ä»positionå¼€å§‹ç®—ï¼ˆåŒ…æ‹¬positionè¿™ä¸ªå­—ç¬¦ï¼‰ï¼Œæˆªå–çš„é•¿åº¦ï¼Œä¹ŸåŒ…æ‹¬ä½ç½®+é•¿åº¦æ‰€åœ¨çš„å­—ç¬¦(å‰ææ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦å¤§äºæˆ–ç­‰äºä¸¤è€…ä¹‹å’Œ)ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> SUBSTR<span class="token punctuation">(</span><span class="token string">'helloworld'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼šow</span></code></pre><p>ï¼ˆ2ï¼‰<code>LEFT</code>ã€<code>RIGHT</code>å‡½æ•°</p><p><code>LEFT(ARG,LENGTH)</code>ï¼šLEFTå‡½æ•°è¿”å›<code>ARG</code>æœ€å·¦è¾¹<code>LENGTH</code>ä¸ªå­—ç¬¦ä¸²ï¼Œ<code>ARG</code>å¯ä»¥æ˜¯<code>CHAR</code>æˆ–<code>BINARY STRING</code>ã€‚</p><p><code>RIGHT(ARG,LENGTH)</code>ï¼šRIGHTå‡½æ•°è¿”å›<code>ARG</code>æœ€å³è¾¹çš„<code>LENGTH</code>ä¸ªå­—ç¬¦ä¸²</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">LEFT</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">RIGHT</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span><span class="token comment" spellcheck="true">--ç»“æœï¼š he  ld</span></code></pre><h4 id="6ã€å¤§å°å†™è½¬æ¢"><a href="#6ã€å¤§å°å†™è½¬æ¢" class="headerlink" title="6ã€å¤§å°å†™è½¬æ¢"></a>6ã€å¤§å°å†™è½¬æ¢</h4><p><code>LCASE</code>ã€<code>LOWER</code>ã€<code>UCASE</code>ã€<code>UPPER</code>å‡½æ•°</p><p>LCASE()ã€LOWER()ï¼š<br>LCASEã€LOWERå‡½æ•°è¿”å›å®šé•¿ã€å˜é•¿å­—ç¬¦ä¸²çš„å°å†™å½¢å¼ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">LCASE</span><span class="token punctuation">(</span><span class="token string">'heLLo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>LOWER<span class="token punctuation">(</span><span class="token string">'WORLD'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼šhello  world</span></code></pre><p>UCASE()ã€UPPER()ï¼š<br>UCASEã€UPPERå‡½æ•°è¿”å›å®šé•¿ã€å˜é•¿å­—ç¬¦ä¸²çš„å¤§å†™å½¢å¼ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">UCASE</span><span class="token punctuation">(</span><span class="token string">'heLLo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>UPPER<span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼šHELLO  WORLD</span></code></pre><h4 id="7ã€æ›¿æ¢å‡½æ•°"><a href="#7ã€æ›¿æ¢å‡½æ•°" class="headerlink" title="7ã€æ›¿æ¢å‡½æ•°"></a>7ã€æ›¿æ¢å‡½æ•°</h4><p>ï¼ˆaï¼‰INSERTå‡½æ•°</p><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">INSERT</span><span class="token punctuation">(</span>ARG1<span class="token punctuation">,</span>POS<span class="token punctuation">,</span>SIZE<span class="token punctuation">,</span>ARG2<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">--æ‰¾åˆ°ä½ç½®æ›¿æ¢</span></code></pre><p>INSERTå‡½æ•°è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†<code>ARG1</code>ä»<code>POS</code>å¤„åˆ é™¤<code>SIZE</code>ä¸ªå­—ç¬¦ï¼Œå°†<code>ARG2</code>æ’å…¥è¯¥ä½ç½®ã€‚</p><p>ï¼ˆbï¼‰REPLACEå‡½æ•°</p><p>è¯­æ³•ï¼š</p><pre><code>REPLACE(EXP1,EXP2,EXP3)</code></pre><p>REPLACEå‡½æ•°ç”¨<code>EXP3</code>ä»£æ›¿<code>EXP1</code>ä¸­æ‰€æœ‰çš„<code>EXP2</code>ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> REPLACE<span class="token punctuation">(</span><span class="token string">'ROMANND'</span>ï¼Œ<span class="token string">'NND'</span><span class="token punctuation">,</span><span class="token string">'CCB'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span></code></pre><h4 id="8ã€æ¡ä»¶æŸ¥æ‰¾å­—ç¬¦ä¸²"><a href="#8ã€æ¡ä»¶æŸ¥æ‰¾å­—ç¬¦ä¸²" class="headerlink" title="8ã€æ¡ä»¶æŸ¥æ‰¾å­—ç¬¦ä¸²"></a>8ã€æ¡ä»¶æŸ¥æ‰¾å­—ç¬¦ä¸²</h4><p>æ ¹æ®æ¡ä»¶æŸ¥æ‰¾å­—ç¬¦ä¸²ï¼Œè¿”å›å­—ç¬¦ä¸²ã€‚</p><p>ï¼ˆaï¼‰REPEATå‡½æ•°</p><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql">REPEAT<span class="token punctuation">(</span>ARG1<span class="token punctuation">,</span>NUM_TIMES<span class="token punctuation">)</span></code></pre><p>REPEATå‡½æ•°è¿”å›<code>ARG1</code>è¢«é‡å¤<code>NUM_TIMES</code>æ¬¡çš„å­—ç¬¦ä¸²ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> REPEAT<span class="token punctuation">(</span><span class="token string">'hello'</span>ï¼Œ<span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span></code></pre><p>ï¼ˆbï¼‰SPACEå‡½æ•°</p><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql">SPACE<span class="token punctuation">(</span>SIZE<span class="token punctuation">)</span></code></pre><p>SPACEå‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«<code>SIZE</code>ä¸ªç©ºæ ¼çš„å­—ç¬¦ä¸²ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> SPACE<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœæ²¡å‘æ‰“ï¼Œå°±æ˜¯10ä¸ªç©ºæ ¼å­—ç¬¦ä¸²</span></code></pre><h3 id="å››ã€åˆ¤æ–­å‡½æ•°"><a href="#å››ã€åˆ¤æ–­å‡½æ•°" class="headerlink" title="å››ã€åˆ¤æ–­å‡½æ•°"></a>å››ã€åˆ¤æ–­å‡½æ•°</h3><h4 id="1ã€VALUEå‡½æ•°"><a href="#1ã€VALUEå‡½æ•°" class="headerlink" title="1ã€VALUEå‡½æ•°"></a>1ã€VALUEå‡½æ•°</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VALUE</span><span class="token punctuation">(</span>EXPRESSION1<span class="token punctuation">,</span>EXPRESSION2<span class="token punctuation">)</span><span class="token comment" spellcheck="true">--VALUEå‡½æ•°æ˜¯ç”¨è¿”å›ä¸€ä¸ªéç©ºçš„å€¼ï¼Œå½“å…¶ç¬¬ä¸€ä¸ªå‚æ•°éç©ºï¼Œç›´æ¥è¿”å›è¯¥å‚æ•°çš„å€¼ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç©ºï¼Œåˆ™è¿”å›ç¬¬äºŒä¸ªå‚æ•°çš„å€¼ã€‚</span><span class="token comment" spellcheck="true">--è¡¨ç¤ºå¦‚æœLOGINFO.IDä¸ºç©ºï¼Œåˆ™è¿”å›ç©ºä¸²ï¼Œå¦‚æœLOGINFO.IDä¸ä¸ºç©ºï¼Œåˆ™è¿”å›LOGINFO.IDã€‚</span><span class="token keyword">SELECT</span> <span class="token keyword">VALUE</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> LOGINFO</code></pre><h4 id="2ã€COALESCEå‡½æ•°"><a href="#2ã€COALESCEå‡½æ•°" class="headerlink" title="2ã€COALESCEå‡½æ•°"></a>2ã€COALESCEå‡½æ•°</h4><p>å¤„ç†nullçš„å‡½æ•°ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">COALESCE</span><span class="token punctuation">(</span>ARG1<span class="token punctuation">,</span>ARG2<span class="token punctuation">)</span><span class="token comment" spellcheck="true">--COALESCEè¿”å›å‚æ•°é›†ä¸­ç¬¬ä¸€ä¸ªénullå‚æ•°ã€‚</span><span class="token comment" spellcheck="true">--ç”¨æ³•ç±»ä¼¼äºVALUEå‡½æ•°ã€‚å½“å…¶ç¬¬ä¸€ä¸ªå‚æ•°éç©ºï¼Œç›´æ¥è¿”å›è¯¥å‚æ•°çš„å€¼ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç©ºï¼Œåˆ™è¿”å›ç¬¬äºŒä¸ªå‚æ•°çš„å€¼</span></code></pre><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>COUNT_AMT<span class="token punctuation">,</span> <span class="token string">'0.00'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> LOGINFO <span class="token punctuation">;</span><span class="token comment" spellcheck="true">--é‡‘é¢ä¸ºnullçš„æ—¶å€™ï¼Œæ˜¾ç¤º0.00</span></code></pre><h4 id="3ã€NVLå‡½æ•°"><a href="#3ã€NVLå‡½æ•°" class="headerlink" title="3ã€NVLå‡½æ•°"></a>3ã€NVLå‡½æ•°</h4><p>å¤„ç†nullçš„å‡½æ•°ã€‚</p><pre class=" language-sql"><code class="language-sql">NVL<span class="token punctuation">(</span>exp1<span class="token punctuation">,</span> exp2<span class="token punctuation">)</span><span class="token comment" spellcheck="true">--å¦‚æœexp1ä¸ºNULLï¼Œåˆ™å‡½æ•°è¿”å›exp2ï¼Œå¦åˆ™è¿”å›exp1æœ¬èº«ã€‚ä½†æ­¤å‡½æ•°æœ‰ä¸€å®šå±€é™ï¼Œæ‰€ä»¥å°±æœ‰äº†NVL2å‡½æ•°ã€‚</span></code></pre><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> nvl<span class="token punctuation">(</span>COUNT_AMT<span class="token punctuation">,</span> <span class="token string">'0.00'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> LOGINFO <span class="token punctuation">;</span></code></pre><blockquote><p><code>NVL2</code>å‡½æ•°ï¼š<code>Oracle/PLsql</code>ä¸­çš„ä¸€ä¸ªå‡½æ•°,Oracleåœ¨<code>NVL</code>å‡½æ•°çš„åŠŸèƒ½ä¸Šæ‰©å±•ï¼Œæä¾›äº†<code>NVL2</code>å‡½æ•°ã€‚<code>NVL2(exp1, exp2, exp3)</code>çš„åŠŸèƒ½ä¸ºï¼šå¦‚æœ<code>exp1</code>ä¸ºNULLï¼Œåˆ™å‡½æ•°è¿”å›<code>exp3</code>ï¼Œè‹¥<code>exp1</code>ä¸ä¸ºnullï¼Œåˆ™è¿”å›<code>exp2</code>ã€‚</p></blockquote><h4 id="4ã€CASTå‡½æ•°"><a href="#4ã€CASTå‡½æ•°" class="headerlink" title="4ã€CASTå‡½æ•°"></a>4ã€CASTå‡½æ•°</h4><p>ä¸charæœ‰ç±»ä¼¼åŠŸèƒ½ã€‚å¯ä»¥ç”¨æ¥è½¬æ¢ç±»å‹ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> CAST<span class="token punctuation">(</span><span class="token keyword">CURRENT</span> TIME <span class="token keyword">AS</span> CHAR<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>SYSDUMMY1</code></pre><h4 id="5ã€VARCHARå‡½æ•°"><a href="#5ã€VARCHARå‡½æ•°" class="headerlink" title="5ã€VARCHARå‡½æ•°"></a>5ã€<code>VARCHAR</code>å‡½æ•°</h4><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">VARCHAR</span><span class="token punctuation">(</span>ARG<span class="token punctuation">,</span>LENGTH<span class="token punctuation">)</span></code></pre><p><code>VARCHAR</code>å‡½æ•°è¿”å›<code>ARG</code>å­—ç¬¦ä¸²ã€æ—¥æœŸå‹ã€å›¾å½¢ä¸²çš„å¯å˜é•¿åº¦<code>LENGTH</code>çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token string">'helloworld'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span></code></pre><h4 id="6ã€CASE-WHENå‡½æ•°"><a href="#6ã€CASE-WHENå‡½æ•°" class="headerlink" title="6ã€CASE-WHENå‡½æ•°"></a>6ã€CASE-WHENå‡½æ•°</h4><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>  id<span class="token punctuation">,</span>USER_ID<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span><span class="token punctuation">(</span>COUNT_AMT<span class="token operator">&lt;=</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token keyword">then</span> <span class="token string">'ä¸€èˆ¬'</span><span class="token keyword">when</span><span class="token punctuation">(</span>COUNT_AMT<span class="token operator">></span><span class="token number">10000</span>  <span class="token operator">and</span>  COUNT_AMT<span class="token operator">&lt;=</span><span class="token number">50000</span> <span class="token punctuation">)</span>   <span class="token keyword">then</span> <span class="token string">'æ™®é€š'</span>   <span class="token keyword">when</span><span class="token punctuation">(</span>COUNT_AMT<span class="token operator">></span><span class="token number">50000</span>  <span class="token operator">and</span> COUNT_AMT<span class="token operator">&lt;=</span><span class="token number">100000</span> <span class="token punctuation">)</span>   <span class="token keyword">then</span> <span class="token string">'å¯Œè£•'</span> <span class="token keyword">else</span>   <span class="token string">'åœŸè±ª'</span>  <span class="token keyword">end</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">status</span><span class="token keyword">FROM</span>  DBCM<span class="token punctuation">.</span>LOGINFO </code></pre><h4 id="7ã€exists-A-å‡½æ•°"><a href="#7ã€exists-A-å‡½æ•°" class="headerlink" title="7ã€exists(A)å‡½æ•°"></a>7ã€exists(A)å‡½æ•°</h4><p>åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨æ•°æ®è¿”å›trueï¼Œä¸å­˜åœ¨è¿”å›falseã€‚</p><p>åœ¨<code>sql</code>ä¸­å†å…·ä½“ä½¿ç”¨ç¤ºä¾‹è¯´æ˜ã€‚</p><h4 id="8ã€åˆ¤æ–­å­—ç¬¦ä½ç½®"><a href="#8ã€åˆ¤æ–­å­—ç¬¦ä½ç½®" class="headerlink" title="8ã€åˆ¤æ–­å­—ç¬¦ä½ç½®"></a>8ã€åˆ¤æ–­å­—ç¬¦ä½ç½®</h4><p>ï¼ˆaï¼‰<code>instr</code>å‡½æ•°</p><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql">instr<span class="token punctuation">(</span>æºå­—ç¬¦ä¸²<span class="token punctuation">,</span> è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²<span class="token punctuation">,</span> ä»ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹<span class="token punctuation">,</span> è¦æ‰¾åˆ°ç¬¬å‡ ä¸ªåŒ¹é…çš„åºå·<span class="token punctuation">)</span></code></pre><p>æ•°æ®åº“ä¸­å­—ç¬¦ä¸²ç´¢å¼•éƒ½æ˜¯ä»1å¼€å§‹ï¼Œä»0å¼€å§‹çš„è¯æ˜¯æœç´¢ä¸åˆ°çš„ã€‚</p><p>é»˜è®¤æŸ¥æ‰¾é¡ºåºä¸ºä»å·¦åˆ°å³ã€‚å½“èµ·å§‹ä½ç½®ä¸ºè´Ÿæ•°çš„æ—¶å€™ï¼Œä»å³è¾¹å¼€å§‹æŸ¥æ‰¾ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">values</span> instr<span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">--DB2æ‰§è¡ŒæŠ¥é”™</span><span class="token keyword">values</span> instr<span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">--ç»“æœï¼š5</span><span class="token keyword">values</span> instr<span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">--ç»“æœï¼š8</span><span class="token keyword">select</span> instr<span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">--ç»“æœï¼š8</span></code></pre><p>ï¼ˆbï¼‰<code>LOCATE</code>å‡½æ•°<br>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql">LOCATE<span class="token punctuation">(</span>ARG1<span class="token punctuation">,</span>ARG2<span class="token punctuation">,</span><span class="token operator">&lt;</span>POS<span class="token operator">></span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">--åªæœ‰èµ·å§‹ä½ç½®</span></code></pre><p>LOCATEå‡½æ•°åœ¨<code>ARG2</code>ä¸­æŸ¥æ‰¾<code>ARG1</code>ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæŒ‡å®š<code>POS</code>ï¼Œåˆ™ä»<code>ARG2</code>çš„<code>POS</code>å¤„å¼€å§‹æŸ¥æ‰¾<code>ARG1</code>ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>  LOCATE<span class="token punctuation">(</span><span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">'hello world'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼š3</span></code></pre><p>ï¼ˆcï¼‰<code>POSSTR</code>å‡½æ•°</p><p>è¯­æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql">POSSTR<span class="token punctuation">(</span>EXP1<span class="token punctuation">,</span>EXP2<span class="token punctuation">)</span></code></pre><p><code>POSSTR</code>å‡½æ•°è¿”å›<code>EXP2</code>åœ¨<code>EXP1</code>ä¸­çš„ä½ç½®ã€‚ â€“æ²¡æœ‰èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½® SELECT LOCATE(NAMEï¼Œâ€™aâ€™) FROM T1</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>  POSSTR<span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">,</span><span class="token string">'wo'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼š7</span></code></pre><h3 id="äº”ã€å…¶ä»–"><a href="#äº”ã€å…¶ä»–" class="headerlink" title="äº”ã€å…¶ä»–"></a>äº”ã€å…¶ä»–</h3><p>ï¼ˆ1ï¼‰row_number() over()å‡½æ•°</p><p>æ’åºã€åˆ†é¡µå¸¸ç”¨ã€‚</p><p>æ’åºï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> row_id <span class="token keyword">from</span>  LOGINFO  </code></pre><p>åˆ†é¡µï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>rownumber<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> row_id <span class="token keyword">from</span>  LOGINFO  <span class="token punctuation">)</span> <span class="token keyword">where</span> row_id <span class="token operator">between</span> <span class="token number">1</span> <span class="token operator">and</span> <span class="token number">10</span></code></pre><p>ï¼ˆ2ï¼‰DIGITSå‡½æ•°ï¼š</p><p>DIGITSå‡½æ•°è¿”å›<code>SMALLINT</code>ã€<code>INTEGER</code>ã€<code>BIGIT</code>æˆ–è€…<code>DECIMAL</code>å‚æ•°çš„å­—ç¬¦ä¸²å€¼ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> DIGITS<span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span></code></pre><p>ï¼ˆ3ï¼‰DOUBLEã€FLOATå‡½æ•°:</p><p>DOUBLEã€FLOATå‡½æ•°å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªæ•°å­—è¡¨è¾¾å¼ï¼Œè¿”å›ä¸å…¶å¯¹åº”çš„æµ®ç‚¹æ•°ï¼Œå¦åˆ™è¿”å›é”™è¯¯ä»£ç ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DOUBLE</span><span class="token punctuation">(</span><span class="token string">'4569'</span><span class="token punctuation">)</span>  <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span></code></pre><p>ï¼ˆ4ï¼‰INTå‡½æ•°</p><p>INTå‡½æ•°è¿”å›æ•´å‹å¸¸é‡ä¸­çš„æ•°å­—ã€å­—ç¬¦ä¸²æˆ–è€…æ—¥æœŸã€æ—¶é—´çš„æ•´æ•°è¡¨ç¤ºã€‚</p><pre><code>SELECT INT(&#39;123&#39;) FROM SYSIBM.DUAL;</code></pre><p>ï¼ˆ5ï¼‰<code>BIGINT</code>å‡½æ•°</p><p><code>BIGINT</code>å‡½æ•°è¿”å›æ•´å‹å¸¸é‡ä¸­çš„æ•°å­—ã€å­—ç¬¦ä¸²æˆ–è€…æ—¶é—´æˆ³çš„64ä½é•¿æ•´æ•°è¡¨ç¤ºã€‚</p><pre><code>SELECT BIGINT(&#39;789987&#39;) FROM SYSIBM.DUAL;</code></pre><p>ï¼ˆ6ï¼‰<code>SMALLINT</code>å‡½æ•°</p><p><code>SMALLINT</code>å‡½æ•°è¿”å›æ•´å‹å¸¸é‡ä¸­çš„æ•°å­—ã€å­—ç¬¦ä¸²çŸ­æ•´æ•°è¡¨ç¤ºã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">SMALLINT</span><span class="token punctuation">(</span><span class="token string">'124'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span></code></pre><p>ï¼ˆ7ï¼‰REALå‡½æ•°</p><p>REALå‡½æ•°è¿”å›ä¸€ä¸ªæ•°å€¼çš„å•ç²¾åº¦æµ®ç‚¹æ•°è¡¨ç¤ºã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">REAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼š10.0</span></code></pre><p>ï¼ˆ8ï¼‰<code>DEC[IMAL]</code>å‡½æ•°</p><p><code>DEC[IMAL]</code>å‡½æ•°è¿”å›ä¸€ä¸ªæ•°å€¼ã€<code>DECIMAL</code>çš„å­—ç¬¦ä¸²ã€<code>INTEGER</code>çš„å­—ç¬¦ä¸²ã€<code>FLOAT-POINT</code>çš„å­—ç¬¦ä¸²ã€æ—¥æœŸã€æ—¶é—´æˆ–æ—¶é—´æˆ³çš„<code>DECIMAL</code>æ•°å€¼ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DEC</span><span class="token punctuation">(</span><span class="token number">10.1314</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼š10</span></code></pre><p>ï¼ˆ9ï¼‰HEXå‡½æ•°</p><p>HEXå‡½æ•°è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„å€¼çš„16è¿›åˆ¶è¡¨ç¤ºã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> HEX<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼š0A000000</span></code></pre><p>ï¼ˆ10ï¼‰FLOORå‡½æ•°</p><p>FLOORå‡½æ•°å–å°äºæˆ–ç­‰äºå‚æ•°çš„æœ€å¤§æ•´æ•°ã€‚</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> FLOOR<span class="token punctuation">(</span><span class="token number">10.50</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SYSIBM<span class="token punctuation">.</span>DUAL<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--ç»“æœï¼š10</span></code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> DB2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DB2 </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmä¹‹ç±»åŠ è½½æœºåˆ¶</title>
      <link href="/posts/22096143.html"/>
      <url>/posts/22096143.html</url>
      
        <content type="html"><![CDATA[<h2 id="jvmç±»åŠ è½½æœºåˆ¶"><a href="#jvmç±»åŠ è½½æœºåˆ¶" class="headerlink" title="jvmç±»åŠ è½½æœºåˆ¶"></a>jvmç±»åŠ è½½æœºåˆ¶</h2><p>ä»€ä¹ˆæ˜¯ç±»åŠ è½½æœºåˆ¶ï¼Ÿ</p><blockquote><p>Javaè™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®ä»Classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è½¬æ¢è§£æå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„Javaç±»å‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä½œè™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€‚</p></blockquote><h3 id="ä¸€ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ä¸€ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ä¸€ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ"></a>ä¸€ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h3><p>ä¸ªç±»å‹ä»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå°†ä¼šç»å†åŠ è½½ï¼ˆLoadingï¼‰ã€éªŒè¯ï¼ˆVerificationï¼‰ã€å‡†å¤‡ï¼ˆPreparationï¼‰ã€è§£æï¼ˆResolutionï¼‰ã€åˆå§‹åŒ–ï¼ˆInitializationï¼‰ã€ä½¿ç”¨ï¼ˆUsingï¼‰å’Œå¸è½½ï¼ˆUnloadingï¼‰ä¸ƒä¸ªé˜¶æ®µã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-clazz-load/jvm-class-load-life.jpg" alt="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"></p><p>å…¶ä¸­éªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆLinkingï¼‰ã€‚</p><p>åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–å’Œå¸è½½è¿™äº”ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œç±»å‹çš„åŠ è½½è¿‡ç¨‹å¿…é¡»æŒ‰ç…§è¿™ç§é¡ºåºæŒ‰éƒ¨å°±ç­åœ°å¼€å§‹ï¼Œè¿™äº›é˜¶æ®µé€šå¸¸éƒ½æ˜¯äº’ç›¸äº¤å‰åœ°æ··åˆè¿›è¡Œçš„ï¼Œä¼šåœ¨ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œçš„è¿‡ç¨‹ä¸­è°ƒç”¨ã€æ¿€æ´»å¦ä¸€ä¸ªé˜¶æ®µã€‚</p><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸¥æ ¼è§„å®šäº†æœ‰ä¸”åªæœ‰å…­ç§æƒ…å†µå¿…é¡»ç«‹å³å¯¹ç±»è¿›è¡Œâ€œåˆå§‹åŒ–â€ï¼ˆè€ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡è‡ªç„¶éœ€è¦åœ¨æ­¤ä¹‹å‰å¼€å§‹ï¼‰ï¼š</p><p>1ï¼‰é‡åˆ°newã€getstaticã€putstaticæˆ–invokestaticè¿™å››æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»å‹æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–é˜¶æ®µã€‚èƒ½å¤Ÿç”Ÿæˆè¿™å››æ¡æŒ‡ä»¤çš„å…¸å‹Javaä»£ç åœºæ™¯æœ‰ï¼š</p><p>â€‹    ï¼ˆaï¼‰ä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ã€‚</p><p>â€‹    ï¼ˆbï¼‰è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»å‹çš„é™æ€å­—æ®µï¼ˆè¢«finalä¿®é¥°ã€å·²åœ¨ç¼–è¯‘æœŸæŠŠç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–ï¼‰çš„æ—¶å€™ã€‚</p><p>â€‹    ï¼ˆcï¼‰è°ƒç”¨ä¸€ä¸ªç±»å‹çš„é™æ€æ–¹æ³•çš„æ—¶å€™ã€‚</p><p>2ï¼‰ä½¿ç”¨java.lang.reflectåŒ…çš„æ–¹æ³•å¯¹ç±»å‹è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»å‹æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚</p><p>3ï¼‰å½“åˆå§‹åŒ–ç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</p><p>4ï¼‰å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«main()æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚</p><p>5ï¼‰å½“ä½¿ç”¨JDK 7æ–°åŠ å…¥çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ªjava.lang.invoke.MethodHandleå®ä¾‹æœ€åçš„è§£æç»“æœä¸ºREF_getStaticã€REF_putStaticã€REF_invokeStaticã€REF_newInvokeSpecialå››ç§ç±»å‹çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚</p><p>6ï¼‰å½“ä¸€ä¸ªæ¥å£ä¸­å®šä¹‰äº†JDK 8æ–°åŠ å…¥çš„é»˜è®¤æ–¹æ³•ï¼ˆè¢«defaultå…³é”®å­—ä¿®é¥°çš„æ¥å£æ–¹æ³•ï¼‰æ—¶ï¼Œå¦‚æœæœ‰è¿™ä¸ªæ¥å£çš„å®ç°ç±»å‘ç”Ÿäº†åˆå§‹åŒ–ï¼Œé‚£è¯¥æ¥å£è¦åœ¨å…¶ä¹‹å‰è¢«åˆå§‹åŒ–ã€‚</p><p>è¿™å…­ç§åœºæ™¯ä¸­çš„è¡Œä¸ºç§°ä¸ºå¯¹ä¸€ä¸ªç±»å‹è¿›è¡Œä¸»åŠ¨å¼•ç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰å¼•ç”¨ç±»å‹çš„æ–¹å¼éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œç§°ä¸ºè¢«åŠ¨å¼•ç”¨ã€‚</p><p>å¦å¤–çš„å‡ ç§æƒ…å†µï¼š</p><p>ç¤ºä¾‹ä¸€ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zzy<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>clazzload<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * è¢«åŠ¨ä½¿ç”¨ç±»å­—æ®µæ¼”ç¤ºä¸€ï¼š * é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ– **/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SuperClass</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SuperClass init!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zzy<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>clazzload<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubClass</span> <span class="token keyword">extends</span> <span class="token class-name">SuperClass</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SubClass init!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zzy<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>clazzload<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * éä¸»åŠ¨ä½¿ç”¨ç±»å­—æ®µæ¼”ç¤º **/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotInitialization</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>SubClass<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¾“å‡ºç»“æœ </p><pre class=" language-txt"><code class="language-txt">SuperClass init!123</code></pre><p>è¾“å‡ºâ€œSuperClass initï¼â€,æ²¡æœ‰è¾“å‡ºå­ç±»çš„åˆå§‹åŒ–ã€‚</p><p>å¯¹äºé™æ€å­—æ®µï¼Œåªæœ‰ç›´æ¥å®šä¹‰è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œå› æ­¤é€šè¿‡å…¶å­ç±»æ¥å¼•ç”¨çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€å­—æ®µï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–è€Œä¸ä¼šè§¦å‘å­ç±»çš„åˆå§‹åŒ–ã€‚</p><p>è‹¥è¦è§¦å‘å­ç±»çš„åŠ è½½å’ŒéªŒè¯é˜¶æ®µï¼Œå¯¹äºHotSpotè™šæ‹Ÿæœºæ¥è¯´ï¼Œå¯é€šè¿‡-XXï¼š+TraceClassLoadingå‚æ•°è§‚å¯Ÿåˆ°æ­¤æ“ä½œæ˜¯ä¼šå¯¼è‡´å­ç±»åŠ è½½çš„ã€‚</p><p>ç¤ºä¾‹äºŒï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zzy<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>clazzload<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * è¢«åŠ¨ä½¿ç”¨ç±»å­—æ®µæ¼”ç¤ºäºŒï¼š * é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ– **/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotInitialization</span> <span class="token punctuation">{</span>     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment" spellcheck="true">//System.out.println(SubClass.value);</span>         SuperClass<span class="token punctuation">[</span><span class="token punctuation">]</span> sca <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperClass</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œä¹‹åå‘ç°æ²¡æœ‰è¾“å‡ºâ€œSuperClass initï¼â€</p><p>è¿™æ®µä»£ç é‡Œé¢è§¦å‘äº†å¦ä¸€ä¸ªåä¸ºâ€œ[Lcom.zzy.demo.clazzload.SuperClassâ€çš„ç±»çš„åˆå§‹åŒ–é˜¶æ®µï¼Œå¯¹äºç”¨æˆ·ä»£ç æ¥è¯´ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„ç±»å‹åç§°ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”±è™šæ‹Ÿæœºè‡ªåŠ¨ç”Ÿæˆçš„ã€ç›´æ¥ç»§æ‰¿äºjava.lang.Objectçš„å­ç±»ï¼Œåˆ›å»ºåŠ¨ä½œç”±å­—èŠ‚ç æŒ‡ä»¤newarrayè§¦å‘ã€‚</p><blockquote><p>è¿™ä¸ªç±»ä»£è¡¨äº†ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸ºcom.zzy.demo.clazzload.SuperClassçš„ä¸€ç»´æ•°ç»„ï¼Œæ•°ç»„ä¸­åº”æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼ˆç”¨æˆ·å¯ç›´æ¥ä½¿ç”¨çš„åªæœ‰è¢«ä¿®é¥°ä¸ºpublicçš„lengthå±æ€§å’Œclone()æ–¹æ³•ï¼‰éƒ½å®ç°åœ¨è¿™ä¸ªç±»é‡Œã€‚Javaè¯­è¨€ä¸­å¯¹æ•°ç»„çš„è®¿é—®è¦æ¯”C/C++ç›¸å¯¹å®‰å…¨ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå°±æ˜¯å› ä¸ºè¿™ä¸ªç±»åŒ…è£…äº†æ•°ç»„å…ƒç´ çš„è®¿é—®[æ’å›¾]ï¼Œè€ŒC/C++ä¸­åˆ™æ˜¯ç›´æ¥ç¿»è¯‘ä¸ºå¯¹æ•°ç»„æŒ‡é’ˆçš„ç§»åŠ¨ã€‚åœ¨Javaè¯­è¨€é‡Œï¼Œå½“æ£€æŸ¥åˆ°å‘ç”Ÿæ•°ç»„è¶Šç•Œæ—¶ä¼šæŠ›å‡ºjava.lang.ArrayIndexOutOfBoundsExceptionå¼‚å¸¸ï¼Œé¿å…äº†ç›´æ¥é€ æˆéæ³•å†…å­˜è®¿é—®ã€‚</p></blockquote><p>ç¤ºä¾‹ä¸‰ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zzy<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>clazzload<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * è¢«åŠ¨ä½¿ç”¨ç±»å­—æ®µæ¼”ç¤ºä¸‰ï¼š * å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šæ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„   ç±»çš„åˆå§‹åŒ– **/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConstClass</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ConstClass init!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String HELLOWORLD <span class="token operator">=</span> <span class="token string">"hello world"</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zzy<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>clazzload<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * éä¸»åŠ¨ä½¿ç”¨ç±»å­—æ®µæ¼”ç¤º **/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotInitialization</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ConstClass<span class="token punctuation">.</span>HELLOWORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ä¸Šè¿°ä»£ç è¿è¡Œä¹‹åï¼Œä¹Ÿæ²¡æœ‰è¾“å‡ºâ€œConstClass initï¼â€ï¼Œè¿™æ˜¯å› ä¸ºè™½ç„¶åœ¨Javaæºç ä¸­ç¡®å®å¼•ç”¨äº†ConstClassç±»çš„å¸¸é‡HELLOWORLDï¼Œä½†å…¶å®åœ¨ç¼–è¯‘é˜¶æ®µé€šè¿‡å¸¸é‡ä¼ æ’­ä¼˜åŒ–ï¼Œå·²ç»å°†æ­¤å¸¸é‡çš„å€¼â€œhello worldâ€ç›´æ¥å­˜å‚¨åœ¨NotInitializationç±»çš„å¸¸é‡æ± ä¸­ï¼Œä»¥åNotInitializationå¯¹å¸¸é‡ConstClass.HELLOWORLDçš„å¼•ç”¨ï¼Œå®é™…éƒ½è¢«è½¬åŒ–ä¸ºNotInitializationç±»å¯¹è‡ªèº«å¸¸é‡æ± çš„å¼•ç”¨äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®é™…ä¸ŠNotInitializationçš„Classæ–‡ä»¶ä¹‹ä¸­å¹¶æ²¡æœ‰ConstClassç±»çš„ç¬¦å·å¼•ç”¨å…¥å£ï¼Œè¿™ä¸¤ä¸ªç±»åœ¨ç¼–è¯‘æˆClassæ–‡ä»¶åå°±å·²ä¸å­˜åœ¨ä»»ä½•è”ç³»äº†ã€‚</p><p>æ¥å£åˆå§‹åŒ–ï¼š</p><p>æ¥å£çš„åŠ è½½è¿‡ç¨‹ä¸ç±»åŠ è½½è¿‡ç¨‹ç¨æœ‰ä¸åŒï¼Œæ¥å£ä¹Ÿæœ‰åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™ç‚¹ä¸ç±»æ˜¯ä¸€è‡´çš„ã€‚</p><p>ä¸Šé¢çš„ä»£ç éƒ½æ˜¯ç”¨é™æ€è¯­å¥å—â€œstatic{}â€æ¥è¾“å‡ºåˆå§‹åŒ–ä¿¡æ¯çš„ï¼Œè€Œæ¥å£ä¸­ä¸èƒ½ä½¿ç”¨â€œstatic{}â€è¯­å¥å—ï¼Œä½†ç¼–è¯‘å™¨ä»ç„¶ä¼šä¸ºæ¥å£ç”Ÿæˆ<code>&quot;&lt;&quot;clinit&gt;()&quot;</code>ç±»æ„é€ å™¨ï¼Œç”¨äºåˆå§‹åŒ–æ¥å£ä¸­æ‰€å®šä¹‰çš„æˆå‘˜å˜é‡ã€‚</p><p>æ¥å£ä¸ç±»çœŸæ­£æœ‰æ‰€åŒºåˆ«çš„æ˜¯å‰é¢è®²è¿°çš„å…­ç§â€œæœ‰ä¸”ä»…æœ‰â€éœ€è¦è§¦å‘åˆå§‹åŒ–åœºæ™¯ä¸­çš„ç¬¬ä¸‰ç§ï¼šå½“ä¸€ä¸ªç±»åœ¨åˆå§‹åŒ–æ—¶ï¼Œè¦æ±‚å…¶çˆ¶ç±»å…¨éƒ¨éƒ½å·²ç»åˆå§‹åŒ–è¿‡äº†ï¼Œä½†æ˜¯ä¸€ä¸ªæ¥å£åœ¨åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸è¦æ±‚å…¶çˆ¶æ¥å£å…¨éƒ¨éƒ½å®Œæˆäº†åˆå§‹åŒ–ï¼Œåªæœ‰åœ¨çœŸæ­£ä½¿ç”¨åˆ°çˆ¶æ¥å£çš„æ—¶å€™ï¼ˆå¦‚å¼•ç”¨æ¥å£ä¸­å®šä¹‰çš„å¸¸é‡ï¼‰æ‰ä¼šåˆå§‹åŒ–ã€‚</p><h3 id="äºŒã€ç±»åŠ è½½è¿‡ç¨‹"><a href="#äºŒã€ç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="äºŒã€ç±»åŠ è½½è¿‡ç¨‹"></a>äºŒã€ç±»åŠ è½½è¿‡ç¨‹</h3><h4 id="1-åŠ è½½"><a href="#1-åŠ è½½" class="headerlink" title="1 åŠ è½½"></a>1 åŠ è½½</h4><p>â€œåŠ è½½â€ï¼ˆLoadingï¼‰é˜¶æ®µæ˜¯æ•´ä¸ªâ€œç±»åŠ è½½â€ï¼ˆClass Loadingï¼‰è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé˜¶æ®µï¼Œå¸Œæœ›è¯»è€…æ²¡æœ‰æ··æ·†è¿™ä¸¤ä¸ªçœ‹èµ·æ¥å¾ˆç›¸ä¼¼çš„åè¯ã€‚åœ¨åŠ è½½é˜¶æ®µï¼ŒJavaè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…ï¼š</p><p>1ï¼‰é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</p><p>2ï¼‰å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</p><p>3ï¼‰åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚</p><p>æ•°ç»„ç±»åŠ è½½ï¼š</p><p>æ•°ç»„ç±»æœ¬èº«ä¸é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºï¼Œå®ƒæ˜¯ç”±Javaè™šæ‹Ÿæœºç›´æ¥åœ¨å†…å­˜ä¸­åŠ¨æ€æ„é€ å‡ºæ¥çš„ã€‚ä½†æ•°ç»„ç±»ä¸ç±»åŠ è½½å™¨ä»ç„¶æœ‰å¾ˆå¯†åˆ‡çš„å…³ç³»ï¼Œå› ä¸ºæ•°ç»„ç±»çš„å…ƒç´ ç±»å‹ï¼ˆElement Typeï¼ŒæŒ‡çš„æ˜¯æ•°ç»„å»æ‰æ‰€æœ‰ç»´åº¦çš„ç±»å‹ï¼‰æœ€ç»ˆè¿˜æ˜¯è¦é ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ï¼Œä¸€ä¸ªæ•°ç»„ç±»ï¼ˆä¸‹é¢ç®€ç§°ä¸ºCï¼‰åˆ›å»ºè¿‡ç¨‹éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š</p><p>ï¼ˆ1ï¼‰å¦‚æœæ•°ç»„çš„ç»„ä»¶ç±»å‹ï¼ˆComponent Typeï¼ŒæŒ‡çš„æ˜¯æ•°ç»„å»æ‰ä¸€ä¸ªç»´åº¦çš„ç±»å‹ï¼Œæ³¨æ„å’Œå‰é¢çš„å…ƒç´ ç±»å‹åŒºåˆ†å¼€æ¥ï¼‰æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£å°±é€’å½’é‡‡ç”¨æœ¬èŠ‚ä¸­å®šä¹‰çš„åŠ è½½è¿‡ç¨‹å»åŠ è½½è¿™ä¸ªç»„ä»¶ç±»å‹ï¼Œæ•°ç»„Cå°†è¢«æ ‡è¯†åœ¨åŠ è½½è¯¥ç»„ä»¶ç±»å‹çš„ç±»åŠ è½½å™¨çš„ç±»åç§°ç©ºé—´ä¸Šã€‚</p><p>ï¼ˆ2ï¼‰å¦‚æœæ•°ç»„çš„ç»„ä»¶ç±»å‹ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼ˆä¾‹å¦‚int[]æ•°ç»„çš„ç»„ä»¶ç±»å‹ä¸ºintï¼‰ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šæŠŠæ•°ç»„Cæ ‡è®°ä¸ºä¸å¼•å¯¼ç±»åŠ è½½å™¨å…³è”ã€‚</p><p>ï¼ˆ3ï¼‰æ•°ç»„ç±»çš„å¯è®¿é—®æ€§ä¸å®ƒçš„ç»„ä»¶ç±»å‹çš„å¯è®¿é—®æ€§ä¸€è‡´ï¼Œå¦‚æœç»„ä»¶ç±»å‹ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œå®ƒçš„æ•°ç»„ç±»çš„å¯è®¿é—®æ€§å°†é»˜è®¤ä¸ºpublicï¼Œå¯è¢«æ‰€æœ‰çš„ç±»å’Œæ¥å£è®¿é—®åˆ°ã€‚</p><p>åŠ è½½é˜¶æ®µç»“æŸåï¼ŒJavaè™šæ‹Ÿæœºå¤–éƒ¨çš„äºŒè¿›åˆ¶å­—èŠ‚æµå°±æŒ‰ç…§è™šæ‹Ÿæœºæ‰€è®¾å®šçš„æ ¼å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºã€‚æ–¹æ³•åŒºä¸­çš„æ•°æ®å­˜å‚¨æ ¼å¼å®Œå…¨ç”±è™šæ‹Ÿæœºå®ç°è‡ªè¡Œå®šä¹‰ï¼Œã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹æœªè§„å®šæ­¤åŒºåŸŸçš„å…·ä½“æ•°æ®ç»“æ„ã€‚ç±»å‹æ•°æ®å¦¥å–„å®‰ç½®åœ¨æ–¹æ³•åŒºä¹‹åï¼Œä¼šåœ¨Javaå †å†…å­˜ä¸­å®ä¾‹åŒ–ä¸€ä¸ªjava.lang.Classç±»çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°†ä½œä¸ºç¨‹åºè®¿é—®æ–¹æ³•åŒºä¸­çš„ç±»å‹æ•°æ®çš„å¤–éƒ¨æ¥å£ã€‚</p><blockquote><p>åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†åŠ¨ä½œï¼ˆå¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œï¼‰æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªå®Œæˆï¼Œè¿æ¥é˜¶æ®µå¯èƒ½å·²ç»å¼€å§‹ï¼Œä½†è¿™äº›å¤¹åœ¨åŠ è½½é˜¶æ®µä¹‹ä¸­è¿›è¡Œçš„åŠ¨ä½œï¼Œä»ç„¶å±äºè¿æ¥é˜¶æ®µçš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µçš„å¼€å§‹æ—¶é—´ä»ç„¶ä¿æŒç€å›ºå®šçš„å…ˆåé¡ºåºã€‚</p></blockquote><h4 id="2-éªŒè¯"><a href="#2-éªŒè¯" class="headerlink" title="2 éªŒè¯"></a>2 éªŒè¯</h4><p>éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„å…¨éƒ¨çº¦æŸè¦æ±‚ï¼Œä¿è¯è¿™äº›ä¿¡æ¯è¢«å½“ä½œä»£ç è¿è¡Œåä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚</p><p>éªŒè¯é˜¶æ®µå¤§è‡´ä¸Šä¼šå®Œæˆä¸‹é¢å››ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼šæ–‡ä»¶æ ¼å¼éªŒè¯ã€å…ƒæ•°æ®éªŒè¯ã€å­—èŠ‚ç éªŒè¯å’Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚</p><p>1ï¼‰æ–‡ä»¶æ ¼å¼éªŒè¯</p><p>ç¬¬ä¸€é˜¶æ®µçš„ä¸»è¦ç›®çš„ï¼š</p><p>â€‹    æ˜¯ä¸ºä¿è¯è¾“å…¥çš„å­—èŠ‚æµèƒ½æ­£ç¡®åœ°è§£æå¹¶å­˜å‚¨äºæ–¹æ³•åŒºä¹‹å†…ï¼Œæ ¼å¼ä¸Šç¬¦åˆæè¿°ä¸€ä¸ªJavaç±»å‹ä¿¡æ¯çš„è¦æ±‚ã€‚</p><p>ç¬¬ä¸€é˜¶æ®µè¦éªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œå¹¶ä¸”èƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚è¿™ä¸€é˜¶æ®µå¯èƒ½åŒ…æ‹¬ä¸‹é¢è¿™äº›éªŒè¯ç‚¹ï¼š</p><p>ï¼ˆaï¼‰æ˜¯å¦ä»¥é­”æ•°0xCAFEBABEå¼€å¤´ã€‚</p><p>ï¼ˆbï¼‰ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰Javaè™šæ‹Ÿæœºæ¥å—èŒƒå›´ä¹‹å†…ã€‚</p><p>ï¼ˆcï¼‰å¸¸é‡æ± çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„å¸¸é‡ç±»å‹ï¼ˆæ£€æŸ¥å¸¸é‡tagæ ‡å¿—ï¼‰ã€‚</p><p>ï¼ˆdï¼‰æŒ‡å‘å¸¸é‡çš„å„ç§ç´¢å¼•å€¼ä¸­æ˜¯å¦æœ‰æŒ‡å‘ä¸å­˜åœ¨çš„å¸¸é‡æˆ–ä¸ç¬¦åˆç±»å‹çš„å¸¸é‡ã€‚</p><p>ï¼ˆeï¼‰CONSTANT_Utf8_infoå‹çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸ç¬¦åˆUTF-8ç¼–ç çš„æ•°æ®ã€‚</p><p>ï¼ˆfï¼‰Classæ–‡ä»¶ä¸­å„ä¸ªéƒ¨åˆ†åŠæ–‡ä»¶æœ¬èº«æ˜¯å¦æœ‰è¢«åˆ é™¤çš„æˆ–é™„åŠ çš„å…¶ä»–ä¿¡æ¯ã€‚</p><p>ï¼ˆgï¼‰â€¦â€¦ç­‰ç­‰ç­‰ç­‰</p><p>éªŒè¯ç‚¹è¿˜è¿œä¸æ­¢è¿™äº›ã€‚</p><p>2ï¼‰å…ƒæ•°æ®éªŒè¯</p><p>ç¬¬äºŒé˜¶æ®µçš„ä¸»è¦ç›®çš„ï¼š</p><p>â€‹    å¯¹ç±»çš„å…ƒæ•°æ®ä¿¡æ¯è¿›è¡Œè¯­ä¹‰æ ¡éªŒï¼Œä¿è¯ä¸å­˜åœ¨ä¸ã€ŠJavaè¯­è¨€è§„èŒƒã€‹å®šä¹‰ç›¸æ‚–çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚</p><p>ç¬¬äºŒé˜¶æ®µæ˜¯å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆã€ŠJavaè¯­è¨€è§„èŒƒã€‹çš„è¦æ±‚ï¼Œè¿™ä¸ªé˜¶æ®µå¯èƒ½åŒ…æ‹¬çš„éªŒè¯ç‚¹å¦‚ä¸‹ï¼š</p><p>ï¼ˆaï¼‰è¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤äº†java.lang.Objectä¹‹å¤–ï¼Œæ‰€æœ‰çš„ç±»éƒ½åº”å½“æœ‰çˆ¶ç±»ï¼‰ã€‚</p><p>ï¼ˆbï¼‰è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»ï¼ˆè¢«finalä¿®é¥°çš„ç±»ï¼‰ã€‚</p><p>ï¼ˆcï¼‰å¦‚æœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯å¦å®ç°äº†å…¶çˆ¶ç±»æˆ–æ¥å£ä¹‹ä¸­è¦æ±‚å®ç°çš„æ‰€æœ‰æ–¹æ³•ã€‚</p><p>ï¼ˆdï¼‰ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”ŸçŸ›ç›¾ï¼ˆä¾‹å¦‚è¦†ç›–äº†çˆ¶ç±»çš„finalå­—æ®µï¼Œæˆ–è€…å‡ºç°ä¸ç¬¦åˆè§„åˆ™çš„æ–¹æ³•é‡è½½ï¼Œä¾‹å¦‚æ–¹æ³•å‚æ•°éƒ½ä¸€è‡´ï¼Œä½†è¿”å›å€¼ç±»å‹å´ä¸åŒç­‰ï¼‰ã€‚</p><p>ï¼ˆeï¼‰â€¦â€¦ç­‰ç­‰ç­‰ç­‰</p><p>3ï¼‰å­—èŠ‚ç éªŒè¯</p><p>ç¬¬ä¸‰é˜¶æ®µæ˜¯æ•´ä¸ªéªŒè¯è¿‡ç¨‹ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªé˜¶æ®µï¼Œä¸»è¦ç›®çš„ï¼š</p><p>â€‹    é€šè¿‡æ•°æ®æµåˆ†æå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚</p><p>åœ¨ç¬¬äºŒé˜¶æ®µå¯¹å…ƒæ•°æ®ä¿¡æ¯ä¸­çš„æ•°æ®ç±»å‹æ ¡éªŒå®Œæ¯•ä»¥åï¼Œè¿™é˜¶æ®µå°±è¦å¯¹ç±»çš„æ–¹æ³•ä½“ï¼ˆClassæ–‡ä»¶ä¸­çš„Codeå±æ€§ï¼‰è¿›è¡Œæ ¡éªŒåˆ†æï¼Œä¿è¯è¢«æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„è¡Œä¸ºã€‚</p><p>ï¼ˆaï¼‰ä¿è¯ä»»æ„æ—¶åˆ»æ“ä½œæ•°æ ˆçš„æ•°æ®ç±»å‹ä¸æŒ‡ä»¤ä»£ç åºåˆ—éƒ½èƒ½é…åˆå·¥ä½œï¼Œä¾‹å¦‚ä¸ä¼šå‡ºç°ç±»ä¼¼äºâ€œåœ¨æ“ä½œæ ˆæ”¾ç½®äº†ä¸€ä¸ªintç±»å‹çš„æ•°æ®ï¼Œä½¿ç”¨æ—¶å´æŒ‰longç±»å‹æ¥åŠ è½½å…¥æœ¬åœ°å˜é‡è¡¨ä¸­â€è¿™æ ·çš„æƒ…å†µã€‚</p><p>ï¼ˆbï¼‰ä¿è¯ä»»ä½•è·³è½¬æŒ‡ä»¤éƒ½ä¸ä¼šè·³è½¬åˆ°æ–¹æ³•ä½“ä»¥å¤–çš„å­—èŠ‚ç æŒ‡ä»¤ä¸Šã€‚</p><p>ï¼ˆcï¼‰ä¿è¯æ–¹æ³•ä½“ä¸­çš„ç±»å‹è½¬æ¢æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¾‹å¦‚å¯ä»¥æŠŠä¸€ä¸ªå­ç±»å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»æ•°æ®ç±»å‹ï¼Œè¿™æ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯æŠŠçˆ¶ç±»å¯¹è±¡èµ‹å€¼ç»™å­ç±»æ•°æ®ç±»å‹ï¼Œç”šè‡³æŠŠå¯¹è±¡èµ‹å€¼ç»™ä¸å®ƒæ¯«æ— ç»§æ‰¿å…³ç³»ã€å®Œå…¨ä¸ç›¸å¹²çš„ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œåˆ™æ˜¯å±é™©å’Œä¸åˆæ³•çš„ã€‚</p><p>ï¼ˆdï¼‰â€¦â€¦ç­‰ç­‰ç­‰ç­‰</p><blockquote><p>JDK 6çš„HotSpotè™šæ‹Ÿæœºä¸­æä¾›äº†-XXï¼š-UseSplitVerifieré€‰é¡¹æ¥å…³é—­æ‰è¿™é¡¹ä¼˜åŒ–ï¼Œæˆ–è€…ä½¿ç”¨å‚æ•°<code>-XXï¼š+FailOverToOldVerifier</code>è¦æ±‚åœ¨ç±»å‹æ ¡éªŒå¤±è´¥çš„æ—¶å€™é€€å›åˆ°æ—§çš„ç±»å‹æ¨å¯¼æ–¹å¼è¿›è¡Œæ ¡éªŒã€‚è€Œåˆ°äº†JDK 7ä¹‹åï¼Œå°½ç®¡è™šæ‹Ÿæœºä¸­ä»ç„¶ä¿ç•™ç€ç±»å‹æ¨å¯¼éªŒè¯å™¨çš„ä»£ç ï¼Œä½†æ˜¯å¯¹äºä¸»ç‰ˆæœ¬å·å¤§äº50ï¼ˆå¯¹åº”JDK 6ï¼‰çš„Classæ–‡ä»¶ï¼Œä½¿ç”¨ç±»å‹æ£€æŸ¥æ¥å®Œæˆæ•°æ®æµåˆ†ææ ¡éªŒåˆ™æ˜¯å”¯ä¸€çš„é€‰æ‹©ï¼Œä¸å…è®¸å†é€€å›åˆ°åŸæ¥çš„ç±»å‹æ¨å¯¼çš„æ ¡éªŒæ–¹å¼ã€‚</p></blockquote><p>4ï¼‰ç¬¦å·å¼•ç”¨éªŒè¯</p><p>ç¬¦å·å¼•ç”¨éªŒè¯çš„ä¸»è¦ç›®çš„:</p><p>â€‹    ç¡®ä¿è§£æè¡Œä¸ºèƒ½æ­£å¸¸æ‰§è¡Œï¼Œå¦‚æœæ— æ³•é€šè¿‡ç¬¦å·å¼•ç”¨éªŒè¯ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª<code>java.lang.IncompatibleClassChangeError</code>çš„å­ç±»å¼‚å¸¸ï¼Œå…¸å‹çš„å¦‚ï¼š<code>java.lang.IllegalAccessError</code>ã€<code>java.lang.NoSuchFieldError</code>ã€<code>java.lang.NoSuchMethodError</code>ç­‰ã€‚</p><p>æœ€åä¸€ä¸ªé˜¶æ®µçš„æ ¡éªŒè¡Œä¸ºå‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨[æ’å›¾]çš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬åŒ–åŠ¨ä½œå°†åœ¨è¿æ¥çš„ç¬¬ä¸‰é˜¶æ®µâ€”â€”è§£æé˜¶æ®µä¸­å‘ç”Ÿã€‚</p><p>ç¬¦å·å¼•ç”¨éªŒè¯å¯ä»¥çœ‹ä½œæ˜¯å¯¹ç±»è‡ªèº«ä»¥å¤–ï¼ˆå¸¸é‡æ± ä¸­çš„å„ç§ç¬¦å·å¼•ç”¨ï¼‰çš„å„ç±»ä¿¡æ¯è¿›è¡ŒåŒ¹é…æ€§æ ¡éªŒï¼Œé€šä¿—æ¥è¯´å°±æ˜¯ï¼Œè¯¥ç±»æ˜¯å¦ç¼ºå°‘æˆ–è€…è¢«ç¦æ­¢è®¿é—®å®ƒä¾èµ–çš„æŸäº›å¤–éƒ¨ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰èµ„æºã€‚</p><p>æœ¬é˜¶æ®µé€šå¸¸éœ€è¦æ ¡éªŒä¸‹åˆ—å†…å®¹ï¼š</p><p>ï¼ˆaï¼‰ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦ä¸²æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±»ã€‚</p><p>ï¼ˆbï¼‰åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ–¹æ³•çš„å­—æ®µæè¿°ç¬¦åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µã€‚</p><p>ï¼ˆcï¼‰ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µã€æ–¹æ³•çš„å¯è®¿é—®æ€§ï¼ˆ<code>private</code>ã€<code>protected</code>ã€<code>public</code>ã€<code>&lt;package&gt;</code>ï¼‰æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—®ã€‚</p><p>ï¼ˆdï¼‰â€¦â€¦ç­‰ç­‰ç­‰ç­‰</p><blockquote><p>éªŒè¯é˜¶æ®µå¯¹äºè™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ã€ä½†å´ä¸æ˜¯å¿…é¡»è¦æ‰§è¡Œçš„é˜¶æ®µï¼Œå› ä¸ºéªŒè¯é˜¶æ®µåªæœ‰é€šè¿‡æˆ–è€…ä¸é€šè¿‡çš„å·®åˆ«ï¼Œåªè¦é€šè¿‡äº†éªŒè¯ï¼Œå…¶åå°±å¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰ä»»ä½•å½±å“äº†ã€‚å¦‚æœç¨‹åºè¿è¡Œçš„å…¨éƒ¨ä»£ç ï¼ˆåŒ…æ‹¬è‡ªå·±ç¼–å†™çš„ã€ç¬¬ä¸‰æ–¹åŒ…ä¸­çš„ã€ä»å¤–éƒ¨åŠ è½½çš„ã€åŠ¨æ€ç”Ÿæˆçš„ç­‰æ‰€æœ‰ä»£ç ï¼‰éƒ½å·²ç»è¢«åå¤ä½¿ç”¨å’ŒéªŒè¯è¿‡ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒçš„å®æ–½é˜¶æ®µå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨-Xverifyï¼šnoneå‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚</p></blockquote><h4 id="3-å‡†å¤‡"><a href="#3-å‡†å¤‡" class="headerlink" title="3 å‡†å¤‡"></a>3 å‡†å¤‡</h4><p>å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»ä¸­å®šä¹‰çš„å˜é‡ï¼ˆå³é™æ€å˜é‡ï¼Œè¢«staticä¿®é¥°çš„å˜é‡ï¼‰åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µã€‚</p><p>åœ¨JDK 7åŠä¹‹å‰ï¼ŒHotSpotä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºæ—¶ï¼Œè¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜éƒ½åº”å½“åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚</p><p>åœ¨JDK 8åŠä¹‹åï¼Œç±»å˜é‡åˆ™ä¼šéšç€Classå¯¹è±¡ä¸€èµ·å­˜æ”¾åœ¨Javaå †ä¸­ã€‚</p><p>æ³¨æ„ï¼š</p><p>ï¼ˆ1ï¼‰å‡†å¤‡é˜¶æ®µè¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡å°†ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨Javaå †ä¸­ã€‚</p><p>ï¼ˆ2ï¼‰åˆå§‹å€¼â€œé€šå¸¸æƒ…å†µâ€ä¸‹æ˜¯æ•°æ®ç±»å‹çš„é›¶å€¼ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span></code></pre><p>é‚£å˜é‡valueåœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º0è€Œä¸æ˜¯1234ï¼Œå› ä¸ºè¿™æ—¶å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•Javaæ–¹æ³•ï¼Œè€ŒæŠŠvalueèµ‹å€¼ä¸º123çš„putstaticæŒ‡ä»¤æ˜¯ç¨‹åºè¢«ç¼–è¯‘åï¼Œå­˜æ”¾äºç±»æ„é€ å™¨<clinit>()æ–¹æ³•ä¹‹ä¸­ï¼Œæ‰€ä»¥æŠŠvalueèµ‹å€¼ä¸º123çš„åŠ¨ä½œè¦åˆ°ç±»çš„åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šè¢«æ‰§è¡Œã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-clazz-load/jvm-class-load-initvalue.jpg" alt="åŸºæœ¬æ•°æ®ç±»å‹çš„é›¶å€¼"></p><p>ï¼ˆ3ï¼‰â€œç‰¹æ®Šæƒ…å†µâ€ä¸‹ï¼šå¦‚æœç±»å­—æ®µçš„å­—æ®µå±æ€§è¡¨ä¸­å­˜åœ¨ConstantValueå±æ€§ï¼Œé‚£åœ¨å‡†å¤‡é˜¶æ®µå˜é‡å€¼å°±ä¼šè¢«åˆå§‹åŒ–ä¸ºConstantValueå±æ€§æ‰€æŒ‡å®šçš„åˆå§‹å€¼ï¼Œ</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span></code></pre><p>ç¼–è¯‘æ—¶Javacå°†ä¼šä¸ºvalueç”ŸæˆConstantValueå±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µè™šæ‹Ÿæœºå°±ä¼šæ ¹æ®Con-stantValueçš„è®¾ç½®å°†valueèµ‹å€¼ä¸º123ã€‚</p><h4 id="4-è§£æ"><a href="#4-è§£æ" class="headerlink" title="4 è§£æ"></a>4 è§£æ</h4><p>è§£æé˜¶æ®µæ˜¯Javaè™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚</p><p>ä»€ä¹ˆæ˜¯ç¬¦å·å¼•ç”¨ï¼Ÿ</p><blockquote><p>ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ï¼šç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚</p><p>ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šæ˜¯å·²ç»åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜å½“ä¸­çš„å†…å®¹ã€‚</p><p>å„ç§è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€å¯ä»¥å„ä¸ç›¸åŒï¼Œä½†æ˜¯å®ƒä»¬èƒ½æ¥å—çš„ç¬¦å·å¼•ç”¨å¿…é¡»éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå› ä¸ºç¬¦å·å¼•ç”¨çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„Classæ–‡ä»¶æ ¼å¼ä¸­ã€‚</p><p>ç¬¦å·å¼•ç”¨ä»¥CONSTANT_Class_infoã€CONSTANT_Fieldref_infoã€CONSTANT_Methodref_infoç­‰ç±»å‹çš„å¸¸é‡å‡ºç°ã€‚</p></blockquote><p>ä»€ä¹ˆæ˜¯ç›´æ¥å¼•ç”¨ï¼Ÿ</p><blockquote><p>ç›´æ¥å¼•ç”¨ï¼ˆDirect Referencesï¼‰ï¼šç›´æ¥å¼•ç”¨æ˜¯å¯ä»¥ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–è€…æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚</p><p>ç›´æ¥å¼•ç”¨æ˜¯å’Œè™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›´æ¥ç›¸å…³çš„ï¼ŒåŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒè™šæ‹Ÿæœºå®ä¾‹ä¸Šç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¸€èˆ¬ä¸ä¼šç›¸åŒã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»åœ¨è™šæ‹Ÿæœºçš„å†…å­˜ä¸­å­˜åœ¨ã€‚</p></blockquote><p>è§£æé˜¶æ®µè¦æ±‚ï¼š</p><blockquote><p>è§£æé˜¶æ®µè¦æ±‚åœ¨æ‰§è¡Œane-warrayã€checkcastã€getfieldã€getstaticã€instanceofã€invokedynamicã€invokeinterfaceã€invoke-specialã€invokestaticã€invokevirtualã€ldcã€ldc_wã€ldc2_wã€multianewarrayã€newã€putfieldå’Œputstaticè¿™17ä¸ªç”¨äºæ“ä½œç¬¦å·å¼•ç”¨çš„å­—èŠ‚ç æŒ‡ä»¤ä¹‹å‰ï¼Œå…ˆå¯¹å®ƒä»¬æ‰€ä½¿ç”¨çš„ç¬¦å·å¼•ç”¨è¿›è¡Œè§£æã€‚</p><p>è™šæ‹Ÿæœºå®ç°å¯ä»¥æ ¹æ®éœ€è¦æ¥è‡ªè¡Œåˆ¤æ–­ï¼Œåˆ°åº•æ˜¯åœ¨ç±»è¢«åŠ è½½å™¨åŠ è½½æ—¶å°±å¯¹å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è¿›è¡Œè§£æï¼Œè¿˜æ˜¯ç­‰åˆ°ä¸€ä¸ªç¬¦å·å¼•ç”¨å°†è¦è¢«ä½¿ç”¨å‰æ‰å»è§£æå®ƒã€‚</p></blockquote><p>ç±»ä¼¼åœ°ï¼Œå¯¹æ–¹æ³•æˆ–è€…å­—æ®µçš„è®¿é—®ï¼Œä¹Ÿä¼šåœ¨è§£æé˜¶æ®µä¸­å¯¹å®ƒä»¬çš„å¯è®¿é—®æ€§ï¼ˆpublicã€protectedã€privateã€<package>ï¼‰è¿›è¡Œæ£€æŸ¥ã€‚</p><p>ç¬¦å·å¼•ç”¨è¯·æ±‚åŸºæœ¬å‡†åˆ™ï¼šä¸€æ¬¡æˆåŠŸï¼Œæ¬¡æ¬¡æˆåŠŸï¼›ä¸€æ¬¡å¤±è´¥ï¼Œæ¬¡æ¬¡å¤±è´¥ã€‚</p><blockquote><p>å¯¹åŒä¸€ä¸ªç¬¦å·å¼•ç”¨è¿›è¡Œå¤šæ¬¡è§£æè¯·æ±‚æ˜¯å¾ˆå¸¸è§çš„äº‹æƒ…ï¼Œé™¤<code>invokedynamic</code>æŒ‡ä»¤ä»¥å¤–ï¼Œè™šæ‹Ÿæœºå®ç°å¯ä»¥å¯¹ç¬¬ä¸€æ¬¡è§£æçš„ç»“æœè¿›è¡Œç¼“å­˜ï¼Œè­¬å¦‚åœ¨è¿è¡Œæ—¶ç›´æ¥å¼•ç”¨å¸¸é‡æ± ä¸­çš„è®°å½•ï¼Œå¹¶æŠŠå¸¸é‡æ ‡è¯†ä¸ºå·²è§£æçŠ¶æ€ï¼Œä»è€Œé¿å…è§£æåŠ¨ä½œé‡å¤è¿›è¡Œã€‚æ— è®ºæ˜¯å¦çœŸæ­£æ‰§è¡Œäº†å¤šæ¬¡è§£æåŠ¨ä½œï¼ŒJavaè™šæ‹Ÿæœºéƒ½éœ€è¦ä¿è¯çš„æ˜¯åœ¨åŒä¸€ä¸ªå®ä½“ä¸­ï¼Œå¦‚æœä¸€ä¸ªç¬¦å·å¼•ç”¨ä¹‹å‰å·²ç»è¢«æˆåŠŸè§£æè¿‡ï¼Œé‚£ä¹ˆåç»­çš„å¼•ç”¨è§£æè¯·æ±‚å°±åº”å½“ä¸€ç›´èƒ½å¤ŸæˆåŠŸï¼›åŒæ ·åœ°ï¼Œå¦‚æœç¬¬ä¸€æ¬¡è§£æå¤±è´¥äº†ï¼Œå…¶ä»–æŒ‡ä»¤å¯¹è¿™ä¸ªç¬¦å·çš„è§£æè¯·æ±‚ä¹Ÿåº”è¯¥æ”¶åˆ°ç›¸åŒçš„å¼‚å¸¸ï¼Œå“ªæ€•è¿™ä¸ªè¯·æ±‚çš„ç¬¦å·åœ¨åæ¥å·²æˆåŠŸåŠ è½½è¿›Javaè™šæ‹Ÿæœºå†…å­˜ä¹‹ä¸­ã€‚</p><p>å› ä¸ºinvokedynamicæŒ‡ä»¤çš„ç›®çš„æœ¬æ¥å°±æ˜¯ç”¨äºåŠ¨æ€è¯­è¨€æ”¯æŒï¼Œå®ƒå¯¹åº”çš„å¼•ç”¨ç§°ä¸ºâ€œåŠ¨æ€è°ƒç”¨ç‚¹é™å®šç¬¦ï¼ˆDynamically-Computed Call Site Specifierï¼‰â€ï¼Œè¿™é‡Œâ€œåŠ¨æ€â€çš„å«ä¹‰æ˜¯æŒ‡å¿…é¡»ç­‰åˆ°ç¨‹åºå®é™…è¿è¡Œåˆ°è¿™æ¡æŒ‡ä»¤æ—¶ï¼Œè§£æåŠ¨ä½œæ‰èƒ½è¿›è¡Œã€‚ç›¸å¯¹åœ°ï¼Œå…¶ä½™å¯è§¦å‘è§£æçš„æŒ‡ä»¤éƒ½æ˜¯â€œé™æ€â€çš„ï¼Œå¯ä»¥åœ¨åˆšåˆšå®ŒæˆåŠ è½½é˜¶æ®µï¼Œè¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œä»£ç æ—¶å°±æå‰è¿›è¡Œè§£æã€‚</p></blockquote><p>è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦è¿™7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œï¼Œåˆ†åˆ«å¯¹åº”äºå¸¸é‡æ± çš„</p><p><code>CONSTANT_Class_info</code>(ç±»)ã€</p><p><code>CON-STANT_Fieldref_info</code>ï¼ˆå­—æ®µï¼‰ã€</p><p><code>CONSTANT_Methodref_info</code>ï¼ˆæ–¹æ³•ï¼‰ã€</p><p><code>CONSTANT_InterfaceMethodref_info</code>ï¼ˆæ¥å£æ–¹æ³•ï¼‰ã€<code>CONSTANT_MethodType_info</code>ã€<code>CONSTANT_MethodHandle_info</code>ã€<code>CONSTANT_Dyna-mic_info</code>å’Œ<code>CONSTANT_InvokeDynamic_info</code> 8ç§å¸¸é‡ç±»å‹ã€‚</p><p>å‰4ç§å¸¸é‡ç±»å‹è§£æ<a href="/images/jvm-clazz-load/jiexi-details.txt">jiexi_Details.txt</a></p><h4 id="5-åˆå§‹åŒ–"><a href="#5-åˆå§‹åŒ–" class="headerlink" title="5 åˆå§‹åŒ–"></a>5 åˆå§‹åŒ–</h4><p>ç±»çš„åˆå§‹åŒ–é˜¶æ®µæ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€ä¸ªæ­¥éª¤ï¼Œä¹‹å‰ä»‹ç»çš„å‡ ä¸ªç±»åŠ è½½çš„åŠ¨ä½œé‡Œï¼Œé™¤äº†åœ¨åŠ è½½é˜¶æ®µç”¨æˆ·åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„æ–¹å¼å±€éƒ¨å‚ä¸å¤–ï¼Œå…¶ä½™åŠ¨ä½œéƒ½å®Œå…¨ç”±Javaè™šæ‹Ÿæœºæ¥ä¸»å¯¼æ§åˆ¶ã€‚ç›´åˆ°åˆå§‹åŒ–é˜¶æ®µï¼ŒJavaè™šæ‹Ÿæœºæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­ç¼–å†™çš„Javaç¨‹åºä»£ç ï¼Œå°†ä¸»å¯¼æƒç§»äº¤ç»™åº”ç”¨ç¨‹åºã€‚</p><p>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œç±»æ„é€ å™¨<code>&lt;clinit&gt;()</code>æ–¹æ³•çš„è¿‡ç¨‹ã€‚<code>&lt;clinit&gt;()</code>æ˜¯Javacç¼–è¯‘å™¨çš„è‡ªåŠ¨ç”Ÿæˆç‰©ã€‚</p><p>ï¼ˆ1ï¼‰<code>&lt;clinit&gt;()</code>æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—ï¼ˆstatic{}å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºå†³å®šçš„ï¼Œé™æ€è¯­å¥å—ä¸­åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥å—å¯ä»¥èµ‹å€¼ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®ã€‚</p><p>ï¼ˆ2ï¼‰<code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸ç±»çš„æ„é€ å‡½æ•°ï¼ˆå³åœ¨è™šæ‹Ÿæœºè§†è§’ä¸­çš„å®ä¾‹æ„é€ å™¨<code>&lt;init&gt;()</code>æ–¹æ³•ï¼‰ä¸åŒï¼Œå®ƒä¸éœ€è¦æ˜¾å¼åœ°è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼ŒJavaè™šæ‹Ÿæœºä¼šä¿è¯åœ¨å­ç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚å› æ­¤åœ¨Javaè™šæ‹Ÿæœºä¸­ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„<code>&lt;clinit&gt;()</code>æ–¹æ³•çš„ç±»å‹è‚¯å®šæ˜¯java.lang.Objectã€‚</p><p> ç”±äºçˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•å…ˆæ‰§è¡Œï¼Œä¹Ÿå°±æ„å‘³ç€çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€è¯­å¥å—è¦ä¼˜å…ˆäºå­ç±»çš„å˜é‡èµ‹å€¼æ“ä½œã€‚å¦‚ä¸‹ä»£ç æ¸…å•ä¸­ï¼Œå­—æ®µBçš„å€¼å°†ä¼šæ˜¯2è€Œä¸æ˜¯1ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zzy<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>clazzload<span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> A <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        A <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Sub</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> B <span class="token operator">=</span> A<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ï¼ˆ3ï¼‰<code>&lt;clinit&gt;()</code>æ–¹æ³•å¯¹äºç±»æˆ–æ¥å£æ¥è¯´å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰é™æ€è¯­å¥å—ï¼Œä¹Ÿæ²¡æœ‰å¯¹å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿæˆ<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚</p><p>ï¼ˆ4ï¼‰æ¥å£ä¸­ä¸èƒ½ä½¿ç”¨é™æ€è¯­å¥å—ï¼Œä½†ä»ç„¶æœ‰å˜é‡åˆå§‹åŒ–çš„èµ‹å€¼æ“ä½œï¼Œå› æ­¤æ¥å£ä¸ç±»ä¸€æ ·éƒ½ä¼šç”Ÿæˆ<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚æ¥å£ä¸ç±»ä¸åŒçš„æ˜¯ï¼Œæ‰§è¡Œæ¥å£çš„<clinit>()æ–¹æ³•ä¸éœ€è¦å…ˆæ‰§è¡Œçˆ¶æ¥å£çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ï¼Œå› ä¸ºåªæœ‰å½“çˆ¶æ¥å£ä¸­å®šä¹‰çš„å˜é‡è¢«ä½¿ç”¨æ—¶ï¼Œçˆ¶æ¥å£æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚æ­¤å¤–ï¼Œæ¥å£çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¸€æ ·ä¸ä¼šæ‰§è¡Œæ¥å£çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚</p><p>ï¼ˆ5ï¼‰Javaè™šæ‹Ÿæœºå¿…é¡»ä¿è¯ä¸€ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«æ­£ç¡®åœ°åŠ é”åŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å»åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆåªä¼šæœ‰å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹éƒ½éœ€è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œå®Œæ¯•<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚å¦‚æœåœ¨ä¸€ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸­æœ‰è€—æ—¶å¾ˆé•¿çš„æ“ä½œï¼Œé‚£å°±å¯èƒ½é€ æˆå¤šä¸ªè¿›ç¨‹é˜»å¡[æ’å›¾]ï¼Œåœ¨å®é™…åº”ç”¨ä¸­è¿™ç§é˜»å¡å¾€å¾€æ˜¯å¾ˆéšè”½çš„ã€‚ä¸‹é¢çš„ä»£ç æ¸…å•æ¼”ç¤ºäº†è¿™ç§åœºæ™¯</p><pre class=" language-java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DeadLoopClass</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å¦‚æœä¸åŠ ä¸Šè¿™ä¸ªifè¯­å¥ï¼Œç¼–è¯‘å™¨å°†æç¤ºâ€œInitializer does not complete normallyâ€</span>           å¹¶æ‹’ç»ç¼–è¯‘        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"init DeadLoopClass"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Runnable script <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            DeadLoopClass dlc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeadLoopClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" run over"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    Thread thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>    Thread thread2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>    thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    thread2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œä¸€æ¡çº¿ç¨‹åœ¨æ­»å¾ªç¯ä»¥æ¨¡æ‹Ÿé•¿æ—¶é—´æ“ä½œï¼Œå¦å¤–ä¸€æ¡çº¿ç¨‹åœ¨é˜»å¡ç­‰å¾…ï¼š</p><pre class=" language-txt"><code class="language-txt">Thread[Thread-0,5,main]startThread[Thread-1,5,main]startThread[Thread-0,5,main]init DeadLoopClass</code></pre><h3 id="ä¸‰ã€ç±»åŠ è½½å™¨"><a href="#ä¸‰ã€ç±»åŠ è½½å™¨" class="headerlink" title="ä¸‰ã€ç±»åŠ è½½å™¨"></a>ä¸‰ã€ç±»åŠ è½½å™¨</h3><h4 id="1ã€ç±»çš„æ¯”è¾ƒ"><a href="#1ã€ç±»çš„æ¯”è¾ƒ" class="headerlink" title="1ã€ç±»çš„æ¯”è¾ƒ"></a>1ã€ç±»çš„æ¯”è¾ƒ</h4><p>æ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦â€œç›¸ç­‰â€ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰ï¼Œå¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªJavaè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ã€‚</p><p>â€œç›¸ç­‰â€ï¼šåŒ…æ‹¬ä»£è¡¨ç±»çš„Classå¯¹è±¡çš„equals()æ–¹æ³•ã€isAssignableFrom()æ–¹æ³•ã€isInstance()æ–¹æ³•çš„è¿”å›ç»“æœï¼Œä¹ŸåŒ…æ‹¬äº†ä½¿ç”¨instanceofå…³é”®å­—åšå¯¹è±¡æ‰€å±å…³ç³»åˆ¤å®šç­‰å„ç§æƒ…å†µã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zzy<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>clazzload<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * ç±»åŠ è½½å™¨ä¸instanceofå…³é”®å­—æ¼”ç¤º * */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassLoaderTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>        ClassLoader myLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">loadClass</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token keyword">throws</span> ClassNotFoundException <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    String fileName <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".class"</span><span class="token punctuation">;</span>                    InputStream is <span class="token operator">=</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>is <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>is<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    is<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        Object obj <span class="token operator">=</span> myLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"com.zzy.demo.clazzload.ClassLoaderTest"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">com<span class="token punctuation">.</span>zzy<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>clazzload<span class="token punctuation">.</span>ClassLoaderTest</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œç»“æœ:</p><pre class=" language-txt"><code class="language-txt">class com.zzy.demo.clazzload.ClassLoaderTestfalse</code></pre><p>å› ä¸ºJavaè™šæ‹Ÿæœºä¸­åŒæ—¶å­˜åœ¨äº†ä¸¤ä¸ªClassLoaderTestç±»ï¼Œä¸€ä¸ªæ˜¯ç”±è™šæ‹Ÿæœºçš„åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ç”±æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œè™½ç„¶å®ƒä»¬éƒ½æ¥è‡ªåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œä½†åœ¨Javaè™šæ‹Ÿæœºä¸­ä»ç„¶æ˜¯ä¸¤ä¸ªäº’ç›¸ç‹¬ç«‹çš„ç±»ï¼Œåšå¯¹è±¡æ‰€å±ç±»å‹æ£€æŸ¥æ—¶çš„ç»“æœè‡ªç„¶ä¸ºfalseã€‚</p><h4 id="2ã€åŒäº²å§”æ´¾æ¨¡å‹"><a href="#2ã€åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="2ã€åŒäº²å§”æ´¾æ¨¡å‹"></a>2ã€åŒäº²å§”æ´¾æ¨¡å‹</h4><p>è‡ªJDK 1.2ä»¥æ¥ï¼ŒJavaä¸€ç›´ä¿æŒç€ä¸‰å±‚ç±»åŠ è½½å™¨ã€åŒäº²å§”æ´¾çš„ç±»åŠ è½½æ¶æ„ã€‚</p><p>3ä¸ªç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨ï¼š</p><p>ï¼ˆ1ï¼‰å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap Class Loaderï¼‰</p><p>è´Ÿè´£åŠ è½½å­˜æ”¾åœ¨<JAVA_HOME>\libç›®å½•ï¼Œæˆ–è€…è¢«-Xbootclasspathå‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­å­˜æ”¾çš„ï¼Œè€Œä¸”æ˜¯Javaè™šæ‹Ÿæœºèƒ½å¤Ÿè¯†åˆ«çš„ï¼ˆæŒ‰ç…§æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚rt.jarã€tools.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨libç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºçš„å†…å­˜ä¸­ã€‚</p><p>å¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•è¢«Javaç¨‹åºç›´æ¥å¼•ç”¨ï¼Œç”¨æˆ·åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœéœ€è¦æŠŠåŠ è½½è¯·æ±‚å§”æ´¾ç»™å¼•å¯¼ç±»åŠ è½½å™¨å»å¤„ç†ï¼Œé‚£ç›´æ¥ä½¿ç”¨nullä»£æ›¿å³å¯ã€‚</p><p>ClassLoader.getClassLoader()æ–¹æ³•çš„ä»£ç ç‰‡æ®µï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**Returns the class loader for the class.  Some implementations may use null to represent the bootstrap class loader. This method will return  null in such implementations if this class was loaded by the bootstrap class loader.*/</span><span class="token keyword">public</span> ClassLoader <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    ClassLoader cl <span class="token operator">=</span> <span class="token function">getClassLoader0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cl <span class="token operator">==</span> null<span class="token punctuation">)</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    SecurityManager sm <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sm <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ClassLoader ccl <span class="token operator">=</span> ClassLoader<span class="token punctuation">.</span><span class="token function">getCallerClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ccl <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> ccl <span class="token operator">!=</span> cl <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>cl<span class="token punctuation">.</span><span class="token function">isAncestor</span><span class="token punctuation">(</span>ccl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            sm<span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span>SecurityConstants<span class="token punctuation">.</span>GET_CLASSLOADER_PERMISSION<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> cl<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ï¼ˆ2ï¼‰æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension Class Loaderï¼‰</p><p>è¿™ä¸ªç±»åŠ è½½å™¨æ˜¯åœ¨ç±»sun.misc.Launcher$ExtClassLoaderä¸­ä»¥Javaä»£ç çš„å½¢å¼å®ç°çš„ã€‚å®ƒè´Ÿè´£åŠ è½½<JAVA_HOME>\lib\extç›®å½•ä¸­ï¼Œæˆ–è€…è¢«java.ext.dirsç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­æ‰€æœ‰çš„ç±»åº“ã€‚</p><p>å¼€å‘ä¸­å¯ä»¥ç›´æ¥åœ¨ç¨‹åºä¸­ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨æ¥åŠ è½½Classæ–‡ä»¶ã€‚</p><p>ï¼ˆ3ï¼‰åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication Class Loaderï¼‰</p><p>è¿™ä¸ªç±»åŠ è½½å™¨ç”±sun.misc.Launcher$AppClassLoaderæ¥å®ç°ã€‚ç”±äºåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ˜¯ClassLoaderç±»ä¸­çš„getSystem-ClassLoader()æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥æœ‰äº›åœºåˆä¸­ä¹Ÿç§°å®ƒä¸ºâ€œç³»ç»Ÿç±»åŠ è½½å™¨â€ã€‚</p><p>å®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šæ‰€æœ‰çš„ç±»åº“ï¼Œå¼€å‘è€…åŒæ ·å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ã€‚</p><p>å¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-clazz-load/jvm-class-load-classLoader.jpg" alt="ç±»åŠ è½½å™¨åŒäº²å§”æ´¾æ¨¡å‹"></p><p>JDK 9ä¹‹å‰çš„Javaåº”ç”¨éƒ½æ˜¯ç”±è¿™ä¸‰ç§ç±»åŠ è½½å™¨äº’ç›¸é…åˆæ¥å®ŒæˆåŠ è½½çš„ï¼Œå¦‚æœç”¨æˆ·è®¤ä¸ºæœ‰å¿…è¦ï¼Œè¿˜å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ¥è¿›è¡Œæ‹“å±•ï¼Œå…¸å‹çš„å¦‚å¢åŠ é™¤äº†ç£ç›˜ä½ç½®ä¹‹å¤–çš„Classæ–‡ä»¶æ¥æºï¼Œæˆ–è€…é€šè¿‡ç±»åŠ è½½å™¨å®ç°ç±»çš„éš”ç¦»ã€é‡è½½ç­‰åŠŸèƒ½ã€‚</p><p>å›¾ä¸­ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è¢«ç§°ä¸ºç±»åŠ è½½å™¨çš„â€œåŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParents Delegation Modelï¼‰â€ã€‚</p><p>åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚ä¸è¿‡è¿™é‡Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬ä¸æ˜¯ä»¥ç»§æ‰¿ï¼ˆInheritanceï¼‰çš„å…³ç³»æ¥å®ç°çš„ï¼Œè€Œæ˜¯é€šå¸¸ä½¿ç”¨ç»„åˆï¼ˆCompositionï¼‰å…³ç³»æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç ã€‚</p><p>åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹ï¼š</p><blockquote><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°æœ€é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»å®ŒæˆåŠ è½½ã€‚</p></blockquote><p>åŒäº²å§”æ´¾æ¨¡å‹çš„å®ç°:</p><pre class=" language-java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">synchronized</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">loadClass</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> <span class="token keyword">boolean</span> resolve<span class="token punctuation">)</span> <span class="token keyword">throws</span> ClassNotFoundException<span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡äº†</span>    Class <span class="token class-name">c</span> <span class="token operator">=</span> <span class="token function">findLoadedClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            c <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            c <span class="token operator">=</span> <span class="token function">findBootstrapClassOrNull</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// å¦‚æœçˆ¶ç±»åŠ è½½å™¨æŠ›å‡ºClassNotFoundException</span>            <span class="token comment" spellcheck="true">// è¯´æ˜çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶</span>            <span class="token comment" spellcheck="true">// å†è°ƒç”¨æœ¬èº«çš„findClassæ–¹æ³•æ¥è¿›è¡Œç±»åŠ è½½</span>            c <span class="token operator">=</span> <span class="token function">findClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">resolveClass</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> c<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>è¿™æ®µä»£ç çš„é€»è¾‘ï¼š</p><p>å…ˆæ£€æŸ¥è¯·æ±‚åŠ è½½çš„ç±»å‹æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ï¼Œè‹¥æ²¡æœ‰åˆ™è°ƒç”¨çˆ¶åŠ è½½å™¨çš„loadClass()æ–¹æ³•ï¼Œè‹¥çˆ¶åŠ è½½å™¨ä¸ºç©ºåˆ™é»˜è®¤ä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨ä½œä¸ºçˆ¶åŠ è½½å™¨ã€‚å‡å¦‚çˆ¶ç±»åŠ è½½å™¨åŠ è½½å¤±è´¥ï¼ŒæŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸çš„è¯ï¼Œæ‰è°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•å°è¯•è¿›è¡ŒåŠ è½½ã€‚</p><h4 id="3ã€ç ´ååŒäº²å§”æ´¾æ¨¡å‹"><a href="#3ã€ç ´ååŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="3ã€ç ´ååŒäº²å§”æ´¾æ¨¡å‹"></a>3ã€ç ´ååŒäº²å§”æ´¾æ¨¡å‹</h4><p>åŒäº²å§”æ´¾æ¨¡å‹ä¸»è¦å‡ºç°è¿‡3æ¬¡è¾ƒå¤§è§„æ¨¡â€œè¢«ç ´åâ€çš„æƒ…å†µã€‚</p><p>ç¬¬ä¸€æ¬¡ï¼š</p><p>å‘ç”Ÿåœ¨åŒäº²å§”æ´¾æ¨¡å‹å‡ºç°ä¹‹å‰â€”â€”å³JDK 1.2é¢ä¸–ä»¥å‰çš„â€œè¿œå¤â€æ—¶ä»£ã€‚</p><p>ç±»åŠ è½½å™¨çš„æ¦‚å¿µå’ŒæŠ½è±¡ç±»java.lang.ClassLoaderåˆ™åœ¨Javaçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸­å°±å·²ç»å­˜åœ¨ï¼Œé¢å¯¹å·²ç»å­˜åœ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„ä»£ç ï¼ŒJavaè®¾è®¡è€…ä»¬å¼•å…¥åŒäº²å§”æ´¾æ¨¡å‹æ—¶ä¸å¾—ä¸åšå‡ºä¸€äº›å¦¥åï¼Œä¸ºäº†å…¼å®¹è¿™äº›å·²æœ‰ä»£ç ï¼Œæ— æ³•å†ä»¥æŠ€æœ¯æ‰‹æ®µé¿å…loadClass()è¢«å­ç±»è¦†ç›–çš„å¯èƒ½æ€§ï¼Œåªèƒ½åœ¨JDK 1.2ä¹‹åçš„java.lang.ClassLoaderä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„protectedæ–¹æ³•findClass()ï¼Œå¹¶å¼•å¯¼ç”¨æˆ·ç¼–å†™çš„ç±»åŠ è½½é€»è¾‘æ—¶å°½å¯èƒ½å»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨loadClass()ä¸­ç¼–å†™ä»£ç ã€‚</p><p>æŒ‰ç…§ä¸Šé¢loadClass()æ–¹æ³•ï¼ŒåŒäº²å§”æ´¾çš„å…·ä½“é€»è¾‘å°±å®ç°åœ¨è¿™é‡Œé¢ï¼ŒæŒ‰ç…§loadClass()æ–¹æ³•çš„é€»è¾‘ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å¤±è´¥ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•æ¥å®ŒæˆåŠ è½½ï¼Œè¿™æ ·æ—¢ä¸å½±å“ç”¨æˆ·æŒ‰ç…§è‡ªå·±çš„æ„æ„¿å»åŠ è½½ç±»ï¼Œåˆå¯ä»¥ä¿è¯æ–°å†™å‡ºæ¥çš„ç±»åŠ è½½å™¨æ˜¯ç¬¦åˆåŒäº²å§”æ´¾è§„åˆ™çš„ã€‚</p><p>ç¬¬äºŒæ¬¡ï¼š</p><p>æ˜¯ç”±è¿™ä¸ªæ¨¡å‹è‡ªèº«çš„ç¼ºé™·å¯¼è‡´çš„ï¼ŒåŒäº²å§”æ´¾å¾ˆå¥½åœ°è§£å†³äº†å„ä¸ªç±»åŠ è½½å™¨åä½œæ—¶åŸºç¡€ç±»å‹çš„ä¸€è‡´æ€§é—®é¢˜ï¼ˆè¶ŠåŸºç¡€çš„ç±»ç”±è¶Šä¸Šå±‚çš„åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼‰ï¼ŒåŸºç¡€ç±»å‹ä¹‹æ‰€ä»¥è¢«ç§°ä¸ºâ€œåŸºç¡€â€ï¼Œæ˜¯å› ä¸ºå®ƒä»¬æ€»æ˜¯ä½œä¸ºè¢«ç”¨æˆ·ä»£ç ç»§æ‰¿ã€è°ƒç”¨çš„APIå­˜åœ¨ï¼Œä½†ç¨‹åºè®¾è®¡å¾€å¾€æ²¡æœ‰ç»å¯¹ä¸å˜çš„å®Œç¾è§„åˆ™ï¼Œå¦‚æœæœ‰åŸºç¡€ç±»å‹åˆè¦è°ƒç”¨å›ç”¨æˆ·çš„ä»£ç ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ä¾¿æ˜¯JNDIæœåŠ¡ï¼ŒJNDIç°åœ¨å·²ç»æ˜¯Javaçš„æ ‡å‡†æœåŠ¡ï¼Œå®ƒçš„ä»£ç ç”±å¯åŠ¨ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ï¼ˆåœ¨JDK1.3æ—¶åŠ å…¥åˆ°rt.jarçš„ï¼‰ï¼Œè‚¯å®šå±äºJavaä¸­å¾ˆåŸºç¡€çš„ç±»å‹äº†ã€‚ä½†JNDIå­˜åœ¨çš„ç›®çš„å°±æ˜¯å¯¹èµ„æºè¿›è¡ŒæŸ¥æ‰¾å’Œé›†ä¸­ç®¡ç†ï¼Œå®ƒéœ€è¦è°ƒç”¨ç”±å…¶ä»–å‚å•†å®ç°å¹¶éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„ClassPathä¸‹çš„JNDIæœåŠ¡æä¾›è€…æ¥å£ï¼ˆService ProviderInterfaceï¼ŒSPIï¼‰çš„ä»£ç ï¼Œç°åœ¨é—®é¢˜æ¥äº†ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨æ˜¯ç»ä¸å¯èƒ½è®¤è¯†ã€åŠ è½½è¿™äº›ä»£ç çš„ï¼Œé‚£è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>Javaçš„è®¾è®¡å›¢é˜Ÿåªå¥½å¼•å…¥äº†ä¸€ä¸ªä¸å¤ªä¼˜é›…çš„è®¾è®¡ï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆThread Context ClassLoaderï¼‰ã€‚è¿™ä¸ªç±»åŠ è½½å™¨å¯ä»¥é€šè¿‡java.lang.Threadç±»çš„setContext-ClassLoader()æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœåˆ›å»ºçº¿ç¨‹æ—¶è¿˜æœªè®¾ç½®ï¼Œå®ƒå°†ä¼šä»çˆ¶çº¿ç¨‹ä¸­ç»§æ‰¿ä¸€ä¸ªï¼Œå¦‚æœåœ¨åº”ç”¨ç¨‹åºçš„å…¨å±€èŒƒå›´å†…éƒ½æ²¡æœ‰è®¾ç½®è¿‡çš„è¯ï¼Œé‚£è¿™ä¸ªç±»åŠ è½½å™¨é»˜è®¤å°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚æœ‰äº†çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œç¨‹åºå°±å¯ä»¥åšä¸€äº›â€œèˆå¼Šâ€çš„äº‹æƒ…äº†ã€‚JNDIæœåŠ¡ä½¿ç”¨è¿™ä¸ªçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å»åŠ è½½æ‰€éœ€çš„SPIæœåŠ¡ä»£ç ï¼Œè¿™æ˜¯ä¸€ç§çˆ¶ç±»åŠ è½½å™¨å»è¯·æ±‚å­ç±»åŠ è½½å™¨å®Œæˆç±»åŠ è½½çš„è¡Œä¸ºï¼Œè¿™ç§è¡Œä¸ºå®é™…ä¸Šæ˜¯æ‰“é€šäº†åŒäº²å§”æ´¾æ¨¡å‹çš„å±‚æ¬¡ç»“æ„æ¥é€†å‘ä½¿ç”¨ç±»åŠ è½½å™¨ï¼Œå·²ç»è¿èƒŒäº†åŒäº²å§”æ´¾æ¨¡å‹çš„ä¸€èˆ¬æ€§åŸåˆ™ï¼Œä½†ä¹Ÿæ˜¯æ— å¯å¥ˆä½•çš„äº‹æƒ…ã€‚Javaä¸­æ¶‰åŠSPIçš„åŠ è½½åŸºæœ¬ä¸Šéƒ½é‡‡ç”¨è¿™ç§æ–¹å¼æ¥å®Œæˆï¼Œä¾‹å¦‚JNDIã€JDBCã€JCEã€JAXBå’ŒJBIç­‰ã€‚ä¸è¿‡ï¼Œå½“SPIçš„æœåŠ¡æä¾›è€…å¤šäºä¸€ä¸ªçš„æ—¶å€™ï¼Œä»£ç å°±åªèƒ½æ ¹æ®å…·ä½“æä¾›è€…çš„ç±»å‹æ¥ç¡¬ç¼–ç åˆ¤æ–­ï¼Œä¸ºäº†æ¶ˆé™¤è¿™ç§æä¸ä¼˜é›…çš„å®ç°æ–¹å¼ï¼Œåœ¨JDK 6æ—¶ï¼ŒJDKæä¾›äº†java.util.ServiceLoaderç±»ï¼Œä»¥META-INF/servicesä¸­çš„é…ç½®ä¿¡æ¯ï¼Œè¾…ä»¥è´£ä»»é“¾æ¨¡å¼ï¼Œè¿™æ‰ç®—æ˜¯ç»™SPIçš„åŠ è½½æä¾›äº†ä¸€ç§ç›¸å¯¹åˆç†çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>ç¬¬ä¸‰æ¬¡ï¼š</p><p>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸‰æ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±äºç”¨æˆ·å¯¹ç¨‹åºåŠ¨æ€æ€§çš„è¿½æ±‚è€Œå¯¼è‡´çš„ï¼Œè¿™é‡Œæ‰€è¯´çš„â€œåŠ¨æ€æ€§â€æŒ‡çš„æ˜¯ä¸€äº›éå¸¸â€œçƒ­â€é—¨çš„åè¯ï¼šä»£ç çƒ­æ›¿æ¢ï¼ˆHot Swapï¼‰ã€æ¨¡å—çƒ­éƒ¨ç½²ï¼ˆHot Deploymentï¼‰ç­‰ã€‚è¯´ç™½äº†å°±æ˜¯å¸Œæœ›Javaåº”ç”¨ç¨‹åºèƒ½åƒæˆ‘ä»¬çš„ç”µè„‘å¤–è®¾é‚£æ ·ï¼Œæ¥ä¸Šé¼ æ ‡ã€Uç›˜ï¼Œä¸ç”¨é‡å¯æœºå™¨å°±èƒ½ç«‹å³ä½¿ç”¨ï¼Œé¼ æ ‡æœ‰é—®é¢˜æˆ–è¦å‡çº§å°±æ¢ä¸ªé¼ æ ‡ï¼Œä¸ç”¨å…³æœºä¹Ÿä¸ç”¨é‡å¯ã€‚å¯¹äºä¸ªäººç”µè„‘æ¥è¯´ï¼Œé‡å¯ä¸€æ¬¡å…¶å®æ²¡æœ‰ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œä½†å¯¹äºä¸€äº›ç”Ÿäº§ç³»ç»Ÿæ¥è¯´ï¼Œå…³æœºé‡å¯ä¸€æ¬¡å¯èƒ½å°±è¦è¢«åˆ—ä¸ºç”Ÿäº§äº‹æ•…ï¼Œè¿™ç§æƒ…å†µä¸‹çƒ­éƒ¨ç½²å°±å¯¹è½¯ä»¶å¼€å‘è€…ï¼Œå°¤å…¶æ˜¯å¤§å‹ç³»ç»Ÿæˆ–ä¼ä¸šçº§è½¯ä»¶å¼€å‘è€…å…·æœ‰å¾ˆå¤§çš„å¸å¼•åŠ›ã€‚</p><blockquote><p>æ—©åœ¨2008å¹´ï¼Œåœ¨Javaç¤¾åŒºå…³äºæ¨¡å—åŒ–è§„èŒƒçš„ç¬¬ä¸€åœºæˆ˜å½¹é‡Œï¼Œç”±Sun/Oracleå…¬å¸æ‰€æå‡ºçš„JSR-294[æ’å›¾]ã€JSR-277[æ’å›¾]è§„èŒƒææ¡ˆå°±æ›¾è´¥ç»™ä»¥IBMå…¬å¸ä¸»å¯¼çš„JSR-291ï¼ˆå³OSGi R4.2ï¼‰ææ¡ˆã€‚å°½ç®¡Sun/Oracleå¹¶ä¸ç”˜å¿ƒå°±æ­¤å¤±å»Javaæ¨¡å—åŒ–çš„ä¸»å¯¼æƒï¼Œéšå³åˆå†æ‹¿å‡ºJigsawé¡¹ç›®è¿æˆ˜ï¼Œä½†æ­¤æ—¶OSGiå·²ç»ç«™ç¨³è„šè·Ÿï¼Œæˆä¸ºä¸šç•Œâ€œäº‹å®ä¸Šâ€çš„Javaæ¨¡å—åŒ–æ ‡å‡†[æ’å›¾]ã€‚æ›¾ç»åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ï¼ŒIBMå‡­å€Ÿç€OSGiå¹¿æ³›åº”ç”¨åŸºç¡€è®©Jigsawåƒå°½è‹¦å¤´ï¼Œå…¶å½±å“ä¸€ç›´æŒç»­åˆ°JigsawéšJDK 9é¢ä¸–æ‰ç®—å‘Šä¸€æ®µè½ã€‚è€Œä¸”å³ä½¿Jigsawç°åœ¨å·²ç»æ˜¯Javaçš„æ ‡å‡†åŠŸèƒ½äº†ï¼Œå®ƒä»éœ€å°å¿ƒç¿¼ç¿¼åœ°é¿å¼€OSGiè¿è¡ŒæœŸåŠ¨æ€çƒ­éƒ¨ç½²ä¸Šçš„ä¼˜åŠ¿ï¼Œä»…å±€é™äºé™æ€åœ°è§£å†³æ¨¡å—é—´å°è£…éš”ç¦»å’Œè®¿é—®æ§åˆ¶çš„é—®é¢˜</p></blockquote><p>OSGiæ˜¯å¦‚ä½•é€šè¿‡ç±»åŠ è½½å™¨å®ç°çƒ­éƒ¨ç½²ï¼Ÿ</p><p>OSGiå®ç°æ¨¡å—åŒ–çƒ­éƒ¨ç½²çš„å…³é”®æ˜¯å®ƒè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æœºåˆ¶çš„å®ç°ï¼Œæ¯ä¸€ä¸ªç¨‹åºæ¨¡å—ï¼ˆOSGiä¸­ç§°ä¸ºBundleï¼‰éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå½“éœ€è¦æ›´æ¢ä¸€ä¸ªBundleæ—¶ï¼Œå°±æŠŠBundleè¿åŒç±»åŠ è½½å™¨ä¸€èµ·æ¢æ‰ä»¥å®ç°ä»£ç çš„çƒ­æ›¿æ¢ã€‚åœ¨OSGiç¯å¢ƒä¸‹ï¼Œç±»åŠ è½½å™¨ä¸å†åŒäº²å§”æ´¾æ¨¡å‹æ¨èçš„æ ‘çŠ¶ç»“æ„ï¼Œè€Œæ˜¯è¿›ä¸€æ­¥å‘å±•ä¸ºæ›´åŠ å¤æ‚çš„ç½‘çŠ¶ç»“æ„ï¼Œå½“æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼ŒOSGiå°†æŒ‰ç…§ä¸‹é¢çš„é¡ºåºè¿›è¡Œç±»æœç´¢ï¼š<br>1ï¼‰å°†ä»¥<code>java.*</code>å¼€å¤´çš„ç±»ï¼Œå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€‚<br>2ï¼‰å¦åˆ™ï¼Œå°†å§”æ´¾åˆ—è¡¨åå•å†…çš„ç±»ï¼Œå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€‚<br>3ï¼‰å¦åˆ™ï¼Œå°†Importåˆ—è¡¨ä¸­çš„ç±»ï¼Œå§”æ´¾ç»™Exportè¿™ä¸ªç±»çš„Bundleçš„ç±»åŠ è½½å™¨åŠ è½½ã€‚<br>4ï¼‰å¦åˆ™ï¼ŒæŸ¥æ‰¾å½“å‰Bundleçš„ClassPathï¼Œä½¿ç”¨è‡ªå·±çš„ç±»åŠ è½½å™¨åŠ è½½ã€‚<br>5ï¼‰å¦åˆ™ï¼ŒæŸ¥æ‰¾ç±»æ˜¯å¦åœ¨è‡ªå·±çš„Fragment Bundleä¸­ï¼Œå¦‚æœåœ¨ï¼Œåˆ™å§”æ´¾ç»™Fragment Bundleçš„ç±»åŠ è½½å™¨åŠ è½½ã€‚<br>6ï¼‰å¦åˆ™ï¼ŒæŸ¥æ‰¾Dynamic Importåˆ—è¡¨çš„Bundleï¼Œå§”æ´¾ç»™å¯¹åº”Bundleçš„ç±»åŠ è½½å™¨åŠ è½½ã€‚<br>7ï¼‰å¦åˆ™ï¼Œç±»æŸ¥æ‰¾å¤±è´¥ã€‚</p><p>ä¸Šé¢çš„æŸ¥æ‰¾é¡ºåºä¸­åªæœ‰å¼€å¤´ä¸¤ç‚¹ä»ç„¶ç¬¦åˆåŒäº²å§”æ´¾æ¨¡å‹çš„åŸåˆ™ï¼Œå…¶ä½™çš„ç±»æŸ¥æ‰¾éƒ½æ˜¯åœ¨å¹³çº§çš„ç±»åŠ è½½å™¨ä¸­è¿›è¡Œçš„ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmå­—èŠ‚ç æŒ‡ä»¤è¡¨</title>
      <link href="/posts/ee62cca5.html"/>
      <url>/posts/ee62cca5.html</url>
      
        <content type="html"><![CDATA[<h2 id="JVMå­—èŠ‚ç æŒ‡ä»¤è¡¨"><a href="#JVMå­—èŠ‚ç æŒ‡ä»¤è¡¨" class="headerlink" title="JVMå­—èŠ‚ç æŒ‡ä»¤è¡¨"></a>JVMå­—èŠ‚ç æŒ‡ä»¤è¡¨</h2><h3 id="javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨"><a href="#javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨" class="headerlink" title="javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨"></a>javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨</h3><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-code-byte-1.jpg" alt="javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨1"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-code-byte-2.jpg" alt="javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨2"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-code-byte-3.jpg" alt="javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨3"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-code-byte-4.jpg" alt="javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨4"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-code-byte-5.jpg" alt="javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨5"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-code-byte-6.jpg" alt="javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨6"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-code-byte-7.jpg" alt="javaè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨7"></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­—èŠ‚ç æŒ‡ä»¤è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmä¹‹å­—èŠ‚ç æŒ‡ä»¤</title>
      <link href="/posts/a2ceb3e5.html"/>
      <url>/posts/a2ceb3e5.html</url>
      
        <content type="html"><![CDATA[<h2 id="jvmå­—èŠ‚ç æŒ‡ä»¤"><a href="#jvmå­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="jvmå­—èŠ‚ç æŒ‡ä»¤"></a>jvmå­—èŠ‚ç æŒ‡ä»¤</h2><blockquote><p>Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤ç”±ä¸€ä¸ªå­—èŠ‚é•¿åº¦çš„ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„æ•°å­—ï¼ˆç§°ä¸ºæ“ä½œç ï¼ŒOpcodeï¼‰ä»¥åŠè·Ÿéšå…¶åçš„é›¶è‡³å¤šä¸ªä»£è¡¨æ­¤æ“ä½œæ‰€éœ€çš„å‚æ•°ï¼ˆç§°ä¸ºæ“ä½œæ•°ï¼ŒOperandï¼‰æ„æˆã€‚</p><p>Javaè™šæ‹Ÿæœºé‡‡ç”¨é¢å‘æ“ä½œæ•°æ ˆï¼Œè€Œä¸æ˜¯é¢å‘å¯„å­˜å™¨çš„æ¶æ„ï¼Œå¤§å¤šæ•°æŒ‡ä»¤éƒ½ä¸åŒ…å«æ“ä½œæ•°ï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œç ï¼ŒæŒ‡ä»¤å‚æ•°éƒ½å­˜æ”¾åœ¨æ“ä½œæ•°æ ˆä¸­ã€‚</p></blockquote><p>å­—èŠ‚ç æŒ‡ä»¤é›†å¯ç®—æ˜¯ä¸€ç§å…·æœ‰é²œæ˜ç‰¹ç‚¹ã€ä¼˜åŠ¿å’ŒåŠ£åŠ¿å‡å¾ˆçªå‡ºçš„æŒ‡ä»¤é›†æ¶æ„ï¼Œç”±äºé™åˆ¶äº†Javaè™šæ‹Ÿæœºæ“ä½œç çš„é•¿åº¦ä¸ºä¸€ä¸ªå­—èŠ‚ï¼ˆå³0ï½255ï¼‰ï¼Œè¿™æ„å‘³ç€æŒ‡ä»¤é›†çš„æ“ä½œç æ€»æ•°ä¸èƒ½å¤Ÿè¶…è¿‡256æ¡ï¼›åˆç”±äºClassæ–‡ä»¶æ ¼å¼æ”¾å¼ƒäº†ç¼–è¯‘åä»£ç çš„æ“ä½œæ•°é•¿åº¦å¯¹é½ï¼Œè¿™å°±æ„å‘³ç€è™šæ‹Ÿæœºåœ¨å¤„ç†é‚£äº›è¶…è¿‡ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®æ—¶ï¼Œä¸å¾—ä¸åœ¨è¿è¡Œæ—¶ä»å­—èŠ‚ä¸­é‡å»ºå‡ºå…·ä½“æ•°æ®çš„ç»“æ„ã€‚</p><blockquote><p>æ”¾å¼ƒäº†æ“ä½œæ•°é•¿åº¦å¯¹é½[æ’å›¾]ï¼Œå°±æ„å‘³ç€å¯ä»¥çœç•¥æ‰å¤§é‡çš„å¡«å……å’Œé—´éš”ç¬¦å·ï¼›ç”¨ä¸€ä¸ªå­—èŠ‚æ¥ä»£è¡¨æ“ä½œç ï¼Œä¹Ÿæ˜¯ä¸ºäº†å°½å¯èƒ½è·å¾—çŸ­å°ç²¾å¹²çš„ç¼–è¯‘ä»£ç ã€‚è¿™ç§è¿½æ±‚å°½å¯èƒ½å°æ•°æ®é‡ã€é«˜ä¼ è¾“æ•ˆç‡çš„è®¾è®¡æ˜¯ç”±Javaè¯­è¨€è®¾è®¡ä¹‹åˆä¸»è¦é¢å‘ç½‘ç»œã€æ™ºèƒ½å®¶ç”µçš„æŠ€æœ¯èƒŒæ™¯æ‰€å†³å®šçš„ï¼Œå¹¶ä¸€ç›´æ²¿ç”¨è‡³ä»Šã€‚</p></blockquote><p>å¦‚æœä¸è€ƒè™‘å¼‚å¸¸å¤„ç†çš„è¯ï¼Œé‚£Javaè™šæ‹Ÿæœºçš„è§£é‡Šå™¨å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™æ®µä¼ªä»£ç ä½œä¸ºæœ€åŸºæœ¬çš„æ‰§è¡Œæ¨¡å‹æ¥ç†è§£ï¼Œè¿™ä¸ªæ‰§è¡Œæ¨¡å‹è™½ç„¶å¾ˆç®€å•ï¼Œä½†ä¾ç„¶å¯ä»¥æœ‰æ•ˆæ­£ç¡®åœ°å·¥ä½œï¼š</p><pre class=" language-txt"><code class="language-txt">do {    è‡ªåŠ¨è®¡ç®—PCå¯„å­˜å™¨çš„å€¼åŠ 1;    æ ¹æ®PCå¯„å­˜å™¨æŒ‡ç¤ºçš„ä½ç½®ï¼Œä»å­—èŠ‚ç æµä¸­å–å‡ºæ“ä½œç ;    if (å­—èŠ‚ç å­˜åœ¨æ“ä½œæ•°) ä»å­—èŠ‚ç æµä¸­å–å‡ºæ“ä½œæ•°;    æ‰§è¡Œæ“ä½œç æ‰€å®šä¹‰çš„æ“ä½œ;} while (å­—èŠ‚ç æµé•¿åº¦ > 0);</code></pre><h3 id="ä¸€ã€å­—èŠ‚ç ä¸æ•°æ®ç±»å‹"><a href="#ä¸€ã€å­—èŠ‚ç ä¸æ•°æ®ç±»å‹" class="headerlink" title="ä¸€ã€å­—èŠ‚ç ä¸æ•°æ®ç±»å‹"></a>ä¸€ã€å­—èŠ‚ç ä¸æ•°æ®ç±»å‹</h3><p>åœ¨Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤é›†ä¸­ï¼Œå¤§å¤šæ•°æŒ‡ä»¤éƒ½åŒ…å«å…¶æ“ä½œæ‰€å¯¹åº”çš„æ•°æ®ç±»å‹ä¿¡æ¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒiloadæŒ‡ä»¤ç”¨äºä»å±€éƒ¨å˜é‡è¡¨ä¸­åŠ è½½intå‹çš„æ•°æ®åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œè€ŒfloadæŒ‡ä»¤åŠ è½½çš„åˆ™æ˜¯floatç±»å‹çš„æ•°æ®ã€‚è¿™ä¸¤æ¡æŒ‡ä»¤çš„æ“ä½œåœ¨è™šæ‹Ÿæœºå†…éƒ¨å¯èƒ½ä¼šæ˜¯ç”±åŒä¸€æ®µä»£ç æ¥å®ç°çš„ï¼Œä½†åœ¨Classæ–‡ä»¶ä¸­å®ƒä»¬å¿…é¡»æ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„æ“ä½œç ã€‚</p><p>å¯¹äºå¤§éƒ¨åˆ†ä¸æ•°æ®ç±»å‹ç›¸å…³çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œå®ƒä»¬çš„æ“ä½œç åŠ©è®°ç¬¦ä¸­éƒ½æœ‰ç‰¹æ®Šçš„å­—ç¬¦æ¥è¡¨æ˜ä¸“é—¨ä¸ºå“ªç§æ•°æ®ç±»å‹æœåŠ¡ï¼šiä»£è¡¨å¯¹intç±»å‹çš„æ•°æ®æ“ä½œï¼Œlä»£è¡¨longï¼Œsä»£è¡¨shortï¼Œbä»£è¡¨byteï¼Œcä»£è¡¨charï¼Œfä»£è¡¨floatï¼Œdä»£è¡¨doubleï¼Œaä»£è¡¨referenceã€‚ä¹Ÿæœ‰ä¸€äº›æŒ‡ä»¤çš„åŠ©è®°ç¬¦ä¸­æ²¡æœ‰æ˜ç¡®æŒ‡æ˜æ“ä½œç±»å‹çš„å­—æ¯ï¼Œä¾‹å¦‚arraylengthæŒ‡ä»¤ï¼Œå®ƒæ²¡æœ‰ä»£è¡¨æ•°æ®ç±»å‹çš„ç‰¹æ®Šå­—ç¬¦ï¼Œä½†æ“ä½œæ•°æ°¸è¿œåªèƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹çš„å¯¹è±¡ã€‚è¿˜æœ‰å¦å¤–ä¸€äº›æŒ‡ä»¤ï¼Œä¾‹å¦‚æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤gotoåˆ™æ˜¯ä¸æ•°æ®ç±»å‹æ— å…³çš„æŒ‡ä»¤ã€‚</p><p>Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤é›†å¯¹äºç‰¹å®šçš„æ“ä½œåªæä¾›äº†æœ‰é™çš„ç±»å‹ç›¸å…³æŒ‡ä»¤å»æ”¯æŒï¼Œè¿™ç§ç‰¹æ•ˆç§°ä¸ºï¼šâ€œNot Orthogonalâ€ï¼Œå¹¶éæ¯ç§æ•°æ®ç±»å‹å’Œæ¯ä¸€ç§æ“ä½œéƒ½æœ‰å¯¹åº”çš„æŒ‡ä»¤ã€‚æœ‰ä¸€äº›å•ç‹¬çš„æŒ‡ä»¤å¯ä»¥åœ¨å¿…è¦çš„æ—¶å€™ç”¨æ¥å°†ä¸€äº›ä¸æ”¯æŒçš„ç±»å‹è½¬æ¢ä¸ºå¯è¢«æ”¯æŒçš„ç±»å‹ã€‚</p><p>Javaè™šæ‹ŸæœºæŒ‡ä»¤é›†æ‰€æ”¯æŒçš„æ•°æ®ç±»å‹ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-bytecode/jvm-6-bytecode-dataType.jpg" alt="javaè™šæ‹ŸæœºæŒ‡ä»¤é›†æ‰€æ”¯æŒçš„æ•°æ®ç±»å‹"></p><p>å¤§éƒ¨åˆ†æŒ‡ä»¤éƒ½æ²¡æœ‰æ”¯æŒæ•´æ•°ç±»å‹byteã€charå’Œshortï¼Œç”šè‡³æ²¡æœ‰ä»»ä½•æŒ‡ä»¤æ”¯æŒbooleanç±»å‹ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸæˆ–è¿è¡ŒæœŸå°†byteå’Œshortç±»å‹çš„æ•°æ®å¸¦ç¬¦å·æ‰©å±•ï¼ˆSign-Extendï¼‰ä¸ºç›¸åº”çš„intç±»å‹æ•°æ®ï¼Œå°†booleanå’Œcharç±»å‹æ•°æ®é›¶ä½æ‰©å±•ï¼ˆZero-Extendï¼‰ä¸ºç›¸åº”çš„intç±»å‹æ•°æ®ã€‚</p><p>å¤šæ•°å¯¹äºbooleanã€byteã€shortå’Œcharç±»å‹æ•°æ®çš„æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯ä½¿ç”¨ç›¸åº”çš„å¯¹intç±»å‹ä½œä¸ºè¿ç®—ç±»å‹ï¼ˆComputational Typeï¼‰æ¥è¿›è¡Œçš„ã€‚</p><p><a href="ee62cca5.html">ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava SE 7ï¼‰ã€‹ä¸­æ–‡ç‰ˆã€‹</a></p><h3 id="äºŒã€åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤"><a href="#äºŒã€åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤" class="headerlink" title="äºŒã€åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤"></a>äºŒã€åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤</h3><p>åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤ç”¨äºå°†æ•°æ®åœ¨æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆä¹‹é—´æ¥å›ä¼ è¾“ï¼Œè¿™ç±»æŒ‡ä»¤åŒ…æ‹¬ï¼š</p><p>å°†ä¸€ä¸ªå±€éƒ¨å˜é‡åŠ è½½åˆ°æ“ä½œæ ˆï¼š</p><p><code>iload</code>ã€<code>iload_&lt;n&gt;</code>ã€<code>lload</code>ã€<code>lload_&lt;n&gt;</code>ã€<code>fload</code>ã€<code>fload_&lt;n&gt;</code>ã€<code>dload</code>ã€<code>dload_&lt;n&gt;</code>ã€<code>aload</code>ã€<code>aload_&lt;n&gt;</code></p><p>å°†ä¸€ä¸ªæ•°å€¼ä»æ“ä½œæ•°æ ˆå­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨ï¼š</p><p><code>istore</code>ã€<code>istore_&lt;n&gt;</code>ã€<code>lstore</code>ã€<code>lstore_&lt;n&gt;</code>ã€<code>fstore</code>ã€<code>fstore_&lt;n&gt;</code>ã€<code>dstore</code>ã€<code>dstore_&lt;n&gt;</code>ã€<code>astore</code>ã€<code>astore_&lt;n&gt;</code></p><p>å°†ä¸€ä¸ªå¸¸é‡åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼š<code>bipush</code>ã€<code>sipush</code>ã€<code>ldc</code>ã€<code>ldc_w</code>ã€<code>ldc2_w</code>ã€<code>aconst_null</code>ã€<code>iconst_m1</code>ã€<code>iconst_&lt;i&gt;</code>ï¼Œ<code>lconst_&lt;l&gt;</code>ã€<code>fconst_&lt;f&gt;</code>ã€<code>dconst_&lt;d&gt;</code></p><p>æ‰©å……å±€éƒ¨å˜é‡è¡¨çš„è®¿é—®ç´¢å¼•çš„æŒ‡ä»¤ï¼šwide</p><p>å­˜å‚¨æ•°æ®çš„æ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨ä¸»è¦ç”±åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤è¿›è¡Œæ“ä½œï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å°‘é‡æŒ‡ä»¤ï¼Œå¦‚è®¿é—®å¯¹è±¡çš„å­—æ®µæˆ–æ•°ç»„å…ƒç´ çš„æŒ‡ä»¤ä¹Ÿä¼šå‘æ“ä½œæ•°æ ˆä¼ è¾“æ•°æ®ã€‚</p><p>ä»¥å°–æ‹¬å·ç»“å°¾çš„ï¼ˆä¾‹å¦‚<code>iload_&lt;n&gt;</code>ï¼‰ï¼Œè¿™äº›æŒ‡ä»¤åŠ©è®°ç¬¦å®é™…ä¸Šä»£è¡¨äº†ä¸€ç»„æŒ‡ä»¤ï¼ˆä¾‹å¦‚<code>iload_&lt;n&gt;</code>ï¼Œå®ƒä»£è¡¨äº†<code>iload_0</code>ã€<code>iload_1</code>ã€<code>iload_2</code>å’Œ<code>iload_3</code>è¿™å‡ æ¡æŒ‡ä»¤ï¼‰ã€‚</p><p>è¿™å‡ ç»„æŒ‡ä»¤éƒ½æ˜¯æŸä¸ªå¸¦æœ‰ä¸€ä¸ªæ“ä½œæ•°çš„é€šç”¨æŒ‡ä»¤ï¼ˆä¾‹å¦‚<code>iload</code>ï¼‰çš„ç‰¹æ®Šå½¢å¼ï¼Œå¯¹äºè¿™å‡ ç»„ç‰¹æ®ŠæŒ‡ä»¤ï¼Œå®ƒä»¬çœç•¥æ‰äº†æ˜¾å¼çš„æ“ä½œæ•°ï¼Œä¸éœ€è¦è¿›è¡Œå–æ“ä½œæ•°çš„åŠ¨ä½œï¼Œå› ä¸ºå®é™…ä¸Šæ“ä½œæ•°å°±éšå«åœ¨æŒ‡ä»¤ä¸­ã€‚</p><h3 id="ä¸‰ã€è¿ç®—æŒ‡ä»¤"><a href="#ä¸‰ã€è¿ç®—æŒ‡ä»¤" class="headerlink" title="ä¸‰ã€è¿ç®—æŒ‡ä»¤"></a>ä¸‰ã€è¿ç®—æŒ‡ä»¤</h3><p>ç®—æœ¯æŒ‡ä»¤ç”¨äºå¯¹ä¸¤ä¸ªæ“ä½œæ•°æ ˆä¸Šçš„å€¼è¿›è¡ŒæŸç§ç‰¹å®šè¿ç®—ï¼Œå¹¶æŠŠç»“æœé‡æ–°å­˜å…¥åˆ°æ“ä½œæ ˆé¡¶ã€‚</p><p>è¿ç®—æŒ‡ä»¤å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šå¯¹æ•´å‹æ•°æ®è¿›è¡Œè¿ç®—çš„æŒ‡ä»¤ä¸å¯¹æµ®ç‚¹å‹æ•°æ®è¿›è¡Œè¿ç®—çš„æŒ‡ä»¤ã€‚</p><p>è¿ç®—æŒ‡ä»¤éƒ½æ˜¯ç”¨Javaè™šæ‹Ÿæœºçš„ç®—æœ¯ç±»å‹æ¥è¿›è¡Œè®¡ç®—ï¼Œä¸å­˜åœ¨ç›´æ¥æ”¯æŒbyteã€shortã€charå’Œbooleanç±»å‹çš„ç®—æœ¯æŒ‡ä»¤ï¼Œä»–ä»¬çš„è¿ç®—éƒ½ä½¿ç”¨intç±»å‹çš„æŒ‡ä»¤ä»£æ›¿ã€‚</p><p>æ‰€æœ‰çš„ç®—æœ¯æŒ‡ä»¤åŒ…æ‹¬ï¼š</p><p>åŠ æ³•æŒ‡ä»¤ï¼š<code>iadd</code>ã€<code>ladd</code>ã€<code>fadd</code>ã€<code>dadd</code></p><p>å‡æ³•æŒ‡ä»¤ï¼š<code>isub</code>ã€<code>lsub</code>ã€<code>fsub</code>ã€<code>dsub</code></p><p>ä¹˜æ³•æŒ‡ä»¤ï¼š<code>imul</code>ã€<code>lmul</code>ã€<code>fmul</code>ã€<code>dmul</code></p><p>é™¤æ³•æŒ‡ä»¤ï¼š<code>idiv</code>ã€<code>ldiv</code>ã€<code>fdiv</code>ã€<code>ddiv</code></p><p>æ±‚ä½™æŒ‡ä»¤ï¼š<code>irem</code>ã€<code>lrem</code>ã€<code>frem</code>ã€<code>drem</code></p><p>å–åæŒ‡ä»¤ï¼š<code>ineg</code>ã€<code>lneg</code>ã€<code>fneg</code>ã€<code>dneg</code></p><p>ä½ç§»æŒ‡ä»¤ï¼š<code>ishl</code>ã€<code>ishr</code>ã€<code>iushr</code>ã€<code>lshl</code>ã€<code>lshr</code>ã€<code>lushr</code></p><p>æŒ‰ä½æˆ–æŒ‡ä»¤ï¼š<code>ior</code>ã€<code>lor</code></p><p>æŒ‰ä½ä¸æŒ‡ä»¤ï¼š<code>iand</code>ã€<code>land</code></p><p>æŒ‰ä½å¼‚æˆ–æŒ‡ä»¤ï¼š<code>ixor</code>ã€<code>lxor</code></p><p>å±€éƒ¨å˜é‡è‡ªå¢æŒ‡ä»¤ï¼š<code>iinc</code></p><p>æ¯”è¾ƒæŒ‡ä»¤ï¼š<code>dcmpg</code>ã€<code>dcmpl</code>ã€<code>fcmpg</code>ã€<code>fcmpl</code>ã€<code>lcmp</code></p><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®šäº†åœ¨å¤„ç†æ•´å‹æ•°æ®æ—¶ï¼Œåªæœ‰é™¤æ³•æŒ‡ä»¤ï¼ˆidivå’Œldivï¼‰ä»¥åŠæ±‚ä½™æŒ‡ä»¤ï¼ˆiremå’Œlremï¼‰ä¸­å½“å‡ºç°é™¤æ•°ä¸ºé›¶æ—¶ä¼šå¯¼è‡´è™šæ‹ŸæœºæŠ›å‡º<code>ArithmeticException</code>å¼‚å¸¸ï¼Œå…¶ä½™ä»»ä½•æ•´å‹æ•°è¿ç®—åœºæ™¯éƒ½ä¸åº”è¯¥æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚</p><blockquote><p>Javaè™šæ‹Ÿæœºå¿…é¡»å®Œå…¨æ”¯æŒIEEE 754ä¸­å®šä¹‰çš„â€œéæ­£è§„æµ®ç‚¹æ•°å€¼â€ï¼ˆDenormalized Floating-Point Numberï¼‰å’Œâ€œé€çº§ä¸‹æº¢â€ï¼ˆGradual Underflowï¼‰çš„è¿ç®—è§„åˆ™ã€‚è¿™äº›è§„åˆ™å°†ä¼šä½¿æŸäº›æ•°å€¼ç®—æ³•å¤„ç†èµ·æ¥å˜å¾—æ˜ç¡®ï¼Œä¸ä¼šå‡ºç°æ¨¡æ£±ä¸¤å¯çš„å›°å¢ƒã€‚è­¬å¦‚ä»¥ä¸Šè§„åˆ™è¦æ±‚Javaè™šæ‹Ÿæœºåœ¨è¿›è¡Œæµ®ç‚¹æ•°è¿ç®—æ—¶ï¼Œæ‰€æœ‰çš„è¿ç®—ç»“æœéƒ½å¿…é¡»èˆå…¥åˆ°é€‚å½“çš„ç²¾åº¦ï¼Œéç²¾ç¡®çš„ç»“æœå¿…é¡»èˆå…¥ä¸ºå¯è¢«è¡¨ç¤ºçš„æœ€æ¥è¿‘çš„ç²¾ç¡®å€¼ï¼›å¦‚æœæœ‰ä¸¤ç§å¯è¡¨ç¤ºçš„å½¢å¼ä¸è¯¥å€¼ä¸€æ ·æ¥è¿‘ï¼Œé‚£å°†ä¼˜å…ˆé€‰æ‹©æœ€ä½æœ‰æ•ˆä½ä¸ºé›¶çš„ã€‚è¿™ç§èˆå…¥æ¨¡å¼ä¹Ÿæ˜¯IEEE 754è§„èŒƒä¸­çš„é»˜è®¤èˆå…¥æ¨¡å¼ï¼Œç§°ä¸ºå‘æœ€æ¥è¿‘æ•°èˆå…¥æ¨¡å¼ã€‚è€Œåœ¨æŠŠæµ®ç‚¹æ•°è½¬æ¢ä¸ºæ•´æ•°æ—¶ï¼ŒJavaè™šæ‹Ÿæœºä½¿ç”¨IEEE 754æ ‡å‡†ä¸­çš„å‘é›¶èˆå…¥æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼çš„èˆå…¥ç»“æœä¼šå¯¼è‡´æ•°å­—è¢«æˆªæ–­ï¼Œæ‰€æœ‰å°æ•°éƒ¨åˆ†çš„æœ‰æ•ˆå­—èŠ‚éƒ½ä¼šè¢«ä¸¢å¼ƒæ‰ã€‚å‘é›¶èˆå…¥æ¨¡å¼å°†åœ¨ç›®æ ‡æ•°å€¼ç±»å‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€æ¥è¿‘ï¼Œä½†æ˜¯ä¸å¤§äºåŸå€¼çš„æ•°å­—æ¥ä½œä¸ºæœ€ç²¾ç¡®çš„èˆå…¥ç»“æœã€‚</p></blockquote><p>æµ®ç‚¹å¼‚å¸¸</p><blockquote><p>Javaè™šæ‹Ÿæœºåœ¨å¤„ç†æµ®ç‚¹æ•°è¿ç®—æ—¶ï¼Œä¸ä¼šæŠ›å‡ºä»»ä½•è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆè¿™é‡Œæ‰€è®²çš„æ˜¯Javaè¯­è¨€ä¸­çš„å¼‚å¸¸ï¼Œä¸å¯ä¸IEEE 754è§„èŒƒä¸­çš„æµ®ç‚¹å¼‚å¸¸äº’ç›¸æ··æ·†ï¼ŒIEEE 754çš„æµ®ç‚¹å¼‚å¸¸æ˜¯ä¸€ç§è¿ç®—ä¿¡å·ï¼‰ï¼Œå½“ä¸€ä¸ªæ“ä½œäº§ç”Ÿæº¢å‡ºæ—¶ï¼Œå°†ä¼šä½¿ç”¨æœ‰ç¬¦å·çš„æ— ç©·å¤§æ¥è¡¨ç¤ºï¼›å¦‚æœæŸä¸ªæ“ä½œç»“æœæ²¡æœ‰æ˜ç¡®çš„æ•°å­¦å®šä¹‰çš„è¯ï¼Œå°†ä¼šä½¿ç”¨<code>NaN</code>ï¼ˆNot a Numberï¼‰å€¼æ¥è¡¨ç¤ºã€‚æ‰€æœ‰ä½¿ç”¨<code>NaN</code>å€¼ä½œä¸ºæ“ä½œæ•°çš„ç®—æœ¯æ“ä½œï¼Œç»“æœéƒ½ä¼šè¿”å›<code>NaN</code>ã€‚</p></blockquote><p>Javaè™šæ‹Ÿæœºåœ¨å¤„ç†æµ®ç‚¹æ•°è¿ç®—æ—¶ï¼Œä¸ä¼šæŠ›å‡ºä»»ä½•è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆè¿™é‡Œæ‰€è®²çš„æ˜¯Javaè¯­è¨€ä¸­çš„å¼‚å¸¸ï¼Œè¯·è¯»è€…å‹¿ä¸IEEE 754è§„èŒƒä¸­çš„æµ®ç‚¹å¼‚å¸¸äº’ç›¸æ··æ·†ï¼ŒIEEE 754çš„æµ®ç‚¹å¼‚å¸¸æ˜¯ä¸€ç§è¿ç®—ä¿¡å·ï¼‰ï¼Œå½“ä¸€ä¸ªæ“ä½œäº§ç”Ÿæº¢å‡ºæ—¶ï¼Œå°†ä¼šä½¿ç”¨æœ‰ç¬¦å·çš„æ— ç©·å¤§æ¥è¡¨ç¤ºï¼›å¦‚æœæŸä¸ªæ“ä½œç»“æœæ²¡æœ‰æ˜ç¡®çš„æ•°å­¦å®šä¹‰çš„è¯ï¼Œå°†ä¼šä½¿ç”¨NaNï¼ˆNot a Numberï¼‰å€¼æ¥è¡¨ç¤ºã€‚æ‰€æœ‰ä½¿ç”¨NaNå€¼ä½œä¸ºæ“ä½œæ•°çš„ç®—æœ¯æ“ä½œï¼Œç»“æœéƒ½ä¼šè¿”å›NaNã€‚</p><h3 id="å››ã€ç±»å‹è½¬æ¢æŒ‡ä»¤"><a href="#å››ã€ç±»å‹è½¬æ¢æŒ‡ä»¤" class="headerlink" title="å››ã€ç±»å‹è½¬æ¢æŒ‡ä»¤"></a>å››ã€ç±»å‹è½¬æ¢æŒ‡ä»¤</h3><p>ç±»å‹è½¬æ¢æŒ‡ä»¤å¯ä»¥å°†ä¸¤ç§ä¸åŒçš„æ•°å€¼ç±»å‹ç›¸äº’è½¬æ¢ï¼Œè¿™äº›è½¬æ¢æ“ä½œä¸€èˆ¬ç”¨äºå®ç°ç”¨æˆ·ä»£ç ä¸­çš„æ˜¾å¼ç±»å‹è½¬æ¢æ“ä½œï¼Œæˆ–è€…ç”¨æ¥å¤„ç†æœ¬èŠ‚å¼€ç¯‡æ‰€æåˆ°çš„å­—èŠ‚ç æŒ‡ä»¤é›†ä¸­æ•°æ®ç±»å‹ç›¸å…³æŒ‡ä»¤æ— æ³•ä¸æ•°æ®ç±»å‹ä¸€ä¸€å¯¹åº”çš„é—®é¢˜ã€‚</p><p>Javaè™šæ‹Ÿæœºç›´æ¥æ”¯æŒï¼ˆå³è½¬æ¢æ—¶æ— é¡»æ˜¾å¼çš„è½¬æ¢æŒ‡ä»¤ï¼‰ä»¥ä¸‹æ•°å€¼ç±»å‹çš„å®½åŒ–ç±»å‹è½¬æ¢ï¼ˆWidening Numeric Conversionï¼Œå³å°èŒƒå›´ç±»å‹å‘å¤§èŒƒå›´ç±»å‹çš„å®‰å…¨è½¬æ¢ï¼‰ï¼š</p><p>intç±»å‹åˆ°longã€floatæˆ–è€…doubleç±»å‹</p><p>longç±»å‹åˆ°floatã€doubleç±»å‹</p><p>floatç±»å‹åˆ°doubleç±»å‹</p><p>ä¸ä¹‹ç›¸å¯¹çš„ï¼Œå¤„ç†çª„åŒ–ç±»å‹è½¬æ¢ï¼ˆNarrowing Numeric Conversionï¼‰æ—¶ï¼Œå°±å¿…é¡»æ˜¾å¼åœ°ä½¿ç”¨è½¬æ¢æŒ‡ä»¤æ¥å®Œæˆï¼Œè¿™äº›è½¬æ¢æŒ‡ä»¤åŒ…æ‹¬<code>i2b</code>ã€<code>i2c</code>ã€<code>i2s</code>ã€<code>l2i</code>ã€<code>f2i</code>ã€<code>f2l</code>ã€<code>d2i</code>ã€<code>d2l</code>å’Œ<code>d2f</code>ã€‚</p><p>çª„åŒ–ç±»å‹è½¬æ¢å¯èƒ½ä¼šå¯¼è‡´è½¬æ¢ç»“æœäº§ç”Ÿä¸åŒçš„æ­£è´Ÿå·ã€ä¸åŒçš„æ•°é‡çº§çš„æƒ…å†µï¼Œè½¬æ¢è¿‡ç¨‹å¾ˆå¯èƒ½ä¼šå¯¼è‡´æ•°å€¼çš„ç²¾åº¦ä¸¢å¤±ã€‚</p><p>åœ¨å°†<code>int</code>æˆ–<code>long</code>ç±»å‹çª„åŒ–è½¬æ¢ä¸ºæ•´æ•°ç±»å‹Tçš„æ—¶å€™ï¼Œè½¬æ¢è¿‡ç¨‹ä»…ä»…æ˜¯ç®€å•ä¸¢å¼ƒé™¤æœ€ä½ä½Nå­—èŠ‚ä»¥å¤–çš„å†…å®¹ï¼ŒNæ˜¯ç±»å‹Tçš„æ•°æ®ç±»å‹é•¿åº¦ï¼Œè¿™å°†å¯èƒ½å¯¼è‡´è½¬æ¢ç»“æœä¸è¾“å…¥å€¼æœ‰ä¸åŒçš„æ­£è´Ÿå·ã€‚å¯¹äºäº†è§£è®¡ç®—æœºæ•°å€¼å­˜å‚¨å’Œè¡¨ç¤ºçš„ç¨‹åºå‘˜æ¥è¯´è¿™ç‚¹å¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºåŸæ¥ç¬¦å·ä½å¤„äºæ•°å€¼çš„æœ€é«˜ä½ï¼Œé«˜ä½è¢«ä¸¢å¼ƒä¹‹åï¼Œè½¬æ¢ç»“æœçš„ç¬¦å·å°±å–å†³äºä½Nå­—èŠ‚çš„é¦–ä½äº†ã€‚</p><p>Javaè™šæ‹Ÿæœºå°†ä¸€ä¸ªæµ®ç‚¹å€¼çª„åŒ–è½¬æ¢ä¸ºæ•´æ•°ç±»å‹Tï¼ˆTé™äº<code>int</code>æˆ–<code>long</code>ç±»å‹ä¹‹ä¸€ï¼‰çš„æ—¶å€™ï¼Œå¿…é¡»éµå¾ªä»¥ä¸‹è½¬æ¢è§„åˆ™ï¼š</p><p>ï¼ˆaï¼‰å¦‚æœæµ®ç‚¹å€¼æ˜¯<code>NaN</code>ï¼Œé‚£è½¬æ¢ç»“æœå°±æ˜¯intæˆ–longç±»å‹çš„0ã€‚</p><p>ï¼ˆbï¼‰å¦‚æœæµ®ç‚¹å€¼ä¸æ˜¯æ— ç©·å¤§çš„è¯ï¼Œæµ®ç‚¹å€¼ä½¿ç”¨IEEE 754çš„å‘é›¶èˆå…¥æ¨¡å¼å–æ•´ï¼Œè·å¾—æ•´æ•°å€¼vã€‚å¦‚æœvåœ¨ç›®æ ‡ç±»å‹Tï¼ˆintæˆ–longï¼‰çš„è¡¨ç¤ºèŒƒå›´ä¹‹ç±»ï¼Œé‚£è½¬æ¢ç»“æœå°±æ˜¯vï¼›å¦åˆ™ï¼Œå°†æ ¹æ®vçš„ç¬¦å·ï¼Œè½¬æ¢ä¸ºTæ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§æˆ–è€…æœ€å°æ­£æ•°ã€‚</p><p>ä»doubleç±»å‹åˆ°floatç±»å‹åšçª„åŒ–è½¬æ¢çš„è¿‡ç¨‹ä¸IEEE 754ä¸­å®šä¹‰çš„ä¸€è‡´ï¼Œé€šè¿‡IEEE 754å‘æœ€æ¥è¿‘æ•°èˆå…¥æ¨¡å¼èˆå…¥å¾—åˆ°ä¸€ä¸ªå¯ä»¥ä½¿ç”¨floatç±»å‹è¡¨ç¤ºçš„æ•°å­—ã€‚å¦‚æœè½¬æ¢ç»“æœçš„ç»å¯¹å€¼å¤ªå°ã€æ— æ³•ä½¿ç”¨floatæ¥è¡¨ç¤ºçš„è¯ï¼Œå°†è¿”å›floatç±»å‹çš„æ­£è´Ÿé›¶ï¼›å¦‚æœè½¬æ¢ç»“æœçš„ç»å¯¹å€¼å¤ªå¤§ã€æ— æ³•ä½¿ç”¨floatæ¥è¡¨ç¤ºçš„è¯ï¼Œå°†è¿”å›floatç±»å‹çš„æ­£è´Ÿæ— ç©·å¤§ã€‚å¯¹äºdoubleç±»å‹çš„NaNå€¼å°†æŒ‰è§„å®šè½¬æ¢ä¸ºfloatç±»å‹çš„NaNå€¼ã€‚</p><p>å°½ç®¡æ•°æ®ç±»å‹çª„åŒ–è½¬æ¢å¯èƒ½ä¼šå‘ç”Ÿä¸Šé™æº¢å‡ºã€ä¸‹é™æº¢å‡ºå’Œç²¾åº¦ä¸¢å¤±ç­‰æƒ…å†µï¼Œä½†æ˜¯ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ˜ç¡®è§„å®šæ•°å€¼ç±»å‹çš„çª„åŒ–è½¬æ¢æŒ‡ä»¤æ°¸è¿œä¸å¯èƒ½å¯¼è‡´è™šæ‹ŸæœºæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚</p><h3 id="äº”ã€å¯¹è±¡åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤"><a href="#äº”ã€å¯¹è±¡åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤" class="headerlink" title="äº”ã€å¯¹è±¡åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤"></a>äº”ã€å¯¹è±¡åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤</h3><p>è™½ç„¶ç±»å®ä¾‹å’Œæ•°ç»„éƒ½æ˜¯å¯¹è±¡ï¼Œä½†Javaè™šæ‹Ÿæœºå¯¹ç±»å®ä¾‹å’Œæ•°ç»„çš„åˆ›å»ºä¸æ“ä½œä½¿ç”¨äº†ä¸åŒçš„å­—èŠ‚ç æŒ‡ä»¤ï¼ˆåœ¨ä¸‹ä¸€ç« ä¼šè®²åˆ°æ•°ç»„å’Œæ™®é€šç±»çš„ç±»å‹åˆ›å»ºè¿‡ç¨‹æ˜¯ä¸åŒçš„ï¼‰ã€‚å¯¹è±¡åˆ›å»ºåï¼Œå°±å¯ä»¥é€šè¿‡å¯¹è±¡è®¿é—®æŒ‡ä»¤è·å–å¯¹è±¡å®ä¾‹æˆ–è€…æ•°ç»„å®ä¾‹ä¸­çš„å­—æ®µæˆ–è€…æ•°ç»„å…ƒç´ ï¼Œè¿™äº›æŒ‡ä»¤åŒ…æ‹¬ï¼š</p><p>ï¼ˆaï¼‰åˆ›å»ºç±»å®ä¾‹çš„æŒ‡ä»¤ï¼š<code>new</code></p><p>ï¼ˆbï¼‰åˆ›å»ºæ•°ç»„çš„æŒ‡ä»¤ï¼š<code>newarray</code>ã€<code>anewarray</code>ã€<code>multianewarray</code></p><p>ï¼ˆcï¼‰è®¿é—®ç±»å­—æ®µï¼ˆ<code>static</code>å­—æ®µï¼Œæˆ–è€…ç§°ä¸ºç±»å˜é‡ï¼‰å’Œå®ä¾‹å­—æ®µï¼ˆé<code>static</code>å­—æ®µï¼Œæˆ–è€…ç§°ä¸ºå®ä¾‹å˜é‡ï¼‰çš„æŒ‡ä»¤ï¼š<code>getfield</code>ã€<code>putfield</code>ã€<code>getstatic</code>ã€<code>putstatic</code></p><p>ï¼ˆdï¼‰æŠŠä¸€ä¸ªæ•°ç»„å…ƒç´ åŠ è½½åˆ°æ“ä½œæ•°æ ˆçš„æŒ‡ä»¤ï¼š<code>baload</code>ã€<code>caload</code>ã€<code>saload</code>ã€<code>iaload</code>ã€<code>laload</code>ã€<code>faload</code>ã€<code>daload</code>ã€<code>aaload</code></p><p>ï¼ˆeï¼‰å°†ä¸€ä¸ªæ“ä½œæ•°æ ˆçš„å€¼å‚¨å­˜åˆ°æ•°ç»„å…ƒç´ ä¸­çš„æŒ‡ä»¤ï¼š<code>bastore</code>ã€<code>castore</code>ã€<code>sastore</code>ã€<code>iastore</code>ã€<code>fastore</code>ã€<code>dastore</code>ã€<code>aastore</code></p><p>ï¼ˆfï¼‰å–æ•°ç»„é•¿åº¦çš„æŒ‡ä»¤ï¼š<code>arraylength</code></p><p>ï¼ˆgï¼‰æ£€æŸ¥ç±»å®ä¾‹ç±»å‹çš„æŒ‡ä»¤ï¼š<code>instanceof</code>ã€<code>checkcast</code></p><h3 id="å…­ã€æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤"><a href="#å…­ã€æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤" class="headerlink" title="å…­ã€æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤"></a>å…­ã€æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</h3><p>å¦‚åŒæ“ä½œä¸€ä¸ªæ™®é€šæ•°æ®ç»“æ„ä¸­çš„å †æ ˆé‚£æ ·ï¼ŒJavaè™šæ‹Ÿæœºæä¾›äº†ä¸€äº›ç”¨äºç›´æ¥æ“ä½œæ“ä½œæ•°æ ˆçš„æŒ‡ä»¤ï¼ŒåŒ…æ‹¬ï¼š</p><p>ï¼ˆaï¼‰å°†æ“ä½œæ•°æ ˆçš„æ ˆé¡¶ä¸€ä¸ªæˆ–ä¸¤ä¸ªå…ƒç´ å‡ºæ ˆï¼š<code>pop</code>ã€<code>pop2</code></p><p>ï¼ˆbï¼‰å¤åˆ¶æ ˆé¡¶ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ•°å€¼å¹¶å°†å¤åˆ¶å€¼æˆ–åŒä»½çš„å¤åˆ¶å€¼é‡æ–°å‹å…¥æ ˆé¡¶ï¼š<code>dup</code>ã€<code>dup2</code>ã€<code>dup_x1</code>ã€<code>dup2_x1</code>ã€<code>dup_x2</code>ã€<code>dup2_x2</code></p><p>ï¼ˆcï¼‰å°†æ ˆæœ€é¡¶ç«¯çš„ä¸¤ä¸ªæ•°å€¼äº’æ¢ï¼š<code>swap</code></p><h3 id="ä¸ƒã€æ§åˆ¶è½¬ç§»æŒ‡ä»¤"><a href="#ä¸ƒã€æ§åˆ¶è½¬ç§»æŒ‡ä»¤" class="headerlink" title="ä¸ƒã€æ§åˆ¶è½¬ç§»æŒ‡ä»¤"></a>ä¸ƒã€æ§åˆ¶è½¬ç§»æŒ‡ä»¤</h3><p>æ§åˆ¶è½¬ç§»æŒ‡ä»¤å¯ä»¥è®©Javaè™šæ‹Ÿæœºæœ‰æ¡ä»¶æˆ–æ— æ¡ä»¶åœ°ä»æŒ‡å®šä½ç½®æŒ‡ä»¤ï¼ˆè€Œä¸æ˜¯æ§åˆ¶è½¬ç§»æŒ‡ä»¤ï¼‰çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ç»§ç»­æ‰§è¡Œç¨‹åºï¼Œä»æ¦‚å¿µæ¨¡å‹ä¸Šç†è§£ï¼Œå¯ä»¥è®¤ä¸ºæ§åˆ¶æŒ‡ä»¤å°±æ˜¯åœ¨æœ‰æ¡ä»¶æˆ–æ— æ¡ä»¶åœ°ä¿®æ”¹PCå¯„å­˜å™¨çš„å€¼ã€‚æ§åˆ¶è½¬ç§»æŒ‡ä»¤åŒ…æ‹¬ï¼š</p><p>ï¼ˆaï¼‰æ¡ä»¶åˆ†æ”¯ï¼š<code>ifeq</code>ã€<code>iflt</code>ã€<code>ifle</code>ã€<code>ifne</code>ã€<code>ifgt</code>ã€<code>ifge</code>ã€<code>ifnull</code>ã€<code>ifnonnull</code>ã€<code>if_icmpeq</code>ã€<code>if_icmpne</code>ã€<code>if_icmplt</code>ã€<code>if_icmpgt</code>ã€<code>if_icmple</code>ã€<code>if_icmpge</code>ã€<code>if_acmpeqå’Œif_acmpne</code></p><p>ï¼ˆbï¼‰å¤åˆæ¡ä»¶åˆ†æ”¯ï¼š<code>tableswitch</code>ã€<code>lookupswitch</code></p><p>ï¼ˆcï¼‰æ— æ¡ä»¶åˆ†æ”¯ï¼š<code>goto</code>ã€<code>goto_w</code>ã€<code>jsr</code>ã€<code>jsr_w</code>ã€<code>ret</code></p><p>Javaè™šæ‹Ÿæœºä¸­æœ‰ä¸“é—¨çš„æŒ‡ä»¤é›†ç”¨æ¥å¤„ç†intå’Œreferenceç±»å‹çš„æ¡ä»¶åˆ†æ”¯æ¯”è¾ƒæ“ä½œï¼Œä¸ºäº†å¯ä»¥æ— é¡»æ˜æ˜¾æ ‡è¯†ä¸€ä¸ªæ•°æ®çš„å€¼æ˜¯å¦nullï¼Œä¹Ÿæœ‰ä¸“é—¨çš„æŒ‡ä»¤ç”¨æ¥æ£€æµ‹nullå€¼ã€‚</p><blockquote><p>å¯¹äºbooleanç±»å‹ã€byteç±»å‹ã€charç±»å‹å’Œshortç±»å‹çš„æ¡ä»¶åˆ†æ”¯æ¯”è¾ƒæ“ä½œï¼Œéƒ½ä½¿ç”¨intç±»å‹çš„æ¯”è¾ƒæŒ‡ä»¤æ¥å®Œæˆï¼Œè€Œå¯¹äºlongç±»å‹ã€floatç±»å‹å’Œdoubleç±»å‹çš„æ¡ä»¶åˆ†æ”¯æ¯”è¾ƒæ“ä½œï¼Œåˆ™ä¼šå…ˆæ‰§è¡Œç›¸åº”ç±»å‹çš„æ¯”è¾ƒè¿ç®—æŒ‡ä»¤ï¼ˆdcmpgã€dcmplã€fcmpgã€fcmplã€lcmpï¼‰ï¼Œè¿ç®—æŒ‡ä»¤ä¼šè¿”å›ä¸€ä¸ªæ•´å‹å€¼åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œéšåå†æ‰§è¡Œintç±»å‹çš„æ¡ä»¶åˆ†æ”¯æ¯”è¾ƒæ“ä½œæ¥å®Œæˆæ•´ä¸ªåˆ†æ”¯è·³è½¬ã€‚ç”±äºå„ç§ç±»å‹çš„æ¯”è¾ƒæœ€ç»ˆéƒ½ä¼šè½¬åŒ–ä¸ºintç±»å‹çš„æ¯”è¾ƒæ“ä½œï¼Œintç±»å‹æ¯”è¾ƒæ˜¯å¦æ–¹ä¾¿ã€å®Œå–„å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œè€ŒJavaè™šæ‹Ÿæœºæä¾›çš„intç±»å‹çš„æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤æ˜¯æœ€ä¸ºä¸°å¯Œã€å¼ºå¤§çš„ã€‚</p></blockquote><h3 id="å…«ã€æ–¹æ³•è°ƒç”¨å’Œè¿”å›æŒ‡ä»¤"><a href="#å…«ã€æ–¹æ³•è°ƒç”¨å’Œè¿”å›æŒ‡ä»¤" class="headerlink" title="å…«ã€æ–¹æ³•è°ƒç”¨å’Œè¿”å›æŒ‡ä»¤"></a>å…«ã€æ–¹æ³•è°ƒç”¨å’Œè¿”å›æŒ‡ä»¤</h3><p>æŒ‡ä»¤ç”¨äºæ–¹æ³•è°ƒç”¨ï¼š</p><p>ï¼ˆaï¼‰<code>invokevirtual</code>æŒ‡ä»¤ï¼šç”¨äºè°ƒç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•ï¼Œæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹è¿›è¡Œåˆ†æ´¾ï¼ˆè™šæ–¹æ³•åˆ†æ´¾ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯Javaè¯­è¨€ä¸­æœ€å¸¸è§çš„æ–¹æ³•åˆ†æ´¾æ–¹å¼ã€‚</p><p>ï¼ˆbï¼‰<code>invokeinterface</code>æŒ‡ä»¤ï¼šç”¨äºè°ƒç”¨æ¥å£æ–¹æ³•ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶æœç´¢ä¸€ä¸ªå®ç°äº†è¿™ä¸ªæ¥å£æ–¹æ³•çš„å¯¹è±¡ï¼Œæ‰¾å‡ºé€‚åˆçš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚</p><p>ï¼ˆcï¼‰<code>invokespecial</code>æŒ‡ä»¤ï¼šç”¨äºè°ƒç”¨ä¸€äº›éœ€è¦ç‰¹æ®Šå¤„ç†çš„å®ä¾‹æ–¹æ³•ï¼ŒåŒ…æ‹¬å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç§æœ‰æ–¹æ³•å’Œçˆ¶ç±»æ–¹æ³•ã€‚</p><p>ï¼ˆdï¼‰<code>invokestatic</code>æŒ‡ä»¤ï¼šç”¨äºè°ƒç”¨ç±»é™æ€æ–¹æ³•ï¼ˆstaticæ–¹æ³•ï¼‰ã€‚</p><p>ï¼ˆeï¼‰<code>invokedynamic</code>æŒ‡ä»¤ï¼šç”¨äºåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æå‡ºè°ƒç”¨ç‚¹é™å®šç¬¦æ‰€å¼•ç”¨çš„æ–¹æ³•ã€‚å¹¶æ‰§è¡Œè¯¥æ–¹æ³•ã€‚å‰é¢å››æ¡è°ƒç”¨æŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘éƒ½å›ºåŒ–åœ¨Javaè™šæ‹Ÿæœºå†…éƒ¨ï¼Œç”¨æˆ·æ— æ³•æ”¹å˜ï¼Œè€Œ<code>invokedynamic</code>æŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘æ˜¯ç”±ç”¨æˆ·æ‰€è®¾å®šçš„å¼•å¯¼æ–¹æ³•å†³å®šçš„ã€‚</p><p>æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ä¸æ•°æ®ç±»å‹æ— å…³ï¼Œè€Œæ–¹æ³•è¿”å›æŒ‡ä»¤æ˜¯æ ¹æ®è¿”å›å€¼çš„ç±»å‹åŒºåˆ†çš„ï¼ŒåŒ…æ‹¬<code>ireturn</code>ï¼ˆå½“è¿”å›å€¼æ˜¯<code>boolean</code>ã€<code>byte</code>ã€<code>char</code>ã€<code>short</code>å’Œ<code>int</code>ç±»å‹æ—¶ä½¿ç”¨ï¼‰ã€<code>lreturn</code>ã€<code>freturn</code>ã€<code>dreturn</code>å’Œ<code>areturn</code>ï¼Œå¦å¤–è¿˜æœ‰ä¸€æ¡returnæŒ‡ä»¤ä¾›å£°æ˜ä¸º<code>void</code>çš„æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç±»å’Œæ¥å£çš„ç±»åˆå§‹åŒ–æ–¹æ³•ä½¿ç”¨ã€‚</p><h3 id="ä¹ã€å¼‚å¸¸æŒ‡ä»¤"><a href="#ä¹ã€å¼‚å¸¸æŒ‡ä»¤" class="headerlink" title="ä¹ã€å¼‚å¸¸æŒ‡ä»¤"></a>ä¹ã€å¼‚å¸¸æŒ‡ä»¤</h3><p>Javaç¨‹åºä¸­æ˜¾å¼æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œï¼ˆthrowè¯­å¥ï¼‰éƒ½ç”±athrowæŒ‡ä»¤æ¥å®ç°ï¼Œé™¤äº†ç”¨throwè¯­å¥æ˜¾å¼æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µä¹‹å¤–ï¼Œã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹è¿˜è§„å®šäº†è®¸å¤šè¿è¡Œæ—¶å¼‚å¸¸ä¼šåœ¨å…¶ä»–Javaè™šæ‹ŸæœºæŒ‡ä»¤æ£€æµ‹åˆ°å¼‚å¸¸çŠ¶å†µæ—¶è‡ªåŠ¨æŠ›å‡ºã€‚ä¾‹å¦‚å‰é¢ä»‹ç»æ•´æ•°è¿ç®—ä¸­ï¼Œå½“é™¤æ•°ä¸ºé›¶æ—¶ï¼Œè™šæ‹Ÿæœºä¼šåœ¨idivæˆ–ldivæŒ‡ä»¤ä¸­æŠ›å‡ºArithmeticExceptionå¼‚å¸¸ã€‚è€Œåœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œå¤„ç†å¼‚å¸¸ï¼ˆcatchè¯­å¥ï¼‰ä¸æ˜¯ç”±å­—èŠ‚ç æŒ‡ä»¤æ¥å®ç°çš„ï¼ˆå¾ˆä¹…ä¹‹å‰æ›¾ç»ä½¿ç”¨jsrå’ŒretæŒ‡ä»¤æ¥å®ç°ï¼Œç°åœ¨å·²ç»ä¸ç”¨äº†ï¼‰ï¼Œè€Œæ˜¯é‡‡ç”¨å¼‚å¸¸è¡¨æ¥å®Œæˆã€‚</p><h3 id="åã€åŒæ­¥æŒ‡ä»¤"><a href="#åã€åŒæ­¥æŒ‡ä»¤" class="headerlink" title="åã€åŒæ­¥æŒ‡ä»¤"></a>åã€åŒæ­¥æŒ‡ä»¤</h3><p>Javaè™šæ‹Ÿæœºå¯ä»¥æ”¯æŒæ–¹æ³•çº§çš„åŒæ­¥å’Œæ–¹æ³•å†…éƒ¨ä¸€æ®µæŒ‡ä»¤åºåˆ—çš„åŒæ­¥ï¼Œè¿™ä¸¤ç§åŒæ­¥ç»“æ„éƒ½æ˜¯ä½¿ç”¨ç®¡ç¨‹ï¼ˆ<code>Monitor</code>ï¼Œæ›´å¸¸è§çš„æ˜¯ç›´æ¥å°†å®ƒç§°ä¸ºâ€œé”â€ï¼‰æ¥å®ç°çš„ã€‚</p><p>æ–¹æ³•çº§çš„åŒæ­¥æ˜¯éšå¼çš„ï¼Œæ— é¡»é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶ï¼Œå®ƒå®ç°åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›æ“ä½œä¹‹ä¸­ã€‚è™šæ‹Ÿæœºå¯ä»¥ä»æ–¹æ³•å¸¸é‡æ± ä¸­çš„æ–¹æ³•è¡¨ç»“æ„ä¸­çš„<code>ACC_SYNCHRONIZED</code>è®¿é—®æ ‡å¿—å¾—çŸ¥ä¸€ä¸ªæ–¹æ³•æ˜¯å¦è¢«å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ã€‚å½“æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼šæ£€æŸ¥æ–¹æ³•çš„<code>ACC_SYNCHRONIZED</code>è®¿é—®æ ‡å¿—æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹å°±è¦æ±‚å…ˆæˆåŠŸæŒæœ‰ç®¡ç¨‹ï¼Œç„¶åæ‰èƒ½æ‰§è¡Œæ–¹æ³•ï¼Œæœ€åå½“æ–¹æ³•å®Œæˆï¼ˆæ— è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯éæ­£å¸¸å®Œæˆï¼‰æ—¶é‡Šæ”¾ç®¡ç¨‹ã€‚åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œæ‰§è¡Œçº¿ç¨‹æŒæœ‰äº†ç®¡ç¨‹ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ— æ³•å†è·å–åˆ°åŒä¸€ä¸ªç®¡ç¨‹ã€‚å¦‚æœä¸€ä¸ªåŒæ­¥æ–¹æ³•æ‰§è¡ŒæœŸé—´æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å†…éƒ¨æ— æ³•å¤„ç†æ­¤å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªåŒæ­¥æ–¹æ³•æ‰€æŒæœ‰çš„ç®¡ç¨‹å°†åœ¨å¼‚å¸¸æŠ›åˆ°åŒæ­¥æ–¹æ³•è¾¹ç•Œä¹‹å¤–æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚</p><p>åŒæ­¥ä¸€æ®µæŒ‡ä»¤é›†åºåˆ—é€šå¸¸æ˜¯ç”±Javaè¯­è¨€ä¸­çš„<code>synchronized</code>è¯­å¥å—æ¥è¡¨ç¤ºçš„ï¼ŒJavaè™šæ‹Ÿæœºçš„æŒ‡ä»¤é›†ä¸­æœ‰<code>monitorenter</code>å’Œ<code>monitorexit</code>ä¸¤æ¡æŒ‡ä»¤æ¥æ”¯æŒ<code>synchronized</code>å…³é”®å­—çš„è¯­ä¹‰ï¼Œæ­£ç¡®å®ç°<code>synchronized</code>å…³é”®å­—éœ€è¦Javacç¼–è¯‘å™¨ä¸Javaè™šæ‹Ÿæœºä¸¤è€…å…±åŒåä½œæ”¯æŒ</p><p>javaä»£ç </p><pre class=" language-java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">onlyMe</span><span class="token punctuation">(</span>Foo f<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">synchronized</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¯¹åº”çš„å­—èŠ‚ç æ¸…å•ï¼š</p><pre class=" language-txt"><code class="language-txt">Method void onlyMe(Foo)0 aload_1                         // å°†å¯¹è±¡få…¥æ ˆ1 dup                           // å¤åˆ¶æ ˆé¡¶å…ƒç´ ï¼ˆå³fçš„å¼•ç”¨ï¼‰2 astore_2                        // å°†æ ˆé¡¶å…ƒç´ å­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨å˜é‡æ§½ 2ä¸­3 monitorenter                    // ä»¥æ ˆå®šå…ƒç´ ï¼ˆå³fï¼‰ä½œä¸ºé”ï¼Œå¼€å§‹åŒæ­¥4 aload_0                         // å°†å±€éƒ¨å˜é‡æ§½ 0ï¼ˆå³thisæŒ‡é’ˆï¼‰çš„å…ƒç´ å…¥æ ˆ5 invokevirtual #5                // è°ƒç”¨doSomething()æ–¹æ³•8 aload_2                         // å°†å±€éƒ¨å˜é‡Slow 2çš„å…ƒç´ ï¼ˆå³fï¼‰å…¥æ ˆ9 monitorexit                     // é€€å‡ºåŒæ­¥10 goto 18                        // æ–¹æ³•æ­£å¸¸ç»“æŸï¼Œè·³è½¬åˆ°18è¿”å›13 astore_3                       // ä»è¿™æ­¥å¼€å§‹æ˜¯å¼‚å¸¸è·¯å¾„ï¼Œè§ä¸‹é¢å¼‚å¸¸è¡¨çš„Taget 1314 aload_2                        // å°†å±€éƒ¨å˜é‡Slow 2çš„å…ƒç´ ï¼ˆå³fï¼‰å…¥æ ˆ15 monitorexit                    // é€€å‡ºåŒæ­¥16 aload_3                        // å°†å±€éƒ¨å˜é‡Slow 3çš„å…ƒç´ ï¼ˆå³å¼‚å¸¸å¯¹è±¡ï¼‰å…¥æ ˆ17 athrow                         // æŠŠå¼‚å¸¸å¯¹è±¡é‡æ–°æŠ›å‡ºç»™onlyMe()æ–¹æ³•çš„è°ƒç”¨è€…18 return                         // æ–¹æ³•æ­£å¸¸è¿”å›Exception table:FromTo Target Type   4    10     13 any  13    16     13 any</code></pre><p>ç¼–è¯‘å™¨å¿…é¡»ç¡®ä¿æ— è®ºæ–¹æ³•é€šè¿‡ä½•ç§æ–¹å¼å®Œæˆï¼Œæ–¹æ³•ä¸­è°ƒç”¨è¿‡çš„æ¯æ¡<code>monitorenter</code>æŒ‡ä»¤éƒ½å¿…é¡»æœ‰å…¶å¯¹åº”çš„<code>monitorexit</code>æŒ‡ä»¤ï¼Œè€Œæ— è®ºè¿™ä¸ªæ–¹æ³•æ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯å¼‚å¸¸ç»“æŸã€‚</p><p>ä¸ºäº†ä¿è¯åœ¨æ–¹æ³•å¼‚å¸¸å®Œæˆæ—¶<code>monitorenter</code>å’Œ<code>monitorexit</code>æŒ‡ä»¤ä¾ç„¶å¯ä»¥æ­£ç¡®é…å¯¹æ‰§è¡Œï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºï¼Œè¿™ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºå£°æ˜å¯å¤„ç†æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå®ƒçš„ç›®çš„å°±æ˜¯ç”¨æ¥æ‰§è¡Œ<code>monitorexit</code>æŒ‡ä»¤ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> å­—èŠ‚ç æŒ‡ä»¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmç›‘æ§è°ƒä¼˜å·¥å…·</title>
      <link href="/posts/ed0fd586.html"/>
      <url>/posts/ed0fd586.html</url>
      
        <content type="html"><![CDATA[<h2 id="JVMå¸¸ç”¨å·¥å…·"><a href="#JVMå¸¸ç”¨å·¥å…·" class="headerlink" title="JVMå¸¸ç”¨å·¥å…·"></a>JVMå¸¸ç”¨å·¥å…·</h2><p>ä¹‹æ‰€ä»¥è¦ä½¿ç”¨JVMå·¥å…·å½“ç„¶æ˜¯ä¸ºäº†å®šä½ç³»ç»Ÿé—®é¢˜ã€‚å¸¸è§çš„å¯ä¾èµ–çš„æ•°æ®åŒ…æ‹¬ä½†ä¸é™äºå¼‚å¸¸å †æ ˆã€è™šæ‹Ÿæœºè¿è¡Œæ—¥å¿—ã€åƒåœ¾æ”¶é›†æ—¥å¿—ã€çº¿ç¨‹å¿«ç…§ï¼ˆthreadump/javacoreæ–‡ä»¶ï¼‰ã€å †è½¬å‚¨å¿«ç…§ï¼ˆheapdump/ hprofæ–‡ä»¶ï¼‰ç­‰ã€‚</p><h3 id="ä¸€ã€åŸºç¡€æ•…éšœå¤„ç†å·¥å…·"><a href="#ä¸€ã€åŸºç¡€æ•…éšœå¤„ç†å·¥å…·" class="headerlink" title="ä¸€ã€åŸºç¡€æ•…éšœå¤„ç†å·¥å…·"></a>ä¸€ã€åŸºç¡€æ•…éšœå¤„ç†å·¥å…·</h3><p>ä¸»è¦åˆ†ä¸‰ç±»ï¼š</p><p>ï¼ˆaï¼‰å•†ä¸šæˆæƒå·¥å…·ã€‚</p><blockquote><p>ä¸»è¦æ˜¯JMCï¼ˆJava Mission Controlï¼‰åŠå®ƒè¦ä½¿ç”¨åˆ°çš„JFRï¼ˆJava Flight Recorderï¼‰ã€‚</p></blockquote><p>ï¼ˆbï¼‰æ­£å¼æ”¯æŒå·¥å…·.</p><blockquote><p>è¿™ä¸€ç±»å·¥å…·å±äºè¢«é•¿æœŸæ”¯æŒçš„å·¥å…·ï¼Œä¸åŒå¹³å°ã€ä¸åŒç‰ˆæœ¬çš„JDKä¹‹é—´ï¼Œè¿™ç±»å·¥å…·å¯èƒ½ä¼šç•¥æœ‰å·®å¼‚ï¼Œä½†æ˜¯ä¸ä¼šå‡ºç°æŸä¸€ä¸ªå·¥å…·çªç„¶æ¶ˆå¤±çš„æƒ…å†µã€‚</p></blockquote><p>ï¼ˆcï¼‰å®éªŒæ€§å·¥å…·ã€‚</p><blockquote><p>è¿™ä¸€ç±»å·¥å…·åœ¨å®ƒä»¬çš„ä½¿ç”¨è¯´æ˜ä¸­è¢«å£°æ˜ä¸ºâ€æ²¡æœ‰æŠ€æœ¯æ”¯æŒï¼Œå¹¶ä¸”æ˜¯å®éªŒæ€§è´¨çš„â€ï¼ˆUnsupported and Experimentalï¼‰äº§å“ï¼Œæ—¥åå¯èƒ½ä¼šè½¬æ­£ï¼Œä¹Ÿå¯èƒ½ä¼šåœ¨æŸä¸ªJDKç‰ˆæœ¬ä¸­æ— å£°æ— æ¯åœ°æ¶ˆå¤±ã€‚ä½†äº‹å®ä¸Šå®ƒä»¬é€šå¸¸éƒ½éå¸¸ç¨³å®šè€Œä¸”åŠŸèƒ½å¼ºå¤§ï¼Œä¹Ÿèƒ½åœ¨å¤„ç†åº”ç”¨ç¨‹åºæ€§èƒ½é—®é¢˜ã€å®šä½æ•…éšœæ—¶å‘æŒ¥å¾ˆå¤§çš„ä½œç”¨ã€‚</p></blockquote><p>JDK5éœ€è¦æ‰‹åŠ¨å¼€å¯JMX:â€<code>-Dcom.sun.management.jmxremote</code>â€œå¼€å¯JMXç®¡ç†åŠŸèƒ½ã€‚</p><h4 id="1ã€jps"><a href="#1ã€jps" class="headerlink" title="1ã€jps"></a>1ã€jps</h4><p>jpsï¼ˆJVMProcess Status Toolï¼‰æ˜¯è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶å†µå·¥å…·ã€‚</p><blockquote><p>å¯ä»¥åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œå¹¶æ˜¾ç¤ºè™šæ‹Ÿæœºæ‰§è¡Œä¸»ç±»ï¼ˆMain Classï¼Œmain()å‡½æ•°æ‰€åœ¨çš„ç±»ï¼‰åç§°ä»¥åŠè¿™äº›è¿›ç¨‹çš„æœ¬åœ°è™šæ‹Ÿæœºå”¯ä¸€IDï¼ˆLVMIDï¼ŒLocal Virtual Machine Identifierï¼‰ã€‚</p><p>å¯ä»¥é€šè¿‡RMIåè®®æŸ¥è¯¢å¼€å¯äº†RMIæœåŠ¡çš„è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶æ€ï¼Œå‚æ•°hostidä¸ºRMIæ³¨å†Œè¡¨ä¸­æ³¨å†Œçš„ä¸»æœºåã€‚</p></blockquote><p>ç‰¹ç‚¹ï¼šåŠŸèƒ½å•ä¸€ï¼Œä½¿ç”¨é¢‘ç‡æœ€é«˜</p><p>å‘½ä»¤æ ¼å¼ï¼š</p><pre><code>jps [ options ] [ hostid ]</code></pre><p>å¦‚ï¼šjsp -l</p><p>optionsä¸»è¦æœ‰4ä¸ª</p><table><thead><tr><th align="center">é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td align="center">-q</td><td>åªè¾“å‡ºLVMIDï¼Œçœç•¥ä¸»ç±»åç§°</td></tr><tr><td align="center">-m</td><td>è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶ä¼ é€’ç»™ä¸»ç±»main() å‡½æ•°çš„å‚æ•°</td></tr><tr><td align="center">-l</td><td>è¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„jaråŒ…ï¼Œåˆ™è¾“å‡ºjarå…¨è·¯å¾„</td></tr><tr><td align="center">-v</td><td>è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶çš„JVMå‚æ•°</td></tr></tbody></table><h4 id="2ã€jstat"><a href="#2ã€jstat" class="headerlink" title="2ã€jstat"></a>2ã€jstat</h4><p>jstatï¼ˆJVM Statistics Monitoring Toolï¼‰æ˜¯è™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…·ã€‚</p><blockquote><p>ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒå¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…è¿œç¨‹[æ’å›¾]è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»åŠ è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€å³æ—¶ç¼–è¯‘ç­‰è¿è¡Œæ—¶æ•°æ®ï¼Œåœ¨æ²¡æœ‰GUIå›¾å½¢ç•Œé¢ã€åªæä¾›äº†çº¯æ–‡æœ¬æ§åˆ¶å°ç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒå°†æ˜¯è¿è¡ŒæœŸå®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜çš„å¸¸ç”¨å·¥å…·ã€‚</p></blockquote><p>jstatå‘½ä»¤æ ¼å¼ä¸ºï¼š</p><pre class=" language-bash"><code class="language-bash">jstat <span class="token punctuation">[</span> option vmid <span class="token punctuation">[</span> interval<span class="token punctuation">[</span>s<span class="token operator">|</span>ms<span class="token punctuation">]</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">]</span></code></pre><p>å¦‚æœæ˜¯æœ¬åœ°è™šæ‹Ÿæœºè¿›ç¨‹ï¼ŒVMIDä¸LVMIDæ˜¯ä¸€è‡´çš„ï¼›å¦‚æœæ˜¯è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œé‚£VMIDçš„æ ¼å¼åº”å½“æ˜¯ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>protocal:<span class="token punctuation">]</span><span class="token punctuation">[</span>//<span class="token punctuation">]</span>lvmid<span class="token punctuation">[</span>@hostname<span class="token punctuation">[</span>:port<span class="token punctuation">]</span>/servername<span class="token punctuation">]</span></code></pre><p>å‚æ•°intervalå’Œcountä»£è¡¨æŸ¥è¯¢é—´éš”å’Œæ¬¡æ•°ï¼Œå¦‚æœçœç•¥è¿™2ä¸ªå‚æ•°ï¼Œè¯´æ˜åªæŸ¥è¯¢ä¸€æ¬¡ã€‚</p><p>å‡è®¾éœ€è¦æ¯250æ¯«ç§’æŸ¥è¯¢ä¸€æ¬¡è¿›ç¨‹10164åƒåœ¾æ”¶é›†çŠ¶å†µï¼Œä¸€å…±æŸ¥è¯¢20æ¬¡ï¼Œé‚£å‘½ä»¤åº”å½“æ˜¯ï¼š</p><pre class=" language-bash"><code class="language-bash">jstat -gc 10164 250 20</code></pre><p>é€‰é¡¹optionä»£è¡¨ç”¨æˆ·å¸Œæœ›æŸ¥è¯¢çš„è™šæ‹Ÿæœºä¿¡æ¯ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼šç±»åŠ è½½ã€åƒåœ¾æ”¶é›†ã€è¿è¡ŒæœŸç¼–è¯‘çŠ¶å†µã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-options-jstat.jpg" alt="jstatä¸»è¦é€‰é¡¹"></p><p> jstatæ‰§è¡Œæ ·ä¾‹ï¼š</p><pre><code>jstat -gcutil 2764S0      S1      E       O        P        YGC    YGCT     FGC    FGCT     GCT0.00    0.00    6.20    41.42    47.20    16     0.105    3      0.472    0.577</code></pre><p>æ–°ç”Ÿä»£EdenåŒºï¼ˆEï¼Œè¡¨ç¤ºEdenï¼‰ä½¿ç”¨äº†6.2%çš„ç©ºé—´ï¼Œ2ä¸ªSurvivoråŒºï¼ˆS0ã€S1ï¼Œè¡¨ç¤ºSurvivor0ã€Survivor1ï¼‰é‡Œé¢éƒ½æ˜¯ç©ºçš„ï¼Œè€å¹´ä»£ï¼ˆOï¼Œè¡¨ç¤ºOldï¼‰å’Œæ°¸ä¹…ä»£ï¼ˆPï¼Œè¡¨ç¤ºPermanentï¼‰åˆ™åˆ†åˆ«ä½¿ç”¨äº†41.42%å’Œ47.20%çš„ç©ºé—´ã€‚ç¨‹åºè¿è¡Œä»¥æ¥å…±å‘ç”ŸMinorGCï¼ˆYGCï¼Œè¡¨ç¤ºYoung GCï¼‰16æ¬¡ï¼Œæ€»è€—æ—¶0.105ç§’ï¼›å‘ç”ŸFullGCï¼ˆFGCï¼Œè¡¨ç¤ºFull GCï¼‰3æ¬¡ï¼Œæ€»è€—æ—¶ï¼ˆFGCTï¼Œè¡¨ç¤ºFull GC Timeï¼‰ä¸º0.472ç§’ï¼›æ‰€æœ‰GCæ€»è€—æ—¶ï¼ˆGCTï¼Œè¡¨ç¤ºGC Timeï¼‰ä¸º0.577ç§’ã€‚</p><p>å¦‚æœä½¿ç”¨æ—¶é‡åˆ°è¿™æ ·å•ä¸ªå­—æ¯è¦è®¤è¯†ã€‚</p><h4 id="3ã€jinfo"><a href="#3ã€jinfo" class="headerlink" title="3ã€jinfo"></a>3ã€jinfo</h4><p>jinfoï¼ˆConfiguration Info for Javaï¼‰çš„æ˜¯Javaé…ç½®ä¿¡æ¯å·¥å…·ã€‚</p><p>ä½œç”¨æ˜¯å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºå„é¡¹å‚æ•°ã€‚</p><p><code>jps  -v</code>å¯ä»¥æŸ¥çœ‹è™šæ‹Ÿæœºå¯åŠ¨æ—¶æ˜¾å¼æŒ‡å®šçš„å‚æ•°åˆ—è¡¨ã€‚</p><p><code>jinfo  -flag</code>å¯ä»¥æŸ¥çœ‹è™šæ‹Ÿæœºæœªè¢«æ˜¾å¼æŒ‡å®šçš„å‚æ•°çš„ç³»ç»Ÿé»˜è®¤å€¼ã€‚è‹¥jdk6ä»¥ä¸Šç‰ˆæœ¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>-XXï¼š+PrintFlagsFinal</code>æŸ¥çœ‹å‚æ•°é»˜è®¤å€¼ã€‚</p><p><code>jinfo  -sysprops</code>å¯ä»¥æŠŠè™šæ‹Ÿæœºè¿›ç¨‹çš„System.getProperties()çš„å†…å®¹æ‰“å°å‡ºæ¥ã€‚è¿™ä¸ªå‘½ä»¤åœ¨JDK 5æ—¶æœŸå·²ç»éšç€Linuxç‰ˆçš„JDKå‘å¸ƒï¼Œå½“æ—¶åªæä¾›äº†ä¿¡æ¯æŸ¥è¯¢çš„åŠŸèƒ½ï¼ŒJDK 6ä¹‹åï¼Œjinfoåœ¨Windowså’ŒLinuxå¹³å°éƒ½æœ‰æä¾›ï¼Œå¹¶ä¸”åŠ å…¥äº†åœ¨è¿è¡ŒæœŸä¿®æ”¹éƒ¨åˆ†å‚æ•°å€¼çš„èƒ½åŠ›ï¼ˆå¯ä»¥ä½¿ç”¨-flag[+|-]nameæˆ–è€…-flag name=valueåœ¨è¿è¡ŒæœŸä¿®æ”¹ä¸€éƒ¨åˆ†è¿è¡ŒæœŸå¯å†™çš„è™šæ‹Ÿæœºå‚æ•°å€¼ï¼‰ã€‚</p><p>åœ¨JDK 6ä¸­ï¼Œjinfoå¯¹äºWindowså¹³å°åŠŸèƒ½ä»ç„¶æœ‰è¾ƒå¤§é™åˆ¶ï¼Œåªæä¾›äº†æœ€åŸºæœ¬çš„-flagé€‰é¡¹ã€‚</p><p>å‘½ä»¤æ ¼å¼ï¼š</p><pre class=" language-bash"><code class="language-bash">jinfo  <span class="token punctuation">[</span> option <span class="token punctuation">]</span> pid</code></pre><p>æ‰§è¡Œæ ·ä¾‹ï¼šæŸ¥è¯¢CMSInitiatingOccupancyFractionå‚æ•°å€¼:</p><pre class=" language-bash"><code class="language-bash">jinfo -flag CMSInitiatingOccupancyFraction 1444-XX:CMSInitiatingOccupancyFraction<span class="token operator">=</span>85</code></pre><h4 id="4ã€jmap"><a href="#4ã€jmap" class="headerlink" title="4ã€jmap"></a>4ã€jmap</h4><p>jmapâ€”Javaå†…å­˜æ˜ åƒå·¥å…·ã€‚</p><p>jmapï¼ˆMemory Map for Javaï¼‰å‘½ä»¤ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸ºheapdumpæˆ–dumpæ–‡ä»¶ï¼‰ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢finalizeæ‰§è¡Œé˜Ÿåˆ—ã€Javaå †å’Œæ–¹æ³•åŒºçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ç©ºé—´ä½¿ç”¨ç‡ã€å½“å‰ç”¨çš„æ˜¯å“ªç§æ”¶é›†å™¨ç­‰ã€‚</p><p>å¦‚æœä¸ä½¿ç”¨jmapå‘½ä»¤å‘¢?</p><p>ï¼ˆaï¼‰ä½¿ç”¨<code>-XXï¼š+HeapDumpOnOutOfMemoryError</code>å‚ï¼Œå¯ä»¥è®©è™šæ‹Ÿæœºåœ¨å†…å­˜æº¢å‡ºå¼‚å¸¸å‡ºç°ä¹‹åè‡ªåŠ¨ç”Ÿæˆå †è½¬å‚¨å¿«ç…§æ–‡ä»¶ã€‚</p><p>ï¼ˆbï¼‰é€šè¿‡-XXï¼š+HeapDumpOnCtrlBreakå‚æ•°åˆ™å¯ä»¥ä½¿ç”¨[Ctrl]+[Break]é”®è®©è™šæ‹Ÿæœºç”Ÿæˆå †è½¬å‚¨å¿«ç…§æ–‡ä»¶ã€‚</p><p>ï¼ˆcï¼‰åœ¨Linuxç³»ç»Ÿä¸‹é€šè¿‡<code>Kill  -3</code>å‘½ä»¤å‘é€è¿›ç¨‹é€€å‡ºä¿¡å·â€æå“â€ä¸€ä¸‹è™šæ‹Ÿæœºï¼Œä¹Ÿèƒ½é¡ºåˆ©æ‹¿åˆ°å †è½¬å‚¨å¿«ç…§ã€‚</p><blockquote><p>jmapæœ‰éƒ¨åˆ†åŠŸèƒ½åœ¨Windowså¹³å°ä¸‹æ˜¯å—é™çš„ï¼Œé™¤äº†ç”Ÿæˆå †è½¬å‚¨å¿«ç…§çš„-dumpé€‰é¡¹å’Œç”¨äºæŸ¥çœ‹æ¯ä¸ªç±»çš„å®ä¾‹ã€ç©ºé—´å ç”¨ç»Ÿè®¡çš„-histoé€‰é¡¹åœ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿä¸­éƒ½å¯ä»¥ä½¿ç”¨ä¹‹å¤–ï¼Œå…¶ä½™é€‰é¡¹éƒ½åªèƒ½åœ¨Linux/Solarisä¸­ä½¿ç”¨ã€‚</p></blockquote><p>jmapå‘½ä»¤æ ¼å¼ï¼š</p><pre class=" language-bash"><code class="language-bash">jmap <span class="token punctuation">[</span> option <span class="token punctuation">]</span> vmid</code></pre><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-options-jmap.jpg" alt="jmapä¸»è¦é€‰é¡¹"></p><p>ä½¿ç”¨jmapç”Ÿæˆä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„Eclipseçš„å †è½¬å‚¨å¿«ç…§æ–‡ä»¶ï¼Œ12109æ˜¯é€šè¿‡jpså‘½ä»¤æŸ¥è¯¢åˆ°çš„LVMIDã€‚</p><pre class=" language-bash"><code class="language-bash">jmap -dump:format<span class="token operator">=</span>b,file<span class="token operator">=</span>eclipse.bin 12109Dumping heap to D:\eclipse.bin <span class="token punctuation">..</span>.Heap dump <span class="token function">file</span> created</code></pre><h4 id="5ã€jhat"><a href="#5ã€jhat" class="headerlink" title="5ã€jhat"></a>5ã€jhat</h4><p>jhatè™šæ‹Ÿæœºå †è½¬å‚¨å¿«ç…§åˆ†æå·¥å…·ã€‚</p><p>JDKæä¾›jhatï¼ˆJVM Heap Analysis Toolï¼‰å‘½ä»¤ä¸jmapæ­é…ä½¿ç”¨ï¼Œæ¥åˆ†æjmapç”Ÿæˆçš„å †è½¬å‚¨å¿«ç…§ã€‚jhatå†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„HTTP/WebæœåŠ¡å™¨ï¼Œç”Ÿæˆå †è½¬å‚¨å¿«ç…§çš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚</p><blockquote><p>åˆ†æå·¥ä½œæ˜¯ä¸€ä¸ªè€—æ—¶è€Œä¸”æä¸ºè€—è´¹ç¡¬ä»¶èµ„æºçš„è¿‡ç¨‹ï¼Œä¸€èˆ¬ä¸ç›´æ¥åœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šè¿™ä¹ˆæã€‚</p><p>jhatçš„åˆ†æåŠŸèƒ½ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€é™‹ï¼Œä¸VisualVMï¼Œä»¥åŠä¸“ä¸šç”¨äºåˆ†æå †è½¬Eclipse Memory Analyzerã€IBM HeapAnalyzerç­‰ç›¸æ¯”ã€‚</p></blockquote><p>ä½¿ç”¨jhatåˆ†ædumpæ–‡ä»¶ï¼š</p><pre class=" language-bash"><code class="language-bash">jhat eclipse.binReading from eclipse.bin<span class="token punctuation">..</span>.Dump <span class="token function">file</span> created Fri Nov 19 22:07:21 CST 2010Snapshot read, resolving<span class="token punctuation">..</span>.Resolving 1225951 objects<span class="token punctuation">..</span>.Chasing references, <span class="token function">expect</span> 245 dots<span class="token punctuation">..</span><span class="token punctuation">..</span>Eliminating duplicate references<span class="token punctuation">..</span>.Snapshot resolved.Started HTTP server on port 7000Server is ready.</code></pre><p>åˆ†æç»“æœé»˜è®¤ä»¥åŒ…ä¸ºå•ä½è¿›è¡Œåˆ†ç»„æ˜¾ç¤ºï¼Œåˆ†æå†…å­˜æ³„æ¼é—®é¢˜ä¸»è¦ä¼šä½¿ç”¨åˆ°å…¶ä¸­çš„â€Heap Histogramâ€ï¼ˆä¸<code>jmap -histo</code>åŠŸèƒ½ä¸€æ ·ï¼‰ä¸OQLé¡µç­¾çš„åŠŸèƒ½ï¼Œå‰è€…å¯ä»¥æ‰¾åˆ°å†…å­˜ä¸­æ€»å®¹é‡æœ€å¤§çš„å¯¹è±¡ï¼ŒOQLæ˜¯æ ‡å‡†çš„å¯¹è±¡æŸ¥è¯¢è¯­è¨€ï¼Œä½¿ç”¨ç±»ä¼¼SQLçš„è¯­æ³•å¯¹å†…å­˜ä¸­çš„å¯¹è±¡è¿›è¡ŒæŸ¥è¯¢ç»Ÿè®¡ã€‚å…³äºOQL<a href=""> ã€ŠJVMçš„å¯¹è±¡æŸ¥è¯¢OQLã€‹</a></p><h4 id="6ã€jstack"><a href="#6ã€jstack" class="headerlink" title="6ã€jstack"></a>6ã€jstack</h4><p>jstackï¼šJavaå †æ ˆè·Ÿè¸ªå·¥å…·ã€‚</p><p>jstackï¼ˆStack Trace for Javaï¼‰å‘½ä»¤ç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸ºthreaddumpæˆ–è€…javacoreæ–‡ä»¶ï¼‰ã€‚</p><p>çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆã€‚</p><p>ç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ç›®çš„é€šå¸¸æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´æŒ‚èµ·ç­‰ï¼Œéƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„å¸¸è§åŸå› ã€‚çº¿ç¨‹å‡ºç°åœé¡¿æ—¶é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥è·çŸ¥æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ç€ä»€ä¹ˆèµ„æºã€‚</p><p>jstackå‘½ä»¤æ ¼å¼ï¼š</p><pre><code>jstack  [ option ] vmid</code></pre><p> jstackå·¥å…·ä¸»è¦é€‰é¡¹:</p><table><thead><tr><th align="center">é€‰é¡¹</th><th align="left">ä½œç”¨</th></tr></thead><tbody><tr><td align="center">-F</td><td align="left">å½“æ­£å¸¸è¾“å‡ºçš„è¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ</td></tr><tr><td align="center">-l</td><td align="left">é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯</td></tr><tr><td align="center">-m</td><td align="left">å¦‚æœé‡åˆ°æœ¬åœ°æ–¹æ³•çš„è¯ï¼Œå¯ä»¥æ˜¾ç¤ºC/C++çš„å †æ ˆ</td></tr></tbody></table><blockquote><p>ä»JDK 5èµ·ï¼Œjava.lang.Threadç±»æ–°å¢äº†ä¸€ä¸ªgetAllStackTraces()æ–¹æ³•ç”¨äºè·å–è™šæ‹Ÿæœºä¸­æ‰€æœ‰çº¿ç¨‹çš„StackTraceElementå¯¹è±¡ã€‚ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥é€šè¿‡ç®€å•çš„å‡ è¡Œä»£ç å®Œæˆjstackçš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ä¸å¦¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•åšä¸ªç®¡ç†å‘˜é¡µé¢ï¼Œå¯ä»¥éšæ—¶ä½¿ç”¨æµè§ˆå™¨æ¥æŸ¥çœ‹çº¿ç¨‹å †æ ˆã€‚</p></blockquote><p>æŸ¥çœ‹çº¿ç¨‹çŠ¶å†µçš„JSPé¡µé¢ï¼š</p><pre class=" language-html"><code class="language-html">&lt;%@ page import="java.util.Map"%><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>æœåŠ¡å™¨çº¿ç¨‹ä¿¡æ¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span>    <span class="token attr-name">for</span> <span class="token attr-name">(Map.Entry&lt;Thread,</span> <span class="token attr-name">StackTraceElement[]</span><span class="token punctuation">></span></span> stackTrace : Thread.getAllStack-Traces().entrySet()) {        Thread thread = (Thread) stackTrace.getKey();        StackTraceElement[] stack = (StackTraceElement[]) stackTrace.getValue();        if (thread.equals(Thread.currentThread())) {            continue;        }        out.print("\nçº¿ç¨‹ï¼š" + thread.getName() + "\n");        for (StackTraceElement element : stack) {            out.print("\t"+element+"\n");        }    }%><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h4 id="7ã€å…¶ä»–"><a href="#7ã€å…¶ä»–" class="headerlink" title="7ã€å…¶ä»–"></a>7ã€å…¶ä»–</h4><p> åŸºç¡€å·¥å…·ï¼š</p><p>ç”¨äºæ”¯æŒåŸºæœ¬çš„ç¨‹åºåˆ›å»ºå’Œè¿è¡Œã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-list.jpg" alt="åŸºç¡€å·¥å…·"></p><p>å®‰å…¨ï¼š</p><p>ç”¨äºç¨‹åºç­¾åã€è®¾ç½®å®‰å…¨æµ‹è¯•ç­‰ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-anquan.jpg" alt="å®‰å…¨å·¥å…·"></p><p>å›½é™…åŒ–ï¼š</p><p>ç”¨äºåˆ›å»ºæœ¬åœ°è¯­è¨€æ–‡ä»¶ã€‚</p><table><thead><tr><th align="center">åç§°</th><th>ä¸»è¦ä½œç”¨</th></tr></thead><tbody><tr><td align="center">native2ascii</td><td>æœ¬åœ°ç¼–ç åˆ°ASCIIç¼–ç çš„è½¬æ¢å™¨ï¼ˆNative-to-ASCII Converterï¼‰ç”¨äºâ€ä»»æ„å—æ”¯æŒçš„å­—ç¬¦ç¼–ç â€å’Œä¸ä¹‹å¯¹åº”çš„â€ASCIIç¼–ç å’ŒUnicodeè½¬ä¹‰â€ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚</td></tr></tbody></table><p>è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼š</p><p>ç”¨äºè·¨Webæˆ–ç½‘ç»œçš„æœåŠ¡äº¤äº’ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-rmi.jpg" alt="è¿œç¨‹æ–¹æ³•è°ƒç”¨å·¥å…·"></p><p>Java IDLä¸RMI-IIOPï¼šåœ¨JDK 11ä¸­ç»“æŸäº†åä½™å¹´çš„CORBAæ”¯æŒï¼Œè¿™äº›å·¥å…·ä¸å†æä¾›ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-idl.jpg" alt="Java IDLä¸RMI-IIOP"></p><p>éƒ¨ç½²å·¥å…·ï¼šç”¨äºç¨‹åºæ‰“åŒ…ã€å‘å¸ƒå’Œéƒ¨ç½²ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-deploy.jpg" alt="Java IDLä¸RMI-IIOP"></p><p>Java Web Startï¼š</p><table><thead><tr><th align="center">åç§°</th><th align="center">ä¸»è¦ä½œç”¨</th></tr></thead><tbody><tr><td align="center">javaws</td><td align="center">å¯åŠ¨Java Web Startå¹¶è®¾ç½®å„ç§é€‰é¡¹çš„å·¥å…·ã€‚jdk11å·²ç§»é™¤ã€‚</td></tr></tbody></table><p>æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†ï¼š</p><p>ç”¨äºç›‘æ§åˆ†æJavaè™šæ‹Ÿæœºè¿è¡Œä¿¡æ¯ï¼Œæ’æŸ¥é—®é¢˜ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-contrl.jpg" alt="æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†"></p><p>WebServiceå·¥å…·ï¼š</p><p>ä¸CORBAä¸€èµ·åœ¨JDK 11ä¸­è¢«ç§»é™¤ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-webservice.jpg" alt="WebServiceå·¥å…·"></p><p>REPLå’Œè„šæœ¬å·¥å…·:</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-repl.jpg" alt="REPLå’Œè„šæœ¬å·¥å…·"></p><h3 id="äºŒã€å¯è§†åŒ–æ•…éšœå¤„ç†å·¥å…·"><a href="#äºŒã€å¯è§†åŒ–æ•…éšœå¤„ç†å·¥å…·" class="headerlink" title="äºŒã€å¯è§†åŒ–æ•…éšœå¤„ç†å·¥å…·"></a>äºŒã€å¯è§†åŒ–æ•…éšœå¤„ç†å·¥å…·</h3><p>JDKä¸­é™¤äº†é™„å¸¦å¤§é‡çš„å‘½ä»¤è¡Œå·¥å…·å¤–ï¼Œè¿˜æä¾›äº†å‡ ä¸ªåŠŸèƒ½é›†æˆåº¦æ›´é«˜çš„å¯è§†åŒ–å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›å¯è§†åŒ–å·¥å…·ä»¥æ›´åŠ ä¾¿æ·çš„æ–¹å¼è¿›è¡Œè¿›ç¨‹æ•…éšœè¯Šæ–­å’Œè°ƒè¯•å·¥ä½œã€‚</p><p>è¿™ç±»å·¥å…·ä¸»è¦åŒ…æ‹¬JConsoleã€JHSDBã€VisualVMå’ŒJMCå››ä¸ªã€‚</p><p>JConsoleã€JHSDBæ˜¯jdkæ­£å¼æˆå‘˜ï¼Œæ— é¡»ç‹¬ç«‹ä¸‹è½½ï¼Œä½¿ç”¨å®Œå…¨å…è´¹ã€‚</p><p>VisualVM å·²ä¸æ˜¯JDKä¸­çš„æ­£å¼æˆå‘˜ï¼Œä½†ä»æ˜¯å¯ä»¥å…è´¹ä¸‹è½½ã€ä½¿ç”¨ã€‚</p><p>Java Mission Control ï¼š JMCéœ€è¦ä¸HotSpotå†…éƒ¨çš„â€é£è¡Œè®°å½•ä»ªâ€ï¼ˆJava Flight Recorderï¼ŒJFRï¼‰é…åˆæ‰èƒ½å·¥ä½œï¼Œè€Œåœ¨JDK 11ä»¥å‰ï¼ŒJFRçš„å¼€å¯å¿…é¡»è§£é”OracleJDKçš„å•†ä¸šç‰¹æ€§æ”¯æŒï¼ˆä½¿ç”¨JCMDçš„VM.unlock_commercial_featuresæˆ–å¯åŠ¨æ—¶åŠ å…¥-XXï¼š+UnlockCommercialFeatureså‚æ•°ï¼‰ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä»ç„¶æ˜¯éœ€è¦ä»˜è´¹ä½¿ç”¨ã€‚</p><h4 id="1ã€JHSDB"><a href="#1ã€JHSDB" class="headerlink" title="1ã€JHSDB"></a>1ã€JHSDB</h4><p>JHSDBåŸºäºæœåŠ¡æ€§ä»£ç†çš„è°ƒè¯•å·¥å…·ã€‚</p><p>JDKä¸­æä¾›äº†JCMDå’ŒJHSDBä¸¤ä¸ªé›†æˆå¼çš„å¤šåŠŸèƒ½å·¥å…·ç®±ï¼Œæ•´åˆåŸºç¡€å¤„ç†å·¥å…·ï¼Œæ›´å¼ºå¤§ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-compare.jpg" alt="JCMDã€JHSDBå’ŒåŸºç¡€å·¥å…·çš„å¯¹æ¯”"></p><p>å·¥å…·çš„å‘½ä»¤æ¨¡å¼åŸºæœ¬ç›¸ä¼¼ã€‚ä½¿ç”¨æ—¶å€ŸåŠ©<code>help</code>é€‰é¡¹ä½¿ç”¨ã€‚</p><p>JHSDBæ˜¯ä¸€æ¬¾åŸºäºæœåŠ¡æ€§ä»£ç†ï¼ˆServiceability Agentï¼ŒSAï¼‰å®ç°çš„è¿›ç¨‹å¤–è°ƒè¯•å·¥å…·ã€‚</p><p>åŸç†ï¼š</p><blockquote><p>æœåŠ¡æ€§ä»£ç†æ˜¯HotSpotè™šæ‹Ÿæœºä¸­ä¸€ç»„ç”¨äºæ˜ å°„Javaè™šæ‹Ÿæœºè¿è¡Œä¿¡æ¯çš„ã€ä¸»è¦åŸºäºJavaè¯­è¨€ï¼ˆå«å°‘é‡JNIä»£ç ï¼‰å®ç°çš„APIé›†åˆã€‚æœåŠ¡æ€§ä»£ç†ä»¥HotSpotå†…éƒ¨çš„æ•°æ®ç»“æ„ä¸ºå‚ç…§ç‰©è¿›è¡Œè®¾è®¡ï¼ŒæŠŠè¿™äº›C++çš„æ•°æ®æŠ½è±¡å‡ºJavaæ¨¡å‹å¯¹è±¡ï¼Œç›¸å½“äºHotSpotçš„C++ä»£ç çš„ä¸€ä¸ªé•œåƒã€‚é€šè¿‡æœåŠ¡æ€§ä»£ç†çš„APIï¼Œå¯ä»¥åœ¨ä¸€ä¸ªç‹¬ç«‹çš„Javaè™šæ‹Ÿæœºçš„è¿›ç¨‹é‡Œåˆ†æå…¶ä»–HotSpotè™šæ‹Ÿæœºçš„å†…éƒ¨æ•°æ®ï¼Œæˆ–è€…ä»HotSpotè™šæ‹Ÿæœºè¿›ç¨‹å†…å­˜ä¸­dumpå‡ºæ¥çš„è½¬å‚¨å¿«ç…§é‡Œè¿˜åŸå‡ºå®ƒçš„è¿è¡ŒçŠ¶æ€ç»†èŠ‚ã€‚æœåŠ¡æ€§ä»£ç†çš„å·¥ä½œåŸç†è·ŸLinuxä¸Šçš„GDBæˆ–è€…Windowsä¸Šçš„Windbgæ˜¯ç›¸ä¼¼çš„ã€‚</p></blockquote><p>ï¼ˆJHSDBæœ¬èº«å¯¹å‹ç¼©æŒ‡é’ˆçš„æ”¯æŒå­˜åœ¨å¾ˆå¤šç¼ºé™·ï¼Œå»ºè®®ç”¨64ä½ç³»ç»Ÿçš„å®éªŒæ—¶ç¦ç”¨å‹ç¼©æŒ‡é’ˆï¼‰</p><pre><code>-Xmx10m -XX:+UseSerialGC -XX:-UseCompressedOops</code></pre><p>ç¨‹åºæ‰§è¡Œåé€šè¿‡jspæŸ¥è¯¢åˆ°æµ‹è¯•æŸ¥è¯¢è¿›ç¨‹IDï¼š</p><pre><code>jps -l  //æŸ¥çœ‹è¿›ç¨‹idjhsdb hsdb --pid 10987 //æ‰“å¼€å›¾å½¢åŒ–ç•Œé¢</code></pre><p>Tools-&gt;Heap Parameters å¯ä»¥çœ‹åˆ°å †çš„ç›¸å…³å‚æ•°ã€‚</p><p>Heap Parametersçª—å£ä¸­æ¸…æ¥šåˆ—å‡ºäº†æ–°ç”Ÿä»£çš„Edenã€S1ã€S2å’Œè€å¹´ä»£çš„å®¹é‡ï¼ˆå•ä½ä¸ºå­—èŠ‚ï¼‰ä»¥åŠå®ƒä»¬çš„è™šæ‹Ÿå†…å­˜åœ°å€èµ·æ­¢èŒƒå›´ã€‚</p><p>ä½¿ç”¨JDKé»˜è®¤çš„G1çš„è¯ï¼Œå¾—åˆ°çš„ä¿¡æ¯åº”è¯¥ç±»ä¼¼å¦‚ä¸‹æ‰€ç¤º</p><pre><code>Heap Parameters:garbage-first heap [0x00007f32c7800000, 0x00007f32c8200000] region size 1024K</code></pre><p>Windows-&gt;Consoleçª—å£ï¼Œä½¿ç”¨scanoopså‘½ä»¤åœ¨Javaå †çš„æ–°ç”Ÿä»£ï¼ˆä»Edenèµ·å§‹åœ°å€åˆ°To Survivorç»“æŸåœ°å€ï¼‰èŒƒå›´å†…æŸ¥æ‰¾ObjectHolderçš„å®ä¾‹ã€‚</p><pre class=" language-txt"><code class="language-txt">hsdb>scanoops 0x00007f32c7800000 0x00007f32c7b50000 JHSDB_TestCase$ObjectHolder0x00007f32c7a7c458 JHSDB_TestCase$ObjectHolder0x00007f32c7a7c480 JHSDB_TestCase$ObjectHolder0x00007f32c7a7c490 JHSDB_TestCase$ObjectHolder</code></pre><p>ä¸€èˆ¬å¯ä»¥é€šè¿‡è§‚å¯Ÿèµ·å§‹åœ°å€ï¼Œåˆ¤æ–­å®ä¾‹å¯¹è±¡åˆ†é…åœ¨å“ªä¸ªåŒºã€‚</p><p>Tools-&gt;InspectoråŠŸèƒ½å¯ä»¥ç¡®è®¤ä¸€ä¸‹è™šæ‹Ÿå†…å­˜åœ°å€ä¸­å­˜æ”¾çš„å¯¹è±¡ã€‚</p><p>Inspectorä¸ºæˆ‘ä»¬å±•ç¤ºäº†å¯¹è±¡å¤´å’ŒæŒ‡å‘å¯¹è±¡å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œé‡Œé¢åŒ…æ‹¬äº†Javaç±»å‹çš„åå­—ã€ç»§æ‰¿å…³ç³»ã€å®ç°æ¥å£å…³ç³»ï¼Œå­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€è¿è¡Œæ—¶å¸¸é‡æ± çš„æŒ‡é’ˆã€å†…åµŒçš„è™šæ–¹æ³•è¡¨ï¼ˆvtableï¼‰ä»¥åŠæ¥å£æ–¹æ³•è¡¨ï¼ˆitableï¼‰ç­‰ã€‚</p><p>Tools-&gt;Compute Reverse Ptrs å¯ä»¥æ ¹æ®å †ä¸­å¯¹è±¡å®ä¾‹åœ°å€æ‰¾å‡ºå¼•ç”¨å®ƒä»¬çš„æŒ‡é’ˆã€‚</p><p>å‘½ä»¤è¡Œä¹Ÿå¯ä»¥å®ç°è¯¥åŠŸèƒ½ï¼š<code>revptrs 0x0007f32cdf785</code> </p><p>ï¼ˆrevptrså‘½ä»¤å¹¶ä¸æ”¯æŒæŸ¥æ‰¾æ ˆä¸Šçš„æŒ‡é’ˆå¼•ç”¨ï¼‰</p><blockquote><p>JDK 7åŠå…¶ä»¥åç‰ˆæœ¬çš„HotSpotè™šæ‹Ÿæœºé€‰æ‹©æŠŠé™æ€å˜é‡ä¸ç±»å‹åœ¨Javaè¯­è¨€ä¸€ç«¯çš„æ˜ å°„Classå¯¹è±¡å­˜æ”¾åœ¨ä¸€èµ·ï¼Œå­˜å‚¨äºJavaå †ä¹‹ä¸­ã€‚</p></blockquote><p>Java Threadçª—å£é€‰ä¸­mainçº¿ç¨‹åç‚¹å‡»Stack MemoryæŒ‰é’®æŸ¥çœ‹è¯¥çº¿ç¨‹çš„æ ˆå†…å­˜ã€‚</p><p>çº¿ç¨‹ä¿¡æ¯ã€æ ˆå¸§ä¿¡æ¯ã€ä»¥åŠJHSDBè‡ªåŠ¨ç”Ÿæˆçš„æ³¨é‡Šä¿¡æ¯ã€‚</p><h4 id="2ã€-JConsole"><a href="#2ã€-JConsole" class="headerlink" title="2ã€ JConsole"></a>2ã€ JConsole</h4><p> JConsoleï¼šJavaç›‘è§†ä¸ç®¡ç†æ§åˆ¶å°ã€‚</p><p>JConsoleï¼ˆJava Monitoring and Management Consoleï¼‰æ˜¯ä¸€æ¬¾åŸºäºJMXï¼ˆJava Manage-ment Extensionsï¼‰çš„å¯è§†åŒ–ç›‘è§†ã€ç®¡ç†å·¥å…·ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯é€šè¿‡JMXçš„MBeanï¼ˆManaged Beanï¼‰å¯¹ç³»ç»Ÿè¿›è¡Œä¿¡æ¯æ”¶é›†å’Œå‚æ•°åŠ¨æ€è°ƒæ•´ã€‚</p><blockquote><p>JMXæ˜¯ä¸€ç§å¼€æ”¾æ€§çš„æŠ€æœ¯ï¼Œä¸ä»…å¯ä»¥ç”¨åœ¨è™šæ‹Ÿæœºæœ¬èº«çš„ç®¡ç†ä¸Šï¼Œè¿˜å¯ä»¥è¿è¡Œäºè™šæ‹Ÿæœºä¹‹ä¸Šçš„è½¯ä»¶ä¸­ï¼Œå…¸å‹çš„å¦‚ä¸­é—´ä»¶å¤§å¤šä¹ŸåŸºäºJMXæ¥å®ç°ç®¡ç†ä¸ç›‘æ§ã€‚è™šæ‹Ÿæœºå¯¹JMX MBeançš„è®¿é—®ä¹Ÿæ˜¯å®Œå…¨å¼€æ”¾çš„ï¼Œå¯ä»¥ä½¿ç”¨ä»£ç è°ƒç”¨APIã€æ”¯æŒJMXåè®®çš„ç®¡ç†æ§åˆ¶å°ï¼Œæˆ–è€…å…¶ä»–ç¬¦åˆJMXè§„èŒƒçš„è½¯ä»¶è¿›è¡Œè®¿é—®ã€‚</p></blockquote><p>ï¼ˆ1ï¼‰å¯åŠ¨JConsole</p><p>é€šè¿‡JDK/binç›®å½•ä¸‹çš„jconsole.exeå¯åŠ¨JCon-soleåï¼Œä¼šè‡ªåŠ¨æœç´¢å‡ºæœ¬æœºè¿è¡Œçš„æ‰€æœ‰è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œè€Œä¸éœ€è¦ç”¨æˆ·è‡ªå·±ä½¿ç”¨jpsæ¥æŸ¥è¯¢ã€‚å›¾ç‰‡å°±ä¸æ”¾äº†ã€‚</p><p>åŒå‡»é€‰æ‹©å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹ä¾¿å¯è¿›å…¥ä¸»ç•Œé¢å¼€å§‹ç›‘æ§ã€‚JMXæ”¯æŒè·¨æœåŠ¡å™¨çš„ç®¡ç†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„â€è¿œç¨‹è¿›ç¨‹â€åŠŸèƒ½æ¥è¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼Œå¯¹è¿œç¨‹è™šæ‹Ÿæœºè¿›è¡Œç›‘æ§ã€‚</p><p>è¿›å…¥JConsoleä¸»ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸»ç•Œé¢é‡Œå…±åŒ…æ‹¬â€æ¦‚è¿°â€â€å†…å­˜â€â€çº¿ç¨‹â€â€ç±»â€â€VMæ‘˜è¦â€â€MBeanâ€å…­ä¸ªé¡µç­¾ï¼Œâ€æ¦‚è¿°â€é¡µç­¾é‡Œæ˜¾ç¤ºçš„æ˜¯æ•´ä¸ªè™šæ‹Ÿæœºä¸»è¦è¿è¡Œæ•°æ®çš„æ¦‚è§ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬â€å †å†…å­˜ä½¿ç”¨æƒ…å†µâ€â€çº¿ç¨‹â€â€ç±»â€â€CPUä½¿ç”¨æƒ…å†µâ€å››é¡¹ä¿¡æ¯çš„æ›²çº¿å›¾ã€‚</p><p>ï¼ˆ2ï¼‰å†…å­˜ç›‘æ§</p><p>â€œå†…å­˜â€é¡µç­¾çš„ä½œç”¨ç›¸å½“äºå¯è§†åŒ–çš„jstatå‘½ä»¤ï¼Œç”¨äºç›‘è§†è¢«æ”¶é›†å™¨ç®¡ç†çš„è™šæ‹Ÿæœºå†…å­˜ï¼ˆè¢«æ”¶é›†å™¨ç›´æ¥ç®¡ç†çš„Javaå †å’Œè¢«é—´æ¥ç®¡ç†çš„æ–¹æ³•åŒºï¼‰çš„å˜åŒ–è¶‹åŠ¿ã€‚</p><p>è¿è¡Œæµ‹è¯•å¯ä»¥è®¾ç½®ä¸€ä¸‹è™šæ‹Ÿæœºå‚æ•°ï¼ˆä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼‰</p><p><code>-Xms100m  -Xmx100m -XX:+UseSerialGC</code></p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * å†…å­˜å ä½ç¬¦å¯¹è±¡ï¼Œä¸€ä¸ªOOMObjectå¤§çº¦å 64KB */</span><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OOMObject</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> placeholder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">64</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fillHeap</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>    List<span class="token operator">&lt;</span>OOMObject<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>OOMObject<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// ç¨ä½œå»¶æ—¶ï¼Œä»¤ç›‘è§†æ›²çº¿çš„å˜åŒ–æ›´åŠ æ˜æ˜¾</span>        Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OOMObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    System<span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>    <span class="token function">fillHeap</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ä»¥64KB/50msçš„é€Ÿåº¦å‘Javaå †ä¸­å¡«å……æ•°æ®ï¼Œä¸€å…±å¡«å……1000æ¬¡ï¼Œä½¿ç”¨JConsoleçš„â€å†…å­˜â€é¡µç­¾è¿›è¡Œç›‘è§†ï¼Œè§‚å¯Ÿæ›²çº¿å’ŒæŸ±çŠ¶æŒ‡ç¤ºå›¾çš„å˜åŒ–ã€‚</p><p>ç¨‹åºè¿è¡Œåï¼Œåœ¨â€å†…å­˜â€é¡µç­¾ä¸­åº”è¯¥å¯ä»¥çœ‹åˆ°å†…å­˜æ± EdenåŒºçš„è¿è¡Œè¶‹åŠ¿å‘ˆç°æŠ˜çº¿çŠ¶ã€‚</p><p>è™šæ‹Ÿæœºå¯åŠ¨å‚æ•°åªé™åˆ¶äº†Javaå †ä¸º100MBï¼Œä½†æ²¡æœ‰æ˜ç¡®ä½¿ç”¨-Xmnå‚æ•°æŒ‡å®šæ–°ç”Ÿä»£å¤§å°ï¼Œåœ¨æ²¡æœ‰è®¾ç½®-XXï¼šSurvivorRadioå‚æ•°æ—¶ï¼ŒEdenä¸Survivorç©ºé—´æ¯”ä¾‹çš„é»˜è®¤å€¼ä¸º8âˆ¶1ã€‚</p><p>ä¸€èˆ¬é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°ç”Ÿä»£çº¦å å †å†…å­˜çš„çš„1/3ï¼Œè€å¹´ä»£çº¦å 2/3ã€‚</p><p>å¯ä»¥ä»é¡µç­¾çš„ä¿¡æ¯ä¸Šå¾—åˆ°éªŒè¯ã€‚</p><p>System.gc()ï¼›ä¸ä¿è¯ä¸€å®šè¿›è¡Œå›æ”¶ã€‚</p><h4 id="3ã€çº¿ç¨‹ç›‘æ§"><a href="#3ã€çº¿ç¨‹ç›‘æ§" class="headerlink" title="3ã€çº¿ç¨‹ç›‘æ§"></a>3ã€çº¿ç¨‹ç›‘æ§</h4><p>â€œçº¿ç¨‹â€é¡µç­¾çš„åŠŸèƒ½å°±ç›¸å½“äºå¯è§†åŒ–çš„jstackå‘½ä»¤ã€‚</p><p>é‡åˆ°çº¿ç¨‹åœé¡¿çš„æ—¶å€™å¯ä»¥ä½¿ç”¨è¿™ä¸ªé¡µç­¾çš„åŠŸèƒ½è¿›è¡Œåˆ†æã€‚ã€‚</p><pre><code>/** * çº¿ç¨‹æ­»å¾ªç¯æ¼”ç¤º */public static void createBusyThread() {Thread thread = new Thread(new Runnable() {    @Override    public void run() {        while (true)   // ç¬¬41è¡Œ            ;    }}, &quot;testBusyThread&quot;);thread.start();}/** * çº¿ç¨‹é”ç­‰å¾…æ¼”ç¤º */public static void createLockThread(final Object lock) {Thread thread = new Thread(new Runnable() {    @Override    public void run() {        synchronized (lock) {            try {                lock.wait();            } catch (InterruptedException e) {                e.printStackTrace();            }        }    }}, &quot;testLockThread&quot;);thread.start();}public static void main(String[] args) throws Exception {    BufferedReader br = new BufferedReader(new InputStreamReader(System.in));    br.readLine();    createBusyThread();    br.readLine();    Object obj = new Object();    createLockThread(obj);}</code></pre><p>ç¨‹åºè¿è¡Œåï¼Œé¦–å…ˆåœ¨â€çº¿ç¨‹â€é¡µç­¾ä¸­é€‰æ‹©mainçº¿ç¨‹ã€‚</p><blockquote><p>å †æ ˆè¿½è¸ªæ˜¾ç¤ºBufferedReaderçš„readBytes()æ–¹æ³•æ­£åœ¨ç­‰å¾…System.inçš„é”®ç›˜è¾“å…¥ï¼Œè¿™æ—¶å€™çº¿ç¨‹ä¸ºRunnableçŠ¶æ€ï¼ŒRunnableçŠ¶æ€çš„çº¿ç¨‹ä»ä¼šè¢«åˆ†é…è¿è¡Œæ—¶é—´ï¼Œä½†readBytes()æ–¹æ³•æ£€æŸ¥åˆ°æµæ²¡æœ‰æ›´æ–°å°±ä¼šç«‹åˆ»å½’è¿˜æ‰§è¡Œä»¤ç‰Œç»™æ“ä½œç³»ç»Ÿï¼Œè¿™ç§ç­‰å¾…åªæ¶ˆè€—å¾ˆå°çš„å¤„ç†å™¨èµ„æºã€‚</p></blockquote><p>ç›‘æ§testBusyThreadçº¿ç¨‹ã€‚testBusyThreadçº¿ç¨‹ä¸€ç›´åœ¨æ‰§è¡Œç©ºå¾ªç¯ï¼Œä»å †æ ˆè¿½è¸ªä¸­çœ‹åˆ°ä¸€ç›´åœ¨MonitoringTest.javaä»£ç çš„41è¡Œåœç•™ï¼Œ41è¡Œçš„ä»£ç ä¸ºwhile(true)ã€‚è¿™æ—¶å€™çº¿ç¨‹ä¸ºRunnableçŠ¶æ€ï¼Œè€Œä¸”æ²¡æœ‰å½’è¿˜çº¿ç¨‹æ‰§è¡Œä»¤ç‰Œçš„åŠ¨ä½œï¼Œæ‰€ä»¥ä¼šåœ¨ç©ºå¾ªç¯è€—å°½æ“ä½œç³»ç»Ÿåˆ†é…ç»™å®ƒçš„æ‰§è¡Œæ—¶é—´ï¼Œç›´åˆ°çº¿ç¨‹åˆ‡æ¢ä¸ºæ­¢ï¼Œè¿™ç§ç­‰å¾…ä¼šæ¶ˆè€—å¤§é‡çš„å¤„ç†å™¨èµ„æºã€‚</p><p>æœªå®Œã€‚ã€‚ã€‚ã€‚</p><h4 id="4ã€VisualVM"><a href="#4ã€VisualVM" class="headerlink" title="4ã€VisualVM"></a>4ã€VisualVM</h4><p>VisualVMï¼šå¤šåˆ-æ•…éšœå¤„ç†å·¥å…·ã€‚</p><p>VisualVMï¼ˆAll-in-One Java Troubleshooting Toolï¼‰æ˜¯åŠŸèƒ½æœ€å¼ºå¤§çš„è¿è¡Œç›‘è§†å’Œæ•…éšœå¤„ç†ç¨‹åºä¹‹ä¸€ï¼Œæ›¾ç»åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…æ˜¯Oracleå®˜æ–¹ä¸»åŠ›å‘å±•çš„è™šæ‹Ÿæœºæ•…éšœå¤„ç†å·¥å…·ã€‚</p><p>å®ƒé™¤äº†å¸¸è§„çš„è¿è¡Œç›‘è§†ã€æ•…éšœå¤„ç†å¤–ï¼Œè¿˜å°†æä¾›å…¶ä»–æ–¹é¢çš„èƒ½åŠ›ï¼Œè­¬å¦‚æ€§èƒ½åˆ†æï¼ˆProfilingï¼‰ã€‚VisualVMçš„æ€§èƒ½åˆ†æåŠŸèƒ½æ¯”èµ·JProfilerã€YourKitç­‰ä¸“ä¸šä¸”æ”¶è´¹çš„Profilingå·¥å…·éƒ½ä¸é‘å¤šè®©ã€‚</p><p>å®ƒçš„é€šç”¨æ€§å¾ˆå¼ºï¼Œå¯¹åº”ç”¨ç¨‹åºå®é™…æ€§èƒ½çš„å½±å“ä¹Ÿè¾ƒå°ï¼Œä½¿å¾—å®ƒå¯ä»¥ç›´æ¥åº”ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</p><p>ï¼ˆ1ï¼‰VisualVMå…¼å®¹èŒƒå›´ä¸æ’ä»¶å®‰è£…</p><p>VisualVMåŸºäºNetBeanså¹³å°å¼€å‘å·¥å…·ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å®ƒå°±å…·å¤‡äº†é€šè¿‡æ’ä»¶æ‰©å±•åŠŸèƒ½çš„èƒ½åŠ›ï¼Œæœ‰äº†æ’ä»¶æ‰©å±•æ”¯æŒï¼ŒVisualVMå¯ä»¥åšåˆ°ï¼š</p><p>â€‹    ï¼ˆaï¼‰æ˜¾ç¤ºè™šæ‹Ÿæœºè¿›ç¨‹ä»¥åŠè¿›ç¨‹çš„é…ç½®ã€ç¯å¢ƒä¿¡æ¯ï¼ˆjpsã€jinfoï¼‰ã€‚</p><p>â€‹    ï¼ˆbï¼‰ç›‘è§†åº”ç”¨ç¨‹åºçš„å¤„ç†å™¨ã€åƒåœ¾æ”¶é›†ã€å †ã€æ–¹æ³•åŒºä»¥åŠçº¿ç¨‹çš„ä¿¡æ¯ï¼ˆjstatã€jstackï¼‰ã€‚</p><p>â€‹    ï¼ˆcï¼‰dumpä»¥åŠåˆ†æå †è½¬å‚¨å¿«ç…§ï¼ˆjmapã€jhatï¼‰ã€‚</p><p>â€‹    ï¼ˆdï¼‰æ–¹æ³•çº§çš„ç¨‹åºè¿è¡Œæ€§èƒ½åˆ†æï¼Œæ‰¾å‡ºè¢«è°ƒç”¨æœ€å¤šã€è¿è¡Œæ—¶é—´æœ€é•¿çš„æ–¹æ³•ã€‚</p><p>â€‹    ï¼ˆeï¼‰ç¦»çº¿ç¨‹åºå¿«ç…§ï¼šæ”¶é›†ç¨‹åºçš„è¿è¡Œæ—¶é…ç½®ã€çº¿ç¨‹dumpã€å†…å­˜dumpç­‰ä¿¡æ¯å»ºç«‹ä¸€ä¸ªå¿«ç…§ï¼Œå¯ä»¥å°†å¿«ç…§å‘é€å¼€å‘è€…å¤„è¿›è¡ŒBugåé¦ˆã€‚</p><p>â€‹    ï¼ˆfï¼‰å…¶ä»–æ’ä»¶å¸¦æ¥çš„æ— é™å¯èƒ½æ€§ã€‚</p><p>VisualVMåœ¨JDK 6 Update 7ä¸­é¦–æ¬¡å‘å¸ƒï¼Œä½†å¹¶ä¸æ„å‘³ç€å®ƒåªèƒ½ç›‘æ§è¿è¡ŒäºJDK 6ä¸Šçš„ç¨‹åºï¼Œå®ƒå…·å¤‡å¾ˆä¼˜ç§€çš„å‘ä¸‹å…¼å®¹æ€§ï¼Œç”šè‡³èƒ½å‘ä¸‹å…¼å®¹è‡³2003å¹´å‘å¸ƒçš„JDK 1.4.2ç‰ˆæœ¬ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-jvisVM.jpg" alt="VisualVMä¸»è¦åŠŸèƒ½å…¼å®¹æ€§åˆ—è¡¨"></p><p>VisualVMçš„æ’ä»¶å®‰è£…ï¼š</p><p>ï¼ˆAï¼‰æ‰‹å·¥è¿›è¡Œå®‰è£…</p><p>VisualVMçš„æ’ä»¶å¯ä»¥æ‰‹å·¥è¿›è¡Œå®‰è£…ï¼Œåœ¨ç½‘ç«™[æ’å›¾]ä¸Šä¸‹è½½nbmåŒ…åï¼Œç‚¹å‡»â€å·¥å…·-&gt;æ’ä»¶-&gt;å·²ä¸‹è½½â€èœå•ï¼Œç„¶ååœ¨å¼¹å‡ºå¯¹è¯æ¡†ä¸­æŒ‡å®šnbmåŒ…è·¯å¾„ä¾¿å¯å®Œæˆå®‰è£…ã€‚ç‹¬ç«‹å®‰è£…çš„æ’ä»¶å­˜å‚¨åœ¨VisualVMçš„æ ¹ç›®å½•ï¼Œè­¬å¦‚JDK 9ä¹‹å‰è‡ªå¸¦çš„VisulalVMï¼Œæ’ä»¶å®‰è£…åæ˜¯æ”¾åœ¨JDK_HOME/lib/visualvmä¸­çš„ã€‚</p><p>ï¼ˆBï¼‰è‡ªåŠ¨å®‰è£…</p><p>VisualVMçš„è‡ªåŠ¨å®‰è£…åŠŸèƒ½å·²å¯æ‰¾åˆ°å¤§å¤šæ•°æ‰€éœ€çš„æ’ä»¶ï¼Œåœ¨æœ‰ç½‘ç»œè¿æ¥çš„ç¯å¢ƒä¸‹ï¼Œç‚¹å‡»â€å·¥å…·-&gt;æ’ä»¶èœå•â€ï¼Œåœ¨é¡µç­¾çš„â€å¯ç”¨æ’ä»¶â€åŠâ€å·²å®‰è£…â€ä¸­åˆ—ä¸¾äº†å½“å‰ç‰ˆæœ¬VisualVMå¯ä»¥ä½¿ç”¨çš„å…¨éƒ¨æ’ä»¶ï¼Œé€‰ä¸­æ’ä»¶ååœ¨å³è¾¹çª—å£ä¼šæ˜¾ç¤ºè¿™ä¸ªæ’ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚å¼€å‘è€…ã€ç‰ˆæœ¬ã€åŠŸèƒ½æè¿°ç­‰ã€‚</p><p>VisualVMä¸­â€æ¦‚è¿°â€â€ç›‘è§†â€â€çº¿ç¨‹â€â€MBeansâ€çš„åŠŸèƒ½ä¸Jconsoleç›¸ä¼¼ã€‚</p><p>ï¼ˆ2ï¼‰ç”Ÿæˆã€æµè§ˆå †è½¬å‚¨å¿«ç…§</p><p>åœ¨VisualVMä¸­ç”Ÿæˆå †è½¬å‚¨å¿«ç…§æ–‡ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œ</p><p>â€‹    aï¼‰åœ¨â€åº”ç”¨ç¨‹åºâ€çª—å£ä¸­å³é”®å•å‡»åº”ç”¨ç¨‹åºèŠ‚ç‚¹ï¼Œç„¶åé€‰æ‹©â€å †Dumpâ€ã€‚</p><p>â€‹    bï¼‰åœ¨â€åº”ç”¨ç¨‹åºâ€çª—å£ä¸­åŒå‡»åº”ç”¨ç¨‹åºèŠ‚ç‚¹ä»¥æ‰“å¼€åº”ç”¨ç¨‹åºæ ‡ç­¾ï¼Œç„¶ååœ¨â€ç›‘è§†â€æ ‡ç­¾ä¸­å•å‡»â€å †Dumpâ€ã€‚</p><p>ç”Ÿæˆå †è½¬å‚¨å¿«ç…§æ–‡ä»¶ä¹‹åï¼Œåº”ç”¨ç¨‹åºé¡µç­¾ä¼šåœ¨è¯¥å †çš„åº”ç”¨ç¨‹åºä¸‹å¢åŠ ä¸€ä¸ªä»¥[heap-dump]å¼€å¤´çš„å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”åœ¨ä¸»é¡µç­¾ä¸­æ‰“å¼€è¯¥è½¬å‚¨å¿«ç…§ã€‚</p><blockquote><p>å¦‚æœéœ€è¦æŠŠå †è½¬å‚¨å¿«ç…§ä¿å­˜æˆ–å‘é€å‡ºå»ï¼Œå°±åº”åœ¨heapdumpèŠ‚ç‚¹ä¸Šå³é”®é€‰æ‹©â€å¦å­˜ä¸ºâ€èœå•ï¼Œå¦åˆ™å½“VisualVMå…³é—­æ—¶ï¼Œç”Ÿæˆçš„å †è½¬å‚¨å¿«ç…§æ–‡ä»¶ä¼šè¢«å½“ä½œä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨æ¸…ç†æ‰ã€‚è¦æ‰“å¼€ä¸€ä¸ªç”±å·²ç»å­˜åœ¨çš„å †è½¬å‚¨å¿«ç…§æ–‡ä»¶ï¼Œé€šè¿‡æ–‡ä»¶èœå•ä¸­çš„â€è£…å…¥â€åŠŸèƒ½ï¼Œé€‰æ‹©æ–‡ä»¶å³å¯ã€‚</p></blockquote><p>å †é¡µç­¾ä¸­çš„â€æ‘˜è¦â€é¢æ¿å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºdumpæ—¶çš„è¿è¡Œæ—¶å‚æ•°ã€System.getPro-perties()çš„å†…å®¹ã€çº¿ç¨‹å †æ ˆç­‰ä¿¡æ¯ï¼›</p><p>â€œç±»â€é¢æ¿åˆ™æ˜¯ä»¥ç±»ä¸ºç»Ÿè®¡å£å¾„ç»Ÿè®¡ç±»çš„å®ä¾‹æ•°é‡ã€å®¹é‡ä¿¡æ¯ï¼›</p><p>â€œå®ä¾‹â€é¢æ¿ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œå› ä¸ºVisualVMåœ¨æ­¤æ—¶è¿˜æ— æ³•ç¡®å®šç”¨æˆ·æƒ³æŸ¥çœ‹å“ªä¸ªç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡â€ç±»â€é¢æ¿è¿›å…¥ï¼Œåœ¨â€ç±»â€ä¸­é€‰æ‹©ä¸€ä¸ªéœ€è¦æŸ¥çœ‹çš„ç±»ï¼Œç„¶ååŒå‡»å³å¯åœ¨â€å®ä¾‹â€é‡Œé¢çœ‹åˆ°æ­¤ç±»çš„å…¶ä¸­500ä¸ªå®ä¾‹çš„å…·ä½“å±æ€§ä¿¡æ¯ï¼›</p><p>â€œOQLæ§åˆ¶å°â€é¢æ¿åˆ™æ˜¯è¿è¡ŒOQLæŸ¥è¯¢è¯­å¥çš„ï¼ŒåŒjhatä¸­ä»‹ç»çš„OQLåŠŸèƒ½ä¸€æ ·ã€‚</p><p>ï¼ˆ3ï¼‰åˆ†æç¨‹åºæ€§èƒ½</p><p>åœ¨Profileré¡µç­¾ä¸­ï¼ŒVisualVMæä¾›äº†ç¨‹åºè¿è¡ŒæœŸé—´æ–¹æ³•çº§çš„å¤„ç†å™¨æ‰§è¡Œæ—¶é—´åˆ†æä»¥åŠå†…å­˜åˆ†æã€‚åšProfilingåˆ†æè‚¯å®šä¼šå¯¹ç¨‹åºè¿è¡Œæ€§èƒ½æœ‰æ¯”è¾ƒå¤§çš„å½±å“ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è¿™é¡¹åŠŸèƒ½ï¼Œæˆ–è€…æ”¹ç”¨JMCæ¥å®Œæˆï¼ŒJMCçš„Profilingèƒ½åŠ›æ›´å¼ºï¼Œå¯¹åº”ç”¨çš„å½±å“éå¸¸è½»å¾®ã€‚</p><p>è¦å¼€å§‹æ€§èƒ½åˆ†æï¼Œå…ˆé€‰æ‹©â€CPUâ€å’Œâ€å†…å­˜â€æŒ‰é’®ä¸­çš„ä¸€ä¸ªï¼Œç„¶ååˆ‡æ¢åˆ°åº”ç”¨ç¨‹åºä¸­å¯¹ç¨‹åºè¿›è¡Œæ“ä½œï¼ŒVisualVMä¼šè®°å½•è¿™æ®µæ—¶é—´ä¸­åº”ç”¨ç¨‹åºæ‰§è¡Œè¿‡çš„æ‰€æœ‰æ–¹æ³•ã€‚å¦‚æœæ˜¯è¿›è¡Œå¤„ç†å™¨æ‰§è¡Œæ—¶é—´åˆ†æï¼Œå°†ä¼šç»Ÿè®¡æ¯ä¸ªæ–¹æ³•çš„æ‰§è¡Œæ¬¡æ•°ã€æ‰§è¡Œè€—æ—¶ï¼›å¦‚æœæ˜¯å†…å­˜åˆ†æï¼Œåˆ™ä¼šç»Ÿè®¡æ¯ä¸ªæ–¹æ³•å…³è”çš„å¯¹è±¡æ•°ä»¥åŠè¿™äº›å¯¹è±¡æ‰€å çš„ç©ºé—´ã€‚ç­‰è¦åˆ†æçš„æ“ä½œæ‰§è¡Œç»“æŸåï¼Œç‚¹å‡»â€åœæ­¢â€æŒ‰é’®ç»“æŸç›‘æ§è¿‡ç¨‹ã€‚</p><blockquote><p>åœ¨JDK 5ä¹‹åï¼Œåœ¨å®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„è™šæ‹ŸæœºåŠ å…¥å¹¶ä¸”è‡ªåŠ¨å¼€å¯äº†ç±»å…±äº«â€”â€”è¿™æ˜¯ä¸€ä¸ªåœ¨å¤šè™šæ‹Ÿæœºè¿›ç¨‹å…±äº«rt.jarä¸­ç±»æ•°æ®ä»¥æé«˜åŠ è½½é€Ÿåº¦å’ŒèŠ‚çœå†…å­˜çš„ä¼˜åŒ–ï¼Œè€Œæ ¹æ®ç›¸å…³BugæŠ¥å‘Šçš„åæ˜ ï¼ŒVisualVMçš„ProfileråŠŸèƒ½ä¼šå› ä¸ºç±»å…±äº«è€Œå¯¼è‡´è¢«ç›‘è§†çš„åº”ç”¨ç¨‹åºå´©æºƒï¼Œæ‰€è¿›è¡ŒProfilingå‰ï¼Œæœ€å¥½åœ¨è¢«ç›‘è§†ç¨‹åºä¸­ä½¿ç”¨-Xshareï¼šoffå‚æ•°æ¥å…³é—­ç±»å…±äº«ä¼˜åŒ–ã€‚</p></blockquote><p>ï¼ˆ4ï¼‰BTraceåŠ¨æ€æ—¥å¿—è·Ÿè¸ª</p><p>BTraceæ˜¯ä¸€ä¸ªå¾ˆç¥å¥‡çš„VisualVMæ’ä»¶ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¿è¡Œçš„ç‹¬ç«‹ç¨‹åºã€‚</p><p>BTraceçš„ä½œç”¨æ˜¯åœ¨ä¸ä¸­æ–­ç›®æ ‡ç¨‹åºè¿è¡Œçš„å‰æä¸‹ï¼Œé€šè¿‡HotSpotè™šæ‹Ÿæœºçš„InstrumentåŠŸèƒ½[æ’å›¾]åŠ¨æ€åŠ å…¥åŸæœ¬å¹¶ä¸å­˜åœ¨çš„è°ƒè¯•ä»£ç ã€‚è¿™é¡¹åŠŸèƒ½å¯¹å®é™…ç”Ÿäº§ä¸­çš„ç¨‹åºå¾ˆæœ‰æ„ä¹‰ï¼šå¦‚å½“ç¨‹åºå‡ºç°é—®é¢˜æ—¶ï¼Œæ’æŸ¥é”™è¯¯çš„ä¸€äº›å¿…è¦ä¿¡æ¯æ—¶ï¼ˆè­¬å¦‚æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ç­‰ï¼‰ï¼Œåœ¨å¼€å‘æ—¶å¹¶æ²¡æœ‰æ‰“å°åˆ°æ—¥å¿—ä¹‹ä¸­ä»¥è‡³äºä¸å¾—ä¸åœæ‰æœåŠ¡æ—¶ï¼Œéƒ½å¯ä»¥é€šè¿‡è°ƒè¯•å¢é‡æ¥åŠ å…¥æ—¥å¿—ä»£ç ä»¥è§£å†³é—®é¢˜ã€‚</p><p>åœ¨VisualVMä¸­å®‰è£…äº†BTraceæ’ä»¶åï¼Œåœ¨åº”ç”¨ç¨‹åºé¢æ¿ä¸­å³å‡»è¦è°ƒè¯•çš„ç¨‹åºï¼Œä¼šå‡ºç°â€Trace Applicationâ€¦â€èœå•ï¼Œç‚¹å‡»å°†è¿›å…¥BTraceé¢æ¿ã€‚</p><p>BTraceçš„åŠŸèƒ½æ¼”ç¤ºï¼šäº§ç”Ÿä¸¤ä¸ª1000ä»¥å†…çš„éšæœºæ•´æ•°ï¼Œè¾“å‡ºè¿™ä¸¤ä¸ªæ•°å­—ç›¸åŠ çš„ç»“æœ</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BTraceTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        BTraceTest test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BTraceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        BufferedReader reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿™æ®µç¨‹åºå·²ç»ä¸Šçº¿è¿è¡Œï¼Œè€Œæˆ‘ä»¬ç°åœ¨åˆæœ‰äº†æ–°çš„éœ€æ±‚ï¼Œæƒ³è¦çŸ¥é“ç¨‹åºä¸­ç”Ÿæˆçš„ä¸¤ä¸ªéšæœºæ•°æ˜¯ä»€ä¹ˆï¼Œä½†ç¨‹åºå¹¶æ²¡æœ‰åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¾“å‡ºè¿™ä¸€ç‚¹ã€‚æ­¤æ—¶ï¼Œåœ¨VisualVMä¸­æ‰“å¼€è¯¥ç¨‹åºçš„ç›‘è§†ï¼Œåœ¨BTraceé¡µç­¾å¡«å……TracingScriptçš„å†…å®¹ï¼Œè¾“å…¥è°ƒè¯•ä»£ç ï¼Œå³å¯åœ¨ä¸ä¸­æ–­ç¨‹åºè¿è¡Œçš„æƒ…å†µä¸‹åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><pre><code>/* BTrace Script Template */import com.sun.btrace.annotations.*;import static com.sun.btrace.BTraceUtils.*;@BTracepublic class TracingScript {        @OnMethod(    clazz=&quot;org.fenixsoft.monitoring.BTraceTest&quot;,    method=&quot;add&quot;,    location=@Location(Kind.RETURN))public static void func(@Self org.fenixsoft.monitoring.BTraceTest instance,int a, int b,@Return int result) {    println(&quot;è°ƒç”¨å †æ ˆ:&quot;);    jstack();    println(strcat(&quot;æ–¹æ³•å‚æ•°A:&quot;,str(a)));    println(strcat(&quot;æ–¹æ³•å‚æ•°B:&quot;,str(b)));    println(strcat(&quot;æ–¹æ³•ç»“æœ:&quot;,str(result)));}}</code></pre><p>ç‚¹å‡»StartæŒ‰é’®åç¨ç­‰ç‰‡åˆ»ï¼Œç¼–è¯‘å®Œæˆåï¼ŒOutputé¢æ¿ä¸­ä¼šå‡ºç°â€BTracecode successfuly deployedâ€çš„å­—æ ·ã€‚å½“ç¨‹åºè¿è¡Œæ—¶å°†ä¼šåœ¨Outputé¢æ¿è¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚</p><p>BTraceçš„ç”¨é€”å¾ˆå¹¿æ³›ï¼Œæ‰“å°è°ƒç”¨å †æ ˆã€å‚æ•°ã€è¿”å›å€¼åªæ˜¯å®ƒæœ€åŸºç¡€çš„ä½¿ç”¨å½¢å¼ï¼Œä½¿ç”¨BTraceè¿›è¡Œæ€§èƒ½ç›‘è§†ã€å®šä½è¿æ¥æ³„æ¼ã€å†…å­˜æ³„æ¼ã€è§£å†³å¤šçº¿ç¨‹ç«äº‰é—®é¢˜ç­‰ã€‚</p><p>BTraceèƒ½å¤Ÿå®ç°åŠ¨æ€ä¿®æ”¹ç¨‹åºè¡Œä¸ºï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯åŸºäºJavaè™šæ‹Ÿæœºçš„Instrumentå¼€å‘çš„ã€‚Instrumentæ˜¯Javaè™šæ‹Ÿæœºå·¥å…·æ¥å£ï¼ˆJava VirtualMachine Tool Interfaceï¼ŒJVMTIï¼‰çš„é‡è¦ç»„ä»¶ï¼Œæä¾›äº†ä¸€å¥—ä»£ç†ï¼ˆAgentï¼‰æœºåˆ¶ï¼Œä½¿å¾—ç¬¬ä¸‰æ–¹å·¥å…·ç¨‹åºå¯ä»¥ä»¥ä»£ç†çš„æ–¹å¼è®¿é—®å’Œä¿®æ”¹Javaè™šæ‹Ÿæœºå†…éƒ¨çš„æ•°æ®ã€‚</p><blockquote><p>é˜¿é‡Œå·´å·´å¼€æºçš„è¯Šæ–­å·¥å…·Arthasä¹Ÿé€šè¿‡Instrumentå®ç°äº†ä¸BTraceç±»ä¼¼çš„åŠŸèƒ½ã€‚</p></blockquote><p>4ã€Java Mission Control</p><p>Java Mission Controlï¼šå¯æŒç»­åœ¨çº¿çš„ç›‘æ§å·¥å…·ã€‚</p><p>Oracle Java SE Advanced &amp; Suite[æ’å›¾]ä¸æ™®é€šOracleJava SEåœ¨åŠŸèƒ½ä¸Šçš„ä¸»è¦å·®åˆ«æ˜¯å‰è€…åŒ…å«äº†ä¸€ç³»åˆ—çš„ç›‘æ§ã€ç®¡ç†å·¥å…·ï¼Œè­¬å¦‚ç”¨äºä¼ä¸šJREå®šåˆ¶ç®¡ç†çš„AMCï¼ˆJava Advanced ManagementConsoleï¼‰æ§åˆ¶å°ã€JUTï¼ˆJava Usage Trackerï¼‰è·Ÿè¸ªç³»ç»Ÿï¼Œç”¨äºæŒç»­æ”¶é›†æ•°æ®çš„JFRï¼ˆJava Flight Recorderï¼‰é£è¡Œè®°å½•ä»ªå’Œç”¨äºç›‘æ§Javaè™šæ‹Ÿæœºçš„JMCï¼ˆJava Mission Controlï¼‰ã€‚è¿™äº›åŠŸèƒ½å…¨éƒ¨éƒ½æ˜¯éœ€è¦å•†ä¸šæˆæƒæ‰èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä½†æ ¹æ®Oracle Binary Codeåè®®ï¼Œåœ¨ä¸ªäººå¼€å‘ç¯å¢ƒä¸­ï¼Œå…è®¸å…è´¹ä½¿ç”¨JMCå’ŒJFRã€‚</p><p>JFRç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰JFRæ˜¯ä¸€å¥—å†…å»ºåœ¨HotSpotè™šæ‹Ÿæœºé‡Œé¢çš„ç›‘æ§å’ŒåŸºäºäº‹ä»¶çš„ä¿¡æ¯æœé›†æ¡†æ¶ï¼Œä¸å…¶ä»–çš„ç›‘æ§å·¥å…·ï¼ˆå¦‚JProfilingï¼‰ç›¸æ¯”ï¼Œå®ƒå…·æœ‰â€å¯æŒç»­åœ¨çº¿â€ï¼ˆAlways-Onï¼‰çš„ç‰¹æ€§ã€‚</p><p>ï¼ˆ2ï¼‰JFRåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯¹ååé‡çš„å½±å“ä¸€èˆ¬ä¸ä¼šé«˜äº1%ï¼ˆç”šè‡³å·ç§°æ˜¯Zero Performance Overheadï¼‰ã€‚</p><p>ï¼ˆ3ï¼‰JFRç›‘æ§è¿‡ç¨‹çš„å¼€å§‹ã€åœæ­¢éƒ½æ˜¯å®Œå…¨å¯åŠ¨æ€çš„ï¼Œå³ä¸éœ€è¦é‡å¯åº”ç”¨ã€‚</p><p>ï¼ˆ4ï¼‰JFRçš„ç›‘æ§å¯¹åº”ç”¨ä¹Ÿæ˜¯å®Œå…¨é€æ˜çš„ï¼Œå³ä¸éœ€è¦å¯¹åº”ç”¨ç¨‹åºçš„æºç åšä»»ä½•ä¿®æ”¹ï¼Œæˆ–è€…åŸºäºç‰¹å®šçš„ä»£ç†æ¥è¿è¡Œã€‚</p><p>JMCï¼š</p><p>ï¼ˆ1ï¼‰Eclipse RCPä½œä¸ºåŸºç¡€æ¡†æ¶ã€‚</p><p>ï¼ˆ2ï¼‰å¯ä¸‹è½½ç‹¬ç«‹ç¨‹åºï¼Œä¹Ÿå¯ä»¥ä½œä¸ºEclipseæ’ä»¶å®‰è£…ã€‚</p><p>ï¼ˆ3ï¼‰JMCä¸è™šæ‹Ÿæœºä¹‹é—´åŒæ ·é‡‡å–JMXåè®®è¿›è¡Œé€šä¿¡ï¼Œä½œä¸ºJMXæ§åˆ¶å°æ˜¾ç¤ºæ¥è‡ªè™šæ‹ŸæœºMBeanæä¾›çš„æ•°æ®ã€‚</p><p>ï¼ˆ4ï¼‰JMCè¿˜å¯ä»¥ä½œä¸ºJFRçš„åˆ†æå·¥å…·ï¼Œå±•ç¤ºæ¥è‡ªJFRçš„æ•°æ®ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-tools/jvm-tools-jmc.jpg" alt="JMCä¸»ç•Œé¢"></p><p>æ‰“å¼€ç•Œé¢ä¹‹åï¼ŒåŒå‡»â€é£è¡Œè®°å½•å™¨â€ï¼Œå°†ä¼šå‡ºç°â€å¯åŠ¨é£è¡Œè®°å½•â€çª—å£ã€‚</p><p>é£è¡Œè®°å½•æŠ¥å‘Šé‡ŒåŒ…å«ä»¥ä¸‹å‡ ç±»ä¿¡æ¯ï¼š</p><p>ï¼ˆaï¼‰ä¸€èˆ¬ä¿¡æ¯ï¼šå…³äºè™šæ‹Ÿæœºã€æ“ä½œç³»ç»Ÿå’Œè®°å½•çš„ä¸€èˆ¬ä¿¡æ¯ã€‚</p><p>ï¼ˆbï¼‰å†…å­˜ï¼šå…³äºå†…å­˜ç®¡ç†å’Œåƒåœ¾æ”¶é›†çš„ä¿¡æ¯ã€‚</p><p>ï¼ˆcï¼‰ä»£ç ï¼šå…³äºæ–¹æ³•ã€å¼‚å¸¸é”™è¯¯ã€ç¼–è¯‘å’Œç±»åŠ è½½çš„ä¿¡æ¯ã€‚</p><p>ï¼ˆdï¼‰çº¿ç¨‹ï¼šå…³äºåº”ç”¨ç¨‹åºä¸­çº¿ç¨‹å’Œé”çš„ä¿¡æ¯ã€‚</p><p>ï¼ˆeï¼‰I/Oï¼šå…³äºæ–‡ä»¶å’Œå¥—æ¥å­—è¾“å…¥ã€è¾“å‡ºçš„ä¿¡æ¯ã€‚</p><p>ï¼ˆfï¼‰ç³»ç»Ÿï¼šå…³äºæ­£åœ¨è¿è¡ŒJavaè™šæ‹Ÿæœºçš„ç³»ç»Ÿã€è¿›ç¨‹å’Œç¯å¢ƒå˜é‡çš„ä¿¡æ¯ã€‚</p><p>ï¼ˆgï¼‰äº‹ä»¶ï¼šå…³äºè®°å½•ä¸­çš„äº‹ä»¶ç±»å‹çš„ä¿¡æ¯ï¼Œå¯ä»¥æ ¹æ®çº¿ç¨‹æˆ–å †æ ˆè·Ÿè¸ªï¼ŒæŒ‰ç…§æ—¥å¿—æˆ–å›¾å½¢çš„æ ¼å¼æŸ¥çœ‹ã€‚</p><p>JFRå·¥ä½œè¿‡ç¨‹ï¼š</p><p>JFRå¼€å¯ä¸€ç³»åˆ—äº‹ä»¶çš„å½•åˆ¶åŠ¨ä½œï¼Œå½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¿™ä¸ªäº‹ä»¶çš„æ‰€æœ‰ä¸Šä¸‹æ–‡æ•°æ®å°†ä¼šä»¥å¾ªç¯æ—¥å¿—çš„å½¢å¼è¢«ä¿å­˜è‡³å†…å­˜æˆ–è€…æŒ‡å®šçš„æŸä¸ªæ–‡ä»¶å½“ä¸­ï¼Œå¾ªç¯æ—¥å¿—ç›¸å½“äºæ•°æ®æµè¢«ä¿ç•™åœ¨ä¸€ä¸ªç¯å½¢ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥åªæœ‰æœ€è¿‘å‘ç”Ÿçš„äº‹ä»¶çš„æ•°æ®æ‰æ˜¯å¯ç”¨çš„ã€‚JMCä»è™šæ‹Ÿæœºå†…å­˜æˆ–è€…æ–‡ä»¶ä¸­è¯»å–å¹¶å±•ç¤ºè¿™äº›äº‹ä»¶æ•°æ®ï¼Œå¹¶é€šè¿‡è¿™äº›æ•°æ®è¿›è¡Œæ€§èƒ½åˆ†æã€‚</p><blockquote><p>JFRæä¾›çš„æ•°æ®è´¨é‡é€šå¸¸ä¹Ÿè¦æ¯”å…¶ä»–å·¥å…·é€šè¿‡ä»£ç†å½¢å¼é‡‡æ ·è·å¾—æˆ–è€…ä»MBeanä¸­å–å¾—çš„æ•°æ®é«˜å¾—å¤šã€‚ä»¥åƒåœ¾æœé›†ä¸ºä¾‹ï¼ŒHotSpotçš„MBeanä¸­ä¸€èˆ¬æœ‰å„ä¸ªåˆ†ä»£å¤§å°ã€æ”¶é›†æ¬¡æ•°ã€æ—¶é—´ã€å ç”¨ç‡ç­‰æ•°æ®ï¼ˆæ ¹æ®æ”¶é›†å™¨ä¸åŒæœ‰æ‰€å·®åˆ«ï¼‰ï¼Œè¿™äº›éƒ½å±äºâ€ç»“æœâ€ç±»çš„ä¿¡æ¯ï¼Œè€ŒJFRä¸­è¿˜å¯ä»¥çœ‹åˆ°å†…å­˜ä¸­è¿™æ®µæ—¶é—´åˆ†é…äº†å“ªäº›å¯¹è±¡ã€å“ªäº›åœ¨TLABä¸­ï¼ˆæˆ–å¤–éƒ¨ï¼‰åˆ†é…ã€åˆ†é…é€Ÿç‡å’Œå‹åŠ›å¤§å°å¦‚ä½•ã€åˆ†é…å½’å±çš„çº¿ç¨‹ã€æ”¶é›†æ—¶å¯¹è±¡åˆ†ä»£æ™‹å‡çš„æƒ…å†µç­‰ï¼Œè¿™äº›å°±æ˜¯å±äºâ€è¿‡ç¨‹â€ç±»çš„ä¿¡æ¯ï¼Œå¯¹æ’æŸ¥é—®é¢˜çš„ä»·å€¼æ˜¯éš¾ä»¥ä¼°é‡çš„ã€‚</p></blockquote><h3 id="ä¸‰ã€HotSpotè™šæ‹Ÿæœºæ’ä»¶åŠå·¥å…·"><a href="#ä¸‰ã€HotSpotè™šæ‹Ÿæœºæ’ä»¶åŠå·¥å…·" class="headerlink" title="ä¸‰ã€HotSpotè™šæ‹Ÿæœºæ’ä»¶åŠå·¥å…·"></a>ä¸‰ã€HotSpotè™šæ‹Ÿæœºæ’ä»¶åŠå·¥å…·</h3><p>è™šæ‹Ÿæœºçš„æ’ä»¶å’Œè¾…åŠ©å·¥å…·å­˜æ”¾åœ¨HotSpotæºç hotspot/src/share/toolsç›®å½•ä¸‹ï¼š</p><p>ä¸»è¦æœ‰ï¼š</p><p>ï¼ˆ1ï¼‰Ideal Graph Visualizer</p><p>ç”¨äºå¯è§†åŒ–å±•ç¤ºC2å³æ—¶ç¼–è¯‘å™¨æ˜¯å¦‚ä½•å°†å­—èŠ‚ç è½¬åŒ–ä¸ºç†æƒ³å›¾ï¼Œç„¶åè½¬åŒ–ä¸ºæœºå™¨ç çš„ã€‚</p><p>ï¼ˆ2ï¼‰Client Compiler Visualizer</p><p>ç”¨äºæŸ¥çœ‹C1å³æ—¶ç¼–è¯‘å™¨ç”Ÿæˆé«˜çº§ä¸­é—´è¡¨ç¤ºï¼ˆHIRï¼‰ï¼Œè½¬æ¢æˆä½çº§ä¸­é—´è¡¨ç¤ºï¼ˆLIRï¼‰å’Œåšç‰©ç†å¯„å­˜å™¨åˆ†é…çš„è¿‡ç¨‹ã€‚</p><p>ï¼ˆ3ï¼‰MakeDeps</p><p>å¸®åŠ©å¤„ç†HotSpotçš„ç¼–è¯‘ä¾èµ–çš„å·¥å…·ã€‚</p><p>ï¼ˆ4ï¼‰Project Creator</p><p>å¸®å¿™ç”ŸæˆVisual Studioçš„.projectæ–‡ä»¶çš„å·¥å…·ã€‚</p><p>ï¼ˆ5ï¼‰LogCompilation</p><p>å°†-XXï¼š+LogCompilationè¾“å‡ºçš„æ—¥å¿—æ•´ç†æˆæ›´å®¹æ˜“é˜…è¯»çš„æ ¼å¼çš„å·¥å…·ã€‚</p><p>ï¼ˆ6ï¼‰HSDIS</p><p>å³æ—¶ç¼–è¯‘å™¨çš„åæ±‡ç¼–æ’ä»¶ã€‚HSDISå¯ä»¥ç”¨äºJITç”Ÿæˆä»£ç åæ±‡ç¼–</p><p>HSDISæ˜¯ä¸€ä¸ªè¢«å®˜æ–¹æ¨èçš„HotSpotè™šæ‹Ÿæœºå³æ—¶ç¼–è¯‘ä»£ç çš„åæ±‡ç¼–æ’ä»¶ï¼Œå®ƒåŒ…å«åœ¨HotSpotè™šæ‹Ÿæœºçš„æºç å½“ä¸­ï¼Œåœ¨OpenJDKçš„ç½‘ç«™[æ’å›¾]ä¹Ÿå¯ä»¥æ‰¾åˆ°å•ç‹¬çš„æºç ä¸‹è½½ã€‚</p><p>HSDISæ’ä»¶çš„ä½œç”¨æ˜¯è®©HotSpotçš„-XXï¼š+PrintAssemblyæŒ‡ä»¤è°ƒç”¨å®ƒæ¥æŠŠå³æ—¶ç¼–è¯‘å™¨åŠ¨æ€ç”Ÿæˆçš„æœ¬åœ°ä»£ç è¿˜åŸä¸ºæ±‡ç¼–ä»£ç è¾“å‡ºï¼ŒåŒæ—¶è¿˜ä¼šè‡ªåŠ¨äº§ç”Ÿå¤§é‡éå¸¸æœ‰ä»·å€¼çš„æ³¨é‡Šï¼Œè¿™æ ·å¯ä»¥é€šè¿‡è¾“å‡ºçš„æ±‡ç¼–ä»£ç æ¥ä»æœ€æœ¬è´¨çš„è§’åº¦åˆ†æé—®é¢˜ã€‚</p><blockquote><p>éœ€è¦è‡ªå·±ä¸‹è½½ç¼–è¯‘å¥½çš„æ’ä»¶ï¼Œç›´æ¥æ”¾åˆ°JDK_HOME/jre/bin/serverç›®å½•ï¼ˆJDK 9ä»¥ä¸‹ï¼‰æˆ–JDK_HOME/lib/amd64/serverï¼ˆJDK 9æˆ–ä»¥ä¸Šï¼‰ä¸­å³å¯ä½¿ç”¨ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ‰€é‡‡ç”¨æ“ä½œç³»ç»Ÿçš„å¯¹åº”ç¼–è¯‘æˆå“ï¼Œé‚£å°±è‡ªå·±ç”¨æºç ç¼–è¯‘ä¸€éï¼ˆç½‘ä¸Šèƒ½æ‰¾åˆ°å„ç§æ“ä½œç³»ç»Ÿä¸‹çš„ç¼–è¯‘æ•™ç¨‹ï¼‰ã€‚</p><p>ä½¿ç”¨SlowDebugæˆ–è€…FastDebugç‰ˆçš„HotSpotï¼Œå¯ä»¥ç›´æ¥é€šè¿‡-XXï¼š+PrintAssemblyæŒ‡ä»¤ä½¿ç”¨çš„æ’ä»¶ï¼›</p><p>å¦‚æœä½¿ç”¨Productç‰ˆçš„HotSpotï¼Œåˆ™è¿˜è¦é¢å¤–åŠ å…¥ä¸€ä¸ª-XXï¼š+UnlockDiagnosticVMOptionså‚æ•°æ‰å¯ä»¥å·¥ä½œã€‚</p></blockquote><p>ç›¸å…³ç¤ºä¾‹æ¶‰åŠæ±‡ç¼–è¯­è¨€ï¼Œå‚è€ƒã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆã€‹ç¬¬å››ç« 4.4èŠ‚ã€‚</p><p>JITWatch æ˜¯HSDISç»å¸¸æ­é…ä½¿ç”¨çš„å¯è§†åŒ–çš„ç¼–è¯‘æ—¥å¿—åˆ†æå·¥å…·ï¼Œä¸ºä¾¿äºåœ¨JITWatchä¸­è¯»å–ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‚æ•°æŠŠæ—¥å¿—è¾“å‡ºåˆ°logfileæ–‡ä»¶ã€‚</p><pre class=" language-txt"><code class="language-txt">-XX:+UnlockDiagnosticVMOptions-XX:+TraceClassLoading-XX:+LogCompilation-XX:LogFile=/tmp/logfile.log-XX:+PrintAssembly-XX:+TraceClassLoading</code></pre><p>åœ¨JITWatchä¸­åŠ è½½æ—¥å¿—åï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰§è¡ŒæœŸé—´ä½¿ç”¨è¿‡çš„å„ç§å¯¹è±¡ç±»å‹å’Œå¯¹åº”è°ƒç”¨è¿‡çš„æ–¹æ³•äº†ï¼Œé€‰æ‹©æƒ³è¦æŸ¥çœ‹çš„ç±»å’Œæ–¹æ³•ï¼Œå³å¯æŸ¥çœ‹å¯¹åº”çš„Javaæºä»£ç ã€å­—èŠ‚ç å’Œå³æ—¶ç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> ç›‘æ§è°ƒä¼˜å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmä¹‹ç±»æ–‡ä»¶ç»“æ„</title>
      <link href="/posts/6698cab3.html"/>
      <url>/posts/6698cab3.html</url>
      
        <content type="html"><![CDATA[<h2 id="jvmç±»æ–‡ä»¶ç»“æ„"><a href="#jvmç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="jvmç±»æ–‡ä»¶ç»“æ„"></a>jvmç±»æ–‡ä»¶ç»“æ„</h2><p>å„ç§ä¸åŒå¹³å°çš„Javaè™šæ‹Ÿæœºï¼Œä»¥åŠæ‰€æœ‰å¹³å°éƒ½ç»Ÿä¸€æ”¯æŒçš„ç¨‹åºå­˜å‚¨æ ¼å¼â€”â€”å­—èŠ‚ç ï¼ˆByteCodeï¼‰ã€‚</p><blockquote><p>Javaè™šæ‹Ÿæœºä¸ä¸åŒ…æ‹¬Javaè¯­è¨€åœ¨å†…çš„ä»»ä½•ç¨‹åºè¯­è¨€ç»‘å®šï¼Œå®ƒåªä¸â€Classæ–‡ä»¶â€è¿™ç§ç‰¹å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼æ‰€å…³è”ï¼ŒClassæ–‡ä»¶ä¸­åŒ…å«äº†Javaè™šæ‹ŸæœºæŒ‡ä»¤é›†ã€ç¬¦å·è¡¨ä»¥åŠè‹¥å¹²å…¶ä»–è¾…åŠ©ä¿¡æ¯ã€‚</p><p>Javaè¯­è¨€ä¸­çš„å„ç§è¯­æ³•ã€å…³é”®å­—ã€å¸¸é‡å˜é‡å’Œè¿ç®—ç¬¦å·çš„è¯­ä¹‰æœ€ç»ˆéƒ½ä¼šç”±å¤šæ¡å­—èŠ‚ç æŒ‡ä»¤ç»„åˆæ¥è¡¨è¾¾ï¼Œè¿™å†³å®šäº†å­—èŠ‚ç æŒ‡ä»¤æ‰€èƒ½æä¾›çš„è¯­è¨€æè¿°èƒ½åŠ›å¿…é¡»æ¯”Javaè¯­è¨€æœ¬èº«æ›´åŠ å¼ºå¤§æ‰è¡Œã€‚</p></blockquote><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class.jpg" alt="javaè™šæ‹Ÿæœºçš„è¯­è¨€æ— å…³æ€§"></p><h2 id="ä¸€ã€Classç±»æ–‡ä»¶çš„ç»“æ„"><a href="#ä¸€ã€Classç±»æ–‡ä»¶çš„ç»“æ„" class="headerlink" title="ä¸€ã€Classç±»æ–‡ä»¶çš„ç»“æ„"></a>ä¸€ã€Classç±»æ–‡ä»¶çš„ç»“æ„</h2><h4 id="1ã€classæ–‡ä»¶çš„ä¸»è¦ç»“æ„"><a href="#1ã€classæ–‡ä»¶çš„ä¸»è¦ç»“æ„" class="headerlink" title="1ã€classæ–‡ä»¶çš„ä¸»è¦ç»“æ„"></a>1ã€classæ–‡ä»¶çš„ä¸»è¦ç»“æ„</h4><p>é€šå¸¸æ¥è¯´ï¼Œä»»ä½•ä¸€ä¸ªClassæ–‡ä»¶éƒ½å¯¹åº”ç€å”¯ä¸€çš„ä¸€ä¸ªç±»æˆ–æ¥å£çš„å®šä¹‰ä¿¡æ¯ã€‚ç±»æˆ–æ¥å£å¹¶ä¸ä¸€å®šéƒ½å¾—å®šä¹‰åœ¨æ–‡ä»¶é‡Œï¼ˆæ¯”å¦‚ç±»æˆ–æ¥å£ä¹Ÿå¯ä»¥åŠ¨æ€ç”Ÿæˆï¼Œç›´æ¥é€å…¥ç±»åŠ è½½å™¨ä¸­ï¼‰ã€‚</p><blockquote><p>Classæ–‡ä»¶æ˜¯ä¸€ç»„ä»¥8ä¸ªå­—èŠ‚ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµï¼Œå„ä¸ªæ•°æ®é¡¹ç›®ä¸¥æ ¼æŒ‰ç…§é¡ºåºç´§å‡‘åœ°æ’åˆ—åœ¨æ–‡ä»¶ä¹‹ä¸­ï¼Œä¸­é—´æ²¡æœ‰æ·»åŠ ä»»ä½•åˆ†éš”ç¬¦ï¼Œè¿™ä½¿å¾—æ•´ä¸ªClassæ–‡ä»¶ä¸­å­˜å‚¨çš„å†…å®¹å‡ ä¹å…¨éƒ¨æ˜¯ç¨‹åºè¿è¡Œçš„å¿…è¦æ•°æ®ï¼Œæ²¡æœ‰ç©ºéš™å­˜åœ¨ã€‚å½“é‡åˆ°éœ€è¦å ç”¨8ä¸ªå­—èŠ‚ä»¥ä¸Šç©ºé—´çš„æ•°æ®é¡¹æ—¶ï¼Œåˆ™ä¼šæŒ‰ç…§é«˜ä½åœ¨å‰[æ’å›¾]çš„æ–¹å¼åˆ†å‰²æˆè‹¥å¹²ä¸ª8ä¸ªå­—èŠ‚è¿›è¡Œå­˜å‚¨ã€‚</p></blockquote><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„è§„å®šï¼ŒClassæ–‡ä»¶æ ¼å¼é‡‡ç”¨ä¸€ç§ç±»ä¼¼äºCè¯­è¨€ç»“æ„ä½“çš„ä¼ªç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™ç§ä¼ªç»“æ„ä¸­åªæœ‰ä¸¤ç§æ•°æ®ç±»å‹ï¼šâ€æ— ç¬¦å·æ•°â€å’Œâ€è¡¨â€ã€‚</p><p>ï¼ˆ1ï¼‰æ— ç¬¦å·æ•°ï¼š</p><p>æ— ç¬¦å·æ•°å±äºåŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä»¥u1ã€u2ã€u4ã€u8æ¥åˆ†åˆ«ä»£è¡¨1ä¸ªå­—èŠ‚ã€2ä¸ªå­—èŠ‚ã€4ä¸ªå­—èŠ‚å’Œ8ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•°ï¼Œæ— ç¬¦å·æ•°å¯ä»¥ç”¨æ¥æè¿°æ•°å­—ã€ç´¢å¼•å¼•ç”¨ã€æ•°é‡å€¼æˆ–è€…æŒ‰ç…§UTF-8ç¼–ç æ„æˆå­—ç¬¦ä¸²å€¼ã€‚</p><p>ï¼ˆ2ï¼‰è¡¨</p><p>è¡¨æ˜¯ç”±å¤šä¸ªæ— ç¬¦å·æ•°æˆ–è€…å…¶ä»–è¡¨ä½œä¸ºæ•°æ®é¡¹æ„æˆçš„å¤åˆæ•°æ®ç±»å‹ï¼Œæ‰€æœ‰è¡¨çš„å‘½åéƒ½ä¹ æƒ¯æ€§åœ°ä»¥<code>&quot;_info&quot;</code>ç»“å°¾ã€‚</p><p>è¡¨ç”¨äºæè¿°æœ‰å±‚æ¬¡å…³ç³»çš„å¤åˆç»“æ„çš„æ•°æ®ï¼Œæ•´ä¸ªClassæ–‡ä»¶æœ¬è´¨ä¸Šä¹Ÿå¯ä»¥è§†ä½œæ˜¯ä¸€å¼ è¡¨ï¼Œè¡¨çš„æ•°æ®é¡¹æŒ‰ä¸¥æ ¼é¡ºåºæ’åˆ—æ„æˆçš„ã€‚</p><p>classæ–‡ä»¶æ ¼å¼æ•°æ®é¡¹å¦‚å›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-2.jpg" alt="classæ–‡ä»¶æ ¼å¼"></p><p>æ— ç¬¦å·æ•°æˆ–è¡¨ä¸­ï¼Œå½“éœ€è¦æè¿°åŒä¸€ç±»å‹ä½†æ•°é‡ä¸å®šçš„å¤šä¸ªæ•°æ®æ—¶ï¼Œç»å¸¸ä¼šä½¿ç”¨ä¸€ä¸ªå‰ç½®çš„å®¹é‡è®¡æ•°å™¨åŠ è‹¥å¹²ä¸ªè¿ç»­çš„æ•°æ®é¡¹çš„å½¢å¼ï¼Œè¿™æ—¶å€™ç§°è¿™ä¸€ç³»åˆ—è¿ç»­çš„æŸä¸€ç±»å‹çš„æ•°æ®ä¸ºæŸä¸€ç±»å‹çš„â€é›†åˆâ€ã€‚</p><p><strong>ç‰¹åˆ«è¯´æ˜</strong></p><blockquote><p>Classçš„ç»“æ„æ²¡æœ‰ä»»ä½•åˆ†éš”ç¬¦å·ï¼Œæ‰€ä»¥ä¸Šå›¾çš„æ•°æ®é¡¹ä¸­ï¼Œæ— è®ºæ˜¯é¡ºåºè¿˜æ˜¯æ•°é‡ï¼Œç”šè‡³äºæ•°æ®å­˜å‚¨çš„å­—èŠ‚åºï¼ˆByteOrderingï¼ŒClassæ–‡ä»¶ä¸­å­—èŠ‚åºä¸ºBig-Endianï¼‰è¿™æ ·çš„ç»†èŠ‚ï¼Œéƒ½æ˜¯è¢«ä¸¥æ ¼é™å®šçš„ï¼Œå“ªä¸ªå­—èŠ‚ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Œé•¿åº¦æ˜¯å¤šå°‘ï¼Œå…ˆåé¡ºåºå¦‚ä½•ï¼Œå…¨éƒ¨éƒ½ä¸å…è®¸æ”¹å˜ã€‚</p></blockquote><h4 id="2ã€é­”æ•°ä¸Classæ–‡ä»¶çš„ç‰ˆæœ¬"><a href="#2ã€é­”æ•°ä¸Classæ–‡ä»¶çš„ç‰ˆæœ¬" class="headerlink" title="2ã€é­”æ•°ä¸Classæ–‡ä»¶çš„ç‰ˆæœ¬"></a>2ã€é­”æ•°ä¸Classæ–‡ä»¶çš„ç‰ˆæœ¬</h4><p>æ¯ä¸ªClassæ–‡ä»¶çš„å¤´4ä¸ªå­—èŠ‚è¢«ç§°ä¸ºé­”æ•°ï¼ˆMagic Numberï¼‰ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥å—çš„Classæ–‡ä»¶ã€‚</p><p>javaçš„Classæ–‡ä»¶çš„é­”æ•°å€¼å›ºå®šä¸º<code>0xCAFEBABE</code>ã€‚</p><p>ç´§æ¥ç€é­”æ•°çš„4ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯Classæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼šç¬¬5å’Œç¬¬6ä¸ªå­—èŠ‚æ˜¯æ¬¡ç‰ˆæœ¬å·ï¼ˆMinorVersionï¼‰ï¼Œç¬¬7å’Œç¬¬8ä¸ªå­—èŠ‚æ˜¯ä¸»ç‰ˆæœ¬å·ï¼ˆMajor Versionï¼‰ã€‚</p><blockquote><p>Javaçš„ç‰ˆæœ¬å·æ˜¯ä»45å¼€å§‹çš„ï¼ŒJDK 1.1ä¹‹åçš„æ¯ä¸ªJDKå¤§ç‰ˆæœ¬å‘å¸ƒä¸»ç‰ˆæœ¬å·å‘ä¸ŠåŠ 1ï¼ˆJDK 1.0ï½1.1ä½¿ç”¨äº†45.0ï½45.3çš„ç‰ˆæœ¬å·ï¼‰ï¼Œé«˜ç‰ˆæœ¬çš„JDKèƒ½å‘ä¸‹å…¼å®¹ä»¥å‰ç‰ˆæœ¬çš„Classæ–‡ä»¶ï¼Œä½†ä¸èƒ½è¿è¡Œä»¥åç‰ˆæœ¬çš„Classæ–‡ä»¶ï¼Œå› ä¸ºã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹åœ¨Classæ–‡ä»¶æ ¡éªŒéƒ¨åˆ†æ˜ç¡®è¦æ±‚äº†å³ä½¿æ–‡ä»¶æ ¼å¼å¹¶æœªå‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œè™šæ‹Ÿæœºä¹Ÿå¿…é¡»æ‹’ç»æ‰§è¡Œè¶…è¿‡å…¶ç‰ˆæœ¬å·çš„Classæ–‡ä»¶ã€‚</p></blockquote><p>å½“æˆ‘å­¦åˆ°è¿™é‡Œæˆ‘ç®—æ˜¯æ˜ç™½ä»¥å‰åœ¨é¡¹ç›®è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ç”¨é«˜ç‰ˆæœ¬ç¼–è¯‘ï¼Œä½ç‰ˆæœ¬è¿è¡ŒæŠ¥é”™çš„çœŸæ­£åŸå› äº†ã€‚</p><p>å¦‚ï¼šJDK 1.1èƒ½æ”¯æŒç‰ˆæœ¬å·ä¸º45.0ï½45.65535çš„Classæ–‡ä»¶ï¼Œæ— æ³•æ‰§è¡Œç‰ˆæœ¬å·ä¸º46.0ä»¥ä¸Šçš„Classæ–‡ä»¶ï¼Œè€ŒJDK 1.2åˆ™èƒ½æ”¯æŒ45.0ï½46.65535çš„Classæ–‡ä»¶ã€‚ç›®å‰æœ€æ–°çš„JDKç‰ˆæœ¬ä¸º13ï¼Œå¯ç”Ÿæˆçš„Classæ–‡ä»¶ä¸»ç‰ˆæœ¬å·æœ€å¤§å€¼ä¸º57.0ã€‚</p><p>æ¯”å¦‚æ¥ä¸ªç»å…¸çš„HelloWorldæ–‡ä»¶ï¼ŒåŠ ä¸ªå˜é‡å’Œæ–¹æ³•ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> test<span class="token punctuation">.</span>com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>klass<span class="token punctuation">.</span>test<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> n<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç”¨WinHexæ‰“å¼€HelloWorld.classæ–‡ä»¶ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-demo1.png" alt="HelloWorld.classæ–‡ä»¶ç‰ˆæœ¬ç¤ºä¾‹"></p><p>å¯ä»¥æ¸…æ¥šåœ°çœ‹è§å¼€å¤´4ä¸ªå­—èŠ‚çš„åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯0xCAFEBABEï¼Œä»£è¡¨æ¬¡ç‰ˆæœ¬å·çš„ç¬¬5ä¸ªå’Œç¬¬6ä¸ªå­—èŠ‚å€¼ä¸º0x0000ï¼Œè€Œä¸»ç‰ˆæœ¬å·çš„å€¼ä¸º0x0033ï¼Œä¹Ÿå³æ˜¯åè¿›åˆ¶çš„51ï¼Œå¯¹åº”çš„jdk7ï¼Œå¯ä»¥è¢«jdk7åŠä»¥ä¸Šç‰ˆæœ¬è™šæ‹Ÿæœºæ‰§è¡Œã€‚</p><p>ä¸»æµJDKç‰ˆæœ¬ç¼–è¯‘å™¨è¾“å‡ºçš„é»˜è®¤çš„å’Œå¯æ”¯æŒçš„Classæ–‡ä»¶ç‰ˆæœ¬å·ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-verson.jpg" alt="jdkä¸classæ–‡ä»¶ç‰ˆæœ¬å¯¹ç…§"></p><p>æ³¨ï¼šä»JDK 9å¼€å§‹ï¼ŒJavacç¼–è¯‘å™¨ä¸å†æ”¯æŒä½¿ç”¨-sourceå‚æ•°ç¼–è¯‘ç‰ˆæœ¬å·å°äº1.5çš„æºç ã€‚</p><p>æ¬¡ç‰ˆæœ¬å·ï¼Œä»JDK 1.2ä»¥åï¼Œç›´åˆ°JDK 12ä¹‹å‰æ¬¡ç‰ˆæœ¬å·å‡æœªä½¿ç”¨ï¼Œå…¨éƒ¨å›ºå®šä¸ºé›¶ã€‚JDK 12å¼€å§‹ï¼Œé‡æ–°å¯ç”¨æ¬¡ç‰ˆæœ¬å·ï¼Œå°†å®ƒç”¨äºæ ‡è¯†â€æŠ€æœ¯é¢„è§ˆç‰ˆâ€åŠŸèƒ½ç‰¹æ€§çš„æ”¯æŒã€‚å¦‚æœClassæ–‡ä»¶ä¸­ä½¿ç”¨äº†è¯¥ç‰ˆæœ¬JDKå°šæœªåˆ—å…¥æ­£å¼ç‰¹æ€§æ¸…å•ä¸­çš„é¢„è§ˆåŠŸèƒ½ï¼Œåˆ™å¿…é¡»æŠŠæ¬¡ç‰ˆæœ¬å·æ ‡è¯†ä¸º65535ï¼Œä»¥ä¾¿Javaè™šæ‹Ÿæœºåœ¨åŠ è½½ç±»æ–‡ä»¶æ—¶èƒ½å¤ŸåŒºåˆ†å‡ºæ¥ã€‚</p><h4 id="3ã€å¸¸é‡æ± "><a href="#3ã€å¸¸é‡æ± " class="headerlink" title="3ã€å¸¸é‡æ± "></a>3ã€å¸¸é‡æ± </h4><p>ç´§æ¥ç€ä¸»ã€æ¬¡ç‰ˆæœ¬å·ä¹‹åçš„æ˜¯å¸¸é‡æ± å…¥å£ã€‚å¸¸é‡æ± å¯ä»¥æ¯”å–»ä¸ºClassæ–‡ä»¶é‡Œçš„èµ„æºä»“åº“ï¼Œå®ƒæ˜¯Classæ–‡ä»¶ç»“æ„ä¸­ä¸å…¶ä»–é¡¹ç›®å…³è”æœ€å¤šçš„æ•°æ®ï¼Œé€šå¸¸ä¹Ÿæ˜¯å ç”¨Classæ–‡ä»¶ç©ºé—´æœ€å¤§çš„æ•°æ®é¡¹ç›®ä¹‹ä¸€ï¼Œå¦å¤–ï¼Œå®ƒè¿˜æ˜¯åœ¨Classæ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªå‡ºç°çš„è¡¨ç±»å‹æ•°æ®é¡¹ç›®ã€‚</p><p>å¸¸é‡æ± ä¸­å¸¸é‡çš„æ•°é‡æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥åœ¨å¸¸é‡æ± çš„å…¥å£éœ€è¦æ”¾ç½®ä¸€é¡¹u2ç±»å‹çš„æ•°æ®ï¼Œä»£è¡¨å¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ï¼ˆconstant_pool_countï¼‰ã€‚è¿™ä¸ªå®¹é‡è®¡æ•°æ˜¯ä»1è€Œä¸æ˜¯0å¼€å§‹çš„ï¼Œå¦‚å›¾HelloWorldç±»æ–‡ä»¶æˆªå›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-demo2.png" alt="HelloWorld.classé‡Œçš„å¸¸é‡æ± "></p><p>å¸¸é‡æ± å®¹é‡ï¼ˆåç§»åœ°å€ï¼š0x00000008ï¼‰ä¸ºåå…­è¿›åˆ¶æ•°0x0028ï¼Œå³åè¿›åˆ¶çš„40ï¼Œè¿™å°±ä»£è¡¨å¸¸é‡æ± ä¸­æœ‰40é¡¹å¸¸é‡ï¼Œç´¢å¼•å€¼èŒƒå›´ä¸º1ï½40ã€‚</p><blockquote><p>ç´¢å¼•å€¼ç¬¬0é¡¹å¸¸é‡ç©ºå‡ºæ¥æ˜¯æœ‰ç‰¹æ®Šè€ƒè™‘çš„ï¼Œè¿™æ ·åšçš„ç›®çš„åœ¨äºï¼Œå¦‚æœåé¢æŸäº›æŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•å€¼çš„æ•°æ®åœ¨ç‰¹å®šæƒ…å†µä¸‹éœ€è¦è¡¨è¾¾â€ä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹ç›®â€çš„å«ä¹‰ï¼Œå¯ä»¥æŠŠç´¢å¼•å€¼è®¾ç½®ä¸º0æ¥è¡¨ç¤ºã€‚Classæ–‡ä»¶ç»“æ„ä¸­åªæœ‰å¸¸é‡æ± çš„å®¹é‡è®¡æ•°æ˜¯ä»1å¼€å§‹ï¼Œå¯¹äºå…¶ä»–é›†åˆç±»å‹ï¼ŒåŒ…æ‹¬æ¥å£ç´¢å¼•é›†åˆã€å­—æ®µè¡¨é›†åˆã€æ–¹æ³•è¡¨é›†åˆç­‰çš„å®¹é‡è®¡æ•°éƒ½ä¸ä¸€èˆ¬ä¹ æƒ¯ç›¸åŒï¼Œæ˜¯ä»0å¼€å§‹ã€‚</p></blockquote><p>å¸¸é‡æ± ä¸­ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰ å’Œ ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ ã€‚</p><p>ï¼ˆ1ï¼‰å­—é¢é‡ï¼ˆLiteralï¼‰</p><p>å¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€è¢«å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰</p><p>ï¼ˆ2ï¼‰ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ :</p><p>ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š</p><p>â€‹    ï¼ˆaï¼‰è¢«æ¨¡å—å¯¼å‡ºæˆ–è€…å¼€æ”¾çš„åŒ…ï¼ˆPackageï¼‰</p><p>â€‹    ï¼ˆbï¼‰ç±»å’Œæ¥å£çš„å…¨é™å®šåï¼ˆFully Qualified Nameï¼‰</p><p>â€‹    ï¼ˆcï¼‰å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ï¼ˆDescriptorï¼‰</p><p>â€‹    ï¼ˆdï¼‰æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</p><p>â€‹    ï¼ˆeï¼‰æ–¹æ³•å¥æŸ„å’Œæ–¹æ³•ç±»å‹ï¼ˆMethod Handleã€Method Typeã€Invoke Dynamicï¼‰</p><p>â€‹    ï¼ˆfï¼‰åŠ¨æ€è°ƒç”¨ç‚¹å’ŒåŠ¨æ€å¸¸é‡ï¼ˆDynamically-Computed Call Siteã€Dynamically-ComputedConstantï¼‰</p><blockquote><p>è™šæ‹ŸæœºåŠ è½½Classæ–‡ä»¶çš„æ—¶å€™è¿›è¡ŒåŠ¨æ€è¿æ¥ï¼Œæ‰€ä»¥åœ¨Classæ–‡ä»¶ä¸­ä¸ä¼šä¿å­˜å„ä¸ªæ–¹æ³•ã€å­—æ®µæœ€ç»ˆåœ¨å†…å­˜ä¸­çš„å¸ƒå±€ä¿¡æ¯ï¼Œè¿™äº›å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ä¸ç»è¿‡è™šæ‹Ÿæœºåœ¨è¿è¡ŒæœŸè½¬æ¢çš„è¯æ˜¯æ— æ³•å¾—åˆ°çœŸæ­£çš„å†…å­˜å…¥å£åœ°å€ï¼Œä¹Ÿå°±æ— æ³•ç›´æ¥è¢«è™šæ‹Ÿæœºä½¿ç”¨çš„ã€‚å½“è™šæ‹Ÿæœºåšç±»åŠ è½½æ—¶ï¼Œå°†ä¼šä»å¸¸é‡æ± è·å¾—å¯¹åº”çš„ç¬¦å·å¼•ç”¨ï¼Œå†åœ¨ç±»åˆ›å»ºæ—¶æˆ–è¿è¡Œæ—¶è§£æã€ç¿»è¯‘åˆ°å…·ä½“çš„å†…å­˜åœ°å€ä¹‹ä¸­ã€‚</p></blockquote><p>å¸¸é‡æ± ä¸­æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼Œæœ€åˆå¸¸é‡è¡¨ä¸­å…±æœ‰11ç§ç»“æ„å„ä¸ç›¸åŒçš„è¡¨ç»“æ„æ•°æ®ï¼Œåæ¥ä¸ºäº†æ›´å¥½åœ°æ”¯æŒåŠ¨æ€è¯­è¨€è°ƒç”¨ï¼Œé¢å¤–å¢åŠ äº†4ç§åŠ¨æ€è¯­è¨€ç›¸å…³çš„å¸¸é‡[æ’å›¾]ï¼Œä¸ºäº†æ”¯æŒJavaæ¨¡å—åŒ–ç³»ç»Ÿï¼ˆJigsawï¼‰ï¼ŒåˆåŠ å…¥äº†CONSTANT_Module_infoå’ŒCONSTANT_Package_infoä¸¤ä¸ªå¸¸é‡ï¼Œæ‰€ä»¥æˆªè‡³JDK 13ï¼Œå¸¸é‡è¡¨ä¸­åˆ†åˆ«æœ‰17ç§ä¸åŒç±»å‹çš„å¸¸é‡ã€‚</p><p>17ç±»è¡¨éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œè¡¨ç»“æ„èµ·å§‹çš„ç¬¬ä¸€ä½æ˜¯ä¸ªu1ç±»å‹çš„æ ‡å¿—ä½ï¼ˆtagï¼‰ï¼Œä»£è¡¨ç€å½“å‰å¸¸é‡å±äºå“ªç§å¸¸é‡ç±»å‹ã€‚å¦‚å›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-clc.jpg" alt="17ç§å¸¸é‡ç±»å‹"></p><p>è¿™17ç§å¸¸é‡ç±»å‹å„è‡ªæœ‰ç€å®Œå…¨ç‹¬ç«‹çš„æ•°æ®ç»“æ„ã€‚</p><p>ä¾æ—§ä»¥Helloworld.classä¸ºä¾‹ï¼š</p><p>æ ‡å¿—ä½ï¼ˆåç§»åœ°å€ï¼š0x0000000Aï¼‰æ˜¯0x07ï¼ŒæŸ¥ä¸Šè¡¨æ ‡å¿—æ˜¯7å¯¹åº”çš„å¸¸é‡ç±»å‹æ˜¯CONSTANT_Class_infoï¼Œä»£è¡¨ä¸€ä¸ªç±»æˆ–è€…æ¥å£çš„ç¬¦å·å¼•ç”¨ã€‚</p><p>CONSTANT_Class_infoçš„ç»“æ„å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>ul</td><td>tag</td><td>1</td></tr><tr><td>u2</td><td>name_index</td><td>1</td></tr></tbody></table><p>tagæ˜¯æ ‡å¿—ä½ï¼Œå®ƒç”¨äºåŒºåˆ†å¸¸é‡ç±»å‹ï¼›</p><p>name_indexæ˜¯å¸¸é‡æ± çš„ç´¢å¼•å€¼ï¼Œå®ƒæŒ‡å‘å¸¸é‡æ± ä¸­ä¸€ä¸ªCONSTANT_Utf8_infoç±»å‹å¸¸é‡ï¼Œæ­¤å¸¸é‡ä»£è¡¨äº†è¿™ä¸ªç±»ï¼ˆæˆ–è€…æ¥å£ï¼‰çš„å…¨é™å®šåã€‚</p><p>ä¾æ—§ä»¥Helloworld.classä¸ºä¾‹</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-demo3.png" alt="HelloWorldç±»å¸¸é‡æ± ç»“æ„"></p><p>name_indexå€¼ï¼ˆåç§»åœ°å€ï¼š0x0000000Bï¼‰ä¸º0x0002ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„ç¬¬äºŒé¡¹å¸¸é‡ï¼Œå›¾ä¸­ç¬¬äºŒé¡¹å¸¸é‡æ ‡å¿—ä½ï¼ˆåœ°å€ï¼š0x0000000Dï¼‰æ˜¯0x01ã€‚æŸ¥å¸¸é‡æ± è¡¨ï¼Œå¯ä»¥ç¡®å®šæ˜¯ä¸€ä¸ªCONSTANT_Utf8_infoç±»å‹çš„å¸¸é‡ã€‚</p><p>CONSTANT_Utf8_infoå‹å¸¸é‡çš„ç»“æ„:</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>ul</td><td>tag</td><td>1</td></tr><tr><td>u2</td><td>length</td><td>1</td></tr><tr><td>u1</td><td>bytes</td><td>length</td></tr></tbody></table><blockquote><p>lengthå€¼è¯´æ˜äº†è¿™ä¸ªUTF-8ç¼–ç çš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¤šå°‘å­—èŠ‚ï¼Œå®ƒåé¢ç´§è·Ÿç€çš„é•¿åº¦ä¸ºlengthå­—èŠ‚çš„è¿ç»­æ•°æ®æ˜¯ä¸€ä¸ªä½¿ç”¨UTF-8ç¼©ç•¥ç¼–ç è¡¨ç¤ºçš„å­—ç¬¦ä¸²ã€‚UTF-8ç¼©ç•¥ç¼–ç ä¸æ™®é€šUTF-8ç¼–ç çš„åŒºåˆ«æ˜¯ï¼šä»â€™\u0001â€™åˆ°â€™\u007fâ€™ä¹‹é—´çš„å­—ç¬¦ï¼ˆç›¸å½“äº1ï½127çš„ASCIIç ï¼‰çš„ç¼©ç•¥ç¼–ç ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä»â€™\u0080â€™åˆ°â€™\u07ffâ€™ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦çš„ç¼©ç•¥ç¼–ç ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä»â€™\u0800â€™å¼€å§‹åˆ°â€™\uffffâ€™ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦çš„ç¼©ç•¥ç¼–ç å°±æŒ‰ç…§æ™®é€šUTF-8ç¼–ç è§„åˆ™ä½¿ç”¨ä¸‰ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚</p></blockquote><p>ç”±äºClassæ–‡ä»¶ä¸­æ–¹æ³•ã€å­—æ®µç­‰éƒ½éœ€è¦å¼•ç”¨CONSTANT_Utf8_infoå‹å¸¸é‡æ¥æè¿°åç§°ï¼Œæ‰€ä»¥CONSTANT_Utf8_infoå‹å¸¸é‡çš„æœ€å¤§é•¿åº¦ä¹Ÿå°±æ˜¯Javaä¸­æ–¹æ³•ã€å­—æ®µåçš„æœ€å¤§é•¿åº¦ã€‚è€Œè¿™é‡Œçš„æœ€å¤§é•¿åº¦å°±æ˜¯lengthçš„æœ€å¤§å€¼ï¼Œæ—¢u2ç±»å‹èƒ½è¡¨è¾¾çš„æœ€å¤§å€¼65535ã€‚Javaç¨‹åºä¸­å¦‚æœå®šä¹‰äº†è¶…è¿‡64KBè‹±æ–‡å­—ç¬¦çš„å˜é‡æˆ–æ–¹æ³•åï¼Œå³ä½¿è§„åˆ™å’Œå…¨éƒ¨å­—ç¬¦éƒ½æ˜¯åˆæ³•çš„ï¼Œä¹Ÿä¼šæ— æ³•ç¼–è¯‘ã€‚</p><p>åœ¨helloworldçš„ä¾‹ä¸­</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-demo4.png" alt="å¸¸é‡æ± UTF-8å­—ç¬¦ä¸²ç»“æ„"></p><p>è¿™ä¸ªå­—ç¬¦ä¸²çš„lengthå€¼ï¼ˆåç§»åœ°å€ï¼š0x0000000Eï¼‰ä¸º0x0026ï¼Œä¹Ÿå°±æ˜¯é•¿38ä¸ªå­—èŠ‚ï¼Œå¾€å38ä¸ªå­—èŠ‚æ­£å¥½éƒ½åœ¨1ï½127çš„ASCIIç èŒƒå›´ä»¥å†…ï¼Œå†…å®¹ä¸ºâ€test.com.xiaocai.klass.test.HelloWorldâ€ï¼Œè½¬æ¢éƒ¨åˆ†åç»­å†è¡¥ä¸Šã€‚</p><p>//åå…­è¿›åˆ¶è½¬æ¢å¾…è¡¥å……</p><p>åœ¨JDKçš„binç›®å½•ä¸­ï¼ŒOracleå…¬å¸å·²ç»ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½ä¸€ä¸ªä¸“é—¨ç”¨äºåˆ†æClassæ–‡ä»¶å­—èŠ‚ç çš„å·¥å…·ï¼šjavapã€‚</p><p>ç›´æ¥ä½¿ç”¨javapå·¥å…·çš„-verboseå‚æ•°è¾“å‡ºçš„TestClass.classæ–‡ä»¶å­—èŠ‚ç å†…å®¹ã€‚</p><p>å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>javap -verbose HelloWorld.class </code></pre><p>ç”±äºæ–‡ä»¶é•¿æˆ‘å†™åˆ°txté‡Œï¼Œå…¨éƒ¨å†…å®¹å¦‚ä¸‹ï¼Œæš‚ä¸”ç§°ä¹‹ä¸ºå­—èŠ‚ç æ¸…å•ï¼š</p><pre class=" language-txt"><code class="language-txt">Classfile /E:/ide-tools/apache-tomcat-7.0.90-eclispe-pmis/webapps/pmis/WEB-INF/classes/test/com/xiaocai/klass/test/HelloWorld.class  Last modified 2020-6-9; size 691 bytes  MD5 checksum 549d707e6692d2c884983e3ad0873405  Compiled from "HelloWorld.java"public class test.com.xiaocai.klass.test.HelloWorld  SourceFile: "HelloWorld.java"  minor version: 0  major version: 51  flags: ACC_PUBLIC, ACC_SUPERConstant pool:   #1 = Class              #2             //  test/com/xiaocai/klass/test/HelloWorld   #2 = Utf8               test/com/xiaocai/klass/test/HelloWorld   #3 = Class              #4             //  java/lang/Object   #4 = Utf8               java/lang/Object   #5 = Utf8               m   #6 = Utf8               I   #7 = Utf8               <init>   #8 = Utf8               ()V   #9 = Utf8               Code  #10 = Methodref          #3.#11         //  java/lang/Object."<init>":()V  #11 = NameAndType        #7:#8          //  "<init>":()V  #12 = Utf8               LineNumberTable  #13 = Utf8               LocalVariableTable  #14 = Utf8               this  #15 = Utf8               Ltest/com/xiaocai/klass/test/HelloWorld;  #16 = Utf8               add  #17 = Utf8               ()I  #18 = Fieldref           #1.#19         //  test/com/xiaocai/klass/test/HelloWorld.m:I  #19 = NameAndType        #5:#6          //  m:I  #20 = Utf8               main  #21 = Utf8               ([Ljava/lang/String;)V  #22 = Fieldref           #23.#25        //  java/lang/System.out:Ljava/io/PrintStream;  #23 = Class              #24            //  java/lang/System  #24 = Utf8               java/lang/System  #25 = NameAndType        #26:#27        //  out:Ljava/io/PrintStream;  #26 = Utf8               out  #27 = Utf8               Ljava/io/PrintStream;  #28 = String             #29            //  Hello World!  #29 = Utf8               Hello World!  #30 = Methodref          #31.#33        //  java/io/PrintStream.println:(Ljava/lang/String;)V  #31 = Class              #32            //  java/io/PrintStream  #32 = Utf8               java/io/PrintStream  #33 = NameAndType        #34:#35        //  println:(Ljava/lang/String;)V  #34 = Utf8               println  #35 = Utf8               (Ljava/lang/String;)V  #36 = Utf8               args  #37 = Utf8               [Ljava/lang/String;  #38 = Utf8               SourceFile  #39 = Utf8               HelloWorld.java{  public test.com.xiaocai.klass.test.HelloWorld();    flags: ACC_PUBLIC    Code:      stack=1, locals=1, args_size=1         0: aload_0                1: invokespecial #10                 // Method java/lang/Object."<init>":()V         4: return              LineNumberTable:        line 3: 0      LocalVariableTable:        Start  Length  Slot  Name   Signature               0       5     0  this   Ltest/com/xiaocai/klass/test/HelloWorld;  public int add();    flags: ACC_PUBLIC    Code:      stack=2, locals=1, args_size=1         0: aload_0                1: getfield      #18                 // Field m:I         4: iconst_1               5: iadd                   6: ireturn             LineNumberTable:        line 8: 0      LocalVariableTable:        Start  Length  Slot  Name   Signature               0       7     0  this   Ltest/com/xiaocai/klass/test/HelloWorld;  public static void main(java.lang.String[]);    flags: ACC_PUBLIC, ACC_STATIC    Code:      stack=2, locals=1, args_size=1         0: getstatic     #22                 // Field java/lang/System.out:Ljava/io/PrintStream;         3: ldc           #28                 // String Hello World!         5: invokevirtual #30                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V         8: return              LineNumberTable:        line 13: 0        line 15: 8      LocalVariableTable:        Start  Length  Slot  Name   Signature               0       9     0  args   [Ljava/lang/String;}</code></pre><p>æ ¹æ®æ¸…å•å¯ä»¥çœ‹å‡ºå¸¸é‡æ± ä¸­æœ‰39é¡¹å¸¸é‡ï¼Œç´¢å¼•å€¼èŒƒå›´ä¸º1ï½39ï¼Œå¯¹åº”ç€åå…­è¿›åˆ¶çš„0x0028ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„40ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-demo0.jpg" alt="å¸¸é‡æ± ä¸­çš„17ç§æ•°æ®ç±»å‹çš„ç»“æ„æ€»è¡¨1"></p><p>å­—èŠ‚ç æ¸…å•ä¸­ç¬¬1ã€2é¡¹å¸¸é‡çš„è®¡ç®—ç»“æœä¸æˆ‘ä»¬æ‰‹å·¥è®¡ç®—çš„ç»“æœå®Œå…¨ä¸€è‡´ã€‚</p><blockquote><p>è¿˜æœ‰ä¸€äº›å¸¸é‡å¦‚â€Iâ€ã€â€Vâ€ã€â€<init>â€œã€â€LineNumberTableâ€ã€â€LocalVariableTableâ€ç­‰éƒ½æ˜¯ ç¼–è¯‘å™¨è‡ªå·±ç”Ÿæˆçš„ï¼Œä¼šè¢«å­—æ®µè¡¨ï¼ˆfield_infoï¼‰ã€æ–¹æ³•è¡¨ï¼ˆmethod_infoï¼‰ã€å±æ€§è¡¨ï¼ˆattribute_infoï¼‰æ‰€å¼•ç”¨ã€‚å®ƒä»¬å°†ä¼šè¢«ç”¨æ¥æè¿°ä¸€äº›ä¸æ–¹ä¾¿ä½¿ç”¨â€å›ºå®šå­—èŠ‚â€è¿›è¡Œè¡¨è¾¾çš„å†…å®¹ï¼Œè­¬å¦‚æè¿°æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Œæœ‰å‡ ä¸ªå‚æ•°ï¼Œæ¯ä¸ªå‚æ•°çš„ç±»å‹æ˜¯ä»€ä¹ˆã€‚</p></blockquote><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-changlangchi-1.jpg" alt="å¸¸é‡æ± ä¸­çš„17ç§æ•°æ®ç±»å‹çš„ç»“æ„æ€»è¡¨1"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-changlangchi-2.jpg" alt="å¸¸é‡æ± ä¸­çš„17ç§æ•°æ®ç±»å‹çš„ç»“æ„æ€»è¡¨2"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-changlangchi-3.jpg" alt="å¸¸é‡æ± ä¸­çš„17ç§æ•°æ®ç±»å‹çš„ç»“æ„æ€»è¡¨3"></p><h4 id="4ã€è®¿é—®æ ‡å¿—"><a href="#4ã€è®¿é—®æ ‡å¿—" class="headerlink" title="4ã€è®¿é—®æ ‡å¿—"></a>4ã€è®¿é—®æ ‡å¿—</h4><p>å¸¸é‡æ± ç»“æŸä¹‹åï¼Œç´§æ¥ç€çš„2ä¸ªå­—èŠ‚ä»£è¡¨è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ã€‚</p><p>è®¿é—®æ ‡å¿—ç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ã€‚åŒ…æ‹¬ï¼šè¿™ä¸ªClassæ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼›æ˜¯å¦å®šä¹‰ä¸ºpublicç±»å‹ï¼›æ˜¯å¦å®šä¹‰ä¸ºabstractç±»å‹ï¼›å¦‚æœæ˜¯ç±»çš„è¯ï¼Œæ˜¯å¦è¢«å£°æ˜ä¸ºfinalï¼›ç­‰ç­‰ã€‚</p><p>è®¿é—®æ ‡å¿—ç›¸å…³è¯´æ˜å¦‚ä¸‹è¡¨ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-accessflag.jpg" alt="è®¿é—®æ ‡å¿—è¯´æ˜è¡¨"></p><p>access_flagsä¸­ä¸€å…±æœ‰16ä¸ªæ ‡å¿—ä½å¯ä»¥ä½¿ç”¨ï¼Œå½“å‰åªå®šä¹‰äº†å…¶ä¸­9ä¸ªï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°çš„æ ‡å¿—ä½è¦æ±‚ä¸€å¾‹ä¸ºé›¶ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-demo5.png" alt="HelloWorld.classè®¿é—®æ ‡å¿—"></p><p>HelloWorldç±»æ˜¯ä¸ªæ™®é€šç±»ï¼Œä¸æ˜¯æ¥å£ã€æšä¸¾ã€æ³¨è§£æˆ–è€…æ¨¡å—ï¼Œè¢«publicå…³é”®å­—ä¿®é¥°ä½†æ²¡æœ‰è¢«å£°æ˜ä¸ºfinalå’Œabstractï¼Œå¹¶ä¸”å®ƒä½¿ç”¨äº†JDK 1.2ä¹‹åçš„ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘ï¼Œå› æ­¤å®ƒçš„<code>ACC_PUBLIC</code>ã€<code>ACC_SUPER</code>æ ‡å¿—åº”å½“ä¸ºçœŸï¼Œè€Œ<code>ACC_FINAL</code>ã€<code>ACC_INTERFACE</code>ã€<code>ACC_ABSTRACT</code>ã€<code>ACC_SYNTHETIC</code>ã€<code>ACC_ANNOTATION</code>ã€<code>ACC_ENUM</code>ã€<code>ACC_MODULE</code>è¿™ä¸ƒä¸ªæ ‡å¿—åº”å½“ä¸ºå‡ï¼Œå› æ­¤å®ƒçš„access_flagsçš„å€¼åº”ä¸ºï¼š0x0001|0x0020=0x0021ã€‚</p><h4 id="5ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ä¸æ¥å£ç´¢å¼•é›†åˆ"><a href="#5ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ä¸æ¥å£ç´¢å¼•é›†åˆ" class="headerlink" title="5ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ä¸æ¥å£ç´¢å¼•é›†åˆ"></a>5ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ä¸æ¥å£ç´¢å¼•é›†åˆ</h4><p>ç±»ç´¢å¼•ï¼ˆthis_classï¼‰å’Œçˆ¶ç±»ç´¢å¼•ï¼ˆsuper_classï¼‰éƒ½æ˜¯ä¸€ä¸ªu2ç±»å‹çš„æ•°æ®ï¼Œè€Œæ¥å£ç´¢å¼•é›†åˆï¼ˆinterfacesï¼‰æ˜¯ä¸€ç»„u2ç±»å‹çš„æ•°æ®çš„é›†åˆï¼ŒClassæ–‡ä»¶ä¸­ç”±è¿™ä¸‰é¡¹æ•°æ®æ¥ç¡®å®šè¯¥ç±»å‹çš„ç»§æ‰¿å…³ç³»ã€‚</p><p>ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåã€‚</p><p>çˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚</p><blockquote><p>ç”±äºJavaè¯­è¨€ä¸å…è®¸å¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ï¼Œæ‰€æœ‰çš„Javaç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº†java.lang.Objectå¤–ï¼Œæ‰€æœ‰Javaç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º0ã€‚</p></blockquote><p>æ¥å£ç´¢å¼•é›†åˆå°±ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰implementså…³é”®å­—ï¼ˆå¦‚æœè¿™ä¸ªClassæ–‡ä»¶è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ™åº”å½“æ˜¯extendså…³é”®å­—ï¼‰åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚</p><p>ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆéƒ½æŒ‰é¡ºåºæ’åˆ—åœ¨è®¿é—®æ ‡å¿—ä¹‹åï¼Œç±»ç´¢å¼•å’Œçˆ¶ç±»ç´¢å¼•ç”¨ä¸¤ä¸ªu2ç±»å‹çš„ç´¢å¼•å€¼è¡¨ç¤ºï¼Œå®ƒä»¬å„è‡ªæŒ‡å‘ä¸€ä¸ªç±»å‹ä¸ºCONSTANT_Class_infoçš„ç±»æè¿°ç¬¦å¸¸é‡ï¼Œé€šè¿‡CONSTANT_Class_infoç±»å‹çš„å¸¸é‡ä¸­çš„ç´¢å¼•å€¼å¯ä»¥æ‰¾åˆ°å®šä¹‰åœ¨CONSTANT_Utf8_infoç±»å‹çš„å¸¸é‡ä¸­çš„å…¨é™å®šåå­—ç¬¦ä¸²ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-ref-find.jpg" alt="ç±»ç´¢å¼•æŸ¥æ‰¾è¿‡ç¨‹"></p><p>å¯¹äºæ¥å£ç´¢å¼•é›†åˆï¼Œå…¥å£çš„ç¬¬ä¸€é¡¹u2ç±»å‹çš„æ•°æ®ä¸ºæ¥å£è®¡æ•°å™¨ï¼ˆinterfaces_countï¼‰ï¼Œè¡¨ç¤ºç´¢å¼•è¡¨çš„å®¹é‡ã€‚å¦‚æœè¯¥ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œåˆ™è¯¥è®¡æ•°å™¨å€¼ä¸º0ï¼Œåé¢æ¥å£çš„ç´¢å¼•è¡¨ä¸å†å ç”¨ä»»ä½•å­—èŠ‚ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-demo6.png" alt="HelloWorld.classç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆ"></p><p>ä»åç§»åœ°å€0x000000D6å¼€å§‹çš„3ä¸ªu2ç±»å‹çš„å€¼åˆ†åˆ«ä¸º0x0001ã€0x0003ã€0x0000ï¼Œä¹Ÿå°±æ˜¯ç±»ç´¢å¼•ä¸º1ï¼Œçˆ¶ç±»ç´¢å¼•ä¸º3ï¼Œæ¥å£ç´¢å¼•é›†åˆå¤§å°ä¸º0ã€‚</p><p>å¯¹äºå‰é¢çš„å­—èŠ‚ç æ¸…å•ä¸­ï¼š</p><pre class=" language-txt"><code class="language-txt">   #1 = Class              #2             //  test/com/xiaocai/klass/test/HelloWorld   #2 = Utf8               test/com/xiaocai/klass/test/HelloWorld   #3 = Class              #4             //  java/lang/Object   #4 = Utf8               java/lang/Object</code></pre><h4 id="6ã€å­—æ®µè¡¨é›†åˆ"><a href="#6ã€å­—æ®µè¡¨é›†åˆ" class="headerlink" title="6ã€å­—æ®µè¡¨é›†åˆ"></a>6ã€å­—æ®µè¡¨é›†åˆ</h4><p>å­—æ®µè¡¨ï¼ˆfield_infoï¼‰ç”¨äºæè¿°æ¥å£æˆ–è€…ç±»ä¸­å£°æ˜çš„å˜é‡ã€‚</p><p>Javaè¯­è¨€ä¸­çš„â€å­—æ®µâ€ï¼ˆFieldï¼‰åŒ…æ‹¬ç±»çº§å˜é‡ä»¥åŠå®ä¾‹çº§å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬åœ¨æ–¹æ³•å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚</p><blockquote><p>å­—æ®µå¯ä»¥åŒ…æ‹¬çš„ä¿®é¥°ç¬¦æœ‰å­—æ®µçš„ä½œç”¨åŸŸï¼ˆpublicã€privateã€protectedä¿®é¥°ç¬¦ï¼‰ã€æ˜¯å®ä¾‹å˜é‡è¿˜æ˜¯ç±»å˜é‡ï¼ˆstaticä¿®é¥°ç¬¦ï¼‰ã€å¯å˜æ€§ï¼ˆfinalï¼‰ã€å¹¶å‘å¯è§æ€§ï¼ˆvolatileä¿®é¥°ç¬¦ï¼Œæ˜¯å¦å¼ºåˆ¶ä»ä¸»å†…å­˜è¯»å†™ï¼‰ã€å¯å¦è¢«åºåˆ—åŒ–ï¼ˆtransientä¿®é¥°ç¬¦ï¼‰ã€å­—æ®µæ•°æ®ç±»å‹ï¼ˆåŸºæœ¬ç±»å‹ã€å¯¹è±¡ã€æ•°ç»„ï¼‰ã€å­—æ®µåç§°ã€‚</p><p>ä¸Šè¿°è¿™äº›ä¿¡æ¯ä¸­ï¼Œå„ä¸ªä¿®é¥°ç¬¦éƒ½æ˜¯å¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰æŸä¸ªä¿®é¥°ç¬¦ï¼Œè¦ä¹ˆæ²¡æœ‰ï¼Œå¾ˆé€‚åˆä½¿ç”¨æ ‡å¿—ä½æ¥è¡¨ç¤ºã€‚è€Œå­—æ®µå«åšä»€ä¹ˆåå­—ã€å­—æ®µè¢«å®šä¹‰ä¸ºä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œè¿™äº›éƒ½æ˜¯æ— æ³•å›ºå®šçš„ï¼Œåªèƒ½å¼•ç”¨å¸¸é‡æ± ä¸­çš„å¸¸é‡æ¥æè¿°ã€‚</p></blockquote><p>å­—æ®µè¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>access_flags</td><td>1</td></tr><tr><td>u2</td><td>name_index</td><td>1</td></tr><tr><td>u2</td><td>descriptor_index</td><td>1</td></tr><tr><td>u2</td><td>attribute_count</td><td>1</td></tr><tr><td>attribute_info</td><td>attributes</td><td>attribute_count</td></tr></tbody></table><p>å­—æ®µä¿®é¥°ç¬¦æ”¾åœ¨access_flagsé¡¹ç›®ä¸­ï¼Œå®ƒä¸ç±»ä¸­çš„access_flagsé¡¹ç›®æ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯ä¸€ä¸ªu2çš„æ•°æ®ç±»å‹ã€‚</p><p>å­—æ®µè®¿é—®æ ‡å¿—å¦‚ä¸‹å›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-field-accflag.jpg" alt="å­—æ®µè®¿é—®æ ‡å¿—è¡¨"></p><p>è¯­æ³•è§„åˆ™çš„çº¦æŸï¼Œ</p><p>ACC_PUBLICã€ACC_PRIVATEã€ACC_PROTECTEDä¸‰ä¸ªæ ‡å¿—æœ€å¤šåªèƒ½é€‰æ‹©å…¶ä¸€ï¼›</p><p>ACC_FINALã€ACC_VOLATILEä¸èƒ½åŒæ—¶é€‰æ‹©ã€‚</p><p>æ¥å£ä¹‹ä¸­çš„å­—æ®µå¿…é¡»æœ‰ACC_PUBLICã€ACC_STATICã€ACC_FINALæ ‡å¿—ã€‚</p><p>å­—æ®µè¡¨ä¸­è·Ÿéšaccess_flagsæ ‡å¿—çš„æ˜¯ä¸¤é¡¹ç´¢å¼•å€¼ï¼šname_indexå’Œdescriptor_indexã€‚å®ƒä»¬éƒ½æ˜¯å¯¹å¸¸é‡æ± é¡¹çš„å¼•ç”¨ï¼Œåˆ†åˆ«ä»£è¡¨ç€å­—æ®µçš„ç®€å•åç§°ä»¥åŠå­—æ®µå’Œæ–¹æ³•çš„æè¿°ç¬¦ã€‚</p><p>ç›¸å…³æ¦‚å¿µï¼š</p><blockquote><p><strong>å…¨é™å®šå</strong>ï¼š</p><p>å¦‚ï¼štest/com/xiaocai/klass/test/HelloWorld å°±æ˜¯HelloWorldçš„å…¨é™å®šåã€‚æŠŠåŒ…è·¯å¾„çš„<code>&quot;.&quot;</code>æ¢æˆ<code>&quot;/&quot;</code>ï¼Œä½¿ç”¨æ—¶æœ€åä¸€èˆ¬ä¼šåŠ å…¥ä¸€ä¸ªâ€ï¼›â€å·è¡¨ç¤ºå…¨é™å®šåç»“æŸã€‚</p><p><strong>ç®€å•åç§°</strong>ï¼ˆname_indexï¼‰ï¼š</p><p>å°±æ˜¯æŒ‡æ²¡æœ‰ç±»å‹å’Œå‚æ•°ä¿®é¥°çš„æ–¹æ³•æˆ–è€…å­—æ®µåç§°ï¼Œè¿™ä¸ªç±»ä¸­çš„add()æ–¹æ³•å’Œmå­—æ®µçš„ç®€å•åç§°åˆ†åˆ«å°±æ˜¯â€addâ€å’Œâ€mâ€ã€‚</p><p><strong>æ–¹æ³•å’Œå­—æ®µçš„æè¿°ç¬¦</strong>ï¼ˆdescriptor_indexï¼‰ï¼š</p><p>æè¿°ç¬¦çš„ä½œç”¨æ˜¯ç”¨æ¥æè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼ˆåŒ…æ‹¬æ•°é‡ã€ç±»å‹ä»¥åŠé¡ºåºï¼‰å’Œè¿”å›å€¼ã€‚æ ¹æ®æè¿°ç¬¦è§„åˆ™ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbyteã€charã€doubleã€floatã€intã€longã€shortã€booleanï¼‰ä»¥åŠä»£è¡¨æ— è¿”å›å€¼çš„voidç±»å‹éƒ½ç”¨ä¸€ä¸ªå¤§å†™å­—ç¬¦æ¥è¡¨ç¤ºï¼Œè€Œå¯¹è±¡ç±»å‹åˆ™ç”¨å­—ç¬¦LåŠ å¯¹è±¡çš„å…¨é™å®šåæ¥è¡¨ç¤ºã€‚</p></blockquote><p>å…³äºæè¿°ç¬¦æ ‡è¯†å­—ç¬¦å«ä¹‰å¦‚ä¸‹å›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-field-desc-index.jpg" alt="æè¿°ç¬¦æ ‡è¯†å­—ç¬¦å«ä¹‰"></p><p>å¯¹äºæ•°ç»„ç±»å‹ï¼Œæ¯ä¸€ç»´åº¦å°†ä½¿ç”¨ä¸€ä¸ªå‰ç½®çš„<code>&quot;[&quot;</code>å­—ç¬¦æ¥æè¿°ï¼Œå¦‚ä¸€ä¸ªå®šä¹‰ä¸º<code>&quot;java.lang.String[][]&quot;</code>ç±»å‹çš„äºŒç»´æ•°ç»„å°†è¢«è®°å½•æˆ<code>&quot;[[Ljava/lang/Stringï¼›&quot;</code>ï¼Œä¸€ä¸ªæ•´å‹æ•°ç»„<code>&quot;int[]&quot;</code>å°†è¢«è®°å½•æˆ<code>&quot;[I&quot;</code>ã€‚</p><blockquote><p>ç”¨æè¿°ç¬¦æ¥æè¿°æ–¹æ³•æ—¶ï¼ŒæŒ‰ç…§å…ˆå‚æ•°åˆ—è¡¨ã€åè¿”å›å€¼çš„é¡ºåºæè¿°ï¼Œå‚æ•°åˆ—è¡¨æŒ‰ç…§å‚æ•°çš„ä¸¥æ ¼é¡ºåºæ”¾åœ¨ä¸€ç»„å°æ‹¬å·<code>&quot;()&quot;</code>ä¹‹å†…ã€‚å¦‚æ–¹æ³•<code>void inc()</code>çš„æè¿°ç¬¦ä¸º<code>&quot;()V&quot;</code>ï¼Œæ–¹æ³•<code>java.lang.StringtoString()</code>çš„æè¿°ç¬¦ä¸º<code>&quot;()Ljava/lang/Stringï¼›&quot;</code>ï¼Œæ–¹æ³•<code>int indexOf(char[]sourceï¼ŒintsourceOffsetï¼Œint sourceCountï¼Œchar[]targetï¼Œint targetOffsetï¼Œint targetCountï¼ŒintfromIndex)</code>çš„æè¿°ç¬¦ä¸º<code>&quot;([CII[CIII)I&quot;</code>ã€‚</p></blockquote><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-demo7.png" alt="HelloWorld.calsså­—æ®µè¡¨"></p><p>å­—æ®µè¡¨é›†åˆä»åœ°å€0x000001DCå¼€å§‹ï¼Œç¬¬ä¸€ä¸ªu2ç±»å‹çš„æ•°æ®ä¸ºå®¹é‡è®¡æ•°å™¨fields_countï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…¶å€¼ä¸º0x0001ï¼Œè¯´æ˜è¿™ä¸ªç±»åªæœ‰ä¸€ä¸ªå­—æ®µè¡¨æ•°æ®ã€‚</p><p>æ¥ä¸‹æ¥ç´§è·Ÿç€å®¹é‡è®¡æ•°å™¨çš„æ˜¯access_flagsæ ‡å¿—ï¼Œå€¼ä¸º0x0002ï¼Œä»£è¡¨privateä¿®é¥°ç¬¦çš„ACC_PRIVATEæ ‡å¿—ä½ä¸ºçœŸï¼ˆACC_PRIVATEæ ‡å¿—çš„å€¼ä¸º0x0002ï¼‰ï¼Œå…¶ä»–ä¿®é¥°ç¬¦ä¸ºå‡ã€‚ä»£è¡¨å­—æ®µåç§°çš„name_indexçš„å€¼ä¸º0x0005ï¼Œä»åˆ—å‡ºçš„å­—èŠ‚ç æ¸…å•å¸¸é‡è¡¨ä¸­å¯æŸ¥å¾—ç¬¬äº”é¡¹å¸¸é‡æ˜¯ä¸€ä¸ªCONSTANT_Utf8_infoç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸ºâ€mâ€ï¼Œä»£è¡¨å­—æ®µæè¿°ç¬¦çš„descriptor_indexçš„å€¼ä¸º0x0006ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„å­—ç¬¦ä¸²â€Iâ€ã€‚æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºåŸä»£ç å®šä¹‰çš„å­—æ®µä¸ºâ€private int mï¼›â€ã€‚</p><blockquote><p>å­—æ®µè¡¨æ‰€åŒ…å«çš„å›ºå®šæ•°æ®é¡¹ç›®åˆ°descriptor_indexä¸ºæ­¢å°±å…¨éƒ¨ç»“æŸï¼Œåœ¨descrip-tor_indexä¹‹åè·Ÿéšç€ä¸€ä¸ªå±æ€§è¡¨é›†åˆï¼Œç”¨äºå­˜å‚¨ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œå­—æ®µè¡¨å¯ä»¥åœ¨å±æ€§è¡¨ä¸­é™„åŠ æè¿°é›¶è‡³å¤šé¡¹çš„é¢å¤–ä¿¡æ¯ã€‚å¯¹äºæœ¬ä¾‹ä¸­çš„å­—æ®µmï¼Œå®ƒçš„å±æ€§è¡¨è®¡æ•°å™¨ä¸º0ï¼ˆä¹Ÿå°±æ˜¯åœ°å€0x000001E4å¼€å§‹ï¼Œå€¼ä¸º0x0000ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰éœ€è¦é¢å¤–æè¿°çš„ä¿¡æ¯ï¼Œä½†æ˜¯ï¼Œå¦‚æœå°†å­—æ®µmçš„å£°æ˜æ”¹ä¸ºâ€final static int m=123ï¼›â€ï¼Œé‚£å°±å¯èƒ½ä¼šå­˜åœ¨ä¸€é¡¹åç§°ä¸ºConstantValueçš„å±æ€§ï¼Œå…¶å€¼æŒ‡å‘å¸¸é‡123ã€‚</p></blockquote><h4 id="7ã€æ–¹æ³•è¡¨é›†åˆ"><a href="#7ã€æ–¹æ³•è¡¨é›†åˆ" class="headerlink" title="7ã€æ–¹æ³•è¡¨é›†åˆ"></a>7ã€æ–¹æ³•è¡¨é›†åˆ</h4><p>Classæ–‡ä»¶å­˜å‚¨æ ¼å¼ä¸­å¯¹æ–¹æ³•çš„æè¿°ä¸å¯¹å­—æ®µçš„æè¿°é‡‡ç”¨äº†å‡ ä¹å®Œå…¨ä¸€è‡´çš„æ–¹å¼ï¼Œæ–¹æ³•è¡¨çš„ç»“æ„å¦‚åŒå­—æ®µè¡¨ä¸€æ ·ï¼Œä¾æ¬¡åŒ…æ‹¬è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ã€åç§°ç´¢å¼•ï¼ˆname_indexï¼‰ã€æè¿°ç¬¦ç´¢å¼•ï¼ˆdescriptor_indexï¼‰ã€å±æ€§è¡¨é›†åˆï¼ˆattributesï¼‰å‡ é¡¹ã€‚</p><p>æ–¹æ³•è¡¨ä¸å­—æ®µè¡¨ä¸­çš„éå¸¸ç±»ä¼¼ï¼Œä»…åœ¨è®¿é—®æ ‡å¿—å’Œå±æ€§è¡¨é›†åˆçš„å¯é€‰é¡¹ä¸­æœ‰æ‰€åŒºåˆ«ã€‚</p><p>æ–¹æ³•è¡¨ç»“æ„ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-method-1.jpg" alt="æ–¹æ³•è¡¨ç»“æ„"></p><p>å› ä¸ºvolatileå…³é”®å­—å’Œtransientå…³é”®å­—ä¸èƒ½ä¿®é¥°æ–¹æ³•ï¼Œæ‰€ä»¥æ–¹æ³•è¡¨çš„è®¿é—®æ ‡å¿—ä¸­æ²¡æœ‰äº†ACC_VOLATILEæ ‡å¿—å’ŒACC_TRANSIENTæ ‡å¿—ã€‚ä¸ä¹‹ç›¸å¯¹ï¼Œsynchronizedã€nativeã€strictfpå’Œabstractå…³é”®å­—å¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œæ–¹æ³•è¡¨çš„è®¿é—®æ ‡å¿—ä¸­ä¹Ÿç›¸åº”åœ°å¢åŠ äº†ACC_SYNCHRONIZEDã€ACC_NATIVEã€ACC_STRICTFPå’ŒACC_ABSTRACTæ ‡å¿—ã€‚</p><p>æ–¹æ³•è®¿é—®æ ‡å¿—åŠå–å€¼ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-method-accflag.jpg" alt="æ–¹æ³•è®¿é—®æ ‡å¿—åŠå–å€¼è¡¨"></p><p>åœ¨å­—èŠ‚ç æ¸…å•ä¸­ï¼Œaddæ–¹æ³•å¯¹åº”çš„å­—èŠ‚ç å†…å®¹ï¼Œå­˜æ”¾åœ¨æ–¹æ³•å±æ€§è¡¨é›†åˆä¸­ä¸€ä¸ªåä¸ºâ€Codeâ€çš„å±æ€§é‡Œé¢ï¼Œå±æ€§è¡¨ä½œä¸ºClassæ–‡ä»¶æ ¼å¼ä¸­æœ€å…·æ‰©å±•æ€§çš„ä¸€ç§æ•°æ®é¡¹ç›®ã€‚</p><p>Helloworldä¸ºä¾‹ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-demo8.png" alt="HelloWorld.classæ–¹æ³•è¡¨ç»“æ„"></p><pre class=" language-txt"><code class="language-txt">0x0003 ----> methods_count0x0001 ----> access_flags0x0007 ----> name_index0x0008 ----> descriptor_index0x0001 ----> attributs_count0x0009 ----> attribute_name_index</code></pre><p>æ–¹æ³•è¡¨é›†åˆçš„å…¥å£åœ°å€ä¸º0x000001E6ï¼Œç¬¬ä¸€ä¸ªu2ç±»å‹çš„æ•°æ®ï¼ˆå³è®¡æ•°å™¨å®¹é‡ï¼‰çš„å€¼ä¸º0x0003ï¼Œä»£è¡¨é›†åˆä¸­æœ‰3ä¸ªæ–¹æ³•ï¼Œè¿™3ä¸ªæ–¹æ³•ä¸ºç¼–è¯‘å™¨æ·»åŠ çš„å®ä¾‹æ„é€ å™¨<code>&lt;init&gt;</code>å’Œæºç ä¸­å®šä¹‰çš„æ–¹æ³•add()ã€ä¸»æ–¹æ³•main()ã€‚</p><p>ç¬¬ä¸€ä¸ªæ–¹æ³•çš„è®¿é—®æ ‡å¿—å€¼ä¸º0x0001ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ACC_PUBLICæ ‡å¿—ä¸ºçœŸï¼Œåç§°ç´¢å¼•å€¼ä¸º0x0007ï¼ŒæŸ¥å­—èŠ‚ç æ¸…å•çš„å¸¸é‡æ± å¾—æ–¹æ³•åä¸º<code>&quot;&lt;init&gt;&quot;</code>ï¼Œå¯¹åº”å­—èŠ‚ç æ¸…å•ç‰‡æ®µå¦‚ä¸‹<code>#7</code>ï¼ˆä¹Ÿå¯ä»¥çœ‹ä¸Šé¢åˆ—å‡ºçš„å­—èŠ‚ç æ¸…å•ï¼‰ï¼š</p><pre><code>#7 = Utf8               &lt;init&gt;#8 = Utf8               ()V#9 = Utf8               Code</code></pre><p>æè¿°ç¬¦ç´¢å¼•å€¼ä¸º0x0008ï¼Œå¯¹åº”å¸¸é‡ä¸ºâ€()Vâ€ï¼Œå±æ€§è¡¨è®¡æ•°å™¨attributes_countçš„å€¼ä¸º0x0001ï¼Œè¡¨ç¤ºæ­¤æ–¹æ³•çš„å±æ€§è¡¨é›†åˆæœ‰1é¡¹å±æ€§ï¼Œå±æ€§åç§°çš„ç´¢å¼•å€¼ä¸º0x0009ï¼Œå¯¹åº”å¸¸é‡ä¸ºâ€Codeâ€ï¼Œè¯´æ˜æ­¤å±æ€§æ˜¯æ–¹æ³•çš„å­—èŠ‚ç æè¿°ã€‚</p><blockquote><p>ä¸å­—æ®µè¡¨é›†åˆç›¸å¯¹åº”åœ°ï¼Œå¦‚æœçˆ¶ç±»æ–¹æ³•åœ¨å­ç±»ä¸­æ²¡æœ‰è¢«é‡å†™ï¼ˆOverrideï¼‰ï¼Œæ–¹æ³•è¡¨é›†åˆä¸­å°±ä¸ä¼šå‡ºç°æ¥è‡ªçˆ¶ç±»çš„æ–¹æ³•ä¿¡æ¯ã€‚ä½†åŒæ ·åœ°ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ çš„æ–¹æ³•ï¼Œæœ€å¸¸è§çš„ä¾¿æ˜¯ç±»æ„é€ å™¨<code>&quot;&lt;clinit&gt;()&quot;</code>æ–¹æ³•å’Œå®ä¾‹æ„é€ å™¨<code>&quot;&lt;init&gt;()&quot;</code>æ–¹æ³•</p></blockquote><p>Javaè¯­è¨€ä¸­ï¼Œè¦é‡è½½ï¼ˆOverloadï¼‰ä¸€ä¸ªæ–¹æ³•ï¼Œé™¤äº†è¦ä¸åŸæ–¹æ³•å…·æœ‰ç›¸åŒçš„ç®€å•åç§°ä¹‹å¤–ï¼Œè¿˜è¦æ±‚å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªä¸åŸæ–¹æ³•ä¸åŒçš„ç‰¹å¾ç­¾åã€‚</p><blockquote><p>Javaä»£ç çš„æ–¹æ³•ç‰¹å¾ç­¾ååªåŒ…æ‹¬æ–¹æ³•åç§°ã€å‚æ•°é¡ºåºåŠå‚æ•°ç±»å‹ã€‚</p><p>å­—èŠ‚ç çš„ç‰¹å¾ç­¾åé™¤äº†åŒ…æ‹¬æ–¹æ³•åç§°ã€å‚æ•°é¡ºåºåŠå‚æ•°ç±»å‹ï¼Œè¿˜åŒ…æ‹¬æ–¹æ³•è¿”å›å€¼ä»¥åŠå—æŸ¥å¼‚å¸¸è¡¨ã€‚</p></blockquote><p>ç‰¹å¾ç­¾åæ˜¯æŒ‡ä¸€ä¸ªæ–¹æ³•ä¸­å„ä¸ªå‚æ•°åœ¨å¸¸é‡æ± ä¸­çš„å­—æ®µç¬¦å·å¼•ç”¨çš„é›†åˆï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºè¿”å›å€¼ä¸ä¼šåŒ…å«åœ¨ç‰¹å¾ç­¾åä¹‹ä¸­ï¼Œæ‰€ä»¥Javaè¯­è¨€é‡Œé¢æ˜¯æ— æ³•ä»…ä»…ä¾é è¿”å›å€¼çš„ä¸åŒæ¥å¯¹ä¸€ä¸ªå·²æœ‰æ–¹æ³•è¿›è¡Œé‡è½½çš„ã€‚ä½†æ˜¯åœ¨Classæ–‡ä»¶æ ¼å¼ä¹‹ä¸­ï¼Œç‰¹å¾ç­¾åçš„èŒƒå›´æ˜æ˜¾è¦æ›´å¤§ä¸€äº›ï¼Œåªè¦æè¿°ç¬¦ä¸æ˜¯å®Œå…¨ä¸€è‡´çš„ä¸¤ä¸ªæ–¹æ³•å°±å¯ä»¥å…±å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸¤ä¸ªæ–¹æ³•æœ‰ç›¸åŒçš„åç§°å’Œç‰¹å¾ç­¾åï¼Œä½†è¿”å›å€¼ä¸åŒï¼Œé‚£ä¹ˆä¹Ÿæ˜¯å¯ä»¥åˆæ³•å…±å­˜äºåŒä¸€ä¸ªClassæ–‡ä»¶ä¸­çš„ã€‚</p><h4 id="8ã€å±æ€§è¡¨é›†åˆ"><a href="#8ã€å±æ€§è¡¨é›†åˆ" class="headerlink" title="8ã€å±æ€§è¡¨é›†åˆ"></a>8ã€å±æ€§è¡¨é›†åˆ</h4><p>å±æ€§è¡¨ï¼ˆattribute_infoï¼‰</p><p>Classæ–‡ä»¶ã€å­—æ®µè¡¨ã€æ–¹æ³•è¡¨éƒ½å¯ä»¥æºå¸¦è‡ªå·±çš„å±æ€§è¡¨é›†åˆï¼Œä»¥æè¿°æŸäº›åœºæ™¯ä¸“æœ‰çš„ä¿¡æ¯ã€‚</p><p>ç‰¹ç‚¹ï¼šä¸è¦æ±‚ä¸¥æ ¼çš„é¡ºåºï¼Œä¸èƒ½ä¸å·²æœ‰å±æ€§åç§°é‡å¤</p><p>è™šæ‹Ÿæœºè§„èŒƒé¢„å®šä¹‰çš„å±æ€§ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-attr1.jpg" alt="è™šæ‹Ÿæœºè§„èŒƒé¢„å®šä¹‰çš„å±æ€§"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-attr2.jpg" alt="è™šæ‹Ÿæœºè§„èŒƒé¢„å®šä¹‰çš„å±æ€§"></p><p>æ¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒçš„åç§°éƒ½è¦ä»å¸¸é‡æ± ä¸­å¼•ç”¨ä¸€ä¸ªCONSTANT_Utf8_infoç±»å‹çš„å¸¸é‡æ¥è¡¨ç¤ºï¼Œè€Œå±æ€§å€¼çš„ç»“æ„åˆ™æ˜¯å®Œå…¨è‡ªå®šä¹‰çš„ï¼Œåªéœ€è¦é€šè¿‡ä¸€ä¸ªu4çš„é•¿åº¦å±æ€§å»è¯´æ˜å±æ€§å€¼æ‰€å ç”¨çš„ä½æ•°å³å¯ã€‚ä¸€ä¸ªç¬¦åˆè§„åˆ™çš„å±æ€§è¡¨åº”è¯¥æ»¡è¶³ç»“jåŸºæœ¬çš„å±æ€§è¡¨ç»“æ„ï¼š</p><table><thead><tr><th align="center">ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td align="center">u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td align="center">u4</td><td>attribute_length</td><td>1</td></tr><tr><td align="center">u1</td><td>info</td><td>attribute_length</td></tr></tbody></table><h5 id="1ï¼‰-Codeå±æ€§"><a href="#1ï¼‰-Codeå±æ€§" class="headerlink" title="1ï¼‰ Codeå±æ€§"></a>1ï¼‰ Codeå±æ€§</h5><p>Javaç¨‹åºæ–¹æ³•ä½“ä¸­çš„ä»£ç ç»è¿‡Javacç¼–è¯‘å™¨å¤„ç†ä¹‹åï¼Œå˜ä¸ºå­—èŠ‚ç æŒ‡ä»¤å­˜å‚¨åœ¨Codeå±æ€§å†…ã€‚Codeå±æ€§å‡ºç°åœ¨æ–¹æ³•è¡¨çš„å±æ€§é›†åˆä¹‹ä¸­ï¼Œä½†å¹¶éæ‰€æœ‰çš„æ–¹æ³•è¡¨éƒ½å¿…é¡»å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œè­¬å¦‚æ¥å£æˆ–è€…æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å°±ä¸å­˜åœ¨Codeå±æ€§ï¼Œå¦‚æœæ–¹æ³•è¡¨æœ‰Codeå±æ€§å­˜åœ¨ï¼Œåº”è¯¥æ»¡è¶³Codeå±æ€§è¡¨åŸºæœ¬ç»“æ„ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-attr-code.jpg" alt="Codeå±æ€§è¡¨åŸºæœ¬ç»“æ„"></p><p>attribute_name_indexæ˜¯ä¸€é¡¹æŒ‡å‘CONSTANT_Utf8_infoå‹å¸¸é‡çš„ç´¢å¼•ï¼Œæ­¤å¸¸é‡å€¼å›ºå®šä¸ºâ€Codeâ€ï¼Œå®ƒä»£è¡¨äº†è¯¥å±æ€§çš„å±æ€§åç§°ã€‚</p><p>attribute_lengthæŒ‡ç¤ºäº†å±æ€§å€¼çš„é•¿åº¦ï¼Œç”±äºå±æ€§åç§°ç´¢å¼•ä¸å±æ€§é•¿åº¦ä¸€å…±ä¸º6ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å±æ€§å€¼çš„é•¿åº¦å›ºå®šä¸ºæ•´ä¸ªå±æ€§è¡¨é•¿åº¦å‡å»6ä¸ªå­—èŠ‚ã€‚</p><p>max_stackä»£è¡¨äº†æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰æ·±åº¦çš„æœ€å¤§å€¼ã€‚åœ¨æ–¹æ³•æ‰§è¡Œçš„ä»»æ„æ—¶åˆ»ï¼Œæ“ä½œæ•°æ ˆéƒ½ä¸ä¼šè¶…è¿‡è¿™ä¸ªæ·±åº¦ã€‚è™šæ‹Ÿæœºè¿è¡Œçš„æ—¶å€™éœ€è¦æ ¹æ®è¿™ä¸ªå€¼æ¥åˆ†é…æ ˆå¸§ï¼ˆStack Frameï¼‰ä¸­çš„æ“ä½œæ ˆæ·±åº¦ã€‚</p><p>max_localsä»£è¡¨äº†å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨è¿™é‡Œï¼Œmax_localsçš„å•ä½æ˜¯å˜é‡æ§½ï¼ˆSlotï¼‰ï¼Œå˜é‡æ§½æ˜¯è™šæ‹Ÿæœºä¸ºå±€éƒ¨å˜é‡åˆ†é…å†…å­˜æ‰€ä½¿ç”¨çš„æœ€å°å•ä½ã€‚</p><blockquote><p>å¯¹äºbyteã€charã€floatã€intã€shortã€booleanå’ŒreturnAddressç­‰é•¿åº¦ä¸è¶…è¿‡32ä½çš„æ•°æ®ç±»å‹ï¼Œæ¯ä¸ªå±€éƒ¨å˜é‡å ç”¨ä¸€ä¸ªå˜é‡æ§½ï¼Œè€Œdoubleå’Œlongè¿™ä¸¤ç§64ä½çš„æ•°æ®ç±»å‹åˆ™éœ€è¦ä¸¤ä¸ªå˜é‡æ§½æ¥å­˜æ”¾ã€‚æ–¹æ³•å‚æ•°ï¼ˆåŒ…æ‹¬å®ä¾‹æ–¹æ³•ä¸­çš„éšè—å‚æ•°â€thisâ€ï¼‰ã€æ˜¾å¼å¼‚å¸¸å¤„ç†ç¨‹åºçš„å‚æ•°ï¼ˆException Handler Parameterï¼Œå°±æ˜¯try-catchè¯­å¥ä¸­catchå—ä¸­æ‰€å®šä¹‰çš„å¼‚å¸¸ï¼‰ã€æ–¹æ³•ä½“ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡éƒ½éœ€è¦ä¾èµ–å±€éƒ¨å˜é‡è¡¨æ¥å­˜æ”¾ã€‚æ³¨æ„ï¼Œå¹¶ä¸æ˜¯åœ¨æ–¹æ³•ä¸­ç”¨äº†å¤šå°‘ä¸ªå±€éƒ¨å˜é‡ï¼Œå°±æŠŠè¿™äº›å±€éƒ¨å˜é‡æ‰€å å˜é‡æ§½æ•°é‡ä¹‹å’Œä½œä¸ºmax_localsçš„å€¼ï¼Œæ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨ç›´æ¥å†³å®šä¸€ä¸ªè¯¥æ–¹æ³•çš„æ ˆå¸§æ‰€è€—è´¹çš„å†…å­˜ï¼Œä¸å¿…è¦çš„æ“ä½œæ•°æ ˆæ·±åº¦å’Œå˜é‡æ§½æ•°é‡ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚Javaè™šæ‹Ÿæœºçš„åšæ³•æ˜¯å°†å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡æ§½è¿›è¡Œé‡ç”¨ï¼Œå½“ä»£ç æ‰§è¡Œè¶…å‡ºä¸€ä¸ªå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæ—¶ï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡æ‰€å çš„å˜é‡æ§½å¯ä»¥è¢«å…¶ä»–å±€éƒ¨å˜é‡æ‰€ä½¿ç”¨ï¼ŒJavacç¼–è¯‘å™¨ä¼šæ ¹æ®å˜é‡çš„ä½œç”¨åŸŸæ¥åˆ†é…å˜é‡æ§½ç»™å„ä¸ªå˜é‡ä½¿ç”¨ï¼Œæ ¹æ®åŒæ—¶ç”Ÿå­˜çš„æœ€å¤§å±€éƒ¨å˜é‡æ•°é‡å’Œç±»å‹è®¡ç®—å‡ºmax_localsçš„å¤§å°ã€‚</p></blockquote><p>code_lengthå’Œcodeç”¨æ¥å­˜å‚¨Javaæºç¨‹åºç¼–è¯‘åç”Ÿæˆçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚code_lengthä»£è¡¨å­—èŠ‚ç é•¿åº¦ï¼Œcodeæ˜¯ç”¨äºå­˜å‚¨å­—èŠ‚ç æŒ‡ä»¤çš„ä¸€ç³»åˆ—å­—èŠ‚æµã€‚</p><blockquote><p>å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œæ¯ä¸ªæŒ‡ä»¤å°±æ˜¯ä¸€ä¸ªu1ç±»å‹çš„å•å­—èŠ‚ï¼Œå½“è™šæ‹Ÿæœºè¯»å–åˆ°codeä¸­çš„ä¸€ä¸ªå­—èŠ‚ç æ—¶ï¼Œå°±å¯ä»¥å¯¹åº”æ‰¾å‡ºè¿™ä¸ªå­—èŠ‚ç ä»£è¡¨çš„æ˜¯ä»€ä¹ˆæŒ‡ä»¤ï¼Œå¹¶ä¸”å¯ä»¥çŸ¥é“è¿™æ¡æŒ‡ä»¤åé¢æ˜¯å¦éœ€è¦è·Ÿéšå‚æ•°ï¼Œä»¥åŠåç»­çš„å‚æ•°åº”å½“å¦‚ä½•è§£æã€‚æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªu1æ•°æ®ç±»å‹çš„å–å€¼èŒƒå›´ä¸º0x00ï½0xFFï¼Œå¯¹åº”åè¿›åˆ¶çš„0ï½255ï¼Œä¹Ÿå°±æ˜¯ä¸€å…±å¯ä»¥è¡¨è¾¾256æ¡æŒ‡ä»¤ã€‚</p><p>ç›®å‰ï¼Œã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å·²ç»å®šä¹‰äº†å…¶ä¸­çº¦200æ¡ç¼–ç å€¼å¯¹åº”çš„æŒ‡ä»¤å«ä¹‰ï¼Œç¼–ç ä¸æŒ‡ä»¤ä¹‹é—´çš„å¯¹åº”å…³ç³»å¯æŸ¥<a href="ee62cca5.html">ã€Šè™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨ã€‹</a></p></blockquote><p>æ³¨æ„ï¼š</p><p>code_lengthï¼Œè™½ç„¶å®ƒæ˜¯ä¸€ä¸ªu4ç±»å‹çš„é•¿åº¦å€¼ï¼Œç†è®ºä¸Šæœ€å¤§å€¼å¯ä»¥è¾¾åˆ°2çš„32æ¬¡å¹‚ï¼Œä½†æ˜¯ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ˜ç¡®é™åˆ¶äº†ä¸€ä¸ªæ–¹æ³•ä¸å…è®¸è¶…è¿‡65535æ¡å­—èŠ‚ç æŒ‡ä»¤ï¼Œå³å®ƒå®é™…åªä½¿ç”¨äº†u2çš„é•¿åº¦ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶ï¼ŒJavacç¼–è¯‘å™¨å°±ä¼šæ‹’ç»ç¼–è¯‘ã€‚</p><p>Codeå±æ€§æ˜¯Classæ–‡ä»¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªå±æ€§ã€‚å¦‚æœæŠŠä¸€ä¸ªJavaç¨‹åºä¸­çš„ä¿¡æ¯åˆ†ä¸ºä»£ç ï¼ˆCodeï¼Œæ–¹æ³•ä½“é‡Œé¢çš„Javaä»£ç ï¼‰å’Œå…ƒæ•°æ®ï¼ˆMetadataï¼ŒåŒ…æ‹¬ç±»ã€å­—æ®µã€æ–¹æ³•å®šä¹‰åŠå…¶ä»–ä¿¡æ¯ï¼‰ä¸¤éƒ¨åˆ†ï¼Œé‚£ä¹ˆåœ¨æ•´ä¸ªClassæ–‡ä»¶é‡Œï¼ŒCodeå±æ€§ç”¨äºæè¿°ä»£ç ï¼Œæ‰€æœ‰çš„å…¶ä»–æ•°æ®é¡¹ç›®éƒ½ç”¨äºæè¿°å…ƒæ•°æ®ã€‚</p><p>ä»¥HelloWorld.classä¸ºä¾‹ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-demo9.png" alt="Codeå±æ€§è¡¨åŸºæœ¬ç»“æ„"></p><pre class=" language-txt"><code class="language-txt">0x0001 ----->æ“ä½œæ•°æ ˆ  max_stack0x0001 ----->æœ¬åœ°å˜é‡è¡¨ max_lcoals0x0005 ----> å­—èŠ‚ç åŒºåŸŸé•¿åº¦ code_lenth2A B7 000A B1 </code></pre><p>æ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦å’Œæœ¬åœ°å˜é‡è¡¨çš„å®¹é‡éƒ½ä¸º0x0001ï¼Œå­—èŠ‚ç åŒºåŸŸæ‰€å ç©ºé—´çš„é•¿åº¦ä¸º0x0005ã€‚</p><blockquote><p>è™šæ‹Ÿæœºè¯»å–åˆ°å­—èŠ‚ç åŒºåŸŸçš„é•¿åº¦åï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡è¯»å…¥ç´§éšçš„5ä¸ªå­—èŠ‚ï¼Œå¹¶æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤è¡¨ç¿»è¯‘å‡ºæ‰€å¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ç¿»è¯‘â€2A B7000A B1â€çš„è¿‡ç¨‹ä¸ºï¼š</p><p>ï¼ˆ1ï¼‰è¯»å…¥2Aï¼ŒæŸ¥å­—èŠ‚ç æŒ‡ä»¤è¡¨å¾—0x2Aå¯¹åº”çš„æŒ‡ä»¤ä¸ºaload_0ï¼Œè¿™ä¸ªæŒ‡ä»¤çš„å«ä¹‰æ˜¯å°†ç¬¬0ä¸ªå˜é‡æ§½ä¸­ä¸ºreferenceç±»å‹çš„æœ¬åœ°å˜é‡æ¨é€åˆ°æ“ä½œæ•°æ ˆé¡¶ã€‚</p><p>ï¼ˆ2ï¼‰è¯»å…¥B7ï¼ŒæŸ¥å­—èŠ‚ç æŒ‡ä»¤è¡¨å¾—0xB7å¯¹åº”çš„æŒ‡ä»¤ä¸ºinvokespecialï¼Œè¿™æ¡æŒ‡ä»¤çš„ä½œç”¨æ˜¯ä»¥æ ˆé¡¶çš„referenceç±»å‹çš„æ•°æ®æ‰€æŒ‡å‘çš„å¯¹è±¡ä½œä¸ºæ–¹æ³•æ¥æ”¶è€…ï¼Œè°ƒç”¨æ­¤å¯¹è±¡çš„å®ä¾‹æ„é€ å™¨æ–¹æ³•ã€privateæ–¹æ³•æˆ–è€…å®ƒçš„çˆ¶ç±»çš„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªu2ç±»å‹çš„å‚æ•°è¯´æ˜å…·ä½“è°ƒç”¨å“ªä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒæŒ‡å‘å¸¸é‡æ± ä¸­çš„ä¸€ä¸ªCONSTANT_Methodref_infoç±»å‹å¸¸é‡ï¼Œå³æ­¤æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ã€‚</p><p>ï¼ˆ3ï¼‰è¯»å…¥000Aï¼Œè¿™æ˜¯invokespecialæŒ‡ä»¤çš„å‚æ•°ï¼Œä»£è¡¨ä¸€ä¸ªç¬¦å·å¼•ç”¨ï¼ŒæŸ¥å¸¸é‡æ± å¾—0x000Aå¯¹åº”çš„å¸¸é‡ä¸ºå®ä¾‹æ„é€ å™¨<code>&quot;&lt;init&gt;()&quot;</code>æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ã€‚</p><p>ï¼ˆ4ï¼‰è¯»å…¥B1ï¼ŒæŸ¥å­—èŠ‚ç æŒ‡ä»¤è¡¨å¾—0xB1å¯¹åº”çš„æŒ‡ä»¤ä¸ºreturnï¼Œå«ä¹‰æ˜¯ä»æ–¹æ³•çš„è¿”å›ï¼Œå¹¶ä¸”è¿”å›å€¼ä¸ºvoidã€‚è¿™æ¡æŒ‡ä»¤æ‰§è¡Œåï¼Œå½“å‰æ–¹æ³•æ­£å¸¸ç»“æŸã€‚</p></blockquote><p>åœ¨è¾¹çœ‹è¾¹å°è¯è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸€å¼€å§‹æ²¡ç†è§£â€æŸ¥å¸¸é‡æ± å¾—0x000Aå¯¹åº”çš„å¸¸é‡â€åº”è¯¥æ€ä¹ˆæŸ¥ï¼Œçªç„¶å‘ç°0x000Aå¯¹åº”çš„åè¿›åˆ¶æ˜¯10ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡æ± çš„ç¬¬10ä¸ªå³ï¼š</p><p>#10 = Methodref          #3.#11         //  java/lang/Object.<code>&quot;&lt;init&gt;&quot;</code>:()V</p><p>ä»”ç»†çœ‹è¿™ä¸€è¡Œï¼Œå…¶å®å°±æ˜¯å®ä¾‹æ„é€ å™¨<code>&quot;&lt;init&gt;()&quot;</code>æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ã€‚</p><p>å­—èŠ‚ç çš„æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®äº¤æ¢ã€æ–¹æ³•è°ƒç”¨ç­‰æ“ä½œéƒ½æ˜¯åŸºäºæ ˆï¼ˆæ“ä½œæ•°æ ˆï¼‰ã€‚</p><p>å­—èŠ‚ç æ¸…å•ä¸­ï¼š</p><pre><code>//å¸¸é‡æ± çœç•¥....{  public test.com.xiaocai.klass.test.HelloWorld();    flags: ACC_PUBLIC    Code:      stack=1, locals=1, args_size=1         0: aload_0                1: invokespecial #10                 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V         4: return              LineNumberTable:        line 3: 0      LocalVariableTable:        Start  Length  Slot  Name   Signature               0       5     0  this   Ltest/com/xiaocai/klass/test/HelloWorld;  public int add();    flags: ACC_PUBLIC    Code:      stack=2, locals=1, args_size=1         0: aload_0                1: getfield      #18                 // Field m:I         4: iconst_1               5: iadd                   6: ireturn             LineNumberTable:        line 8: 0      LocalVariableTable:        Start  Length  Slot  Name   Signature               0       7     0  this   Ltest/com/xiaocai/klass/test/HelloWorld;  public static void main(java.lang.String[]);    flags: ACC_PUBLIC, ACC_STATIC    Code:      stack=2, locals=1, args_size=1         0: getstatic     #22                 // Field java/lang/System.out:Ljava/io/PrintStream;         3: ldc           #28                 // String Hello World!         5: invokevirtual #30                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V         8: return              LineNumberTable:        line 13: 0        line 15: 8      LocalVariableTable:        Start  Length  Slot  Name   Signature               0       9     0  args   [Ljava/lang/String;}</code></pre><p>â€œArgs_sizeâ€çš„å€¼ä¸º1çš„åŸå› æ˜¯å› ä¸ºthis å…³é”®å­—çš„è®¿é—®æœºåˆ¶ã€‚</p><blockquote><p>åœ¨ä»»ä½•å®ä¾‹æ–¹æ³•é‡Œé¢ï¼Œéƒ½å¯ä»¥é€šè¿‡â€thisâ€å…³é”®å­—è®¿é—®åˆ°æ­¤æ–¹æ³•æ‰€å±çš„å¯¹è±¡ã€‚è¿™ä¸ªè®¿é—®æœºåˆ¶å¯¹Javaç¨‹åºçš„ç¼–å†™å¾ˆé‡è¦ï¼Œè€Œå®ƒçš„å®ç°éå¸¸ç®€å•ï¼Œä»…ä»…æ˜¯é€šè¿‡åœ¨Javacç¼–è¯‘å™¨ç¼–è¯‘çš„æ—¶å€™æŠŠå¯¹thiså…³é”®å­—çš„è®¿é—®è½¬å˜ä¸ºå¯¹ä¸€ä¸ªæ™®é€šæ–¹æ³•å‚æ•°çš„è®¿é—®ï¼Œç„¶ååœ¨è™šæ‹Ÿæœºè°ƒç”¨å®ä¾‹æ–¹æ³•æ—¶è‡ªåŠ¨ä¼ å…¥æ­¤å‚æ•°è€Œå·²ã€‚å› æ­¤åœ¨å®ä¾‹æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ä¸­è‡³å°‘ä¼šå­˜åœ¨ä¸€ä¸ªæŒ‡å‘å½“å‰å¯¹è±¡å®ä¾‹çš„å±€éƒ¨å˜é‡ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­ä¹Ÿä¼šé¢„ç•™å‡ºç¬¬ä¸€ä¸ªå˜é‡æ§½ä½æ¥å­˜æ”¾å¯¹è±¡å®ä¾‹çš„å¼•ç”¨ï¼Œæ‰€ä»¥å®ä¾‹æ–¹æ³•å‚æ•°å€¼ä»1å¼€å§‹è®¡ç®—ã€‚</p><p>è¿™ä¸ªå¤„ç†åªå¯¹å®ä¾‹æ–¹æ³•æœ‰æ•ˆï¼Œå¦‚æœä»£ç ä¸­çš„add()æ–¹æ³•è¢«å£°æ˜ä¸ºstaticï¼Œé‚£Args_sizeå°±ä¸ä¼šç­‰äº1è€Œæ˜¯ç­‰äº0ã€‚</p></blockquote><p>åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¹‹åçš„æ˜¯è¿™ä¸ªæ–¹æ³•çš„æ˜¾å¼å¼‚å¸¸å¤„ç†è¡¨ï¼ˆç®€ç§°å¼‚å¸¸è¡¨ï¼‰é›†åˆï¼Œå¼‚å¸¸è¡¨å¯¹äºCodeå±æ€§æ¥è¯´å¹¶ä¸æ˜¯å¿…é¡»å­˜åœ¨çš„ã€‚</p><p>å¦‚æœå­˜åœ¨å¼‚å¸¸è¡¨ï¼Œé‚£å®ƒçš„æ ¼å¼åº”å¦‚è¡¨6-16æ‰€ç¤ºï¼ŒåŒ…å«å››ä¸ªå­—æ®µï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>start_pc</td><td>1</td></tr><tr><td>u2</td><td>end_pc</td><td>1</td></tr><tr><td>u2</td><td>handler_pc</td><td>1</td></tr><tr><td>u2</td><td>catch_typr</td><td>1</td></tr></tbody></table><p>è¿™äº›å­—æ®µçš„å«ä¹‰ä¸ºï¼š</p><p>å¦‚æœå½“å­—èŠ‚ç ä»ç¬¬start_pcè¡Œåˆ°ç¬¬end_pcè¡Œä¹‹é—´ï¼ˆä¸å«ç¬¬end_pcè¡Œï¼‰å‡ºç°äº†ç±»å‹ä¸ºcatch_typeæˆ–è€…å…¶å­ç±»çš„å¼‚å¸¸ï¼ˆcatch_typeä¸ºæŒ‡å‘ä¸€ä¸ªCONSTANT_Class_infoå‹å¸¸é‡çš„ç´¢å¼•ï¼‰ï¼Œåˆ™è½¬åˆ°ç¬¬handler_pcè¡Œç»§ç»­å¤„ç†ã€‚å½“catch_typeçš„å€¼ä¸º0æ—¶ï¼Œä»£è¡¨ä»»æ„å¼‚å¸¸æƒ…å†µéƒ½éœ€è¦è½¬åˆ°handler_pcå¤„è¿›è¡Œå¤„ç†ã€‚</p><blockquote><p>å¼‚å¸¸è¡¨å®é™…ä¸Šæ˜¯Javaä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œå°½ç®¡å­—èŠ‚ç ä¸­æœ‰æœ€åˆä¸ºå¤„ç†å¼‚å¸¸è€Œè®¾è®¡çš„è·³è½¬æŒ‡ä»¤ï¼Œä½†ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ˜ç¡®è¦æ±‚Javaè¯­è¨€çš„ç¼–è¯‘å™¨åº”å½“é€‰æ‹©ä½¿ç”¨å¼‚å¸¸è¡¨è€Œä¸æ˜¯é€šè¿‡è·³è½¬æŒ‡ä»¤æ¥å®ç°Javaå¼‚å¸¸åŠfinallyå¤„ç†æœºåˆ¶</p></blockquote><p>å®šä¹‰try-catch-finallyçš„æºæ–‡ä»¶é•¿è¿™æ ·ï¼š</p><pre><code>package test.com.xiaocai.klass.test;public class TestCp {    public int getNumber() {        int x;        try {            x = 1;            return x;        } catch (Exception e) {            x = 2;            return x;        } finally {            x = 3;        }    }}</code></pre><p>å¼‚å¸¸å­—èŠ‚ç æ¸…å•ï¼š</p><pre class=" language-txt"><code class="language-txt">// å¤´éƒ¨ä¿¡æ¯çœç•¥{  public test.com.xiaocai.klass.test.TestCp();    flags: ACC_PUBLIC    Code:      stack=1, locals=1, args_size=1         0: aload_0                1: invokespecial #8                  // Method java/lang/Object."<init>":()V         4: return              LineNumberTable:        line 3: 0      LocalVariableTable:        Start  Length  Slot  Name   Signature               0       5     0  this   Ltest/com/xiaocai/klass/test/TestCp;  public int getNumber();    flags: ACC_PUBLIC    Code:      stack=1, locals=5, args_size=1         0: iconst_1      //try é‡Œçš„x=1         1: istore_1               2: iload_1       //ä¿å­˜xåˆ°returnValue x=1         3: istore        4         5: iconst_3               6: istore_1               7: iload         4 //å°†returnValueä¸­çš„å€¼æ”¾åˆ°æ ˆé¡¶ï¼Œå‡†å¤‡ç»™ ireturn è¿”å›         9: ireturn               10: astore_2       //ç»™catchä¸­çš„å®šä¹‰çš„Exception eèµ‹å€¼ï¼Œå­˜å‚¨åœ¨å˜é‡æ§½2ä¸­        11: iconst_2       //catch é‡Œçš„x=2        12: istore_1              13: iload_1       //ä¿å­˜xåˆ°returnValueä¸­ï¼Œæ­¤æ—¶x=2        14: istore        4        16: iconst_3       //finally é‡Œçš„x=3        17: istore_1              18: iload         4  //å°†returnValueä¸­çš„å€¼æ”¾åˆ°æ ˆé¡¶ï¼Œå‡†å¤‡ç»™ ireturn è¿”å›        20: ireturn               21: astore_3      //å¦‚æœå‡ºç°äº†ä¸å±äºjava.lang.ExceptionåŠå…¶å­ç±»çš„å¼‚å¸¸ä¼šèµ°åˆ°è¿™é‡Œ        22: iconst_3      //finalyå¿«ä¸­çš„x=3        23: istore_1              24: aload_3       //å°†å¼‚å¸¸æ”¾åˆ°æ ˆé¡¶        25: athrow        //æŠ›å‡ºå¼‚å¸¸      Exception table:         from    to  target type             0     5    10   Class java/lang/Exception             0     5    21   any            10    16    21   any     // å…¶ä»–å­—èŠ‚ç çœç•¥}</code></pre><p>å®Œæ•´å­—èŠ‚ç æ¸…å•æ–‡ä»¶ï¼š<a href="/images/jvm-class/TestCp.TXT">TestCp.TXT</a></p><p>å­—èŠ‚ç æ¸…å•ä¸­å¼‚å¸¸è¡¨<code>Exception table</code>å¯¹åº”ä¸‰æ¡å¯èƒ½å‡ºç°çš„ä»£ç æ‰§è¡Œè·¯å¾„ã€‚</p><p>ï¼ˆaï¼‰å¦‚æœtryè¯­å¥å—ä¸­å‡ºç°å±äºExceptionæˆ–å…¶å­ç±»çš„å¼‚å¸¸ï¼Œè½¬åˆ°catchè¯­å¥å—å¤„ç†ï¼›</p><p>ï¼ˆbï¼‰å¦‚æœtryè¯­å¥å—ä¸­å‡ºç°ä¸å±äºExceptionæˆ–å…¶å­ç±»çš„å¼‚å¸¸ï¼Œè½¬åˆ°finallyè¯­å¥å—å¤„ç†ï¼›</p><p>ï¼ˆcï¼‰å¦‚æœcatchè¯­å¥å—ä¸­å‡ºç°ä»»ä½•å¼‚å¸¸ï¼Œè½¬åˆ°finallyè¯­å¥å—å¤„ç†ã€‚</p><blockquote><p>å­—èŠ‚ç ä¸­ç¬¬0ï½4è¡Œæ‰€åšçš„æ“ä½œå°±æ˜¯å°†æ•´æ•°1èµ‹å€¼ç»™å˜é‡xï¼Œå¹¶ä¸”å°†æ­¤æ—¶xçš„å€¼å¤åˆ¶ä¸€ä»½å‰¯æœ¬åˆ°æœ€åä¸€ä¸ªæœ¬åœ°å˜é‡è¡¨çš„å˜é‡æ§½ä¸­ã€‚</p><p>è¿™ä¸ªå˜é‡æ§½é‡Œé¢çš„å€¼åœ¨ireturnæŒ‡ä»¤æ‰§è¡Œå‰å°†ä¼šè¢«é‡æ–°è¯»åˆ°æ“ä½œæ ˆé¡¶ï¼Œä½œä¸ºæ–¹æ³•è¿”å›å€¼ä½¿ç”¨ã€‚å‡å¦‚ç»™å˜é‡èµ·ä¸ªåå­—ï¼šreturnValueã€‚</p><p>å¦‚æœè¿™æ—¶å€™æ²¡æœ‰å‡ºç°å¼‚å¸¸ï¼Œåˆ™ä¼šç»§ç»­èµ°åˆ°ç¬¬5ï½9è¡Œï¼Œå°†å˜é‡xèµ‹å€¼ä¸º3ï¼Œç„¶åå°†ä¹‹å‰ä¿å­˜åœ¨returnValueä¸­çš„æ•´æ•°1è¯»å…¥åˆ°æ“ä½œæ ˆé¡¶ï¼Œæœ€åireturnæŒ‡ä»¤ä¼šä»¥intå½¢å¼è¿”å›æ“ä½œæ ˆé¡¶ä¸­çš„å€¼ï¼Œæ–¹æ³•ç»“æŸã€‚</p><p>å¦‚æœå‡ºç°äº†å¼‚å¸¸ï¼ŒPCå¯„å­˜å™¨æŒ‡é’ˆè½¬åˆ°ç¬¬10è¡Œï¼Œç¬¬10ï½20è¡Œæ‰€åšçš„äº‹æƒ…æ˜¯å°†2èµ‹å€¼ç»™å˜é‡xï¼Œç„¶åå°†å˜é‡xæ­¤æ—¶çš„å€¼èµ‹ç»™returnValueï¼Œæœ€åå†å°†å˜é‡xçš„å€¼æ”¹ä¸º3ã€‚æ–¹æ³•è¿”å›å‰åŒæ ·å°†returnValueä¸­ä¿ç•™çš„æ•´æ•°2è¯»åˆ°äº†æ“ä½œæ ˆé¡¶ã€‚ä»ç¬¬21è¡Œå¼€å§‹çš„ä»£ç ï¼Œä½œç”¨æ˜¯å°†å˜é‡xçš„å€¼èµ‹ä¸º3ï¼Œå¹¶å°†æ ˆé¡¶çš„å¼‚å¸¸æŠ›å‡ºï¼Œæ–¹æ³•ç»“æŸã€‚</p></blockquote><h5 id="2ï¼‰-Exceptionså±æ€§"><a href="#2ï¼‰-Exceptionså±æ€§" class="headerlink" title="2ï¼‰ Exceptionså±æ€§"></a>2ï¼‰ Exceptionså±æ€§</h5><p>Exceptionså±æ€§æ˜¯åœ¨æ–¹æ³•è¡¨ä¸­ä¸Codeå±æ€§å¹³çº§çš„ä¸€é¡¹å±æ€§ã€‚</p><p>Exceptionså±æ€§çš„ä½œç”¨æ˜¯åˆ—ä¸¾å‡ºæ–¹æ³•ä¸­å¯èƒ½æŠ›å‡ºçš„å—æŸ¥å¼‚å¸¸ï¼ˆCheckedExcepitonsï¼‰ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•æè¿°æ—¶åœ¨throwså…³é”®å­—åé¢åˆ—ä¸¾çš„å¼‚å¸¸ã€‚</p><p>Exceptionså±æ€§ç»“æ„ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-Exceptions.jpg" alt="Exceptionså±æ€§ç»“æ„"></p><p>number_of_exceptionsé¡¹è¡¨ç¤ºæ–¹æ³•å¯èƒ½æŠ›å‡ºnumber_of_exceptionsç§å—æŸ¥å¼‚å¸¸ï¼Œæ¯ä¸€ç§å—æŸ¥å¼‚å¸¸ä½¿ç”¨ä¸€ä¸ªexception_index_tableé¡¹è¡¨ç¤ºï¼›exception_index_tableæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± ä¸­CONSTANT_Class_infoå‹å¸¸é‡çš„ç´¢å¼•ï¼Œä»£è¡¨äº†è¯¥å—æŸ¥å¼‚å¸¸çš„ç±»å‹ã€‚</p><h5 id="3ï¼‰LineNumberTableå±æ€§"><a href="#3ï¼‰LineNumberTableå±æ€§" class="headerlink" title="3ï¼‰LineNumberTableå±æ€§"></a>3ï¼‰LineNumberTableå±æ€§</h5><p>LineNumberTableå±æ€§ç”¨äºæè¿°Javaæºç è¡Œå·ä¸å­—èŠ‚ç è¡Œå·ï¼ˆå­—èŠ‚ç çš„åç§»é‡ï¼‰ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚å®ƒå¹¶ä¸æ˜¯è¿è¡Œæ—¶å¿…éœ€çš„å±æ€§ï¼Œä½†é»˜è®¤ä¼šç”Ÿæˆåˆ°Classæ–‡ä»¶ä¹‹ä¸­ï¼Œå¯ä»¥åœ¨Javacä¸­ä½¿ç”¨-gï¼šnoneæˆ–-gï¼šlinesé€‰é¡¹æ¥å–æ¶ˆæˆ–è¦æ±‚ç”Ÿæˆè¿™é¡¹ä¿¡æ¯ã€‚</p><p>å¦‚æœé€‰æ‹©ä¸ç”ŸæˆLineNumberTableå±æ€§ï¼Œå¯¹ç¨‹åºè¿è¡Œäº§ç”Ÿçš„æœ€ä¸»è¦å½±å“å°±æ˜¯å½“æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå †æ ˆä¸­å°†ä¸ä¼šæ˜¾ç¤ºå‡ºé”™çš„è¡Œå·ï¼Œå¹¶ä¸”åœ¨è°ƒè¯•ç¨‹åºçš„æ—¶å€™ï¼Œä¹Ÿæ— æ³•æŒ‰ç…§æºç è¡Œæ¥è®¾ç½®æ–­ç‚¹ã€‚</p><p>LineNumberTableå±æ€§ç»“æ„ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-lineNumTable.jpg" alt="LineNumberTableå±æ€§ç»“æ„"></p><p>line_number_tableæ˜¯ä¸€ä¸ªæ•°é‡ä¸ºline_number_table_lengthã€ç±»å‹ä¸ºline_number_infoçš„é›†åˆï¼Œline_number_infoè¡¨åŒ…å«start_pcå’Œline_numberä¸¤ä¸ªu2ç±»å‹çš„æ•°æ®é¡¹ï¼Œå‰è€…æ˜¯å­—èŠ‚ç è¡Œå·ï¼Œåè€…æ˜¯Javaæºç è¡Œå·ã€‚</p><h5 id="4ï¼‰LocalVariableTable"><a href="#4ï¼‰LocalVariableTable" class="headerlink" title="4ï¼‰LocalVariableTable"></a>4ï¼‰LocalVariableTable</h5><p>LocalVariableTableåŠLocalVariableTypeTableå±æ€§ã€‚</p><p>LocalVariableTableå±æ€§ç”¨äºæè¿°æ ˆå¸§ä¸­å±€éƒ¨å˜é‡è¡¨çš„å˜é‡ä¸Javaæºç ä¸­å®šä¹‰çš„å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œå®ƒä¹Ÿä¸æ˜¯è¿è¡Œæ—¶å¿…éœ€çš„å±æ€§ï¼Œä½†é»˜è®¤ä¼šç”Ÿæˆåˆ°Classæ–‡ä»¶ä¹‹ä¸­ï¼Œå¯ä»¥åœ¨Javacä¸­ä½¿ç”¨-gï¼šnoneæˆ–-gï¼švarsé€‰é¡¹æ¥å–æ¶ˆæˆ–è¦æ±‚ç”Ÿæˆè¿™é¡¹ä¿¡æ¯ã€‚</p><p>å¦‚æœæ²¡æœ‰ç”Ÿæˆè¿™é¡¹å±æ€§ï¼Œæœ€å¤§çš„å½±å“å°±æ˜¯å½“å…¶ä»–äººå¼•ç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œæ‰€æœ‰çš„å‚æ•°åç§°éƒ½å°†ä¼šä¸¢å¤±ï¼Œè­¬å¦‚IDEå°†ä¼šä½¿ç”¨è¯¸å¦‚arg0ã€arg1ä¹‹ç±»çš„å ä½ç¬¦ä»£æ›¿åŸæœ‰çš„å‚æ•°åï¼Œè¿™å¯¹ç¨‹åºè¿è¡Œæ²¡æœ‰å½±å“ï¼Œä½†æ˜¯ä¼šå¯¹ä»£ç ç¼–å†™å¸¦æ¥è¾ƒå¤§ä¸ä¾¿ï¼Œè€Œä¸”åœ¨è°ƒè¯•æœŸé—´æ— æ³•æ ¹æ®å‚æ•°åç§°ä»ä¸Šä¸‹æ–‡ä¸­è·å¾—å‚æ•°å€¼ã€‚</p><p>LocalVariableTableå±æ€§çš„ç»“æ„ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-LocalVarTable.jpg" alt="LocalVariableTableå±æ€§ç»“æ„"></p><p>å…¶ä¸­local_variable_infoé¡¹ç›®ä»£è¡¨äº†ä¸€ä¸ªæ ˆå¸§ä¸æºç ä¸­çš„å±€éƒ¨å˜é‡çš„å…³è”ï¼Œlocal_variable_infoç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-LocalVarInfo.jpg" alt="LocalVariableTableå±æ€§ç»“æ„"></p><p>start_pcå’Œlengthå±æ€§åˆ†åˆ«ä»£è¡¨äº†è¿™ä¸ªå±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹çš„å­—èŠ‚ç åç§»é‡åŠå…¶ä½œç”¨èŒƒå›´è¦†ç›–çš„é•¿åº¦ï¼Œä¸¤è€…ç»“åˆèµ·æ¥å°±æ˜¯è¿™ä¸ªå±€éƒ¨å˜é‡åœ¨å­—èŠ‚ç ä¹‹ä¸­çš„ä½œç”¨åŸŸèŒƒå›´ã€‚</p><p>name_indexå’Œdescriptor_indexéƒ½æ˜¯æŒ‡å‘å¸¸é‡æ± ä¸­CONSTANT_Utf8_infoå‹å¸¸é‡çš„ç´¢å¼•ï¼Œåˆ†åˆ«ä»£è¡¨äº†å±€éƒ¨å˜é‡çš„åç§°ä»¥åŠè¿™ä¸ªå±€éƒ¨å˜é‡çš„æè¿°ç¬¦ã€‚</p><p>indexæ˜¯è¿™ä¸ªå±€éƒ¨å˜é‡åœ¨æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨ä¸­å˜é‡æ§½çš„ä½ç½®ã€‚å½“è¿™ä¸ªå˜é‡æ•°æ®ç±»å‹æ˜¯64ä½ç±»å‹æ—¶ï¼ˆdoubleå’Œlongï¼‰ï¼Œå®ƒå ç”¨çš„å˜é‡æ§½ä¸ºindexå’Œindex+1ä¸¤ä¸ªã€‚</p><blockquote><p>åœ¨JDK 5å¼•å…¥æ³›å‹ä¹‹åï¼ŒLocalVariableTableå±æ€§å¢åŠ äº†ä¸€ä¸ªâ€å§å¦¹å±æ€§â€â€”â€”LocalVariableTypeTableã€‚è¿™ä¸ªæ–°å¢çš„å±æ€§ç»“æ„ä¸LocalVariableTableéå¸¸ç›¸ä¼¼ï¼Œä»…ä»…æ˜¯æŠŠè®°å½•çš„å­—æ®µæè¿°ç¬¦çš„descriptor_indexæ›¿æ¢æˆäº†å­—æ®µçš„ç‰¹å¾ç­¾åï¼ˆSignatureï¼‰ã€‚å¯¹äºéæ³›å‹ç±»å‹æ¥è¯´ï¼Œæè¿°ç¬¦å’Œç‰¹å¾ç­¾åèƒ½æè¿°çš„ä¿¡æ¯æ˜¯èƒ½å»åˆä¸€è‡´çš„ï¼Œä½†æ˜¯æ³›å‹å¼•å…¥ä¹‹åï¼Œç”±äºæè¿°ç¬¦ä¸­æ³›å‹çš„å‚æ•°åŒ–ç±»å‹è¢«æ“¦é™¤æ‰[æ’å›¾]ï¼Œæè¿°ç¬¦å°±ä¸èƒ½å‡†ç¡®æè¿°æ³›å‹ç±»å‹äº†ã€‚å› æ­¤å‡ºç°äº†LocalVariableTypeTableå±æ€§ï¼Œä½¿ç”¨å­—æ®µçš„ç‰¹å¾ç­¾åæ¥å®Œæˆæ³›å‹çš„æè¿°ã€‚</p></blockquote><h5 id="5ï¼‰SourceFile"><a href="#5ï¼‰SourceFile" class="headerlink" title="5ï¼‰SourceFile"></a>5ï¼‰SourceFile</h5><p>SourceFileåŠSourceDebugExtensionå±æ€§ã€‚</p><p>SourceFileå±æ€§ç”¨äºè®°å½•ç”Ÿæˆè¿™ä¸ªClassæ–‡ä»¶çš„æºç æ–‡ä»¶åç§°ã€‚è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå®šé•¿çš„å±æ€§ã€‚</p><p>è¿™ä¸ªå±æ€§ä¹Ÿæ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ä½¿ç”¨Javacçš„-gï¼šnoneæˆ–-gï¼šsourceé€‰é¡¹æ¥å…³é—­æˆ–è¦æ±‚ç”Ÿæˆè¿™é¡¹ä¿¡æ¯ã€‚åœ¨Javaä¸­ï¼Œå¯¹äºå¤§å¤šæ•°çš„ç±»æ¥è¯´ï¼Œç±»åå’Œæ–‡ä»¶åæ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼ˆå¦‚å†…éƒ¨ç±»ï¼‰ä¾‹å¤–ã€‚å¦‚æœä¸ç”Ÿæˆè¿™é¡¹å±æ€§ï¼Œå½“æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå †æ ˆä¸­å°†ä¸ä¼šæ˜¾ç¤ºå‡ºé”™ä»£ç æ‰€å±çš„æ–‡ä»¶åã€‚</p><p>SourceFileå±æ€§ç»“æ„ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-sourceFile.jpg" alt="SourceFileå±æ€§ç»“æ„"></p><p>sourcefile_indexæ•°æ®é¡¹æ˜¯æŒ‡å‘å¸¸é‡æ± ä¸­CONSTANT_Utf8_infoå‹å¸¸é‡çš„ç´¢å¼•ï¼Œå¸¸é‡å€¼æ˜¯æºç æ–‡ä»¶çš„æ–‡ä»¶åã€‚</p><blockquote><p>åœ¨JDK 5æ—¶ï¼Œæ–°å¢äº†SourceDebugExtensionå±æ€§ç”¨äºå­˜å‚¨é¢å¤–çš„ä»£ç è°ƒè¯•ä¿¡æ¯ã€‚å…¸å‹çš„åœºæ™¯æ˜¯åœ¨è¿›è¡ŒJSPæ–‡ä»¶è°ƒè¯•æ—¶ï¼Œæ— æ³•é€šè¿‡Javaå †æ ˆæ¥å®šä½åˆ°JSPæ–‡ä»¶çš„è¡Œå·ã€‚JSR 45ææ¡ˆä¸ºè¿™äº›éJavaè¯­è¨€ç¼–å†™ï¼Œå´éœ€è¦ç¼–è¯‘æˆå­—èŠ‚ç å¹¶è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸­çš„ç¨‹åºæä¾›äº†ä¸€ä¸ªè¿›è¡Œè°ƒè¯•çš„æ ‡å‡†æœºåˆ¶ï¼Œä½¿ç”¨SourceDebugExtensionå±æ€§å°±å¯ä»¥ç”¨äºå­˜å‚¨è¿™ä¸ªæ ‡å‡†æ‰€æ–°åŠ å…¥çš„è°ƒè¯•ä¿¡æ¯ï¼Œè­¬å¦‚è®©ç¨‹åºå‘˜èƒ½å¤Ÿå¿«é€Ÿä»å¼‚å¸¸å †æ ˆä¸­å®šä½å‡ºåŸå§‹JSPä¸­å‡ºç°é—®é¢˜çš„è¡Œå·ã€‚</p></blockquote><p>SourceDebugExtensionå±æ€§ç»“æ„ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-SourceDebugExtension.jpg" alt="SourceFileå±æ€§ç»“æ„"></p><p>å…¶ä¸­debug_extensionå­˜å‚¨çš„å°±æ˜¯é¢å¤–çš„è°ƒè¯•ä¿¡æ¯ï¼Œæ˜¯ä¸€ç»„é€šè¿‡å˜é•¿UTF-8æ ¼å¼æ¥è¡¨ç¤ºçš„å­—ç¬¦ä¸²ã€‚ä¸€ä¸ªç±»ä¸­æœ€å¤šåªå…è®¸å­˜åœ¨ä¸€ä¸ªSourceDebugExtensionå±æ€§ã€‚</p><p>6ï¼‰ConstantValueå±æ€§</p><p>ConstantValueå±æ€§çš„ä½œç”¨æ˜¯é€šçŸ¥è™šæ‹Ÿæœºè‡ªåŠ¨ä¸ºé™æ€å˜é‡èµ‹å€¼ã€‚åªæœ‰è¢«staticå…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼ˆç±»å˜é‡ï¼‰æ‰å¯ä»¥ä½¿ç”¨è¿™é¡¹å±æ€§ã€‚</p><p>å¯¹éstaticç±»å‹çš„å˜é‡ï¼ˆä¹Ÿå°±æ˜¯å®ä¾‹å˜é‡ï¼‰çš„èµ‹å€¼æ˜¯åœ¨å®ä¾‹æ„é€ å™¨<code>&lt;init&gt;()</code>æ–¹æ³•ä¸­è¿›è¡Œçš„ï¼›è€Œå¯¹äºç±»å˜é‡ï¼Œåˆ™æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€‰æ‹©ï¼šåœ¨ç±»æ„é€ å™¨<code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸­æˆ–è€…ä½¿ç”¨ConstantValueå±æ€§ã€‚</p><blockquote><p>ç›®å‰Oracleå…¬å¸å®ç°çš„Javacç¼–è¯‘å™¨çš„é€‰æ‹©æ˜¯ï¼Œå¦‚æœåŒæ—¶ä½¿ç”¨finalå’Œstaticæ¥ä¿®é¥°ä¸€ä¸ªå˜é‡ï¼ˆæœ¬è´¨æ˜¯â€å¸¸é‡â€ï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªå˜é‡çš„æ•°æ®ç±»å‹æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…java.lang.Stringçš„è¯ï¼Œå°±å°†ä¼šç”ŸæˆConstantValueå±æ€§æ¥è¿›è¡Œåˆå§‹åŒ–ï¼›å¦‚æœè¿™ä¸ªå˜é‡æ²¡æœ‰è¢«finalä¿®é¥°ï¼Œæˆ–è€…å¹¶éåŸºæœ¬ç±»å‹åŠå­—ç¬¦ä¸²ï¼Œåˆ™å°†ä¼šé€‰æ‹©åœ¨<code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸­è¿›è¡Œåˆå§‹åŒ–ã€‚</p></blockquote><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å¹¶æ²¡æœ‰å¼ºåˆ¶è¦æ±‚finalä¿®é¥°å­—æ®µå¿…é¡»è®¾ç½®ACC_FINALæ ‡å¿—ï¼Œè¦æ±‚æœ‰ConstantValueå±æ€§çš„å­—æ®µå¿…é¡»è®¾ç½®ACC_STATICæ ‡å¿—è€Œå·²ï¼Œå¯¹finalå…³é”®å­—çš„è¦æ±‚æ˜¯Javacç¼–è¯‘å™¨è‡ªå·±åŠ å…¥çš„é™åˆ¶ã€‚</p><p>ConstantValueå±æ€§ç»“æ„ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-ConstantValue.jpg" alt="ConstantValueå±æ€§ç»“æ„"></p><p>ConstantValueå±æ€§æ˜¯ä¸€ä¸ªå®šé•¿å±æ€§ï¼Œå®ƒçš„attribute_lengthæ•°æ®é¡¹å€¼å¿…é¡»å›ºå®šä¸º2ã€‚constantvalue_indexæ•°æ®é¡¹ä»£è¡¨äº†å¸¸é‡æ± ä¸­ä¸€ä¸ªå­—é¢é‡å¸¸é‡çš„å¼•ç”¨ï¼Œæ ¹æ®å­—æ®µç±»å‹çš„ä¸åŒï¼Œå­—é¢é‡å¯ä»¥æ˜¯CONSTANT_Long_infoã€CONSTANT_Float_infoã€CONSTANT_Double_infoã€CONSTANT_Integer_infoå’ŒCONSTANT_String_infoå¸¸é‡ä¸­çš„ä¸€ç§ã€‚</p><h5 id="7ï¼‰InnerClasseså±æ€§"><a href="#7ï¼‰InnerClasseså±æ€§" class="headerlink" title="7ï¼‰InnerClasseså±æ€§"></a>7ï¼‰InnerClasseså±æ€§</h5><p>InnerClasseså±æ€§ç”¨äºè®°å½•å†…éƒ¨ç±»ä¸å®¿ä¸»ç±»ä¹‹é—´çš„å…³è”ã€‚å¦‚æœä¸€ä¸ªç±»ä¸­å®šä¹‰äº†å†…éƒ¨ç±»ï¼Œé‚£ç¼–è¯‘å™¨å°†ä¼šä¸ºå®ƒä»¥åŠå®ƒæ‰€åŒ…å«çš„å†…éƒ¨ç±»ç”ŸæˆInnerClasseså±æ€§ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-InnerClasses.jpg" alt="InnerClasseså±æ€§ç»“æ„"></p><p>æ•°æ®é¡¹number_of_classesä»£è¡¨éœ€è¦è®°å½•å¤šå°‘ä¸ªå†…éƒ¨ç±»ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªå†…éƒ¨ç±»çš„ä¿¡æ¯éƒ½ç”±ä¸€ä¸ªinner_classes_infoè¡¨è¿›è¡Œæè¿°ã€‚</p><p> inner_classes_infoè¡¨çš„ç»“æ„ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-inner_classes_info.jpg" alt="inner_classes_infoè¡¨ç»“æ„"></p><p>inner_class_info_indexå’Œouter_class_info_indexéƒ½æ˜¯æŒ‡å‘å¸¸é‡æ± ä¸­CONSTANT_Class_infoå‹å¸¸é‡çš„ç´¢å¼•ï¼Œåˆ†åˆ«ä»£è¡¨äº†å†…éƒ¨ç±»å’Œå®¿ä¸»ç±»çš„ç¬¦å·å¼•ç”¨ã€‚</p><p>inner_name_indexæ˜¯æŒ‡å‘å¸¸é‡æ± ä¸­CONSTANT_Utf8_infoå‹å¸¸é‡çš„ç´¢å¼•ï¼Œä»£è¡¨è¿™ä¸ªå†…éƒ¨ç±»çš„åç§°ï¼Œå¦‚æœæ˜¯åŒ¿åå†…éƒ¨ç±»ï¼Œè¿™é¡¹å€¼ä¸º0ã€‚</p><p>inner_class_access_flagsæ˜¯å†…éƒ¨ç±»çš„è®¿é—®æ ‡å¿—ï¼Œç±»ä¼¼äºç±»çš„access_flagsï¼Œå®ƒçš„å–å€¼èŒƒå›´å¦‚è¡¨ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-inner_class_access_flags.jpg" alt="inner_class_access_flagsè¡¨ç»“æ„"></p><h5 id="8ï¼‰DeprecatedåŠSyntheticå±æ€§"><a href="#8ï¼‰DeprecatedåŠSyntheticå±æ€§" class="headerlink" title="8ï¼‰DeprecatedåŠSyntheticå±æ€§"></a>8ï¼‰DeprecatedåŠSyntheticå±æ€§</h5><p><code>Deprecated</code>å’Œ<code>Synthetic</code>ä¸¤ä¸ªå±æ€§éƒ½å±äºæ ‡å¿—ç±»å‹çš„å¸ƒå°”å±æ€§ï¼Œåªå­˜åœ¨æœ‰å’Œæ²¡æœ‰çš„åŒºåˆ«ï¼Œæ²¡æœ‰å±æ€§å€¼çš„æ¦‚å¿µã€‚<code>Deprecated</code>å±æ€§ç”¨äºè¡¨ç¤ºæŸä¸ªç±»ã€å­—æ®µæˆ–è€…æ–¹æ³•ï¼Œå·²ç»è¢«ç¨‹åºä½œè€…å®šä¸ºä¸å†æ¨èä½¿ç”¨ï¼Œå®ƒå¯ä»¥é€šè¿‡ä»£ç ä¸­ä½¿ç”¨<code>&quot;@deprecated&quot;</code>æ³¨è§£è¿›è¡Œè®¾ç½®ã€‚</p><p>Syntheticå±æ€§ä»£è¡¨æ­¤å­—æ®µæˆ–è€…æ–¹æ³•å¹¶ä¸æ˜¯ç”±Javaæºç ç›´æ¥äº§ç”Ÿçš„ï¼Œè€Œæ˜¯ç”±ç¼–è¯‘å™¨è‡ªè¡Œæ·»åŠ çš„ï¼Œåœ¨JDK 5ä¹‹åï¼Œæ ‡è¯†ä¸€ä¸ªç±»ã€å­—æ®µæˆ–è€…æ–¹æ³•æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿçš„ï¼Œä¹Ÿå¯ä»¥è®¾ç½®å®ƒä»¬è®¿é—®æ ‡å¿—ä¸­çš„<code>ACC_SYNTHETIC</code>æ ‡å¿—ä½ã€‚ç¼–è¯‘å™¨é€šè¿‡ç”Ÿæˆä¸€äº›åœ¨æºä»£ç ä¸­ä¸å­˜åœ¨çš„<code>Synthetic</code>æ–¹æ³•ã€å­—æ®µç”šè‡³æ˜¯æ•´ä¸ªç±»çš„æ–¹å¼ï¼Œå®ç°äº†è¶Šæƒè®¿é—®ï¼ˆè¶Šè¿‡<code>private</code>ä¿®é¥°å™¨ï¼‰æˆ–å…¶ä»–ç»•å¼€äº†è¯­è¨€é™åˆ¶çš„åŠŸèƒ½ï¼Œè¿™å¯ä»¥ç®—æ˜¯ä¸€ç§æ—©æœŸä¼˜åŒ–çš„æŠ€å·§ï¼Œå…¶ä¸­æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯æšä¸¾ç±»ä¸­è‡ªåŠ¨ç”Ÿæˆçš„æšä¸¾å…ƒç´ æ•°ç»„å’ŒåµŒå¥—ç±»çš„æ¡¥æ¥æ–¹æ³•ï¼ˆBridge Methodï¼‰ã€‚</p><p>æ‰€æœ‰ç”±ä¸å±äºç”¨æˆ·ä»£ç äº§ç”Ÿçš„ç±»ã€æ–¹æ³•åŠå­—æ®µéƒ½åº”å½“è‡³å°‘è®¾ç½®Syntheticå±æ€§æˆ–è€…ACC_SYNTHETICæ ‡å¿—ä½ä¸­çš„ä¸€é¡¹ï¼Œå”¯ä¸€çš„ä¾‹å¤–æ˜¯å®ä¾‹æ„é€ å™¨<code>&quot;&lt;init&gt;()&quot;</code>æ–¹æ³•å’Œç±»æ„é€ å™¨<code>&quot;&lt;clinit&gt;()&quot;</code>æ–¹æ³•ã€‚</p><p>Deprecatedå’ŒSyntheticå±æ€§çš„ç»“æ„:</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr></tbody></table><p>å…¶ä¸­attribute_lengthæ•°æ®é¡¹çš„å€¼å¿…é¡»ä¸º0x00000000ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•å±æ€§å€¼éœ€è¦è®¾ç½®ã€‚</p><h5 id="9-StackMapTableå±æ€§"><a href="#9-StackMapTableå±æ€§" class="headerlink" title="9)StackMapTableå±æ€§"></a>9)StackMapTableå±æ€§</h5><p>StackMapTableå±æ€§åœ¨JDK 6å¢åŠ åˆ°Classæ–‡ä»¶è§„èŒƒä¹‹ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„å˜é•¿å±æ€§ï¼Œä½äºCodeå±æ€§çš„å±æ€§è¡¨ä¸­ã€‚</p><p>StackMapTableå±æ€§ä¼šåœ¨è™šæ‹Ÿæœºç±»åŠ è½½çš„å­—èŠ‚ç éªŒè¯é˜¶æ®µè¢«æ–°ç±»å‹æ£€æŸ¥éªŒè¯å™¨ï¼ˆType Checkerï¼‰ä½¿ç”¨ï¼Œç›®çš„åœ¨äºä»£æ›¿ä»¥å‰æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½çš„åŸºäºæ•°æ®æµåˆ†æçš„ç±»å‹æ¨å¯¼éªŒè¯å™¨ã€‚</p><p>StackMapTableå±æ€§ä¸­åŒ…å«é›¶è‡³å¤šä¸ªæ ˆæ˜ å°„å¸§ï¼ˆStack Map Frameï¼‰ï¼Œæ¯ä¸ªæ ˆæ˜ å°„å¸§éƒ½æ˜¾å¼æˆ–éšå¼åœ°ä»£è¡¨äº†ä¸€ä¸ªå­—èŠ‚ç åç§»é‡ï¼Œç”¨äºè¡¨ç¤ºæ‰§è¡Œåˆ°è¯¥å­—èŠ‚ç æ—¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆçš„éªŒè¯ç±»å‹ã€‚ç±»å‹æ£€æŸ¥éªŒè¯å™¨ä¼šé€šè¿‡æ£€æŸ¥ç›®æ ‡æ–¹æ³•çš„å±€éƒ¨å˜é‡å’Œæ“ä½œæ•°æ ˆæ‰€éœ€è¦çš„ç±»å‹æ¥ç¡®å®šä¸€æ®µå­—èŠ‚ç æŒ‡ä»¤æ˜¯å¦ç¬¦åˆé€»è¾‘çº¦æŸã€‚</p><p>StackMapTableå±æ€§ç»“æ„:</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>number_of_entries</td><td>1</td></tr><tr><td>stack_map_frame</td><td>stack_map_frame_entries</td><td>number_of_entries</td></tr></tbody></table><blockquote><p>åœ¨Java SE 7ç‰ˆä¹‹åçš„ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­ï¼Œæ˜ç¡®è§„å®šå¯¹äºç‰ˆæœ¬å·å¤§äºæˆ–ç­‰äº50.0çš„Classæ–‡ä»¶ï¼Œå¦‚æœæ–¹æ³•çš„Codeå±æ€§ä¸­æ²¡æœ‰é™„å¸¦StackMapTableå±æ€§ï¼Œé‚£å°±æ„å‘³ç€å®ƒå¸¦æœ‰ä¸€ä¸ªéšå¼çš„StackMapå±æ€§ï¼Œè¿™ä¸ªStackMapå±æ€§çš„ä½œç”¨ç­‰åŒäºnumber_of_entrieså€¼ä¸º0çš„StackMapTableå±æ€§ã€‚ä¸€ä¸ªæ–¹æ³•çš„Codeå±æ€§æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªStackMapTableå±æ€§ï¼Œå¦åˆ™å°†æŠ›å‡ºClassFormatErrorå¼‚å¸¸ã€‚</p></blockquote><h5 id="10-Signatureå±æ€§"><a href="#10-Signatureå±æ€§" class="headerlink" title="10)Signatureå±æ€§"></a>10)Signatureå±æ€§</h5><p>Signatureå±æ€§åœ¨JDK 5å¢åŠ åˆ°Classæ–‡ä»¶è§„èŒƒä¹‹ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯é€‰çš„å®šé•¿å±æ€§ï¼Œå¯ä»¥å‡ºç°äºç±»ã€å­—æ®µè¡¨å’Œæ–¹æ³•è¡¨ç»“æ„çš„å±æ€§è¡¨ä¸­ã€‚ä¹‹åï¼Œä»»ä½•ç±»ã€æ¥å£ã€åˆå§‹åŒ–æ–¹æ³•æˆ–æˆå‘˜çš„æ³›å‹ç­¾åå¦‚æœåŒ…å«äº†ç±»å‹å˜é‡ï¼ˆType Variableï¼‰æˆ–å‚æ•°åŒ–ç±»å‹ï¼ˆParameterized Typeï¼‰ï¼Œåˆ™Signatureå±æ€§ä¼šä¸ºå®ƒè®°å½•æ³›å‹ç­¾åä¿¡æ¯ã€‚</p><blockquote><p>å› ä¸ºJavaè¯­è¨€çš„æ³›å‹é‡‡ç”¨çš„æ˜¯æ“¦é™¤æ³•å®ç°çš„ä¼ªæ³›å‹ï¼Œå­—èŠ‚ç ï¼ˆCodeå±æ€§ï¼‰ä¸­æ‰€æœ‰çš„æ³›å‹ä¿¡æ¯ç¼–è¯‘ï¼ˆç±»å‹å˜é‡ã€å‚æ•°åŒ–ç±»å‹ï¼‰åœ¨ç¼–è¯‘ä¹‹åéƒ½é€šé€šè¢«æ“¦é™¤æ‰ã€‚ä½¿ç”¨æ“¦é™¤æ³•çš„å¥½å¤„æ˜¯å®ç°ç®€å•ï¼ˆä¸»è¦ä¿®æ”¹Javacç¼–è¯‘å™¨ï¼Œè™šæ‹Ÿæœºå†…éƒ¨åªåšäº†å¾ˆå°‘çš„æ”¹åŠ¨ï¼‰ã€éå¸¸å®¹æ˜“å®ç°Backportï¼Œè¿è¡ŒæœŸä¹Ÿèƒ½å¤ŸèŠ‚çœä¸€äº›ç±»å‹æ‰€å çš„å†…å­˜ç©ºé—´ã€‚ä½†åå¤„æ˜¯è¿è¡ŒæœŸå°±æ— æ³•åƒC#ç­‰æœ‰çœŸæ³›å‹æ”¯æŒçš„è¯­è¨€é‚£æ ·ï¼Œå°†æ³›å‹ç±»å‹ä¸ç”¨æˆ·å®šä¹‰çš„æ™®é€šç±»å‹åŒç­‰å¯¹å¾…ï¼Œä¾‹å¦‚è¿è¡ŒæœŸåšåå°„æ—¶æ— æ³•è·å¾—æ³›å‹ä¿¡æ¯ã€‚Signatureå±æ€§å°±æ˜¯ä¸ºäº†å¼¥è¡¥è¿™ä¸ªç¼ºé™·è€Œå¢è®¾çš„ï¼Œç°åœ¨Javaçš„åå°„APIèƒ½å¤Ÿè·å–çš„æ³›å‹ç±»å‹ï¼Œæœ€ç»ˆçš„æ•°æ®æ¥æºä¹Ÿæ˜¯è¿™ä¸ªå±æ€§ã€‚</p></blockquote><p>Signatureå±æ€§ç»“æ„ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>signature_index</td><td>1</td></tr></tbody></table><p>å…¶ä¸­signature_indexé¡¹çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹å¸¸é‡æ± çš„æœ‰æ•ˆç´¢å¼•ã€‚</p><p>å¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„é¡¹å¿…é¡»æ˜¯CONSTANT_Utf8_infoç»“æ„ï¼Œè¡¨ç¤ºç±»ç­¾åæˆ–æ–¹æ³•ç±»å‹ç­¾åæˆ–å­—æ®µç±»å‹ç­¾åã€‚å¦‚æœå½“å‰çš„Signatureå±æ€§æ˜¯ç±»æ–‡ä»¶çš„å±æ€§ï¼Œåˆ™è¿™ä¸ªç»“æ„è¡¨ç¤ºç±»ç­¾åï¼Œå¦‚æœå½“å‰çš„Signatureå±æ€§æ˜¯æ–¹æ³•è¡¨çš„å±æ€§ï¼Œåˆ™è¿™ä¸ªç»“æ„è¡¨ç¤ºæ–¹æ³•ç±»å‹ç­¾åï¼Œå¦‚æœå½“å‰Signatureå±æ€§æ˜¯å­—æ®µè¡¨çš„å±æ€§ï¼Œåˆ™è¿™ä¸ªç»“æ„è¡¨ç¤ºå­—æ®µç±»å‹ç­¾åã€‚</p><h5 id="11-BootstrapMethodså±æ€§"><a href="#11-BootstrapMethodså±æ€§" class="headerlink" title="11)BootstrapMethodså±æ€§"></a>11)BootstrapMethodså±æ€§</h5><p>BootstrapMethodså±æ€§åœ¨JDK 7æ—¶å¢åŠ åˆ°Classæ–‡ä»¶è§„èŒƒä¹‹ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤æ‚çš„å˜é•¿å±æ€§ï¼Œä½äºç±»æ–‡ä»¶çš„å±æ€§è¡¨ä¸­ã€‚è¿™ä¸ªå±æ€§ç”¨äºä¿å­˜invokedynamicæŒ‡ä»¤å¼•ç”¨çš„å¼•å¯¼æ–¹æ³•é™å®šç¬¦ã€‚</p><blockquote><p>æ ¹æ®ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ï¼ˆä»Java SE 7ç‰ˆèµ·ï¼‰çš„è§„å®šï¼Œå¦‚æœæŸä¸ªç±»æ–‡ä»¶ç»“æ„çš„å¸¸é‡æ± ä¸­æ›¾ç»å‡ºç°è¿‡CONSTANT_InvokeDynamic_infoç±»å‹çš„å¸¸é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»æ–‡ä»¶çš„å±æ€§è¡¨ä¸­å¿…é¡»å­˜åœ¨ä¸€ä¸ªæ˜ç¡®çš„BootstrapMethodså±æ€§ï¼Œå¦å¤–ï¼Œå³ä½¿CONSTANT_InvokeDynamic_infoç±»å‹çš„å¸¸é‡åœ¨å¸¸é‡æ± ä¸­å‡ºç°è¿‡å¤šæ¬¡ï¼Œç±»æ–‡ä»¶çš„å±æ€§è¡¨ä¸­æœ€å¤šä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªBootstrapMethodså±æ€§ã€‚BootstrapMethodså±æ€§å’ŒJSR-292ä¸­çš„InvokeDynamicæŒ‡ä»¤å’Œjava.lang.InvokeåŒ…å…³ç³»éå¸¸å¯†åˆ‡</p></blockquote><p>JDK 8ä¸­Lambdaè¡¨è¾¾å¼å’Œæ¥å£é»˜è®¤æ–¹æ³•çš„å‡ºç°ï¼ŒInvokeDynamicæŒ‡ä»¤æœ‰äº†ä½¿ç”¨å‘æŒ¥çš„ç¯å¢ƒã€‚</p><p>BootstrapMethodså±æ€§ç»“æ„ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>num_bootstrap_methods</td><td></td></tr><tr><td>bootstrap_method</td><td>bootstrap_methods</td><td>num_bootstrap_methods</td></tr></tbody></table><p>å¼•ç”¨åˆ°çš„bootstrap_methodç»“æ„ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>bootstrap_method_ref</td><td>1</td></tr><tr><td>u2</td><td>num_bootstrap_arguments</td><td>1</td></tr><tr><td>u2</td><td>bootstrap_arguments</td><td>num_bootstrap_arguments</td></tr></tbody></table><p>BootstrapMethodså±æ€§é‡Œï¼Œnum_bootstrap_methodsé¡¹çš„å€¼ç»™å‡ºäº†bootstrap_methods[]æ•°ç»„ä¸­çš„å¼•å¯¼æ–¹æ³•é™å®šç¬¦çš„æ•°é‡ã€‚è€Œbootstrap_methods[]æ•°ç»„çš„æ¯ä¸ªæˆå‘˜åŒ…å«äº†ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± CONSTANT_MethodHandleç»“æ„çš„ç´¢å¼•å€¼ï¼Œå®ƒä»£è¡¨äº†ä¸€ä¸ªå¼•å¯¼æ–¹æ³•ã€‚è¿˜åŒ…å«äº†è¿™ä¸ªå¼•å¯¼æ–¹æ³•é™æ€å‚æ•°çš„åºåˆ—ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰ã€‚</p><p>bootstrap_methods[]æ•°ç»„çš„æ¯ä¸ªæˆå‘˜å¿…é¡»åŒ…å«ä»¥ä¸‹ä¸‰é¡¹å†…å®¹ï¼š</p><p>ï¼ˆaï¼‰bootstrap_method_refï¼šbootstrap_method_refé¡¹çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹å¸¸é‡æ± çš„æœ‰æ•ˆç´¢å¼•ã€‚å¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªCONSTANT_MethodHandle_infoç»“æ„ã€‚</p><p>ï¼ˆbï¼‰num_bootstrap_argumentsï¼šnum_bootstrap_argumentsé¡¹çš„å€¼ç»™å‡ºäº†bootstrap_argu-ments[]æ•°ç»„æˆå‘˜çš„æ•°é‡ã€‚</p><p>ï¼ˆcï¼‰bootstrap_arguments[]ï¼šbootstrap_arguments[]æ•°ç»„çš„æ¯ä¸ªæˆå‘˜å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹å¸¸é‡æ± çš„æœ‰æ•ˆç´¢å¼•ã€‚å¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å‡ºå¿…é¡»æ˜¯ä¸‹åˆ—ç»“æ„ä¹‹ä¸€ï¼šCONSTANT_String_infoã€CONSTANT_Class_infoã€CONSTANT_Integer_infoã€CONSTANT_Long_infoã€CONSTANT_Float_infoã€CONSTANT_Double_infoã€CONSTANT_MethodHandle_infoæˆ–CONSTANT_MethodType_infoã€‚</p><h5 id="12-MethodParameterså±æ€§"><a href="#12-MethodParameterså±æ€§" class="headerlink" title="12)MethodParameterså±æ€§"></a>12)MethodParameterså±æ€§</h5><p>MethodParametersæ˜¯åœ¨JDK 8æ—¶æ–°åŠ å…¥åˆ°Classæ–‡ä»¶æ ¼å¼ä¸­çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨åœ¨æ–¹æ³•è¡¨ä¸­çš„å˜é•¿å±æ€§ã€‚MethodParametersçš„ä½œç”¨æ˜¯è®°å½•æ–¹æ³•çš„å„ä¸ªå½¢å‚åç§°å’Œä¿¡æ¯ã€‚</p><p>JDK 8ä¸­æ–°å¢çš„è¿™ä¸ªå±æ€§ï¼Œä½¿å¾—ç¼–è¯‘å™¨å¯ä»¥ï¼ˆç¼–è¯‘æ—¶åŠ ä¸Š-parameterså‚æ•°ï¼‰å°†æ–¹æ³•åç§°ä¹Ÿå†™è¿›Classæ–‡ä»¶ä¸­ï¼Œè€Œä¸”MethodParametersæ˜¯æ–¹æ³•è¡¨çš„å±æ€§ï¼Œä¸Codeå±æ€§å¹³çº§çš„ï¼Œå¯ä»¥è¿è¡Œæ—¶é€šè¿‡åå°„APIè·å–ã€‚</p><p>MethodParameterså±æ€§ç»“æ„:</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u1</td><td>parameters_count</td><td>1</td></tr><tr><td>parameter</td><td>parameters</td><td>parameters_count</td></tr></tbody></table><p>å¼•ç”¨åˆ°çš„parameterå±æ€§ç»“æ„:</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>name_index</td><td>1</td></tr><tr><td>u2</td><td>access_flags</td><td>1</td></tr></tbody></table><p>name_indexæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± CONSTANT_Utf8_infoå¸¸é‡çš„ç´¢å¼•å€¼ï¼Œä»£è¡¨äº†è¯¥å‚æ•°çš„åç§°ã€‚</p><p>access_flagsæ˜¯å‚æ•°çš„çŠ¶æ€æŒ‡ç¤ºå™¨ï¼Œå®ƒå¯ä»¥åŒ…å«ä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¸­çš„ä¸€ç§æˆ–å¤šç§ï¼š</p><p>ï¼ˆaï¼‰0x0010ï¼ˆACC_FINALï¼‰ï¼šè¡¨ç¤ºè¯¥å‚æ•°è¢«finalä¿®é¥°ã€‚</p><p>ï¼ˆbï¼‰0x1000ï¼ˆACC_SYNTHETICï¼‰ï¼šè¡¨ç¤ºè¯¥å‚æ•°å¹¶æœªå‡ºç°åœ¨æºæ–‡ä»¶ä¸­ï¼Œæ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p><p>ï¼ˆcï¼‰0x8000ï¼ˆACC_MANDATEDï¼‰ï¼šè¡¨ç¤ºè¯¥å‚æ•°æ˜¯åœ¨æºæ–‡ä»¶ä¸­éšå¼å®šä¹‰çš„ã€‚Javaè¯­è¨€ä¸­çš„å…¸å‹åœºæ™¯æ˜¯thiså…³é”®å­—ã€‚</p><h5 id="13-æ¨¡å—åŒ–ç›¸å…³å±æ€§"><a href="#13-æ¨¡å—åŒ–ç›¸å…³å±æ€§" class="headerlink" title="13)æ¨¡å—åŒ–ç›¸å…³å±æ€§"></a>13)æ¨¡å—åŒ–ç›¸å…³å±æ€§</h5><p>JDK 9çš„ä¸€ä¸ªé‡é‡çº§åŠŸèƒ½æ˜¯Javaçš„æ¨¡å—åŒ–åŠŸèƒ½ï¼Œå› ä¸ºæ¨¡å—æè¿°æ–‡ä»¶ï¼ˆmodule-info.javaï¼‰æœ€ç»ˆæ˜¯è¦ç¼–è¯‘æˆä¸€ä¸ªç‹¬ç«‹çš„Classæ–‡ä»¶æ¥å­˜å‚¨çš„ï¼Œæ‰€ä»¥ï¼ŒClassæ–‡ä»¶æ ¼å¼ä¹Ÿæ‰©å±•äº†Moduleã€ModulePackageså’ŒModuleMainClassä¸‰ä¸ªå±æ€§ç”¨äºæ”¯æŒJavaæ¨¡å—åŒ–ç›¸å…³åŠŸèƒ½ã€‚</p><p>Moduleå±æ€§æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„å˜é•¿å±æ€§ï¼Œé™¤äº†è¡¨ç¤ºè¯¥æ¨¡å—çš„åç§°ã€ç‰ˆæœ¬ã€æ ‡å¿—ä¿¡æ¯ä»¥å¤–ï¼Œè¿˜å­˜å‚¨äº†è¿™ä¸ªæ¨¡å—requiresã€exportsã€opensã€useså’Œprovideså®šä¹‰çš„å…¨éƒ¨å†…å®¹ã€‚</p><p>Moduleå±æ€§ç»“æ„:</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-6-class-Module.jpg" alt="Moduleå±æ€§ç»“æ„"></p><p>module_name_indexæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± CONSTANT_Utf8_infoå¸¸é‡çš„ç´¢å¼•å€¼ï¼Œä»£è¡¨äº†è¯¥æ¨¡å—çš„åç§°ã€‚</p><p>module_flagsæ˜¯æ¨¡å—çš„çŠ¶æ€æŒ‡ç¤ºå™¨ï¼Œå®ƒå¯ä»¥åŒ…å«ä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¸­çš„ä¸€ç§æˆ–å¤šç§ï¼š</p><p>ï¼ˆaï¼‰0x0020ï¼ˆACC_OPENï¼‰ï¼šè¡¨ç¤ºè¯¥æ¨¡å—æ˜¯å¼€æ”¾çš„ã€‚</p><p>ï¼ˆbï¼‰0x1000ï¼ˆACC_SYNTHETICï¼‰ï¼šè¡¨ç¤ºè¯¥æ¨¡å—å¹¶æœªå‡ºç°åœ¨æºæ–‡ä»¶ä¸­ï¼Œæ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p><p>ï¼ˆcï¼‰0x8000ï¼ˆACC_MANDATEDï¼‰ï¼šè¡¨ç¤ºè¯¥æ¨¡å—æ˜¯åœ¨æºæ–‡ä»¶ä¸­éšå¼å®šä¹‰çš„ã€‚</p><p>module_version_indexæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± CONSTANT_Utf8_infoå¸¸é‡çš„ç´¢å¼•å€¼ï¼Œä»£è¡¨äº†è¯¥æ¨¡å—çš„ç‰ˆæœ¬å·ã€‚</p><p>åé¢çš„å‡ ä¸ªå±æ€§åˆ†åˆ«è®°å½•äº†æ¨¡å—çš„requiresã€exportsã€opensã€useså’Œprovideså®šä¹‰ï¼Œç»“æ„åŸºæœ¬ç›¸ä¼¼ï¼Œå¦‚</p><p>exportså±æ€§ç»“æ„ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>exports_index</td><td>1</td></tr><tr><td>u2</td><td>exports_flags</td><td>1</td></tr><tr><td>u2</td><td>exports_to_count</td><td>1</td></tr><tr><td>export</td><td>exports_to_index</td><td>exports_to_count</td></tr></tbody></table><p>exportså±æ€§çš„æ¯ä¸€å…ƒç´ éƒ½ä»£è¡¨ä¸€ä¸ªè¢«æ¨¡å—æ‰€å¯¼å‡ºçš„åŒ…ã€‚</p><p>exports_indexæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± CONSTANT_Package_infoå¸¸é‡çš„ç´¢å¼•å€¼ï¼Œä»£è¡¨äº†è¢«è¯¥æ¨¡å—å¯¼å‡ºçš„åŒ…ã€‚</p><p>exports_flagsæ˜¯è¯¥å¯¼å‡ºåŒ…çš„çŠ¶æ€æŒ‡ç¤ºå™¨ï¼Œå®ƒå¯ä»¥åŒ…å«ä»¥ä¸‹ä¸¤ç§çŠ¶æ€ä¸­çš„ä¸€ç§æˆ–å¤šç§ï¼š</p><p>ï¼ˆaï¼‰0x1000ï¼ˆACC_SYNTHETICï¼‰ï¼šè¡¨ç¤ºè¯¥å¯¼å‡ºåŒ…å¹¶æœªå‡ºç°åœ¨æºæ–‡ä»¶ä¸­ï¼Œæ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p><p>ï¼ˆbï¼‰0x8000ï¼ˆACC_MANDATEDï¼‰ï¼šè¡¨ç¤ºè¯¥å¯¼å‡ºåŒ…æ˜¯åœ¨æºæ–‡ä»¶ä¸­éšå¼å®šä¹‰çš„ã€‚</p><p>exports_to_countæ˜¯è¯¥å¯¼å‡ºåŒ…çš„é™å®šè®¡æ•°å™¨ï¼Œå¦‚æœè¿™ä¸ªè®¡æ•°å™¨ä¸ºé›¶ï¼Œè¿™è¯´æ˜è¯¥å¯¼å‡ºåŒ…æ˜¯æ— é™å®šçš„ï¼ˆUnqualifiedï¼‰ï¼Œå³å®Œå…¨å¼€æ”¾çš„ï¼Œä»»ä½•å…¶ä»–æ¨¡å—éƒ½å¯ä»¥è®¿é—®è¯¥åŒ…ä¸­æ‰€æœ‰å†…å®¹ã€‚å¦‚æœè¯¥è®¡æ•°å™¨ä¸ä¸ºé›¶ï¼Œåˆ™åé¢çš„exports_to_indexæ˜¯ä»¥è®¡æ•°å™¨å€¼ä¸ºé•¿åº¦çš„æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± ä¸­CONSTANT_Module_infoå¸¸é‡çš„ç´¢å¼•å€¼ï¼Œä»£è¡¨ç€åªæœ‰åœ¨è¿™ä¸ªæ•°ç»„èŒƒå›´å†…çš„æ¨¡å—æ‰è¢«å…è®¸è®¿é—®è¯¥å¯¼å‡ºåŒ…çš„å†…å®¹ã€‚</p><p>ModulePackagesæ˜¯å¦ä¸€ä¸ªç”¨äºæ”¯æŒJavaæ¨¡å—åŒ–çš„å˜é•¿å±æ€§ï¼Œå®ƒç”¨äºæè¿°è¯¥æ¨¡å—ä¸­æ‰€æœ‰çš„åŒ…ï¼Œä¸è®ºæ˜¯ä¸æ˜¯è¢«exportæˆ–è€…opençš„ã€‚</p><p>ModulePackageså±æ€§ç»“æ„ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>package_count</td><td>1</td></tr><tr><td>u2</td><td>package_index</td><td>package_count</td></tr></tbody></table><p>package_countæ˜¯package_indexæ•°ç»„çš„è®¡æ•°å™¨ï¼Œpackage_indexä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æŒ‡å‘å¸¸é‡æ± CONSTANT_Package_infoå¸¸é‡çš„ç´¢å¼•å€¼ï¼Œä»£è¡¨äº†å½“å‰æ¨¡å—ä¸­çš„ä¸€ä¸ªåŒ…ã€‚</p><p>ModuleMainClasså±æ€§æ˜¯ä¸€ä¸ªå®šé•¿å±æ€§ï¼Œç”¨äºç¡®å®šè¯¥æ¨¡å—çš„ä¸»ç±»ï¼ˆMain Classï¼‰ã€‚</p><p>ModuleMainClasså±æ€§ç»“æ„ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>main_class_index</td><td>1</td></tr></tbody></table><p>main_class_indexæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± CONSTANT_Class_infoå¸¸é‡çš„ç´¢å¼•å€¼ï¼Œä»£è¡¨äº†è¯¥æ¨¡å—çš„ä¸»ç±»ã€‚</p><h5 id="14-è¿è¡Œæ—¶æ³¨è§£ç›¸å…³å±æ€§"><a href="#14-è¿è¡Œæ—¶æ³¨è§£ç›¸å…³å±æ€§" class="headerlink" title="14)è¿è¡Œæ—¶æ³¨è§£ç›¸å…³å±æ€§"></a>14)è¿è¡Œæ—¶æ³¨è§£ç›¸å…³å±æ€§</h5><p>JDK 5æ—¶æä¾›äº†å¯¹æ³¨è§£ï¼ˆAnnotationï¼‰çš„æ”¯æŒã€‚</p><p>ä¸ºäº†å­˜å‚¨æºç ä¸­æ³¨è§£ä¿¡æ¯ï¼ŒClassæ–‡ä»¶åŒæ­¥å¢åŠ äº†<code>RuntimeVisibleAnnotations</code>ã€<code>RuntimeInvisibleAnnotations</code>ã€<code>RuntimeVisibleParameterAnnotations</code>å’Œ<code>RuntimeInvisibleParameter-Annotations</code>å››ä¸ªå±æ€§ã€‚åˆ°äº†JDK 8æ—¶æœŸï¼Œè¿›ä¸€æ­¥åŠ å¼ºäº†Javaè¯­è¨€çš„æ³¨è§£ä½¿ç”¨èŒƒå›´ï¼Œåˆæ–°å¢ç±»å‹æ³¨è§£ï¼ˆJSR 308ï¼‰ï¼Œæ‰€ä»¥Classæ–‡ä»¶ä¸­ä¹ŸåŒæ­¥å¢åŠ äº†<code>RuntimeVisibleTypeAnnotations</code>å’Œ<code>RuntimeInvisibleTypeAnnotations</code>ä¸¤ä¸ªå±æ€§ã€‚</p><p>è¿™6ä¸ªå±æ€§ç»“æ„åŠŸèƒ½éƒ½æ¯”è¾ƒç›¸ä¼¼ï¼š</p><p>RuntimeVisibleAnnotationsæ˜¯ä¸€ä¸ªå˜é•¿å±æ€§ï¼Œå®ƒè®°å½•äº†ç±»ã€å­—æ®µæˆ–æ–¹æ³•çš„å£°æ˜ä¸Šè®°å½•è¿è¡Œæ—¶å¯è§æ³¨è§£ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨åå°„APIæ¥è·å–ç±»ã€å­—æ®µæˆ–æ–¹æ³•ä¸Šçš„æ³¨è§£æ—¶ï¼Œè¿”å›å€¼å°±æ˜¯é€šè¿‡è¿™ä¸ªå±æ€§æ¥å–åˆ°çš„ã€‚</p><p>RuntimeVisibleAnnotationså±æ€§ç»“æ„ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td></tr><tr><td>u2</td><td>num_annotations</td><td>1</td></tr><tr><td>annotation</td><td>annotations</td><td>num_annotations</td></tr></tbody></table><p>num_annotationsæ˜¯annotationsæ•°ç»„çš„è®¡æ•°å™¨ï¼Œannotationsä¸­æ¯ä¸ªå…ƒç´ éƒ½ä»£è¡¨äº†ä¸€ä¸ªè¿è¡Œæ—¶å¯è§çš„æ³¨è§£ï¼Œæ³¨è§£åœ¨Classæ–‡ä»¶ä¸­ä»¥annotationç»“æ„æ¥å­˜å‚¨</p><p>annotationå±æ€§ç»“æ„</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>type_index</td><td>1</td></tr><tr><td>u2</td><td>num_element_value_pairs</td><td>1</td></tr><tr><td>element_value_pair</td><td>element_value_pairs</td><td>num_element_value_pairs</td></tr></tbody></table><p>type_indexæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± CONSTANT_Utf8_infoå¸¸é‡çš„ç´¢å¼•å€¼ï¼Œè¯¥å¸¸é‡åº”ä»¥å­—æ®µæè¿°ç¬¦çš„å½¢å¼è¡¨ç¤ºä¸€ä¸ªæ³¨è§£ã€‚num_element_value_pairsæ˜¯element_value_pairsæ•°ç»„çš„è®¡æ•°å™¨ï¼Œelement_value_pairsä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œä»£è¡¨è¯¥æ³¨è§£çš„å‚æ•°å’Œå€¼ã€‚</p><h3 id="äºŒã€Classæ–‡ä»¶ç»“æ„çš„å‘å±•"><a href="#äºŒã€Classæ–‡ä»¶ç»“æ„çš„å‘å±•" class="headerlink" title="äºŒã€Classæ–‡ä»¶ç»“æ„çš„å‘å±•"></a>äºŒã€Classæ–‡ä»¶ç»“æ„çš„å‘å±•</h3><p>JDKçš„ç‰ˆæœ¬å·å·²ç»ä»1.0æå‡åˆ°äº†13ã€‚ç›¸å¯¹äºè¯­è¨€ã€APIä»¥åŠJavaæŠ€æœ¯ä½“ç³»ä¸­å…¶ä»–æ–¹é¢çš„å˜åŒ–ï¼ŒClassæ–‡ä»¶ç»“æ„ä¸€ç›´å¤„äºä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒç¨³å®šçš„çŠ¶æ€ï¼ŒClassæ–‡ä»¶çš„ä¸»ä½“ç»“æ„ã€å­—èŠ‚ç æŒ‡ä»¤çš„è¯­ä¹‰å’Œæ•°é‡å‡ ä¹æ²¡æœ‰å‡ºç°è¿‡å˜åŠ¨[æ’å›¾]ï¼Œæ‰€æœ‰å¯¹Classæ–‡ä»¶æ ¼å¼çš„æ”¹è¿›ï¼Œéƒ½é›†ä¸­åœ¨è®¿é—®æ ‡å¿—ã€å±æ€§è¡¨è¿™äº›è®¾è®¡ä¸ŠåŸæœ¬å°±æ˜¯å¯æ‰©å±•çš„æ•°æ®ç»“æ„ä¸­æ·»åŠ æ–°å†…å®¹ã€‚</p><blockquote><p>ä»¥ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒï¼ˆç¬¬2ç‰ˆï¼‰ã€‹ï¼ˆå¯¹åº”äºJDK 1.4ï¼Œæ˜¯Java 2çš„å¥ åŸºç‰ˆæœ¬ï¼‰ä¸ºåŸºå‡†è¿›è¡Œæ¯”è¾ƒçš„è¯ï¼Œåœ¨åç»­Classæ–‡ä»¶æ ¼å¼çš„å‘å±•è¿‡ç¨‹ä¸­ï¼Œè®¿é—®æ ‡å¿—æ–°åŠ å…¥äº†ACC_SYNTHETICã€ACC_ANNOTATIONã€ACC_ENUMã€ACC_BRIDGEã€ACC_VARARGSå…±äº”ä¸ªæ ‡å¿—ã€‚å±æ€§è¡¨é›†åˆä¸­ï¼Œåœ¨JDK 5åˆ°JDK 12å‘å±•è¿‡ç¨‹ä¸­ä¸€å…±å¢åŠ äº†20é¡¹æ–°å±æ€§ï¼Œè¿™äº›å±æ€§å¤§éƒ¨åˆ†æ˜¯ç”¨äºæ”¯æŒJavaä¸­è®¸å¤šæ–°å‡ºç°çš„è¯­è¨€ç‰¹æ€§ï¼Œå¦‚æšä¸¾ã€å˜é•¿å‚æ•°ã€æ³›å‹ã€åŠ¨æ€æ³¨è§£ç­‰ã€‚è¿˜æœ‰ä¸€äº›æ˜¯ä¸ºäº†æ”¯æŒæ€§èƒ½æ”¹è¿›å’Œè°ƒè¯•ä¿¡æ¯ï¼Œè­¬å¦‚JDK 6çš„æ–°ç±»å‹æ ¡éªŒå™¨çš„StackMapTableå±æ€§å’Œå¯¹éJavaä»£ç è°ƒè¯•ä¸­ç”¨åˆ°çš„SourceDebugExtensionå±æ€§ã€‚</p></blockquote><p>Classæ–‡ä»¶æ ¼å¼æ‰€å…·å¤‡çš„å¹³å°ä¸­ç«‹ï¼ˆä¸ä¾èµ–äºç‰¹å®šç¡¬ä»¶åŠæ“ä½œç³»ç»Ÿï¼‰ã€ç´§å‡‘ã€ç¨³å®šå’Œå¯æ‰©å±•çš„ç‰¹ç‚¹ï¼Œæ˜¯JavaæŠ€æœ¯ä½“ç³»å®ç°å¹³å°æ— å…³ã€è¯­è¨€æ— å…³ä¸¤é¡¹ç‰¹æ€§çš„é‡è¦æ”¯æŸ±ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> classç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmä¹‹å¯¹è±¡æŸ¥è¯¢OQL</title>
      <link href="/posts/2197a49e.html"/>
      <url>/posts/2197a49e.html</url>
      
        <content type="html"><![CDATA[<h2 id="jvmä¹‹å¯¹è±¡æŸ¥è¯¢OQL"><a href="#jvmä¹‹å¯¹è±¡æŸ¥è¯¢OQL" class="headerlink" title="jvmä¹‹å¯¹è±¡æŸ¥è¯¢OQL"></a>jvmä¹‹å¯¹è±¡æŸ¥è¯¢OQL</h2><h3 id="ä¸€ã€SELECTå­å¥"><a href="#ä¸€ã€SELECTå­å¥" class="headerlink" title="ä¸€ã€SELECTå­å¥"></a>ä¸€ã€SELECTå­å¥</h3><p>SELECTå­å¥ç”¨äºç¡®å®šæŸ¥è¯¢è¯­å¥éœ€è¦ä»å †è½¬å‚¨å¿«ç…§ä¸­é€‰æ‹©ä»€ä¹ˆå†…å®¹ã€‚å¦‚æœéœ€è¦æ˜¾ç¤ºå †è½¬å‚¨å¿«ç…§ä¸­çš„å¯¹è±¡ï¼Œå¹¶ä¸”æµè§ˆè¿™äº›å¯¹è±¡çš„å¼•ç”¨å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨<code>&quot;*&quot;</code>ï¼Œè¿™ä¸ä¼ ç»Ÿ<code>SQL</code> è¯­å¥ä¸­çš„ä¹ æƒ¯æ˜¯ä¸€è‡´çš„ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String</code></pre><h4 id="1-é€‰æ‹©ç‰¹å®šçš„æ˜¾ç¤ºåˆ—"><a href="#1-é€‰æ‹©ç‰¹å®šçš„æ˜¾ç¤ºåˆ—" class="headerlink" title="1.é€‰æ‹©ç‰¹å®šçš„æ˜¾ç¤ºåˆ—"></a>1.é€‰æ‹©ç‰¹å®šçš„æ˜¾ç¤ºåˆ—</h4><p>æŸ¥è¯¢ä¹Ÿå¯ä»¥é€‰æ‹©ç‰¹å®šçš„éœ€è¦æ˜¾ç¤ºçš„å­—æ®µï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> toString<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>count<span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s</code></pre><p>æŸ¥è¯¢å¯ä»¥é€šè¿‡â€œ@â€ç¬¦å·æ¥ä½¿ç”¨Javaå¯¹è±¡çš„å†…å­˜å±æ€§è®¿é—®å™¨ã€‚MATæä¾›äº†ä¸€ç³»åˆ—çš„å†…ç½®å‡½æ•°æ¥è·å–ä¸åˆ†æç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> toString<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token variable">@userdHeapSize</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token variable">@retainedHeapSize</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s</code></pre><p>2ã€ä½¿ç”¨åˆ—åˆ«å</p><p>å¯ä»¥ä½¿ç”¨ASå…³é”®å­—æ¥å¯¹é€‰æ‹©çš„åˆ—è¿›è¡Œå‘½åã€‚å¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>toString<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">as</span> val<span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token variable">@userdHeapSize</span> <span class="token keyword">as</span> <span class="token string">"shallw Size"</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token variable">@retainedHeapSize</span> <span class="token keyword">as</span> <span class="token string">"restained Seize"</span><span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s</code></pre><p>å¯ä»¥ä½¿ç”¨AS RETAINED SETå…³é”®å­—æ¥è·å¾—ä¸é€‰æ‹©å¯¹è±¡ç›¸å…³è”çš„å¯¹è±¡é›†åˆï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">AS</span> RETAINED  <span class="token keyword">SET</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String</code></pre><h4 id="3-æ‹¼åˆæˆä¸ºä¸€ä¸ªå¯¹è±¡åˆ—è¡¨é€‰æ‹©é¡¹ç›®"><a href="#3-æ‹¼åˆæˆä¸ºä¸€ä¸ªå¯¹è±¡åˆ—è¡¨é€‰æ‹©é¡¹ç›®" class="headerlink" title="3.æ‹¼åˆæˆä¸ºä¸€ä¸ªå¯¹è±¡åˆ—è¡¨é€‰æ‹©é¡¹ç›®"></a>3.æ‹¼åˆæˆä¸ºä¸€ä¸ªå¯¹è±¡åˆ—è¡¨é€‰æ‹©é¡¹ç›®</h4><p>å¯ä»¥ä½¿ç”¨OBJECTSå…³é”®å­—æŠŠSELECTå­å¥ä¸­æŸ¥æ‰¾å‡ºæ¥çš„æ•°æ®é¡¹ç›®è½¬æ¢ä¸ºå¯¹è±¡ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> OBJECTS dominators<span class="token punctuation">(</span>s<span class="token punctuation">)</span>  <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s</code></pre><p><code>dominators()</code>å‡½æ•°å°†ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰OBJECTSå…³é”®å­—ï¼Œä¸Šé¢çš„æŸ¥è¯¢å°†è¿”å›ä¸€ç»„äºŒç»´çš„å¯¹è±¡æ•°ç»„çš„åˆ—è¡¨ã€‚é€šè¿‡ä½¿ç”¨å…³é”®å­—OBJECTSï¼Œè¿«ä½¿<code>OQL</code>æŠŠæŸ¥è¯¢ç»“æœç¼©å‡ä¸ºä¸€ç»´çš„å¯¹è±¡åˆ—è¡¨ã€‚</p><h4 id="4-æ’é™¤é‡å¤å¯¹è±¡"><a href="#4-æ’é™¤é‡å¤å¯¹è±¡" class="headerlink" title="4.æ’é™¤é‡å¤å¯¹è±¡"></a>4.æ’é™¤é‡å¤å¯¹è±¡</h4><p>ä½¿ç”¨DISTINCTå…³é”®å­—å¯ä»¥æ’é™¤ç»“æœé›†ä¸­çš„é‡å¤å¯¹è±¡ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>  <span class="token keyword">DISTINCT</span>  classof<span class="token punctuation">(</span>s<span class="token punctuation">)</span>  <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s</code></pre><p><code>classof()</code>å‡½æ•°çš„ä½œç”¨æ˜¯è¿”å›å¯¹è±¡æ‰€å±çš„Javaç±»ã€‚</p><h3 id="äºŒã€FROM-å­å¥"><a href="#äºŒã€FROM-å­å¥" class="headerlink" title="äºŒã€FROM å­å¥"></a>äºŒã€FROM å­å¥</h3><h4 id="1-FROMå­å¥"><a href="#1-FROMå­å¥" class="headerlink" title="1.FROMå­å¥"></a>1.FROMå­å¥</h4><p>æŒ‡å®šéœ€è¦æŸ¥è¯¢çš„ç±»OQLæŸ¥è¯¢éœ€è¦åœ¨FROMå­å¥å®šä¹‰çš„æŸ¥è¯¢èŒƒå›´å†…è¿›è¡Œæ“ä½œã€‚FROMå­å¥å¯ä»¥æ¥å—çš„æŸ¥è¯¢èŒƒå›´æœ‰ä¸‹åˆ—å‡ ç§æè¿°æ–¹å¼ï¼š</p><p>ï¼ˆ1ï¼‰é€šè¿‡ç±»åè¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚ï¼š</p><pre><code>SELECT  *  FROM java.lang.String </code></pre><p>ï¼ˆ2ï¼‰é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸€ç»„ç±»åè¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>  <span class="token operator">*</span>  <span class="token keyword">FROM</span> <span class="token string">"java\.lang\..*"</span> </code></pre><p>ï¼ˆ3ï¼‰é€šè¿‡ç±»å¯¹è±¡åœ¨å †è½¬å‚¨å¿«ç…§ä¸­çš„åœ°å€è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>  <span class="token operator">*</span>  <span class="token keyword">FROM</span> <span class="token number">0xe12a20</span> </code></pre><p>ï¼ˆ4ï¼‰é€šè¿‡å¯¹è±¡åœ¨å †è½¬å‚¨å¿«ç…§ä¸­çš„IDè¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>  <span class="token operator">*</span>  <span class="token keyword">FROM</span> <span class="token number">4872</span> </code></pre><p>ï¼ˆ5ï¼‰åœ¨å­æŸ¥è¯¢ä¸­çš„ç»“æœé›†ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span>  <span class="token operator">*</span>  <span class="token keyword">FROM</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span>  <span class="token operator">*</span>  <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Class <span class="token number">c</span> <span class="token keyword">WHERE</span> <span class="token number">c</span> implements <span class="token operator">or</span> g<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>mat<span class="token punctuation">.</span><span class="token keyword">snapshot</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span>IClass<span class="token punctuation">)</span> </code></pre><p>ä¸Šé¢çš„æŸ¥è¯¢è¿”å›å †è½¬å‚¨å¿«ç…§ä¸­æ‰€æœ‰å®ç°äº†<code>org.eclipse.mat.snapshot.model.IClass</code>æ¥å£çš„ç±»ã€‚ä¸‹é¢çš„è¿™å¥æŸ¥è¯¢è¯­å¥ä½¿ç”¨å±æ€§è®¿é—®å™¨è¾¾åˆ°äº†åŒæ ·çš„æ•ˆæœï¼Œå®ƒç›´æ¥è°ƒç”¨äº†ISnapshotå¯¹è±¡çš„æ–¹æ³•ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> $<span class="token keyword">snapshot</span><span class="token punctuation">.</span>getClass<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="2-åŒ…å«å­ç±»"><a href="#2-åŒ…å«å­ç±»" class="headerlink" title="2.åŒ…å«å­ç±»"></a>2.åŒ…å«å­ç±»</h4><p>ä½¿ç”¨<code>INSTANCEOF</code>å…³é”®å­—æŠŠæŒ‡å®šç±»çš„å­ç±»åˆ—å…¥æŸ¥è¯¢ç»“æœé›†ä¹‹ä¸­ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> INSTANCEOF  java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span>Reference</code></pre><p>è¿™ä¸ªæŸ¥è¯¢çš„ç»“æœé›†ä¸­å°†ä¼šåŒ…å«WeakReferenceã€SoftReferenceå’ŒPhantomReferenceç±»å‹çš„å¯¹è±¡ï¼Œå› ä¸ºå®ƒä»¬éƒ½ç»§æ‰¿è‡ªjava.lang.ref.Referenceã€‚ä¸‹é¢è¿™å¥æŸ¥è¯¢è¯­å¥ä¹Ÿæœ‰ç›¸åŒçš„ç»“æœï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> $<span class="token keyword">snapshot</span><span class="token punctuation">.</span>getClassesByName<span class="token punctuation">(</span><span class="token string">"java.lang.ref.Reference"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span></code></pre><h4 id="3-ç¦æ­¢æŸ¥è¯¢ç±»å®ä¾‹"><a href="#3-ç¦æ­¢æŸ¥è¯¢ç±»å®ä¾‹" class="headerlink" title="3.ç¦æ­¢æŸ¥è¯¢ç±»å®ä¾‹"></a>3.ç¦æ­¢æŸ¥è¯¢ç±»å®ä¾‹</h4><p>åœ¨FROMå­å¥ä¸­ä½¿ç”¨OBJECTSå…³é”®å­—å¯ä»¥ç¦æ­¢<code>OQL</code>æŠŠæŸ¥è¯¢çš„èŒƒå›´è§£é‡Šä¸ºå¯¹è±¡å®ä¾‹ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> OBJECTS java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String </code></pre><p>è¿™ä¸ªæŸ¥è¯¢çš„ç»“æœä¸æ˜¯è¿”å›å¿«ç…§ä¸­æ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯åªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸<code>java.lang.String</code>ç±»å¯¹åº”çš„Classå¯¹è±¡ã€‚</p><p>ä¸‰ã€WHERE å­å¥</p><p>1ã€èŒƒå›´æ“ä½œä¸å…³ç³»æ“ä½œ</p><p>å¸¸è§çš„èŒƒå›´æœ‰ï¼š  <code>&gt;=</code> ï¼Œ<code>&lt;=</code>ï¼Œ<code>&gt;</code>ï¼Œ<code>&lt;</code>ï¼Œ<code>[NOT] LIKE</code>ï¼Œ<code>[ NOT ] IN</code></p><p>WHEREå­å¥ç”¨äºæŒ‡å®šæœç´¢çš„æ¡ä»¶ï¼Œå³ä»æŸ¥è¯¢ç»“æœä¸­åˆ é™¤ä¸éœ€è¦çš„æ•°æ®ï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span>count <span class="token operator">>=</span> <span class="token number">100</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> totring<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">LIKE</span> <span class="token string">".*service"</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token operator">NOT</span> <span class="token operator">IN</span> dominators<span class="token punctuation">(</span>s<span class="token punctuation">)</span></code></pre><p>2ã€ ç­‰äºæ“ä½œï¼ˆ <code>=</code>  ï¼Œ<code>!=</code>ï¼‰</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> totring<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"sayService"</span></code></pre><p>3ã€æ¡ä»¶ä¸æ“ä½œï¼ˆ<code>AND</code>ï¼‰</p><p>andæ“ä½œï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span>count <span class="token operator">>=</span> <span class="token number">100</span> <span class="token operator">AND</span> s<span class="token punctuation">.</span><span class="token variable">@retainedHeapSize</span> <span class="token operator">></span> s<span class="token punctuation">.</span><span class="token variable">@usedHeapSize</span></code></pre><p>4ã€æ¡ä»¶æˆ– æ“ä½œï¼ˆ<code>OR</code>ï¼‰</p><p>æ¡ä»¶æˆ– æ“ä½œå¯ä»¥åº”ç”¨äºè¡¨è¾¾å¼ã€å¸¸é‡æ–‡æœ¬å’Œå­æŸ¥è¯¢ã€‚å¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span>count <span class="token operator">>=</span> <span class="token number">100</span>  <span class="token operator">OR</span> s<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">.</span><span class="token variable">@length</span> <span class="token operator">></span> <span class="token number">500</span></code></pre><p>5ã€æ–‡å­—è¡¨è¾¾å¼</p><p>æ–‡å­—è¡¨è¾¾å¼ä¿å­˜å¸ƒå°”å€¼ã€å­—ç¬¦ä¸²ã€æ•´å‹ã€é•¿æ•´å‹å’Œnullï¼Œå¦‚ï¼š</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>count <span class="token operator">>=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> toString<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"hello World!"</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> dominators<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span><span class="token variable">@retainedHeapSize</span> <span class="token operator">></span> 1024L<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span><span class="token variable">@GCRootInfo</span> <span class="token operator">!=</span> <span class="token boolean">null</span></code></pre><h3 id="å››ã€å±æ€§è®¿é—®å™¨"><a href="#å››ã€å±æ€§è®¿é—®å™¨" class="headerlink" title="å››ã€å±æ€§è®¿é—®å™¨"></a>å››ã€å±æ€§è®¿é—®å™¨</h3><p>1ã€è®¿é—®å †è½¬å‚¨å¿«ç…§ä¸­å¯¹è±¡çš„å­—æ®µå¯¹è±¡çš„å†…å­˜å±æ€§å¯ä»¥é€šè¿‡ä¼ ç»Ÿçš„â€œç‚¹è¡¨ç¤ºæ³•â€è¿›è¡Œè®¿é—®ï¼Œæ ¼å¼ä¸ºï¼š</p><pre class=" language-txt"><code class="language-txt">[ <alias>.] <field>.<field>.<field>...</code></pre><p>2ã€è®¿é—®Java Beanå±æ€§</p><pre class=" language-sql"><code class="language-sql"><span class="token punctuation">[</span> <span class="token operator">&lt;</span>alias<span class="token operator">></span><span class="token punctuation">.</span><span class="token punctuation">]</span> @<span class="token operator">&lt;</span>attribute<span class="token operator">></span> </code></pre><p>ä½¿ç”¨@ç¬¦å·ï¼Œ<code>OQL</code>å¯ä»¥è®¿é—®åº•å±‚Javaå¯¹è±¡çš„å†…å­˜å±æ€§ã€‚ä¸‹è¡¨åˆ—å‡ºäº†ä¸€äº›å¸¸ç”¨çš„Javaå±æ€§ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-oql.jpg" alt="å¸¸ç”¨çš„Javaå±æ€§"></p><p>3ã€è°ƒç”¨<code>OQL</code> Javaæ–¹æ³•</p><pre class=" language-txt"><code class="language-txt">[ <alias>.] @<method>([<expression>, <expression>]) </code></pre><p>åŠ â€œ()â€ä¼šå°†MATè§£é‡Šä¸ºä¸€ä¸ª<code>OQL</code> Javaæ–¹æ³•è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨æ˜¯é€šè¿‡åå°„æ‰§è¡Œçš„ã€‚å¸¸è§çš„<code>OQL</code>Javaæ–¹æ³•å¦‚ä¸‹ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-oql-2.jpg" alt="å¸¸è§çš„OQL Javaæ–¹æ³•"></p><p>4ã€OQLçš„å†…å»ºå‡½æ•°</p><pre class=" language-sql"><code class="language-sql"><span class="token operator">&lt;</span><span class="token keyword">function</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&lt;</span>parameter<span class="token operator">></span><span class="token punctuation">)</span></code></pre><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-oql-3.jpg" alt="å¸¸ç”¨å†…å»ºå‡½æ•°"></p><h3 id="äº”ã€OQLè¯­è¨€çš„BNFèŒƒå¼"><a href="#äº”ã€OQLè¯­è¨€çš„BNFèŒƒå¼" class="headerlink" title="äº”ã€OQLè¯­è¨€çš„BNFèŒƒå¼"></a>äº”ã€OQLè¯­è¨€çš„BNFèŒƒå¼</h3><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-oql-bnf-1.jpg" alt="å¸¸ç”¨å†…å»ºå‡½æ•°"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-class/jvm-oql-bnf-2.jpg" alt="å¸¸ç”¨å†…å»ºå‡½æ•°"></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> OQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmä¹‹åˆ†é…ä¸å›æ”¶ç­–ç•¥</title>
      <link href="/posts/96a9f88d.html"/>
      <url>/posts/96a9f88d.html</url>
      
        <content type="html"><![CDATA[<h2 id="JVMå†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥"><a href="#JVMå†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥" class="headerlink" title="JVMå†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥"></a>JVMå†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥</h2><p>Javaçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œæœ€æ ¹æœ¬çš„ç›®æ ‡æ˜¯è‡ªåŠ¨åŒ–è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼šè‡ªåŠ¨ç»™å¯¹è±¡åˆ†é…å†…å­˜å’Œè‡ªåŠ¨å›æ”¶åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜ã€‚</p><h3 id="ä¸€ã€å¯¹è±¡å†…å­˜åˆ†é…"><a href="#ä¸€ã€å¯¹è±¡å†…å­˜åˆ†é…" class="headerlink" title="ä¸€ã€å¯¹è±¡å†…å­˜åˆ†é…"></a>ä¸€ã€å¯¹è±¡å†…å­˜åˆ†é…</h3><p>ä»æ¦‚å¿µä¸Šè®²ï¼Œåº”è¯¥éƒ½æ˜¯åœ¨å †ä¸Šåˆ†é…ï¼ˆè€Œå®é™…ä¸Šä¹Ÿæœ‰å¯èƒ½ç»è¿‡å³æ—¶ç¼–è¯‘åè¢«æ‹†æ•£ä¸ºæ ‡é‡ç±»å‹å¹¶é—´æ¥åœ°åœ¨æ ˆä¸Šåˆ†é…ï¼‰ã€‚</p><blockquote><p>åœ¨ç»å…¸çš„åˆ†ä»£æ”¶é›†å™¨ä¸­ï¼Œæ–°ç”Ÿå¯¹è±¡ä¸€èˆ¬ä¼šåˆ†é…åœ¨æ–°ç”Ÿä»£ã€‚ç‰¹æ®Šæƒ…å†µä¸‹å›ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ï¼Œå¦‚å¯¹è±¡å¤§å°è¶…è¿‡é˜ˆå€¼ã€‚</p></blockquote><h4 id="1ã€å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£EdenåŒºåˆ†é…ã€‚"><a href="#1ã€å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£EdenåŒºåˆ†é…ã€‚" class="headerlink" title="1ã€å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£EdenåŒºåˆ†é…ã€‚"></a>1ã€å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£EdenåŒºåˆ†é…ã€‚</h4><p>å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´åˆ†é…æ—¶ï¼ŒJVMå‘èµ·ä¸€æ¬¡æ–°ç”Ÿä»£å›æ”¶Minor GCã€‚</p><p>HotSpotè™šæ‹Ÿæœºæ”¶é›†å™¨æ—¥å¿—å‚æ•°ï¼š<code>-XXï¼š+PrintGCDetails</code></p><blockquote><p>è¯¥å‚æ•°ä½¿JVMå‘ç”Ÿåƒåœ¾æ”¶é›†è¡Œä¸ºæ—¶æ‰“å°å†…å­˜å›æ”¶æ—¥å¿—ï¼Œå¹¶åœ¨è¿›ç¨‹é€€å‡ºæ—¶è¾“å‡ºå½“å‰çš„å†…å­˜å„ä¸ªåŒºåŸŸåˆ†é…æƒ…å†µã€‚åœ¨å®é™…çš„é—®é¢˜æ’æŸ¥ä¸­ï¼Œæ”¶é›†å™¨æ—¥å¿—å¸¸ä¼šæ‰“å°åˆ°æ–‡ä»¶åé€šè¿‡å·¥å…·è¿›è¡Œåˆ†æã€‚</p></blockquote><p><code>-XXï¼šSurvivor-Ratio=8</code></p><p>è®¾ç½®æ–°ç”Ÿä»£ä¸­EdenåŒºä¸ä¸€ä¸ªSurvivoråŒºçš„ç©ºé—´æ¯”ä¾‹æ˜¯8âˆ¶1</p><p>å¦‚æœæ–°ç”Ÿä»£å¤§å° -Xmn=10M,é‚£ä¹ˆEdenåŒºå¤§å°ä¸º8192Kï¼Œ2ä¸ªSurvivorå–å‡ä¸º1024Kï¼Œæ–°ç”Ÿä»£å®é™…æ€»å¯ç”¨ç©ºé—´8192K+1024K=9216KBã€‚</p><p><code>-verbose :gc</code>åœ¨è¾“å‡ºè®¾å¤‡ä¸Šæ˜¾ç¤ºè™šæ‹Ÿæœºè¿è¡ŒGCä¿¡æ¯ã€‚   </p><p>ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * VMå‚æ•°ï¼š-verbose:gc -Xms20M -Xmx20M -Xmn10M -XX:+PrintGCDetails -XX:SurvivorRatio=8 */</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testAllocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allocation1<span class="token punctuation">,</span> allocation2<span class="token punctuation">,</span> allocation3<span class="token punctuation">,</span> allocation4<span class="token punctuation">;</span>    allocation1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// å‡ºç°ä¸€æ¬¡Minor GC</span> <span class="token punctuation">}</span></code></pre><p>ç»“æœ</p><pre><code>[GC [DefNew: 6651K-&gt;148K(9216K), 0.0070106 secs] 6651K-&gt;6292K(19456K), 0.0070426 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]Heap    def new generation   total 9216K, used 4326K [0x029d0000, 0x033d0000, 0x033d0000)        eden space 8192K,  51% used [0x029d0000, 0x02de4828, 0x031d0000)        from space 1024K,  14% used [0x032d0000, 0x032f5370, 0x033d0000)        to   space 1024K,   0% used [0x031d0000, 0x031d0000, 0x032d0000)    tenured generation   total 10240K, used 6144K [0x033d0000, 0x03dd0000, 0x03dd0000)            the space 10240K,  60% used [0x033d0000, 0x039d0030, 0x039d0200, 0x03dd0000)    compacting perm gen  total 12288K, used 2114K [0x03dd0000, 0x049d0000, 0x07dd0000)            the space 12288K,  17% used [0x03dd0000, 0x03fe0998, 0x03fe0a00, 0x049d0000)No shared spaces configured.</code></pre><h4 id="2ã€å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£"><a href="#2ã€å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£" class="headerlink" title="2ã€å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£"></a>2ã€å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</h4><p>å¤§å¯¹è±¡å°±æ˜¯æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„Javaå¯¹è±¡ï¼Œæœ€å…¸å‹çš„å¤§å¯¹è±¡ä¾¿æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œæˆ–è€…å…ƒç´ æ•°é‡å¾ˆåºå¤§çš„æ•°ç»„æˆ–é›†åˆã€‚</p><p>å†™ç¨‹åºåº”è¯¥é¿å…å¤§å¯¹è±¡ï¼Œå› ä¸ºåˆ†é…ç©ºé—´æ—¶å®¹æ˜“å¯¼è‡´æ˜æ˜è¿˜æœ‰ç©ºé—´å´æå‰å‡ºå‘åƒåœ¾æ”¶é›†ï¼Œè·å–è¶³å¤Ÿçš„è¿ç»­ç©ºé—´æ¥åˆ†é…å¤§å¯¹è±¡ã€‚å¦å¤–å¤åˆ¶å¤§å¯¹è±¡ï¼Œä¹Ÿéœ€è¦å¤§é‡çš„å†…å­˜å¤åˆ¶å¼€é”€ã€‚</p><p><code>-XXï¼šPretenureSizeThreshold</code></p><p>è¯¥å‚æ•°ç”¨æ¥æŒ‡å®šå¤§äºè¯¥è®¾ç½®å€¼çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ã€‚è¯¥å‚æ•°åªå¯¹Serialå’ŒParNewä¸¤æ¬¾æ–°ç”Ÿä»£æ”¶é›†å™¨æœ‰æ•ˆ</p><blockquote><p>ç›®çš„å°±æ˜¯é¿å…åœ¨EdenåŒºåŠä¸¤ä¸ªSurvivoråŒºä¹‹é—´æ¥å›å¤åˆ¶ï¼Œäº§ç”Ÿå¤§é‡çš„å†…å­˜å¤åˆ¶æ“ä½œã€‚</p></blockquote><p>å¿…é¡»ä½¿ç”¨æ­¤å‚æ•°è¿›è¡Œè°ƒä¼˜ï¼Œå¯è€ƒè™‘ParNewåŠ CMSçš„æ”¶é›†å™¨ç»„åˆã€‚</p><p>ç¤ºä¾‹</p><pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * VMå‚æ•°ï¼š-verbose:gc -Xms20M -Xmx20M -Xmn10M -XX:+PrintGCDetails -XX:SurvivorRatio=8 * -XX:PretenureSizeThreshold=3145728 */</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testPretenureSizeThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allocation<span class="token punctuation">;</span>    allocation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ä¸­</span><span class="token punctuation">}</span></code></pre><p>æ‰§è¡Œç»“æœ</p><pre><code>Heap    def new generation   total 9216K, used 671K [0x029d0000, 0x033d0000, 0x033d0000)        eden space 8192K,   8% used [0x029d0000, 0x02a77e98, 0x031d0000)        from space 1024K,   0% used [0x031d0000, 0x031d0000, 0x032d0000)        to   space 1024K,   0% used [0x032d0000, 0x032d0000, 0x033d0000)    tenured generation   total 10240K, used 4096K [0x033d0000, 0x03dd0000, 0x03dd0000)            the space 10240K,  40% used [0x033d0000, 0x037d0010, 0x037d0200, 0x03dd0000)    compacting perm gen  total 12288K, used 2107K [0x03dd0000, 0x049d0000, 0x07dd0000)            the space 12288K,  17% used [0x03dd0000, 0x03fdefd0, 0x03fdf000, 0x049d0000)No shared spaces configured.</code></pre><h4 id="3ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£"><a href="#3ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£" class="headerlink" title="3ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£"></a>3ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£</h4><p>è™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡å¹´é¾„ï¼ˆAgeï¼‰è®¡æ•°å™¨ï¼Œå­˜å‚¨åœ¨å¯¹è±¡å¤´ä¸­ã€‚</p><blockquote><p>å¯¹è±¡é€šå¸¸åœ¨EdenåŒºé‡Œè¯ç”Ÿï¼Œå¦‚æœç»è¿‡ç¬¬ä¸€æ¬¡Minor GCåä»ç„¶å­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢«Survivorå®¹çº³çš„è¯ï¼Œè¯¥å¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°Survivorç©ºé—´ä¸­ï¼Œå¹¶ä¸”å°†å…¶å¯¹è±¡å¹´é¾„è®¾ä¸º1å²ã€‚å¯¹è±¡åœ¨SurvivoråŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡Minor GCï¼Œå¹´é¾„å°±å¢åŠ 1å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º15ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚</p></blockquote><p><code>-XXï¼šMaxTenuringThreshold</code>ï¼š</p><p>è¯¥å‚æ•°å¯ä»¥ç”¨æ¥è®¾ç½®å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ã€‚</p><p>ç¤ºä¾‹</p><pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * VMå‚æ•°ï¼š-verbose:gc -Xms20M -Xmx20M -Xmn10M -XX:+PrintGCDetails -XX:Survivor-   Ratio=8 -XX:MaxTenuringThreshold=1 * -XX:+PrintTenuringDistribution */</span><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unused"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testTenuringThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allocation1<span class="token punctuation">,</span> allocation2<span class="token punctuation">,</span> allocation3<span class="token punctuation">;</span>    allocation1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>_1MB <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// ä»€ä¹ˆæ—¶å€™è¿›å…¥è€å¹´ä»£å†³å®šäºXX:MaxTenuring-</span>                                                   Thresholdè®¾ç½®    allocation2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation3 <span class="token operator">=</span> null<span class="token punctuation">;</span>    allocation3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ä»¥-XXï¼šMaxTenuringThreshold=1å‚æ•°æ¥è¿è¡Œçš„ç»“æœï¼š</p><pre><code>[GC [DefNewDesired Survivor size 524288 bytes, new threshold 1 (max 1)- age   1:     414664 bytes,     414664 total: 4859K-&gt;404K(9216K), 0.0065012 secs] 4859K-&gt;4500K(19456K), 0.0065283 secs] [Times: user=0.02 sys=0.00, real=0.02 secs][GC [DefNewDesired Survivor size 524288 bytes, new threshold 1 (max 1): 4500K-&gt;0K(9216K), 0.0009253 secs] 8596K-&gt;4500K(19456K), 0.0009458 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]Heap    def new generation   total 9216K, used 4178K [0x029d0000, 0x033d0000, 0x033d0000)        eden space 8192K,  51% used [0x029d0000, 0x02de4828, 0x031d0000)        from space 1024K,   0% used [0x031d0000, 0x031d0000, 0x032d0000)        to   space 1024K,   0% used [0x032d0000, 0x032d0000, 0x033d0000)    tenured generation   total 10240K, used 4500K [0x033d0000, 0x03dd0000, 0x03dd0000)            the space 10240K,  43% used [0x033d0000, 0x03835348, 0x03835400, 0x03dd0000)    com\pacting perm gen  total 12288K, used 2114K [0x03dd0000, 0x049d0000, 0x07dd0000)            the space 12288K,  17% used [0x03dd0000, 0x03fe0998, 0x03fe0a00, 0x049d0000)No shared spaces configured.</code></pre><p>ä»¥-XXï¼šMaxTenuringThreshold=15å‚æ•°æ¥è¿è¡Œçš„ç»“æœï¼š</p><pre><code>[GC [DefNewDesired Survivor size 524288 bytes, new threshold 15 (max 15)- age   1:     414664 bytes,     414664 total: 4859K-&gt;404K(9216K), 0.0049637 secs] 4859K-&gt;4500K(19456K), 0.0049932 secs] [Times: user=0.00 sys=0.00, real=0.00 secs][GC [DefNewDesired Survivor size 524288 bytes, new threshold 15 (max 15)- age   2:     414520 bytes,     414520 total: 4500K-&gt;404K(9216K), 0.0008091 secs] 8596K-&gt;4500K(19456K), 0.0008305 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]Heap    def new generation   total 9216K, used 4582K [0x029d0000, 0x033d0000, 0x033d0000)        eden space 8192K,  51% used [0x029d0000, 0x02de4828, 0x031d0000)        from space 1024K,  39% used [0x031d0000, 0x03235338, 0x032d0000)        to   space 1024K,   0% used [0x032d0000, 0x032d0000, 0x033d0000)    tenured generation   total 10240K, used 4096K [0x033d0000, 0x03dd0000, 0x03dd0000)            the space 10240K,  40% used [0x033d0000, 0x037d0010, 0x037d0200, 0x03dd0000)    compacting perm gen  total 12288K, used 2114K [0x03dd0000, 0x049d0000, 0x07dd0000)            the space 12288K,  17% used [0x03dd0000, 0x03fe0998, 0x03fe0a00, 0x049d0000)No shared spaces configured.</code></pre><h4 id="4ã€åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­"><a href="#4ã€åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­" class="headerlink" title="4ã€åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­"></a>4ã€åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­</h4><p>HotSpotè™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œè¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ°-XXï¼šMaxTenuringThresholdæ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œå¦‚æœåœ¨Survivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— é¡»ç­‰åˆ°<code>-XXï¼šMaxTenuringThreshold</code>ä¸­è¦æ±‚çš„å¹´é¾„ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * VMå‚æ•°ï¼š-verbose:gc -Xms20M -Xmx20M -Xmn10M -XX:+PrintGCDetails -XX:SurvivorRatio=8   -XX:MaxTenuringThreshold=15 * -XX:+PrintTenuringDistribution */</span><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unused"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testTenuringThreshold2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allocation1<span class="token punctuation">,</span> allocation2<span class="token punctuation">,</span> allocation3<span class="token punctuation">,</span> allocation4<span class="token punctuation">;</span>    allocation1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>_1MB <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// allocation1+allocation2å¤§äºsurvivoç©ºé—´ä¸€åŠ</span>    allocation2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>_1MB <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation4 <span class="token operator">=</span> null<span class="token punctuation">;</span>    allocation4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œç»“æœï¼š</p><pre><code>[GC [DefNewDesired Survivor size 524288 bytes, new threshold 1 (max 15)- age   1:     676824 bytes,     676824 total: 5115K-&gt;660K(9216K), 0.0050136 secs] 5115K-&gt;4756K(19456K), 0.0050443 secs] [Times: user=0.00 sys=0.01, real=0.01 secs][GC [DefNewDesired Survivor size 524288 bytes, new threshold 15 (max 15): 4756K-&gt;0K(9216K), 0.0010571 secs] 8852K-&gt;4756K(19456K), 0.0011009 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]Heap    def new generation   total 9216K, used 4178K [0x029d0000, 0x033d0000, 0x033d0000)        eden space 8192K,  51% used [0x029d0000, 0x02de4828, 0x031d0000)        from space 1024K,   0% used [0x031d0000, 0x031d0000, 0x032d0000)        to   space 1024K,   0% used [0x032d0000, 0x032d0000, 0x033d0000)    tenured generation   total 10240K, used 4756K [0x033d0000, 0x03dd0000, 0x03dd0000)            the space 10240K,  46% used [0x033d0000, 0x038753e8, 0x03875400, 0x03dd0000)    compacting perm gen  total 12288K, used 2114K [0x03dd0000, 0x049d0000, 0x07dd0000)        the space 12288K,  17% used [0x03dd0000, 0x03fe09a0, 0x03fe0a00, 0x049d0000)No shared spaces configured.</code></pre><h4 id="5ã€ç©ºé—´åˆ†é…æ‹…ä¿"><a href="#5ã€ç©ºé—´åˆ†é…æ‹…ä¿" class="headerlink" title="5ã€ç©ºé—´åˆ†é…æ‹…ä¿"></a>5ã€ç©ºé—´åˆ†é…æ‹…ä¿</h4><p>åœ¨å‘ç”ŸMinor GCä¹‹å‰ï¼Œè™šæ‹Ÿæœºå¿…é¡»å…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœè¿™ä¸ªæ¡ä»¶æˆç«‹ï¼Œé‚£è¿™ä¸€æ¬¡Minor GCå¯ä»¥ç¡®ä¿æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸æˆç«‹ï¼Œåˆ™è™šæ‹Ÿæœºä¼šå…ˆæŸ¥çœ‹-XXï¼šHandlePromotionFailureå‚æ•°çš„è®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼ˆHandlePromotion Failureï¼‰ï¼›å¦‚æœå…è®¸ï¼Œé‚£ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•è¿›è¡Œä¸€æ¬¡Minor GCï¼Œå°½ç®¡è¿™æ¬¡Minor GCæ˜¯æœ‰é£é™©çš„ï¼›å¦‚æœå°äºï¼Œæˆ–è€…-XXï¼šHandlePromotionFailureè®¾ç½®ä¸å…è®¸å†’é™©ï¼Œé‚£è¿™æ—¶å°±è¦æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡Full GCã€‚</p><p>å…³äºâ€œå†’é™©â€çš„è§£é‡Šï¼š</p><blockquote><p>æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶æ”¶é›†ç®—æ³•ï¼Œä½†ä¸ºäº†å†…å­˜åˆ©ç”¨ç‡ï¼Œåªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªSurvivorç©ºé—´æ¥ä½œä¸ºè½®æ¢å¤‡ä»½ï¼Œå› æ­¤å½“å‡ºç°å¤§é‡å¯¹è±¡åœ¨Minor GCåä»ç„¶å­˜æ´»çš„æƒ…å†µâ€”â€”æœ€æç«¯çš„æƒ…å†µå°±æ˜¯å†…å­˜å›æ”¶åæ–°ç”Ÿä»£ä¸­æ‰€æœ‰å¯¹è±¡éƒ½å­˜æ´»ï¼Œéœ€è¦è€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ŒæŠŠSurvivoræ— æ³•å®¹çº³çš„å¯¹è±¡ç›´æ¥é€å…¥è€å¹´ä»£ï¼Œè¿™ä¸ç”Ÿæ´»ä¸­è´·æ¬¾æ‹…ä¿ç±»ä¼¼ã€‚è€å¹´ä»£è¦è¿›è¡Œè¿™æ ·çš„æ‹…ä¿ï¼Œå‰ææ˜¯è€å¹´ä»£æœ¬èº«è¿˜æœ‰å®¹çº³è¿™äº›å¯¹è±¡çš„å‰©ä½™ç©ºé—´ï¼Œä½†ä¸€å…±æœ‰å¤šå°‘å¯¹è±¡ä¼šåœ¨è¿™æ¬¡å›æ”¶ä¸­æ´»ä¸‹æ¥åœ¨å®é™…å®Œæˆå†…å­˜å›æ”¶ä¹‹å‰æ˜¯æ— æ³•æ˜ç¡®çŸ¥é“çš„ï¼Œæ‰€ä»¥åªèƒ½å–ä¹‹å‰æ¯ä¸€æ¬¡å›æ”¶æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡å®¹é‡çš„å¹³å‡å¤§å°ä½œä¸ºç»éªŒå€¼ï¼Œä¸è€å¹´ä»£çš„å‰©ä½™ç©ºé—´è¿›è¡Œæ¯”è¾ƒï¼Œå†³å®šæ˜¯å¦è¿›è¡ŒFull GCæ¥è®©è€å¹´ä»£è…¾å‡ºæ›´å¤šç©ºé—´ã€‚å–å†å²å¹³å‡å€¼æ¥æ¯”è¾ƒå…¶å®ä»ç„¶æ˜¯ä¸€ç§èµŒæ¦‚ç‡çš„è§£å†³åŠæ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å‡å¦‚æŸæ¬¡Minor GCå­˜æ´»åçš„å¯¹è±¡çªå¢ï¼Œè¿œè¿œé«˜äºå†å²å¹³å‡å€¼çš„è¯ï¼Œä¾ç„¶ä¼šå¯¼è‡´æ‹…ä¿å¤±è´¥ã€‚å¦‚æœå‡ºç°äº†æ‹…ä¿å¤±è´¥ï¼Œé‚£å°±åªå¥½è€è€å®å®åœ°é‡æ–°å‘èµ·ä¸€æ¬¡Full GCï¼Œè¿™æ ·åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚è™½ç„¶æ‹…ä¿å¤±è´¥æ—¶ç»•çš„åœˆå­æ˜¯æœ€å¤§çš„ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹éƒ½è¿˜æ˜¯ä¼šå°†-XXï¼šHandlePromotionFailureå¼€å…³æ‰“å¼€ï¼Œé¿å…Full GCè¿‡äºé¢‘ç¹ã€‚</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * VMå‚æ•°ï¼š-Xms20M -Xmx20M -Xmn10M -XX:+PrintGCDetails -XX:SurvivorRatio=8 -XX:-Handle-   PromotionFailure */</span><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unused"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testHandlePromotion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allocation1<span class="token punctuation">,</span> allocation2<span class="token punctuation">,</span> allocation3<span class="token punctuation">,</span> allocation4<span class="token punctuation">,</span> allocation5<span class="token punctuation">,</span> alloca<span class="token operator">-</span>tion6<span class="token punctuation">,</span> allocation7<span class="token punctuation">;</span>    allocation1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation1 <span class="token operator">=</span> null<span class="token punctuation">;</span>    allocation4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    allocation4 <span class="token operator">=</span> null<span class="token punctuation">;</span>    allocation5 <span class="token operator">=</span> null<span class="token punctuation">;</span>    allocation6 <span class="token operator">=</span> null<span class="token punctuation">;</span>    allocation7 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ä»¥-XXï¼šHandlePromotionFailure=falseå‚æ•°æ¥è¿è¡Œçš„ç»“æœï¼š</p><pre><code>[GC [DefNew: 6651K-&gt;148K(9216K), 0.0078936 secs] 6651K-&gt;4244K(19456K), 0.0079192 secs] [Times: user=0.00 sys=0.02, real=0.02 secs][GC [DefNew: 6378K-&gt;6378K(9216K), 0.0000206 secs][Tenured: 4096K-&gt;4244K(10240K), 0.0042901 secs] 10474K-&gt;4244K(19456K), [Perm : 2104K-&gt;2104K(12288K)], 0.0043613 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]</code></pre><p>ä»¥-XXï¼šHandlePromotionFailure=trueå‚æ•°æ¥è¿è¡Œçš„ç»“æœï¼š</p><pre><code>[GC [DefNew: 6651K-&gt;148K(9216K), 0.0054913 secs] 6651K-&gt;4244K(19456K), 0.0055327 secs] [Times: user=0.00 sys=0.00, real=0.00 secs][GC [DefNew: 6378K-&gt;148K(9216K), 0.0006584 secs] 10474K-&gt;4244K(19456K), 0.0006857 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]</code></pre><p><code>-XXï¼šHandlePromotionFailure</code>å‚æ•°åœ¨å®é™…è™šæ‹Ÿæœºä¸­å·²ç»ä¸ä¼šå†ä½¿ç”¨å®ƒã€‚JDK 6 Update 24ä¹‹åçš„è§„åˆ™å˜ä¸ºåªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äºæ–°ç”Ÿä»£å¯¹è±¡æ€»å¤§å°æˆ–è€…å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°ï¼Œå°±ä¼šè¿›è¡ŒMinor GCï¼Œå¦åˆ™å°†è¿›è¡ŒFull GCã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis(ä¸‰)åŠ¨æ€SQL</title>
      <link href="/posts/d467df29.html"/>
      <url>/posts/d467df29.html</url>
      
        <content type="html"><![CDATA[<h2 id="Mybatis-ä¸‰-åŠ¨æ€SQL"><a href="#Mybatis-ä¸‰-åŠ¨æ€SQL" class="headerlink" title="Mybatis(ä¸‰)åŠ¨æ€SQL"></a>Mybatis(ä¸‰)åŠ¨æ€SQL</h2><p>åŠ¨æ€ SQL æ˜¯ MyBatis çš„å¼ºå¤§ç‰¹æ€§ä¹‹ä¸€ã€‚ </p><h4 id="1ã€ä¸»è¦çš„åŠ¨æ€SQLå…ƒç´ "><a href="#1ã€ä¸»è¦çš„åŠ¨æ€SQLå…ƒç´ " class="headerlink" title="1ã€ä¸»è¦çš„åŠ¨æ€SQLå…ƒç´ "></a>1ã€ä¸»è¦çš„åŠ¨æ€SQLå…ƒç´ </h4><table><thead><tr><th>å…ƒç´ </th><th>ä½œç”¨</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>if</td><td>åˆ¤æ–­è¯­å¥</td><td>å•æ¡ä»¶åˆ†æ”¯åˆ¤æ–­</td></tr><tr><td>chooseï¼ˆwhenã€otherwiseï¼‰</td><td>é€‰æ‹©è¯­å¥ï¼Œç±»ä¼¼case whenè¯­å¥</td><td>å¤šæ¡ä»¶åˆ†æ”¯åˆ¤æ–­</td></tr><tr><td>trimï¼ˆwhereã€setï¼‰</td><td>è¾…åŠ©å…ƒç´ </td><td>å¤„ç†SQLæ‹¼è£…é—®é¢˜</td></tr><tr><td>foreach</td><td>å¾ªç¯æ§åˆ¶è¯­å¥</td><td>åœ¨inè¯­å¥ç­‰åˆ—ä¸¾æ¡ä»¶å·®ç”¨</td></tr></tbody></table><h4 id="2ã€if-å…ƒç´ "><a href="#2ã€if-å…ƒç´ " class="headerlink" title="2ã€if å…ƒç´ "></a>2ã€if å…ƒç´ </h4><p>ä½¿ç”¨åŠ¨æ€ SQL æœ€å¸¸è§æƒ…æ™¯æ˜¯æ ¹æ®æ¡ä»¶åŒ…å« where å­å¥çš„ä¸€éƒ¨åˆ†ã€‚è¿˜æ˜¯ä»¥ EmployeeMapper.xmlæ–‡ä»¶ä¸ºä¾‹ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.dao.emp.EmployeeMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKey<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select     emp_id as empId, emp_name as empName,email as email    from tbl_emp    where 1=1      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName !<span class="token punctuation">=</span> null  and empName!<span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      and emp_name like #{empName}      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre><p><code>test=&quot;empName != null  and empName!=&#39;&#39;</code>å¦‚æœä¸ä¼ å…¥ â€œempNameâ€ï¼Œé‚£ä¹ˆæ‰€æœ‰Employeeéƒ½ä¼šè¿”å›ï¼›å¦‚æœä¼ å…¥äº† â€œempNameâ€ å‚æ•°ä¸ä¸ºç©ºä¸”ä¸ç­‰äºç©ºå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹ â€œempNameâ€ ä¸€åˆ—è¿›è¡Œæ¨¡ç³ŠæŸ¥æ‰¾å¹¶è¿”å›å¯¹åº”çš„ç»“æœã€‚</p><p>testå±æ€§æ¯”è¾ƒå¸¸è§çš„æ˜¯åˆ¤ç©ºï¼Œå¦‚è¦åˆ¤å›ºå®šå€¼æˆ–å­—ç¬¦ä¸²ï¼Œåˆ™å¯ä»¥è¿™æ ·ï¼š</p><pre class=" language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>1<span class="token punctuation">'</span>  or sex <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">'</span>MALE<span class="token punctuation">'</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>     ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span></code></pre><p>ä½ ä»¥ä¸ºè¿™æ ·å°±å¯ä»¥äº†å—ï¼Ÿçœ‹ç€å¯ä»¥ï¼Œå®é™…æµ‹è¯•è¿‡ç¨‹ä¸­è¿˜æ˜¯ä¸è¡Œçš„ã€‚</p><p>éœ€è¦è¿™æ ·æ‰å¯ä»¥ï¼š</p><pre class=" language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>1<span class="token punctuation">'</span>.toString()  or sex <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">'</span>MALE<span class="token punctuation">'</span>.toString() <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>     ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span></code></pre><p>æˆ–è€…è¿™æ ·ï¼š</p><pre class=" language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span> sex <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">"</span>1<span class="token punctuation">"</span>  or sex <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">"</span>MALE<span class="token punctuation">"</span> <span class="token punctuation">'</span></span> <span class="token punctuation">></span></span>     ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span></code></pre><h4 id="2ã€choose-when-otherwiseå…ƒç´ "><a href="#2ã€choose-when-otherwiseå…ƒç´ " class="headerlink" title="2ã€choose-when-otherwiseå…ƒç´ "></a>2ã€choose-when-otherwiseå…ƒç´ </h4><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class=" language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKey<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select     emp_id as empId, emp_name as empName,email as email    from tbl_emp    where 1=1      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>choose</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId !<span class="token punctuation">=</span> null  and empId!<span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          and empId = #{empId}      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName !<span class="token punctuation">=</span> null  and empName!<span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          and emp_name like #{empName}      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>otherwise</span><span class="token punctuation">></span></span>          AND emp_name is not null        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>otherwise</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>choose</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>å½“ç¼–å·ä¸ä¸ºç©ºçš„æ—¶å€™ä½¿ç”¨ç¼–å·æŸ¥è¯¢ï¼Œå½“ç¼–å·ä¸ºç©ºï¼Œåç§°ä¸ä¸ºç©ºå°±ç”¨åç§°æŸ¥è¯¢ï¼Œå½“ç¼–å·å’Œåç§°éƒ½ä¸ºç©ºï¼Œå°±é»˜è®¤æŸ¥åç§°ä¸ä¸ºç©ºçš„Employeeçš„è®°å½•ã€‚</p><h4 id="3ã€trimã€whereã€set-å…ƒç´ "><a href="#3ã€trimã€whereã€set-å…ƒç´ " class="headerlink" title="3ã€trimã€whereã€set å…ƒç´ "></a>3ã€trimã€whereã€set å…ƒç´ </h4><p>ä¸Šé¢è¦å†™<code>where  1=1</code>è¿™ç§æ¡ä»¶ï¼Œä½¿ç”¨whereå…ƒç´ å°±å¯ä»¥å»æ‰è¿™ç§æ¡ä»¶ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKey<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select emp_id as empId, emp_name as empName,email as email    from tbl_emp    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>choose</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId !<span class="token punctuation">=</span> null  and empId!<span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            and empId = #{empId}          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName !<span class="token punctuation">=</span> null  and empName!<span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            and emp_name like #{empName}          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>otherwise</span><span class="token punctuation">></span></span>             AND emp_name is not null           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>otherwise</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>choose</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>ä½†æ˜¯é»˜è®¤æ¡ä»¶ä¸‹ æœ‰ä¸ª<code>where AND emp_name is not null</code>ä¼šå¤šå‡ºä¸€ä¸ª<code>and</code>ï¼Œé‚£ä¹ˆä½¿ç”¨trimå°±å¯ä»¥å»æ‰è¿™ä¸ªå¤šä½™çš„<code>and</code>ï¼Œå¦‚ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKey<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select emp_id as empId, emp_name as empName,email as email    from tbl_emp    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trim</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>where<span class="token punctuation">"</span></span>  <span class="token attr-name">prefixOverrides</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>choose</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId !<span class="token punctuation">=</span> null  and empId!<span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            and empId = #{empId}          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>when</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName !<span class="token punctuation">=</span> null  and empName!<span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            and emp_name like #{empName}          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>when</span><span class="token punctuation">></span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>otherwise</span><span class="token punctuation">></span></span>             AND emp_name is not null           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>otherwise</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>choose</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trim</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>trimå…ƒç´ è¡¨ç¤ºè¦å»æ‰ä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦ä¸²ã€‚prefixä»£è¡¨è¯­å¥å‰ç¼€ï¼ŒprefixOverridesä»£è¡¨çš„æ˜¯éœ€è¦å»æ‰çš„é‚£ç§å­—ç¬¦ä¸²ã€‚ä¸whereå†™æ³•ç­‰æ•ˆã€‚</p><p>Setå…ƒç´ ï¼šåŠ¨æ€åœ°åœ¨è¡Œé¦–æ’å…¥ SET å…³é”®å­—ï¼Œå¹¶ä¼šåˆ æ‰é¢å¤–çš„é€—å·ã€‚å¸¸å¸¸ç”¨äºä¸ç¡®å®šå­—æ®µæ›´æ–°ï¼Œå¯ä»¥åªæ›´æ–°éœ€è¦å˜åŠ¨çš„å­—æ®µè€Œä¸æ˜¯å…¨éƒ¨å­—æ®µã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>updateByExampleSelective<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    update tbl_emp    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>record.empId !<span class="token punctuation">=</span> null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        emp_id = #{record.empId,jdbcType=INTEGER},      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>record.empName !<span class="token punctuation">=</span> null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        emp_name = #{record.empName,jdbcType=VARCHAR},      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>record.sex !<span class="token punctuation">=</span> null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        sex = #{record.sex,jdbcType=CHAR},      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>record.email !<span class="token punctuation">=</span> null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        email = #{record.email,jdbcType=VARCHAR},      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>_parameter !<span class="token punctuation">=</span> null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Update_By_Example_Where_Clause<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨trimçš„å†™æ³•ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trim</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>set<span class="token punctuation">"</span></span>  <span class="token attr-name">prefixOverrides</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trim</span><span class="token punctuation">></span></span></code></pre><h4 id="4ã€foreach"><a href="#4ã€foreach" class="headerlink" title="4ã€foreach"></a>4ã€foreach</h4><p>foreachæ˜¯ä¸ªå¾ªç¯è¯­å¥ï¼Œç”¨äºå¯¹é›†åˆè¿›è¡Œéå†ã€‚</p><p>foreachå…è®¸æŒ‡å®šä¸€ä¸ªé›†åˆï¼Œå£°æ˜å¯ä»¥åœ¨å…ƒç´ ä½“å†…ä½¿ç”¨çš„é›†åˆé¡¹ï¼ˆitemï¼‰å’Œç´¢å¼•ï¼ˆindexï¼‰å˜é‡ã€‚å®ƒä¹Ÿå…è®¸ä½ æŒ‡å®šå¼€å¤´ä¸ç»“å°¾çš„å­—ç¬¦ä¸²ä»¥åŠé›†åˆé¡¹è¿­ä»£ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚ </p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKey<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select emp_id as empId, emp_name as empName,email as email    from tbl_emp    where emp_id in    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>idList<span class="token punctuation">"</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span>  <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>        #{item}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>å±æ€§è¯´æ˜ï¼š</p><p>collection é…ç½®çš„æ˜¯ä¼ è¿›æ¥çš„é›†åˆå‚æ•°åç§°ã€‚å¯ä»¥æ˜¯æ•°ç»„ã€Listã€Setã€Mapç­‰é›†åˆã€‚</p><p>item é…ç½®çš„æ˜¯å¾ªç¯ä¸­æœ¬æ¬¡è¿­ä»£çš„å½“æœŸå…ƒç´ ã€‚å¦‚æœæ˜¯Mapé›†åˆï¼Œitemæ˜¯Mapçš„å€¼valueã€‚</p><p>index é…ç½®çš„æ˜¯å½“å‰å…ƒç´ åœ¨é›†åˆçš„ä½ç½®ä¸‹æ ‡ã€‚å¦‚æœæ˜¯Mapé›†åˆï¼Œindexå°±æ˜¯é”®ï¼Œitemæ˜¯å€¼ã€‚</p><p>openå’Œclose é…ç½®ä»¥ä»€ä¹ˆç¬¦å·åŒ…è£…é›†åˆå…ƒç´ ã€‚</p><p>separator é…ç½®çš„æ˜¯å„ä¸ªå…ƒç´ çš„é—´éš”ç¬¦ã€‚</p><h4 id="5ã€bind-å…ƒç´ "><a href="#5ã€bind-å…ƒç´ " class="headerlink" title="5ã€bind å…ƒç´ "></a>5ã€bind å…ƒç´ </h4><p><code>bind</code> å…ƒç´ å…è®¸ä½ åœ¨ OGNL è¡¨è¾¾å¼ä»¥å¤–åˆ›å»ºä¸€ä¸ªå˜é‡ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°å½“å‰çš„ä¸Šä¸‹æ–‡ã€‚</p><p><strong>å®é™…åº”ç”¨åœºæ™¯1</strong></p><p>åœ¨å®é™…åº”ç”¨ä¸­likeæŸ¥è¯¢ï¼Œæ¯”å¦‚Mysqlæ•°æ®åº“ï¼Œä½¿ç”¨concatå°†å‚æ•°å’Œâ€%â€æ‹¼æ¥ã€‚ä½†æ˜¯Oracleå’ŒDB2æ•°æ®åº“è¿æ¥ç¬¦æ˜¯â€||â€ ï¼ŒSQLéœ€è¦æä¾›ä¸¤ç§æ–¹å¼å»å®ç°ã€‚bind å…ƒç´ å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ç§é—®é¢˜ã€‚æ¯”å¦‚ä»¥åˆšæ‰çš„æ¨¡ç³ŠæŸ¥è¯¢ä¸ºä¾‹ï¼š</p><pre class=" language-xml"><code class="language-xml">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKey<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bind</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pattern<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>%<span class="token punctuation">'</span> + empName + <span class="token punctuation">'</span>%<span class="token punctuation">'</span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    select     emp_id as empId, emp_name as empName,email as email    from tbl_emp    where  emp_name like #{pattern}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre><p>empNameå°±æ˜¯å®é™…ä¼ è¿‡æ¥çš„å‚æ•°ï¼Œä¸é€šé…ç¬¦â€œ%â€è¿æ¥ä¹‹åï¼Œèµ‹å€¼ç»™äº†patternï¼Œä¸‹é¢å°±å¯ä»¥ç›´æ¥ä½¿ç”¨patternå˜é‡ã€‚ç»‘å®šå¤šä¸ªåŒç†ï¼Œæ³¨æ„nameä¸è¦é‡å¤å³å¯ã€‚</p><p><strong>å®é™…åº”ç”¨åœºæ™¯2</strong></p><p>å¦‚æœé…ç½®äº† databaseIdProviderï¼Œå¯ä»¥åœ¨åŠ¨æ€ä»£ç ä¸­ä½¿ç”¨åä¸º â€œ_databaseIdâ€ çš„å˜é‡æ¥ä¸ºä¸åŒçš„æ•°æ®åº“æ„å»ºç‰¹å®šçš„è¯­å¥ã€‚æ¯”å¦‚ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>insert<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selectKey</span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BEFORE<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>_databaseId <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>oracle<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      select seq_users.nextval from dual    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>_databaseId <span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>db2<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      select nextval for seq_users from sysibm.sysdummy1"    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selectKey</span><span class="token punctuation">></span></span>  insert into tbl_emp values (#{id}, #{empName},#{sex},#{email})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></code></pre><h4 id="6ã€script"><a href="#6ã€script" class="headerlink" title="6ã€script"></a>6ã€script</h4><p>åœ¨å¸¦æ³¨è§£çš„æ˜ å°„å™¨æ¥å£ç±»ä¸­ä½¿ç”¨åŠ¨æ€ SQLï¼Œå¯ä»¥ä½¿ç”¨ scriptå…ƒç´ ã€‚ </p><pre><code>@Update({&quot;&lt;script&gt;&quot;,      &quot;update tbl_emp&quot;,      &quot;  &lt;set&gt;&quot;,      &quot;    &lt;if test=&#39;emp.empName != null&#39;&gt;emp_Name=#{emp.empName},&lt;/if&gt;&quot;,      &quot;    &lt;if test=&#39;emp.email != null&#39;&gt;email=#{emp.email},&lt;/if&gt;&quot;,      &quot;    &lt;if test=&#39;emp.sex != null&#39;&gt;sex=#{emp.sex}&lt;/if&gt;&quot;,      &quot;  &lt;/set&gt;&quot;,      &quot;where empId=#{empId}&quot;,      &quot;&lt;/script&gt;&quot;})    void updateEmployeeValues(Employee emp);</code></pre><h4 id="7ã€åŠ¨æ€-SQL-ä¸­çš„æ’å…¥è„šæœ¬è¯­è¨€"><a href="#7ã€åŠ¨æ€-SQL-ä¸­çš„æ’å…¥è„šæœ¬è¯­è¨€" class="headerlink" title="7ã€åŠ¨æ€ SQL ä¸­çš„æ’å…¥è„šæœ¬è¯­è¨€"></a>7ã€åŠ¨æ€ SQL ä¸­çš„æ’å…¥è„šæœ¬è¯­è¨€</h4><p>MyBatis ä» 3.2 ç‰ˆæœ¬å¼€å§‹æ”¯æŒæ’å…¥è„šæœ¬è¯­è¨€ï¼Œè¿™å…è®¸ä½ æ’å…¥ä¸€ç§è¯­è¨€é©±åŠ¨ï¼Œå¹¶åŸºäºè¿™ç§è¯­è¨€æ¥ç¼–å†™åŠ¨æ€ SQL æŸ¥è¯¢è¯­å¥ã€‚ </p><p>è¿™ç§æƒ…å†µç›®å‰æ²¡æœ‰é‡åˆ°ï¼Œå¦‚æœ‰éœ€è¦å‚è€ƒ<a href="https://mybatis.org/mybatis-3/zh/dynamic-sql.html" target="_blank" rel="noopener">Mybatiså®˜ç½‘</a>è¯´æ˜ã€‚</p><br/><p><strong>ç›¸å…³æ–‡ç« ï¼š</strong></p><table><thead><tr><th>æ–‡ç« åç§°</th></tr></thead><tbody><tr><td><a href="b802139a.html">ã€ŠMybatis(ä¸€)ä¸»è¦ç»„ä»¶ã€‹</a></td></tr><tr><td><a href="5d11555a.html">ã€ŠMybatis(äºŒ)é…ç½®ã€‹</a></td></tr><tr><td><a href="d467df29.html">ã€ŠMybatis(ä¸‰)åŠ¨æ€SQLã€‹</a></td></tr><tr><td><a href="3bfa75b5.html">ã€ŠMybtis(å››)å·¥ä½œåŸç†ã€‹</a></td></tr><tr><td><a href="ae8510ea.html">ã€ŠMybtis(äº”)Mapperæ˜ å°„å™¨ã€‹</a></td></tr><tr><td><a href="44c4c800.html">ã€ŠMybtis(å…­)Mapperçº§è”ã€‹</a></td></tr></tbody></table><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> Mybatis </tag>
            
            <tag> ç›‘æ§è°ƒä¼˜å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis(äºŒ)é…ç½®</title>
      <link href="/posts/5d11555a.html"/>
      <url>/posts/5d11555a.html</url>
      
        <content type="html"><![CDATA[<h3 id="Mybatis-äºŒ-é…ç½®"><a href="#Mybatis-äºŒ-é…ç½®" class="headerlink" title="Mybatis(äºŒ)é…ç½®"></a>Mybatis(äºŒ)é…ç½®</h3><blockquote><p>å…³äºMybatisé…ç½®ï¼Œå…¶å®å®˜ç½‘éƒ½æœ‰ï¼Œæœ¬æ–‡æ˜¯å­¦ä¹ ã€Šæ·±å…¥æµ…å‡ºMybatisæŠ€æœ¯åŸç†ä¸å®æˆ˜ã€‹çš„ç¬”è®°ï¼ŒåŒæ—¶å‚è€ƒå®˜ç½‘ç›¸å…³è¯´æ˜ï¼Œè¿›è¡Œé˜…è¯»æ•´ç†ã€‚</p></blockquote><h3 id="ä¸€ã€é…ç½®configuration"><a href="#ä¸€ã€é…ç½®configuration" class="headerlink" title="ä¸€ã€é…ç½®configuration"></a>ä¸€ã€é…ç½®configuration</h3><p>1ã€MyBatis çš„é…ç½®æ–‡ä»¶å±‚çº§ç»“æ„ã€‚</p><pre class=" language-XML"><code class="language-XML">configurationï¼ˆé…ç½®ï¼‰    propertiesï¼ˆå±æ€§ï¼‰    settingsï¼ˆè®¾ç½®ï¼‰    typeAliasesï¼ˆç±»å‹åˆ«åï¼‰    typeHandlersï¼ˆç±»å‹å¤„ç†å™¨ï¼‰    objectFactoryï¼ˆå¯¹è±¡å·¥å‚ï¼‰    pluginsï¼ˆæ’ä»¶ï¼‰    environmentsï¼ˆç¯å¢ƒé…ç½®ï¼‰        environmentï¼ˆç¯å¢ƒå˜é‡ï¼‰            transactionManagerï¼ˆäº‹åŠ¡ç®¡ç†å™¨ï¼‰            dataSourceï¼ˆæ•°æ®æºï¼‰    databaseIdProviderï¼ˆæ•°æ®åº“å‚å•†æ ‡è¯†ï¼‰    mappersï¼ˆæ˜ å°„å™¨ï¼‰</code></pre><p> è¯´æ˜ï¼šå±‚æ¬¡ç»“æ„ä¸èƒ½éšæ„é¢ å€’é¡ºåºã€‚</p><h3 id="äºŒã€å±æ€§-properties"><a href="#äºŒã€å±æ€§-properties" class="headerlink" title="äºŒã€å±æ€§ properties"></a>äºŒã€å±æ€§ properties</h3><p>propertiesæ˜¯é…ç½®å±æ€§çš„å…ƒç´ ã€‚</p><p>ä¸»è¦é…ç½®æ–¹å¼æœ‰3ç§ï¼š</p><p>ï¼ˆ1ï¼‰ç›´æ¥é…ç½®propertieså­å…ƒç´ ã€‚</p><p>ï¼ˆ2ï¼‰ä½¿ç”¨propertiesé…ç½®æ–‡ä»¶ã€‚</p><p>ï¼ˆ3ï¼‰ç¨‹åºå‚æ•°ä¼ é€’ã€‚</p><h4 id="1ã€é…ç½®propertieså­å…ƒç´ "><a href="#1ã€é…ç½®propertieså­å…ƒç´ " class="headerlink" title="1ã€é…ç½®propertieså­å…ƒç´ "></a>1ã€é…ç½®propertieså­å…ƒç´ </h4><p>åœ¨å…¸å‹çš„ Java å±æ€§æ–‡ä»¶ä¸­é…ç½®è¿™äº›å±æ€§ :</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${driver}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${url}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${username}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${password}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span></code></pre><p>ä» MyBatis 3.4.2 å¼€å§‹ï¼Œä¹Ÿå¯ä»¥ä¸ºå ä½ç¬¦æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ã€‚ å¦‚ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>   <span class="token comment" spellcheck="true">&lt;!-- ... å…¶ä»–çœç•¥--></span>   <span class="token comment" spellcheck="true">&lt;!-- å¦‚æœå±æ€§ 'username' æ²¡æœ‰è¢«é…ç½®ï¼Œ'username' å±æ€§çš„å€¼å°†ä¸º 'ut_user' --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${username:ut_user}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span></code></pre><p>è¿™ä¸ªç‰¹æ€§é»˜è®¤æ˜¯å…³é—­çš„ã€‚è¦å¯ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªç‰¹å®šçš„å±æ€§æ¥å¼€å¯è¿™ä¸ªç‰¹æ€§ã€‚ä¾‹å¦‚ï¼š         </p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org/mybatis/example/config.properties<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- ... --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.ibatis.parsing.PropertyParser.enable-default-value<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">&lt;!-- è¡¨ç¤ºå¯ç”¨é»˜è®¤å€¼ç‰¹æ€§ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span></code></pre><p>å¦‚æœä½ åœ¨å±æ€§åä¸­ä½¿ç”¨äº† <code>&quot;:&quot;</code> å­—ç¬¦ï¼ˆå¦‚ï¼š<code>db:username</code>ï¼‰ï¼Œæˆ–è€…åœ¨ SQLæ˜ å°„ä¸­ä½¿ç”¨äº† OGNL è¡¨è¾¾å¼çš„ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆå¦‚ï¼š <code>${tableName != null ? tableName : &#39;global_constants&#39;}</code>ï¼‰ï¼Œå°±éœ€è¦è®¾ç½®ç‰¹å®šçš„å±æ€§æ¥ä¿®æ”¹åˆ†éš”å±æ€§åå’Œé»˜è®¤å€¼çš„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼š         </p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org/mybatis/example/config.properties<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- ... --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.ibatis.parsing.PropertyParser.default-value-separator<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>?:<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">&lt;!-- ä¿®æ”¹é»˜è®¤å€¼çš„åˆ†éš”ç¬¦ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment" spellcheck="true">&lt;!-- ... --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${db:username?:ut_user}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span></code></pre><h4 id="2ã€ä½¿ç”¨propertiesé…ç½®æ–‡ä»¶"><a href="#2ã€ä½¿ç”¨propertiesé…ç½®æ–‡ä»¶" class="headerlink" title="2ã€ä½¿ç”¨propertiesé…ç½®æ–‡ä»¶"></a>2ã€ä½¿ç”¨propertiesé…ç½®æ–‡ä»¶</h4><p>dbconfig.properties</p><pre class=" language-properties"><code class="language-properties"><span class="token attr-name">validationQuery.sqlserver</span><span class="token punctuation">=</span><span class="token attr-value">SELECT 1</span><span class="token attr-name">jdbc.driver</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span><span class="token attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/ssm?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8</span><span class="token attr-name">jdbc.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span><span class="token attr-name">jdbc.dbType</span><span class="token punctuation">=</span><span class="token attr-value">mysql</span></code></pre><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å¼•å…¥</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resouce</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dbconfig.properties<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><h4 id="3ã€ç¨‹åºå‚æ•°ä¼ å…¥"><a href="#3ã€ç¨‹åºå‚æ•°ä¼ å…¥" class="headerlink" title="3ã€ç¨‹åºå‚æ•°ä¼ å…¥"></a>3ã€ç¨‹åºå‚æ•°ä¼ å…¥</h4><p>å¦‚ç”¨æˆ·åå¯†ç åŠ å¯†ï¼Œéœ€è¦è§£å¯†æ—¶ï¼Œåœ¨ SqlSessionFactoryBuilder.build() æ–¹æ³•ä¸­ä¼ å…¥å±æ€§å€¼ã€‚ </p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStreamReader<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Reader<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Properties<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Resources<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSession<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSessionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSessionFactoryBuilder<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xmlbeans<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Base64<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>propertyeditors<span class="token punctuation">.</span>InputStreamEditor<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Base64Decoder<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PropertiesTest</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String ClASS_LOCK <span class="token operator">=</span> <span class="token string">"_lock_"</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> SqlSessionFactory sqlSessionFactory<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>         InputStream cfgStream <span class="token operator">=</span> null<span class="token punctuation">;</span>         Reader cfgReader <span class="token operator">=</span> null <span class="token punctuation">;</span>         InputStream proStream <span class="token operator">=</span> null<span class="token punctuation">;</span>         Reader proReader <span class="token operator">=</span> null<span class="token punctuation">;</span>         Properties properties <span class="token operator">=</span> null<span class="token punctuation">;</span>         <span class="token keyword">try</span> <span class="token punctuation">{</span>             <span class="token comment" spellcheck="true">//è¯»å…¥é…ç½®æ–‡ä»¶æµ</span>             cfgStream <span class="token operator">=</span> Resources<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"mybatis-config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             cfgReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>cfgStream<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//è¯»å–é…ç½®æ–‡ä»¶</span>             proStream <span class="token operator">=</span> Resources<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"dbconfig.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             proReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>proStream<span class="token punctuation">)</span><span class="token punctuation">;</span>             properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>proStream<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">//è§£å¯†</span>             properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span>Base64<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span>Base64<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// TODO: handle exception</span>        <span class="token punctuation">}</span>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>ClASS_LOCK<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>sqlSessionFactory <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>                sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>cfgReader<span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="4ã€é…ç½®propertiesçš„ä¼˜å…ˆçº§"><a href="#4ã€é…ç½®propertiesçš„ä¼˜å…ˆçº§" class="headerlink" title="4ã€é…ç½®propertiesçš„ä¼˜å…ˆçº§"></a>4ã€é…ç½®propertiesçš„ä¼˜å…ˆçº§</h4><p>MyBatis å°†æŒ‰ç…§ä¸‹é¢çš„é¡ºåºæ¥åŠ è½½ï¼š </p><p>ï¼ˆ1ï¼‰åœ¨propertieså…ƒç´ ä½“å†…çš„æŒ‡å®šçš„å±æ€§ä¼˜å…ˆè¯»å–ã€‚</p><p>ï¼ˆ2ï¼‰æ ¹æ®propertiesçš„resouceå±æ€§è¯»å–ç±»è·¯å¾„ä¸‹çš„å±æ€§æ–‡ä»¶ï¼Œæˆ–è€…urlå±æ€§æŒ‡å®šçš„è·¯å¾„è¯»å–å±æ€§æ–‡ä»¶ï¼Œå¹¶è¦†ç›–å·²è¯»å–çš„åŒåå±æ€§ã€‚</p><p>ï¼ˆ3ï¼‰è¯»å–ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’çš„å±æ€§ï¼Œå¹¶è¦†ç›–å·²è¯»å–çš„åŒåå±æ€§ã€‚</p><p>å› æ­¤ï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°åº•ä¾æ¬¡ä¸ºï¼š</p><pre><code>æ–¹æ³•å‚æ•°ä¼ é€’å±æ€§ &gt;  resource/urlæŒ‡å®šé…ç½®æ–‡ä»¶ &gt; propertieså±æ€§ä¸­æŒ‡å®šçš„å±æ€§</code></pre><p>å®é™…ä½¿ç”¨æ—¶éœ€æ³¨æ„ï¼š</p><p>ï¼ˆAï¼‰å°½å¯èƒ½ä¸è¦ä½¿ç”¨æ··åˆæ–¹å¼</p><p>ï¼ˆBï¼‰é¦–é€‰æ–¹å¼properties</p><p>ï¼ˆBï¼‰è¿›è¡ŒåŠ å¯†æˆ–å…¶ä»–åŠ å·¥æ—¶å‚è€ƒç¤ºä¾‹ï¼Œä»Šå¤©ä½¿ç”¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚</p><h3 id="ä¸‰ã€è®¾ç½®setting"><a href="#ä¸‰ã€è®¾ç½®setting" class="headerlink" title="ä¸‰ã€è®¾ç½®setting"></a>ä¸‰ã€è®¾ç½®setting</h3><p>ä¸€ä¸ªé…ç½®å®Œæ•´çš„ settings å…ƒç´ çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š </p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cacheEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lazyLoadingEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipleResultSetsEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>useColumnLabel<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>useGeneratedKeys<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>autoMappingBehavior<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>PARTIAL<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>autoMappingUnknownColumnBehavior<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>WARNING<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>defaultExecutorType<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>SIMPLE<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>defaultStatementTimeout<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>25<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>defaultFetchSize<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>safeRowBoundsEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mapUnderscoreToCamelCase<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>localCacheScope<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>SESSION<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jdbcTypeForNull<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>OTHER<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lazyLoadTriggerMethods<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>equals,clone,hashCode,toString<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span></code></pre><p>å¤§éƒ¨åˆ†æ—¶å€™ä¸éœ€è¦é…å…¨ï¼Œå¦‚éœ€é…ç½®å‚è€ƒ<a href="https://mybatis.org/mybatis-3/zh/configuration.html" target="_blank" rel="noopener">Mybatiså®˜ç½‘-è®¾ç½®è¯´æ˜</a>å‚æ•°è¯´æ˜ã€‚</p><h3 id="å››ã€ç±»å‹åˆ«å-typeAliases"><a href="#å››ã€ç±»å‹åˆ«å-typeAliases" class="headerlink" title="å››ã€ç±»å‹åˆ«å typeAliases"></a>å››ã€ç±»å‹åˆ«å typeAliases</h3><p><strong>typeAliasesä¸»è¦åˆ†ä¸¤ç±»</strong>ï¼š</p><p>ï¼ˆAï¼‰ç³»ç»Ÿå®šä¹‰åˆ«åtypeAliases</p><p>ï¼ˆBï¼‰è‡ªå®šä¹‰åˆ«åtypeAliases</p><h4 id="1ã€ç³»ç»Ÿå®šä¹‰åˆ«å"><a href="#1ã€ç³»ç»Ÿå®šä¹‰åˆ«å" class="headerlink" title="1ã€ç³»ç»Ÿå®šä¹‰åˆ«å"></a>1ã€ç³»ç»Ÿå®šä¹‰åˆ«å</h4><p>ç³»ç»Ÿå®šä¹‰çš„åˆ«åï¼Œå¯ä»¥æŸ¥çœ‹Mybatisæºç ï¼Œ<code>org.apache.ibatis.type.TypeAliasRegistry</code>ç±»ä¸­å®šä¹‰ã€‚éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>package org.apache.ibatis.type;import java.util.*ï¼›import org.apache.ibatis.io.ResolverUtil;import org.apache.ibatis.io.Resources;public class TypeAliasRegistry {  private final Map&lt;String, Class&lt;?&gt;&gt; TYPE_ALIASES = new HashMap&lt;String, Class&lt;?&gt;&gt;();  public TypeAliasRegistry() {    registerAlias(&quot;string&quot;, String.class);    registerAlias(&quot;byte&quot;, Byte.class);    registerAlias(&quot;long&quot;, Long.class);    registerAlias(&quot;short&quot;, Short.class);    registerAlias(&quot;int&quot;, Integer.class);    registerAlias(&quot;integer&quot;, Integer.class);    registerAlias(&quot;double&quot;, Double.class);    registerAlias(&quot;float&quot;, Float.class);    registerAlias(&quot;boolean&quot;, Boolean.class);    //....å…¶ä»–çœç•¥   }}</code></pre><h4 id="2ã€è‡ªå®šä¹‰åˆ«å"><a href="#2ã€è‡ªå®šä¹‰åˆ«å" class="headerlink" title="2ã€è‡ªå®šä¹‰åˆ«å"></a>2ã€è‡ªå®šä¹‰åˆ«å</h4><p>ç±»å‹åˆ«åå¯ä¸º Java ç±»å‹è®¾ç½®ä¸€ä¸ªç¼©å†™åå­—ã€‚å®ƒä»…ç”¨äº XML é…ç½®ï¼Œæ„åœ¨é™ä½å†—ä½™çš„å…¨é™å®šç±»åä¹¦å†™ã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Author<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>domain.blog.Author<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Blog<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>domain.blog.Blog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Comment<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>domain.blog.Comment<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>domain.blog.Post<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Section<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>domain.blog.Section<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Tag<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>domain.blog.Tag<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span></code></pre><p>å¦‚æœä½ çš„POJOéå¸¸å¤šï¼Œè¿˜å¯ä»¥è¿™æ ·é…ç½®ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>domain.blog<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span></code></pre><p>æ¯ä¸€ä¸ªåœ¨åŒ… <code>domain.blog</code> ä¸­çš„ Java Beanï¼Œåœ¨æ²¡æœ‰æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ Bean çš„é¦–å­—æ¯å°å†™çš„éé™å®šç±»åæ¥ä½œä¸ºå®ƒçš„åˆ«åã€‚ æ¯”å¦‚ <code>domain.blog.Author</code> çš„åˆ«åä¸º <code>author</code>ã€‚é‚£æœ‰æ³¨è§£çš„è¯ï¼ŒæŒ‰æ³¨è§£åˆ«åä½¿ç”¨ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Alias</span><span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Author</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//some code çœç•¥</span><span class="token punctuation">}</span></code></pre><h3 id="äº”ã€ç±»å‹å¤„ç†å™¨-typeHandler"><a href="#äº”ã€ç±»å‹å¤„ç†å™¨-typeHandler" class="headerlink" title="äº”ã€ç±»å‹å¤„ç†å™¨ typeHandler"></a>äº”ã€ç±»å‹å¤„ç†å™¨ typeHandler</h3><blockquote><p>Mybatisåœ¨é¢„å¤„ç†è¯­å¥ï¼ˆPreparedStatementï¼‰ä¸­è®¾ç½®ä¸€ä¸ªå‚æ•°ï¼Œæˆ–è€…ä»ç»“æœé›†ï¼ˆResultSetï¼‰ä¸­å–å‡ºä¸€ä¸ªå€¼æ—¶ï¼Œéƒ½ä¼šä½¿ç”¨æ³¨å†Œè¿‡çš„typeHandlerè¿›è¡Œå¤„ç†ã€‚</p></blockquote><p>æ•°æ®åº“ä¸åŒï¼Œè®¾ç½®å‚æ•°å¯èƒ½ä¸åŒï¼Œæ•°æ®åº“ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼ŒtypeHandlerå¯ä»¥è‡ªå®šä¹‰è®¾ç½®Javaä¼ é€’åˆ°æ•°æ®åº“çš„å‚æ•°ï¼Œæˆ–ä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œéƒ½å¯ä»¥åœ¨è‡ªå®šä¹‰typeHandlerä¸­å¤„ç†ã€‚ç‰¹åˆ«æ˜¯æšä¸¾ç±»å‹éœ€è¦ä½¿ç”¨typeHandlerè¿›è¡Œè½¬æ¢ã€‚</p><p>typeHandlerå¸¸ç”¨çš„é…ç½®ä¸ºJavaç±»å‹ï¼ˆjavaTypeï¼‰ã€JDBCç±»å‹ï¼ˆjdbcTypeï¼‰ã€‚ä¸»è¦æ•°æ®åº“çš„Javaç±»å‹å’ŒJDBCç±»å‹å¯¹åº”å…³ç³»ï¼Œå¯ä»¥å‚è€ƒ<a href="dc390855.html">ã€Šå¸¸è§æ•°æ®åº“å­—æ®µçš„Javaç±»å‹å’ŒJDBCç±»å‹å¯¹åº”å…³ç³»ã€‹</a></p><blockquote><p>ä» 3.4.5 å¼€å§‹ï¼ŒMyBatis é»˜è®¤æ”¯æŒ JSR-310ï¼ˆæ—¥æœŸå’Œæ—¶é—´ APIï¼‰ </p></blockquote><p><strong>typeHandlerä¸»è¦åˆ†ä¸¤ç±»</strong>ï¼š</p><p>ï¼ˆAï¼‰ç³»ç»Ÿå®šä¹‰typeHandler</p><p>ï¼ˆBï¼‰è‡ªå®šä¹‰çš„typeHandler</p><h4 id="1ã€ç³»ç»Ÿå®šä¹‰ç±»å‹å¤„ç†å™¨"><a href="#1ã€ç³»ç»Ÿå®šä¹‰ç±»å‹å¤„ç†å™¨" class="headerlink" title="1ã€ç³»ç»Ÿå®šä¹‰ç±»å‹å¤„ç†å™¨"></a>1ã€ç³»ç»Ÿå®šä¹‰ç±»å‹å¤„ç†å™¨</h4><p>Mybatisç³»ç»Ÿå†…å®šä¹‰äº†ä¸€ç³»åˆ—çš„ç±»å‹å¤„ç†å™¨ï¼Œå¯ä»¥æŸ¥çœ‹Mybatisæºç ï¼Œ<code>org.apache.ibatis.type.TypeHandlerRegistry</code>ç±»ä¸­å®šä¹‰ã€‚éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">TypeHandlerRegistry</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">// some code</span>     <span class="token keyword">public</span> <span class="token function">TypeHandlerRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">register</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BooleanTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">boolean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BooleanTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">register</span><span class="token punctuation">(</span>JdbcType<span class="token punctuation">.</span>BOOLEAN<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BooleanTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">register</span><span class="token punctuation">(</span>JdbcType<span class="token punctuation">.</span>BIT<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BooleanTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// some code</span>        <span class="token function">register</span><span class="token punctuation">(</span>Integer<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IntegerTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IntegerTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">register</span><span class="token punctuation">(</span>JdbcType<span class="token punctuation">.</span>INTEGER<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IntegerTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// some code</span>     <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ¯”å¦‚æºç ä¸­StringTypeHandlerå¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼š</p><pre class=" language-java"><code class="language-java"> <span class="token keyword">package</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>type<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>CallableStatement<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>PreparedStatement<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>ResultSet<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>SQLException<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * @author Clinton Begin */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringTypeHandler</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTypeHandler</span><span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//å¯¹PreparedStatementè®¾ç½®å‚æ•°</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNonNullParameter</span><span class="token punctuation">(</span>PreparedStatement ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> String parameter<span class="token punctuation">,</span> JdbcType jdbcType<span class="token punctuation">)</span>      <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    ps<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">//ResultSetä½¿ç”¨ä¸‹è¡¨columnNameæ¥è·å–ç»“æœæ•°æ® </span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> String <span class="token function">getNullableResult</span><span class="token punctuation">(</span>ResultSet rs<span class="token punctuation">,</span> String columnName<span class="token punctuation">)</span>      <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    <span class="token keyword">return</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>columnName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//ResultSetä½¿ç”¨ä¸‹è¡¨columnIndexæ¥è·å–ç»“æœæ•°æ®</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> String <span class="token function">getNullableResult</span><span class="token punctuation">(</span>ResultSet rs<span class="token punctuation">,</span> <span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span>      <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    <span class="token keyword">return</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//CallableStatementå­˜å‚¨è¿‡ç¨‹è·å–ç»“æœåŠæ•°æ®</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> String <span class="token function">getNullableResult</span><span class="token punctuation">(</span>CallableStatement cs<span class="token punctuation">,</span> <span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span>      <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    <span class="token keyword">return</span> cs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>StringTypeHandlerç»§æ‰¿äº†BaseTypeHandlerã€‚BaseTypeHandlerå®ç°äº†æ¥å£typeHandlerï¼Œå¹¶ä¸”è‡ªå·±å®šä¹‰äº†4ä¸ªæŠ½è±¡æ–¹æ³•ï¼ŒStringTypeHandleréœ€è¦å®ç°å…¶å®šä¹‰çš„4ä¸ªæŠ½è±¡æ–¹æ³•ã€‚@Overrideæ³¨è§£å·²ç»æ³¨æ˜ã€‚</p><p>æ›´å¤šæœ‰å…³Mybatisç³»ç»Ÿæ³¨å†Œçš„typeHandleræ›´å¤šè¯´æ˜å‚è€ƒ<a href="https://mybatis.org/mybatis-3/zh/configuration.html" target="_blank" rel="noopener">Mybatiså®˜ç½‘</a>è¯´æ˜ã€‚</p><p>éœ€è¦æ³¨æ„ï¼š</p><p>ï¼ˆ1ï¼‰æ•°å€¼ç±»å‹çš„ç²¾åº¦ï¼Œæ•°æ®åº“intã€doubleã€decimalè¿™äº›ç±»å‹å’Œjavaçš„ç²¾åº¦ã€é•¿åº¦éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>ï¼ˆ2ï¼‰æ—¶é—´ç²¾åº¦ï¼Œå–æ•°æ®åˆ°æ—¥ç”¨DateOnlyTypeHandlerï¼Œç”¨åˆ°ç²¾åº¦ä¸ºç§’çš„ç”¨SqlTimestampTypeHandlerç­‰</p><h4 id="2ã€è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨"><a href="#2ã€è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨" class="headerlink" title="2ã€è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨"></a>2ã€è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨</h4><p>å¯ä»¥é‡å†™å·²æœ‰çš„ç±»å‹å¤„ç†å™¨æˆ–åˆ›å»ºä½ è‡ªå·±çš„ç±»å‹å¤„ç†å™¨æ¥å¤„ç†ä¸æ”¯æŒçš„æˆ–éæ ‡å‡†çš„ç±»å‹ã€‚</p><p> å…·ä½“åšæ³•ä¸ºï¼š</p><blockquote><p>å®ç°<code>org.apache.ibatis.type.TypeHandler</code>æ¥å£ï¼Œæˆ–ç»§æ‰¿ä¸€ä¸ªå¾ˆä¾¿åˆ©çš„ç±» <code>org.apache.ibatis.type.BaseTypeHandler</code>ï¼Œå¹¶ä¸”å¯ä»¥ï¼ˆå¯é€‰åœ°ï¼‰å°†å®ƒæ˜ å°„åˆ°ä¸€ä¸ª JDBC ç±»å‹ã€‚ </p></blockquote><p>å®šä¹‰ä¸€ä¸ªtypeHandlerï¼Œå¦‚ä½¿ç”¨ExampleTypeHandlerè¦†ç›–åŸæœ‰çš„StringTypeHandlerï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// ExampleTypeHandler.java</span><span class="token annotation punctuation">@MappedType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@MappedJdbcTypes</span><span class="token punctuation">(</span>JdbcType<span class="token punctuation">.</span>VARCHAR<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleTypeHandler</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTypeHandler</span><span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNonNullParameter</span><span class="token punctuation">(</span>PreparedStatement ps<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> String parameter<span class="token punctuation">,</span> JdbcType jdbcType<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"---ExampleTypeHandlerè®¾ç½®å‚æ•°----"</span><span class="token punctuation">)</span>    ps<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> String <span class="token function">getNullableResult</span><span class="token punctuation">(</span>ResultSet rs<span class="token punctuation">,</span> String columnName<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"---ExampleTypeHandler è·å–åˆ—åå­—ç¬¦ä¸²----"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>columnName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> String <span class="token function">getNullableResult</span><span class="token punctuation">(</span>ResultSet rs<span class="token punctuation">,</span> <span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"---ExampleTypeHandler è·å–åˆ—åå­—ç¬¦ä¸²----"</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@Override</span>  <span class="token keyword">public</span> String <span class="token function">getNullableResult</span><span class="token punctuation">(</span>CallableStatement cs<span class="token punctuation">,</span> <span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>     System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"---ExampleTypeHandler----"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> cs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>@MappedType - å®šä¹‰çš„æ˜¯JavaTypeç±»å‹ï¼Œå¯ä»¥æŒ‡å®šå“ªäº›Javaç±»å‹è¢«æ‹¦æˆªã€‚å¦‚æœä¸ç”¨æ³¨è§£ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»å‹å¤„ç†å™¨çš„é…ç½®å…ƒç´ ï¼ˆtypeHandler å…ƒç´ ï¼‰ä¸Šå¢åŠ ä¸€ä¸ª <code>javaType</code> å±æ€§ï¼ˆæ¯”å¦‚ï¼š<code>javaType=&quot;String&quot;</code>ï¼‰ ã€‚</p><p>@MappedJdbcTypes - å®šä¹‰çš„æ˜¯JdbcTypeç±»å‹ï¼Œå®ƒéœ€è¦æ»¡è¶³æšä¸¾ç±»org.apache.ibatis.type.JdbcTypeæ‰€åˆ—ä¸¾çš„ç±»å‹ã€‚å¦‚æœä¸ç”¨æ³¨è§£ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»å‹å¤„ç†å™¨çš„é…ç½®å…ƒç´ ä¸Šå¢åŠ ä¸€ä¸ª <code>jdbcType</code> å±æ€§ï¼ˆæ¯”å¦‚ï¼š<code>jdbcType=&quot;VARCHAR&quot;</code>ï¼‰ã€‚</p><p>é…ç½® mybatis-config.xmlä½¿ç”¨ExampleTypeHandlerï¼š</p><pre><code>&lt;!-- mybatis-config.xml --&gt;&lt;typeHandlers&gt;  &lt;typeHandler handler=&quot;org.mybatis.example.ExampleTypeHandler&quot; /&gt;&lt;/typeHandlers&gt;</code></pre><p>éœ€è¦æ³¨æ„ï¼šä½¿ç”¨ä¸Šè¿°çš„ç±»å‹å¤„ç†å™¨å°†ä¼šè¦†ç›–å·²æœ‰çš„å¤„ç† Java String ç±»å‹çš„å±æ€§ä»¥åŠ VARCHAR ç±»å‹çš„å‚æ•°å’Œç»“æœçš„ç±»å‹å¤„ç†å™¨ã€‚ </p><p>å¦‚æœæœ‰å¤šä¸ªç±»å‹è½¬æ¢å™¨ï¼Œå¯ä»¥ä½¿ç”¨æ‰«æå¼ï¼š</p><p>è®© MyBatis å¸®ä½ æŸ¥æ‰¾ç±»å‹å¤„ç†å™¨ï¼ˆExampleTypeHandleråœ¨åŒ…ï¼‰ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- mybatis-config.xml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeHandlers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.typehandle<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeHandlers</span><span class="token punctuation">></span></span></code></pre><p>åœ¨mybatis-config.xmlä¸­é…ç½®è¡¨ç¤ºå…¨å±€ä½¿ç”¨ã€‚å¦‚æœåªæƒ³ä½¿ç”¨åœ¨æŸä¸ªå­—æ®µä¸Šï¼Œå¯ä»¥è¿™æ ·ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.dao.emp.EmployeeMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">typeHandler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.ExampleTypeHandler<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>did<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    // some code çœç•¥<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span>    </code></pre><h4 id="3ã€æšä¸¾ç±»å‹å¤„ç†å™¨"><a href="#3ã€æšä¸¾ç±»å‹å¤„ç†å™¨" class="headerlink" title="3ã€æšä¸¾ç±»å‹å¤„ç†å™¨"></a>3ã€æšä¸¾ç±»å‹å¤„ç†å™¨</h4><p>Mybatisç³»ç»Ÿè‡ªå¸¦æšä¸¾ç±»å‹å¤„ç†å™¨ï¼š</p><p>ï¼ˆAï¼‰<code>org.apache.ibatis.type.EnumTypeHandler</code></p><p>ï¼ˆBï¼‰ <code>org.apache.ibatis.type.EnumOrdinalTypeHandler</code> </p><p>EnumTypeHandleræ˜¯ä½¿ç”¨æšä¸¾å­—ç¬¦ä¸²åç§°ä½œä¸ºå‚æ•°ä¼ é€’çš„ï¼ŒEnumOrdinalTypeHandleræ˜¯ä½¿ç”¨æ•´æ•°ä¸‹æ ‡ä½œä¸ºå‚æ•°ä¼ é€’çš„ã€‚æšä¸¾å’Œæ•°æ®åº“å­—å…¸ä¿æŒä¸€è‡´å°±å¯ä»¥ä½¿ç”¨ã€‚</p><p><strong>EnumOrdinalTypeHandlerçš„ä½¿ç”¨</strong>ï¼š</p><p>ä½¿ç”¨è‡ªå®šä¹‰æšä¸¾ç±»å‹ï¼Œæ¯”å¦‚æ€§åˆ«æšä¸¾ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>myenum<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">enum</span> Sex <span class="token punctuation">{</span>    <span class="token function">MALE</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"ç”·"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">FEMALE</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"å¥³"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> index<span class="token punctuation">;</span>    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token function">Sex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token function">Sex</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> index<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//getter setter method ...</span><span class="token punctuation">}</span></code></pre><p>å…¨å±€é…ç½®åŠ ä¸Šç±»å‹è½¬æ¢å™¨ä»¥è®©Mybatisè®¤è¯†æšä¸¾ç±»å‹ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- mybatis-config.xml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeHandlers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeHandler</span> <span class="token attr-name">handler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.ibatis.type.EnumOrdinalTypeHandler<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.myenum.Sex<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeHandlers</span><span class="token punctuation">></span></span></code></pre><p>æœ€ååœ¨éœ€è¦çš„å­—æ®µä¸ŠæŒ‡å®šå³å¯ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.dao.emp.EmployeeMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">typeHandler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.ibatis.type.EnumOrdinalTypeHandler<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">typeHandler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.ExampleTypeHandler<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>did<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    // some code çœç•¥<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span>    </code></pre><p>å½“è¿™æ ·é…ç½®æ—¶ï¼Œsexä¸ºæ•´æ•°å‹ï¼Œæ•°æ®åº“æ’å…¥çš„æ˜¯åºå·ï¼ˆä¸‹æ ‡ï¼‰å€¼ï¼Œ1æˆ–2ã€‚</p><p>è‡ªåŠ¨æ˜ å°„å™¨ï¼ˆauto-mapperï¼‰ä¼šè‡ªåŠ¨åœ°é€‰ç”¨ <code>EnumOrdinalTypeHandler</code> æ¥å¤„ç†æšä¸¾ç±»å‹ã€‚</p><p><strong>EnumTypeHandlerçš„ä½¿ç”¨</strong>ï¼š</p><p>EnumTypeHandlerä½¿ç”¨æšä¸¾åç§°å»å¤„ç†Javaæšä¸¾ç±»å‹ã€‚EnumTypeHandlerå¯¹åº”çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>å°†sexç±»å‹å˜ä¸ºVARCHARç±»å‹ï¼Œä¹‹å‰æ˜¯intç±»å‹ã€‚</p><p>åœ¨xmlæ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œåœ¨insertçš„æ—¶å€™éœ€è¦æ˜¾ç¤ºçš„æŒ‡æ˜è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.dao.emp.EmployeeMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">typeHandler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.typehandle.EnumTypeHandler<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">typeHandler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.ExampleTypeHandler<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>did<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    // some code çœç•¥    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>insert<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    insert into tbl_emp (emp_id, emp_name, sex,       email,dept_id)    values (#{empId,jdbcType=INTEGER}, #{empName,jdbcType=VARCHAR}, #{sex,typeHandler="com.ssm.web.typehandle.EnumTypeHandler"},       #{email,jdbcType=VARCHAR},#{did,jdbcType=INTEGER},)  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span> </code></pre><p>æ•°æ®åº“ä¸­sexåˆ—å†™å…¥çš„æ˜¯ MALEæˆ–FAMALEã€‚</p><p>è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ä½¿ç”¨ï¼š</p><p>å®šä¹‰è‡ªå·±çš„typeHandlerï¼Œæ¯”å¦‚SexEnumTypeHandlerç±»ï¼š</p><pre><code>package com.ssm.web.typehandle;import java.sql.CallableStatement;import java.sql.PreparedStatement;import java.sql.ResultSet;import java.sql.SQLException;import org.apache.ibatis.type.JdbcType;import org.apache.ibatis.type.TypeHandler;import com.ssm.web.myenum.Sex;public class SexEnumTypeHandler implements TypeHandler&lt;Sex&gt;{    @Override    public void setParameter(PreparedStatement ps, int i, Sex sex, JdbcType jdbcType) throws SQLException {        // TODO Auto-generated method stub        ps.setInt(i, sex.getIndex());    }    @Override    public Sex getResult(ResultSet rs, String columnName) throws SQLException {        // TODO Auto-generated method stub        int id = rs.getInt(columnName);        return Sex.getSext(id);    }    @Override    public Sex getResult(ResultSet rs, int columnIndex) throws SQLException {        int id = rs.getInt(columnIndex);        return Sex.getSext(id);    }    @Override    public Sex getResult(CallableStatement cs, int columnIndex) throws SQLException {        int id = cs.getInt(columnIndex);        return Sex.getSext(id);    }}</code></pre><p>æœ€åé…ç½®mybatis-config.xmlï¼ˆä¹Ÿå¯ä»¥ä¸é…ï¼Œåœ¨æŒ‡å®šå­—æ®µå¤„é…ç½®ï¼‰ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„ç±»å‹å¤„ç†å™¨SexEnumTypeHandleræ˜ å°„è‡ªå®šä¹‰æšä¸¾ç±»Sexï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- mybatis-config.xml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeHandlers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeHandler</span> <span class="token attr-name">handler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.typehandle.SexEnumTypeHandler<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.myenum.Sex<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeHandlers</span><span class="token punctuation">></span></span></code></pre><p>ä½¿ç”¨ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.dao.emp.EmployeeMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empId<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>emp_name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">typeHandler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.typehandle.SexEnumTypeHandler<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">typeHandler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.ExampleTypeHandler<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dept_id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>did<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    // some code çœç•¥    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>insert<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    insert into tbl_emp (emp_id, emp_name, sex,       email,dept_id)    values (#{empId,jdbcType=INTEGER}, #{empName,jdbcType=VARCHAR}, #{sex,typeHandler="com.ssm.web.typehandle.SexEnumTypeHandler"},       #{email,jdbcType=VARCHAR},#{did,jdbcType=INTEGER},)  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span> </code></pre><h3 id="å…­ã€å¯¹è±¡å·¥å‚objectFactory"><a href="#å…­ã€å¯¹è±¡å·¥å‚objectFactory" class="headerlink" title="å…­ã€å¯¹è±¡å·¥å‚objectFactory"></a>å…­ã€å¯¹è±¡å·¥å‚objectFactory</h3><p>æ¯æ¬¡ MyBatis åˆ›å»ºç»“æœå¯¹è±¡çš„æ–°å®ä¾‹æ—¶ï¼Œå®ƒéƒ½ä¼šä½¿ç”¨ä¸€ä¸ªå¯¹è±¡å·¥å‚ï¼ˆObjectFactoryï¼‰å®ä¾‹æ¥å®Œæˆå®ä¾‹åŒ–å·¥ä½œã€‚ é»˜è®¤çš„å¯¹è±¡å·¥å‚éœ€è¦åšçš„ä»…ä»…æ˜¯å®ä¾‹åŒ–ç›®æ ‡ç±»ï¼Œè¦ä¹ˆé€šè¿‡é»˜è®¤æ— å‚æ„é€ æ–¹æ³•ï¼Œè¦ä¹ˆé€šè¿‡å­˜åœ¨çš„å‚æ•°æ˜ å°„æ¥è°ƒç”¨å¸¦æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ã€‚ </p><p>å¦‚æœæƒ³è¦†ç›–å¯¹è±¡å·¥å‚çš„é»˜è®¤è¡Œä¸ºï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå·±çš„å¯¹è±¡å·¥å‚æ¥å®ç°ã€‚æ¯”å¦‚ï¼š </p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// MyObjectFactory.java</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyObjectFactory</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultObjectFactory</span> <span class="token punctuation">{</span>  <span class="token keyword">public</span> Object <span class="token function">create</span><span class="token punctuation">(</span>Class <span class="token class-name">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token comment" spellcheck="true">//è‡ªå®šä¹‰å·¥å‚è°ƒç”¨ä¸å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•</span>    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> Object <span class="token function">create</span><span class="token punctuation">(</span>Class <span class="token class-name">type</span><span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Class<span class="token operator">></span> constructorArgTypes<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Object<span class="token operator">></span> constructorArgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//è‡ªå®šä¹‰å·¥å‚è°ƒç”¨å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•</span>    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> constructorArgTypes<span class="token punctuation">,</span> constructorArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span>Properties properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token comment" spellcheck="true">//è‡ªå®šä¹‰å·¥å‚è®¾ç½®å±æ€§</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setProperties</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token keyword">boolean</span> <span class="token function">isCollection</span><span class="token punctuation">(</span>Class<span class="token operator">&lt;</span>T<span class="token operator">></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> Collection<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é…ç½® mybatis-config.xmlï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- mybatis-config.xml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>objectFactory</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.objectFactorytest.ExampleObjectFactory<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>someProperty<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>objectFactory</span><span class="token punctuation">></span></span></code></pre><h3 id="ä¸ƒã€æ’ä»¶"><a href="#ä¸ƒã€æ’ä»¶" class="headerlink" title="ä¸ƒã€æ’ä»¶"></a>ä¸ƒã€æ’ä»¶</h3><blockquote><p>MyBatis å…è®¸ä½ åœ¨æ˜ å°„è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŸä¸€ç‚¹è¿›è¡Œæ‹¦æˆªè°ƒç”¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMyBatis å…è®¸ä½¿ç”¨æ’ä»¶æ¥æ‹¦æˆªçš„æ–¹æ³•è°ƒç”¨åŒ…æ‹¬ï¼š  </p><ul><li>Executor(update, query, flushStatements, commit, rollback,  getTransaction, close,  isClosed)           </li><li>ParameterHandler (getParameterObject, setParameters)           </li><li>ResultSetHandler  (handleResultSets, handleOutputParameters)           </li><li>StatementHandler (prepare, parameterize, batch, update, query)        </li></ul></blockquote><p>è¿™äº›ç±»ä¸­æ–¹æ³•çš„ç»†èŠ‚å¯ä»¥é€šè¿‡æŸ¥çœ‹æ¯ä¸ªæ–¹æ³•çš„ç­¾åæ¥å‘ç°ï¼Œæˆ–è€…ç›´æ¥æŸ¥çœ‹ MyBatis å‘è¡ŒåŒ…ä¸­çš„æºä»£ç ã€‚</p><p>MyBatis æä¾›çš„å¼ºå¤§æœºåˆ¶ï¼Œä½¿ç”¨æ’ä»¶æ˜¯éå¸¸ç®€å•çš„ï¼Œåªéœ€å®ç° Interceptor æ¥å£ï¼Œå¹¶æŒ‡å®šæƒ³è¦æ‹¦æˆªçš„æ–¹æ³•ç­¾åå³å¯ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// ExamplePlugin.java</span><span class="token annotation punctuation">@Intercepts</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token annotation punctuation">@Signature</span><span class="token punctuation">(</span>  type<span class="token operator">=</span> Executor<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>  method <span class="token operator">=</span> <span class="token string">"update"</span><span class="token punctuation">,</span>  args <span class="token operator">=</span> <span class="token punctuation">{</span>MappedStatement<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExamplePlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">{</span>  <span class="token keyword">private</span> Properties properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> Object <span class="token function">intercept</span><span class="token punctuation">(</span>Invocation invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// implement pre processing if need</span>    Object returnObject <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// implement post processing if need</span>    <span class="token keyword">return</span> returnObject<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span>Properties properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre><code>&lt;!-- mybatis-config.xml --&gt;&lt;plugins&gt;  &lt;plugin interceptor=&quot;com.ssm.web.example.ExamplePlugin&quot;&gt;    &lt;property name=&quot;someProperty&quot; value=&quot;100&quot;/&gt;  &lt;/plugin&gt;&lt;/plugins&gt;</code></pre><p>ä¸Šé¢çš„æ’ä»¶å°†ä¼šæ‹¦æˆªåœ¨ Executor å®ä¾‹ä¸­æ‰€æœ‰çš„ â€œupdateâ€ æ–¹æ³•è°ƒç”¨ï¼Œ           è¿™é‡Œçš„ Executor æ˜¯è´Ÿè´£æ‰§è¡Œåº•å±‚æ˜ å°„è¯­å¥çš„å†…éƒ¨å¯¹è±¡ã€‚</p><p>æç¤º<strong>è¦†ç›–é…ç½®ç±»</strong>         </p><p>é™¤äº†ç”¨æ’ä»¶æ¥ä¿®æ”¹ MyBatis æ ¸å¿ƒè¡Œä¸ºä»¥å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å®Œå…¨è¦†ç›–é…ç½®ç±»æ¥è¾¾åˆ°ç›®çš„ã€‚åªéœ€ç»§æ‰¿é…ç½®ç±»åè¦†ç›–å…¶ä¸­çš„æŸä¸ªæ–¹æ³•ï¼Œå†æŠŠå®ƒä¼ é€’åˆ°  SqlSessionFactoryBuilder.build(myConfig) æ–¹æ³•å³å¯ã€‚ç‰¹åˆ«è¯´æ˜ï¼Œè¿™å¯èƒ½ä¼šæå¤§å½±å“ MyBatis  çš„è¡Œä¸ºï¼ŒåŠ¡è¯·æ…ä¹‹åˆæ…ã€‚</p><p>æ¶‰åŠMybatiså†…éƒ¨è¿è¡ŒåŸç†ã€‚</p><p>å‚è€ƒ<a href="">ã€ŠMybatisè¿è¡ŒåŸç†ã€‹</a></p><h3 id="å…«ã€é…ç½®ç¯å¢ƒ"><a href="#å…«ã€é…ç½®ç¯å¢ƒ" class="headerlink" title="å…«ã€é…ç½®ç¯å¢ƒ"></a>å…«ã€é…ç½®ç¯å¢ƒ</h3><p>MyBatis å¯ä»¥é…ç½®æˆé€‚åº”å¤šç§ç¯å¢ƒï¼Œè¿™ç§æœºåˆ¶æœ‰åŠ©äºå°† SQL æ˜ å°„åº”ç”¨äºå¤šç§æ•°æ®åº“ä¹‹ä¸­ï¼Œ ç°å®æƒ…å†µä¸‹æœ‰å¤šç§ç†ç”±éœ€è¦è¿™ä¹ˆåšã€‚ä¾‹å¦‚ï¼Œå¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒéœ€è¦æœ‰ä¸åŒçš„é…ç½®ï¼›æˆ–è€…æƒ³åœ¨å…·æœ‰ç›¸åŒ Schema çš„å¤šä¸ªç”Ÿäº§æ•°æ®åº“ä¸­ä½¿ç”¨ç›¸åŒçš„ SQL æ˜ å°„ã€‚è¿˜æœ‰è®¸å¤šç±»ä¼¼çš„ä½¿ç”¨åœºæ™¯ã€‚ </p><p>ä¹Ÿå°±æ˜¯å¯ä»¥æ³¨å†Œå¤šä¸ªæ•°æ®æºï¼ˆDataSourceï¼‰ï¼Œæ¯ä¸ªæ•°æ®æºåˆ†ä¸¤ä¸ªéƒ¨åˆ†ï¼šæ•°æ®æºé…ç½®å’Œæ•°æ®åº“äº‹åŠ¡ï¼ˆtransactionManagerï¼‰é…ç½®ã€‚</p><p>æ³¨æ„ï¼š<strong>æ¯ä¸ª SqlSessionFactory å®ä¾‹åªèƒ½é€‰æ‹©ä¸€ç§ç¯å¢ƒã€‚æ¯ä¸ªæ•°æ®åº“å¯¹åº”ä¸€ä¸ª SqlSessionFactory å®ä¾‹</strong>ã€‚  </p><h4 id="1ã€ç¯å¢ƒé…ç½®"><a href="#1ã€ç¯å¢ƒé…ç½®" class="headerlink" title="1ã€ç¯å¢ƒé…ç½®"></a>1ã€ç¯å¢ƒé…ç½®</h4><p>environments å…ƒç´ å®šä¹‰äº†å¦‚ä½•é…ç½®ç¯å¢ƒï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${driver}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${url}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${username}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${password}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>autoCommit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transactionManager</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">></span></span></code></pre><p>ï¼ˆ1ï¼‰environmentså…ƒç´ çš„defaultå±æ€§è¡¨ç¤ºç¼ºçœæ—¶ï¼Œå¯ç”¨çš„æ•°æ®æºé…ç½®ã€‚</p><p>ï¼ˆ2ï¼‰environmentå…ƒç´ æ˜¯é…ç½®æ•°æ®æºçš„å¼€å§‹ï¼Œidæ˜¯è¿™ä¸ªæ•°æ®æºçš„æ ‡å¿—ï¼Œæ–¹ä¾¿Mybatisä¸Šä¸‹æ–‡ä½¿ç”¨ã€‚</p><p>ï¼ˆ3ï¼‰transactionManageré…ç½®æ•°æ®åº“äº‹åŠ¡ï¼Œå…¶typeå±æ€§æœ‰3ç§é…ç½®æ–¹å¼ï¼š</p><p>â€‹    ï¼ˆaï¼‰JDBC,é‡‡ç”¨JDBCæ–¹å¼ç®¡ç†äº‹åŠ¡ï¼Œç›´æ¥ä½¿ç”¨äº† JDBC çš„æäº¤å’Œå›æ»šè®¾æ–½ï¼Œå®ƒä¾èµ–ä»æ•°æ®æºè·å¾—çš„è¿æ¥æ¥ç®¡ç†äº‹åŠ¡ä½œç”¨åŸŸã€‚ ç‹¬ç«‹ç¼–ç å¸¸ç”¨ã€‚</p><p>â€‹    ï¼ˆbï¼‰MANAGEDï¼Œé‡‡ç”¨å®¹å™¨æ–¹å¼ç®¡ç†äº‹åŠ¡ï¼Œå®ƒä»ä¸æäº¤æˆ–å›æ»šä¸€ä¸ªè¿æ¥ï¼Œè€Œæ˜¯è®©å®¹å™¨æ¥ç®¡ç†äº‹åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ ã€‚é»˜è®¤æƒ…å†µä¸‹å®ƒä¼šå…³é—­è¿æ¥ã€‚ç„¶è€Œä¸€äº›å®¹å™¨å¹¶ä¸å¸Œæœ›è¿æ¥è¢«å…³é—­ï¼Œå› æ­¤éœ€è¦å°† closeConnection å±æ€§è®¾ç½®ä¸º false æ¥é˜»æ­¢é»˜è®¤çš„å…³é—­è¡Œä¸ºã€‚ åœ¨JNDIæ•°æ®æºæºä¸­å¸¸ç”¨ã€‚</p><p>â€‹    ï¼ˆcï¼‰è‡ªå®šä¹‰ï¼Œè‡ªå®šä¹‰æ•°æ®åº“äº‹åŠ¡ç®¡ç†åŠæ³•ï¼Œé€‚ç”¨äºç‰¹æ®Šåº”ç”¨ã€‚</p><p>transactionManagerå…ƒç´ ä¸‹çš„properties å…ƒç´ å¯ä»¥é…ç½®æ•°æ®æºçš„å„ç±»å±æ€§ï¼Œè¿™é‡Œé…ç½®autoCommitçš„å€¼falseï¼Œè¡¨ç¤ºè¦æ±‚æ•°æ®æºä¸è‡ªåŠ¨æäº¤ã€‚</p><h4 id="2ã€æ•°æ®æº"><a href="#2ã€æ•°æ®æº" class="headerlink" title="2ã€æ•°æ®æº"></a>2ã€æ•°æ®æº</h4><p><dataSource>æ ‡ç­¾å…ƒç´ æ˜¯é…ç½®æ•°æ®æºè¿æ¥ä¿¡æ¯ï¼Œtype å±æ€§è¡¨ç¤ºæ•°æ®åº“è¿æ¥æ–¹å¼é…ç½®ï¼Œå¸¸è§çš„é…ç½®æ–¹å¼æœ‰ï¼š</p><p>â€‹    ï¼ˆaï¼‰UNPOOLED ï¼šéè¿æ¥æ± æ•°æ®åº“ï¼ˆUnpooledDataSourceï¼‰ã€‚Mybatisä½¿ç”¨<code>org.apache.ibatis.datasource.unpooled.UnpooledDataSource</code>ç±»å®ç°ã€‚</p><p>â€‹    ï¼ˆbï¼‰POOLED ï¼šè¿æ¥æ± æ•°æ®åº“ï¼ˆPooledDataSourceï¼‰ã€‚Mybatisä½¿ç”¨<code>org.apache.ibatis.datasource.pooled.PooledDataSource</code>ç±»å®ç°ã€‚</p><p>â€‹    ï¼ˆcï¼‰JNDI ï¼šJNDIæ•°æ®æºï¼ˆJNDIDateSourceï¼‰ã€‚Mybatisä½¿ç”¨<code>org.apache.ibatis.datasource.jndi.JndiDataSourceFactory</code>è·å–æ•°æ®æºã€‚</p><p>â€‹    ï¼ˆdï¼‰è‡ªå®šä¹‰æ•°æ®æºã€‚ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®æºï¼Œå¿…é¡»å®ç°``æ¥å£ï¼Œå¦‚</p><h4 id="3ã€æ•°æ®åº“äº‹åŠ¡"><a href="#3ã€æ•°æ®åº“äº‹åŠ¡" class="headerlink" title="3ã€æ•°æ®åº“äº‹åŠ¡"></a>3ã€æ•°æ®åº“äº‹åŠ¡</h4><p>Mybatisçš„æ•°æ®åº“äº‹åŠ¡æ˜¯ç”±SqlSessionæ§åˆ¶ï¼Œé€šè¿‡SqlSessionæäº¤ï¼ˆcommitï¼‰æˆ–è€…å›æ»šï¼ˆrollbackï¼‰ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¼šä½¿ç”¨springçš„ä¸­çš„äº‹åŠ¡ç®¡ç†å™¨è¦†ç›–Mybatisçš„äº‹åŠ¡ç®¡ç†å™¨transactionManagerã€‚</p><p>å¦‚æœè¦ä½¿ç”¨ï¼Œç›´æ¥ç”¨TransactionFactory æ¥å£å®ç°ç±»çš„å…¨é™å®šåæˆ–ç±»å‹åˆ«åä»£æ›¿ï¼ŒåŒæ—¶å®ç°è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª Transaction æ¥å£çš„å®ç°ç±»ã€‚ä½¿ç”¨è¿™ä¸¤ä¸ªæ¥å£ï¼Œå¯ä»¥å®Œå…¨è‡ªå®šä¹‰ MyBatis å¯¹äº‹åŠ¡çš„å¤„ç†ã€‚</p><p>3ã€æ•°æ®æº</p><p>   UNPOOLEDï¼ŒPOOLEDï¼ŒJNDIé™¤äº†å¸¸è§é€šç”¨çš„åŸºæœ¬å±æ€§ï¼Œè¿˜æœ‰å±äºè‡ªå·±çš„é¢å¤–å±æ€§ï¼Œå®é™…ä½¿ç”¨æ—¶ï¼Œå…·ä½“å‚è€ƒ<a href="https://mybatis.org/mybatis-3/zh/configuration.html" target="_blank" rel="noopener">Mybatiså®˜ç½‘</a>è¯´æ˜ã€‚</p><p>ä¸»è¦è¯´æ˜ä¸€ä¸‹ è‡ªå®šä¹‰æ•°æ®æºï¼ˆæˆ–ç¬¬ä¸‰æ–¹æ•°æ®æºï¼‰ã€‚ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®æºè¦æ±‚å¿…é¡»å®ç°æ¥å£ <code>org.apache.ibatis.datasource.DataSourceFactory</code>  ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DataSourceFactory</span> <span class="token punctuation">{</span>  <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span>Properties props<span class="token punctuation">)</span><span class="token punctuation">;</span>  DataSource <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å¦‚ï¼šè‡ªå®šä¹‰DBCPæ•°æ®æºï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>example<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>SQLFeatureNotSupportedException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Properties<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>DataSource<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>DataSourceFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>dbcp<span class="token punctuation">.</span>dbcp<span class="token punctuation">.</span>BasicDataSource<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>dbcp<span class="token punctuation">.</span>dbcp<span class="token punctuation">.</span>BasicDataSourceFactory<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DBCPDataSource</span> <span class="token keyword">extends</span> <span class="token class-name">BasicDataSource</span> <span class="token keyword">implements</span> <span class="token class-name">DataSourceFactory</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Properties props <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Logger <span class="token function">getParentLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLFeatureNotSupportedException <span class="token punctuation">{</span>        <span class="token keyword">return</span> null<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span>Properties props<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props <span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> DataSource <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        DataSource dataSource <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            dataSource <span class="token operator">=</span> BasicDataSourceFactory<span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é…ç½®è‡ªå®šä¹‰æ•°æ®æºï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.example.DBCPDataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.postgresql.Driver<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jdbc:postgresql:mydb<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>postgres<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">></span></span></code></pre><p>å¦‚æœä¸å®ç°æ¥å£ä¹Ÿå¯ä»¥ï¼Œä½¿ç”¨<code>org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory</code> å¯è¢«ç”¨ä½œçˆ¶ç±»æ¥æ„å»ºæ–°çš„æ•°æ®æºé€‚é…å™¨ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>example<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>unpooled<span class="token punctuation">.</span>UnpooledDataSourceFactory<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>mchange<span class="token punctuation">.</span>v2<span class="token punctuation">.</span>c3p0<span class="token punctuation">.</span>ComboPooledDataSource<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">C3P0DataSource</span> <span class="token keyword">extends</span> <span class="token class-name">UnpooledDataSourceFactory</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token function">C3P0DataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComboPooledDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="ä¹ã€æ•°æ®åº“å‚å•†æ ‡è¯†"><a href="#ä¹ã€æ•°æ®åº“å‚å•†æ ‡è¯†" class="headerlink" title="ä¹ã€æ•°æ®åº“å‚å•†æ ‡è¯†"></a>ä¹ã€æ•°æ®åº“å‚å•†æ ‡è¯†</h3><p>MyBatis å¯ä»¥æ ¹æ®ä¸åŒçš„æ•°æ®åº“å‚å•†æ‰§è¡Œä¸åŒçš„è¯­å¥ï¼Œè¿™ç§å¤šå‚å•†çš„æ”¯æŒæ˜¯åŸºäºæ˜ å°„è¯­å¥ä¸­çš„ <code>databaseId</code> å±æ€§ã€‚</p><p>å¦‚è¦ä½¿ç”¨åœ¨mybatis-config.xmlä¸­é…ç½®å³å¯ã€‚</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>databaseIdProvider</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DB_VENDOR<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><h4 id="1ã€ç³»ç»Ÿé»˜è®¤è§„åˆ™"><a href="#1ã€ç³»ç»Ÿé»˜è®¤è§„åˆ™" class="headerlink" title="1ã€ç³»ç»Ÿé»˜è®¤è§„åˆ™"></a>1ã€ç³»ç»Ÿé»˜è®¤è§„åˆ™</h4><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>databaseIdProvider</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DB_VENDOR<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>SQL Server<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sqlserver<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DB2<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>db2<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Oracle<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>oracle<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>databaseIdProvider</span><span class="token punctuation">></span></span></code></pre><p> type=â€DB_VENDORâ€æ˜¯å¯åŠ¨Mybatiså†…éƒ¨æ³¨å†Œçš„ç­–ç•¥å™¨ã€‚Mybatiså°†é…ç½®ä¿¡æ¯å†™å…¥Configurationç±»ä¸­ï¼Œåœ¨æ•°æ®åº“è¿æ¥åè°ƒç”¨<code>DatabaseMetaDataçš„getDatabaseProductName()</code> æ–¹æ³•è·å–æ•°æ®åº“ä¿¡æ¯ï¼Œç„¶åè·Ÿé…ç½®çš„nameå€¼æ˜¯åšåŒ¹é…ï¼Œå¾—åˆ°DatabaseIdã€‚</p><p>ç”¨ä»£ç ä¹Ÿå¯ä»¥å¾—åˆ°æ•°æ®åº“IDï¼š</p><pre class=" language-java"><code class="language-java">String dbId <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDatabaseId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¹Ÿå¯ä»¥æŒ‡å®šSQLåœ¨æŸä¸ªæ•°æ®åº“å‚å•†æ‰§è¡Œï¼ŒXMLé…ç½®ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.dao.emp.EmployeeMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>     // some code çœç•¥  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    // some code çœç•¥    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>insert<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span> <span class="token attr-name">databaseId</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mysql<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    insert into tbl_emp (emp_id, emp_name, sex,       email,dept_id)    values (#{empId,jdbcType=INTEGER}, #{empName,jdbcType=VARCHAR}, #{sex,typeHandler="com.ssm.web.typehandle.EnumTypeHandler"},       #{email,jdbcType=VARCHAR},#{did,jdbcType=INTEGER},)  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span> </code></pre><p>åœ¨insertæ ‡ç­¾ä¸­å¤šäº†databaseIdå±æ€§æ—¶ï¼ŒMybatisæä¾›å¦‚ä¸‹è§„åˆ™ï¼š</p><p>ï¼ˆ1ï¼‰è‹¥æ²¡æœ‰é…ç½®databaseIdProvideræ ‡ç­¾ï¼ŒdatabaseIdä¼šè¿”å›nullã€‚</p><p>ï¼ˆ2ï¼‰è‹¥é…ç½®äº†databaseIdProvideræ ‡ç­¾ï¼ŒMybatisä¼šç”¨é…ç½®çš„nameå€¼å»åŒ¹é…æ•°æ®åº“ä¿¡æ¯ï¼ŒåŒ¹é…ä¸Šå°±ä¼šè®¾ç½®databaseIdï¼Œå¦åˆ™å€¼ä¸ºnullã€‚</p><p>ï¼ˆ3ï¼‰è‹¥Configurationçš„databaseIdä¸ä¸ºç©ºï¼Œåˆ™å®ƒåªèƒ½æ‰¾åˆ°é…ç½®databaseIdçš„SQLè¯­å¥ã€‚</p><p>ï¼ˆ4ï¼‰MyBatis ä¼šåŠ è½½å¸¦æœ‰åŒ¹é…å½“å‰æ•°æ®åº“ <code>databaseId</code> å±æ€§å’Œæ‰€æœ‰ä¸å¸¦ <code>databaseId</code> å±æ€§çš„è¯­å¥ã€‚ å¦‚æœåŒæ—¶æ‰¾åˆ°å¸¦æœ‰ <code>databaseId</code> å’Œä¸å¸¦ <code>databaseId</code> çš„ç›¸åŒè¯­å¥ï¼Œåˆ™åè€…ï¼ˆä¸å¸¦ <code>databaseId</code> çš„è¯­å¥ï¼‰ä¼šè¢«èˆå¼ƒã€‚ </p><h4 id="2ã€ä¸ä½¿ç”¨é»˜è®¤è§„åˆ™"><a href="#2ã€ä¸ä½¿ç”¨é»˜è®¤è§„åˆ™" class="headerlink" title="2ã€ä¸ä½¿ç”¨é»˜è®¤è§„åˆ™"></a>2ã€ä¸ä½¿ç”¨é»˜è®¤è§„åˆ™</h4><p>Mybatiså…è®¸è‡ªå®šä¹‰è§„åˆ™ï¼Œåªè¦</p><p>ï¼ˆAï¼‰å®ç°<code>org.apache.ibatis.mapping.DatabaseIdProvider</code>æ¥å£ï¼Œ</p><p>ï¼ˆBï¼‰åœ¨mybatis-config.xmlä¸­é…ç½®<code>DatabaseIdProvider</code>ã€‚</p><p>å¦‚è‡ªå®šä¹‰MyDbIdProviderï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>example<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>SQLException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Properties<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>DataSource<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>DatabaseIdProvider<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDbIdProvider</span> <span class="token keyword">implements</span> <span class="token class-name">DatabaseIdProvider</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> Properties props <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span>Properties p<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> p <span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> String <span class="token function">getDatabaseId</span><span class="token punctuation">(</span>DataSource dataSource<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>        String dbName <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMetaData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDatabaseProductName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String dbId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> dbId<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç„¶åé…ç½®è‡ªå®šä¹‰çš„MyDbIdProvider ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>databaseIdProvider</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.example.MyDbIdProvider<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>SQL Server<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sqlserver<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>DB2<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>db2<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Oracle<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>oracle<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>databaseIdProvider</span><span class="token punctuation">></span></span></code></pre><h3 id="åã€æ˜ å°„å™¨å¼•å…¥ï¼ˆMappersï¼‰"><a href="#åã€æ˜ å°„å™¨å¼•å…¥ï¼ˆMappersï¼‰" class="headerlink" title="åã€æ˜ å°„å™¨å¼•å…¥ï¼ˆMappersï¼‰"></a>åã€æ˜ å°„å™¨å¼•å…¥ï¼ˆMappersï¼‰</h3><p>æ˜ å°„å™¨æ˜¯Mybatisçš„æ ¸å¿ƒç»„ä»¶ã€‚</p><p>å¼•å…¥æ˜ å°„å™¨é¦–å…ˆéœ€è¦å®šä¹‰æ˜ å°„å™¨æ¥å£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>emp<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>emp<span class="token punctuation">.</span>Employee<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>emp<span class="token punctuation">.</span>EmployeeExample<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EmployeeMapper</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span>Employee record<span class="token punctuation">)</span><span class="token punctuation">;</span>    List<span class="token operator">&lt;</span>Employee<span class="token operator">></span> <span class="token function">selectByExample</span><span class="token punctuation">(</span>EmployeeExample example<span class="token punctuation">)</span><span class="token punctuation">;</span>    Employee <span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>Integer empId<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">updateByPrimaryKey</span><span class="token punctuation">(</span>Employee record<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//some other code ...</span><span class="token punctuation">}</span></code></pre><p>å¯¹åº”çš„EmployeeMapper.xmlæ–‡ä»¶ï¼š</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;mapper namespace=&quot;com.ssm.web.demo.dao.emp.EmployeeMapper&quot;&gt;  &lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;com.ssm.web.demo.entity.emp.Employee&quot;&gt;    &lt;id column=&quot;emp_id&quot; jdbcType=&quot;INTEGER&quot; property=&quot;empId&quot; /&gt;    &lt;result column=&quot;emp_name&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;empName&quot; /&gt;    &lt;result column=&quot;sex&quot; property=&quot;sex&quot; typeHandler=&quot;com.ssm.web.typehandle.EnumTypeHandler&quot; /&gt;    &lt;result column=&quot;email&quot; property=&quot;email&quot; typeHandler=&quot;com.ssm.web.demo.ExampleTypeHandler&quot;/&gt;    &lt;result column=&quot;dept_id&quot; jdbcType=&quot;VARCHAR&quot; property=&quot;did&quot; /&gt;  &lt;/resultMap&gt;    // some code çœç•¥    &lt;insert id=&quot;insert&quot; parameterType=&quot;com.ssm.web.demo.entity.emp.Employee&quot;&gt;    insert into tbl_emp (emp_id, emp_name, sex,       email,dept_id)    values (#{empId,jdbcType=INTEGER}, #{empName,jdbcType=VARCHAR}, #{sex,typeHandler=&quot;com.ssm.web.typehandle.EnumTypeHandler&quot;},       #{email,jdbcType=VARCHAR},#{did,jdbcType=INTEGER},)  &lt;/insert&gt;</code></pre><p>å¼•å…¥æ˜ å°„å™¨çš„æ–¹å¼æœ‰å‡ ç§:</p><p>1ã€æ–‡ä»¶ç›¸å¯¹è·¯å¾„å¼•å…¥æ˜ å°„å™¨ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- ä½¿ç”¨ç›¸å¯¹äºç±»è·¯å¾„çš„èµ„æºå¼•ç”¨ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com/ssm/web/demo/dao/emp/EmployeeMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">></span></span></code></pre><p>2ã€ä½¿ç”¨åŒ…åå¼•å…¥æ˜ å°„å™¨ï¼š</p><pre><code>&lt;!-- å°†åŒ…å†…çš„æ˜ å°„å™¨æ¥å£å®ç°å…¨éƒ¨æ³¨å†Œä¸ºæ˜ å°„å™¨ --&gt;&lt;mappers&gt;  &lt;package name=&quot;com.ssm.web.demo.dao.emp&quot;/&gt;&lt;/mappers&gt;</code></pre><p>3ã€ä½¿ç”¨ç±»æ³¨å†Œå¼•å…¥æ˜ å°„å™¨ï¼š</p><pre><code>&lt;!-- ä½¿ç”¨æ˜ å°„å™¨æ¥å£å®ç°ç±»çš„å®Œå…¨é™å®šç±»å --&gt;&lt;mappers&gt;  &lt;mapper class=&quot;com.ssm.web.demo.dao.emp.AuthorMapper&quot;/&gt;&lt;/mappers&gt;</code></pre><p>4ã€æ–‡ä»¶ç»å¯¹è·¯å¾„å¼•å…¥æ˜ å°„å™¨ï¼š</p><pre><code>&lt;!-- ä½¿ç”¨å®Œå…¨é™å®šèµ„æºå®šä½ç¬¦ï¼ˆURLï¼‰ --&gt;&lt;mappers&gt;  &lt;mapper url=&quot;file:///var/mappers/com/ssm/web/demo/dao/emp/EmployeeMapper.xml&quot;/&gt;&lt;/mappers&gt;</code></pre><br/><p><strong>ç›¸å…³æ–‡ç« ï¼š</strong></p><table><thead><tr><th>æ–‡ç« åç§°</th></tr></thead><tbody><tr><td><a href="b802139a.html">ã€ŠMybatis(ä¸€)ä¸»è¦ç»„ä»¶ã€‹</a></td></tr><tr><td><a href="5d11555a.html">ã€ŠMybatis(äºŒ)é…ç½®ã€‹</a></td></tr><tr><td><a href="d467df29.html">ã€ŠMybatis(ä¸‰)åŠ¨æ€SQLã€‹</a></td></tr><tr><td><a href="3bfa75b5.html">ã€ŠMybtis(å››)å·¥ä½œåŸç†ã€‹</a></td></tr><tr><td><a href="ae8510ea.html">ã€ŠMybtis(äº”)Mapperæ˜ å°„å™¨ã€‹</a></td></tr><tr><td><a href="44c4c800.html">ã€ŠMybtis(å…­)Mapperçº§è”ã€‹</a></td></tr></tbody></table><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis(ä¸€)ä¸»è¦ç»„ä»¶</title>
      <link href="/posts/b802139a.html"/>
      <url>/posts/b802139a.html</url>
      
        <content type="html"><![CDATA[<h2 id="Mybatis-ä¸€-ä¸»è¦ç»„ä»¶"><a href="#Mybatis-ä¸€-ä¸»è¦ç»„ä»¶" class="headerlink" title="Mybatis(ä¸€)ä¸»è¦ç»„ä»¶"></a>Mybatis(ä¸€)ä¸»è¦ç»„ä»¶</h2><blockquote><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œå·²ç»ä¸æ­¢ä¸€æ¬¡çš„ä½¿ç”¨Mybatisè¿™ä¸ªæŒä¹…åŒ–æ¡†æ¶ï¼ŒåŒ…æ‹¬é€†å‘å·¥ç¨‹ï¼ŒXMLé…ç½®ï¼Œæ³¨è§£é…ç½®ï¼ŒåŠ¨æ€SQLï¼Œåˆ†é¡µæˆ–åˆ†é¡µæ’ä»¶ï¼Œä¸Springæ­é…ä½¿ç”¨ï¼Œéƒ½æœ‰è¿‡å®æˆ˜æ“ä½œï¼Œä½†æ˜¯å¯¹ç†è®ºæ€§çŸ¥è¯†ä¸å¤Ÿå®Œå–„ï¼Œä½†ä¸å¤Ÿç³»ç»ŸåŒ–ï¼Œå› æ­¤æ­¤Mybatisç³»åˆ—è¯ç”Ÿã€‚æµ‹è¯•ä½¿ç”¨çš„Mybatisæ˜¯3.4.1ç‰ˆæœ¬ã€‚</p></blockquote><h3 id="ä¸€ã€Mybatis-ç®€ä»‹ã€‚"><a href="#ä¸€ã€Mybatis-ç®€ä»‹ã€‚" class="headerlink" title="ä¸€ã€Mybatis ç®€ä»‹ã€‚"></a>ä¸€ã€Mybatis ç®€ä»‹ã€‚</h3><blockquote><p>MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒè‡ªå®šä¹‰ SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis å…é™¤äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç ä»¥åŠè®¾ç½®å‚æ•°å’Œè·å–ç»“æœé›†çš„å·¥ä½œã€‚MyBatis å¯ä»¥é€šè¿‡ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸå§‹ç±»å‹ã€æ¥å£å’Œ Java POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½•ã€‚ </p></blockquote><h3 id="äºŒã€MyBatis-çš„åŸºæœ¬æ„æˆ"><a href="#äºŒã€MyBatis-çš„åŸºæœ¬æ„æˆ" class="headerlink" title="äºŒã€MyBatis çš„åŸºæœ¬æ„æˆ"></a>äºŒã€MyBatis çš„åŸºæœ¬æ„æˆ</h3><p>Mybatisæ ¸å¿ƒç»„ä»¶ï¼š</p><ul><li>SqlSessionFactoryBuilderï¼ˆæ„é€ å™¨ï¼‰ï¼šæ ¹æ®é…ç½®ä¿¡æ¯æˆ–ä»£ç ç”ŸæˆSqlSessionFactoryå·¥å‚æ¥å£ã€‚</li><li>SqlSessionFactoryï¼ˆå·¥å‚æ¥å£ï¼‰ï¼šç”¨æ¥ç”ŸæˆSqlSessionä¼šè¯ã€‚</li><li>SqlSessionï¼ˆä¼šè¯ï¼‰ï¼šæ˜¯ä¸€ä¸ªå¯ä»¥å‘é€SQLå»æ‰§è¡Œå¹¶è¿”å›ç»“æœã€å¯ä»¥è·å–Mapperçš„æ¥å£ã€‚</li><li>SqlMapperï¼šMybatisæ–°è®¾è®¡çš„ç»„ä»¶ï¼Œæ˜¯ç”±ä¸€ä¸ªJavaæ¥å£å’ŒXMLæ–‡ä»¶ï¼ˆæˆ–æ³¨è§£ï¼‰æ„æˆï¼Œéœ€è¦ç»™å‡ºå¯¹åº”çš„SQLå’Œæ˜ å°„è§„åˆ™ã€‚ä¸»è¦è´Ÿè´£å‘é€SQLæ‰§è¡Œå¹¶è¿”å›ç»“æœã€‚</li></ul><p><img src="/medias/loading-animated.gif" data-original="/images/mybatis-imgs/Mybatis-jibenzujian.png" alt="Mybatisæ„æˆ"></p><h4 id="1ã€æ„å»ºSqlSessionFactoy"><a href="#1ã€æ„å»ºSqlSessionFactoy" class="headerlink" title="1ã€æ„å»ºSqlSessionFactoy"></a>1ã€æ„å»ºSqlSessionFactoy</h4><p>Mybatisåº”ç”¨ä»¥SqlSessionFactoryçš„å®ä¾‹ä¸ºä¸­å¿ƒï¼ŒSqlSessionFactoryé€šè¿‡SqlSessionFactoryBuiderè·å–ã€‚æœ€ç»ˆæ˜¯ä¸ºäº†åˆ›å»ºSqlSessionã€‚SqlSessionç±»ä¼¼Jdbcçš„è¿æ¥å¯¹è±¡Connectionã€‚</p><p>ä½†SqlSessionFactoryæ˜¯å·¥å‚æ¥å£ï¼Œä¸èƒ½ç›´æ¥åˆ›å»ºã€‚Mybatisæœ‰ä¸¤ç§æ–¹å¼åˆ›å»ºSqlSessionFactory:</p><p>ï¼ˆAï¼‰ä½¿ç”¨XMLé…ç½®çš„æ–¹å¼ã€‚</p><p>ï¼ˆBï¼‰ä»£ç æ–¹å¼ã€‚</p><p>Configurationçš„ç±»å…¨é™å®šåï¼šorg.apache.ibatis.session.Configuration.åœ¨Mybatisä¸­ä»¥ä¸€ä¸ªConfigurationç±»å¯¹è±¡çš„å½¢å¼å­˜åœ¨ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯æ•´ä¸ªMybatisåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚Mybatisåº”ç”¨è§£æä¸€æ¬¡é…ç½®çš„XMLä¼šä¿å­˜åˆ°Configurationç±»å¯¹è±¡ä¸­ï¼Œå¯ä»¥é‡å¤è¯»å–ä½¿ç”¨ã€‚</p><p>SqlSessionå®ç°ç±»æœ‰2ä¸ªï¼šDefaultSqlSessionFactory å’Œ SqlSessionManager (æš‚æœªä½¿ç”¨)ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/mybatis-imgs/Mybatis-jibenzujian2.png" alt="ä¸¤ä¸ªSessionFactoryå®ç°ç±»"></p><p>1ã€ä½¿ç”¨XMLæ–¹å¼æ„å»º</p><p>è¿™é‡Œä»¥æˆ‘å‰å‡ å¹´çš„ä¸€ä¸ªé¡¹ç›®çš„mybatis-config.xmlä¸ºä¾‹ï¼Œå¦‚ä¸‹ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype">&lt;!DOCTYPE configuration  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-config.dtd"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mapUnderscoreToCamelCase<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token comment" spellcheck="true">&lt;!-- æ‰“å°æŸ¥è¯¢è¯­å¥ --></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logImpl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>STDOUT_LOGGING<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- æ•°æ®åº“è¿æ¥æ± ä¿¡æ¯ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!-- com.github.pagehelperä¸ºPageHelperç±»æ‰€åœ¨åŒ…å --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">interceptor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.github.pagehelper.PageInterceptor<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment" spellcheck="true">&lt;!-- ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼é…ç½®å‚æ•°ï¼Œåé¢ä¼šæœ‰æ‰€æœ‰çš„å‚æ•°ä»‹ç» --></span>            <span class="token comment" spellcheck="true">&lt;!-- &lt;property name="param1" value="value1"/> --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reasonable<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!--- mappersç­‰ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span> </code></pre><p>ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰è¿æ¥æ•°æ®åº“å’ŒMappersèŠ‚ç‚¹ï¼Œæ˜¯å› ä¸ºæˆ‘åœ¨<code>spring.xml</code>ä¸­é…ç½®äº†c3p0è¿æ¥æ± ï¼Œé…ç½®äº†SqlSessionFactoryï¼Œå¹¶æŒ‡å®šäº†mapperLocationsã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯<code>&lt;configuration&gt;</code>æ ‡ç­¾ï¼ŒMybatisè§£æç¨‹åºä¼šå°†é…ç½®æ–‡ä»¶ä¿¡æ¯è§£æåˆ°Configurationç±»å¯¹è±¡ï¼Œæ¥ç€å¯ä»¥åˆ©ç”¨SqlSessionFactoryBuilderåˆ›å»ºSqlSessionFactoryã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Resources<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSessionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSessionFactoryBuilder<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SqlSessionFactoryTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>         String resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>         SqlSessionFactory sqlSessionFactory <span class="token operator">=</span> null<span class="token punctuation">;</span>         <span class="token keyword">try</span> <span class="token punctuation">{</span>             <span class="token comment" spellcheck="true">//1ã€åˆ›å»ºXMLçš„æ–‡ä»¶è¾“å…¥æµ</span>            InputStream inputStream <span class="token operator">=</span> Resources<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment" spellcheck="true">//2ã€åˆ©ç”¨SqlSessionFactoryBuilderè¯»å–XMLä¿¡æ¯æ¥åˆ›å»ºSqlSessionFactory</span>            sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>2ã€ä½¿ç”¨ä»£ç çš„æ–¹å¼æ„å»º</p><p>ï¼ˆ1ï¼‰æ„å»ºConfigurationçš„ç±»å¯¹è±¡ï¼Œæ³¨å†Œç›¸å…³ä¿¡æ¯ã€‚</p><p>ï¼ˆ2ï¼‰é€šè¿‡Configurationlç±»å¯¹è±¡ï¼Œæ„å»ºSqlSessionFactoryã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>pooled<span class="token punctuation">.</span>PooledDataSource<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>Environment<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSessionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSessionFactoryBuilder<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>TransactionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>JdbcTransactionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>emp<span class="token punctuation">.</span>EmployeeMapper<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>emp<span class="token punctuation">.</span>Employee<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SqlSessionFactoryCodeTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//æ„å»ºæ•°æ®åº“è¿æ¥æ± </span>        PooledDataSource dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PooledDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setDriver</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://locahost:3306/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ„å»ºæ•°æ®åº“äº‹åŠ¡</span>        TransactionFactory transactionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTransactionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//åˆ›å»ºæ•°æ®åº“å…è®¸ç¯å¢ƒ</span>        Environment evn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token string">"dev"</span><span class="token punctuation">,</span> transactionFactory<span class="token punctuation">,</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ„å»ºConfigurationç±»å¯¹è±¡</span>        Configuration configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span>evn<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ³¨å†Œåˆ«å</span>        configuration<span class="token punctuation">.</span><span class="token function">getTypeAliasRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span><span class="token string">"emp"</span><span class="token punctuation">,</span> Employee<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//åŠ å…¥æ˜ å°„å™¨</span>        configuration<span class="token punctuation">.</span><span class="token function">addMapper</span><span class="token punctuation">(</span>EmployeeMapper<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        SqlSessionFactory sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>XMLæ–¹å¼å’ŒJAVAçš„æ–¹å¼éƒ½çš„ç±»ä¼¼çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ç”¨XMLæ–¹å¼ï¼Œå¦‚æœéœ€è¦åŠ å…¥è‡ªå·±çš„ç‰¹æ€§å¯ä»¥ç”¨Javaæ–¹å¼ã€‚</p><h4 id="2ã€æ„å»ºSqlSession"><a href="#2ã€æ„å»ºSqlSession" class="headerlink" title="2ã€æ„å»ºSqlSession"></a>2ã€æ„å»ºSqlSession</h4><p>SqlSessionæ˜¯ä¸€ä¸ªæ¥å£ç±»ï¼ŒçœŸæ­£å†…éƒ¨æ‰§è¡Œçš„æ˜¯Executorç±»ã€‚SqlSessioné€šè¿‡SqlSessionFactoryè·å–ï¼Œä¸»è¦æ˜¯æ³¨æ„èµ„æºå›æ»šä¸å…³é—­ã€‚å¦‚ä¸‹ä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Resources<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSession<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSessionFactory<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>SqlSessionFactoryBuilder<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SqlSessionTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>        SqlSessionFactory sqlSessionFactory <span class="token operator">=</span> null<span class="token punctuation">;</span>        SqlSession sqlSession <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            InputStream inputStream <span class="token operator">=</span> Resources<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>            sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>            sqlSession <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            sqlSession<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>sqlSession<span class="token operator">!=</span>null<span class="token punctuation">)</span><span class="token punctuation">{</span>                sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>SqlSessionçš„ä¸»è¦ç”¨é€”ï¼š</p><p>ï¼ˆ1ï¼‰è·å–æ˜ å°„å™¨ï¼Œè®©æ˜ å°„å™¨é€šè¿‡å‘½åç©ºé—´ï¼ˆXMLå¤´éƒ¨çš„namespaceï¼‰å’Œæ–¹æ³•åç§°ï¼ˆsqlæ ‡ç­¾é‡Œçš„idï¼‰å®šä½SQLï¼Œå‘é€ç»™æ•°æ®åº“æ‰§è¡Œåè¿”å›ç»“æœã€‚</p><p>ï¼ˆ2ï¼‰é€šè¿‡update/insert/select/deleteç­‰æ–¹æ³•å¸¦ä¸ŠSQLçš„idæ¥æ“ä½œXMLä¸­é…ç½®çš„SQLï¼›é€šè¿‡commitã€rollbackæ–¹æ³•æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚</p><h4 id="3ã€æ˜ å°„å™¨"><a href="#3ã€æ˜ å°„å™¨" class="headerlink" title="3ã€æ˜ å°„å™¨"></a>3ã€æ˜ å°„å™¨</h4><blockquote><p>æ˜ å°„å™¨æ˜¯ç”±Javaæ¥å£å’ŒXMLæ–‡ä»¶ï¼ˆæˆ–æ³¨è§£ï¼‰å…±åŒç»„æˆï¼Œå¯¹å‚æ•°ã€ç¼“å­˜ã€SQLè¯­å¥ã€æ˜ å°„å…³ç³»çš„ç®¡ç†å™¨ã€‚</p></blockquote><p>ä¸»è¦ä½œç”¨ï¼š</p><p>ï¼ˆ1ï¼‰å®šä¹‰å‚æ•°ç±»å‹ã€‚</p><p>ï¼ˆ2ï¼‰æè¿°ç¼“å­˜ã€‚</p><p>ï¼ˆ3ï¼‰æè¿°SQLè¯­å¥ã€‚</p><p>ï¼ˆ4ï¼‰å®šä¹‰æŸ¥è¯¢ç»“æœå’ŒPOJOçš„æ˜ å°„å…³ç³»ã€‚</p><p>æ˜ å°„å™¨çš„å®ç°æ–¹å¼ï¼š</p><p>ï¼ˆAï¼‰é€šè¿‡XMLæ–‡ä»¶æ–¹å¼å®ç°ã€‚å°±æ˜¯åœ¨mybatis-config.xmlæ–‡ä»¶ä¸­é…ç½®POJOçš„XML,ç”ŸæˆMapperã€‚</p><p>ï¼ˆBï¼‰ä»£ç æ–¹å¼å®ç°ã€‚åœ¨Configurationé‡Œæ³¨å†ŒMapperæ¥å£ã€‚</p><p>æ˜ å°„å™¨æ˜¯Mybatisçš„æ ¸å¿ƒå†…å®¹ï¼Œæœ€å¤æ‚ã€‚</p><p>1ï¼‰XMLæ–¹å¼å®ç°Mapperç¤ºä¾‹ï¼š</p><p>ï¼ˆAï¼‰å®šä¹‰Javaæ¥å£ï¼šæ ¹æ®ä¸»é”®IDæŸ¥è¯¢Employeeå¯¹è±¡ã€‚</p><p>å¯¹åº”çš„POJOï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>emp<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>constraints<span class="token punctuation">.</span>Pattern<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">implements</span> <span class="token class-name">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> 6654960072154305288L<span class="token punctuation">;</span>    <span class="token keyword">private</span> Integer Id<span class="token punctuation">;</span>    <span class="token keyword">private</span> String empName<span class="token punctuation">;</span>    <span class="token keyword">private</span> String sex<span class="token punctuation">;</span>    <span class="token keyword">private</span> String email<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">Employee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token function">Employee</span><span class="token punctuation">(</span>Integer empId<span class="token punctuation">,</span> String empName<span class="token punctuation">,</span> String sex<span class="token punctuation">,</span> String email<span class="token punctuation">,</span><span class="token keyword">int</span> did<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>empId <span class="token operator">=</span> empId<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>empName <span class="token operator">=</span> empName<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>email <span class="token operator">=</span> email<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>did <span class="token operator">=</span> did<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Department <span class="token function">getDepartment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> department<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDepartment</span><span class="token punctuation">(</span>Department department<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>department <span class="token operator">=</span> department<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Integer <span class="token function">getEmpId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> empId<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEmpId</span><span class="token punctuation">(</span>Integer empId<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>empId <span class="token operator">=</span> empId<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getEmpName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> empName<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEmpName</span><span class="token punctuation">(</span>String empName<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>empName <span class="token operator">=</span> empName <span class="token operator">==</span> null <span class="token operator">?</span> null <span class="token operator">:</span> empName<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> sex<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSex</span><span class="token punctuation">(</span>String sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex <span class="token operator">==</span> null <span class="token operator">?</span> null <span class="token operator">:</span> sex<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> email<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEmail</span><span class="token punctuation">(</span>String email<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>email <span class="token operator">=</span> email <span class="token operator">==</span> null <span class="token operator">?</span> null <span class="token operator">:</span> email<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å®šä¹‰å¯¹åº”æ¥å£ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>emp<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span> <span class="token keyword">import</span> com<span class="token punctuation">.</span>ssm<span class="token punctuation">.</span>web<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>emp<span class="token punctuation">.</span>Employee<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EmployeeMapper</span> <span class="token punctuation">{</span>    Employee <span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>Integer empId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><p>ï¼ˆ2ï¼‰å®šä¹‰XMLæ˜ å°„</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.dao.emp.EmployeeMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectByPrimaryKey<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.ssm.web.demo.entity.emp.Employee<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select     emp_id as empId, emp_name as empName,email as email    from tbl_emp    where emp_id = #{empId,jdbcType=INTEGER}  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre><p>ï¼ˆaï¼‰è¿™ä¸ªXMLæ–‡ä»¶é€šå¸¸é…ç½®åœ¨mybatis-config.xmlä¸­ï¼Œmybatisä¼šä¸ºè¿™ä¸ªé…ç½®æ–‡ä»¶ç”Ÿæˆæ˜ å°„å™¨ã€‚</p><p>ï¼ˆbï¼‰XMLå®šä¹‰äº†ä¸€ä¸ªå‘½åç©ºé—´ä¸ºcom.ssm.web.demo.dao.emp.EmployeeMapperçš„SQL Mapperï¼Œè¿™ä¸ªå‘½åç©ºé—´å’Œæ¥å£å…¨é™å®šåç§°ä¸€è‡´ã€‚</p><p>ï¼ˆcï¼‰ç”¨selectæ ‡ç­¾å®šä¹‰ä¸€ä¸ªæŸ¥è¯¢SQLï¼Œå…¶idå’Œæ¥å£çš„æ–¹æ³•åä¸€è‡´ã€‚å‚æ•°ç±»å‹parameterTypeçš„å€¼ä¸ºâ€java.lang.Integerâ€ï¼Œä¹Ÿå’Œæ¥å£æ–¹æ³•å‚æ•° ç±»å‹ä¸€è‡´ã€‚è¿”å›ç±»å‹resultTypeï¼Œå¦‚æœæ²¡æœ‰æ³¨å†Œåˆ«åéœ€è¦ä½¿ç”¨å¯¹åº”POJOçš„å…¨é™å®šï¼Œå¦‚ä»£ç ä¾‹ï¼Œå¦‚æœæ³¨å†Œäº†POJOçš„åˆ«åç›´æ¥ä½¿ç”¨åˆ«åå³å¯ã€‚</p><p>ï¼ˆdï¼‰#{empId,jdbcType=INTEGER}ä¸ºè¿™ä¸ªæ¡SQLçš„å‚æ•°ï¼ŒSQLçš„åˆ—åˆ«åä¸POJOçš„å±æ€§åä¸€è‡´ã€‚é‚£ä¹ˆMybatisä¼šæŠŠè¯¥SQLè¯­å¥æŸ¥è¯¢ç»“æœè‡ªåŠ¨æ˜ å°„åˆ°å¯¹åº”çš„POJOå±æ€§ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºè‡ªåŠ¨æ˜ å°„ã€‚</p><p>å¦‚æœç”¨SqlSessionè·å–Mapperï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p><pre class=" language-java"><code class="language-java">EmployeeMapper empMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span>EmployeeMapper<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Employee emp <span class="token operator">=</span> empMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡æŸ¥è¯¢ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£SQLæ–¹å¼ï¼Œæœ‰å…³æ³¨è§£æ–¹å¼ä¼šå¦å¤–å•ç‹¬æ•´ç†ä¸€ç¯‡ã€‚</p><pre><code>package com.ssm.web.demo.dao.emp;import java.util.List; import com.ssm.web.demo.entity.emp.Employee;public interface EmployeeMapper2 {    @Select(value=&quot;select emp_id as empId, emp_name as empName,email as email from tbl_emp where emp_id = #{empId}&quot;)    Employee selectByPrimaryKey(Integer empId); }</code></pre><p><strong>ç‰¹åˆ«æ³¨æ„</strong>ï¼š</p><p>Mybatisä¾æ—§å¯ä»¥ä½¿ç”¨ibatisä¸­é€šè¿‡å‘½åç©ºé—´å’ŒSQLçš„idï¼Œå®šä½æ‰§è¡ŒSQLè¿”å›æ•°æ®çš„æ–¹å¼ï¼Œä¸éœ€è¦æ˜ å°„å™¨ã€‚</p><pre class=" language-java"><code class="language-java">Employee emp2 <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token string">"com.ssm.web.demo.dao.emp.DepartmentMapper.selectByPrimaryKey"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¦‚æœSQLçš„idå…¨å±€å”¯ä¸€ï¼Œè¿˜å¯ä»¥çœç•¥å‘½åç©ºé—´ï¼š</p><pre class=" language-java"><code class="language-java">Employee emp2 <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token string">"selectByPrimaryKey"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¦‚æœSQLçš„idä¸æ˜¯å…¨å±€å”¯ä¸€ï¼Œé‚£ä¹ˆè¯¥çœç•¥å‘½åç©ºé—´çš„å†™æ³•å°±æœ‰é—®é¢˜ã€‚</p><p>Mybatisçš„Mapperåªæ˜¯æ¥å£ï¼Œæ²¡æœ‰å®ç°ç±»ï¼Œæ˜¯ä¸€ç§æ¥å£ç¼–ç¨‹æ¨¡å¼ï¼Œæ˜¯é€šè¿‡Javaè¯­è¨€çš„åŠ¨æ€ä»£ç†æ¥å®ç°çš„ã€‚</p><blockquote><p>åœ¨Mybatisä¸Šä¸‹æ–‡æè¿°æ¥å£ï¼ŒMybatisä¼šä¸ºè¯¥æ¥å£ç”Ÿæˆä»£ç†ç±»å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡ä¼šæ ¹æ®â€œæ¥å£å…¨è·¯å¾„+æ–¹æ³•åâ€å»åŒ¹é…ï¼Œæ‰¾åˆ°å¯¹åº”çš„XMLé…ç½®æˆ–æ³¨è§£ä¸­çš„SQLä»»åŠ¡æ‰§è¡Œå¹¶è¿”å›ç»“æœã€‚</p></blockquote><h3 id="ä¸‰ã€Mybaitsç»„ä»¶ç”Ÿå‘½å‘¨æœŸ"><a href="#ä¸‰ã€Mybaitsç»„ä»¶ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ä¸‰ã€Mybaitsç»„ä»¶ç”Ÿå‘½å‘¨æœŸ"></a>ä¸‰ã€Mybaitsç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</h3><h4 id="1ã€SqlSessionFactoryBuilder"><a href="#1ã€SqlSessionFactoryBuilder" class="headerlink" title="1ã€SqlSessionFactoryBuilder"></a>1ã€SqlSessionFactoryBuilder</h4><p>SqlSessionFactoryBuilderåˆ©ç”¨XMLæˆ–ç¼–ç è·å–èµ„æºï¼Œæ„å»ºSqlSessionFactoryï¼Œå®ƒå¯ä»¥æ„å»ºå¤šä¸ªSqlSessionFactoryã€‚SqlSessionFactoryBuilderåªæ˜¯ä¸€ä¸ªæ„é€ å™¨ï¼Œæ„é€ å‡ºSqlSessionFactoryä¹‹åï¼Œä½œç”¨å°±å®Œç»“ï¼Œä¼šè¢«åºŸå¼ƒå›æ”¶ã€‚</p><p>ä½œç”¨ï¼šä½œä¸ºæ„é€ å™¨ç”ŸæˆSqlSessionFactoryã€‚</p><p>ç”Ÿå‘½å‘¨æœŸï¼šåªå­˜åœ¨äºæ–¹æ³•çš„å±€éƒ¨ã€‚</p><h4 id="2ã€SqlSessionFactory"><a href="#2ã€SqlSessionFactory" class="headerlink" title="2ã€SqlSessionFactory"></a>2ã€SqlSessionFactory</h4><p>ä½œç”¨ï¼šSqlSessionFactoryçš„è´£ä»»å”¯ä¸€ï¼Œå°±æ˜¯åˆ›å»ºSqlSessionä¼šè¯ã€‚é€‚åˆé‡‡ç”¨å•ä¾‹æ¨¡å¼ã€‚é¿å…æ•°æ®åº“è¿æ¥èµ„æºæ¶ˆè€—ã€‚</p><p>ç”Ÿå‘½å‘¨æœŸï¼šMybatisåº”ç”¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ã€‚</p><h4 id="3ã€SqlSession"><a href="#3ã€SqlSession" class="headerlink" title="3ã€SqlSession"></a>3ã€SqlSession</h4><p>ä½œç”¨ï¼šæ•°æ®åº“è¿æ¥ä¼šè¯ï¼Œç›¸å½“äºJDBCçš„Connectiondå¯¹è±¡ã€‚</p><p>ç”Ÿå‘½å‘¨æœŸï¼šè¯·æ±‚æ•°æ®åº“å¤„ç†äº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æ‰§è¡Œå¤šæ¡SQLä¿è¯äº‹åŠ¡ä¸€è‡´æ€§ã€‚</p><p>æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨å¯¹è±¡ï¼Œå¤šçº¿ç¨‹æ—¶éœ€è¦æ³¨å†Œéš”ç¦»çº§åˆ«å’Œæ•°æ®åº“é”ç­‰é«˜çº§ç‰¹æ€§ã€‚</p><p>æ³¨æ„SqlSessionä½¿ç”¨çš„å¼€å¯ä¸åŠæ—¶å…³é—­ã€‚</p><h4 id="4ã€Mapper"><a href="#4ã€Mapper" class="headerlink" title="4ã€Mapper"></a>4ã€Mapper</h4><p>åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ²¡æœ‰å®ç°ç±»ã€‚</p><p>ä½œç”¨ï¼šå‘é€SQLè¿”å›ç»“æœæˆ–æ‰§è¡ŒSQLä¿®æ”¹æ•°æ®ã€‚</p><p>ç”Ÿå‘½å‘¨æœŸï¼šåœ¨SqlSessionäº‹åŠ¡æ–¹æ³•å†…ï¼Œæ˜¯æ–¹æ³•çº§åˆ«ã€‚</p><br/><p><strong>ç›¸å…³æ–‡ç« ï¼š</strong></p><table><thead><tr><th>æ–‡ç« åç§°</th></tr></thead><tbody><tr><td><a href="b802139a.html">ã€ŠMybatis(ä¸€)ä¸»è¦ç»„ä»¶ã€‹</a></td></tr><tr><td><a href="5d11555a.html">ã€ŠMybatis(äºŒ)é…ç½®ã€‹</a></td></tr><tr><td><a href="d467df29.html">ã€ŠMybatis(ä¸‰)åŠ¨æ€SQLã€‹</a></td></tr><tr><td><a href="3bfa75b5.html">ã€ŠMybtis(å››)å·¥ä½œåŸç†ã€‹</a></td></tr><tr><td><a href="ae8510ea.html">ã€ŠMybtis(äº”)Mapperæ˜ å°„å™¨ã€‹</a></td></tr><tr><td><a href="44c4c800.html">ã€ŠMybtis(å…­)Mapperçº§è”ã€‹</a></td></tr></tbody></table><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java ç¯å¢ƒå˜é‡é…ç½®</title>
      <link href="/posts/a8179eeb.html"/>
      <url>/posts/a8179eeb.html</url>
      
        <content type="html"><![CDATA[<p>##ç¯å¢ƒå˜é‡é…ç½®å¤§å…¨ï¼š</p><blockquote><p>pathç¯å¢ƒå˜é‡ï¼Œä¸»è¦ä½œç”¨æ˜¯åœ¨è¿è¡Œä¸€ä¸ªç¨‹åº/å‘½ä»¤åˆæ²¡æœ‰æŒ‡å®šç¨‹åº/å‘½ä»¤çš„å®Œæ•´è·¯å¾„æ—¶ï¼Œç³»ç»Ÿé™¤äº†åœ¨å½“å‰ç›®å½•ä¸‹é¢å¯»æ‰¾æ­¤ç¨‹åºå¤–ï¼Œè¿˜ä¼šåˆ°é…ç½®çš„pathä¸­æŒ‡å®šçš„è·¯å¾„å»æ‰¾ï¼Œé€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ¥æ›´å¥½çš„è¿è¡Œè¿›ç¨‹ã€‚</p></blockquote><h3 id="JAVAç¯å¢ƒå˜é‡"><a href="#JAVAç¯å¢ƒå˜é‡" class="headerlink" title="JAVAç¯å¢ƒå˜é‡"></a>JAVAç¯å¢ƒå˜é‡</h3><p>1ã€æ–°å»ºç³»ç»Ÿç¯å¢ƒå˜é‡</p><p>å˜é‡åï¼šJAVA_HOME</p><p>å˜é‡å€¼ï¼š<code>C:\Program Files\Java\jdk1.8.0_191</code></p><p>å˜é‡å€¼å°±æ˜¯jdkå®‰è£…ç›®å½•ã€‚</p><p>2ã€é…ç½®Pathï¼Œ</p><p>ï¼ˆ1ï¼‰æœ‰å°±åœ¨å˜é‡å€¼å¤„è¿½åŠ ï¼Œä»¥<code>â€œ;â€</code>åˆ†éš”ï¼Œ</p><p>æ”¾æœ«å°¾ï¼š<code>ï¼›%JAVA_HOME%\bin</code></p><p>æ”¾å¼€å¤´ï¼š<code>%JAVA_HOME%\binï¼›</code></p><p>ï¼ˆ2ï¼‰æ²¡æœ‰å°±æ–°å»ºç³»ç»Ÿç¯å¢ƒå˜é‡</p><p>å˜é‡åï¼šPath</p><p>å˜é‡å€¼ï¼š %JAVA_HOME%\bin</p><p>3ã€é…ç½®CLASSPATH</p><p>å˜é‡åï¼šCLASSPATH</p><p>å˜é‡å€¼ï¼š<code>.;%JAVA_HOME%\lib;%JAVA_HOME%\lib\rt.jar%JAVA_HOME%\lib\tools.jar</code></p><blockquote><p>rt.jarï¼šJavaåŸºç¡€ç±»åº“ï¼Œä¹Ÿå°±æ˜¯Java docé‡Œé¢çœ‹åˆ°çš„æ‰€æœ‰çš„ç±»çš„classæ–‡ä»¶ã€‚</p><p>tools.jarï¼šæ˜¯ç³»ç»Ÿç”¨æ¥ç¼–è¯‘ä¸€ä¸ªç±»çš„æ—¶å€™ç”¨åˆ°çš„ï¼Œå³æ‰§è¡Œjavacçš„æ—¶å€™ç”¨åˆ°ã€‚</p></blockquote><p>4ã€é…ç½®éªŒè¯</p><p>æ‰§è¡Œ<code>java -version</code>ï¼Œ <code>javac</code> ,<code>java -verbose</code>ç­‰çš†å¯ã€‚</p><h3 id="MAVENç¯å¢ƒå˜é‡"><a href="#MAVENç¯å¢ƒå˜é‡" class="headerlink" title="MAVENç¯å¢ƒå˜é‡"></a>MAVENç¯å¢ƒå˜é‡</h3><p>1ã€æ–°å»ºç³»ç»Ÿç¯å¢ƒå˜é‡</p><p>å˜é‡åï¼šMAVEN_HOME</p><p>å˜é‡å€¼ï¼š<code>E:\apache-maven-3.3.9</code></p><p>å˜é‡å€¼å°±æ˜¯MAVENå®‰è£…ç›®å½•ã€‚</p><p>å¯ä»¥å‚è€ƒ <a href="http://maven.apache.org/install.html" target="_blank" rel="noopener">MAVENå®˜ç½‘å®‰è£…æŒ‡å—</a></p><p>2ã€é…ç½®setting.xml</p><p>é…ç½®æ–‡ä»¶ä¸€èˆ¬åœ¨<code>...\apache-maven-3.3.9\conf</code>ç›®å½•ä¸‹ã€‚</p><p>ï¼ˆ1ï¼‰æœ¬åœ°ä»“åº“è·¯å¾„ä¿®æ”¹ï¼š</p><p>ç›´æ¥æ”¾<code>&lt;settings&gt;</code>æ ¹èŠ‚ç‚¹ä¸‹å³å¯ã€‚</p><pre class=" language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localRepository</span><span class="token punctuation">></span></span>E:/server/MavenRepository/maven_jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localRepository</span><span class="token punctuation">></span></span></code></pre><p>å¦‚æœä¸é…ç½®ï¼Œé»˜è®¤è·¯å¾„æ˜¯ï¼š<code>C:/Users/${user.home}/.m2/repository</code></p><p>ï¼ˆ2ï¼‰ä¿®æ”¹æºé•œåƒä»“åº“åœ°å€ã€‚é»˜è®¤å»mavenå®˜æ–¹æºä»“åº“ä¸‹è½½å¤ªæ…¢äº†ï¼Œä¿®æ”¹ä¸ºå›½å†…çš„æºä»“åº“ã€‚</p><p>åœ¨mirrorsèŠ‚ç‚¹ä¸‹ï¼š</p><pre class=" language-xml"><code class="language-xml"> <span class="token comment" spellcheck="true">&lt;!-- é˜¿é‡Œäº‘ä¸­å¤®ä»“åº“ --></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>nexus-aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>Nexus aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>http://maven.aliyun.com/nexus/content/groups/public<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span></code></pre><p>3ã€åœ¨å¼€å‘å·¥å…·ä¸­é…ç½®ã€‚</p><p>ä¸€èˆ¬æ˜¯ï¼šwindowâ€”Preferencesâ€”mavenâ€”User Settings æ›´æ¢mavençš„setting.xmlé…ç½®ã€‚</p><p>æœ‰äº›å¼€å‘å·¥å…·å·²ç»å†…åµŒäº†mavenï¼Œé€šå¸¸é»˜è®¤çš„<code>setting.xml</code>æ–‡ä»¶ä½ç½®åœ¨ï¼š</p><p><code>C:/Users/${user.home}/.m2/setting.xml</code></p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>æƒ³åˆ°å†è¡¥å……ã€‚</p><br/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM LLGCï¼šShenandoah</title>
      <link href="/posts/f8161112.html"/>
      <url>/posts/f8161112.html</url>
      
        <content type="html"><![CDATA[<h2 id="JVMä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼šShenandoah"><a href="#JVMä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼šShenandoah" class="headerlink" title="JVMä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼šShenandoah"></a>JVMä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼šShenandoah</h2><p>ENï¼š JVM Low-Latency Garbage Collector : Shenandoah</p><h3 id="ä¸€-ã€Shenandoahç®€ä»‹"><a href="#ä¸€-ã€Shenandoahç®€ä»‹" class="headerlink" title="ä¸€ ã€Shenandoahç®€ä»‹"></a>ä¸€ ã€Shenandoahç®€ä»‹</h3><blockquote><p>ä¸€æ¬¾ä¸ç”±Oracleï¼ˆåŒ…æ‹¬ä»¥å‰çš„Sunï¼‰å…¬å¸çš„è™šæ‹Ÿæœºå›¢é˜Ÿæ‰€é¢†å¯¼å¼€å‘çš„HotSpotåƒåœ¾æ”¶é›†å™¨ã€‚åªæœ‰OpenJDKæ‰ä¼šåŒ…å«ï¼Œè€ŒOracleJDKé‡Œåè€Œä¸å­˜åœ¨çš„æ”¶é›†å™¨ï¼Œâ€œå…è´¹å¼€æºç‰ˆâ€æ¯”â€œæ”¶è´¹å•†ä¸šç‰ˆâ€åŠŸèƒ½æ›´å¤šã€‚</p></blockquote><blockquote><p>2014å¹´RedHatæŠŠShenandoahè´¡çŒ®ç»™äº†OpenJDKï¼Œå¹¶æ¨åŠ¨å®ƒæˆä¸ºOpenJDK 12çš„æ­£å¼ç‰¹æ€§ä¹‹ä¸€ï¼Œä¹Ÿå°±æ˜¯åæ¥çš„JEP 189ã€‚</p></blockquote><p>ç›®æ ‡ï¼š<strong>å®ç°ä¸€ç§èƒ½åœ¨ä»»ä½•å †å†…å­˜å¤§å°ä¸‹éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´é™åˆ¶åœ¨åæ¯«ç§’ä»¥å†…çš„åƒåœ¾æ”¶é›†å™¨ã€‚</strong></p><h3 id="äºŒã€Shenandoahç‰¹å¾åŠå®ç°æ€è·¯ï¼š"><a href="#äºŒã€Shenandoahç‰¹å¾åŠå®ç°æ€è·¯ï¼š" class="headerlink" title="äºŒã€Shenandoahç‰¹å¾åŠå®ç°æ€è·¯ï¼š"></a>äºŒã€Shenandoahç‰¹å¾åŠå®ç°æ€è·¯ï¼š</h3><p><strong>Shenandoahä¸»è¦ç‰¹å¾</strong>ï¼š</p><p>ï¼ˆ1ï¼‰åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€,å»é™¤ä¼ ç»Ÿåˆ†ä»£ã€‚</p><p>ï¼ˆ2ï¼‰å›æ”¶ç­–ç•¥ä¼˜å…ˆå¤„ç†å›æ”¶ä»·å€¼æœ€å¤§çš„Region</p><p>ï¼ˆ3ï¼‰æ”¯æŒå¹¶å‘çš„æ•´ç†ç®—æ³•ã€‚</p><p><strong>Shenandoahæ”¶é›†å™¨çš„å®ç°æ€è·¯</strong>ï¼š</p><p>ï¼ˆ1ï¼‰åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€ï¼Œé»˜è®¤ä¸ä½¿ç”¨åˆ†ä»£æ”¶é›†ï¼Œ<code>(ç›¸æ¯”G1çš„è®°å¿†é›†ï¼ˆRemberSetï¼‰å¤„ç†è·¨ä»£æŒ‡é’ˆæ—¶ç»´æŠ¤æ¶ˆè€—)</code>æ”¹ç”¨åä¸ºâ€œè¿æ¥çŸ©é˜µâ€ï¼ˆConnection Matrixï¼‰çš„å…¨å±€æ•°æ®ç»“æ„æ¥è®°å½•è·¨Regionçš„å¼•ç”¨å…³ç³»ã€‚é™ä½äº†ä¼ªå…±äº«é—®é¢˜çš„å‘ç”Ÿæ¦‚ç‡ã€‚</p><blockquote><p>è¿æ¥çŸ©é˜µå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€å¼ äºŒç»´è¡¨æ ¼ï¼Œå¦‚æœRegionNæœ‰å¯¹è±¡æŒ‡å‘Region Mï¼Œå°±åœ¨è¡¨æ ¼çš„Nè¡ŒMåˆ—ä¸­æ‰“ä¸Šä¸€ä¸ªæ ‡è®°ï¼Œå¦‚å›¾3-15æ‰€ç¤ºï¼Œå¦‚æœRegion 5ä¸­çš„å¯¹è±¡Bazå¼•ç”¨äº†Region 3çš„Fooï¼ŒFooåˆå¼•ç”¨äº†Region 1çš„Barï¼Œé‚£è¿æ¥çŸ©é˜µä¸­çš„5è¡Œ3åˆ—ã€3è¡Œ1åˆ—å°±åº”è¯¥è¢«æ‰“ä¸Šæ ‡è®°ã€‚åœ¨å›æ”¶æ—¶é€šè¿‡è¿™å¼ è¡¨æ ¼å°±å¯ä»¥å¾—å‡ºå“ªäº›Regionä¹‹é—´äº§ç”Ÿäº†è·¨ä»£å¼•ç”¨ã€‚</p></blockquote><p>ï¼ˆ2ï¼‰ä½¿ç”¨è½¬å‘æŒ‡é’ˆï¼ˆBrooks Pointerï¼‰å’Œè¯»å†™å±éšœæ¥å®ç°ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘çš„æ•´ç†ç®—æ³•ã€‚</p><blockquote><p>è½¬å‘æŒ‡é’ˆæ˜¯åœ¨åŸæœ‰å¯¹è±¡å¸ƒå±€ç»“æ„çš„æœ€å‰é¢ç»Ÿä¸€å¢åŠ ä¸€ä¸ªæ–°çš„å¼•ç”¨å­—æ®µï¼Œåœ¨æ­£å¸¸ä¸å¤„äºå¹¶å‘ç§»åŠ¨çš„æƒ…å†µä¸‹ï¼Œè¯¥å¼•ç”¨æŒ‡å‘å¯¹è±¡è‡ªå·±ã€‚<br>å½“å¯¹è±¡æ‹¥æœ‰äº†ä¸€ä»½æ–°çš„å‰¯æœ¬æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€å¤„æŒ‡é’ˆçš„å€¼ï¼Œå³æ—§å¯¹è±¡ä¸Šè½¬å‘æŒ‡é’ˆçš„å¼•ç”¨ä½ç½®ï¼Œä½¿å…¶æŒ‡å‘æ–°å¯¹è±¡ï¼Œä¾¿å¯å°†æ‰€æœ‰å¯¹è¯¥å¯¹è±¡çš„è®¿é—®è½¬å‘åˆ°æ–°çš„å‰¯æœ¬ä¸Šã€‚è¿™æ ·åªè¦æ—§å¯¹è±¡çš„å†…å­˜ä»ç„¶å­˜åœ¨ï¼Œæœªè¢«æ¸…ç†æ‰ï¼Œè™šæ‹Ÿæœºå†…å­˜ä¸­æ‰€æœ‰é€šè¿‡æ—§å¼•ç”¨åœ°å€è®¿é—®çš„ä»£ç ä¾¿ä»ç„¶å¯ç”¨ï¼Œéƒ½ä¼šè¢«è‡ªåŠ¨è½¬å‘åˆ°æ–°å¯¹è±¡ä¸Šç»§ç»­å·¥ä½œã€‚</p></blockquote><h3 id="ä¸‰ã€Shenandoahæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹ï¼ˆä¹é˜¶æ®µåˆ’åˆ†ï¼‰ï¼š"><a href="#ä¸‰ã€Shenandoahæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹ï¼ˆä¹é˜¶æ®µåˆ’åˆ†ï¼‰ï¼š" class="headerlink" title="ä¸‰ã€Shenandoahæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹ï¼ˆä¹é˜¶æ®µåˆ’åˆ†ï¼‰ï¼š"></a>ä¸‰ã€Shenandoahæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹ï¼ˆä¹é˜¶æ®µåˆ’åˆ†ï¼‰ï¼š</h3><h4 id="1-å§‹æ ‡è®°ï¼ˆInitial-Markingï¼‰"><a href="#1-å§‹æ ‡è®°ï¼ˆInitial-Markingï¼‰" class="headerlink" title="1. å§‹æ ‡è®°ï¼ˆInitial Markingï¼‰"></a>1. å§‹æ ‡è®°ï¼ˆInitial Markingï¼‰</h4><p>â€‹    ï¼ˆAï¼‰ä¸G1ä¸€æ ·ï¼Œé¦–å…ˆæ ‡è®°ä¸GC Rootsç›´æ¥å…³è”çš„å¯¹è±¡.</p><p>â€‹    ï¼ˆBï¼‰éœ€è¦â€œStop The Worldâ€ï¼Œæœ‰åœé¡¿ï¼Œä½†åœé¡¿æ—¶é—´ä¸å †å¤§å°æ— å…³ï¼Œåªä¸GC Rootsçš„æ•°é‡ç›¸å…³ã€‚</p><h4 id="2-å¹¶å‘æ ‡è®°ï¼ˆConcurrent-Markingï¼‰"><a href="#2-å¹¶å‘æ ‡è®°ï¼ˆConcurrent-Markingï¼‰" class="headerlink" title="2. å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰"></a>2. å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰</h4><p>â€‹    ï¼ˆAï¼‰<strong>é‡è¦çš„å¹¶å‘è¿‡ç¨‹ä¹‹ä¸€ã€‚</strong></p><p>â€‹    ï¼ˆBï¼‰ä¸G1ä¸€æ ·ï¼Œéå†å¯¹è±¡å›¾ï¼Œæ ‡è®°å‡ºå…¨éƒ¨å¯è¾¾çš„å¯¹è±¡ã€‚å¯è¾¾æ€§åˆ†æã€‚</p><p>â€‹    ï¼ˆCï¼‰ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæ—¶é—´é•¿çŸ­å–å†³äºå †ä¸­å­˜æ´»å¯¹è±¡çš„æ•°é‡ä»¥åŠå¯¹è±¡å›¾çš„ç»“æ„å¤æ‚ç¨‹åº¦ã€‚</p><h4 id="3-æœ€ç»ˆæ ‡è®°ï¼ˆFinal-Markingï¼‰"><a href="#3-æœ€ç»ˆæ ‡è®°ï¼ˆFinal-Markingï¼‰" class="headerlink" title="3. æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰"></a>3. æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰</h4><p>ï¼ˆAï¼‰ä¸G1ä¸€æ ·ï¼Œå¤„ç†å‰©ä½™çš„SATBæ‰«æï¼Œå¹¶åœ¨è¿™ä¸ªé˜¶æ®µç»Ÿè®¡å‡ºå›æ”¶ä»·å€¼æœ€é«˜çš„Regionï¼Œå°†è¿™äº›Regionæ„æˆä¸€ç»„å›æ”¶é›†ï¼ˆCollection Setï¼‰ã€‚</p><p>â€‹ï¼ˆBï¼‰ä¼šæœ‰ä¸€å°æ®µçŸ­æš‚çš„åœé¡¿ã€‚</p><h4 id="4-å¹¶å‘æ¸…ç†ï¼ˆConcurrent-Cleanupï¼‰"><a href="#4-å¹¶å‘æ¸…ç†ï¼ˆConcurrent-Cleanupï¼‰" class="headerlink" title="4. å¹¶å‘æ¸…ç†ï¼ˆConcurrent Cleanupï¼‰"></a>4. å¹¶å‘æ¸…ç†ï¼ˆConcurrent Cleanupï¼‰</h4><p>â€‹    ï¼ˆAï¼‰æ¸…ç†é‚£äº›æ•´ä¸ªåŒºåŸŸå†…è¿ä¸€ä¸ªå­˜æ´»å¯¹è±¡éƒ½æ²¡æœ‰æ‰¾åˆ°çš„Regionï¼ˆè¿™ç±»Regionè¢«ç§°ä¸ºImmediate Garbage Regionï¼‰ã€‚</p><h4 id="5-å¹¶å‘å›æ”¶ï¼ˆConcurrent-Evacuationï¼‰"><a href="#5-å¹¶å‘å›æ”¶ï¼ˆConcurrent-Evacuationï¼‰" class="headerlink" title="5. å¹¶å‘å›æ”¶ï¼ˆConcurrent Evacuationï¼‰"></a>5. å¹¶å‘å›æ”¶ï¼ˆConcurrent Evacuationï¼‰</h4><p>â€‹    ï¼ˆAï¼‰<strong>é‡è¦çš„å¹¶å‘è¿‡ç¨‹ä¹‹ä¸€ã€‚</strong>å¹¶å‘å›æ”¶é˜¶æ®µæ˜¯Shenandoahä¸ä¹‹å‰HotSpotä¸­å…¶ä»–æ”¶é›†å™¨çš„æ ¸å¿ƒå·®å¼‚ã€‚</p><p>â€‹    ï¼ˆBï¼‰Shenandoahè¦æŠŠå›æ”¶é›†é‡Œé¢çš„å­˜æ´»å¯¹è±¡å…ˆå¤åˆ¶ä¸€ä»½åˆ°å…¶ä»–æœªè¢«ä½¿ç”¨çš„Regionä¹‹ä¸­ã€‚</p><p>  ï¼ˆCï¼‰ä½¿ç”¨<strong>è¯»å±éšœ</strong>å’Œè¢«ç§°ä¸ºâ€Brooks Pointersâ€çš„<strong>è½¬å‘æŒ‡é’ˆ</strong>å®ç°å¹¶å‘è¿‡ç¨‹ï¼Œå¹¶å‘å›æ”¶é˜¶æ®µè¿è¡Œçš„æ—¶é—´é•¿çŸ­å–ã€‚</p><h4 id="6-åˆå§‹å¼•ç”¨æ›´æ–°ï¼ˆInitial-Update-Referenceï¼‰"><a href="#6-åˆå§‹å¼•ç”¨æ›´æ–°ï¼ˆInitial-Update-Referenceï¼‰" class="headerlink" title="6. åˆå§‹å¼•ç”¨æ›´æ–°ï¼ˆInitial Update Referenceï¼‰"></a>6. åˆå§‹å¼•ç”¨æ›´æ–°ï¼ˆInitial Update Referenceï¼‰</h4><p>â€‹    ï¼ˆAï¼‰å¹¶å‘å›æ”¶é˜¶æ®µå¤åˆ¶å¯¹è±¡ç»“æŸåï¼ŒæŠŠå †ä¸­æ‰€æœ‰æŒ‡å‘æ—§å¯¹è±¡çš„å¼•ç”¨ä¿®æ­£åˆ°å¤åˆ¶åçš„æ–°åœ°å€ï¼Œè¿™ä¸ªæ“ä½œç§°ä¸ºå¼•ç”¨æ›´æ–°ã€‚</p><p>â€‹    ï¼ˆBï¼‰æ­¤é˜¶æ®µå®é™…ä¸Šå¹¶æœªåšä»€ä¹ˆå…·ä½“çš„å¤„ç†ï¼Œè®¾ç«‹è¿™ä¸ªé˜¶æ®µåªæ˜¯ä¸ºäº†å»ºç«‹ä¸€ä¸ªçº¿ç¨‹é›†åˆç‚¹ï¼Œç¡®ä¿æ‰€æœ‰å¹¶å‘å›æ”¶é˜¶æ®µä¸­è¿›è¡Œçš„æ”¶é›†å™¨çº¿ç¨‹éƒ½å·²å®Œæˆåˆ†é…ç»™å®ƒä»¬çš„å¯¹è±¡ç§»åŠ¨ä»»åŠ¡è€Œå·²ã€‚</p><p>â€‹    ï¼ˆBï¼‰åˆå§‹å¼•ç”¨æ›´æ–°æ—¶é—´å¾ˆçŸ­ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªéå¸¸çŸ­æš‚çš„åœé¡¿ã€‚</p><h4 id="7-å¹¶å‘å¼•ç”¨æ›´æ–°ï¼ˆConcurrent-Update-Referenceï¼‰"><a href="#7-å¹¶å‘å¼•ç”¨æ›´æ–°ï¼ˆConcurrent-Update-Referenceï¼‰" class="headerlink" title="7. å¹¶å‘å¼•ç”¨æ›´æ–°ï¼ˆConcurrent Update Referenceï¼‰"></a>7. å¹¶å‘å¼•ç”¨æ›´æ–°ï¼ˆConcurrent Update Referenceï¼‰</h4><p>â€‹    ï¼ˆAï¼‰<strong>é‡è¦çš„å¹¶å‘è¿‡ç¨‹ä¹‹ä¸€ã€‚</strong></p><p>â€‹    ï¼ˆBï¼‰çœŸæ­£å¼€å§‹è¿›è¡Œå¼•ç”¨æ›´æ–°æ“ä½œï¼Œä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘çš„ï¼Œæ—¶é—´é•¿çŸ­å–å†³äºå†…å­˜ä¸­æ¶‰åŠçš„å¼•ç”¨æ•°é‡çš„å¤šå°‘ã€‚    </p><p>â€‹    ï¼ˆCï¼‰å¹¶å‘å¼•ç”¨æ›´æ–°ä¸å¹¶å‘æ ‡è®°ä¸åŒï¼Œå®ƒä¸å†éœ€è¦æ²¿ç€å¯¹è±¡å›¾æ¥æœç´¢ï¼Œåªéœ€è¦æŒ‰ç…§å†…å­˜ç‰©ç†åœ°å€çš„é¡ºåºï¼Œçº¿æ€§åœ°æœç´¢å‡ºå¼•ç”¨ç±»å‹ï¼ŒæŠŠæ—§å€¼æ”¹ä¸ºæ–°å€¼å³å¯ã€‚</p><h4 id="8-æœ€ç»ˆå¼•ç”¨æ›´æ–°ï¼ˆFinal-Update-Referenceï¼‰"><a href="#8-æœ€ç»ˆå¼•ç”¨æ›´æ–°ï¼ˆFinal-Update-Referenceï¼‰" class="headerlink" title="8. æœ€ç»ˆå¼•ç”¨æ›´æ–°ï¼ˆFinal Update Referenceï¼‰"></a>8. æœ€ç»ˆå¼•ç”¨æ›´æ–°ï¼ˆFinal Update Referenceï¼‰</h4><p>â€‹    ï¼ˆAï¼‰è§£å†³äº†å †ä¸­çš„å¼•ç”¨æ›´æ–°åï¼Œè¿˜è¦ä¿®æ­£å­˜åœ¨äºGCRootsä¸­çš„å¼•ç”¨ã€‚</p><p>â€‹    ï¼ˆBï¼‰æ­¤é˜¶æ®µæ˜¯Shenandoahçš„æœ€åä¸€æ¬¡åœé¡¿ï¼Œåœé¡¿æ—¶é—´åªä¸GC Rootsçš„æ•°é‡ç›¸å…³ã€‚</p><h4 id="9-å¹¶å‘æ¸…ç†ï¼ˆConcurrent-Cleanupï¼‰"><a href="#9-å¹¶å‘æ¸…ç†ï¼ˆConcurrent-Cleanupï¼‰" class="headerlink" title="9. å¹¶å‘æ¸…ç†ï¼ˆConcurrent Cleanupï¼‰"></a>9. å¹¶å‘æ¸…ç†ï¼ˆConcurrent Cleanupï¼‰</h4><p>ç»è¿‡å¹¶å‘å›æ”¶å’Œå¼•ç”¨æ›´æ–°ä¹‹åï¼Œæ•´ä¸ªå›æ”¶é›†ä¸­æ‰€æœ‰çš„Regionå·²å†æ— å­˜æ´»å¯¹è±¡ï¼Œè¿™äº›Regionéƒ½å˜æˆImmediate Garbage Regionsäº†ï¼Œæœ€åå†è°ƒç”¨ä¸€æ¬¡å¹¶å‘æ¸…ç†è¿‡ç¨‹æ¥å›æ”¶è¿™äº›Regionçš„å†…å­˜ç©ºé—´ï¼Œä¾›ä»¥åæ–°å¯¹è±¡åˆ†é…ä½¿ç”¨ã€‚</p><p> Shenandoahæ”¶é›†å™¨çš„é‡è¦çš„ä¸‰ä¸ªå¹¶å‘è¿‡ç¨‹ï¼š</p><ol><li>å¹¶å‘æ ‡è®°</li><li>å¹¶å‘å›æ”¶</li><li>å¹¶å‘å¼•ç”¨æ›´æ–°</li></ol><p>Shenandoahæ”¶é›†å™¨çš„å·¥ä½œæµç¨‹å›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-shen-andoah-do-job.png" alt="Shenandoahæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹"></p><p>å›¾ç‰‡æ¥æºï¼š<a href="https://shipilev.net/talks/devoxx-Nov2017-shenandoah.pdf" target="_blank" rel="noopener">ã€ŠShenandoah GC Part I: The Garbage Collector That Couldã€‹</a></p><p>è¯´æ˜ï¼š</p><p>é»„è‰²åŒºåŸŸä»£è¡¨çš„æ˜¯è¢«é€‰å…¥å›æ”¶é›†çš„Regionã€‚</p><p>ç»¿è‰²éƒ¨åˆ†å°±ä»£è¡¨è¿˜å­˜æ´»çš„å¯¹è±¡ã€‚</p><p>è“è‰²åŒºåŸŸå°±æ˜¯ç”¨æˆ·çº¿ç¨‹å¯ä»¥ç”¨æ¥åˆ†é…å¯¹è±¡çš„å†…å­˜Regionã€‚</p><h3 id="å››ã€GCæ”¶é›†å™¨æ¯”è¾ƒ"><a href="#å››ã€GCæ”¶é›†å™¨æ¯”è¾ƒ" class="headerlink" title="å››ã€GCæ”¶é›†å™¨æ¯”è¾ƒ"></a>å››ã€GCæ”¶é›†å™¨æ¯”è¾ƒ</h3><h4 id="1ã€Shenandoah-ä¸å…¶ä»–æ”¶é›†å™¨å¹¶å‘æ¯”è¾ƒ"><a href="#1ã€Shenandoah-ä¸å…¶ä»–æ”¶é›†å™¨å¹¶å‘æ¯”è¾ƒ" class="headerlink" title="1ã€Shenandoah ä¸å…¶ä»–æ”¶é›†å™¨å¹¶å‘æ¯”è¾ƒ"></a>1ã€Shenandoah ä¸å…¶ä»–æ”¶é›†å™¨å¹¶å‘æ¯”è¾ƒ</h4><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-shen-andoah.png" alt="Shenandoahä¸å…¶ä»–åƒåœ¾æ”¶é›†å™¨æ¯”è¾ƒ"></p><p>å›¾ç‰‡æ¥æºï¼š<a href="https://shipilev.net/talks/devoxx-Nov2017-shenandoah.pdf" target="_blank" rel="noopener">ã€ŠShenandoah GC Part I: The Garbage Collector That Couldã€‹</a></p><p>é»„è‰²ï¼šè¡¨ç¤ºå¿…é¡»æŒ‚èµ·ç”¨æˆ·çº¿ç¨‹</p><p>ç»¿è‰²ï¼šè¡¨ç¤ºæ”¶é›†å™¨çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚</p><p>ç»“è®ºï¼š</p><p>ï¼ˆ1ï¼‰CMSå’ŒG1ä¹‹å‰çš„å…¨éƒ¨æ”¶é›†å™¨ï¼Œå…¶å·¥ä½œçš„æ‰€æœ‰æ­¥éª¤éƒ½ä¼šäº§ç”Ÿâ€œStop TheWorldâ€å¼çš„åœé¡¿ï¼›</p><p>ï¼ˆ2ï¼‰CMSå’ŒG1åˆ†åˆ«ä½¿ç”¨å¢é‡æ›´æ–°å’ŒåŸå§‹å¿«ç…§(SATB)æŠ€æœ¯ï¼Œå®ç°äº†æ ‡è®°é˜¶æ®µçš„å¹¶å‘ï¼Œä¸ä¼šå› ç®¡ç†çš„å †å†…å­˜å˜å¤§ï¼Œè¦æ ‡è®°çš„å¯¹è±¡å˜å¤šè€Œå¯¼è‡´åœé¡¿æ—¶é—´éšä¹‹å¢é•¿ã€‚ä½†æ˜¯å¯¹äºæ ‡è®°é˜¶æ®µä¹‹åçš„å¤„ç†ï¼Œä»æœªå¾—åˆ°å¦¥å–„è§£å†³ã€‚</p><p>ï¼ˆ3ï¼‰CMSä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œè™½ç„¶é¿å…äº†æ•´ç†é˜¶æ®µæ”¶é›†å™¨å¸¦æ¥çš„åœé¡¿ï¼Œä½†æ˜¯æ¸…é™¤ç®—æ³•ä¸è®ºå¦‚ä½•ä¼˜åŒ–æ”¹è¿›ï¼Œåœ¨è®¾è®¡åŸç†ä¸Šé¿å…ä¸äº†ç©ºé—´ç¢ç‰‡çš„äº§ç”Ÿï¼Œéšç€ç©ºé—´ç¢ç‰‡ä¸æ–­æ·¤ç§¯æœ€ç»ˆä¾ç„¶é€ƒä¸è¿‡â€œStop The Worldâ€çš„å‘½è¿ã€‚</p><p>ï¼ˆ4ï¼‰G1è™½ç„¶å¯ä»¥æŒ‰æ›´å°çš„ç²’åº¦è¿›è¡Œå›æ”¶ï¼Œä»è€ŒæŠ‘åˆ¶æ•´ç†é˜¶æ®µå‡ºç°æ—¶é—´è¿‡é•¿çš„åœé¡¿ï¼Œä¹Ÿæœ‰æš‚åœã€‚</p><p>ï¼ˆ5ï¼‰Shenandoahåªæœ‰åˆå§‹æ ‡è®°ã€æœ€ç»ˆæ ‡è®°è¿™äº›é˜¶æ®µæœ‰çŸ­æš‚çš„åœé¡¿ï¼Œè¿™éƒ¨åˆ†åœé¡¿çš„æ—¶é—´åŸºæœ¬ä¸Šæ˜¯å›ºå®šçš„ï¼Œä¸å †çš„å®¹é‡ã€å †ä¸­å¯¹è±¡çš„æ•°é‡æ²¡æœ‰æ­£æ¯”ä¾‹å…³ç³»ã€‚</p><h4 id="2ã€Shenandoah-ä¸G1æ¯”è¾ƒ"><a href="#2ã€Shenandoah-ä¸G1æ¯”è¾ƒ" class="headerlink" title="2ã€Shenandoah ä¸G1æ¯”è¾ƒ"></a>2ã€Shenandoah ä¸G1æ¯”è¾ƒ</h4><table>    <th>        <td width="46%">Shenandoah</td>        <td width="46%">G1ï¼ˆGarbage Firstï¼‰</td>    </th>    <tr>    <td rowspan="3">ä¸åŒ</td>    <td >Shenandoahï¼ˆç›®å‰ï¼‰æ˜¯é»˜è®¤ä¸ä½¿ç”¨åˆ†ä»£æ”¶é›†çš„,ä¸ä¼šæœ‰ä¸“é—¨çš„æ–°ç”Ÿä»£Regionæˆ–è€…è€å¹´ä»£Regionçš„å­˜åœ¨ï¼Œæ²¡æœ‰å®ç°åˆ†ä»£ã€‚     </td>    <td >G1ä»ç„¶ä¿ç•™æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ¦‚å†µï¼Œåªæ˜¯å˜æˆRegionåŒºç»„æˆçš„é€»è¾‘è¿ç»­çš„åŠ¨æ€é›†åˆã€‚     </td>  </tr><tr>    <td >ä½¿ç”¨â€œè¿æ¥çŸ©é˜µâ€ï¼ˆConnection Matrixï¼‰çš„å…¨å±€æ•°æ®ç»“æ„æ¥è®°å½•è·¨Regionçš„å¼•ç”¨å…³ç³»ã€‚</td>    <td >ä½¿ç”¨è®°å¿†é›†ï¼ˆRember Setï¼‰é¿å…å…¨å †ä½œä¸ºGC Rootsæ‰«æ,æ¯ä¸ªRegionéƒ½ç»´æŠ¤æœ‰è‡ªå·±çš„è®°å¿†é›†ã€‚</td>  </tr><tr>    <td >Shenandoahé€šè¿‡è¯»å±éšœå’Œè¢«ç§°ä¸ºâ€œBrooks Pointersâ€çš„è½¬å‘æŒ‡é’ˆå®ç°å¹¶å‘å›æ”¶,æ”¯æŒä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘ã€‚ </td>    <td >G1çš„å›æ”¶é˜¶æ®µæ˜¯å¯ä»¥å¤šçº¿ç¨‹å¹¶è¡Œçš„ï¼Œä½†å´ä¸èƒ½ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘ã€‚ </td>  </tr><tr>    <td>ç›¸åŒ</td>    <td colspan="2">ï¼ˆ1ï¼‰éƒ½æ˜¯åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€ï¼Œéƒ½æœ‰ç”¨äºå­˜æ”¾å¤§å¯¹è±¡çš„Humongous Region<br/>ï¼ˆ2ï¼‰å¹¶å‘å›æ”¶æ€è·¯é«˜åº¦ä¸€è‡´ï¼Œ<br/>ï¼ˆ3ï¼‰é»˜è®¤çš„å›æ”¶ç­–ç•¥éƒ½æ˜¯ä¼˜å…ˆå¤„ç†å›æ”¶ä»·å€¼æœ€å¤§çš„Region<br/>ï¼ˆ4ï¼‰ éƒ½é‡‡ç”¨æ ‡è®°-æ•´ç†ï¼Œæ ‡è®°-å¤åˆ¶ç®—æ³•å›æ”¶ã€‚<br/></td>   </tr></table><h3 id="å››ã€ç›¸å…³æ¦‚å¿µ"><a href="#å››ã€ç›¸å…³æ¦‚å¿µ" class="headerlink" title="å››ã€ç›¸å…³æ¦‚å¿µ"></a>å››ã€ç›¸å…³æ¦‚å¿µ</h3><p><strong>å†™å±éšœ</strong>ï¼š<br>    åœ¨èµ‹å€¼æ“ä½œå‰åï¼ŒåŠ å…¥ä¸€äº›å¤„ç†ï¼ˆç±»ä¼¼é’ˆå¯¹å†™æ“ä½œè¿›è¡ŒAOPçš„å¤„ç†ï¼‰<br>    ç›®çš„é€šå¸¸æ˜¯ä¸ºäº†è®°å½•å¯¹è±¡å¼•ç”¨çš„å˜åŠ¨æƒ…å†µ</p><p><strong>è¯»å±éšœ</strong>ï¼š</p><p>â€‹   åœ¨è¯»å€¼æ“ä½œå‰åï¼ŒåŠ å…¥ä¸€äº›å¤„ç†ï¼ˆç±»ä¼¼é’ˆå¯¹è¯»æ“ä½œè¿›è¡ŒAOPçš„å¤„ç†ï¼‰<br>   ç›®çš„é€šå¸¸æ˜¯ä¸ºäº†è¯»å–å¯¹è±¡æ›´æ–°å¼•ç”¨åçš„åŸæœ‰ç›´ã€‚</p><blockquote><p>è¯´æ˜ï¼šè¯»å†™å±éšœæ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç§‘å­¦å®šä¹‰ï¼Œå†™å±éšœçš„ç†è§£æ¥è‡ªç½‘ç»œï¼Œè¯»å±éšœæ˜¯æ ¹æ®å†™å±éšœçš„ç†è§£æš‚ä½œè¯´æ˜çš„ï¼Œå¦‚æœä¸å½“ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p></blockquote><p><strong><span id="jump">æŒ‡é’ˆè½¬å‘</span></strong> Brooks Pointerï¼ˆForwarding Pointer / Indirection Pointerï¼‰</p><p>ç›¸å…³å†å²ç®€ä»‹ï¼š</p><p>1984å¹´ï¼ŒBrooksæå‡ºä½¿ç”¨è½¬å‘æŒ‡é’ˆæ¥å®ç°å¯¹è±¡ç§»åŠ¨ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p><p>Brooksæå‡ºçš„æ–°æ–¹æ¡ˆä¸éœ€è¦ç”¨åˆ°å†…å­˜ä¿æŠ¤é™·é˜±ï¼Œè€Œæ˜¯åœ¨åŸæœ‰å¯¹è±¡å¸ƒå±€ç»“æ„çš„æœ€å‰é¢ç»Ÿä¸€å¢åŠ ä¸€ä¸ªæ–°çš„å¼•ç”¨å­—æ®µï¼Œåœ¨æ­£å¸¸ä¸å¤„äºå¹¶å‘ç§»åŠ¨çš„æƒ…å†µä¸‹ï¼Œè¯¥å¼•ç”¨æŒ‡å‘å¯¹è±¡è‡ªå·±ã€‚å½“å¯¹è±¡æ‹¥æœ‰äº†ä¸€ä»½æ–°çš„å‰¯æœ¬æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€å¤„æŒ‡é’ˆçš„å€¼ï¼Œå³æ—§å¯¹è±¡ä¸Šè½¬å‘æŒ‡é’ˆçš„å¼•ç”¨ä½ç½®ï¼Œä½¿å…¶æŒ‡å‘æ–°å¯¹è±¡ï¼Œä¾¿å¯å°†æ‰€æœ‰å¯¹è¯¥å¯¹è±¡çš„è®¿é—®è½¬å‘åˆ°æ–°çš„å‰¯æœ¬ä¸Šã€‚è¿™æ ·åªè¦æ—§å¯¹è±¡çš„å†…å­˜ä»ç„¶å­˜åœ¨ï¼Œæœªè¢«æ¸…ç†æ‰ï¼Œè™šæ‹Ÿæœºå†…å­˜ä¸­æ‰€æœ‰é€šè¿‡æ—§å¼•ç”¨åœ°å€è®¿é—®çš„ä»£ç ä¾¿ä»ç„¶å¯ç”¨ï¼Œéƒ½ä¼šè¢«è‡ªåŠ¨è½¬å‘åˆ°æ–°å¯¹è±¡ä¸Šç»§ç»­å·¥ä½œï¼Œ</p><p>æŒ‡é’ˆè½¬å‘å¦‚å›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-shen-andoah-brooks-pointer.jpg" alt="æŒ‡é’ˆè½¬å‘ç¤ºæ„å›¾"></p><blockquote><p>Brookså½¢å¼çš„è½¬å‘æŒ‡é’ˆåœ¨è®¾è®¡ä¸Šå†³å®šäº†å®ƒæ˜¯å¿…ç„¶ä¼šå‡ºç°å¤šçº¿ç¨‹ç«äº‰é—®é¢˜çš„ï¼Œå¦‚æœæ”¶é›†å™¨çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å‘ç”Ÿçš„åªæ˜¯å¹¶å‘è¯»å–ï¼Œé‚£æ— è®ºè¯»åˆ°æ—§å¯¹è±¡è¿˜æ˜¯æ–°å¯¹è±¡ä¸Šçš„å­—æ®µï¼Œè¿”å›çš„ç»“æœéƒ½åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªåœºæ™¯è¿˜å¯ä»¥æœ‰ä¸€äº›â€œå·æ‡’â€çš„å¤„ç†ä½™åœ°ï¼›ä½†å¦‚æœå‘ç”Ÿçš„æ˜¯å¹¶å‘å†™å…¥ï¼Œå°±ä¸€å®šå¿…é¡»ä¿è¯å†™æ“ä½œåªèƒ½å‘ç”Ÿåœ¨æ–°å¤åˆ¶çš„å¯¹è±¡ä¸Šï¼Œè€Œä¸æ˜¯å†™å…¥æ—§å¯¹è±¡çš„å†…å­˜ä¸­ã€‚ä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…å¹¶å‘è¿›è¡Œæ—¶ï¼š</p></blockquote><p>1ï¼‰æ”¶é›†å™¨çº¿ç¨‹å¤åˆ¶äº†æ–°çš„å¯¹è±¡å‰¯æœ¬ï¼›<br>2ï¼‰ç”¨æˆ·çº¿ç¨‹æ›´æ–°å¯¹è±¡çš„æŸä¸ªå­—æ®µï¼›<br>3ï¼‰æ”¶é›†å™¨çº¿ç¨‹æ›´æ–°è½¬å‘æŒ‡é’ˆçš„å¼•ç”¨å€¼ä¸ºæ–°å‰¯æœ¬åœ°å€ã€‚</p><blockquote><p>å¦‚æœä¸åšä»»ä½•ä¿æŠ¤æªæ–½ï¼Œè®©äº‹ä»¶2åœ¨äº‹ä»¶1ã€äº‹ä»¶3ä¹‹é—´å‘ç”Ÿçš„è¯ï¼Œå°†å¯¼è‡´çš„ç»“æœå°±æ˜¯ç”¨æˆ·çº¿ç¨‹å¯¹å¯¹è±¡çš„å˜æ›´å‘ç”Ÿåœ¨æ—§å¯¹è±¡ä¸Šï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»é’ˆå¯¹è½¬å‘æŒ‡é’ˆçš„è®¿é—®æ“ä½œé‡‡å–åŒæ­¥æªæ–½ï¼Œè®©æ”¶é›†å™¨çº¿ç¨‹æˆ–è€…ç”¨æˆ·çº¿ç¨‹å¯¹è½¬å‘æŒ‡é’ˆçš„è®¿é—®åªæœ‰å…¶ä¸­ä¹‹ä¸€èƒ½å¤ŸæˆåŠŸï¼Œå¦å¤–ä¸€ä¸ªå¿…é¡»ç­‰å¾…ï¼Œé¿å…ä¸¤è€…äº¤æ›¿è¿›è¡Œã€‚å®é™…ä¸ŠShenandoahæ”¶é›†å™¨æ˜¯é€šè¿‡æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCompare And Swapï¼ŒCASï¼‰æ“ä½œæ¥ä¿è¯å¹¶å‘æ—¶å¯¹è±¡çš„è®¿é—®æ­£ç¡®æ€§çš„ã€‚</p></blockquote><blockquote><p>CASï¼šcompare and swapï¼Œè§£å†³å¤šçº¿ç¨‹å¹¶è¡Œæƒ…å†µä¸‹ä½¿ç”¨é”é€ æˆæ€§èƒ½æŸè€—çš„ä¸€ç§æœºåˆ¶ï¼ŒCASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”å†…å­˜ä½ç½®ï¼ˆVï¼‰ã€é¢„æœŸåŸå€¼ï¼ˆAï¼‰å’Œæ–°å€¼(B)ã€‚å¦‚æœå†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼ã€‚å¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œå®ƒéƒ½ä¼šåœ¨CASæŒ‡ä»¤ä¹‹å‰è¿”å›è¯¥ä½ç½®çš„å€¼ã€‚CASæœ‰æ•ˆåœ°è¯´æ˜äº†â€œæˆ‘è®¤ä¸ºä½ç½®Våº”è¯¥åŒ…å«å€¼Aï¼›å¦‚æœåŒ…å«è¯¥å€¼ï¼Œåˆ™å°†Bæ”¾åˆ°è¿™ä¸ªä½ç½®ï¼›å¦åˆ™ï¼Œä¸è¦æ›´æ”¹è¯¥ä½ç½®ï¼Œåªå‘Šè¯‰æˆ‘è¿™ä¸ªä½ç½®ç°åœ¨çš„å€¼å³å¯ã€‚</p></blockquote><p><strong>è½¬å‘æŒ‡é’ˆå’Œå¥æŸ„å®šä½æ¯”è¾ƒ</strong>ï¼š</p><table>    <th>        <td>è½¬å‘æŒ‡é’ˆ</td>        <td>å¥æŸ„å®šä½</td>    </th>    <tr>        <td rowspan="2">ä¸åŒ</td>        <td>åˆ†æ•£å­˜æ”¾åœ¨æ¯ä¸€ä¸ªå¯¹è±¡å¤´å‰é¢</td>        <td>ç»Ÿä¸€å­˜å‚¨åœ¨ä¸“é—¨çš„å¥æŸ„æ± ä¸­</td>    </tr>    <tr><td>å‡ºç°å¤šçº¿ç¨‹ç«äº‰é—®é¢˜</td>    <td></td></tr><tr>    <td>ç›¸åŒ</td>    <td colspan="2">é—´æ¥æ€§çš„å¯¹è±¡è®¿é—®æ–¹å¼ï¼›å¯¹è±¡è®¿é—®ä¼šå¸¦æ¥ä¸€æ¬¡é¢å¤–çš„è½¬å‘å¼€é”€</td></tr>    </table><p><strong>å†…å­˜ä¿æŠ¤é™·é˜±</strong>æ‰©å±•äº†è§£ï¼š</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œå®ç°ç±»ä¼¼çš„å¹¶å‘æ“ä½œï¼Œé€šå¸¸æ˜¯åœ¨è¢«ç§»åŠ¨å¯¹è±¡åŸæœ‰çš„å†…å­˜ä¸Šè®¾ç½®ä¿æŠ¤é™·é˜±ï¼ˆMemory Protection Trapï¼‰ï¼Œä¸€æ—¦ç”¨æˆ·ç¨‹åºè®¿é—®åˆ°å½’å±äºæ—§å¯¹è±¡çš„å†…å­˜ç©ºé—´å°±ä¼šäº§ç”Ÿè‡ªé™·ä¸­æ®µï¼Œè¿›å…¥é¢„è®¾å¥½çš„å¼‚å¸¸å¤„ç†å™¨ä¸­ï¼Œå†ç”±å…¶ä¸­çš„ä»£ç é€»è¾‘æŠŠè®¿é—®è½¬å‘åˆ°å¤åˆ¶åçš„æ–°å¯¹è±¡ä¸Šã€‚è™½ç„¶ç¡®å®èƒ½å¤Ÿå®ç°å¯¹è±¡ç§»åŠ¨ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ“ä½œç³»ç»Ÿå±‚é¢çš„ç›´æ¥æ”¯æŒï¼Œè¿™ç§æ–¹æ¡ˆå°†å¯¼è‡´ç”¨æˆ·æ€é¢‘ç¹åˆ‡æ¢åˆ°æ ¸å¿ƒæ€ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> åƒåœ¾æ”¶é›†å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM LLGCï¼šZGC</title>
      <link href="/posts/e3d9aed7.html"/>
      <url>/posts/e3d9aed7.html</url>
      
        <content type="html"><![CDATA[<h2 id="jvmä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨-ZGC"><a href="#jvmä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨-ZGC" class="headerlink" title="jvmä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ ZGC"></a>jvmä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ ZGC</h2><p>ENï¼š JVM Low-Latency Garbage Collector : Z Garbage Collector</p><h3 id="ä¸€-ã€ZGCç®€ä»‹"><a href="#ä¸€-ã€ZGCç®€ä»‹" class="headerlink" title="ä¸€ ã€ZGCç®€ä»‹"></a>ä¸€ ã€ZGCç®€ä»‹</h3><p>ä¸€æ¬¾åœ¨JDK 11ä¸­æ–°åŠ å…¥çš„å…·æœ‰å®éªŒæ€§è´¨[æ’å›¾]çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼Œæ˜¯ç”±Oracleå…¬å¸ç ”å‘çš„ã€‚2018å¹´Oracleåˆ›å»ºäº†JEP 333å°†ZGCæäº¤ç»™OpenJDKã€‚</p><h5 id="ä¸»è¦ç›®æ ‡ï¼š"><a href="#ä¸»è¦ç›®æ ‡ï¼š" class="headerlink" title="ä¸»è¦ç›®æ ‡ï¼š"></a>ä¸»è¦ç›®æ ‡ï¼š</h5><p>å°½å¯èƒ½å¯¹ååé‡å½±å“ä¸å¤ªå¤§çš„å‰æä¸‹ï¼Œå®ç°åœ¨ä»»æ„å †å†…å­˜å¤§å°ä¸‹éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´é™åˆ¶åœ¨åæ¯«ç§’ä»¥å†…çš„ä½å»¶è¿Ÿã€‚</p><p>æ¼”å˜ç®€å²ï¼š</p><p>Azul VMä¸Šçš„PGCï¼ˆPauseless GCï¼‰ : </p><p>â€‹    å®ç°äº†æ ‡è®°å’Œæ•´ç†é˜¶æ®µéƒ½å…¨ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œçš„åƒåœ¾æ”¶é›†ã€‚</p><p>Zing VMä¸Šçš„C4 ï¼ˆConcurrent Continuously Compacting Collectorï¼‰ ï¼š</p><p>â€‹     åœ¨PGCä¹‹ä¸Šå¢åŠ äº†åˆ†ä»£æ”¶é›†æ”¯æŒï¼Œå¤§å¹…æå‡äº†æ”¶é›†å™¨èƒ½å¤Ÿæ‰¿å—çš„å¯¹è±¡åˆ†é…é€Ÿåº¦ã€‚Azulçš„C4æ”¶é›†å™¨å®ç°äº†åˆ†ä»£æ”¶é›†åï¼Œèƒ½å¤Ÿåº”å¯¹çš„å¯¹è±¡åˆ†é…é€Ÿç‡å°±æ¯”ä¸åˆ†ä»£çš„PGCæ”¶é›†å™¨æå‡äº†åå€ä¹‹å¤šã€‚</p><p>PGCâ€”â€”ã€‹C4â€”â€”ã€‹ZGC</p><p>ç‰¹å¾ç®€ä»‹ï¼š</p><p>ZGCæ”¶é›†å™¨æ˜¯ä¸€æ¬¾åŸºäºRegionå†…å­˜å¸ƒå±€çš„ï¼Œï¼ˆæš‚æ—¶ï¼‰ä¸è®¾åˆ†ä»£çš„ï¼Œä½¿ç”¨äº†è¯»å±éšœã€æŸ“è‰²æŒ‡é’ˆå’Œå†…å­˜å¤šé‡æ˜ å°„ç­‰æŠ€æœ¯æ¥å®ç°å¯å¹¶å‘çš„æ ‡è®°-æ•´ç†ç®—æ³•çš„ï¼Œä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡çš„ä¸€æ¬¾åƒåœ¾æ”¶é›†å™¨ã€‚</p><h3 id="äºŒ-ZGCä¸»è¦ç‰¹å¾ï¼š"><a href="#äºŒ-ZGCä¸»è¦ç‰¹å¾ï¼š" class="headerlink" title="äºŒ ZGCä¸»è¦ç‰¹å¾ï¼š"></a>äºŒ ZGCä¸»è¦ç‰¹å¾ï¼š</h3><p>ï¼ˆ1ï¼‰ä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡ã€‚</p><p>ï¼ˆ2ï¼‰æš‚ä¸æ”¯æŒåˆ†ä»£çš„ï¼Œæ— è·¨ä»£å¼•ç”¨ã€‚</p><p>ï¼ˆ3ï¼‰åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€ã€‚</p><p>ï¼ˆ4ï¼‰æŸ“è‰²æŒ‡é’ˆå’Œè¯»å±éšœå®ç°å¹¶å‘æ•´ç†ç®—æ³•ã€‚Colored Pointerã€‚</p><p>ï¼ˆ5ï¼‰å†…å­˜å¤šé‡æ˜ å°„æŠ€æœ¯ã€‚</p><p>ï¼ˆ6ï¼‰æ”¯æŒâ€œNUMA-Awareâ€çš„å†…å­˜åˆ†é…ã€‚(NUMAéç»Ÿä¸€å†…å­˜è®¿é—®æ¶æ„)</p><h3 id="ä¸‰-ZGå†…å­˜å¸ƒå±€"><a href="#ä¸‰-ZGå†…å­˜å¸ƒå±€" class="headerlink" title="ä¸‰  ZGå†…å­˜å¸ƒå±€"></a>ä¸‰  ZGå†…å­˜å¸ƒå±€</h3><p>ZGCåœ¨x64ç¡¬ä»¶å¹³å°ä¸‹çš„å†…å­˜å¸ƒå±€å¦‚å›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-zgc-2.jpg" alt="ZGCçš„å †å†…å­˜å¸ƒå±€(å½©å›¾)"></p><p>ZGCçš„Region / Page / ZPage ç§°ä¸º Size Groups ,</p><p>å¤§è‡´åˆ†ä¸‰ç§ç±»ï¼š</p><p>ï¼ˆAï¼‰å°å‹Regionï¼ˆSmall Regionï¼‰ï¼šå®¹é‡å›ºå®šä¸º2MBï¼Œç”¨äºæ”¾ç½®å°äº256KBçš„å°å¯¹è±¡ã€‚</p><p>ï¼ˆBï¼‰ä¸­å‹Regionï¼ˆMedium Regionï¼‰ï¼šå®¹é‡å›ºå®šä¸º32MBï¼Œç”¨äºæ”¾ç½®å¤§äºç­‰äº256KBä½†å°äº4MBçš„å¯¹è±¡ã€‚</p><p>ï¼ˆCï¼‰å¤§å‹Regionï¼ˆLarge Regionï¼‰ï¼šå®¹é‡ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œä½†å¿…é¡»ä¸º2MBçš„æ•´æ•°å€ï¼Œç”¨äºæ”¾ç½®4MBæˆ–ä»¥ä¸Šçš„å¤§å¯¹è±¡ã€‚å®é™…å®¹é‡å®Œå…¨æœ‰å¯èƒ½å°äºä¸­å‹Regionï¼Œæœ€å°å®¹é‡å¯ä½è‡³4MBã€‚å¤§å‹Regionåœ¨ZGCçš„å®ç°ä¸­æ˜¯ä¸ä¼šè¢«é‡åˆ†é…ã€‚</p><h3 id="å››-å¹¶å‘æ•´ç†å®ç°ï¼šæŸ“è‰²æŒ‡é’ˆ"><a href="#å››-å¹¶å‘æ•´ç†å®ç°ï¼šæŸ“è‰²æŒ‡é’ˆ" class="headerlink" title="å›› å¹¶å‘æ•´ç†å®ç°ï¼šæŸ“è‰²æŒ‡é’ˆ"></a>å›› å¹¶å‘æ•´ç†å®ç°ï¼šæŸ“è‰²æŒ‡é’ˆ</h3><p>æŸ“è‰²æŒ‡é’ˆæŠ€æœ¯ï¼ˆColored Pointer   ã€Tag Pointeræˆ–è€…Version Pointerï¼‰æ˜¯ZGCçš„æ ‡å¿—æ€§è®¾è®¡ã€‚</p><p>æŸ“è‰²æŒ‡é’ˆæ˜¯ä¸€ç§ç›´æ¥å°†å°‘é‡é¢å¤–çš„ä¿¡æ¯å­˜å‚¨åœ¨æŒ‡é’ˆä¸Šçš„æŠ€æœ¯ã€‚åœ¨ZGCä¸­ä½¿ç”¨æŸ“è‰²æŒ‡é’ˆç›´æ¥æŠŠæ ‡è®°ä¿¡æ¯è®°åœ¨å¼•ç”¨å¯¹è±¡çš„æŒ‡é’ˆä¸Šã€‚</p><p>å‰ææ¡ä»¶ï¼šå†…å­˜å¤šé‡æ˜ å°„ï¼ˆMulti-Mappingï¼‰æŠ€æœ¯ã€‚</p><p>æŸ“è‰²æŒ‡é’ˆå¸¦æ¥çš„ä¸åˆ©ï¼š</p><p>â€‹    æŸ“è‰²æŒ‡é’ˆæœ‰4TBçš„å†…å­˜é™åˆ¶ï¼Œä¸èƒ½æ”¯æŒ32ä½å¹³å°ï¼Œä¸èƒ½æ”¯æŒå‹ç¼©æŒ‡é’ˆã€‚</p><p>æŸ“è‰²æŒ‡é’ˆå¸¦æ¥çš„ä¼˜åŠ¿ï¼š</p><p>â€‹    ï¼ˆ1ï¼‰æŸ“è‰²æŒ‡é’ˆå¯ä»¥ä½¿æŸä¸ªRegionçš„å­˜æ´»å¯¹è±¡è¢«ç§»èµ°ä¹‹åï¼Œè¯¥Regionç«‹å³å°±èƒ½å¤Ÿè¢«é‡Šæ”¾å’Œé‡ç”¨æ‰ã€‚</p><p>â€‹    ï¼ˆ2ï¼‰æŸ“è‰²æŒ‡é’ˆå¯ä»¥å¤§å¹…å‡å°‘åœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­å†…å­˜å±éšœçš„ä½¿ç”¨æ•°é‡ã€‚åªä½¿ç”¨äº†è¯»å±éšœï¼ˆæŸ“è‰²æŒ‡é’ˆ+æ— åˆ†ä»£å¼•ç”¨ï¼‰</p><p>â€‹    ï¼ˆ3ï¼‰æŸ“è‰²æŒ‡é’ˆå¯ä»¥ä½œä¸ºä¸€ç§å¯æ‰©å±•çš„å­˜å‚¨ç»“æ„ç”¨æ¥è®°å½•æ›´å¤šä¸å¯¹è±¡æ ‡è®°ã€é‡å®šä½è¿‡ç¨‹ç›¸å…³çš„æ•°æ®ï¼Œä»¥ä¾¿æ—¥åè¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚</p><h3 id="äº”-ZGCæ”¶é›†å·¥ä½œè¿‡ç¨‹"><a href="#äº”-ZGCæ”¶é›†å·¥ä½œè¿‡ç¨‹" class="headerlink" title="äº” ZGCæ”¶é›†å·¥ä½œè¿‡ç¨‹"></a>äº” ZGCæ”¶é›†å·¥ä½œè¿‡ç¨‹</h3><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-zgc-job.jpg" alt="ZGCæ”¶é›†å·¥ä½œè¿‡ç¨‹"></p><p>ZGCæ”¶é›†å·¥ä½œå…¨éƒ¨å››ä¸ªé˜¶æ®µéƒ½æ˜¯å¯ä»¥å¹¶å‘æ‰§è¡Œçš„ã€‚ä»…åœ¨ä¸¤ä¸ªé˜¶æ®µä¸­é—´ä¼šå­˜åœ¨çŸ­æš‚çš„åœé¡¿å°é˜¶æ®µã€‚</p><h4 id="1-å¹¶å‘æ ‡è®°ï¼ˆConcurrent-Markï¼‰"><a href="#1-å¹¶å‘æ ‡è®°ï¼ˆConcurrent-Markï¼‰" class="headerlink" title="1 å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰"></a>1 å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰</h4><p>ï¼ˆAï¼‰éå†å¯¹è±¡å›¾åšå¯è¾¾æ€§åˆ†æçš„é˜¶æ®µã€‚ï¼ˆåˆå§‹æ ‡è®°ã€æœ€ç»ˆæ ‡è®°ï¼‰</p><p>ï¼ˆBï¼‰æ ‡è®°è¿‡ç¨‹æ˜¯é¢å‘å…¨å †çš„ï¼Œæœ‰çŸ­æš‚åœé¡¿ã€‚</p><p>ï¼ˆCï¼‰ZGCçš„æ ‡è®°ä¸æ ‡è®°å¯¹è±¡ï¼Œä¼šæ›´æ–°æŸ“è‰²æŒ‡é’ˆä¸­çš„Marked 0ã€Marked 1æ ‡å¿—ä½ã€‚</p><h4 id="2-å¹¶å‘é¢„å¤‡é‡åˆ†é…ï¼ˆConcurrent-Prepare-for-Relocateï¼‰"><a href="#2-å¹¶å‘é¢„å¤‡é‡åˆ†é…ï¼ˆConcurrent-Prepare-for-Relocateï¼‰" class="headerlink" title="2 å¹¶å‘é¢„å¤‡é‡åˆ†é…ï¼ˆConcurrent Prepare for Relocateï¼‰"></a>2 å¹¶å‘é¢„å¤‡é‡åˆ†é…ï¼ˆConcurrent Prepare for Relocateï¼‰</h4><p>ï¼ˆAï¼‰ç»Ÿè®¡è¦æ¸…ç†çš„Region/ size groups, ç»„æˆé‡åˆ†é…é›†ï¼ˆRelocation Setï¼‰</p><p>ï¼ˆBï¼‰ç»Ÿè®¡èŒƒå›´æ˜¯é¢å‘å…¨å †çš„ã€‚</p><p>ï¼ˆCï¼‰åœ¨JDK 12çš„ZGCä¸­å¼€å§‹æ”¯æŒçš„ç±»å¸è½½ä»¥åŠå¼±å¼•ç”¨çš„å¤„ç†ï¼Œä¹Ÿæ˜¯åœ¨è¿™ä¸ªé˜¶æ®µä¸­å®Œæˆçš„ã€‚</p><h4 id="3-å¹¶å‘é‡åˆ†é…ï¼ˆConcurrent-Relocateï¼‰"><a href="#3-å¹¶å‘é‡åˆ†é…ï¼ˆConcurrent-Relocateï¼‰" class="headerlink" title="3 å¹¶å‘é‡åˆ†é…ï¼ˆConcurrent Relocateï¼‰"></a>3 å¹¶å‘é‡åˆ†é…ï¼ˆConcurrent Relocateï¼‰</h4><p>ï¼ˆAï¼‰æ˜¯ZGCæ‰§è¡Œè¿‡ç¨‹çš„æ ¸å¿ƒé˜¶æ®µã€‚</p><p>ï¼ˆBï¼‰æŠŠé‡åˆ†é…é›†ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°çš„Regionä¸Šï¼Œå¹¶ä¸ºé‡åˆ†é…é›†ä¸­çš„æ¯ä¸ªRegionç»´æŠ¤ä¸€ä¸ªè½¬å‘è¡¨ï¼ˆForward Tableï¼‰ï¼Œè®°å½•ä»æ—§å¯¹è±¡åˆ°æ–°å¯¹è±¡çš„è½¬å‘å…³ç³»ã€‚</p><p>ï¼ˆCï¼‰æŒ‡é’ˆè‡ªæ„ˆï¼ˆSelf-Healingï¼‰</p><p>å› ä¸ºæŸ“è‰²æŒ‡é’ˆçš„æ”¯æŒï¼ŒZGCæ”¶é›†å™¨èƒ½ä»…ä»å¼•ç”¨ä¸Šå°±æ˜ç¡®å¾—çŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¤„äºé‡åˆ†é…é›†ä¹‹ä¸­ï¼Œå¦‚æœç”¨æˆ·çº¿ç¨‹æ­¤æ—¶å¹¶å‘è®¿é—®äº†ä½äºé‡åˆ†é…é›†ä¸­çš„å¯¹è±¡ï¼Œè¿™æ¬¡è®¿é—®å°†ä¼šè¢«é¢„ç½®çš„å†…å­˜å±éšœæ‰€æˆªè·ï¼Œç„¶åç«‹å³æ ¹æ®Regionä¸Šçš„è½¬å‘è¡¨è®°å½•å°†è®¿é—®è½¬å‘åˆ°æ–°å¤åˆ¶çš„å¯¹è±¡ä¸Šï¼Œå¹¶åŒæ—¶ä¿®æ­£æ›´æ–°è¯¥å¼•ç”¨çš„å€¼ï¼Œä½¿å…¶ç›´æ¥æŒ‡å‘æ–°å¯¹è±¡ï¼ŒZGCå°†è¿™ç§è¡Œä¸ºç§°ä¸ºæŒ‡é’ˆçš„â€œè‡ªæ„ˆâ€ï¼ˆSelf-Healingï¼‰èƒ½åŠ›ã€‚</p><pre><code>Shenandoahè½¬å‘æŒ‡é’ˆä¸ZGCæŸ“è‰²æŒ‡é’ˆæ¯”è¾ƒï¼š    Shenandoahçš„Brooksè½¬å‘æŒ‡é’ˆæ¯æ¬¡éƒ½è¦è½¬å‘ã€‚    ZGCçš„æŸ“è‰²æŒ‡é’ˆå¯ä»¥æŒ‡é’ˆè‡ªæ„ˆï¼Œåªè½¬å‘ä¸€æ¬¡ã€‚</code></pre><h4 id="4-å¹¶å‘é‡æ˜ å°„ï¼ˆConcurrent-Remapï¼‰"><a href="#4-å¹¶å‘é‡æ˜ å°„ï¼ˆConcurrent-Remapï¼‰" class="headerlink" title="4 å¹¶å‘é‡æ˜ å°„ï¼ˆConcurrent Remapï¼‰"></a>4 å¹¶å‘é‡æ˜ å°„ï¼ˆConcurrent Remapï¼‰</h4><p>ï¼ˆAï¼‰ä¿®æ­£æ•´ä¸ªå †ä¸­æŒ‡å‘é‡åˆ†é…é›†ä¸­æ—§å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨ã€‚ï¼ˆç±»ä¼¼Shenandoahçš„å¼•ç”¨æ›´æ–°ï¼‰</p><p>ï¼ˆBï¼‰é‡æ˜ å°„æ¸…ç†è¿™äº›æ—§å¼•ç”¨çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ä¸å˜æ…¢ï¼Œè¿˜å¯ä»¥é‡Šæ”¾è½¬å‘è¡¨ã€‚</p><p>ï¼ˆCï¼‰å¹¶å‘é‡æ˜ å°„é˜¶æ®µè¦åšçš„å·¥ä½œåˆå¹¶åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å¾ªç¯ä¸­çš„å¹¶å‘æ ‡è®°é˜¶æ®µé‡Œå»å®Œæˆã€‚</p><h3 id="å…­-ZGCä¼˜ç¼ºç‚¹"><a href="#å…­-ZGCä¼˜ç¼ºç‚¹" class="headerlink" title="å…­ ZGCä¼˜ç¼ºç‚¹"></a>å…­ ZGCä¼˜ç¼ºç‚¹</h3><p>1.ï¼ˆä¸å…¶ä»–æ”¶é›†å™¨ç›¸æ¯”ï¼‰ä¼˜ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰åŠ¨æ€çš„Regionå¸ƒå±€ã€‚</p><p>ï¼ˆ2ï¼‰æ— è®°å¿†é›†ï¼Œä¸å å¤§é‡å†…å­˜ã€‚</p><p>ï¼ˆ3ï¼‰æ— åˆ†ä»£ï¼Œæ— å¡è¡¨ï¼Œæ— å†™å±éšœã€‚ï¼ˆæŸ“è‰²æŒ‡é’ˆï¼‰</p><p>ï¼ˆ4ï¼‰æ”¯æŒâ€œNUMA-Awareâ€çš„å†…å­˜åˆ†é…ã€‚NUMAï¼ˆNon-Uniform Memory Accessï¼Œéç»Ÿä¸€å†…å­˜è®¿é—®æ¶æ„ï¼‰æ˜¯ä¸€ç§ä¸ºå¤šå¤„ç†å™¨æˆ–è€…å¤šæ ¸å¤„ç†å™¨çš„è®¡ç®—æœºæ‰€è®¾è®¡çš„å†…å­˜æ¶æ„</p><p>2.ï¼ˆä¸å…¶ä»–æ”¶é›†å™¨ç›¸æ¯”ï¼‰ç¼ºç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰å †ç©ºé—´è¾ƒå¤§æ—¶ï¼Œå¹¶å‘æ”¶é›†çš„å‘¨æœŸè¾ƒé•¿ï¼Œæµ®åŠ¨åƒåœ¾å¤šï¼Œå¯¹è±¡åˆ†é…é€Ÿç‡ä¸ä¼šå¤ªé«˜ã€‚</p><p>ï¼ˆ2ï¼‰éœ€è¦è¾ƒå¤§çš„å †ï¼ˆHeapï¼‰å®¹é‡ã€‚</p><h3 id="ä¸ƒ-æ€§èƒ½åŠå‰æ™¯"><a href="#ä¸ƒ-æ€§èƒ½åŠå‰æ™¯" class="headerlink" title="ä¸ƒ æ€§èƒ½åŠå‰æ™¯"></a>ä¸ƒ æ€§èƒ½åŠå‰æ™¯</h3><p>ç›®å‰å¤„äºæµ‹è¯•é˜¶æ®µã€‚ZGCä¸Parallel Scavengeã€G1ä¸‰æ¬¾æ”¶é›†å™¨é€šè¿‡SPECjbb 2015 çš„æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-zgc-compare1.jpg" alt="ZGCçš„ååé‡æµ‹è¯•"></p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-zgc-compare2.jpg" alt="ZGCçš„åœé¡¿æ—¶é—´æµ‹è¯•"></p><p>ï¼ˆ1ï¼‰ZGCçš„â€œå¼±é¡¹â€ååé‡</p><p>åœ¨ZGCçš„â€œå¼±é¡¹â€ååé‡æ–¹é¢ï¼Œä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡çš„ZGCå·²ç»è¾¾åˆ°äº†ä»¥é«˜ååé‡ä¸ºç›®æ ‡Parallel Scavengeçš„99%ï¼Œç›´æ¥è¶…è¶Šäº†G1ã€‚å¦‚æœå°†ååé‡æµ‹è¯•è®¾å®šä¸ºé¢å‘SLAï¼ˆService LevelAgreementsï¼‰åº”ç”¨çš„â€œCritical Throughputâ€çš„è¯[æ’å›¾]ï¼ŒZGCçš„è¡¨ç°ç”šè‡³è¿˜åè¶…äº†ParallelScavengeæ”¶é›†å™¨ã€‚</p><p>ï¼ˆ2ï¼‰ZGCçš„å¼ºé¡¹åœé¡¿æ—¶é—´</p><p>ZGCçš„å¼ºé¡¹åœé¡¿æ—¶é—´æµ‹è¯•ä¸Šï¼Œå®ƒå°±æ¯«ä¸ç•™æƒ…åœ°ä¸Parallel Scavengeã€G1æ‹‰å¼€äº†ä¸¤ä¸ªæ•°é‡çº§çš„å·®è·ã€‚ä¸è®ºæ˜¯å¹³å‡åœé¡¿ï¼Œè¿˜æ˜¯95%åœé¡¿ã€99%åœé¡¿ã€99.9%åœé¡¿ï¼ŒæŠ‘æˆ–æ˜¯æœ€å¤§åœé¡¿æ—¶é—´ï¼ŒZGCå‡èƒ½æ¯«ä¸è´¹åŠ²åœ°æ§åˆ¶åœ¨åæ¯«ç§’ä¹‹å†…ã€‚ZGCçš„åœé¡¿æ—¶é—´æµ‹è¯•å›¾ä¸­aï¼‰æ˜¯ZGCçš„æŸ±çŠ¶æ¡ï¼Œbï¼‰çºµåæ ‡ä»çº¿æ€§å°ºåº¦è°ƒæ•´æˆå¯¹æ•°å°ºåº¦ã€‚</p><p>ï¼ˆ3ï¼‰å°†ä¼šæˆä¸ºæœåŠ¡ç«¯ã€å¤§å†…å­˜ã€ä½å»¶è¿Ÿåº”ç”¨çš„é¦–é€‰æ”¶é›†å™¨çš„æœ‰åŠ›ç«äº‰è€…ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> åƒåœ¾æ”¶é›†å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmä¹‹åƒåœ¾æ”¶é›†å™¨</title>
      <link href="/posts/d01dbbb1.html"/>
      <url>/posts/d01dbbb1.html</url>
      
        <content type="html"><![CDATA[<h2 id="jvm-åƒåœ¾æ”¶é›†å™¨"><a href="#jvm-åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="jvm åƒåœ¾æ”¶é›†å™¨"></a>jvm åƒåœ¾æ”¶é›†å™¨</h2><h2 id="ä¸€-å…³äºåƒåœ¾æ”¶é›†å™¨"><a href="#ä¸€-å…³äºåƒåœ¾æ”¶é›†å™¨" class="headerlink" title="ä¸€ å…³äºåƒåœ¾æ”¶é›†å™¨"></a>ä¸€ å…³äºåƒåœ¾æ”¶é›†å™¨</h2><blockquote><p>åƒåœ¾æ”¶é›†å™¨æ˜¯åƒåœ¾å›æ”¶ç®—æ³•ï¼ˆæ ‡è®°-æ¸…é™¤ç®—æ³•ã€æ ‡è®°-å¤åˆ¶ç®—æ³•ã€æ ‡è®°-æ•´ç†ç®—æ³•ã€åŠå¤åˆ¶ç®—æ³•ï¼‰çš„å…·ä½“å®ç°ï¼Œä¸åŒå•†å®¶ã€ä¸åŒç‰ˆæœ¬çš„JVMæ‰€æä¾›çš„åƒåœ¾æ”¶é›†å™¨å¯èƒ½ä¼šæœ‰å¾ˆåœ¨å·®åˆ«ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»HotSpotè™šæ‹Ÿæœºä¸­çš„åƒåœ¾æ”¶é›†å™¨ã€‚</p></blockquote><p>ç›¸å…³æœ¯è¯­</p><h3 id="1-å¹¶è¡Œä¸å¹¶å‘"><a href="#1-å¹¶è¡Œä¸å¹¶å‘" class="headerlink" title="1. å¹¶è¡Œä¸å¹¶å‘"></a>1. å¹¶è¡Œä¸å¹¶å‘</h3><table><thead><tr><th>å¹¶è¡Œï¼ˆParallelï¼‰</th><th>å¹¶å‘ï¼ˆConcurrentï¼‰</th></tr></thead><tbody><tr><td>æŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹åŒä¸€æ—¶é—´å¹¶è¡ŒååŒå·¥ä½œï¼Œæ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ï¼›å¦‚ParNewã€Parallel Scavengeã€Parallel Oldï¼›</td><td>æŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶éƒ½åœ¨æ‰§è¡Œï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼›ç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œæœªè¢«å†»ç»“ï¼Œç¨‹åºä»ç„¶èƒ½å“åº”æœåŠ¡è¯·æ±‚ã€‚åƒåœ¾æ”¶é›†ç¨‹åºçº¿ç¨‹å ç”¨ç³»ç»Ÿèµ„æºã€‚å¦‚CMSã€G1ï¼ˆä¹Ÿæœ‰å¹¶è¡Œï¼‰ï¼›</td></tr></tbody></table><h3 id="2-éƒ¨åˆ†æ”¶é›†å’Œæ•´å †æ”¶é›†"><a href="#2-éƒ¨åˆ†æ”¶é›†å’Œæ•´å †æ”¶é›†" class="headerlink" title="2. éƒ¨åˆ†æ”¶é›†å’Œæ•´å †æ”¶é›†"></a>2. éƒ¨åˆ†æ”¶é›†å’Œæ•´å †æ”¶é›†</h3><p>ï¼ˆ1ï¼‰éƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰ï¼š</p><p>â€‹    æŒ‡ç›®æ ‡ä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ªJavaå †çš„åƒåœ¾æ”¶é›†ã€‚ä¸»è¦ä¸‰ç§ï¼š</p><p>â€‹    A. æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC/Young GCï¼‰ï¼šæŒ‡ç›®æ ‡åªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†ã€‚<br>â€‹    B. è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC/Old GCï¼‰ï¼šæŒ‡ç›®æ ‡åªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰CMSæ”¶é›†å™¨ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚</p><p>â€‹    C. æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šæŒ‡ç›®æ ‡æ˜¯æ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰G1æ”¶é›†å™¨ä¼šæœ‰è¿™ç§è¡Œä¸ºã€‚    </p><p>ï¼ˆ2ï¼‰æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªJavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ï¼šâ€œMajor GCâ€è¿™ä¸ªè¯´æ³•ç°åœ¨æœ‰ç‚¹æ··æ·†ï¼Œåœ¨ä¸åŒèµ„æ–™ä¸Šå¸¸æœ‰ä¸åŒæ‰€æŒ‡ï¼Œè¯·æŒ‰èµ„æ–™ä¸Šä¸‹æ–‡åŒºåˆ†åˆ°åº•æ˜¯æŒ‡è€å¹´ä»£çš„æ”¶é›†è¿˜æ˜¯æ•´å †æ”¶é›†ã€‚å› ä¸ºæœ‰çš„Major GCè¡¨ç¤ºè€å¹´ä»£GCæœ‰çš„è¡¨ç¤ºæ•´å †GCã€‚</p></blockquote><h3 id="3-æ”¶é›†å™¨çš„æŒ‡æ ‡"><a href="#3-æ”¶é›†å™¨çš„æŒ‡æ ‡" class="headerlink" title="3. æ”¶é›†å™¨çš„æŒ‡æ ‡"></a>3. æ”¶é›†å™¨çš„æŒ‡æ ‡</h3><p>æ”¶é›†å™¨çš„æŒ‡æ ‡ä¸€èˆ¬ä½“ç°åœ¨è®¾è®¡å®ƒçš„ç›®çš„ä¸Šï¼Œå¦‚ï¼šParallel Scavengeæ”¶é›†å™¨é¦–è¦ç›®æ ‡æ˜¯ååé‡ã€‚</p><p>ä¸»è¦æƒè¡¡æŒ‡æ ‡æœ‰ä¸‰ä¸ªï¼š</p><p>ï¼ˆAï¼‰ä½å»¶è¿Ÿ</p><p>ï¼ˆBï¼‰ååé‡</p><p>ï¼ˆCï¼‰è¾ƒå°çš„å†…å­˜å ç”¨</p><h2 id="äºŒ-Hotspotä¸ƒç§åƒåœ¾æ”¶é›†å™¨"><a href="#äºŒ-Hotspotä¸ƒç§åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="äºŒ Hotspotä¸ƒç§åƒåœ¾æ”¶é›†å™¨"></a>äºŒ Hotspotä¸ƒç§åƒåœ¾æ”¶é›†å™¨</h2><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gcr-1.jpg" alt="å¸¸è§çš„ä¸ƒç§åƒåœ¾æ”¶é›†å™¨"><br>ï¼ˆå›¾ç‰‡æ¥è‡ªã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœº:jvmé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ ã€‹ç¬¬ä¸‰ç‰ˆã€‚JVMç³»åˆ—é»‘ç™½å›¾å‡æ¥è‡ªç”µå­ä¹¦ï¼Œå½©å›¾æ¥è‡ªç½‘ç»œï¼‰</p><p>å›¾ä¸­æ˜¯ä¸ƒç§ä½œç”¨äºä¸åŒåˆ†ä»£çš„æ”¶é›†å™¨ã€‚<br>å¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿ï¼Œå°±è¯´æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ã€‚<br>å›¾ä¸­æ”¶é›†å™¨æ‰€å¤„çš„åŒºåŸŸï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯å±äºæ–°ç”Ÿä»£æ”¶é›†å™¨æŠ‘æˆ–æ˜¯è€å¹´ä»£æ”¶é›†å™¨ã€‚<br>å…¶ä¸­Serial Oldä½œä¸ºCMSå‡ºç°â€Concurrent Mode Failureâ€å¤±è´¥çš„åå¤‡é¢„æ¡ˆã€‚</p><p>æ•´ç†æˆè¡¨æ ¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ”¶é›†åŒºåŸŸ</th><th>æ”¶é›†å™¨</th></tr></thead><tbody><tr><td>æ–°ç”Ÿä»£æ”¶é›†å™¨</td><td>Serialã€ParNewã€Parallel Scavenge</td></tr><tr><td>è€å¹´ä»£æ”¶é›†å™¨</td><td>Serial Oldã€Parallel Oldã€CMS</td></tr><tr><td>æ•´å †æ”¶é›†å™¨</td><td>G1</td></tr></tbody></table><h3 id="1ã€Serial-æ”¶é›†å™¨"><a href="#1ã€Serial-æ”¶é›†å™¨" class="headerlink" title="1ã€Serial æ”¶é›†å™¨"></a>1ã€Serial æ”¶é›†å™¨</h3><p>Serial ä¸²å£ï¼Œä¸²è¡Œçš„æ„æ€ã€‚</p><blockquote><p>Serialæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹å·¥ä½œçš„æ”¶é›†å™¨ã€‚æ˜¯HotSpotè™šæ‹Ÿæœºè¿è¡Œåœ¨å®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œæœ‰ç€ä¼˜äºå…¶ä»–æ”¶é›†å™¨çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯ç®€å•è€Œé«˜æ•ˆã€‚ï¼ˆé«˜æ•ˆæ˜¯æŒ‡ä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰</p></blockquote><h4 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><p>â€‹    ï¼ˆ1ï¼‰é’ˆå¯¹æ–°ç”Ÿä»£çš„æ”¶é›†å™¨ã€‚<br>    ï¼ˆ2ï¼‰åªä¼šä½¿ç”¨ä¸€ä¸ªå¤„ç†å™¨æˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-5-gc-serial.jpg" alt="Serialæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><h3 id="2ã€ParNew-æ”¶é›†å™¨"><a href="#2ã€ParNew-æ”¶é›†å™¨" class="headerlink" title="2ã€ParNew æ”¶é›†å™¨"></a>2ã€ParNew æ”¶é›†å™¨</h3><p>ParNewæ”¶é›†å™¨å®è´¨ä¸Šæ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹å¹¶è¡Œç‰ˆæœ¬ã€‚å…¶ä½™çš„è¡Œä¸ºåŒ…æ‹¬Serialæ”¶é›†å™¨å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å‚æ•°ï¼ˆä¾‹å¦‚ï¼š<code>-XXï¼šSurvivorRatio</code>ã€<code>-XXï¼šPretenureSizeThreshold</code>ã€<code>-XXï¼šHandlePromotionFailure</code>ç­‰ï¼‰ã€æ”¶é›†ç®—æ³•ã€Stop The Worldã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰éƒ½ä¸Serialæ”¶é›†å™¨å®Œå…¨ä¸€è‡´ã€‚äºŒè€…å…±ç”¨è®¸å¤šä»£ç ã€‚</p><h4 id="ç‰¹ç‚¹ï¼š-1"><a href="#ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><p>â€‹    ï¼ˆ1ï¼‰æ–°ç”Ÿä»£æ”¶é›†å™¨</p><p>â€‹    ï¼ˆ2ï¼‰æ”¯æŒå¤šçº¿ç¨‹å¹¶è¡Œæ”¶é›†ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-5-gc-ParNew.jpg" alt="ParNew/Serial Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><p>ParNewæ”¶é›†å™¨æ˜¯æ¿€æ´»CMSåï¼ˆä½¿ç”¨-XXï¼š+UseConcMarkSweepGCé€‰é¡¹ï¼‰çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨-XXï¼š+/-UseParNewGCé€‰é¡¹æ¥å¼ºåˆ¶æŒ‡å®šæˆ–è€…ç¦ç”¨å®ƒã€‚</p><h3 id="3ã€Parallel-Scavenge-æ”¶é›†å™¨"><a href="#3ã€Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="3ã€Parallel Scavenge æ”¶é›†å™¨"></a>3ã€Parallel Scavenge æ”¶é›†å™¨</h3><p>Parallel Scavengeæ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€æ¬¾æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå®ƒåŒæ ·æ˜¯åŸºäºæ ‡è®°-å¤åˆ¶ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿå¹¶è¡Œæ”¶é›†çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚æ—©æœŸåªèƒ½å’ŒSerial Oldæ­é…ã€‚ä¸èƒ½å’ŒCMSæ­é…ã€‚</p><p>ç›®æ ‡ï¼š</p><p>å¸Œæœ›è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ã€‚</p><p>Parallel Scavengeæ”¶é›†å™¨ä¹Ÿç»å¸¸è¢«ç§°ä½œâ€œååé‡ä¼˜å…ˆæ”¶é›†å™¨â€ã€‚</p><h4 id="ç‰¹ç‚¹ï¼š-2"><a href="#ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><p>ï¼ˆ1ï¼‰æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼ŒåŸºäºæ ‡è®°-å¤åˆ¶ç®—æ³•å®ç°</p><p>ï¼ˆ2ï¼‰èƒ½å¤Ÿå¤šçº¿ç¨‹å¹¶è¡Œæ”¶é›†</p><p>ï¼ˆ3ï¼‰åœé¡¿-ååé‡çš„è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ã€‚å¯ä»¥è®¾å®šç›®æ ‡è®©æ”¶é›†å™¨è‡ªè¡Œè°ƒèŠ‚ã€‚</p><p>ï¼ˆ4ï¼‰æ”¯æŒNUMA(éç»Ÿä¸€å†…å­˜è®¿é—®æ¶æ„)å†…å­˜åˆ†é…</p><p>è¿è¡Œç¤ºæ„å›¾ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-5-gc-Parallel-Scavenge-or-Parallel-Old.jpg" alt="Parallel Scavenge / Parallel Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><blockquote><p>Parallel Scavengeæ”¶é›†å™¨æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡ï¼Œåˆ†åˆ«æ˜¯æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´çš„<code>-XXï¼šMaxGCPauseMillis</code>å‚æ•°ä»¥åŠç›´æ¥è®¾ç½®ååé‡å¤§å°çš„<code>-XXï¼šGCTimeRatio</code>å‚æ•°ã€‚</p></blockquote><blockquote><p><code>-XXï¼šMaxGCPauseMillis</code>å‚æ•°å…è®¸çš„å€¼æ˜¯ä¸€ä¸ªå¤§äº0çš„æ¯«ç§’æ•°ï¼Œæ”¶é›†å™¨å°†å°½åŠ›ä¿è¯å†…å­˜å›æ”¶èŠ±è´¹çš„æ—¶é—´ä¸è¶…è¿‡ç”¨æˆ·è®¾å®šå€¼ã€‚</p></blockquote><blockquote><p><code>-XXï¼šGCTimeRatio</code>å‚æ•°çš„å€¼åˆ™åº”å½“æ˜¯ä¸€ä¸ªå¤§äº0å°äº100çš„æ•´æ•°ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ç‡ï¼Œç›¸å½“äºååé‡çš„å€’æ•°ã€‚å¦‚æŠŠæ­¤å‚æ•°è®¾ç½®ä¸º19ï¼Œé‚£å…è®¸çš„æœ€å¤§åƒåœ¾æ”¶é›†æ—¶é—´å°±å æ€»æ—¶é—´çš„5%ï¼ˆå³1/(1+19)ï¼‰ï¼Œé»˜è®¤å€¼ä¸º99ï¼Œå³å…è®¸æœ€å¤§1%ï¼ˆå³1/(1+99)ï¼‰çš„åƒåœ¾æ”¶é›†æ—¶é—´ã€‚</p></blockquote><p>åœé¡¿-ååé‡çš„è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼š</p><blockquote><p>Parallel Scavengeæ”¶é›†å™¨è¿˜æœ‰ä¸€ä¸ªå‚æ•°<code>-XXï¼š+UseAdaptiveSizePolicy</code>å€¼å¾—æˆ‘ä»¬å…³æ³¨ã€‚è¿™æ˜¯ä¸€ä¸ªå¼€å…³å‚æ•°ï¼Œå½“è¿™ä¸ªå‚æ•°è¢«æ¿€æ´»ä¹‹åï¼Œå°±ä¸éœ€è¦äººå·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ<code>-XXï¼šSurvivorRatio</code>ï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¤§å°ï¼ˆ<code>-XXï¼šPretenureSizeThreshold</code>ï¼‰ç­‰ç»†èŠ‚å‚æ•°äº†ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ã€‚è¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸ºåƒåœ¾æ”¶é›†çš„è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰.</p></blockquote><blockquote><p>æŠŠåŸºæœ¬çš„å†…å­˜æ•°æ®è®¾ç½®å¥½ï¼ˆå¦‚<code>-Xmx</code>è®¾ç½®æœ€å¤§å †ï¼‰ï¼Œç„¶åä½¿ç”¨<code>-XXï¼šMaxGCPauseMillis</code>å‚æ•°ï¼ˆæ›´å…³æ³¨æœ€å¤§åœé¡¿æ—¶é—´ï¼‰æˆ–<code>-XXï¼šGCTimeRatio</code>ï¼ˆæ›´å…³æ³¨ååé‡ï¼‰å‚æ•°ç»™è™šæ‹Ÿæœºè®¾ç«‹ä¸€ä¸ªä¼˜åŒ–ç›®æ ‡ï¼Œé‚£å…·ä½“ç»†èŠ‚å‚æ•°çš„è°ƒèŠ‚å·¥ä½œå°±ç”±è™šæ‹Ÿæœºå®Œæˆäº†ã€‚è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ä¹Ÿæ˜¯Parallel Scavengeæ”¶é›†å™¨åŒºåˆ«äºParNewæ”¶é›†å™¨çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ã€‚</p></blockquote><h3 id="4ã€Serial-Old-æ”¶é›†å™¨"><a href="#4ã€Serial-Old-æ”¶é›†å™¨" class="headerlink" title="4ã€Serial Old  æ”¶é›†å™¨"></a>4ã€Serial Old  æ”¶é›†å™¨</h3><p>Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</p><h4 id="ç‰¹ç‚¹ï¼š-3"><a href="#ç‰¹ç‚¹ï¼š-3" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><p>ï¼ˆ1ï¼‰è€å¹´ä»£æ”¶é›†å™¨ï¼Œ</p><p>ï¼ˆ2ï¼‰å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œ</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</p><p>ä½¿ç”¨ç¯å¢ƒï¼š</p><p>å®¢æˆ·ç«¯ï¼šä¸»è¦ä¾›å®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„HotSpotè™šæ‹Ÿæœºä½¿ç”¨ã€‚</p><p>æœåŠ¡ç«¯ï¼šï¼ˆAï¼‰åœ¨JDK 5ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼›</p><p>â€‹    ï¼ˆBï¼‰ä½œä¸ºCMSæ”¶é›†å™¨å‘ç”Ÿå¤±è´¥æ—¶çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent ModeFailureæ—¶ä½¿ç”¨ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-5-gc-serial.jpg" alt="Serial/ Serial old æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><h3 id="5ã€Parallel-Old-æ”¶é›†å™¨"><a href="#5ã€Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="5ã€Parallel Old æ”¶é›†å™¨"></a>5ã€Parallel Old æ”¶é›†å™¨</h3><p>Parallel Oldæ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘æ”¶é›†ï¼ŒåŸºäºæ ‡è®°-æ•´ç†ç®—æ³•å®ç°ã€‚è¿™ä¸ªæ”¶é›†å™¨æ˜¯ç›´åˆ°JDK 6æ—¶æ‰å¼€å§‹æä¾›çš„ã€‚</p><h4 id="ç‰¹ç‚¹ï¼š-4"><a href="#ç‰¹ç‚¹ï¼š-4" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><p>åŒParallel Scavengeæ”¶é›†å™¨ã€‚</p><p>â€œååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨ï¼š</p><blockquote><p>åœ¨æ³¨é‡ååé‡æˆ–è€…å¤„ç†å™¨èµ„æºè¾ƒä¸ºç¨€ç¼ºçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘Parallel ScavengeåŠ Parallel Oldæ”¶é›†å™¨è¿™ä¸ªç»„åˆã€‚     </p></blockquote><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-5-gc-Parallel-Scavenge-or-Parallel-Old.jpg" alt="Parallel Scavenge / Parallel Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><h3 id="6ã€CMS-æ”¶é›†å™¨"><a href="#6ã€CMS-æ”¶é›†å™¨" class="headerlink" title="6ã€CMS  æ”¶é›†å™¨"></a>6ã€CMS  æ”¶é›†å™¨</h3><p>CMS : Concurrent Mark Sweep</p><p>å®˜æ–¹æ–‡æ¡£ç§°ä¹‹ä¸ºï¼šâ€œå¹¶å‘ä½åœé¡¿æ”¶é›†å™¨â€ï¼ˆConcurrent Low Pause Collectorï¼‰</p><h4 id="ç‰¹ç‚¹ï¼š-5"><a href="#ç‰¹ç‚¹ï¼š-5" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><p>â€‹    ï¼ˆ1ï¼‰ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ã€‚</p><p>â€‹    ï¼ˆ2ï¼‰åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•å®ç°ã€‚</p><blockquote><p>å…³æ³¨æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´å°½å¯èƒ½çŸ­,å¦‚B/Sç³»ç»Ÿåº”ç”¨æœåŠ¡ç«¯ï¼Œé€‚åˆCMSæ”¶é›†å™¨ã€‚</p></blockquote><p>CMSå †å†…å­˜å¸ƒå±€</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-5-gc-cms.png" alt="Concurrent Mark Sweepæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><h5 id="CMSæ”¶é›†å™¨å·¥ä½œè¿‡ç¨‹ï¼š"><a href="#CMSæ”¶é›†å™¨å·¥ä½œè¿‡ç¨‹ï¼š" class="headerlink" title="CMSæ”¶é›†å™¨å·¥ä½œè¿‡ç¨‹ï¼š"></a>CMSæ”¶é›†å™¨å·¥ä½œè¿‡ç¨‹ï¼š</h5><p>è¿è¡Œç¤ºæ„å›¾å¦‚ä¸‹</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-5-gc-cms-workflow.jpg" alt="Concurrent Mark Sweepæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><p>1ï¼‰åˆå§‹æ ‡è®°ï¼ˆCMS initial markï¼‰</p><p>â€‹    ï¼ˆAï¼‰æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚</p><p>â€‹    ï¼ˆBï¼‰æœ‰çŸ­æš‚åœé¡¿</p><p>2ï¼‰å¹¶å‘æ ‡è®°ï¼ˆCMS concurrent markï¼‰</p><p>â€‹    ï¼ˆAï¼‰ä»GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹ã€‚</p><p>â€‹    ï¼ˆBï¼‰è¯¥è¿‡ç¨‹è€—æ—¶è¾ƒé•¿ï¼Œç”¨æˆ·çº¿ç¨‹å¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œ</p><p>3ï¼‰é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰</p><p>â€‹    ï¼ˆAï¼‰ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚</p><p>â€‹    ï¼ˆBï¼‰æœ‰åœé¡¿ï¼Œæ¯”åˆå§‹æ ‡è®°åœé¡¿æ—¶é—´ç¨é•¿ï¼Œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µçš„æ—¶é—´çŸ­ã€‚</p><p>4ï¼‰å¹¶å‘æ¸…é™¤ï¼ˆCMS concurrent sweepï¼‰</p><p>â€‹    ï¼ˆAï¼‰æ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡ã€‚</p><p>â€‹    ï¼ˆBï¼‰ä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œå¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘æ‰§è¡Œã€‚</p><h4 id="CMSæ”¶é›†å™¨ä¼˜ç¼ºç‚¹ï¼š"><a href="#CMSæ”¶é›†å™¨ä¼˜ç¼ºç‚¹ï¼š" class="headerlink" title="CMSæ”¶é›†å™¨ä¼˜ç¼ºç‚¹ï¼š"></a>CMSæ”¶é›†å™¨ä¼˜ç¼ºç‚¹ï¼š</h4><p>ä¼˜ç‚¹ï¼š</p><p>â€‹    å¹¶å‘æ”¶é›†ã€ä½åœé¡¿</p><p>ç¼ºç‚¹ï¼š</p><p>â€‹    ï¼ˆ1ï¼‰å¯¹å¤„ç†å™¨èµ„æºéå¸¸æ•æ„Ÿï¼Œå¹¶å‘é˜¶æ®µçº¿ç¨‹è¿è¡Œå ç”¨èµ„æºã€‚</p><p>â€‹    ï¼ˆ2ï¼‰æ— æ³•å¤„ç†å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…ç†é˜¶æ®µäº§ç”Ÿçš„â€œæµ®åŠ¨åƒåœ¾â€ï¼ˆFloating Garbageï¼‰ã€‚æœ‰å¯èƒ½å‡ºç°â€œCon-current Mode Failureâ€å¤±è´¥è¿›è€Œå¯¼è‡´å¦ä¸€æ¬¡å®Œå…¨â€œStop The Worldâ€çš„Full GCçš„äº§ç”Ÿã€‚</p><p>â€‹    ï¼ˆ3ï¼‰â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°å¸¦æ¥çš„ç©ºé—´ç¢ç‰‡é—®é¢˜ã€‚</p><blockquote><p><strong>æµ®åŠ¨åƒåœ¾</strong>ï¼šåœ¨CMSçš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…ç†é˜¶æ®µï¼Œç”¨æˆ·çº¿ç¨‹æ˜¯è¿˜åœ¨ç»§ç»­è¿è¡Œçš„ï¼Œç¨‹åºåœ¨è¿è¡Œè‡ªç„¶å°±è¿˜ä¼šä¼´éšæœ‰æ–°çš„åƒåœ¾å¯¹è±¡ä¸æ–­äº§ç”Ÿï¼Œä½†è¿™ä¸€éƒ¨åˆ†åƒåœ¾å¯¹è±¡æ˜¯å‡ºç°åœ¨æ ‡è®°è¿‡ç¨‹ç»“æŸä»¥åï¼ŒCMSæ— æ³•åœ¨å½“æ¬¡æ”¶é›†ä¸­å¤„ç†æ‰å®ƒä»¬ï¼Œåªå¥½ç•™å¾…ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†æ—¶å†æ¸…ç†æ‰ã€‚è¿™ä¸€éƒ¨åˆ†åƒåœ¾å°±ç§°ä¸ºâ€œæµ®åŠ¨åƒåœ¾â€</p></blockquote><p>å› ä¸ºæµ®åŠ¨åƒåœ¾å¸¦æ¥çš„é—®é¢˜æ€ä¹ˆåŠï¼Ÿ</p><blockquote><p>CMSæ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰å¾…åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†ï¼Œå¿…é¡»é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ä¾›å¹¶å‘æ”¶é›†æ—¶çš„ç¨‹åºè¿ä½œä½¿ç”¨ã€‚åœ¨JDK 5çš„é»˜è®¤è®¾ç½®ä¸‹ï¼ŒCMSæ”¶é›†å™¨å½“è€å¹´ä»£ä½¿ç”¨äº†68%çš„ç©ºé—´åå°±ä¼šè¢«æ¿€æ´»ï¼Œè¿™æ˜¯ä¸€ä¸ªåä¿å®ˆçš„è®¾ç½®ï¼Œå¦‚æœåœ¨å®é™…åº”ç”¨ä¸­è€å¹´ä»£å¢é•¿å¹¶ä¸æ˜¯å¤ªå¿«ï¼Œå¯ä»¥é€‚å½“è°ƒé«˜å‚æ•°<code>-XXï¼šCMSInitiatingOccu-pancyFraction</code>çš„å€¼æ¥æé«˜CMSçš„è§¦å‘ç™¾åˆ†æ¯”ï¼Œé™ä½å†…å­˜å›æ”¶é¢‘ç‡ï¼Œè·å–æ›´å¥½çš„æ€§èƒ½ã€‚åˆ°äº†JDK 6æ—¶ï¼ŒCMSæ”¶é›†å™¨çš„å¯åŠ¨é˜ˆå€¼å°±å·²ç»é»˜è®¤æå‡è‡³92%ã€‚ä½†è¿™åˆä¼šæ›´å®¹æ˜“é¢ä¸´å¦ä¸€ç§é£é™©ï¼šè¦æ˜¯CMSè¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºåˆ†é…æ–°å¯¹è±¡çš„éœ€è¦ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡â€œå¹¶å‘å¤±è´¥â€ï¼ˆConcurrent Mode Failureï¼‰ï¼Œè¿™æ—¶å€™è™šæ‹Ÿæœºå°†ä¸å¾—ä¸å¯åŠ¨åå¤‡é¢„æ¡ˆï¼šå†»ç»“ç”¨æˆ·çº¿ç¨‹çš„æ‰§è¡Œï¼Œä¸´æ—¶å¯ç”¨Serial Oldæ”¶é›†å™¨æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œä½†è¿™æ ·åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚æ‰€ä»¥å‚æ•°<code>-XXï¼šCMSInitiatingOccupancyFraction</code>è®¾ç½®å¾—å¤ªé«˜å°†ä¼šå¾ˆå®¹æ˜“å¯¼è‡´å¤§é‡çš„å¹¶å‘å¤±è´¥äº§ç”Ÿï¼Œæ€§èƒ½åè€Œé™ä½ï¼Œç”¨æˆ·åº”åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ ¹æ®å®é™…åº”ç”¨æƒ…å†µæ¥æƒè¡¡è®¾ç½®ã€‚</p></blockquote><h3 id="7ã€G1åƒåœ¾æ”¶é›†å™¨"><a href="#7ã€G1åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="7ã€G1åƒåœ¾æ”¶é›†å™¨"></a>7ã€G1åƒåœ¾æ”¶é›†å™¨</h3><p>G1 : Garbage First</p><blockquote><p>Garbage Firstï¼ˆç®€ç§°G1ï¼‰æ”¶é›†å™¨æ˜¯åƒåœ¾æ”¶é›†å™¨æŠ€æœ¯å‘å±•å†å²ä¸Šçš„é‡Œç¨‹ç¢‘å¼çš„æˆæœï¼Œå®ƒå¼€åˆ›äº†æ”¶é›†å™¨é¢å‘å±€éƒ¨æ”¶é›†çš„è®¾è®¡æ€è·¯å’ŒåŸºäºRegionçš„å†…å­˜å¸ƒå±€å½¢å¼ã€‚</p><p>ä»JDK 6 Update 14å¼€å§‹å°±æœ‰Early Accessç‰ˆæœ¬çš„G1æ”¶é›†å™¨ä¾›å¼€å‘äººå‘˜å®éªŒå’Œè¯•ç”¨ï¼Œä½†ç”±æ­¤å¼€å§‹G1æ”¶é›†å™¨çš„â€œå®éªŒçŠ¶æ€â€ï¼ˆExperimentalï¼‰æŒç»­äº†æ•°å¹´æ—¶é—´ï¼Œç›´è‡³JDK 7Update 4ï¼ŒOracleæ‰è®¤ä¸ºå®ƒè¾¾åˆ°è¶³å¤Ÿæˆç†Ÿçš„å•†ç”¨ç¨‹åº¦ï¼Œç§»é™¤äº†â€œExperimentalâ€çš„æ ‡è¯†ï¼›åˆ°äº†JDK 8 Update 40çš„æ—¶å€™ï¼ŒG1æä¾›å¹¶å‘çš„ç±»å¸è½½çš„æ”¯æŒï¼Œè¡¥å…¨äº†å…¶è®¡åˆ’åŠŸèƒ½çš„æœ€åä¸€å—æ‹¼å›¾ã€‚è¿™ä¸ªç‰ˆæœ¬ä»¥åçš„G1æ”¶é›†å™¨æ‰è¢«Oracleå®˜æ–¹ç§°ä¸ºâ€œå…¨åŠŸèƒ½çš„åƒåœ¾æ”¶é›†å™¨â€ï¼ˆFully-FeaturedGarbage Collectorï¼‰ã€‚</p><p>JDK9å‘å¸ƒä¹‹æ—¥ï¼ŒG1å®£å‘Šå–ä»£Parallel ScavengeåŠ Parallel Oldç»„åˆï¼Œæˆä¸ºæœåŠ¡ç«¯æ¨¡å¼ä¸‹çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ã€‚</p></blockquote><p>è®¾è®¡æ€è·¯ï¼š</p><p>â€‹    è¿½æ±‚èƒ½å¤Ÿåº”ä»˜åº”ç”¨çš„å†…å­˜åˆ†é…é€Ÿç‡ï¼ˆAllocation Rateï¼‰ï¼Œè€Œä¸è¿½æ±‚ä¸€æ¬¡æŠŠæ•´ä¸ªJavaå †å…¨éƒ¨æ¸…ç†å¹²å‡€ã€‚</p><blockquote><p>åº”ç”¨åœ¨åˆ†é…ï¼ŒåŒæ—¶æ”¶é›†å™¨åœ¨æ”¶é›†ï¼Œåªè¦æ”¶é›†çš„é€Ÿåº¦èƒ½è·Ÿå¾—ä¸Šå¯¹è±¡åˆ†é…çš„é€Ÿåº¦ï¼Œé‚£ä¸€åˆ‡å°±èƒ½è¿ä½œå¾—å¾ˆå®Œç¾ã€‚è¿™ç§æ–°çš„æ”¶é›†å™¨è®¾è®¡æ€è·¯ä»å·¥ç¨‹å®ç°ä¸Šçœ‹æ˜¯ä»G1å¼€å§‹å…´èµ·çš„ã€‚</p><p>G1æ˜¯æ”¶é›†å™¨æŠ€æœ¯å‘å±•çš„ä¸€ä¸ªé‡Œç¨‹ç¢‘ã€‚ä¹Ÿæ˜¯jdk11çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ã€‚</p></blockquote><h4 id="ç‰¹ç‚¹ï¼š-6"><a href="#ç‰¹ç‚¹ï¼š-6" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><p>â€‹    ï¼ˆ1ï¼‰é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ã€‚</p><p>â€‹    ï¼ˆ2ï¼‰åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€ã€‚</p><p>â€‹    ï¼ˆ3ï¼‰ä½¿ç”¨Mixed GCæ¨¡å¼ï¼Œä¸å†æŒ‰â€œä»£â€è¿›è¡Œå›æ”¶ã€‚ï¼ˆRegionå¸ƒå±€æ”¯æŒï¼‰</p><p>â€‹    ï¼ˆ4ï¼‰éµå¾ªåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯å›ºå®šå¤§å°ä¸æ•°ç†ï¼Œåªè¦æ±‚æ˜¯é€»è¾‘è¿ç»­çš„åŠ¨æ€é›†åˆã€‚</p><p>â€‹    ï¼ˆ5ï¼‰å›æ”¶ç­–ç•¥æ˜¯ä¼˜å…ˆå¤„ç†å›æ”¶ä»·å€¼æœ€å¤§çš„Region</p><h4 id="å†…å­˜å¸ƒå±€å›¾ï¼š"><a href="#å†…å­˜å¸ƒå±€å›¾ï¼š" class="headerlink" title="å†…å­˜å¸ƒå±€å›¾ï¼š"></a>å†…å­˜å¸ƒå±€å›¾ï¼š</h4><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-5-gc-G1.png" alt="G1æ”¶é›†å™¨å †å†…å­˜å¸ƒå±€"></p><blockquote><p>G1ä¸å†æ˜¯å›ºå®šå¤§å°ä»¥åŠå›ºå®šæ•°é‡çš„åˆ†ä»£åŒºåŸŸåˆ’åˆ†ï¼Œè€Œæ˜¯æŠŠè¿ç»­çš„Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ¯ä¸€ä¸ªRegionéƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œæ‰®æ¼”æ–°ç”Ÿä»£çš„Edenç©ºé—´ã€Survivorç©ºé—´ï¼Œæˆ–è€…è€å¹´ä»£ç©ºé—´ã€‚æ”¶é›†å™¨èƒ½å¤Ÿå¯¹æ‰®æ¼”ä¸åŒè§’è‰²çš„Regioné‡‡ç”¨ä¸åŒçš„ç­–ç•¥å»å¤„ç†ã€‚</p><p>Regionä¸­è¿˜æœ‰ä¸€ç±»ç‰¹æ®Šçš„HumongousåŒºåŸŸï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨å¤§å¯¹è±¡ã€‚G1è®¤ä¸ºåªè¦å¤§å°è¶…è¿‡äº†ä¸€ä¸ªRegionå®¹é‡ä¸€åŠçš„å¯¹è±¡å³å¯åˆ¤å®šä¸ºå¤§å¯¹è±¡ã€‚æ¯ä¸ªRegionçš„å¤§å°å¯ä»¥é€šè¿‡å‚æ•°<code>-XXï¼šG1HeapRegionSize</code>è®¾å®šï¼Œå–å€¼èŒƒå›´ä¸º1MBï½32MBï¼Œä¸”åº”ä¸º2çš„Næ¬¡å¹‚ã€‚è€Œå¯¹äºé‚£äº›è¶…è¿‡äº†æ•´ä¸ªRegionå®¹é‡çš„è¶…çº§å¤§å¯¹è±¡ï¼Œå°†ä¼šè¢«å­˜æ”¾åœ¨Nä¸ªè¿ç»­çš„<code>Humongous Region</code>ä¹‹ä¸­ï¼ŒG1çš„å¤§å¤šæ•°è¡Œä¸ºéƒ½æŠŠ<code>Humongous Region</code>ä½œä¸ºè€å¹´ä»£çš„ä¸€éƒ¨åˆ†æ¥è¿›è¡Œçœ‹å¾…</p></blockquote><h4 id="G1æ”¶é›†å™¨å®ç°æ€è·¯ï¼š"><a href="#G1æ”¶é›†å™¨å®ç°æ€è·¯ï¼š" class="headerlink" title="G1æ”¶é›†å™¨å®ç°æ€è·¯ï¼š"></a>G1æ”¶é›†å™¨å®ç°æ€è·¯ï¼š</h4><p>ï¼ˆ1ï¼‰åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€,æŠŠè¿ç»­çš„Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ¯ä¸€ä¸ªRegionéƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œæ‰®æ¼”æ–°ç”Ÿä»£çš„Edenç©ºé—´ã€Survivorç©ºé—´ï¼Œæˆ–è€…è€å¹´ä»£ç©ºé—´ã€‚æ”¶é›†å™¨èƒ½å¤Ÿå¯¹æ‰®æ¼”ä¸åŒè§’è‰²çš„Regioné‡‡ç”¨ä¸åŒçš„ç­–ç•¥å»å¤„ç†ã€‚</p><p>ï¼ˆ2)å°†å †åˆ†æˆå¤šä¸ªç‹¬ç«‹Regionåï¼Œä½¿ç”¨è®°å¿†é›†é¿å…å…¨å †ä½œä¸ºGC Rootsæ‰«æï¼Œæ¯ä¸ªRegionéƒ½ç»´æŠ¤æœ‰è‡ªå·±çš„è®°å¿†é›†ï¼Œè®°å¿†é›†ä¼šè®°å½•ä¸‹åˆ«çš„RegionæŒ‡å‘è‡ªå·±çš„æŒ‡é’ˆï¼Œå¹¶æ ‡è®°è¿™äº›æŒ‡é’ˆåˆ†åˆ«åœ¨å“ªäº›å¡é¡µçš„èŒƒå›´ä¹‹å†…ã€‚</p><blockquote><p>G1çš„è®°å¿†é›†åœ¨å­˜å‚¨ç»“æ„çš„æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å“ˆå¸Œè¡¨ï¼ŒKeyæ˜¯åˆ«çš„Regionçš„èµ·å§‹åœ°å€ï¼ŒValueæ˜¯ä¸€ä¸ªé›†åˆï¼Œé‡Œé¢å­˜å‚¨çš„å…ƒç´ æ˜¯å¡è¡¨çš„ç´¢å¼•å·ã€‚è¿™ç§â€œåŒå‘â€çš„å¡è¡¨ç»“æ„ï¼ˆå¡è¡¨æ˜¯â€œæˆ‘æŒ‡å‘è°â€ï¼Œè¿™ç§ç»“æ„è¿˜è®°å½•äº†â€œè°æŒ‡å‘æˆ‘â€ï¼‰æ¯”åŸæ¥çš„å¡è¡¨å®ç°èµ·æ¥æ›´å¤æ‚ï¼ŒåŒæ—¶ç”±äºRegionæ•°é‡æ¯”ä¼ ç»Ÿæ”¶é›†å™¨çš„åˆ†ä»£æ•°é‡æ˜æ˜¾è¦å¤šå¾—å¤šï¼Œå› æ­¤G1æ”¶é›†å™¨è¦æ¯”å…¶ä»–çš„ä¼ ç»Ÿåƒåœ¾æ”¶é›†å™¨æœ‰ç€æ›´é«˜çš„å†…å­˜å ç”¨è´Ÿæ‹…ã€‚G1è‡³å°‘è¦è€—è´¹å¤§çº¦ç›¸å½“äºJavaå †å®¹é‡10%è‡³20%çš„é¢å¤–å†…å­˜æ¥ç»´æŒæ”¶é›†å™¨å·¥ä½œã€‚</p></blockquote><p>ï¼ˆ3ï¼‰åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œé€šè¿‡åŸå§‹å¿«ç…§ï¼ˆSATBï¼‰ç®—æ³•æ¥å®ç°ç”¨æˆ·çº¿ç¨‹æ”¹å˜å¯¹è±¡å¼•ç”¨å…³ç³»æ—¶ï¼Œä¸æ‰“ç ´åŸæœ¬çš„å¯¹è±¡å›¾ç»“æ„ã€‚</p><p>ï¼ˆ4ï¼‰åœ¨å›æ”¶è¿‡ç¨‹ä¸­æ–°åˆ›å»ºå¯¹è±¡çš„å†…å­˜åˆ†é…ä¸Šï¼Œç¨‹åºè¦ç»§ç»­è¿è¡Œå°±è‚¯å®šä¼šæŒç»­æœ‰æ–°å¯¹è±¡è¢«åˆ›å»ºï¼ŒG1ä¸ºæ¯ä¸€ä¸ªRegionè®¾è®¡äº†ä¸¤ä¸ªåä¸ºTAMSï¼ˆTop at Mark Startï¼‰æŒ‡é’ˆï¼ŒæŠŠRegionä¸­çš„ä¸€éƒ¨åˆ†ç©ºé—´åˆ’åˆ†å‡ºæ¥ç”¨äºå¹¶å‘å›æ”¶è¿‡ç¨‹ä¸­çš„æ–°å¯¹è±¡åˆ†é…ï¼Œå¹¶å‘å›æ”¶æ—¶æ–°åˆ†é…çš„å¯¹è±¡åœ°å€éƒ½å¿…é¡»è¦åœ¨è¿™ä¸¤ä¸ªæŒ‡é’ˆä½ç½®ä¸Šã€‚G1æ”¶é›†å™¨é»˜è®¤åœ¨è¿™ä¸ªåœ°å€ä»¥ä¸Šçš„å¯¹è±¡æ˜¯è¢«éšå¼æ ‡è®°è¿‡çš„ï¼Œå³é»˜è®¤å®ƒä»¬æ˜¯å­˜æ´»çš„ï¼Œä¸çº³å…¥å›æ”¶èŒƒå›´ã€‚</p><p>å¯é¢„æµ‹çš„â€œåœé¡¿æ—¶é—´æ¨¡å‹â€ï¼ˆPause Prediction Modelï¼‰:</p><blockquote><p>G1æ”¶é›†å™¨ä¹‹æ‰€ä»¥èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œæ˜¯å› ä¸ºå®ƒå°†Regionä½œä¸ºå•æ¬¡å›æ”¶çš„æœ€å°å•å…ƒï¼Œå³æ¯æ¬¡æ”¶é›†åˆ°çš„å†…å­˜ç©ºé—´éƒ½æ˜¯Regionå¤§å°çš„æ•´æ•°å€ï¼Œè¿™æ ·å¯ä»¥æœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ªJavaå †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚æ›´å…·ä½“çš„å¤„ç†æ€è·¯æ˜¯è®©G1æ”¶é›†å™¨å»è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„â€œä»·å€¼â€å¤§å°ï¼Œä»·å€¼å³å›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼Œç„¶ååœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®ç”¨æˆ·è®¾å®šå…è®¸çš„æ”¶é›†åœé¡¿æ—¶é—´ï¼ˆä½¿ç”¨å‚æ•°<code>-XXï¼šMaxGCPauseMillis</code>æŒ‡å®šï¼Œé»˜è®¤å€¼æ˜¯200æ¯«ç§’ï¼‰ï¼Œä¼˜å…ˆå¤„ç†å›æ”¶ä»·å€¼æ”¶ç›Šæœ€å¤§çš„é‚£äº›Regionï¼Œè¿™ä¹Ÿå°±æ˜¯â€œGarbage Firstâ€åå­—çš„ç”±æ¥ã€‚è¿™ç§ä½¿ç”¨Regionåˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œä»¥åŠå…·æœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº†G1æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚</p></blockquote><blockquote><p>G1æ”¶é›†å™¨çš„åœé¡¿é¢„æµ‹æ¨¡å‹æ˜¯ä»¥è¡°å‡å‡å€¼ï¼ˆDecaying Averageï¼‰ä¸ºç†è®ºåŸºç¡€æ¥å®ç°çš„ï¼Œåœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­ï¼ŒG1æ”¶é›†å™¨ä¼šè®°å½•æ¯ä¸ªRegionçš„å›æ”¶è€—æ—¶ã€æ¯ä¸ªRegionè®°å¿†é›†é‡Œçš„è„å¡æ•°é‡ç­‰å„ä¸ªå¯æµ‹é‡çš„æ­¥éª¤èŠ±è´¹çš„æˆæœ¬ï¼Œå¹¶åˆ†æå¾—å‡ºå¹³å‡å€¼ã€æ ‡å‡†åå·®ã€ç½®ä¿¡åº¦ç­‰ç»Ÿè®¡ä¿¡æ¯ã€‚è¿™é‡Œå¼ºè°ƒçš„â€œè¡°å‡å¹³å‡å€¼â€æ˜¯æŒ‡å®ƒä¼šæ¯”æ™®é€šçš„å¹³å‡å€¼æ›´å®¹æ˜“å—åˆ°æ–°æ•°æ®çš„å½±å“ï¼Œå¹³å‡å€¼ä»£è¡¨æ•´ä½“å¹³å‡çŠ¶æ€ï¼Œä½†è¡°å‡å¹³å‡å€¼æ›´å‡†ç¡®åœ°ä»£è¡¨â€œæœ€è¿‘çš„â€å¹³å‡çŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼ŒRegionçš„ç»Ÿè®¡çŠ¶æ€è¶Šæ–°è¶Šèƒ½å†³å®šå…¶å›æ”¶çš„ä»·å€¼ã€‚ç„¶åé€šè¿‡è¿™äº›ä¿¡æ¯é¢„æµ‹ç°åœ¨å¼€å§‹å›æ”¶çš„è¯ï¼Œç”±å“ªäº›Regionç»„æˆå›æ”¶é›†æ‰å¯ä»¥åœ¨ä¸è¶…è¿‡æœŸæœ›åœé¡¿æ—¶é—´çš„çº¦æŸä¸‹è·å¾—æœ€é«˜çš„æ”¶ç›Šã€‚</p></blockquote><p><code>-XXï¼šMaxGCPauseMillis</code>-ç”¨æˆ·æŒ‡å®šæœŸæœ›çš„åœé¡¿æ—¶é—´ï¼š</p><blockquote><p>ç”¨æˆ·æŒ‡å®šæœŸæœ›çš„åœé¡¿æ—¶é—´æ˜¯G1æ”¶é›†å™¨å¾ˆå¼ºå¤§çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œè®¾ç½®ä¸åŒçš„æœŸæœ›åœé¡¿æ—¶é—´ï¼Œå¯ä½¿å¾—G1åœ¨ä¸åŒåº”ç”¨åœºæ™¯ä¸­å–å¾—å…³æ³¨ååé‡å’Œå…³æ³¨å»¶è¿Ÿä¹‹é—´çš„æœ€ä½³å¹³è¡¡ã€‚ä¸è¿‡ï¼Œè¿™é‡Œè®¾ç½®çš„â€œæœŸæœ›å€¼â€å¿…é¡»æ˜¯ç¬¦åˆå®é™…çš„ï¼Œä¸èƒ½å¼‚æƒ³å¤©å¼€ï¼Œæ¯•ç«ŸG1æ˜¯è¦å†»ç»“ç”¨æˆ·çº¿ç¨‹æ¥å¤åˆ¶å¯¹è±¡çš„ï¼Œè¿™ä¸ªåœé¡¿æ—¶é—´å†æ€ä¹ˆä½ä¹Ÿå¾—æœ‰ä¸ªé™åº¦ã€‚å®ƒé»˜è®¤çš„åœé¡¿ç›®æ ‡ä¸ºä¸¤ç™¾æ¯«ç§’ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå›æ”¶é˜¶æ®µå åˆ°å‡ ååˆ°ä¸€ç™¾ç”šè‡³æ¥è¿‘ä¸¤ç™¾æ¯«ç§’éƒ½å¾ˆæ­£å¸¸ï¼Œä½†å¦‚æœæˆ‘ä»¬æŠŠåœé¡¿æ—¶é—´è°ƒå¾—éå¸¸ä½ï¼Œè­¬å¦‚è®¾ç½®ä¸ºäºŒåæ¯«ç§’ï¼Œå¾ˆå¯èƒ½å‡ºç°çš„ç»“æœå°±æ˜¯ç”±äºåœé¡¿ç›®æ ‡æ—¶é—´å¤ªçŸ­ï¼Œå¯¼è‡´æ¯æ¬¡é€‰å‡ºæ¥çš„å›æ”¶é›†åªå å †å†…å­˜å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼Œæ”¶é›†å™¨æ”¶é›†çš„é€Ÿåº¦é€æ¸è·Ÿä¸ä¸Šåˆ†é…å™¨åˆ†é…çš„é€Ÿåº¦ï¼Œå¯¼è‡´åƒåœ¾æ…¢æ…¢å †ç§¯ã€‚å¾ˆå¯èƒ½ä¸€å¼€å§‹æ”¶é›†å™¨è¿˜èƒ½ä»ç©ºé—²çš„å †å†…å­˜ä¸­è·å¾—ä¸€äº›å–˜æ¯çš„æ—¶é—´ï¼Œä½†åº”ç”¨è¿è¡Œæ—¶é—´ä¸€é•¿å°±ä¸è¡Œäº†ï¼Œæœ€ç»ˆå æ»¡å †å¼•å‘Full GCåè€Œé™ä½æ€§èƒ½ï¼Œæ‰€ä»¥é€šå¸¸æŠŠæœ›æœŸåœé¡¿æ—¶é—´è®¾ç½®ä¸ºä¸€ä¸¤ç™¾æ¯«ç§’æˆ–è€…ä¸¤ä¸‰ç™¾æ¯«ç§’ä¼šæ˜¯æ¯”è¾ƒåˆç†çš„ã€‚</p></blockquote><h4 id="G1å·¥ä½œæµç¨‹ï¼š"><a href="#G1å·¥ä½œæµç¨‹ï¼š" class="headerlink" title="G1å·¥ä½œæµç¨‹ï¼š"></a>G1å·¥ä½œæµç¨‹ï¼š</h4><p>æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-5-gc-G1-workflow.jpg" alt="G1æ”¶é›†å™¨å †å†…å­˜å¸ƒå±€"></p><p>1ã€åˆå§‹æ ‡è®°ï¼ˆInitial Markingï¼‰ï¼š<br>ï¼ˆAï¼‰åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSæŒ‡é’ˆçš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½æ­£ç¡®åœ°åœ¨å¯ç”¨çš„Regionä¸­åˆ†é…æ–°å¯¹è±¡ã€‚</p><p>ï¼ˆBï¼‰è¯¥é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ã€‚</p><blockquote><p>åˆå§‹æ ‡è®°æ˜¯å€Ÿç”¨è¿›è¡ŒMinor GCçš„æ—¶å€™åŒæ­¥å®Œæˆçš„ï¼Œæ‰€ä»¥G1æ”¶é›†å™¨åœ¨è¿™ä¸ªé˜¶æ®µå®é™…å¹¶æ²¡æœ‰é¢å¤–çš„åœé¡¿ã€‚</p></blockquote><p>2ã€å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰ï¼š<br>ï¼ˆAï¼‰ä»GC Rootå¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œé€’å½’æ‰«ææ•´ä¸ªå †é‡Œçš„å¯¹è±¡å›¾ï¼Œæ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡ã€‚</p><p>ï¼ˆBï¼‰è¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œå¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</p><p>ï¼ˆCï¼‰å½“å¯¹è±¡å›¾æ‰«æå®Œæˆä»¥åï¼Œè¿˜è¦é‡æ–°å¤„ç†SATBè®°å½•ä¸‹çš„åœ¨å¹¶å‘æ—¶æœ‰å¼•ç”¨å˜åŠ¨çš„å¯¹è±¡ã€‚</p><p>3ã€æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰</p><p>ï¼ˆAï¼‰å¯¹ç”¨æˆ·çº¿ç¨‹åšå¦ä¸€ä¸ªçŸ­æš‚çš„æš‚åœï¼Œå¤„ç†å¹¶å‘é˜¶æ®µç»“æŸåä»é—ç•™ä¸‹æ¥çš„æœ€åé‚£å°‘é‡çš„SATBè®°å½•ã€‚</p><p>4ã€ç­›é€‰å›æ”¶ï¼ˆLive Data Counting and Evacuationï¼‰</p><p>ï¼ˆAï¼‰è´Ÿè´£æ›´æ–°Regionçš„ç»Ÿè®¡æ•°æ®ï¼Œå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œå¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„å¤šä¸ªRegionæ„æˆå›æ”¶é›†ï¼Œç„¶åæŠŠå†³å®šå›æ”¶çš„é‚£ä¸€éƒ¨åˆ†Regionçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„Regionä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§Regionçš„å…¨éƒ¨ç©ºé—´ã€‚</p><p>ï¼ˆBï¼‰æ“ä½œæ¶‰åŠå­˜æ´»å¯¹è±¡çš„ç§»åŠ¨ï¼Œå¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚</p><p>ï¼ˆCï¼‰ç­›é€‰å›æ”¶ç”±å¤šæ¡æ”¶é›†å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆçš„ã€‚</p><h4 id="G1ä¸CMSæ¯”è¾ƒ"><a href="#G1ä¸CMSæ¯”è¾ƒ" class="headerlink" title="G1ä¸CMSæ¯”è¾ƒ"></a>G1ä¸CMSæ¯”è¾ƒ</h4><table><th><td width="50%">G1</td><td width="50%">CMS</td></th><tr><td rowspan="6">ä¸åŒ</td> <td>G1åŸºäºRegionå¸ƒå±€ï¼Œå®ç°åˆ†ä»£ã€‚</td><td>CMSä¼ ç»Ÿçš„åˆ†ä»£å¸ƒå±€ã€‚</td></tr><tr><td>G1å¯ä»¥è®¾ç½®æœ€å¤§åœé¡¿,å…³æ³¨ç‚¹åœ¨ååé‡å’Œå»¶è¿Ÿä¹‹é—´è‡ªè¡Œå¹³è¡¡æˆ–å®šåˆ¶é€‚åº”ã€‚</td><td>CMSä»¥æœ€å°åœé¡¿ä¸ºå…³æ³¨ç‚¹ã€‚</td></tr><tr><td>G1æŒ‰æ”¶ç›ŠåŠ¨æ€ç¡®å®šå›æ”¶é›†ã€‚</td><td>CMSä¼ ç»Ÿçš„æŒ‰ä»£å›æ”¶ã€‚</td></tr><tr><td>G1æ•´ä½“åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€å±€éƒ¨ï¼ˆä¸¤ä¸ªRegionä¹‹é—´ï¼‰åŸºäºâ€œæ ‡è®°-å¤åˆ¶â€ç®—æ³•ï¼Œè¿ä½œæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ï¼Œåˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œã€‚</td><td>CMSåŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼Œäº§ç”Ÿç©ºé—´ç¢ç‰‡ï¼Œå¯¼è‡´Full GC ,ç”¨æˆ·çº¿ç¨‹æŒ‚èµ·ã€‚</td></tr><tr><td>G1åƒåœ¾æ”¶é›†äº§ç”Ÿçš„å†…å­˜å ç”¨ï¼ˆFootprintï¼‰å’Œç¨‹åºè¿è¡Œæ—¶çš„é¢å¤–æ‰§è¡Œè´Ÿè½½ï¼ˆOverloadï¼‰ã€‚    <br>ã€å†…å­˜å ç”¨ã€‘ï¼šG1è¦ç»´æŠ¤å †ä¸­æ¯ä¸ªRegionéƒ½æœ‰ä¸€ä»½å¡è¡¨ã€‚    <br>ã€æ‰§è¡Œè´Ÿè½½ã€‘ï¼šG1ä½¿ç”¨å†™å‰å±éšœæ¥è·Ÿè¸ªå¹¶å‘æ—¶çš„æŒ‡é’ˆå˜åŒ–æƒ…å†µ,å®ç°åŸå§‹å¿«ç…§æœç´¢ï¼ˆSATBï¼‰ç®—æ³•;ä½¿ç”¨å†™åå±éšœæ¥æ¥æ›´æ–°ç»´æŠ¤ç»“æ„æ›´å¤æ‚çš„å¡è¡¨ï¼Œç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—çš„ç»“æ„ï¼Œæ˜¯å¼‚æ­¥æ“ä½œã€‚</td><td>CMSçš„å†…å­˜å ç”¨ï¼ˆFootprintï¼‰å’Œæ‰§è¡Œè´Ÿè½½ï¼ˆOverloadï¼‰ç›¸å¯¹ä½äº›ã€‚        <br>ã€å†…å­˜å ç”¨ã€‘ï¼šCMSåªç»´æŠ¤æ–°ç”Ÿä»£ä¸è€å¹´ä»£ä¹‹é—´å”¯ä¸€çš„ä¸€ä»½å¡è¡¨ã€‚        <br>ã€æ‰§è¡Œè´Ÿè½½ã€‘ï¼šCMSç”¨å†™åå±éšœæ¥æ›´æ–°ç»´æŠ¤å¡è¡¨ï¼Œæ˜¯åŒæ­¥æ“ä½œã€‚<tr><td>G1ç›¸å¯¹é€‚åˆå¤§å†…å­˜åº”ç”¨ã€‚</td><td>CMSç›¸å¯¹é€‚åˆå°å†…å­˜åº”ç”¨ã€‚ä¸´ç•Œï¼ˆ6G~8Gï¼‰</td></tr><tr><td>ç›¸åŒ</td> <td colspan="2">ï¼ˆ1ï¼‰éƒ½éå¸¸å…³æ³¨åœé¡¿æ—¶é—´çš„æ§åˆ¶ã€‚<br>ï¼ˆ2ï¼‰éƒ½ä½¿ç”¨ä¼ ç»Ÿçš„åˆ†ä»£ç†è®ºã€‚<br>ï¼ˆ3ï¼‰éƒ½ä½¿ç”¨å¡è¡¨æ¥å¤„ç†è·¨ä»£æŒ‡é’ˆé—®é¢˜ã€‚</td></tr></table><h2 id="ä¸‰-ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨"><a href="#ä¸‰-ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨" class="headerlink" title="ä¸‰ ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨"></a>ä¸‰ ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨</h2><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-LLGC.jpg" alt="å„æ¬¾æ”¶é›†å™¨çš„å¹¶å‘æƒ…å†µ"></p><p>å…¶ä¸­ <strong>Shenandoah</strong> å’Œ <strong>ZGC</strong> ï¼Œè¿™ä¸¤æ¬¾ç›®å‰ä»å¤„äºå®éªŒçŠ¶æ€çš„æ”¶é›†å™¨ï¼Œè¢«å®˜æ–¹å‘½åä¸ºâ€œä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨â€ï¼ˆLow-Latency Garbage Collectoræˆ–è€…Low-Pause-Time GarbageCollectorï¼‰ã€‚</p><h3 id="1ã€Shenandoah-æ”¶é›†å™¨"><a href="#1ã€Shenandoah-æ”¶é›†å™¨" class="headerlink" title="1ã€Shenandoah æ”¶é›†å™¨"></a>1ã€Shenandoah æ”¶é›†å™¨</h3><h4 id="ä¸»è¦ç›®æ ‡ï¼š"><a href="#ä¸»è¦ç›®æ ‡ï¼š" class="headerlink" title="ä¸»è¦ç›®æ ‡ï¼š"></a>ä¸»è¦ç›®æ ‡ï¼š</h4><blockquote><p>å®ç°ä¸€ç§èƒ½åœ¨ä»»ä½•å †å†…å­˜å¤§å°ä¸‹éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´é™åˆ¶åœ¨åæ¯«ç§’ä»¥å†…çš„åƒåœ¾æ”¶é›†å™¨ã€‚</p></blockquote><p>ç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€</p><p>ï¼ˆ2ï¼‰å›æ”¶ç­–ç•¥ä¼˜å…ˆå¤„ç†å›æ”¶ä»·å€¼æœ€å¤§çš„Region</p><p>ï¼ˆ3ï¼‰æ”¯æŒå¹¶å‘çš„æ•´ç†ç®—æ³•ã€‚</p><h4 id="ä¸‰ä¸ªé‡è¦çš„å¹¶å‘é˜¶æ®µï¼š"><a href="#ä¸‰ä¸ªé‡è¦çš„å¹¶å‘é˜¶æ®µï¼š" class="headerlink" title="ä¸‰ä¸ªé‡è¦çš„å¹¶å‘é˜¶æ®µï¼š"></a>ä¸‰ä¸ªé‡è¦çš„å¹¶å‘é˜¶æ®µï¼š</h4><p>å¹¶å‘æ ‡è®°ã€å¹¶å‘å›æ”¶ã€å¹¶å‘å¼•ç”¨æ›´æ–°ã€‚</p><p>å…·ä½“æ›´è¯¦ç»†çš„å­¦ä¹ ç¬”è®°ï¼š<a href="f8161112.html">ã€Šjvmåƒåœ¾æ”¶é›†å™¨Shenandoahã€‹</a></p><h3 id="2ã€ZGC-æ”¶é›†å™¨"><a href="#2ã€ZGC-æ”¶é›†å™¨" class="headerlink" title="2ã€ZGC æ”¶é›†å™¨"></a>2ã€ZGC æ”¶é›†å™¨</h3><h4 id="ä¸»è¦ç›®æ ‡ï¼š-1"><a href="#ä¸»è¦ç›®æ ‡ï¼š-1" class="headerlink" title="ä¸»è¦ç›®æ ‡ï¼š"></a>ä¸»è¦ç›®æ ‡ï¼š</h4><blockquote><p>å°½å¯èƒ½å¯¹ååé‡å½±å“ä¸å¤ªå¤§çš„å‰æä¸‹ï¼Œå®ç°åœ¨ä»»æ„å †å†…å­˜å¤§å°ä¸‹éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´é™åˆ¶åœ¨åæ¯«ç§’ä»¥å†…çš„ä½å»¶è¿Ÿã€‚</p></blockquote><h4 id="ZGCä¸»è¦ç‰¹å¾ï¼š"><a href="#ZGCä¸»è¦ç‰¹å¾ï¼š" class="headerlink" title="ZGCä¸»è¦ç‰¹å¾ï¼š"></a>ZGCä¸»è¦ç‰¹å¾ï¼š</h4><p>ï¼ˆ1ï¼‰ä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡ã€‚</p><p>ï¼ˆ2ï¼‰æš‚ä¸æ”¯æŒåˆ†ä»£çš„ã€‚</p><p>ï¼ˆ3ï¼‰åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€ã€‚</p><p>ï¼ˆ4ï¼‰æŸ“è‰²æŒ‡é’ˆå®ç°å¹¶å‘æ•´ç†ç®—æ³•ã€‚Colored Pointerã€‚</p><p>ï¼ˆ5ï¼‰å†…å­˜å¤šé‡æ˜ å°„æŠ€æœ¯ã€‚</p><p>ï¼ˆ6ï¼‰æ”¯æŒâ€œNUMA-Awareâ€çš„å†…å­˜åˆ†é…ã€‚(NUMAéç»Ÿä¸€å†…å­˜è®¿é—®æ¶æ„)</p><p>å…·ä½“æ›´è¯¦ç»†çš„å­¦ä¹ ç¬”è®°ï¼š<a href="e3d9aed7.html">ã€Šjvmåƒåœ¾æ”¶é›†å™¨ZGCã€‹</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> åƒåœ¾æ”¶é›†å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmä¹‹åƒåœ¾æ”¶é›†å™¨ç®—æ³•</title>
      <link href="/posts/50b49e8d.html"/>
      <url>/posts/50b49e8d.html</url>
      
        <content type="html"><![CDATA[<h2 id="jvm-åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#jvm-åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="jvm åƒåœ¾æ”¶é›†ç®—æ³•"></a>jvm åƒåœ¾æ”¶é›†ç®—æ³•</h2><p>åƒåœ¾æ”¶é›†ç®—æ³•åŸºæœ¬åˆ†ç±»ï¼š<br>ï¼ˆ1ï¼‰â€œå¼•ç”¨è®¡æ•°å¼åƒåœ¾æ”¶é›†â€ï¼ˆReference Counting GCï¼‰â€”ç›´æ¥åƒåœ¾æ”¶é›†<br>ï¼ˆ2ï¼‰â€œè¿½è¸ªå¼åƒåœ¾æ”¶é›†â€ï¼ˆTracing GCï¼‰â€”é—´æ¥åƒåœ¾æ”¶é›†</p><h3 id="1-åˆ†ä»£æ”¶é›†ç†è®º"><a href="#1-åˆ†ä»£æ”¶é›†ç†è®º" class="headerlink" title="1. åˆ†ä»£æ”¶é›†ç†è®º"></a>1. åˆ†ä»£æ”¶é›†ç†è®º</h3><p>1ï¼‰å¼±åˆ†ä»£å‡è¯´ï¼ˆWeak Generational Hypothesisï¼‰ï¼šç»å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•ç­çš„ã€‚<br>2ï¼‰å¼ºåˆ†ä»£å‡è¯´ï¼ˆStrong Generational Hypothesisï¼‰ï¼šç†¬è¿‡è¶Šå¤šæ¬¡åƒåœ¾æ”¶é›†è¿‡ç¨‹çš„å¯¹è±¡å°±è¶Šéš¾ä»¥æ¶ˆäº¡ã€‚<br>3ï¼‰è·¨ä»£å¼•ç”¨å‡è¯´ï¼ˆIntergenerational Reference Hypothesisï¼‰ï¼šè·¨ä»£å¼•ç”¨ç›¸å¯¹äºåŒä»£å¼•ç”¨æ¥è¯´ä»…å æå°‘æ•°ã€‚</p><p>å¸¸ç”¨åè¯ï¼š</p><blockquote><ul><li>éƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰ï¼šæŒ‡ç›®æ ‡ä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ªJavaå †çš„åƒåœ¾æ”¶é›†ï¼Œå…¶ä¸­åˆåˆ†ä¸ºï¼š<ul><li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC/Young GCï¼‰ï¼šæŒ‡ç›®æ ‡åªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†ã€‚</li><li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC/Old GCï¼‰ï¼šæŒ‡ç›®æ ‡åªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰CMSæ”¶-é›†å™¨ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚å¦å¤–è¯·æ³¨æ„â€œMajor GCâ€è¿™ä¸ªè¯´æ³•ç°åœ¨æœ‰ç‚¹æ··æ·†ï¼Œåœ¨ä¸åŒèµ„æ–™ä¸Šå¸¸æœ‰ä¸åŒæ‰€æŒ‡ï¼Œè¯»è€…éœ€æŒ‰ä¸Šä¸‹æ–‡åŒºåˆ†åˆ°åº•æ˜¯æŒ‡è€å¹´ä»£çš„æ”¶é›†è¿˜æ˜¯æ•´å †æ”¶é›†ã€‚</li><li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šæŒ‡ç›®æ ‡æ˜¯æ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰G1æ”¶é›†å™¨ä¼šæœ‰è¿™ç§è¡Œä¸ºã€‚</li></ul></li><li>æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªJavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</li></ul></blockquote><h3 id="2-æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰"><a href="#2-æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰" class="headerlink" title="2. æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰"></a>2. æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</h3><p>æœ€æ—©å‡ºç°ä¹Ÿæ˜¯æœ€åŸºç¡€çš„åƒåœ¾æ”¶é›†ç®—æ³•æ˜¯â€œæ ‡è®°-æ¸…é™¤â€ï¼ˆMark-Sweepï¼‰ç®—æ³•ã€‚</p><blockquote><p>ç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåï¼Œç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥ï¼Œæ ‡è®°å­˜æ´»çš„å¯¹è±¡ï¼Œç»Ÿä¸€å›æ”¶æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡</p></blockquote><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-mark-sweep.jpg" alt="Serialæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><p>ä¸»è¦ç¼ºç‚¹:<br>ï¼ˆ1ï¼‰æ‰§è¡Œæ•ˆç‡ä¸ç¨³å®šï¼Œéšç€å¯¹è±¡å¢åŠ æ‰§è¡Œæ•ˆç‡é™ä½ã€‚</p><blockquote><p>å¦‚æœJavaå †ä¸­åŒ…å«å¤§é‡å¯¹è±¡ï¼Œè€Œä¸”å…¶ä¸­å¤§éƒ¨åˆ†æ˜¯éœ€è¦è¢«å›æ”¶çš„ï¼Œè¿™æ—¶å¿…é¡»è¿›è¡Œå¤§é‡æ ‡è®°å’Œæ¸…é™¤çš„åŠ¨ä½œï¼Œå¯¼è‡´æ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ‰§è¡Œæ•ˆç‡éƒ½éšå¯¹è±¡æ•°é‡å¢é•¿è€Œé™ä½ï¼›</p></blockquote><p>ï¼ˆ2ï¼‰å†…å­˜ç©ºé—´ç¢ç‰‡åŒ–é—®é¢˜ï¼Œé‡åˆ°è¾ƒå¤§å¯¹è±¡ç”·åˆ†é…ï¼Œé‡æ–°GCã€‚</p><blockquote><p>ç¬¬äºŒä¸ªæ˜¯å†…å­˜ç©ºé—´çš„ç¢ç‰‡åŒ–é—®é¢˜ï¼Œæ ‡è®°ã€æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´å½“ä»¥ååœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§å¯¹è±¡æ—¶æ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œã€‚</p></blockquote><h3 id="3-æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆSemispace-Copyingï¼‰"><a href="#3-æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆSemispace-Copyingï¼‰" class="headerlink" title="3. æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆSemispace Copyingï¼‰"></a>3. æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆSemispace Copyingï¼‰</h3><p>æ ‡è®°-å¤åˆ¶ç®—æ³•å¸¸è¢«ç®€ç§°ä¸ºå¤åˆ¶ç®—æ³•ã€‚ä¸ºäº†è§£å†³æ ‡è®°-æ¸…é™¤ç®—æ³•é¢å¯¹å¤§é‡å¯å›æ”¶å¯¹è±¡æ—¶æ‰§è¡Œæ•ˆç‡ä½çš„é—®é¢˜ã€‚1969å¹´Fenichelæå‡ºäº†ä¸€ç§ç§°ä¸ºâ€œåŠåŒºå¤åˆ¶â€ï¼ˆSemispace Copyingï¼‰çš„åƒåœ¾æ”¶é›†ç®—æ³•ï¼š</p><blockquote><p>å°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚</p></blockquote><p>ä¼˜ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰å®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆã€‚<br>ï¼ˆ2ï¼‰åˆ†é…å†…å­˜æ—¶ä¹Ÿå°±ä¸ç”¨è€ƒè™‘æœ‰ç©ºé—´ç¢ç‰‡çš„å¤æ‚æƒ…å†µï¼Œåªè¦ç§»åŠ¨å †é¡¶æŒ‡é’ˆï¼ŒæŒ‰é¡ºåºåˆ†é…å³å¯</p><p>ç¼ºç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰å¦‚æœå†…å­˜ä¸­å¤šæ•°å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œè¿™ç§ç®—æ³•å°†ä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜é—´å¤åˆ¶çš„å¼€é”€ã€‚<br>ï¼ˆ2ï¼‰å°†å¯ç”¨å†…å­˜ç¼©å°ä¸ºäº†åŸæ¥çš„ä¸€åŠã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-Semispace-Copying.jpg" alt="Serialæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><blockquote><p>ç°åœ¨çš„å•†ç”¨Javaè™šæ‹Ÿæœºå¤§å¤šéƒ½ä¼˜å…ˆé‡‡ç”¨äº†è¿™ç§æ”¶é›†ç®—æ³•å»å›æ”¶æ–°ç”Ÿä»£ã€‚<br>åœ¨1989å¹´ï¼ŒAndrew Appelé’ˆå¯¹å…·å¤‡â€œæœç”Ÿå¤•ç­â€ç‰¹ç‚¹çš„å¯¹è±¡ï¼Œæå‡ºäº†ä¸€ç§æ›´ä¼˜åŒ–çš„åŠåŒºå¤åˆ¶åˆ†ä»£ç­–ç•¥ï¼Œç°åœ¨ç§°ä¸ºâ€œAppelå¼å›æ”¶â€ã€‚HotSpotè™šæ‹Ÿæœºçš„Serialã€ParNewç­‰æ–°ç”Ÿä»£æ”¶é›†å™¨å‡é‡‡ç”¨äº†è¿™ç§ç­–ç•¥æ¥è®¾è®¡æ–°ç”Ÿä»£çš„å†…å­˜å¸ƒå±€ã€‚</p><p>Appelå¼å›æ”¶çš„å…·ä½“åšæ³•æ˜¯æŠŠæ–°ç”Ÿä»£åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼ˆHotSpotè™šæ‹Ÿæœºé»˜è®¤Edenå’ŒSurvivorçš„å¤§å°æ¯”ä¾‹æ˜¯8âˆ¶1ï¼‰æ¯æ¬¡åˆ†é…å†…å­˜åªä½¿ç”¨Edenå’Œå…¶ä¸­ä¸€å—Survivorã€‚å‘ç”Ÿåƒåœ¾æœé›†æ—¶ï¼Œå°†Edenå’ŒSurvivorä¸­ä»ç„¶å­˜æ´»çš„å¯¹è±¡ä¸€æ¬¡æ€§å¤åˆ¶åˆ°å¦å¤–ä¸€å—Survivorç©ºé—´ä¸Šï¼Œç„¶åç›´æ¥æ¸…ç†æ‰Edenå’Œå·²ç”¨è¿‡çš„é‚£å—Survivorç©ºé—´ã€‚æ¯æ¬¡æ–°ç”Ÿä»£ä¸­å¯ç”¨å†…å­˜ç©ºé—´ä¸ºæ•´ä¸ªæ–°ç”Ÿä»£å®¹é‡çš„90%ï¼ˆEdençš„80%åŠ ä¸Šä¸€ä¸ªSurvivorçš„10%ï¼‰ï¼Œåªæœ‰ä¸€ä¸ªSurvivorç©ºé—´ï¼Œå³10%çš„æ–°ç”Ÿä»£æ˜¯ä¼šè¢«â€œæµªè´¹â€çš„ã€‚</p><p>å½“å¤åˆ¶ç›®æ ‡çš„Survivorç©ºé—´ä¸è¶³ä»¥å®¹çº³ä¸€æ¬¡Minor GCä¹‹åå­˜æ´»çš„å¯¹è±¡æ—¶ï¼Œé‡‡ç”¨ä¸€ç§åˆ†é…æ‹…ä¿ç­–ç•¥ï¼šå¤šå‡ºæ¥çš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚ </p></blockquote><h3 id="4-æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰"><a href="#4-æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰" class="headerlink" title="4. æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰"></a>4. æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰</h3><blockquote><p>ä¸åŒäºé’ˆå¯¹æ–°ç”Ÿä»£çš„å¤åˆ¶ç®—æ³•ï¼Œé’ˆå¯¹è€å¹´ä»£çš„ç‰¹ç‚¹ï¼Œ1974å¹´Edward Luedersæå‡ºäº†å¦å¤–ä¸€ç§æœ‰é’ˆå¯¹æ€§çš„â€œæ ‡è®°-æ•´ç†â€ï¼ˆMark-Compactï¼‰ç®—æ³•ã€‚å…¶ä¸­çš„æ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘å†…å­˜ç©ºé—´ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p></blockquote><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-Mark-Compact.jpg" alt="Parallel Scavengeæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><p>æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸æ ‡è®°-æ•´ç†ç®—æ³•çš„æœ¬è´¨å·®å¼‚åœ¨äºå‰è€…æ˜¯ä¸€ç§éç§»åŠ¨å¼çš„å›æ”¶ç®—æ³•ï¼Œè€Œåè€…æ˜¯ç§»åŠ¨å¼çš„ã€‚</p><p>ä¼˜ç¼ºç‚¹ï¼š</p><blockquote><p>å¦‚æœç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œå°¤å…¶æ˜¯åœ¨è€å¹´ä»£è¿™ç§æ¯æ¬¡å›æ”¶éƒ½æœ‰å¤§é‡å¯¹è±¡å­˜æ´»åŒºåŸŸï¼Œç§»åŠ¨å­˜æ´»å¯¹è±¡å¹¶æ›´æ–°æ‰€æœ‰å¼•ç”¨è¿™äº›å¯¹è±¡çš„åœ°æ–¹å°†ä¼šæ˜¯ä¸€ç§æä¸ºè´Ÿé‡çš„æ“ä½œï¼Œè€Œä¸”è¿™ç§å¯¹è±¡ç§»åŠ¨æ“ä½œå¿…é¡»å…¨ç¨‹æš‚åœç”¨æˆ·åº”ç”¨ç¨‹åºæ‰èƒ½è¿›è¡Œï¼ˆStop The Worldï¼‰ã€‚</p><p>å¦‚æœè·Ÿæ ‡è®°-æ¸…é™¤ç®—æ³•é‚£æ ·å®Œå…¨ä¸è€ƒè™‘ç§»åŠ¨å’Œæ•´ç†å­˜æ´»å¯¹è±¡çš„è¯ï¼Œå¼¥æ•£äºå †ä¸­çš„å­˜æ´»å¯¹è±¡å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡åŒ–é—®é¢˜å°±åªèƒ½ä¾èµ–æ›´ä¸ºå¤æ‚çš„å†…å­˜åˆ†é…å™¨å’Œå†…å­˜è®¿é—®å™¨æ¥è§£å†³ã€‚</p><p>æ˜¯å¦ç§»åŠ¨å¯¹è±¡éƒ½å­˜åœ¨å¼Šç«¯ï¼Œç§»åŠ¨åˆ™å†…å­˜å›æ”¶æ—¶ä¼šæ›´å¤æ‚ï¼Œä¸ç§»åŠ¨åˆ™å†…å­˜åˆ†é…æ—¶ä¼šæ›´å¤æ‚ã€‚ä»åƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´æ¥çœ‹ï¼Œä¸ç§»åŠ¨å¯¹è±¡åœé¡¿æ—¶é—´ä¼šæ›´çŸ­ï¼Œç”šè‡³å¯ä»¥ä¸éœ€è¦åœé¡¿ï¼Œä½†æ˜¯ä»æ•´ä¸ªç¨‹åºçš„ååé‡æ¥çœ‹ï¼Œç§»åŠ¨å¯¹è±¡ä¼šæ›´åˆ’ç®—ã€‚æ­¤è¯­å¢ƒä¸­ï¼Œååé‡çš„å®è´¨æ˜¯èµ‹å€¼å™¨ï¼ˆMutatorï¼Œå¯ä»¥ç†è§£ä¸ºä½¿ç”¨åƒåœ¾æ”¶é›†çš„ç”¨æˆ·ç¨‹åºï¼Œæœ¬ä¹¦ä¸ºä¾¿äºç†è§£ï¼Œå¤šæ•°åœ°æ–¹ç”¨â€œç”¨æˆ·ç¨‹åºâ€æˆ–â€œç”¨æˆ·çº¿ç¨‹â€ä»£æ›¿ï¼‰ä¸æ”¶é›†å™¨çš„æ•ˆç‡æ€»å’Œã€‚å³ä½¿ä¸ç§»åŠ¨å¯¹è±¡ä¼šä½¿å¾—æ”¶é›†å™¨çš„æ•ˆç‡æå‡ä¸€äº›ï¼Œä½†å› å†…å­˜åˆ†é…å’Œè®¿é—®ç›¸æ¯”åƒåœ¾æ”¶é›†é¢‘ç‡è¦é«˜å¾—å¤šï¼Œè¿™éƒ¨åˆ†çš„è€—æ—¶å¢åŠ ï¼Œæ€»ååé‡ä»ç„¶æ˜¯ä¸‹é™çš„ã€‚HotSpotè™šæ‹Ÿæœºé‡Œé¢å…³æ³¨ååé‡çš„Parallel Scavengeæ”¶é›†å™¨æ˜¯åŸºäºæ ‡è®°-æ•´ç†ç®—æ³•çš„ï¼Œè€Œå…³æ³¨å»¶è¿Ÿçš„CMSæ”¶é›†å™¨åˆ™æ˜¯åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•çš„ã€‚</p></blockquote><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> åƒåœ¾æ”¶é›†å™¨ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmä¹‹å¯¹è±¡ç”Ÿæ­»</title>
      <link href="/posts/bce48291.html"/>
      <url>/posts/bce48291.html</url>
      
        <content type="html"><![CDATA[<h3 id="jvm-æ£€æµ‹åˆ¤æ–­å¯¹è±¡çš„ç”Ÿæ­»"><a href="#jvm-æ£€æµ‹åˆ¤æ–­å¯¹è±¡çš„ç”Ÿæ­»" class="headerlink" title="jvm æ£€æµ‹åˆ¤æ–­å¯¹è±¡çš„ç”Ÿæ­»"></a>jvm æ£€æµ‹åˆ¤æ–­å¯¹è±¡çš„ç”Ÿæ­»</h3><p>åƒåœ¾æ”¶é›†ï¼ˆGarbage Collectionï¼Œç®€ç§°GCï¼‰</p><p>å¯¹è±¡ç”Ÿæ­»</p><blockquote><p>å †é‡Œé¢å­˜æ”¾ç€Javaä¸–ç•Œä¸­å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨å¯¹å †è¿›è¡Œå›æ”¶å‰ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¦ç¡®å®šè¿™äº›å¯¹è±¡ä¹‹ä¸­å“ªäº›è¿˜â€œå­˜æ´»â€ç€ï¼Œå“ªäº›å·²ç»â€œæ­»å»â€ï¼ˆâ€œæ­»å»â€å³ä¸å¯èƒ½å†è¢«ä»»ä½•é€”å¾„ä½¿ç”¨çš„å¯¹è±¡ï¼‰äº†ã€‚å¯¹è±¡æ˜¯å¦å­˜æ´»çš„ç®—æ³•å„ä¸ç›¸åŒã€‚</p></blockquote><h4 id="1-å¼•ç”¨è®¡æ•°ç®—æ³•"><a href="#1-å¼•ç”¨è®¡æ•°ç®—æ³•" class="headerlink" title="1. å¼•ç”¨è®¡æ•°ç®—æ³•"></a>1. å¼•ç”¨è®¡æ•°ç®—æ³•</h4><p>å¼•ç”¨è®¡æ•°ç®—æ³•:<br><P><br>åœ¨å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±åŠ ä¸€ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±å‡ä¸€ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸ºé›¶çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„<br></P><br>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆReference Countingï¼‰è™½ç„¶å ç”¨äº†ä¸€äº›é¢å¤–çš„å†…å­˜ç©ºé—´æ¥è¿›è¡Œè®¡æ•°ï¼Œä½†å®ƒçš„åŸç†ç®€å•ï¼Œåˆ¤å®šæ•ˆç‡ä¹Ÿå¾ˆé«˜ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å®ƒéƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„ç®—æ³•ã€‚</p><p>å¼•ç”¨è®¡æ•°ç®—æ³•çš„ç¼ºé™·ï¼šä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œæ°¸ä¸å›æ”¶ã€‚<br>ä»£ç ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/** * testGC()æ–¹æ³•æ‰§è¡Œåï¼ŒobjAå’ŒobjBä¼šä¸ä¼šè¢«GCå‘¢ï¼Ÿ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReferenceCountingGC</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> Object instance <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * è¿™ä¸ªæˆå‘˜å±æ€§çš„å”¯ä¸€æ„ä¹‰å°±æ˜¯å ç‚¹å†…å­˜ï¼Œä»¥ä¾¿èƒ½åœ¨GCæ—¥å¿—ä¸­çœ‹æ¸…æ¥šæ˜¯å¦æœ‰å›æ”¶è¿‡     */</span>    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bigSize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ReferenceCountingGC objA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ReferenceCountingGC objB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        objAï¼instance <span class="token operator">=</span> objB<span class="token punctuation">;</span>        objBï¼instance <span class="token operator">=</span> objA<span class="token punctuation">;</span>        objA <span class="token operator">=</span> null<span class="token punctuation">;</span>        objB <span class="token operator">=</span> null<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å‡è®¾åœ¨è¿™è¡Œå‘ç”ŸGCï¼ŒobjAå’ŒobjBæ˜¯å¦èƒ½è¢«å›æ”¶ï¼Ÿ</span>        System<span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¿è¡Œç»“æœï¼š</p><pre><code>[Full GC (System) [Tenured: 0K-&gt;210K(10240K), 0.0149142 secs] 4603K-&gt;210K(19456K), [Perm : 2999K-&gt;2999K(21248K)], 0.0150007 secs] [Times: user=0.01 sys=0.00, real=0.02 secs]Heap    def new generation   total 9216K, used 82K [0x00000000055e0000, 0x0000000005fe0000, 0x0000000005fe0000)    Eden space 8192K,   1% used [0x00000000055e0000, 0x00000000055f4850, 0x0000000005de0000)    from space 1024K,   0% used [0x0000000005de0000, 0x0000000005de0000, 0x0000000005ee0000)    to   space 1024K,   0% used [0x0000000005ee0000, 0x0000000005ee0000, 0x0000000005fe0000)    tenured generation   total 10240K, used 210K [0x0000000005fe0000, 0x00000000069e0000, 0x00000000069e0000)    the space 10240K,   2% used [0x0000000005fe0000, 0x0000000006014a18, 0x0000000006014c00, 0x00000000069e0000)    compacting perm gen  total 21248K, used 3016K [0x00000000069e0000, 0x0000000007ea0000, 0x000000000bde0000)    the space 21248K,  14% used [0x00000000069e0000, 0x0000000006cd2398, 0x0000000006cd2400, 0x0000000007ea0000)    No shared spaces configured.</code></pre><p>å†…å­˜å›æ”¶æ—¥å¿—ä¸­åŒ…å«<code>â€œ4603K-&gt;210Kâ€</code>ï¼Œæ„å‘³ç€è™šæ‹Ÿæœºå¹¶æ²¡æœ‰å› ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨å°±æ”¾å¼ƒå›æ”¶å®ƒä»¬ï¼Œè¿™ä¹Ÿä»ä¾§é¢è¯´æ˜äº†Javaè™šæ‹Ÿæœºå¹¶ä¸æ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„ã€‚</p><h4 id="2-å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#2-å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="2.å¯è¾¾æ€§åˆ†æç®—æ³•"></a>2.å¯è¾¾æ€§åˆ†æç®—æ³•</h4><p>å½“å‰ä¸»æµçš„å•†ç”¨ç¨‹åºè¯­è¨€ï¼ˆJavaã€C#ï¼Œä¸Šæº¯è‡³å‰é¢æåˆ°çš„å¤è€çš„Lispï¼‰çš„å†…å­˜ç®¡ç†å­ç³»ç»Ÿï¼Œéƒ½æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æï¼ˆReachability Analysisï¼‰ç®—æ³•æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»çš„ã€‚è¿™ä¸ªç®—æ³•çš„åŸºæœ¬æ€è·¯:</p><blockquote><p>é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸ºâ€œGC Rootsâ€çš„æ ¹å¯¹è±¡ä½œä¸ºèµ·å§‹èŠ‚ç‚¹é›†ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹ï¼Œæ ¹æ®å¼•ç”¨å…³ç³»å‘ä¸‹æœç´¢ï¼Œæœç´¢è¿‡ç¨‹æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºâ€œå¼•ç”¨é“¾â€ï¼ˆReference Chainï¼‰ï¼Œå¦‚æœæŸä¸ªå¯¹è±¡åˆ°GCRootsé—´æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œæˆ–è€…ç”¨å›¾è®ºçš„è¯æ¥è¯´å°±æ˜¯ä»GC Rootsåˆ°è¿™ä¸ªå¯¹è±¡ä¸å¯è¾¾æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</p></blockquote><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-gc-1.jpg" alt="GC Roots ç¤ºæ„å›¾"></p><p>åœ¨JavaæŠ€æœ¯ä½“ç³»é‡Œé¢ï¼Œå›ºå®šå¯ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p><blockquote><p>ï¼ˆ1ï¼‰åœ¨è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚å„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•å †æ ˆä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ã€ä¸´æ—¶å˜é‡ç­‰ã€‚<br>ï¼ˆ2ï¼‰åœ¨æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡ã€‚<br>ï¼ˆ3ï¼‰åœ¨æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Tableï¼‰é‡Œçš„å¼•ç”¨ã€‚<br>ï¼ˆ4ï¼‰åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³é€šå¸¸æ‰€è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡ã€‚<br>ï¼ˆ5ï¼‰Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ï¼Œå¦‚åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„Classå¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆæ¯”å¦‚NullPointExcepitonã€OutOfMemoryErrorï¼‰ç­‰ï¼Œè¿˜æœ‰ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚<br>ï¼ˆ6ï¼‰æ‰€æœ‰è¢«åŒæ­¥é”ï¼ˆsynchronizedå…³é”®å­—ï¼‰æŒæœ‰çš„å¯¹è±¡ã€‚<br>ï¼ˆ7ï¼‰åæ˜ Javaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBeanã€JVMTIä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚</p></blockquote><p>é™¤äº†è¿™äº›å›ºå®šçš„GC Rootsé›†åˆä»¥å¤–ï¼Œæ ¹æ®ç”¨æˆ·æ‰€é€‰ç”¨çš„åƒåœ¾æ”¶é›†å™¨ä»¥åŠå½“å‰å›æ”¶çš„å†…å­˜åŒºåŸŸä¸åŒï¼Œè¿˜å¯ä»¥æœ‰å…¶ä»–å¯¹è±¡â€œä¸´æ—¶æ€§â€åœ°åŠ å…¥ï¼Œå…±åŒæ„æˆå®Œæ•´GC Rootsé›†åˆã€‚</p><h4 id="3-å¯¹è±¡å¼•ç”¨åŠåˆ†ç±»"><a href="#3-å¯¹è±¡å¼•ç”¨åŠåˆ†ç±»" class="headerlink" title="3. å¯¹è±¡å¼•ç”¨åŠåˆ†ç±»"></a>3. å¯¹è±¡å¼•ç”¨åŠåˆ†ç±»</h4><p>åœ¨JDK 1.2ç‰ˆä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸º<code>å¼ºå¼•ç”¨ï¼ˆStrongly Re-ferenceï¼‰</code>ã€<code>è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</code>ã€<code>å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</code>å’Œ<code>è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</code>4ç§ï¼Œè¿™4ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±ã€‚å¯ä»¥ç®€å†™æˆï¼š</p><pre><code>å¼ºå¼•ç”¨ &gt; è½¯å¼•ç”¨ &gt; å¼±å¼•ç”¨ &gt; è™šå¼•ç”¨</code></pre><p>ï¼ˆ1ï¼‰å¼ºå¼•ç”¨ï¼ˆStrongly Re-ferenceï¼‰</p><blockquote><p>å¼ºå¼•ç”¨æ˜¯æœ€ä¼ ç»Ÿçš„â€œå¼•ç”¨â€çš„å®šä¹‰ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¹‹ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ï¼Œå³ç±»ä¼¼<code>â€œObject obj=new Object()â€</code>è¿™ç§å¼•ç”¨å…³ç³»ã€‚æ— è®ºä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</p></blockquote><p>ï¼ˆ2ï¼‰è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</p><blockquote><p>è½¯å¼•ç”¨æ˜¯ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ï¼Œä½†éå¿…é¡»çš„å¯¹è±¡ã€‚åªè¢«è½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸å‰ï¼Œä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ï¼Œå¦‚æœè¿™æ¬¡å›æ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚åœ¨JDK 1.2ç‰ˆä¹‹åæä¾›äº†<code>SoftReference</code>ç±»æ¥å®ç°è½¯å¼•ç”¨ã€‚</p></blockquote><p>ï¼ˆ3ï¼‰å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</p><blockquote><p>å¼±å¼•ç”¨ä¹Ÿæ˜¯ç”¨æ¥æè¿°é‚£äº›éå¿…é¡»å¯¹è±¡ï¼Œä½†æ˜¯å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±ä¸€äº›ï¼Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¸ºæ­¢ã€‚å½“åƒåœ¾æ”¶é›†å™¨å¼€å§‹å·¥ä½œï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚åœ¨JDK 1.2ç‰ˆä¹‹åæä¾›äº†<code>WeakReference</code>ç±»æ¥å®ç°å¼±å¼•ç”¨ã€‚</p></blockquote><p>ï¼ˆ4ï¼‰è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</p><blockquote><p>è™šå¼•ç”¨ä¹Ÿç§°ä¸ºâ€œå¹½çµå¼•ç”¨â€æˆ–è€…â€œå¹»å½±å¼•ç”¨â€ï¼Œå®ƒæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ã€‚ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥å–å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„åªæ˜¯ä¸ºäº†èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚åœ¨JDK 1.2ç‰ˆä¹‹åæä¾›äº†<code>PhantomReference</code>ç±»æ¥å®ç°è™šå¼•ç”¨ã€‚</p></blockquote><h4 id="4-æ˜¯ç”Ÿæ˜¯æ­»ï¼Ÿ"><a href="#4-æ˜¯ç”Ÿæ˜¯æ­»ï¼Ÿ" class="headerlink" title="4. æ˜¯ç”Ÿæ˜¯æ­»ï¼Ÿ"></a>4. æ˜¯ç”Ÿæ˜¯æ­»ï¼Ÿ</h4><blockquote><p>åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­åˆ¤å®šä¸ºä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿä¸æ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶è¿˜å¤„äºâ€œç¼“åˆ‘â€é˜¶æ®µï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼šå¦‚æœå¯¹è±¡åœ¨è¿›è¡Œå¯è¾¾æ€§åˆ†æåå‘ç°æ²¡æœ‰ä¸GC Rootsç›¸è¿æ¥çš„å¼•ç”¨é“¾ï¼Œé‚£å®ƒå°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°ï¼Œéšåè¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ã€‚å‡å¦‚å¯¹è±¡æ²¡æœ‰è¦†ç›–finalize()æ–¹æ³•ï¼Œæˆ–è€…finalize()æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºâ€œæ²¡æœ‰å¿…è¦æ‰§è¡Œâ€ã€‚</p></blockquote><p>å¦‚æœè¿™ä¸ªå¯¹è±¡è¢«åˆ¤å®šä¸ºç¡®æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°†ä¼šè¢«æ”¾ç½®åœ¨ä¸€ä¸ªåä¸ºF-Queueçš„é˜Ÿåˆ—ä¹‹ä¸­ï¼Œå¹¶åœ¨ç¨åç”±ä¸€æ¡ç”±è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä½è°ƒåº¦ä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹å»æ‰§è¡Œå®ƒä»¬çš„finalize()æ–¹æ³•ã€‚è¿™é‡Œæ‰€è¯´çš„â€œæ‰§è¡Œâ€æ˜¯æŒ‡è™šæ‹Ÿæœºä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•å¼€å§‹è¿è¡Œï¼Œä½†å¹¶ä¸æ‰¿è¯ºä¸€å®šä¼šç­‰å¾…å®ƒè¿è¡Œç»“æŸã€‚è¿™æ ·åšçš„åŸå› æ˜¯ï¼Œå¦‚æœæŸä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•æ‰§è¡Œç¼“æ…¢ï¼Œæˆ–è€…æ›´æç«¯åœ°å‘ç”Ÿäº†æ­»å¾ªç¯ï¼Œå°†å¾ˆå¯èƒ½å¯¼è‡´F-Queueé˜Ÿåˆ—ä¸­çš„å…¶ä»–å¯¹è±¡æ°¸ä¹…å¤„äºç­‰å¾…ï¼Œç”šè‡³å¯¼è‡´æ•´ä¸ªå†…å­˜å›æ”¶å­ç³»ç»Ÿçš„å´©æºƒã€‚</p><p>finalize()æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡å‘½è¿çš„æœ€åä¸€æ¬¡æœºä¼šï¼Œç¨åæ”¶é›†å™¨å°†å¯¹F-Queueä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å°è§„æ¨¡çš„æ ‡è®°ï¼Œå¦‚æœå¯¹è±¡è¦åœ¨finalize()ä¸­æˆåŠŸæ‹¯æ•‘è‡ªå·±â€”â€”åªè¦é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”å³å¯ï¼Œè­¬å¦‚æŠŠè‡ªå·±ï¼ˆthiså…³é”®å­—ï¼‰èµ‹å€¼ç»™æŸä¸ªç±»å˜é‡æˆ–è€…å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œé‚£åœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶å®ƒå°†è¢«ç§»å‡ºâ€œå³å°†å›æ”¶â€çš„é›†åˆï¼›å¦‚æœå¯¹è±¡è¿™æ—¶å€™è¿˜æ²¡æœ‰é€ƒè„±ï¼Œé‚£åŸºæœ¬ä¸Šå®ƒå°±çœŸçš„è¦è¢«å›æ”¶äº†ã€‚</p><p>ä¹¦ä¸­ä»£ç ç¤ºä¾‹ï¼š</p><pre><code>/** * æ­¤ä»£ç æ¼”ç¤ºäº†ä¸¤ç‚¹ï¼š * 1.å¯¹è±¡å¯ä»¥åœ¨è¢«GCæ—¶è‡ªæˆ‘æ‹¯æ•‘ã€‚ * 2.è¿™ç§è‡ªæ•‘çš„æœºä¼šåªæœ‰ä¸€æ¬¡ï¼Œå› ä¸ºä¸€ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•æœ€å¤šåªä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ */public class FinalizeEscapeGC {    public static FinalizeEscapeGC SAVE_HOOK = null;    public void isAlive() {        System.out.println(&quot;yes, i am still alive :)&quot;);    }    @Override    protected void finalize() throws Throwable {        super.finalize();        System.out.println(&quot;finalize method executed!&quot;);        FinalizeEscapeGCï¼SAVE_HOOK = this;    }    public static void main(String[] args) throws Throwable {        SAVE_HOOK = new FinalizeEscapeGC();        //å¯¹è±¡ç¬¬ä¸€æ¬¡æˆåŠŸæ‹¯æ•‘è‡ªå·±        SAVE_HOOK = null;        System.gc();        // å› ä¸ºFinalizeræ–¹æ³•ä¼˜å…ˆçº§å¾ˆä½ï¼Œæš‚åœ0.5ç§’ï¼Œä»¥ç­‰å¾…å®ƒ        Thread.sleep(500);        if (SAVE_HOOK != null) {            SAVE_HOOK.isAlive();        } else {            System.out.println(&quot;no, i am dead :(&quot;);        }        // ä¸‹é¢è¿™æ®µä»£ç ä¸ä¸Šé¢çš„å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯è¿™æ¬¡è‡ªæ•‘å´å¤±è´¥äº†        SAVE_HOOK = null;        System.gc();        // å› ä¸ºFinalizeræ–¹æ³•ä¼˜å…ˆçº§å¾ˆä½ï¼Œæš‚åœ0.5ç§’ï¼Œä»¥ç­‰å¾…å®ƒ        Thread.sleep(500);        if (SAVE_HOOK != null) {            SAVE_HOOK.isAlive();        } else {            System.out.println(&quot;no, i am dead :(&quot;);        }    }}</code></pre><p>è¿è¡Œç»“æœï¼š</p><pre><code>finalize method executed!yes, i am still alive :)no, i am dead :(</code></pre><p>ç»“è®º</p><blockquote><p>ä»»ä½•ä¸€ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•éƒ½åªä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœå¯¹è±¡é¢ä¸´ä¸‹ä¸€æ¬¡å›æ”¶ï¼Œå®ƒçš„finalize()æ–¹æ³•ä¸ä¼šè¢«å†æ¬¡æ‰§è¡Œã€‚</p></blockquote><h4 id="5-å›æ”¶æ–¹æ³•åŒº"><a href="#5-å›æ”¶æ–¹æ³•åŒº" class="headerlink" title="5. å›æ”¶æ–¹æ³•åŒº"></a>5. å›æ”¶æ–¹æ³•åŒº</h4><blockquote><p>åœ¨Javaå †ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œå¯¹å¸¸è§„åº”ç”¨è¿›è¡Œä¸€æ¬¡åƒåœ¾æ”¶é›†é€šå¸¸å¯ä»¥å›æ”¶70%è‡³99%çš„å†…å­˜ç©ºé—´ï¼Œæ–¹æ³•åŒºå›æ”¶æ¡ä»¶è‹›åˆ»ï¼Œå›æ”¶æˆæœæå°ã€‚</p></blockquote><p>æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šåºŸå¼ƒçš„å¸¸é‡ï¼Œä¸å†ä½¿ç”¨çš„ç±»å‹ã€‚<br>ï¼ˆ1ï¼‰åºŸå¼ƒçš„å¸¸é‡</p><blockquote><p>å›æ”¶åºŸå¼ƒå¸¸é‡ä¸å›æ”¶Javaå †ä¸­çš„å¯¹è±¡éå¸¸ç±»ä¼¼ã€‚ä¸¾ä¸ªå¸¸é‡æ± ä¸­å­—é¢é‡å›æ”¶çš„ä¾‹å­ï¼Œå‡å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²â€œjavaâ€æ›¾ç»è¿›å…¥å¸¸é‡æ± ä¸­ï¼Œä½†æ˜¯å½“å‰ç³»ç»Ÿåˆæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å€¼æ˜¯â€œjavaâ€ï¼Œæ¢å¥è¯è¯´ï¼Œå·²ç»æ²¡æœ‰ä»»ä½•å­—ç¬¦ä¸²å¯¹è±¡å¼•ç”¨å¸¸é‡æ± ä¸­çš„â€œjavaâ€å¸¸é‡ï¼Œä¸”è™šæ‹Ÿæœºä¸­ä¹Ÿæ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨è¿™ä¸ªå­—é¢é‡ã€‚å¦‚æœåœ¨è¿™æ—¶å‘ç”Ÿå†…å­˜å›æ”¶ï¼Œè€Œä¸”åƒåœ¾æ”¶é›†å™¨åˆ¤æ–­ç¡®æœ‰å¿…è¦çš„è¯ï¼Œè¿™ä¸ªâ€œjavaâ€å¸¸é‡å°±å°†ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± ã€‚å¸¸é‡æ± ä¸­å…¶ä»–ç±»ï¼ˆæ¥å£ï¼‰ã€æ–¹æ³•ã€å­—æ®µçš„ç¬¦å·å¼•ç”¨ä¹Ÿä¸æ­¤ç±»ä¼¼ã€‚</p></blockquote><p>ç³»ç»Ÿå’Œè™šæ‹Ÿæœºä¸­å‡æ²¡æœ‰å¼•ç”¨æ”¹å¸¸é‡å³å¯ã€‚</p><p>ï¼ˆ2ï¼‰ä¸å†ä½¿ç”¨çš„ç±»å‹</p><p>éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶:<br>A. è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼ŒJavaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»åŠå…¶ä»»ä½•æ´¾ç”Ÿå­ç±»çš„å®ä¾‹<br>B. åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶ã€‚ï¼ˆéš¾è¾¾æˆï¼‰<br>C. è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚ </p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> å¯¹è±¡ç”Ÿæ­» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmä¹‹å¯¹è±¡åˆ›å»ºä¸å¸ƒå±€</title>
      <link href="/posts/b287f556.html"/>
      <url>/posts/b287f556.html</url>
      
        <content type="html"><![CDATA[<h2 id="HotSpot-è™šæ‹Ÿæœºå¯¹è±¡åˆ›å»ºä¸å¸ƒå±€"><a href="#HotSpot-è™šæ‹Ÿæœºå¯¹è±¡åˆ›å»ºä¸å¸ƒå±€" class="headerlink" title="HotSpot è™šæ‹Ÿæœºå¯¹è±¡åˆ›å»ºä¸å¸ƒå±€"></a>HotSpot è™šæ‹Ÿæœºå¯¹è±¡åˆ›å»ºä¸å¸ƒå±€</h2><p>HotSpotè™šæ‹Ÿæœºåœ¨Javaå †ä¸­å¯¹è±¡åˆ†é…ã€å¸ƒå±€å’Œè®¿é—®çš„å…¨è¿‡ç¨‹ã€‚<br>åˆ›å»ºå¯¹è±¡çš„ä¸‰ç§æ–¹å¼ï¼šnewå…³é”®å­—ã€å¤åˆ¶ã€ååºåˆ—åŒ–ã€‚</p><h3 id="ä¸€-å¯¹è±¡çš„åˆ›å»º"><a href="#ä¸€-å¯¹è±¡çš„åˆ›å»º" class="headerlink" title="ä¸€. å¯¹è±¡çš„åˆ›å»º"></a>ä¸€. å¯¹è±¡çš„åˆ›å»º</h3><p>æ­¤å¤„æåŠçš„å¯¹è±¡åˆ›å»ºï¼Œåªæ˜¯æ™®é€šJavaå¯¹è±¡ï¼Œä¸åŒ…æ‹¬æ•°ç»„å’ŒClasså¯¹è±¡ã€‚</p><h4 id="1-æ£€æŸ¥ç¬¦åˆå¼•ç”¨å’Œç±»åŠ è½½æƒ…å†µ"><a href="#1-æ£€æŸ¥ç¬¦åˆå¼•ç”¨å’Œç±»åŠ è½½æƒ…å†µ" class="headerlink" title="1. æ£€æŸ¥ç¬¦åˆå¼•ç”¨å’Œç±»åŠ è½½æƒ…å†µ"></a>1. æ£€æŸ¥ç¬¦åˆå¼•ç”¨å’Œç±»åŠ è½½æƒ…å†µ</h4><p>å½“Javaè™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡å­—èŠ‚ç newæŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p><h4 id="2-ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜"><a href="#2-ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜" class="headerlink" title="2. ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜"></a>2. ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜</h4><p>åœ¨ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚å¯¹è±¡æ‰€éœ€å†…å­˜çš„å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåä¾¿å¯å®Œå…¨ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡å…¶å®å°±æ˜¯æŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜å—ä»Javaå †ä¸­åˆ’åˆ†å‡ºæ¥å­˜æ”¾è¯¥å¯¹è±¡ã€‚</p><p>å…³äºå¯¹è±¡å†…å­˜åˆ†é…æ–¹å¼ï¼š<br>ï¼ˆ1ï¼‰â€œæŒ‡é’ˆç¢°æ’â€ï¼ˆBump The Pointerï¼‰</p><blockquote><p>å‡è®¾Javaå †ä¸­å†…å­˜æ˜¯ç»å¯¹è§„æ•´çš„ï¼Œæ‰€æœ‰è¢«ä½¿ç”¨è¿‡çš„å†…å­˜éƒ½è¢«æ”¾åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜è¢«æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œé‚£æ‰€åˆ†é…å†…å­˜å°±ä»…ä»…æ˜¯æŠŠé‚£ä¸ªæŒ‡é’ˆå‘ç©ºé—²ç©ºé—´æ–¹å‘æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»ï¼Œè¿™ç§åˆ†é…æ–¹å¼ç§°ä¸ºâ€œæŒ‡é’ˆç¢°æ’â€ï¼ˆBump The Pointerï¼‰</p></blockquote><p>ï¼ˆ2ï¼‰â€œç©ºé—²åˆ—è¡¨â€ï¼ˆFree Listï¼‰:</p><blockquote><p>Javaå †ä¸­çš„å†…å­˜å¹¶ä¸æ˜¯è§„æ•´çš„ï¼Œå·²è¢«ä½¿ç”¨çš„å†…å­˜å’Œç©ºé—²çš„å†…å­˜ç›¸äº’äº¤é”™åœ¨ä¸€èµ·ï¼Œé‚£å°±æ²¡æœ‰åŠæ³•ç®€å•åœ°è¿›è¡ŒæŒ‡é’ˆç¢°æ’äº†ï¼Œè™šæ‹Ÿæœºå°±å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•ä¸Šå“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•ï¼Œè¿™ç§åˆ†é…æ–¹å¼ç§°ä¸ºâ€œç©ºé—²åˆ—è¡¨â€ï¼ˆFree Listï¼‰</p></blockquote><p>é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ï¼Œå–å†³äºJavaå †æ˜¯å¦è§„æ•´å†³å®šï¼Œè€ŒJavaå †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰ç©ºé—´å‹ç¼©æ•´ç†ï¼ˆCompactï¼‰çš„èƒ½åŠ›å†³å®šã€‚å› æ­¤ï¼š</p><p>ï¼ˆAï¼‰å½“ä½¿ç”¨Serialã€ParNewç­‰å¸¦å‹ç¼©æ•´ç†è¿‡ç¨‹çš„æ”¶é›†å™¨æ—¶ï¼Œç³»ç»Ÿé‡‡ç”¨çš„åˆ†é…ç®—æ³•æ˜¯æŒ‡é’ˆç¢°æ’ï¼Œæ—¢ç®€å•åˆé«˜æ•ˆï¼›<br>ï¼ˆBï¼‰å½“ä½¿ç”¨CMSè¿™ç§åŸºäºæ¸…é™¤ï¼ˆSweepï¼‰ç®—æ³•çš„æ”¶é›†å™¨æ—¶ï¼Œç†è®ºä¸Šå°±åªèƒ½é‡‡ç”¨è¾ƒä¸ºå¤æ‚çš„ç©ºé—²åˆ—è¡¨æ¥åˆ†é…å†…å­˜ã€‚</p><p>è€ƒè™‘å¯¹è±¡å†…å­˜åˆ†é…çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š</p><blockquote><p>æŠŠå†…å­˜åˆ†é…çš„åŠ¨ä½œæŒ‰ç…§çº¿ç¨‹åˆ’åˆ†åœ¨ä¸åŒçš„ç©ºé—´ä¹‹ä¸­è¿›è¡Œï¼Œå³æ¯ä¸ªçº¿ç¨‹åœ¨Javaå †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œç§°ä¸º<code>æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼ˆThread Local Allocation Bufferï¼ŒTLABï¼‰</code>ï¼Œå“ªä¸ªçº¿ç¨‹è¦åˆ†é…å†…å­˜ï¼Œå°±åœ¨å“ªä¸ªçº¿ç¨‹çš„æœ¬åœ°ç¼“å†²åŒºä¸­åˆ†é…ï¼Œåªæœ‰æœ¬åœ°ç¼“å†²åŒºç”¨å®Œäº†ï¼Œåˆ†é…æ–°çš„ç¼“å­˜åŒºæ—¶æ‰éœ€è¦åŒæ­¥é”å®šã€å¯¹åˆ†é…å†…å­˜ç©ºé—´çš„åŠ¨ä½œè¿›è¡ŒåŒæ­¥å¤„ç†â€”â€”å®é™…ä¸Šè™šæ‹Ÿæœºæ˜¯é‡‡ç”¨<code>CAS</code>é…ä¸Šå¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ã€‘ã€‚è™šæ‹Ÿæœºæ˜¯å¦ä½¿ç”¨<code>TLAB</code>ï¼Œå¯ä»¥é€šè¿‡<code>-XXï¼š+/-UseTLAB</code>å‚æ•°æ¥è®¾å®šã€‚</p></blockquote><p>æ¯ä¸ªçº¿ç¨‹åœ¨å †ä¸­éƒ½ä¼šæœ‰ç§æœ‰çš„<code>åˆ†é…ç¼“å†²åŒº(TLAB)</code>ï¼Œè¿™æ ·å¯ä»¥å¾ˆå¤§ç¨‹åº¦é¿å…åœ¨å¹¶å‘æƒ…å†µä¸‹é¢‘ç¹åˆ›å»ºå¯¹è±¡é€ æˆçš„çº¿ç¨‹ä¸å®‰å…¨ã€‚</p><h4 id="3-å°†åˆ†é…çš„å†…å­˜åˆå§‹åŒ–ä¸ºé›¶å€¼"><a href="#3-å°†åˆ†é…çš„å†…å­˜åˆå§‹åŒ–ä¸ºé›¶å€¼" class="headerlink" title="3. å°†åˆ†é…çš„å†…å­˜åˆå§‹åŒ–ä¸ºé›¶å€¼"></a>3. å°†åˆ†é…çš„å†…å­˜åˆå§‹åŒ–ä¸ºé›¶å€¼</h4><p>å†…å­˜åˆ†é…å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºå¿…é¡»å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´ï¼ˆä½†ä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼Œå¦‚æœä½¿ç”¨äº†TLABçš„è¯ï¼Œè¿™ä¸€é¡¹å·¥ä½œä¹Ÿå¯ä»¥æå‰è‡³<code>TLAB</code>åˆ†é…æ—¶é¡ºä¾¿è¿›è¡Œã€‚è¿™æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨Javaä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œä½¿ç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚</p><h4 id="4-å¯¹æ–°ç”Ÿçš„å¯¹è±¡è¿›è¡Œè®¾ç½®"><a href="#4-å¯¹æ–°ç”Ÿçš„å¯¹è±¡è¿›è¡Œè®¾ç½®" class="headerlink" title="4. å¯¹æ–°ç”Ÿçš„å¯¹è±¡è¿›è¡Œè®¾ç½®"></a>4. å¯¹æ–°ç”Ÿçš„å¯¹è±¡è¿›è¡Œè®¾ç½®</h4><p>å¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ï¼ˆå®é™…ä¸Šå¯¹è±¡çš„å“ˆå¸Œç ä¼šå»¶ååˆ°çœŸæ­£è°ƒç”¨<code>Object::hashCode()</code>æ–¹æ³•æ—¶æ‰è®¡ç®—ï¼‰ã€å¯¹è±¡çš„<code>GC</code>åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡çš„å¯¹è±¡å¤´ï¼ˆObject Headerï¼‰ä¹‹ä¸­ã€‚æ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯ç”¨åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚</p><h4 id="5-æ‰§è¡Œ-lt-init-gt-æ–¹æ³•ã€‚"><a href="#5-æ‰§è¡Œ-lt-init-gt-æ–¹æ³•ã€‚" class="headerlink" title="5. æ‰§è¡Œ&lt;init&gt;()æ–¹æ³•ã€‚"></a>5. æ‰§è¡Œ<code>&lt;init&gt;()</code>æ–¹æ³•ã€‚</h4><p>newæŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œ<code>&lt;init&gt;()</code>æ–¹æ³•ï¼ŒæŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿å¯¹å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨è¢«æ„é€ å‡ºæ¥ã€‚</p><p><code>&lt;init&gt;()</code>æ–¹æ³•æ˜¯ å¯¹è±¡æ„é€ æ—¶ç”¨ä»¥åˆå§‹åŒ–å¯¹è±¡çš„ï¼Œæ„é€ å™¨ä»¥åŠéé™æ€åˆå§‹åŒ–å—ä¸­çš„ä»£ç ã€‚</p><p>åŒºåˆ«ä¸ç±»åŠ è½½çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•</p><h3 id="äºŒã€å¯¹è±¡çš„å¸ƒå±€"><a href="#äºŒã€å¯¹è±¡çš„å¸ƒå±€" class="headerlink" title="äºŒã€å¯¹è±¡çš„å¸ƒå±€"></a>äºŒã€å¯¹è±¡çš„å¸ƒå±€</h3><p><code>HotSpot</code>è™šæ‹Ÿæœºé‡Œï¼Œå¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„å­˜å‚¨å¸ƒå±€å¯ä»¥åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><pre><code>å¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å¯¹é½å¡«å……ï¼ˆPaddingï¼‰ã€‚</code></pre><h4 id="1-å¯¹è±¡å¤´"><a href="#1-å¯¹è±¡å¤´" class="headerlink" title="1. å¯¹è±¡å¤´"></a>1. å¯¹è±¡å¤´</h4><p>å¯¹è±¡å¤´éƒ¨åˆ†åŒ…æ‹¬ä¸¤ç±»ä¿¡æ¯ï¼š</p><p>ï¼ˆ1ï¼‰ç¬¬ä¸€ç±»æ˜¯ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç <code>ï¼ˆHashCodeï¼‰</code>ã€<code>GCåˆ†ä»£å¹´é¾„</code>ã€<code>é”çŠ¶æ€æ ‡å¿—</code>ã€<code>çº¿ç¨‹æŒæœ‰çš„é”</code>ã€<code>åå‘çº¿ç¨‹ID</code>ã€<code>åå‘æ—¶é—´æˆ³</code>ç­‰ï¼Œè¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦åœ¨32ä½å’Œ64ä½çš„è™šæ‹Ÿæœºï¼ˆæœªå¼€å¯å‹ç¼©æŒ‡é’ˆï¼‰ä¸­åˆ†åˆ«ä¸º32ä¸ªæ¯”ç‰¹å’Œ64ä¸ªæ¯”ç‰¹ï¼Œå®˜æ–¹ç§°å®ƒä¸ºâ€œMark Wordâ€ã€‚</p><p>ï¼ˆ2ï¼‰ç¬¬äºŒç±»æ˜¯ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å‹å…ƒæ•°æ®çš„æŒ‡é’ˆï¼ŒJavaè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¯¥å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚</p><pre><code>å¹¶ä¸æ˜¯æ‰€æœ‰çš„è™šæ‹Ÿæœºå®ç°éƒ½å¿…é¡»åœ¨å¯¹è±¡æ•°æ®ä¸Šä¿ç•™ç±»å‹æŒ‡é’ˆï¼Œå³ï¼ŒæŸ¥æ‰¾å¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯å¹¶ä¸ä¸€å®šè¦ç»è¿‡å¯¹è±¡æœ¬èº«</code></pre><h4 id="2-å®ä¾‹æ•°æ®ï¼š"><a href="#2-å®ä¾‹æ•°æ®ï¼š" class="headerlink" title="2. å®ä¾‹æ•°æ®ï¼š"></a>2. å®ä¾‹æ•°æ®ï¼š</h4><p>å®ä¾‹æ•°æ®éƒ¨åˆ†æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œå³æˆ‘ä»¬åœ¨ç¨‹åºä»£ç é‡Œé¢æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ï¼Œæ— è®ºæ˜¯ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„ï¼Œè¿˜æ˜¯åœ¨å­ç±»ä¸­å®šä¹‰çš„å­—æ®µéƒ½å¿…é¡»è®°å½•èµ·æ¥ã€‚</p><blockquote><p>è¿™éƒ¨åˆ†çš„å­˜å‚¨é¡ºåºä¼šå—åˆ°è™šæ‹Ÿæœºåˆ†é…ç­–ç•¥å‚æ•°ï¼ˆ-XXï¼šFieldsAllocationStyleå‚æ•°ï¼‰å’Œå­—æ®µåœ¨Javaæºç ä¸­å®šä¹‰é¡ºåºçš„å½±å“ã€‚</p><p>HotSpotè™šæ‹Ÿæœºé»˜è®¤çš„åˆ†é…é¡ºåºä¸ºlongs/doublesã€intsã€shorts/charsã€bytes/booleansã€oopsï¼ˆOrdinary Object Pointersï¼ŒOOPsï¼‰ã€‚<br>ç›¸åŒå®½åº¦çš„å­—æ®µæ€»æ˜¯è¢«åˆ†é…åˆ°ä¸€èµ·å­˜æ”¾ï¼Œåœ¨æ»¡è¶³è¿™ä¸ªå‰ææ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œåœ¨çˆ¶ç±»ä¸­å®šä¹‰çš„å˜é‡ä¼šå‡ºç°åœ¨å­ç±»ä¹‹å‰ã€‚</p><p>å¦‚æœHotSpotè™šæ‹Ÿæœºçš„+XXï¼šCompactFieldså‚æ•°å€¼ä¸ºtrueï¼ˆé»˜è®¤å°±ä¸ºtrueï¼‰ï¼Œé‚£å­ç±»ä¹‹ä¸­è¾ƒçª„çš„å˜é‡ä¹Ÿå…è®¸æ’å…¥çˆ¶ç±»å˜é‡çš„ç©ºéš™ä¹‹ä¸­ï¼Œä»¥èŠ‚çœå‡ºä¸€ç‚¹ç‚¹ç©ºé—´</p></blockquote><h4 id="3-å¯¹é½å¡«å……"><a href="#3-å¯¹é½å¡«å……" class="headerlink" title="3.å¯¹é½å¡«å……"></a>3.å¯¹é½å¡«å……</h4><p>ï¼ˆAï¼‰éå¿…ç„¶ï¼Œæ— ç‰¹æ®Šå«ä¹‰ï¼Œä»…ä½œå ä½ç¬¦ä½¿ç”¨ã€‚</p><p>ï¼ˆBï¼‰å¯¹è±¡å®ä¾‹æ•°æ®æ²¡æœ‰å¯¹é½æ—¶éœ€è¦å¯¹é½å¡«å……ã€‚</p><blockquote><p>å¯¹é½å¡«å……ï¼Œè¿™å¹¶ä¸æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œä¹Ÿæ²¡æœ‰ç‰¹åˆ«çš„å«ä¹‰ï¼Œå®ƒä»…ä»…èµ·ç€å ä½ç¬¦çš„ä½œç”¨ã€‚ç”±äº<code>HotSpotè™šæ‹Ÿæœº</code>çš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä»»ä½•å¯¹è±¡çš„å¤§å°éƒ½å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ã€‚å¯¹è±¡å¤´éƒ¨åˆ†å·²ç»è¢«ç²¾å¿ƒè®¾è®¡æˆæ­£å¥½æ˜¯8å­—èŠ‚çš„å€æ•°ï¼ˆ1å€æˆ–è€…2å€ï¼‰ï¼Œå› æ­¤ï¼Œå¦‚æœå¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½çš„è¯ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚</p></blockquote><h3 id="ä¸‰ã€å¯¹è±¡çš„è®¿é—®å®šä½"><a href="#ä¸‰ã€å¯¹è±¡çš„è®¿é—®å®šä½" class="headerlink" title="ä¸‰ã€å¯¹è±¡çš„è®¿é—®å®šä½"></a>ä¸‰ã€å¯¹è±¡çš„è®¿é—®å®šä½</h3><p>Javaç¨‹åºä¼šé€šè¿‡æ ˆä¸Šçš„referenceæ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚</p><p>å¯¹è±¡è®¿é—®ä¸»æµçš„è®¿é—®æ–¹å¼ä¸»è¦æœ‰ä½¿ç”¨å¥æŸ„å’Œç›´æ¥æŒ‡é’ˆä¸¤ç§ï¼š</p><p>ï¼ˆ1ï¼‰ä½¿ç”¨å¥æŸ„è®¿é—®çš„è¯ï¼ŒJavaå †ä¸­å°†å¯èƒ½ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreferenceä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªå…·ä½“çš„åœ°å€ä¿¡æ¯ï¼š</p><p><img src="/medias/loading-animated.gif" data-original="/images//jvm-images/jvm-obj-ref-1.jpg" alt="å¥æŸ„è®¿é—®ç¤ºæ„å›¾"></p><p>ï¼ˆ2ï¼‰ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®çš„è¯ï¼ŒJavaå †ä¸­å¯¹è±¡çš„å†…å­˜å¸ƒå±€å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œreferenceä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡åœ°å€ï¼Œå¦‚æœåªæ˜¯è®¿é—®å¯¹è±¡æœ¬èº«çš„è¯ï¼Œå°±ä¸éœ€è¦å¤šä¸€æ¬¡é—´æ¥è®¿é—®çš„å¼€é”€ã€‚</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-obj-ref-2.jpg" alt="ç›´æ¥æŒ‡é’ˆè®¿é—®ç¤ºæ„å›¾"></p><p><strong>å¥æŸ„è®¿é—®</strong> ä¸ <strong>ç›´æ¥æŒ‡é’ˆ</strong> æ¯”è¾ƒï¼š</p><p>ï¼ˆAï¼‰ä½¿ç”¨å¥æŸ„çš„æœ€å¤§å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡ç§»åŠ¨(GC)æ˜¯åªæ”¹å˜å®ä¾‹æ•°æ®æŒ‡é’ˆåœ°å€ï¼Œreference è‡ªèº«ä¸éœ€è¦ä¿®æ”¹ã€‚<br>ï¼ˆBï¼‰ç›´æ¥æŒ‡é’ˆè®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯é€Ÿåº¦å¿«ï¼ŒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚å¦‚æœæ˜¯å¯¹è±¡é¢‘ç¹ GC é‚£ä¹ˆå¥æŸ„æ–¹æ³•å¥½ï¼Œå¦‚æœæ˜¯å¯¹è±¡é¢‘ç¹è®¿é—®åˆ™ç›´æ¥æŒ‡é’ˆè®¿é—®å¥½ã€‚</p><p><code>HotSpot</code>è€Œè¨€ï¼Œå®ƒä¸»è¦ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼è¿›è¡Œå¯¹è±¡è®¿é—®ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jvmä¹‹å†…å­˜ç»“æ„</title>
      <link href="/posts/9f103da7.html"/>
      <url>/posts/9f103da7.html</url>
      
        <content type="html"><![CDATA[<h2 id="jvm-å†…å­˜ç®¡ç†æœºåˆ¶"><a href="#jvm-å†…å­˜ç®¡ç†æœºåˆ¶" class="headerlink" title="jvm å†…å­˜ç®¡ç†æœºåˆ¶"></a>jvm å†…å­˜ç®¡ç†æœºåˆ¶</h2><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<br>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ ç¬¬3ç‰ˆã€‹<br>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava SE 7ï¼‰ã€‹</p></blockquote><h3 id="è¿è¡Œæ—¶æ•°æ®åŒº"><a href="#è¿è¡Œæ—¶æ•°æ®åŒº" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒº"></a>è¿è¡Œæ—¶æ•°æ®åŒº</h3><p>æ ¹æ®ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„è§„å®šï¼ŒJavaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜å°†ä¼šåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</p><p><img src="/medias/loading-animated.gif" data-original="/images/jvm-images/jvm-pic-1.jpg" alt="è¿è¡Œæ—¶æ•°æ®åŒº"></p><h4 id="1-ç¨‹åºè®¡æ•°å™¨"><a href="#1-ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="1. ç¨‹åºè®¡æ•°å™¨"></a>1. ç¨‹åºè®¡æ•°å™¨</h4><blockquote><p>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œå®ƒæ˜¯ç¨‹åºæ§åˆ¶æµçš„æŒ‡ç¤ºå™¨ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</p></blockquote><p>ç¨‹åºè®¡æ•°å™¨ç‰¹å¾ï¼š<br>ï¼ˆ1ï¼‰æ˜¯â€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚æ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„æ¡çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ã€‚<br>ï¼ˆ2ï¼‰å¦‚æœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªJavaæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯æœ¬åœ°ï¼ˆNativeï¼‰æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨å€¼åˆ™åº”ä¸ºç©ºï¼ˆUndefinedï¼‰ã€‚<br>ï¼ˆ3ï¼‰æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚</p><h4 id="2-Javaè™šæ‹Ÿæœºæ ˆ"><a href="#2-Javaè™šæ‹Ÿæœºæ ˆ" class="headerlink" title="2. Javaè™šæ‹Ÿæœºæ ˆ"></a>2. Javaè™šæ‹Ÿæœºæ ˆ</h4><blockquote><p>Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stackï¼‰ä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼ŒJavaè™šæ‹Ÿæœºéƒ½ä¼šåŒæ­¥åˆ›å»ºä¸€ä¸ªæ ˆå¸§[æ ˆå¸§æ˜¯æ–¹æ³•è¿è¡ŒæœŸé—´å¾ˆé‡è¦çš„åŸºç¡€æ•°æ®ç»“æ„]ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæ¯•çš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p></blockquote><p>å±€éƒ¨å˜é‡è¡¨ç›¸å…³ï¼š</p><blockquote><p>å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§Javaè™šæ‹ŸæœºåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceç±»å‹ï¼Œå®ƒå¹¶ä¸ç­‰åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–è€…å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰å’ŒreturnAddressç±»å‹ï¼ˆæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚</p></blockquote><p>åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­ï¼Œ Javaè™šæ‹Ÿæœºæ ˆå¯èƒ½å‡ºç°ä¸¤ç±»å¼‚å¸¸çŠ¶å†µï¼š</p><blockquote><p>ï¼ˆ1ï¼‰å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowErrorå¼‚å¸¸ï¼›<br>ï¼ˆ2ï¼‰å¦‚æœJavaè™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åŠ¨æ€æ‰©å±•[Hotspotçš„è™šæ‹Ÿæœºæ ˆä¸å…è®¸æ‰©å±•]ï¼Œå½“æ ˆæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p></blockquote><h4 id="3-æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#3-æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="3. æœ¬åœ°æ–¹æ³•æ ˆ"></a>3. æœ¬åœ°æ–¹æ³•æ ˆ</h4><p>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stacksï¼‰ä¸è™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼ŒåŒºåˆ«:</p><blockquote><p>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œ<br>æœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„æœ¬åœ°ï¼ˆNativeï¼‰æ–¹æ³•æœåŠ¡ã€‚</p></blockquote><p>æœ‰çš„Javaè™šæ‹Ÿæœºï¼ˆè­¬å¦‚Hot-Spotè™šæ‹Ÿæœºï¼‰ç›´æ¥å°±æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚<br>æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿå¯èƒ½å‡ºç°ä¸¤ç±»å¼‚å¸¸çŠ¶å†µï¼š</p><blockquote><p>ï¼ˆ1ï¼‰æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåœ¨æ ˆæ·±åº¦æº¢å‡ºæ—¶æŠ›å‡ºStackOverflowError<br>ï¼ˆ2ï¼‰æœ¬åœ°æ–¹æ³•æ ˆæ‰©å±•å¤±è´¥æ—¶æŠ›å‡ºOutOfMemoryErrorã€‚</p></blockquote><h4 id="4-Javaå †"><a href="#4-Javaå †" class="headerlink" title="4. Javaå †"></a>4. Javaå †</h4><blockquote><p>Javaå †ï¼ˆJava Heapï¼‰æ˜¯è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼ŒJavaä¸–ç•Œé‡Œâ€œ<strong>å‡ ä¹</strong>â€æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</p></blockquote><p>Javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„å†…å­˜åŒºåŸŸï¼Œå› æ­¤ä¸€äº›èµ„æ–™ä¸­å®ƒä¹Ÿè¢«ç§°ä½œâ€œGCå †â€ã€‚</p><p>ä»å›æ”¶å†…å­˜çš„è§’åº¦çœ‹ï¼Œç”±äºç°ä»£åƒåœ¾æ”¶é›†å™¨å¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäºåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡çš„ï¼Œæ‰€ä»¥Javaå †ä¸­ç»å¸¸ä¼šå‡ºç°â€œæ–°ç”Ÿä»£â€â€œè€å¹´ä»£â€ã€â€œæ°¸ä¹…ä»£â€ã€â€œEdenç©ºé—´â€ã€â€œFrom Survivorç©ºé—´â€ã€â€œTo Survivorç©ºé—´â€ç­‰ã€‚</p><p>å¦‚æœä»åˆ†é…å†…å­˜çš„è§’åº¦çœ‹ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«çš„Javaå †ä¸­å¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒºï¼ˆThread Local Allocation Bufferï¼ŒTLABï¼‰ï¼Œä»¥æå‡å¯¹è±¡åˆ†é…æ—¶çš„æ•ˆç‡ã€‚</p><p>Javaå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä½†åœ¨é€»è¾‘ä¸Šå®ƒåº”è¯¥è¢«è§†ä¸ºè¿ç»­çš„ã€‚</p><p>Javaå †æ—¢å¯ä»¥è¢«å®ç°æˆå›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‰©å±•çš„ï¼Œä¸è¿‡å½“å‰ä¸»æµçš„Javaè™šæ‹Ÿæœºéƒ½æ˜¯æŒ‰ç…§å¯æ‰©å±•æ¥å®ç°çš„ï¼ˆé€šè¿‡å‚æ•°-Xmxå’Œ-Xmsè®¾å®šï¼‰ã€‚</p><p>å¦‚æœåœ¨Javaå †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><h4 id="5-æ–¹æ³•åŒº"><a href="#5-æ–¹æ³•åŒº" class="headerlink" title="5. æ–¹æ³•åŒº"></a>5. æ–¹æ³•åŒº</h4><blockquote><p>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¸Javaå †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰æ•°æ®ã€‚</p></blockquote><p>è™½ç„¶ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«ä½œâ€œéå †â€ï¼ˆNon-Heapï¼‰ï¼Œç›®çš„æ˜¯ä¸Javaå †åŒºåˆ†å¼€æ¥ã€‚</p><p>åœ¨JDK 6çš„æ—¶å€™HotSpotå¼€å‘å›¢é˜Ÿå°±æœ‰æ”¾å¼ƒæ°¸ä¹…ä»£ï¼Œé€æ­¥æ”¹ä¸ºé‡‡ç”¨<code>æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰</code>æ¥å®ç°æ–¹æ³•åŒºçš„è®¡åˆ’ã€‚<br>åˆ°äº†JDK 7çš„HotSpotï¼Œå·²ç»æŠŠåŸæœ¬æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ç­‰ç§»è‡³å †å†…å­˜ã€‚</p><blockquote><p>jdk7å¼€å§‹æ–¹æ³•åŒºçš„é€æ¸ç§»é™¤ï¼šç¬¦å·å¼•ç”¨(Symbols)ç§»è‡³native heapï¼Œå­—é¢é‡(interned strings)å’Œé™æ€å˜é‡(class statics)ç§»è‡³java heapã€‚</p></blockquote><p>åˆ°äº†JDK 8ï¼Œç»ˆäºå®Œå…¨åºŸå¼ƒäº†æ°¸ä¹…ä»£çš„æ¦‚å¿µï¼Œæ”¹ç”¨ä¸JRockitã€J9ä¸€æ ·åœ¨æœ¬åœ°å†…å­˜ä¸­å®ç°çš„<code>å…ƒç©ºé—´ï¼ˆMeta-spaceï¼‰</code>æ¥ä»£æ›¿ï¼ŒæŠŠJDK 7ä¸­æ°¸ä¹…ä»£è¿˜å‰©ä½™çš„å†…å®¹ï¼ˆä¸»è¦æ˜¯ç±»å‹ä¿¡æ¯ï¼‰å…¨éƒ¨ç§»åˆ°å…ƒç©ºé—´ä¸­ã€‚</p><blockquote><p>JDK1.8ä»¥å‰çš„HotSpot JVMæœ‰æ–¹æ³•åŒºï¼Œä¹Ÿå«æ°¸ä¹…ä»£(permanent generation)ã€‚<br>æ–¹æ³•åŒºç”¨äºå­˜æ”¾å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œå³ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ã€‚<br>æ–¹æ³•åŒºæ˜¯ä¸€ç‰‡è¿ç»­çš„å †ç©ºé—´ï¼Œé€šè¿‡-XX:MaxPermSizeæ¥è®¾å®šæ°¸ä¹…ä»£æœ€å¤§å¯åˆ†é…ç©ºé—´ï¼Œå½“JVMåŠ è½½çš„ç±»ä¿¡æ¯å®¹é‡è¶…è¿‡äº†è¿™ä¸ªå€¼ï¼Œä¼šæŠ¥OOM:PermGené”™è¯¯ã€‚<br>æ°¸ä¹…ä»£çš„GCæ˜¯å’Œè€å¹´ä»£(old generation)æ†ç»‘åœ¨ä¸€èµ·çš„ï¼Œæ— è®ºè°æ»¡äº†ï¼Œéƒ½ä¼šè§¦å‘æ°¸ä¹…ä»£å’Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚</p></blockquote><p>ä¸ºä»€ä¹ˆè¦ç”¨Metaspaceæ›¿ä»£æ–¹æ³•åŒºï¼Ÿ</p><p>éšç€åŠ¨æ€ç±»åŠ è½½çš„æƒ…å†µè¶Šæ¥è¶Šå¤šï¼Œè¿™å—å†…å­˜å˜å¾—ä¸å¤ªå¯æ§ï¼Œå¦‚æœè®¾ç½®å°äº†ï¼Œç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­å°±å®¹æ˜“å‡ºç°å†…å­˜æº¢å‡ºï¼Œè®¾ç½®å¤§äº†åˆæµªè´¹å†…å­˜ã€‚</p><blockquote><p>æ–¹æ³•åŒºçš„å†…å­˜å›æ”¶ç›®æ ‡ä¸»è¦æ˜¯é’ˆå¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»å‹çš„å¸è½½ï¼Œå¸è½½æ¡ä»¶ç›¸å½“è‹›åˆ»ã€‚<br>æ–¹æ³•åŒºæ— æ³•æ»¡è¶³æ–°çš„å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p></blockquote><h4 id="6-è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#6-è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="6. è¿è¡Œæ—¶å¸¸é‡æ± "></a>6. è¿è¡Œæ—¶å¸¸é‡æ± </h4><blockquote><p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Classæ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± è¡¨ï¼ˆConstant Pool Tableï¼‰ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ä¸ç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚</p></blockquote><p>è¿è¡Œæ—¶å¸¸é‡æ± ç‰¹å¾ï¼š<br>ï¼ˆ1ï¼‰å­˜å‚¨æ•°æ®æ¡ä»¶å®½æ¾ã€‚ï¼ˆä¿å­˜Classæ–‡ä»¶ä¸­æè¿°çš„ç¬¦å·å¼•ç”¨ï¼ŒæŠŠç”±ç¬¦å·å¼•ç”¨ç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ï¼Œå‡å¯æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼‰<br>ï¼ˆ2ï¼‰å…·å¤‡åŠ¨æ€æ€§ã€‚ï¼ˆé¢„ç½®å…¥Classæ–‡ä»¶ä¸­å¸¸é‡æ± çš„å†…å®¹ï¼Œæˆ–è¿è¡ŒæœŸé—´æ–°çš„å¸¸é‡[å¦‚Stringç±»çš„intern()æ–¹æ³•]ï¼Œå‡å¯æ”¾å…¥ï¼‰</p><p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œå—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><h4 id="7-ç›´æ¥å†…å­˜"><a href="#7-ç›´æ¥å†…å­˜" class="headerlink" title="7. ç›´æ¥å†…å­˜"></a>7. ç›´æ¥å†…å­˜</h4><blockquote><p>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚ä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨ï¼Œè€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´OutOfMemoryErrorå¼‚å¸¸å‡ºç°ã€‚</p></blockquote><blockquote><p>åœ¨JDK 1.4ä¸­æ–°åŠ å…¥äº†NIOï¼ˆNew Input/Outputï¼‰ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“ï¼ˆChannelï¼‰ä¸ç¼“å†²åŒºï¼ˆBufferï¼‰çš„I/Oæ–¹å¼ï¼Œå®ƒå¯ä»¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †é‡Œé¢çš„DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨Javaå †å’ŒNativeå †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚</p></blockquote><blockquote><p>æœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—Javaå †å¤§å°çš„é™åˆ¶ï¼Œä½†å—åˆ°æœ¬æœºæ€»å†…å­˜ï¼ˆåŒ…æ‹¬ç‰©ç†å†…å­˜ã€SWAPåˆ†åŒºæˆ–è€…åˆ†é¡µæ–‡ä»¶ï¼‰å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚<br>é…ç½®è™šæ‹Ÿæœºå‚æ•°æ—¶ï¼Œè®¾ç½®-Xmxç­‰å‚æ•°ä¿¡æ¯ï¼Œè‹¥ä½¿å¾—å„ä¸ªå†…å­˜åŒºåŸŸæ€»å’Œå¤§äºç‰©ç†å†…å­˜é™åˆ¶ï¼ˆåŒ…æ‹¬ç‰©ç†çš„å’Œæ“ä½œç³»ç»Ÿçº§çš„é™åˆ¶ï¼‰ï¼Œå°±ä¼šå¯¼è‡´åŠ¨æ€æ‰©å±•æ—¶å‡ºç°OutOfMemoryErrorã€‚</p></blockquote><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> å†…å­˜ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitçš„SSHå…å¯†ä½¿ç”¨</title>
      <link href="/posts/6ac07d1a.html"/>
      <url>/posts/6ac07d1a.html</url>
      
        <content type="html"><![CDATA[<pre><code>æœ¬æ–‡è®°å½•å…³äºGitçš„å…å¯†ä½¿ç”¨ï¼Œè¿æ¥Githubå…å¯†å’Œ äº‘æœåŠ¡å™¨æˆ–ç§æœ‰æœåŠ¡å™¨å…å¯†ã€‚</code></pre><h3 id="ä¸€-Githubçš„Gitå…å¯†ä½¿ç”¨"><a href="#ä¸€-Githubçš„Gitå…å¯†ä½¿ç”¨" class="headerlink" title="ä¸€  Githubçš„Gitå…å¯†ä½¿ç”¨"></a>ä¸€  <code>Github</code>çš„Gitå…å¯†ä½¿ç”¨</h3><h4 id="1-å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥"><a href="#1-å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥" class="headerlink" title="1 å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥"></a>1 å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥</h4><pre><code>ssh-keygen -t rsa -C &quot;è¿™é‡Œæ¢ä¸Šä½ çš„é‚®ç®±&quot;</code></pre><p>ç„¶åä¼šå‡ºç°è¯¢é—®ï¼Œå¤§æ¦‚æ„æ€å¦‚ä¸‹ï¼š</p><pre><code>1. ç¡®è®¤ç§˜é’¥çš„ä¿å­˜è·¯å¾„ï¼ˆå¦‚æœä¸éœ€è¦æ”¹è·¯å¾„åˆ™ç›´æ¥å›è½¦ï¼‰ï¼›2. å¦‚æœä¸Šä¸€æ­¥ç½®é¡¶çš„ä¿å­˜è·¯å¾„ä¸‹å·²ç»æœ‰ç§˜é’¥æ–‡ä»¶ï¼Œåˆ™éœ€è¦ç¡®è®¤æ˜¯å¦è¦†ç›–ï¼ˆå¦‚æœä¹‹å‰çš„ç§˜é’¥ä¸å†éœ€è¦åˆ™ç›´æ¥å›è½¦è¦†ç›–ï¼Œå¦‚éœ€è¦åˆ™æ‰‹åŠ¨æ‹·è´åˆ°å…¶ä»–ç›®å½•åå†è¦†ç›–ï¼‰ï¼›3. åˆ›å»ºå¯†ç ï¼ˆå¦‚æœä¸éœ€è¦å¯†ç åˆ™ç›´æ¥å›è½¦ï¼‰ï¼›4. ç¡®è®¤å¯†ç ï¼›</code></pre><p>è¦å…å¯†ç™»å½•è¯·è¾“å¯†ç çš„æ—¶å€™å›è½¦å³å¯ã€‚æ ¹æ®æç¤ºæ‰¾åˆ°å¯†é’¥æ‰€åœ¨æ–‡ä»¶ï¼š</p><pre><code>id_rsa  #ç§é’¥id_rsa.pub  #å…¬é’¥</code></pre><h4 id="2-Githubé…ç½®SSHå…¬é’¥"><a href="#2-Githubé…ç½®SSHå…¬é’¥" class="headerlink" title="2  Githubé…ç½®SSHå…¬é’¥"></a>2  <code>Github</code>é…ç½®SSHå…¬é’¥</h4><p> ç™»å½•gitè´¦æˆ·ï¼Œ<code>Setting</code>ï¼Œ<code>SSH and GPG keys</code>, <code>New ssh key</code></p><p>æŠŠ<code>id_rsa.pub</code>çš„å†…å®¹ç²˜è´´åˆ°keyçš„æ–‡æœ¬åŸŸï¼Œç‚¹å‡»<code>Add SSH key</code>å®Œæˆã€‚</p><p>åç»­çš„å®¢æˆ·ç«¯gitæ“ä½œå°±ä¸è¦å¯†ç äº†ã€‚</p><h3 id="äºŒ-GitæœåŠ¡å™¨é…ç½®SSHå…å¯†"><a href="#äºŒ-GitæœåŠ¡å™¨é…ç½®SSHå…å¯†" class="headerlink" title="äºŒ GitæœåŠ¡å™¨é…ç½®SSHå…å¯†"></a>äºŒ <code>Git</code>æœåŠ¡å™¨é…ç½®SSHå…å¯†</h3><p>æ³¨æ„ï¼šè¿™é‡Œçš„GitæœåŠ¡å™¨å¯ä»¥æ˜¯äº‘æœåŠ¡å™¨æˆ–è€…è‡ªå·±çš„ç§æœåŠ¡å™¨ã€‚æœ¬æ¬¡æ“ä½œç¯å¢ƒæ˜¯<code>Centos 7</code>ã€‚</p><h4 id="1-å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥-1"><a href="#1-å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥-1" class="headerlink" title="1 å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥"></a>1 å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥</h4><p>æ³¨æ„ï¼šåŒä¸Šï¼Œå¦‚æœå·²ç»é…ç½®è¿‡<code>Github</code>çš„sshå…å¯†ä¸Šé¢å·²ç»æœ‰äº†å¯ä»¥ä¸ç”¨é‡å¤ç”Ÿæˆï¼Œå¯ä»¥ç›´æ¥è·³åˆ°ç¬¬äºŒæ­¥ã€‚</p><pre><code>ssh-keygen -t rsa -C &quot;è¿™é‡Œæ¢ä¸Šä½ çš„é‚®ç®±&quot;</code></pre><p>ç„¶åä¼šå‡ºç°è¯¢é—®ï¼Œå¤§æ¦‚æ„æ€å¦‚ä¸‹ï¼š</p><pre><code>1. ç¡®è®¤ç§˜é’¥çš„ä¿å­˜è·¯å¾„ï¼ˆå¦‚æœä¸éœ€è¦æ”¹è·¯å¾„åˆ™ç›´æ¥å›è½¦ï¼‰ï¼›2. å¦‚æœä¸Šä¸€æ­¥ç½®é¡¶çš„ä¿å­˜è·¯å¾„ä¸‹å·²ç»æœ‰ç§˜é’¥æ–‡ä»¶ï¼Œåˆ™éœ€è¦ç¡®è®¤æ˜¯å¦è¦†ç›–ï¼ˆå¦‚æœä¹‹å‰çš„ç§˜é’¥ä¸å†éœ€è¦åˆ™ç›´æ¥å›è½¦è¦†ç›–ï¼Œå¦‚éœ€è¦åˆ™æ‰‹åŠ¨æ‹·è´åˆ°å…¶ä»–ç›®å½•åå†è¦†ç›–ï¼‰ï¼›3. åˆ›å»ºå¯†ç ï¼ˆå¦‚æœä¸éœ€è¦å¯†ç åˆ™ç›´æ¥å›è½¦ï¼‰ï¼›4. ç¡®è®¤å¯†ç ï¼›</code></pre><p>è¦å…å¯†ç™»å½•è¯·è¾“å¯†ç çš„æ—¶å€™å›è½¦å³å¯ã€‚æ ¹æ®æç¤ºæ‰¾åˆ°å¯†é’¥æ‰€åœ¨æ–‡ä»¶ï¼š</p><pre><code>id_rsa  #ç§é’¥id_rsa.pub  #å…¬é’¥</code></pre><h4 id="2-æœåŠ¡ç«¯å¯¼å…¥å®¢æˆ·ç«¯å…¬é’¥"><a href="#2-æœåŠ¡ç«¯å¯¼å…¥å®¢æˆ·ç«¯å…¬é’¥" class="headerlink" title="2  æœåŠ¡ç«¯å¯¼å…¥å®¢æˆ·ç«¯å…¬é’¥"></a>2  æœåŠ¡ç«¯å¯¼å…¥å®¢æˆ·ç«¯å…¬é’¥</h4><p>åœ¨/home/gitä¸‹å·²ç»åˆ›å»º.sshç›®å½•ï¼Œç„¶ååˆ›å»ºauthorized_keysæ–‡ä»¶ï¼Œå¹¶å°†å®¢æˆ·ç«¯ç”Ÿæˆçš„å…¬é’¥å¯¼å…¥è¿›å»ã€‚</p><pre><code>cd /home/git/mkdir .sshchmod 755 .sshtouch .ssh/authorized_keyschmod 644 .ssh/authorized_keys</code></pre><p>å°† <code>id_rsa.pub</code> æ–‡ä»¶çš„å†…å®¹å†™å…¥<code>authorized_keys</code></p><h4 id="3-æœåŠ¡ç«¯SSHå¼€å¯RSAè®¤è¯"><a href="#3-æœåŠ¡ç«¯SSHå¼€å¯RSAè®¤è¯" class="headerlink" title="3  æœåŠ¡ç«¯SSHå¼€å¯RSAè®¤è¯"></a>3  æœåŠ¡ç«¯<code>SSH</code>å¼€å¯<code>RSA</code>è®¤è¯</h4><p>å¦‚æœæ²¡æœ‰å®‰è£…SSHæœåŠ¡ï¼Œè¯·å…ˆå®‰è£…SSHæœåŠ¡ã€‚</p><pre class=" language-bash"><code class="language-bash">vim /etc/ssh/sshd_config</code></pre><p>å…¶ä¸­ä¸‰ä¸ªåœ°æ–¹çš„è®¾ç½®è¦ç¡®è®¤å¦‚ä¸‹ï¼š</p><pre><code>RSAAuthentication yesPubkeyAuthentication yesAuthorizedKeysFile .ssh/authorized_keys</code></pre><p>gitç”¨æˆ·ä¸å…è®¸ç™»å½•shell</p><pre class=" language-bash"><code class="language-bash">vim /etc/passwd</code></pre><p>å°†</p><pre><code>git:x:502:502::/home/git:/bin/bash</code></pre><p> æ”¹ä¸º</p><pre><code>git:x:502:502::/home/git:/usr/local/git/bin/git-shell</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Github </tag>
            
            <tag> SSHå…å¯† </tag>
            
            <tag> æœåŠ¡å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java8 æ—¥æœŸæ—¶é—´API</title>
      <link href="/posts/d0e15f60.html"/>
      <url>/posts/d0e15f60.html</url>
      
        <content type="html"><![CDATA[<h3 id="Java-8-æ—¥æœŸæ—¶é—´-API"><a href="#Java-8-æ—¥æœŸæ—¶é—´-API" class="headerlink" title="Java 8 æ—¥æœŸæ—¶é—´ API"></a>Java 8 æ—¥æœŸæ—¶é—´ API</h3><p>Java 8é€šè¿‡å‘å¸ƒæ–°çš„Date-Time API (JSR 310)æ¥è¿›ä¸€æ­¥åŠ å¼ºå¯¹æ—¥æœŸä¸æ—¶é—´çš„å¤„ç†ã€‚ æ—§ç‰ˆçš„<code>java.util.Date</code>æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</p><h4 id="1-java8æ—¥æœŸæ—¶é—´"><a href="#1-java8æ—¥æœŸæ—¶é—´" class="headerlink" title="1. java8æ—¥æœŸæ—¶é—´"></a>1. java8æ—¥æœŸæ—¶é—´</h4><p><code>LocalDate</code>ï¼ˆæœ¬åœ°æ—¥æœŸï¼‰âˆ’ ç®€åŒ–äº†æ—¥æœŸå¤„ç†ï¼Œä¸å¸¦æ—¶é—´ã€‚</p><p><code>LocalTime</code>ï¼ˆæœ¬åœ°æ—¶é—´ï¼‰âˆ’ ç®€åŒ–äº†æ—¶é—´å¤„ç†ï¼Œä¸å¸¦æ—¥æœŸä¸”æ²¡æœ‰åç§»ä¿¡æ¯ã€æ— æ—¶åŒºçš„æ—¶é—´ã€‚</p><p><code>LocalDateTime</code>ï¼ˆæœ¬åœ°æ—¥æœŸæ—¶é—´ï¼‰âˆ’ æ—¥æœŸ+æ—¶é—´çš„å¤„ç†ã€‚</p><p>ä¸Šé¢çš„ä¸‰ä¸ªç±»çš„å®ä¾‹æ˜¯ä¸å¯å˜çš„å¯¹è±¡ï¼Œåˆ†å¸ƒè¡¨ç¤ºä½¿ç”¨<code>ISO-8601</code>æ—¥å†ç³»ç»Ÿçš„æ—¥æœŸã€æ—¶é—´ã€æ—¥æœŸæ—¶é—´ã€‚æ— æ—¶åŒºç›¸å…³ä¿¡æ¯ã€‚</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>now()</td><td>é™æ€æ–¹æ³•ï¼Œæ ¹æ®å½“å‰æ—¶é—´åˆ›å»ºå¯¹è±¡</td></tr><tr><td>of()</td><td>é™æ€æ–¹æ³•ï¼Œæ ¹æ®å½“å‰æ—¶é—´æˆ–æ—¥æœŸåˆ›å»ºå¯¹è±¡</td></tr><tr><td>plusDays, plusWeeks, <br/> plusMonths, plusYears</td><td>å‘å½“å‰LocalDate å¯¹è±¡æ·»åŠ å‡ å¤©ã€å‡ å‘¨ã€å‡ ä¸ªæœˆã€å‡ å¹´çš„è¿ç®—</td></tr><tr><td>minisDays, minisWeeks, <br/>minisMonths, minisYears</td><td>ä»å½“å‰LocalDate å¯¹è±¡å‡å»å‡ å¤©ã€å‡ å‘¨ã€å‡ ä¸ªæœˆã€å‡ å¹´çš„è¿ç®—</td></tr><tr><td>withDayOfMonth, withDayOfYear,<br/> withMonth, withYear</td><td>å°†æœˆä»½å¤©æ•°ã€å¹´ä»½å¤©æ•°ã€æœˆä»½å¹´ä»½ä¿®æ”¹ä¸ºæŒ‡å®šçš„å€¼å¹¶è¿”å›æ–°çš„LocalDateå¯¹è±¡</td></tr><tr><td>getDayOfMonth</td><td>è·å–æœˆä»½å¤©æ•°ï¼ˆ1-31ï¼‰</td></tr><tr><td>getDayOfYear</td><td>è·å–å¹´ä»½å¤©æ•°ï¼ˆ1-366ï¼‰</td></tr><tr><td>getDayOfWeek</td><td>è·å–æ˜ŸæœŸå‡ ï¼Œè¿”å›ä¸€ä¸ªDayOfWeekçš„æšä¸¾å€¼</td></tr><tr><td>getMonth</td><td>è·å–æœˆä»½ï¼Œè¿”å›ä¸€ä¸ªMonthçš„æšä¸¾å€¼</td></tr><tr><td>getMonthValue</td><td>è·å–æœˆä»½æ•°å€¼ï¼ˆ1-12ï¼‰</td></tr><tr><td>getYear</td><td>è·å–å¹´ä»½</td></tr><tr><td>unitl</td><td>è·å–ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„ Period å¯¹è±¡ï¼Œæˆ–è€…æŒ‡å®š ChronoUnits çš„æ•°å­—</td></tr><tr><td>isBefore,isAfter</td><td>æ¯”è¾ƒä¸¤ä¸ªLocalDate</td></tr><tr><td>isLeapYear</td><td>åˆ¤æ–­æ˜¯å¦æ˜¯é—°å¹´</td></tr></tbody></table><pre class=" language-java"><code class="language-java">```java<span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk8<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token punctuation">.</span>out<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateTimeTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        LocalDate ldt <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ—¥æœŸ</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" ldt = "</span> <span class="token operator">+</span> ldt<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalTime time <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ—¶é—´</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" time = "</span> <span class="token operator">+</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime dttm <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" dttm = "</span> <span class="token operator">+</span> dttm<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDate date2 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">07</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ—¥æœŸ</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" date2 = "</span> <span class="token operator">+</span> date2<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalTime time2 <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ—¶é—´</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" time2 = "</span> <span class="token operator">+</span> time2<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime dttm2 <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span><span class="token number">07</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" dttm2 = "</span> <span class="token operator">+</span> dttm2<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime ldt3 <span class="token operator">=</span> ld2<span class="token punctuation">.</span><span class="token function">plusYears</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt3<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime ldt4 <span class="token operator">=</span> ld2<span class="token punctuation">.</span><span class="token function">minusMonths</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt4<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt<span class="token punctuation">.</span><span class="token function">getMonthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt<span class="token punctuation">.</span><span class="token function">getHour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt<span class="token punctuation">.</span><span class="token function">getMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt<span class="token punctuation">.</span><span class="token function">getSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æ—¥æœŸæ¯”è¾ƒ</span>        LocalDate date1 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDate date2 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// isBefore</span>        <span class="token keyword">boolean</span> b1 <span class="token operator">=</span> date1<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span>date2<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" date1 åœ¨date2çš„å‰é¢ ï¼š"</span> <span class="token operator">+</span> b1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// isAfter</span>        <span class="token keyword">boolean</span> b2 <span class="token operator">=</span> date1<span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span>date2<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" date1 åœ¨date2çš„åé¢ ï¼š"</span> <span class="token operator">+</span> b2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> b3 <span class="token operator">=</span> date1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>date2<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" date1   equals  date2  ? "</span> <span class="token operator">+</span> b3<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// æ—¥æœŸæ—¶é—´æ¯”è¾ƒ</span>        LocalDateTime dttm1 <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" dttm1 = "</span> <span class="token operator">+</span> dttm1<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime dttm2 <span class="token operator">=</span> dttm1<span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" dttm2 = "</span> <span class="token operator">+</span> dttm2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> b4 <span class="token operator">=</span> dttm1<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span>dttm2<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" dttm1 åœ¨ dttm2 çš„å‰é¢ ï¼š"</span> <span class="token operator">+</span> b4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="2-java8-æ—¶é—´æˆ³"><a href="#2-java8-æ—¶é—´æˆ³" class="headerlink" title="2. java8 æ—¶é—´æˆ³"></a>2. java8 æ—¶é—´æˆ³</h4><p><code>Instant</code>ï¼ˆæ—¶é—´æˆ³ï¼‰-ç²¾ç¡®åˆ°çº³ç§’çš„çš„æŸä¸ªæ—¶é—´ç‚¹ï¼Œä¸åŒ…å«æ—¶åŒºï¼Œå…è®¸åŠ å‡è¿ç®—ã€‚è¯¥æ–¹æ³•é»˜è®¤ä½¿ç”¨çš„æ˜¯UTC(åè°ƒä¸–ç•Œæ—¶â€”â€”ç”±åŸå­é’Ÿæä¾›)æ—¶é—´(Unixå…ƒå¹´å¼€å§‹ç»å†æè¿°è¿›è¡Œè¿ç®—)ï¼Œå¯ä»¥ä½¿ç”¨<br><code>equeal</code> å’Œ <code>compareTo</code> æ¥æ¯”è¾ƒä¸¤ä¸ªæ—¶é—´ç‚¹çš„å€¼ã€‚æ”¯æŒæ—§ç‰ˆæ—¶é—´è½¬æ¢æ–°ç‰ˆæ—¶é—´æˆ³ã€‚</p><pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        Instant ins <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//é»˜è®¤ä½¿ç”¨ UTC æ—¶åŒº</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ins<span class="token punctuation">)</span><span class="token punctuation">;</span>        OffsetDateTime odt <span class="token operator">=</span> ins<span class="token punctuation">.</span><span class="token function">atOffset</span><span class="token punctuation">(</span>ZoneOffset<span class="token punctuation">.</span><span class="token function">ofHours</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>odt<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ins<span class="token punctuation">.</span><span class="token function">getNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant ins2 <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">ofEpochSecond</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ins2<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// æ—¶é—´æˆ³</span>        Instant now <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" now = "</span> <span class="token operator">+</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å°†java.util.Dateè½¬æ¢ä¸ºInstant</span>        Instant instant1 <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">ofEpochMilli</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instant1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ä»å­—ç¬¦ä¸²ç±»å‹ä¸­åˆ›å»ºInstantç±»å‹çš„æ—¶é—´</span>        Instant instant2 <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"1995-10-23T10:12:35Z"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h4 id="3-Duration-å’Œ-Periodã€‚"><a href="#3-Duration-å’Œ-Periodã€‚" class="headerlink" title="3. Duration å’Œ Periodã€‚"></a>3. Duration å’Œ Periodã€‚</h4><pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">caculteTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        Instant instant3 <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å°†ç°åœ¨çš„æ—¶é—´åŠ ä¸Š2ä¸ªå°æ—¶10åˆ†é’Ÿ</span>        Instant changeIns <span class="token operator">=</span> instant3<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofHours</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>changeIns<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ä½¿ç”¨instantè®¡ç®—7å¤©å‰</span>        instant3<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æ–¹æ³•1</span>        instant3<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofDays</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æ–¹æ³•2</span>        <span class="token comment" spellcheck="true">// è®¡ç®—ä¸¤ä¸ªInstantä¹‹é—´çš„åˆ†é’Ÿæ•°</span>        Instant instant4 <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// long diffAsMinutes = instant.periodUntil(instant3, ChronoUnit.MINUTES); //</span>        <span class="token comment" spellcheck="true">// æ–¹æ³•1</span>        <span class="token keyword">long</span> diffAsMinutes1 <span class="token operator">=</span> ChronoUnit<span class="token punctuation">.</span>MINUTES<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>instant1<span class="token punctuation">,</span> instant4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æ–¹æ³•2</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>diffAsMinutes1 <span class="token operator">/</span> <span class="token number">60</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant ins1 <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">}</span>        Instant ins2 <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰€è€—è´¹æ—¶é—´ä¸ºï¼š"</span> <span class="token operator">+</span> Duration<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>ins1<span class="token punctuation">,</span> ins2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDate ld1 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDate ld2 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2011</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Period pe <span class="token operator">=</span> Period<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>ld2<span class="token punctuation">,</span> ld1<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pe<span class="token punctuation">.</span><span class="token function">getYears</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pe<span class="token punctuation">.</span><span class="token function">getMonths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pe<span class="token punctuation">.</span><span class="token function">getDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// ä¸€å‘¨ä»å‘¨æ—¥å¼€å§‹</span>        WeekFields weekFields <span class="token operator">=</span> WeekFields<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>SUNDAY<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDate today <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»Šå¤©æ˜¯ä»Šå¹´ç¬¬"</span> <span class="token operator">+</span> today<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>weekFields<span class="token punctuation">.</span><span class="token function">weekOfYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å‘¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è®¡ç®—dateçš„ç›¸å·®å¤©æ•°</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minusDays</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è®¡ç®—dateçš„ç›¸å·®æœˆæ•°</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">until</span><span class="token punctuation">(</span>LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minusDays</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ChronoUnit<span class="token punctuation">.</span>MONTHS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// è®¡ç®—dateçš„ç›¸å·®æœˆå¤©ï¼Œï¼ˆç›¸å·®0å¹´1æœˆ24å¤©ï¼‰</span>        LocalDate date1 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDate date2 <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Period period <span class="token operator">=</span> Period<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>date1<span class="token punctuation">,</span> date2<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>period<span class="token punctuation">.</span><span class="token function">getYears</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> period<span class="token punctuation">.</span><span class="token function">getMonths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> period<span class="token punctuation">.</span><span class="token function">getDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h4 id="4-æ—¶åŒºå¤„ç†"><a href="#4-æ—¶åŒºå¤„ç†" class="headerlink" title="4. æ—¶åŒºå¤„ç†"></a>4. æ—¶åŒºå¤„ç†</h4><p><code>Zoned</code> (æ—¶åŒº) âˆ’ é€šè¿‡åˆ¶å®šçš„æ—¶åŒºå¤„ç†æ—¥æœŸæ—¶é—´ã€‚</p><p><code>ZoneDate</code>ï¼ˆæ—¶åŒºæ—¥æœŸï¼‰- åŒ…å«æ—¶åŒºçš„æ—¥æœŸã€‚</p><p><code>ZoneTime</code>ï¼ˆæ—¶åŒºæ—¶é—´ï¼‰- åŒ…å«æ—¶åŒºçš„æ—¶é—´ã€‚</p><p><code>ZoneDateTime</code>ï¼ˆæ—¶åŒºæ—¥æœŸæ—¶é—´ï¼‰- åŒ…å«æ—¶åŒºçš„å®Œæ•´çš„æ—¥æœŸæ—¶é—´ï¼Œåç§»é‡æ˜¯ä»¥<code>UTC/æ ¼æ—å¨æ²»æ—¶é—´</code>ä¸ºåŸºå‡†çš„ã€‚ZonedDateTimeä»£è¡¨å¸¦æ—¶åŒºçš„æ—¶é—´ï¼Œç­‰åŒäºä»¥å‰çš„<code>GregorianCalendar</code>ç±»ã€‚ä½¿ç”¨è¯¥ç±»ï¼Œå¯ä»¥å°†æœ¬åœ°æ—¶é—´è½¬æ¢æˆå¦ä¸€ä¸ªæ—¶åŒºä¸­çš„å¯¹åº”æ—¶é—´ã€‚</p><p><code>ZonId</code>ä»£è¡¨çš„æ˜¯æŸä¸ªç‰¹å®šæ—¶åŒºï¼Œé‡Œé¢çš„<code>getAvailableZoneIds()</code> æ–¹æ³•å¯ä»¥è·å–æ‰€æœ‰æ—¶åŒºä¿¡æ¯ã€‚é‡Œé¢çš„<code>of()</code> æ–¹æ³•æ˜¯ç”¨æŒ‡å®šçš„æ—¶åŒºä¿¡æ¯è·å–ZoneIdå¯¹è±¡</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk8<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token punctuation">.</span>out<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>ZoneId<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>ZonedDateTime<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimeZoneTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// è·å–å…¨éƒ¨æ—¶åŒºåˆ—è¡¨</span>        Set<span class="token operator">&lt;</span>String<span class="token operator">></span> set <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">getAvailableZoneIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        set<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime localDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" localDateTime = "</span> <span class="token operator">+</span> localDateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>        ZoneId zone <span class="token operator">=</span> ZoneId<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>ZoneId<span class="token punctuation">.</span>SHORT_IDS<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"CTT"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å–å®šä¹‰å¥½çš„æ—¶åŒº</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" zone = "</span> <span class="token operator">+</span> zone<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//åŒ…å«æ—¶åŒºçš„æ—¶é—´</span>        ZonedDateTime dtWithZone <span class="token operator">=</span> ZonedDateTime<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">,</span> zone<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" dtWithZone = "</span> <span class="token operator">+</span> dtWithZone<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è¾“å‡º</p><pre><code> localDateTime = 2020-05-31T23:54:42.831 zone = Asia/Shanghai dtWithZone = 2020-05-31T23:54:42.831+08:00[Asia/Shanghai]</code></pre><p> æ³¨æ„ï¼šå¯¹åº”æ—¶åŒºçš„æ–‡æœ¬å¯ä»¥ç›´æ¥æ‰‹åŠ¨å¡«å†™ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ç³»ç»Ÿé»˜è®¤å®šä¹‰çš„ã€‚</p><h4 id="5-æ ¼å¼åŒ–å¤„ç†"><a href="#5-æ ¼å¼åŒ–å¤„ç†" class="headerlink" title="5. æ ¼å¼åŒ–å¤„ç†"></a>5. æ ¼å¼åŒ–å¤„ç†</h4><p><code>java.time.format.DateTimeFormatter</code>æä¾›æ ¼å¼åŒ–å’Œè§£æåŠŸèƒ½ã€‚æœ‰ä¸‰ç§æ ¼å¼åŒ–æ–¹æ³•ï¼š</p><p>ï¼ˆ1ï¼‰é¢„å®šä¹‰çš„æ ‡å‡†æ ¼å¼ï¼Œåœ¨<code>DateTimeFormatter</code>ç±»ä¸­ã€‚<br>ï¼ˆ2ï¼‰è¯­è¨€ç¯å¢ƒç›¸å…³çš„æ ¼å¼<br>ï¼ˆ3ï¼‰è‡ªå®šä¹‰æ ¼å¼ï¼Œå¦‚å¸¦ä¸­æ–‡ã€‚</p><pre class=" language-java"><code class="language-java">    <span class="token comment" spellcheck="true">//5. DateTimeFormatter : è§£æå’Œæ ¼å¼åŒ–æ—¥æœŸæˆ–æ—¶é—´</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">formatterTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        DateTimeFormatter dtf <span class="token operator">=</span> DateTimeFormatter<span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyyå¹´MMæœˆddæ—¥ HH:mm:ss E"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime ldt <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String strDate <span class="token operator">=</span> ldt<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>dtf<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>strDate<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime newLdt <span class="token operator">=</span> ldt<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>strDate<span class="token punctuation">,</span> dtf<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>newLdt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h4 id="6-æ—¶é—´æ ¡æ­£å™¨"><a href="#6-æ—¶é—´æ ¡æ­£å™¨" class="headerlink" title="6. æ—¶é—´æ ¡æ­£å™¨"></a>6. æ—¶é—´æ ¡æ­£å™¨</h4><p><code>TemporalAdjuster</code>æ˜¯æ—¶é—´æ ¡æ­£å™¨ã€‚æœ‰æ—¶å€™éœ€è¦è·å–â€ä¸‹ä¸ªå‘¨æ—¥â€è¿™ç§æ“ä½œã€‚</p><p><code>TemporalAdjusters</code> è¯¥ç±»æ˜¯é€šè¿‡é™æ€æ–¹æ³•æä¾›å¤§é‡å¸¸ç”¨çš„<code>TemporalAdjuster</code>çš„å®ç°ã€‚</p><pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//å–ä¸‹ä¸ªå‘¨æœ«</span>        LocalDateTime ldt1 <span class="token operator">=</span> ldt<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>TemporalAdjusters<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>SUNDAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt1<span class="token punctuation">)</span><span class="token punctuation">;</span>        LocalDateTime ldt2 <span class="token operator">=</span> ldt<span class="token punctuation">.</span><span class="token function">withDayOfMonth</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è‡ªå®šä¹‰ï¼šä¸‹ä¸€ä¸ªå·¥ä½œæ—¥</span>        LocalDateTime ldt5 <span class="token operator">=</span> ldt<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>            LocalDateTime ldt4 <span class="token operator">=</span> <span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">)</span> l<span class="token punctuation">;</span>            DayOfWeek dow <span class="token operator">=</span> ldt4<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>dow<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>FRIDAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> ldt4<span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>dow<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>DayOfWeek<span class="token punctuation">.</span>SATURDAY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> ldt4<span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">return</span> ldt4<span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ldt5<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h4 id="7-å…¶ä»–ç›¸å…³"><a href="#7-å…¶ä»–ç›¸å…³" class="headerlink" title="7. å…¶ä»–ç›¸å…³"></a>7. å…¶ä»–ç›¸å…³</h4><p><code>Locale</code> (æœ¬åœ°) âˆ’ ç®€åŒ–äº†æ—¥æœŸæ—¶é—´çš„å¤„ç†ï¼Œæ²¡æœ‰æ—¶åŒºçš„é—®é¢˜ã€‚</p><p><code>MonthDay</code>- æœˆæ—¥ç»„åˆã€‚å®ƒæ˜¯ä¸€ä¸ªå€¼ç±»ï¼ˆvalue classï¼‰,ç”±ï¼Œä¸åŒ…å«å¹´ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥ä»£è¡¨æ¯å¹´é‡å¤å‡ºç°çš„ä¸€äº›æ—¥æœŸæˆ–å…¶ä»–ç»„åˆã€‚</p><p><code>YearMonth</code> - å¹´æœˆç»„åˆã€‚</p><p><code>WeekFields</code>(å‘¨) - å¤„ç†å‘¨çš„è®¡ç®—ã€‚</p><p><code>Clock</code> - æ—¶é’Ÿã€‚å¯ä»¥è·å–æŸä¸ªæ—¶åŒºä¸‹ï¼ˆå¯¹æ—¶åŒºæ˜¯æ•æ„Ÿçš„ï¼‰å½“å‰çš„ç¬æ—¶æ—¶é—´ã€æ—¥æœŸã€‚ç”¨æ¥ä»£æ›¿System.currentTimelnMillis()ä¸TimeZone.getDefault()æ–¹æ³•ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk8<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token punctuation">.</span>out<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateTimeTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        Locale l <span class="token operator">=</span> Locale<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>        MonthDay md <span class="token operator">=</span> MonthDay<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" md :"</span><span class="token operator">+</span>md<span class="token punctuation">)</span><span class="token punctuation">;</span>        YearMonth ym <span class="token operator">=</span> YearMonth<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">07</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" ym :"</span><span class="token operator">+</span>ym<span class="token punctuation">)</span><span class="token punctuation">;</span>        Clock utc_cl <span class="token operator">=</span> Clock<span class="token punctuation">.</span><span class="token function">systemUTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" utc_cl :"</span> <span class="token operator">+</span>utc_cl<span class="token punctuation">)</span><span class="token punctuation">;</span>        Clock def_cl <span class="token operator">=</span> Clock<span class="token punctuation">.</span><span class="token function">systemDefaultZone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" def_cl :"</span> <span class="token operator">+</span>def_cl<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="8-ä¸ä¼ ç»Ÿæ—¥æœŸè½¬æ¢"><a href="#8-ä¸ä¼ ç»Ÿæ—¥æœŸè½¬æ¢" class="headerlink" title="8 ä¸ä¼ ç»Ÿæ—¥æœŸè½¬æ¢"></a>8 ä¸ä¼ ç»Ÿæ—¥æœŸè½¬æ¢</h4><table><thead><tr><th>ç±»</th><th>To é—ç•™ç±»</th><th>From é—ç•™ç±»</th></tr></thead><tbody><tr><td>java.time.Instant <br/> java.util.Date</td><td>Date.from(Instant it)</td><td>date.toInstant()</td></tr><tr><td>java.time.Instant <br/> java.util.Timestamp</td><td>Timestamp.from(Instant it)</td><td>tmestamp.toInstant()</td></tr><tr><td>java.time.ZonedDateTime <br/> java.util.GregorianCalendar</td><td>GregorianCalendar.from(ZonedDateTime zd)</td><td>cal.toZonedDateTime()</td></tr><tr><td>java.time.LocalDate <br/> java.sql.Time</td><td>Date.valueOf(LocalDate ld)</td><td>date.toLocalDate()</td></tr><tr><td>java.time.LocalTime <br/> java.sql.Time</td><td>Date.valueOf(LocalTime lt)</td><td>date.toLocalTime()</td></tr><tr><td>java.time.LocalDateTime<br/> java.sql.Timestamp</td><td>Timestamp.valueOf(LocalDateTime ldt)</td><td>tmestamp.toLocalDateTime()</td></tr><tr><td>java.time.ZoneId <br/> java.sql.TimeZone</td><td>TimeZone.getTimeZone(ZoneId ldt)</td><td>tmeZone.toZoneId()</td></tr><tr><td>java.time.format.DateTimeFormatter <br/> java.text.DateFormat</td><td>formatter.toFormat()</td><td>-</td></tr></tbody></table><p>éƒ¨åˆ†ç¤ºä¾‹å¦‚ä¸‹ã€‚å…¶ä»–åŒç†ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangxiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>java8<span class="token punctuation">.</span>datetime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Timestamp<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Instant<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Locale<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestOtherDateTime</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        Locale l <span class="token operator">=</span> Locale<span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant it <span class="token operator">=</span> Instant<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Date date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" date :"</span><span class="token operator">+</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant it2 <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" it2 : "</span><span class="token operator">+</span>it2<span class="token punctuation">)</span><span class="token punctuation">;</span>        Timestamp ts <span class="token operator">=</span> Timestamp<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" ts : "</span><span class="token operator">+</span>ts<span class="token punctuation">)</span><span class="token punctuation">;</span>        Instant ts2 <span class="token operator">=</span> ts<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" ts2 : "</span><span class="token operator">+</span>ts2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="9-å…¶ä»–"><a href="#9-å…¶ä»–" class="headerlink" title="9 å…¶ä»–"></a>9 å…¶ä»–</h4><p>å¯ä»¥å‚è€ƒ<a href="https://www.matools.com/api/java8" target="_blank" rel="noopener">java 8 API</a>,åœ¨å®é™…é‡åˆ°å†è¡¥å……ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java æŸ¥æ¼è¡¥ç¼º-jdkç‰ˆæœ¬ç‰ˆæœ¬å˜åŒ–è¡¥å……å­¦ä¹ </title>
      <link href="/posts/80dc9555.html"/>
      <url>/posts/80dc9555.html</url>
      
        <content type="html"><![CDATA[<h2 id="JDKå„ä¸ªç‰ˆæœ¬çš„å˜åŒ–è¡¥å……å­¦ä¹ "><a href="#JDKå„ä¸ªç‰ˆæœ¬çš„å˜åŒ–è¡¥å……å­¦ä¹ " class="headerlink" title="JDKå„ä¸ªç‰ˆæœ¬çš„å˜åŒ–è¡¥å……å­¦ä¹ "></a>JDKå„ä¸ªç‰ˆæœ¬çš„å˜åŒ–è¡¥å……å­¦ä¹ </h2><h3 id="JDK1-5"><a href="#JDK1-5" class="headerlink" title="JDK1.5"></a>JDK1.5</h3><h4 id="1-ç±»åŒ…è£…å™¨"><a href="#1-ç±»åŒ…è£…å™¨" class="headerlink" title="1. ç±»åŒ…è£…å™¨."></a>1. ç±»åŒ…è£…å™¨.</h4><p>è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±ã€‚å®é™…æ“ä½œä¸­æ¯”è¾ƒå¸¸è§ã€‚</p><h4 id="2-æšä¸¾ç±»å‹ä½¿ç”¨ã€‚"><a href="#2-æšä¸¾ç±»å‹ä½¿ç”¨ã€‚" class="headerlink" title="2. æšä¸¾ç±»å‹ä½¿ç”¨ã€‚"></a>2. æšä¸¾ç±»å‹ä½¿ç”¨ã€‚</h4><p>å®é™…ä¸­æŒ‰éœ€ä½¿ç”¨ã€‚æˆ‘ä¹Ÿåœ¨å®é™…ä¸­ä½¿ç”¨è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨æšä¸¾ç±»å‹ä¸æ‰©å±•æ€§çš„é—®é¢˜ï¼Œæ¯”å¦‚æ€§åˆ«æ°¸è¿œåªæœ‰â€ç”·â€å’Œâ€å¥³â€ï¼Œä¸ä¼šå¢åŠ æ‰©å±•ç¬¬ä¸‰ç§ï¼Œé‚£ä¹ˆæšä¸¾æ˜¯æ¨èä½¿ç”¨çš„ï¼Œå¦‚æœæšä¸¾å†…å®¹æ˜¯æ‰©å±•çš„ï¼Œä¸å»ºè®®ä½¿ç”¨æšä¸¾ç±»å‹ã€‚</p><h4 id="3-é™æ€æ–¹æ³•å€’å…¥ã€‚"><a href="#3-é™æ€æ–¹æ³•å€’å…¥ã€‚" class="headerlink" title="3. é™æ€æ–¹æ³•å€’å…¥ã€‚"></a>3. é™æ€æ–¹æ³•å€’å…¥ã€‚</h4><p>è¯´å®è¯ï¼Œè¿™ä¸ªæˆ‘åœ¨å®é™…ä¸­çœŸæ²¡æœ‰ç”¨è¿‡ã€‚è¯­æ³•<code>import static</code><br>å¤§è‡´åˆ†ä¸¤ç§ï¼š<br>   ï¼ˆ1ï¼‰å¯¼å…¥æŒ‡å®šç±»çš„æŸä¸ªé™æ€æˆå‘˜å˜é‡ã€æ–¹æ³•ã€‚<br>   ï¼ˆ2ï¼‰å¯¼å…¥æŒ‡å®šç±»çš„å…¨éƒ¨çš„é™æ€æˆå‘˜å˜é‡ã€æ–¹æ³•ã€‚</p><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class=" language-JAVA"><code class="language-JAVA">/* * ä½¿ç”¨import static,å¯¼å…¥java.lang.Systemä¸‹çš„outè¿™ä¸ªé™æ€æˆå‘˜å˜é‡ */import static java.lang.System.out;public class ImptTest {    public static void main(String[] args) {        out.println("hello world");    }}</code></pre><p>å¯¼å…¥é™æ€æ–¹æ³•ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/* * ä½¿ç”¨import static,å¯¼å…¥java.lang.Mathè¿™ä¸ªç±»ä¸­çš„roundæ–¹æ³• */</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Math<span class="token punctuation">.</span>round<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImptTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//out.println("hello world");</span>        <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">123.123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å¯¼å…¥å…¨éƒ¨é™æ€æˆå‘˜ã€é™æ€æ–¹æ³•ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/* * åƒè¿™æ ·ä½¿ç”¨.*,åˆ™è¡¨ç¤ºç±»ä¸­æ‰€æœ‰çš„é™æ€æˆå‘˜å˜é‡å’Œé™æ€æ–¹æ³•éƒ½è¢«å¯¼å…¥äº† */</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Math<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImptTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="4-å¯å˜å‚æ•°ä½¿ç”¨ã€‚"><a href="#4-å¯å˜å‚æ•°ä½¿ç”¨ã€‚" class="headerlink" title="4. å¯å˜å‚æ•°ä½¿ç”¨ã€‚"></a>4. å¯å˜å‚æ•°ä½¿ç”¨ã€‚</h4><p>è¯¥ç‰¹å¾åœ¨å®é™…ä¸­ä½¿ç”¨è¿‡ï¼Œå®ç”¨æ€§è¿˜æ˜¯éå¸¸ä¸é”™çš„ã€‚</p><p>ä¸»è¦ç‰¹å¾ï¼š<br>ï¼ˆ1ï¼‰ä¸€ä¸ªæ–¹æ³•ä¸­åªèƒ½æŒ‡å®šä¸€ä¸ªå¯å˜å‚æ•°ï¼Œ<br>ï¼ˆ2ï¼‰å¯å˜å‚æ•°å¿…é¡»æ˜¯æ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚<br>ï¼ˆ3ï¼‰å¯å˜å‚æ•°ç±»å‹å¿…é¡»ä¸€è‡´.<br>ï¼ˆ4ï¼‰æ‹¥æœ‰å¯å˜å‚æ•°çš„æ–¹æ³•å¯ä»¥è¢«é‡è½½ï¼Œåœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶ï¼Œå¦‚æœèƒ½å¤Ÿå’Œå›ºå®šå‚æ•°çš„æ–¹æ³•åŒ¹é…ï¼Œä¹Ÿèƒ½å¤Ÿä¸å¯å˜é•¿å‚æ•°çš„æ–¹æ³•åŒ¹é…ï¼Œåˆ™ä¼šè°ƒç”¨å›ºå®šå‚æ•°çš„æ–¹æ³•ã€‚<br>ï¼ˆ5ï¼‰è¢«è°ƒç”¨çš„æ–¹æ³•ä¸å…è®¸å’Œä¸¤ä¸ªå¯å˜å‚æ•°åŒ¹é…ï¼Œå¦åˆ™å‡ºç°é”™è¯¯ã€‚</p><p>è°ƒç”¨ç‰¹ç‚¹ï¼š<br>ï¼ˆ1ï¼‰å¯ä»¥ä¸å†™å‚æ•°ï¼Œå³ä¼ å…¥ç©ºå‚ã€‚<br>ï¼ˆ2ï¼‰å¯ä»¥ç›´æ¥åœ¨é‡Œè¾¹å†™å…¥å‚æ•°ï¼Œå‚æ•°é—´ç”¨é€—å·éš”å¼€ï¼›<br>ï¼ˆ3ï¼‰å¯å˜å‚æ•°å…¼å®¹æ•°ç»„ï¼Œæ•°ç»„ä¸èƒ½å…¼å®¹å¯å˜å‚æ•°ï¼›<br>ï¼ˆ4ï¼‰æ³¨æ„å‚æ•°é‡Œçš„null<br>å¦‚ç¤ºä¾‹ï¼š</p><pre class=" language-JAVA"><code class="language-JAVA">public static void say(String...names) {     for(String name : names) {        System.out.print(name + ",hello! ");     }}</code></pre><p>è°ƒç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    String<span class="token punctuation">[</span><span class="token punctuation">]</span> names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token string">"cat"</span><span class="token punctuation">,</span> <span class="token string">"dog"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä¸ä¼ é€’å‚æ•°</span>    <span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"dog"</span><span class="token punctuation">,</span> <span class="token string">"cat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä¼ é€’å¤šä¸ªå‚æ•°</span>    <span class="token function">say</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// å¯ä¼ é€’æ•°ç»„</span><span class="token punctuation">}</span></code></pre><p>åé¢å®šä¹‰ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">say</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>names<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">for</span><span class="token punctuation">(</span>String name <span class="token operator">:</span> names<span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">",hello! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">say</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>names <span class="token punctuation">,</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>names<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">//ä¸å…è®¸å‡ºç°å¤šä¸ªå¯å˜å‚æ•°</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">say</span><span class="token punctuation">(</span>String sex<span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>names<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//è°ƒç”¨æ—¶ä¸ç¬¬ä¸€ä¸ªsayæ–¹æ³•å†²çªï¼Œä¸ä¼šè¢«è°ƒç”¨</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">say</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>names<span class="token punctuation">,</span>Sring date<span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token comment" spellcheck="true">//å¯å˜å‚æ•°å¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‚æ•°</span><span class="token punctuation">}</span></code></pre><h4 id="5-å†…çœ-Introspector"><a href="#5-å†…çœ-Introspector" class="headerlink" title="5. å†…çœ(Introspector)"></a>5. å†…çœ(Introspector)</h4><p>å†…çœ(Introspector) æ˜¯Java è¯­è¨€å¯¹ JavaBean ç±»å±æ€§ã€äº‹ä»¶çš„ä¸€ç§ç¼ºçœå¤„ç†æ–¹æ³•ã€‚</p><p>JavaBeanæ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œä¸»è¦ç”¨äºä¼ é€’æ•°æ®ä¿¡æ¯ï¼Œè¿™ç§ç±»ä¸­çš„æ–¹æ³•ä¸»è¦ç”¨äºè®¿é—®ç§æœ‰çš„å­—æ®µï¼Œä¸”æ–¹æ³•åç¬¦åˆæŸç§å‘½åè§„åˆ™ã€‚å¦‚æœåœ¨ä¸¤ä¸ªæ¨¡å—ä¹‹é—´ä¼ é€’ä¿¡æ¯ï¼Œå¯ä»¥å°†ä¿¡æ¯å°è£…è¿›JavaBeanä¸­ï¼Œè¿™ç§å¯¹è±¡ç§°ä¸ºâ€œå€¼å¯¹è±¡â€(Value Object)ï¼Œæˆ–â€œVOâ€ã€‚æ–¹æ³•æ¯”è¾ƒå°‘ã€‚è¿™äº›ä¿¡æ¯å‚¨å­˜åœ¨ç±»çš„ç§æœ‰å˜é‡ä¸­ï¼Œé€šè¿‡set()ã€get()è·å¾—ã€‚</p><p>å®é™…ä½¿ç”¨å¼•å…¥apacheçš„BeanUtilså·¥å…·åŒ…ï¼š<br>ã€€ã€€ BeanUtilså·¥å…·åŒ…ï¼šä¸‹è½½ï¼š<a href="http://commons.apache.org/beanutils/" target="_blank" rel="noopener">http://commons.apache.org/beanutils/</a>ã€€<br>    (åº”ç”¨çš„æ—¶å€™è¿˜éœ€è¦ä¸€ä¸ªloggingåŒ… <a href="http://commons.apache.org/logging/" target="_blank" rel="noopener">http://commons.apache.org/logging/</a>)</p><h4 id="6-æ³›å‹-Generic"><a href="#6-æ³›å‹-Generic" class="headerlink" title="6.æ³›å‹(Generic)."></a>6.æ³›å‹(Generic).</h4><p>ç®€å•çš„è¯´å°±æ˜¯å¯ä»¥æŒ‡å®šé›†åˆé‡Œå…ƒç´ çš„ç±»å‹ã€‚</p><h4 id="7-for-eachå¾ªç¯ã€‚"><a href="#7-for-eachå¾ªç¯ã€‚" class="headerlink" title="7. for-eachå¾ªç¯ã€‚"></a>7. for-eachå¾ªç¯ã€‚</h4><p>æ¯”è¾ƒå¸¸ç”¨ã€‚è¯­æ³•<code>for(ç±»å‹ å˜é‡ ï¼š é›†åˆ){}</code></p><p>ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk8<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForEachTest</span> <span class="token punctuation">{</span>     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> JAXBException<span class="token punctuation">,</span> IOException <span class="token punctuation">{</span>         String<span class="token punctuation">[</span><span class="token punctuation">]</span> names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token string">"jerry"</span><span class="token punctuation">,</span><span class="token string">"mike"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>          <span class="token keyword">for</span><span class="token punctuation">(</span>String str <span class="token operator">:</span> names<span class="token punctuation">)</span><span class="token punctuation">{</span>              System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"str:"</span><span class="token operator">+</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>     <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="JDK1-6"><a href="#JDK1-6" class="headerlink" title="JDK1.6"></a>JDK1.6</h3><h4 id="ä¸»è¦å˜åŒ–"><a href="#ä¸»è¦å˜åŒ–" class="headerlink" title="ä¸»è¦å˜åŒ–"></a>ä¸»è¦å˜åŒ–</h4><p>1ã€å¼•å…¥äº†ä¸€ä¸ªæ”¯æŒè„šæœ¬å¼•æ“çš„æ–°æ¡†æ¶Scripting for the Java Platform (JSR223è„šæœ¬å¼•æ“)</p><p>2ã€UIçš„å¢å¼º</p><p>3ã€å¯¹WebServiceæ”¯æŒçš„å¢å¼ºï¼ˆJAX-WS2.0å’ŒJAXB2.0ï¼‰</p><p>4ã€ä¸€ç³»åˆ—æ–°çš„å®‰å…¨ç›¸å…³çš„å¢å¼º</p><p>5ã€JDBC4.0</p><p>6ã€Compiler API ï¼ˆJSR199ï¼‰<br>æ”¯æŒåŠ¨æ€ç¼–è¯‘ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaCompilerAPICompiler</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">compile</span><span class="token punctuation">(</span>Path src<span class="token punctuation">,</span> Path output<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>        JavaCompiler compiler <span class="token operator">=</span> ToolProvider<span class="token punctuation">.</span><span class="token function">getSystemJavaCompiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>StandardJavaFileManager fileManager <span class="token operator">=</span> compiler<span class="token punctuation">.</span><span class="token function">getStandardFileManager</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> null<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            Iterable<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">JavaFileObject</span><span class="token operator">></span> compilationUnits <span class="token operator">=</span> fileManager<span class="token punctuation">.</span><span class="token function">getJavaFileObjects</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Iterable<span class="token operator">&lt;</span>String<span class="token operator">></span> options <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"-d"</span><span class="token punctuation">,</span> output<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            JavaCompiler<span class="token punctuation">.</span>CompilationTask task <span class="token operator">=</span> compiler<span class="token punctuation">.</span><span class="token function">getTask</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> fileManager<span class="token punctuation">,</span> null<span class="token punctuation">,</span> options<span class="token punctuation">,</span> null<span class="token punctuation">,</span> compilationUnits<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">boolean</span> result <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>7ã€é€šç”¨çš„Annotationsæ”¯æŒ ï¼ˆJSR269ï¼‰<br>ä¸€éƒ¨åˆ†æ˜¯è¿›è¡Œæ³¨è§£å¤„ç†çš„javax.annotation.processingã€‚<br>å¦ä¸€éƒ¨åˆ†æ˜¯å¯¹ç¨‹åºçš„é™æ€ç»“æ„è¿›è¡Œå»ºæ¨¡çš„javax.lang.modelã€‚</p><h4 id="JAXB2æ¥å®ç°å¯¹è±¡ä¸XMLä¹‹é—´çš„æ˜ å°„"><a href="#JAXB2æ¥å®ç°å¯¹è±¡ä¸XMLä¹‹é—´çš„æ˜ å°„" class="headerlink" title="JAXB2æ¥å®ç°å¯¹è±¡ä¸XMLä¹‹é—´çš„æ˜ å°„"></a>JAXB2æ¥å®ç°å¯¹è±¡ä¸XMLä¹‹é—´çš„æ˜ å°„</h4><p>JAXB:<br>    æ˜¯Java Architecture for XML Bindingçš„ç¼©å†™ï¼Œå¯ä»¥å°†ä¸€ä¸ªJavaå¯¹è±¡å’ŒXMLæ ¼å¼å¯¹è±¡ç›¸äº’è½¬æ¢ã€‚JAXB2åœ¨åº•å±‚æ˜¯ç”¨StAX(JSR 173)æ¥å¤„ç†XMLæ–‡æ¡£ã€‚</p><p>StAX(JSR 173)æ˜¯JDK6.0ä¸­é™¤äº†DOMå’ŒSAXä¹‹å¤–çš„åˆä¸€ç§å¤„ç†XMLæ–‡æ¡£çš„APIã€‚</p><p>StAX çš„æ¥å† ï¼šåœ¨JAXP1.3(JSR 206)æœ‰ä¸¤ç§å¤„ç†XMLæ–‡æ¡£çš„æ–¹æ³•:DOM(Document Object Model)å’ŒSAX(Simple API for XML).</p><p>ç”± äºJDK6.0ä¸­çš„JAXB2(JSR 222)å’ŒJAX-WS 2.0(JSR 224)éƒ½ä¼šç”¨åˆ°StAXï¼Œæ‰€ä»¥Sunå†³å®šæŠŠStAXåŠ å…¥åˆ°JAXPå®¶æ—å½“ä¸­æ¥ï¼Œå¹¶å°†JAXPçš„ç‰ˆæœ¬å‡çº§åˆ°1.4(JAXP1.4æ˜¯JAXP1.3çš„ç»´æŠ¤ç‰ˆæœ¬). JDK6é‡Œé¢JAXPçš„ç‰ˆæœ¬å°±æ˜¯1.4. ã€‚</p><p>StAXæ˜¯The Streaming API for XMLçš„ç¼©å†™ï¼Œä¸€ç§åˆ©ç”¨æ‹‰æ¨¡å¼è§£æ(pull-parsing)XMLæ–‡æ¡£çš„API.StAXé€šè¿‡æä¾›ä¸€ç§åŸºäºäº‹ä»¶è¿­ä»£å™¨(Iterator)çš„APIè®©ç¨‹åºå‘˜å»æ§åˆ¶xmlæ–‡æ¡£è§£æè¿‡ç¨‹,ç¨‹åºéå†è¿™ä¸ªäº‹ä»¶è¿­ä»£å™¨å»å¤„ç†æ¯ä¸€ä¸ªè§£æäº‹ä»¶ï¼Œè§£æäº‹ä»¶å¯ä»¥çœ‹åšæ˜¯ç¨‹åºæ‹‰å‡ºæ¥çš„ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºä¿ƒä½¿è§£æå™¨äº§ç”Ÿä¸€ä¸ªè§£æäº‹ä»¶ï¼Œç„¶åå¤„ç†è¯¥äº‹ä»¶ï¼Œä¹‹ååˆä¿ƒä½¿è§£æå™¨äº§ç”Ÿä¸‹ä¸€ä¸ªè§£æäº‹ä»¶ï¼Œå¦‚æ­¤å¾ªç¯ç›´åˆ°ç¢°åˆ°æ–‡æ¡£ç»“æŸç¬¦ï¼›</p><p>SAXä¹Ÿæ˜¯åŸºäºäº‹ä»¶å¤„ç†xmlæ–‡æ¡£ï¼Œä½†å´æ˜¯ç”¨æ¨æ¨¡å¼è§£æï¼Œè§£æå™¨è§£æå®Œæ•´ä¸ªxmlæ–‡æ¡£åï¼Œæ‰äº§ç”Ÿè§£æäº‹ä»¶ï¼Œç„¶åæ¨ç»™ç¨‹åºå»å¤„ç†è¿™äº›äº‹ä»¶ï¼›DOM é‡‡ç”¨çš„æ–¹å¼æ˜¯å°†æ•´ä¸ªxmlæ–‡æ¡£æ˜ å°„åˆ°ä¸€é¢—å†…å­˜æ ‘ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°å¾—åˆ°çˆ¶èŠ‚ç‚¹å’Œå­ç»“ç‚¹ä»¥åŠå…„å¼ŸèŠ‚ç‚¹çš„æ•°æ®ï¼Œä½†å¦‚æœæ–‡æ¡£å¾ˆå¤§ï¼Œå°†ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚<br>æ›´å¤šå­¦ä¹ å¯ä»¥å‚è€ƒ1ï¼š<a href="https://blog.csdn.net/visant/java/article/details/79778967" target="_blank" rel="noopener">https://blog.csdn.net/visant/java/article/details/79778967</a><br>æ›´å¤šå­¦ä¹ å¯ä»¥å‚è€ƒ2ï¼š<a href="http://www.blogjava.net/hsith/archive/2006/06/29/55817.html" target="_blank" rel="noopener">http://www.blogjava.net/hsith/archive/2006/06/29/55817.html</a></p><p>ç¤ºä¾‹ä»£ç ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk5<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileReader<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileWriter<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Calendar<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>JAXBContext<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>JAXBException<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>Marshaller<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>Unmarshaller<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Jaxb2Test</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> JAXBException<span class="token punctuation">,</span> IOException <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>        JAXBContext context <span class="token operator">=</span> JAXBContext<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä¸‹é¢ä»£ç æ¼”ç¤ºå°†å¯¹è±¡è½¬å˜ä¸ºxml</span>        Marshaller m <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createMarshaller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Address address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token string">"China"</span><span class="token punctuation">,</span><span class="token string">"Shanghai"</span><span class="token punctuation">,</span><span class="token string">"Shanghai"</span><span class="token punctuation">,</span><span class="token string">" xuhui"</span><span class="token punctuation">,</span><span class="token string">"100080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"å°èœ"</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span>Calendar<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>        FileWriter fw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span><span class="token string">"D:\\user.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        m<span class="token punctuation">.</span><span class="token function">marshal</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>fw<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//ä¸‹é¢ä»£ç æ¼”ç¤ºå°†ä¸Šé¢ç”Ÿæˆçš„xmlè½¬æ¢ä¸ºå¯¹è±¡</span>        FileReader fr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token string">"D:\user.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Unmarshaller um <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createUnmarshaller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        User user2 <span class="token operator">=</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span>um<span class="token punctuation">.</span><span class="token function">unmarshal</span><span class="token punctuation">(</span>fr<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Country:"</span><span class="token operator">+</span>user2<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCountry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¾“å…¥China</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>userç±»:</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk5<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Calendar<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>XmlElement<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>XmlRootElement<span class="token punctuation">;</span><span class="token annotation punctuation">@XmlRootElement</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@XmlElement</span>     String name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@XmlElement</span>     <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@XmlElement</span>    Calendar birthDay<span class="token punctuation">;</span>     <span class="token annotation punctuation">@XmlElement</span>     Address address<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token function">User</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> Calendar birthDay<span class="token punctuation">,</span> Address address<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>birthDay <span class="token operator">=</span> birthDay<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> Address <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> address<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Addressç±»</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk5<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>XmlAttribute<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>XmlElement<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@XmlAttribute</span>    String country<span class="token punctuation">;</span>    <span class="token annotation punctuation">@XmlElement</span>    String province<span class="token punctuation">;</span>    <span class="token annotation punctuation">@XmlElement</span>    String city<span class="token punctuation">;</span>    <span class="token annotation punctuation">@XmlElement</span>    String street<span class="token punctuation">;</span>    String houseNo<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ç”±äºæ²¡æœ‰æ·»åŠ @XmlElement,æ‰€ä»¥è¯¥å…ƒç´ ä¸ä¼šå‡ºç°åœ¨è¾“å‡ºçš„xmlä¸­</span>    <span class="token keyword">public</span> <span class="token function">Address</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token function">Address</span><span class="token punctuation">(</span>String country<span class="token punctuation">,</span> String province<span class="token punctuation">,</span> String city<span class="token punctuation">,</span> String street<span class="token punctuation">,</span> String houseNo<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>country <span class="token operator">=</span> country<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>province <span class="token operator">=</span> province<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> city<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>street <span class="token operator">=</span> street<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>houseNo <span class="token operator">=</span> houseNo<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> String <span class="token function">getCountry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> country<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è½¬æ¢çš„XMLå†…å®¹ï¼š</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>å°èœ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>age</span><span class="token punctuation">></span></span>18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>age</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>birthDay</span><span class="token punctuation">></span></span>2020-02-24T22:09:03.019+08:00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>birthDay</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>address</span> <span class="token attr-name">country</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>China<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>province</span><span class="token punctuation">></span></span>Shanghai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>province</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>city</span><span class="token punctuation">></span></span>Shanghai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>city</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>street</span><span class="token punctuation">></span></span> xuhui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>street</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>address</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></code></pre><p>æ³¨æ„@XmlAccessorTypeæ³¨è§£ã€‚<br>å¦Castorå®ç°XMLä¸Javaçš„äº’è½¬ <a href="http://www.castor.org/" target="_blank" rel="noopener">http://www.castor.org/</a></p><p>å¦å¤–è¿˜æœ‰ Compiler APIï¼ŒHttp Server APIï¼Œæ’å…¥å¼æ³¨è§£å¤„ç†API(Pluggable Annotation Processing API)ï¼Œå¯¹è„šæœ¬è¯­è¨€çš„æ”¯æŒå¦‚: ruby, groovy, javascriptï¼ŒCommon Annotations æ¶‰åŠå†…å®¹è¾ƒå¤šç¯‡å¹…è¾ƒé•¿ï¼Œåç»­å•ç‹¬å­¦ä¹ ã€‚</p><h3 id="JDK1-7"><a href="#JDK1-7" class="headerlink" title="JDK1.7"></a>JDK1.7</h3><h4 id="1-switchä¸­å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ã€‚"><a href="#1-switchä¸­å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ã€‚" class="headerlink" title="1. switchä¸­å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ã€‚"></a>1. switchä¸­å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ã€‚</h4><pre><code>éå¸¸å®ç”¨çš„ã€‚</code></pre><h4 id="2-æ³›å‹å®ä¾‹åŒ–ç±»å‹è‡ªåŠ¨æ¨æ–­ã€‚"><a href="#2-æ³›å‹å®ä¾‹åŒ–ç±»å‹è‡ªåŠ¨æ¨æ–­ã€‚" class="headerlink" title="2. æ³›å‹å®ä¾‹åŒ–ç±»å‹è‡ªåŠ¨æ¨æ–­ã€‚"></a>2. æ³›å‹å®ä¾‹åŒ–ç±»å‹è‡ªåŠ¨æ¨æ–­ã€‚</h4><p>æŒ‡å®šç±»å‹:</p><pre class=" language-java"><code class="language-java">    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> myMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>è‡ªåŠ¨æ¨æ–­:</p><pre class=" language-java"><code class="language-java">    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> myMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><h4 id="3-æ•°å€¼å­—é¢é‡æ”¹è¿›"><a href="#3-æ•°å€¼å­—é¢é‡æ”¹è¿›" class="headerlink" title="3. æ•°å€¼å­—é¢é‡æ”¹è¿›."></a>3. æ•°å€¼å­—é¢é‡æ”¹è¿›.</h4><p>æ•°å­—å‰é¢åŠ â€0Bâ€æˆ–â€0bâ€è¡¨ç¤ºäºŒè¿›åˆ¶æ•°ã€‚å¦‚ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">int</span> binary <span class="token operator">=</span> <span class="token number">0b10011001</span><span class="token punctuation">;</span></code></pre><p>æ•°å€¼ä¸­å¯ä»¥æ·»åŠ <code>&quot;_&quot;</code>ã€‚ å¦‚ï¼š </p><pre class=" language-java"><code class="language-java"><span class="token keyword">int</span> one_million <span class="token operator">=</span> 1_000_000<span class="token punctuation">;</span></code></pre><h4 id="4-try-with-resourcesè¯­å¥ã€‚"><a href="#4-try-with-resourcesè¯­å¥ã€‚" class="headerlink" title="4. try-with-resourcesè¯­å¥ã€‚"></a>4. try-with-resourcesè¯­å¥ã€‚</h4><p>try-with-resourcesè¯­å¥ä¸­ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œç”¨äºè‡ªåŠ¨é‡Šæ”¾èµ„æºã€‚è‡ªåŠ¨å…³é—­æ¥å£AutoCloseableã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">try</span><span class="token punctuation">(</span>OutputStream fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"D:/file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// ä¸éœ€è¦å†æ¬¡æŒ‡æ˜fos.close();</span><span class="token punctuation">}</span></code></pre><ol start="5"><li>ä¼˜åŒ–å¼‚å¸¸å¤„ç†</li></ol><pre class=" language-java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>   result <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> <span class="token operator">|</span> IllegalAccessException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="JDK1-8"><a href="#JDK1-8" class="headerlink" title="JDK1.8"></a>JDK1.8</h3><h4 id="1-Lambda-è¡¨è¾¾å¼"><a href="#1-Lambda-è¡¨è¾¾å¼" class="headerlink" title="1. Lambda è¡¨è¾¾å¼"></a>1. Lambda è¡¨è¾¾å¼</h4><p>Lambdaè¡¨è¾¾å¼ï¼ˆä¹Ÿç§°ä¸ºé—­åŒ…ï¼‰æ˜¯æ•´ä¸ªJava 8å‘è¡Œç‰ˆä¸­æœ€å—æœŸå¾…çš„åœ¨Javaè¯­è¨€å±‚é¢ä¸Šçš„æ”¹å˜ï¼ŒLambdaå…è®¸æŠŠå‡½æ•°ä½œä¸ºä¸€ä¸ªæ–¹æ³•çš„å‚æ•°è¿›è¡Œä¼ é€’ã€‚</p><p>Lambda è¡¨è¾¾å¼çš„æ ‡å‡†æ ¼å¼ï¼š</p><pre><code>(å‚æ•°ç±»å‹ å‚æ•°å) -&gt; {    æ–¹æ³•ä½“;    return è¿”å›å€¼;}</code></pre><p>Lambda è¡¨è¾¾å¼çš„çœç•¥è§„åˆ™ï¼š<br>    1. å°æ‹¬å·ä¸­çš„å‚æ•°ç±»å‹å¯ä»¥çœç•¥ã€‚<br>    2. å¦‚æœå°æ‹¬å·ä¸­åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥å°æ‹¬å·ã€‚<br>    3. å¦‚æœå¤§æ‹¬å·ä¸­åªæœ‰ä¸€æ¡è¯­å¥ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥å¤§æ‹¬å·ï¼Œreturnï¼Œåˆ†å·ã€‚<br>å…¶ä»–æ³¨æ„ï¼šä¸å…è®¸å£°æ˜ä¸€ä¸ªä¸å±€éƒ¨å˜é‡åŒåçš„å‚æ•°æˆ–è€…å±€éƒ¨å˜é‡ã€‚<br>å››ç§æ–¹æ³•å¼•ç”¨ç±»å‹<br>| ç±»å‹          | ç¤ºä¾‹                                      |<br>| å¼•ç”¨é™æ€æ–¹æ³• |    ContainingClass::staticMethodName |<br>| å¼•ç”¨æŸä¸ªå¯¹è±¡çš„å®ä¾‹æ–¹æ³•     |containingObject::instanceMethodName |<br>| å¼•ç”¨æŸä¸ªç±»å‹çš„ä»»æ„å¯¹è±¡çš„å®ä¾‹æ–¹æ³• |    ContainingType::methodName |<br>| å¼•ç”¨æ„é€ æ–¹æ³• |    ClassName::new  |</p><pre class=" language-java"><code class="language-java">  <span class="token comment" spellcheck="true">// ä½¿ç”¨ java 7 æ’åº</span>   <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sortJava7</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>String<span class="token operator">></span> names<span class="token punctuation">)</span><span class="token punctuation">{</span>         Collections<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token annotation punctuation">@Override</span>         <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span>String s1<span class="token punctuation">,</span> String s2<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>   <span class="token comment" spellcheck="true">// ä½¿ç”¨ java 8 æ’åº</span>   <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sortJava8</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>String<span class="token operator">></span> names<span class="token punctuation">)</span><span class="token punctuation">{</span>      Collections<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> s1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span></code></pre><p>Lambda ä½¿ç”¨æ¡ä»¶</p><p>Lambda è¡¨è¾¾å¼çš„ä½¿ç”¨å‰æ:</p><pre><code>å¿…é¡»æœ‰æ¥å£ï¼ˆä¸èƒ½æ˜¯æŠ½è±¡ç±»ï¼‰ï¼Œæ¥å£ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªéœ€è¦è¢«é‡å†™çš„æŠ½è±¡æ–¹æ³•ã€‚å¿…é¡»æ”¯æŒä¸Šä¸‹æ–‡æ¨å¯¼ï¼Œè¦èƒ½å¤Ÿæ¨å¯¼å‡ºæ¥ Lambda è¡¨è¾¾å¼è¡¨ç¤ºçš„æ˜¯å“ªä¸ªæ¥å£ä¸­çš„å†…å®¹ã€‚ å¯ä»¥ä½¿ç”¨æ¥å£å½“åšå‚æ•°ï¼Œç„¶åä¼ é€’ Lambda è¡¨è¾¾å¼(å¸¸ç”¨)ï¼Œä¹Ÿå¯ä»¥å°† Lambda è¡¨è¾¾å¼èµ‹å€¼ç»™ä¸€ä¸ªæ¥å£ç±»å‹çš„å˜é‡ã€‚</code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk8<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">printStr</span><span class="token punctuation">(</span>String string<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span>  <span class="token class-name">LambdaTest</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//ä½¿ç”¨æ¥å£å½“åšå‚æ•°</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span>MyInterface m<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//m = s -> System.out.println(s)</span>        m<span class="token punctuation">.</span><span class="token function">printStr</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//ä½¿ç”¨æ¥å£å½“åšå‚æ•°ï¼Œç„¶åä¼ é€’Lambdaè¡¨è¾¾å¼ã€‚</span>        <span class="token comment" spellcheck="true">//method(s -> System.out.println(s));</span>        <span class="token comment" spellcheck="true">//ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»æ–¹å¼åˆ›å»ºå¯¹è±¡</span>        <span class="token comment" spellcheck="true">/*        MyInterface m = new MyInterface() {            @Override            public void printStr(String str) {                System.out.println(str);            }        };        */</span>        <span class="token comment" spellcheck="true">//Lambda è¡¨è¾¾å¼èµ‹å€¼ç»™æ¥å£ç±»å‹å˜é‡</span>        MyInterface m <span class="token operator">=</span> str <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>        m<span class="token punctuation">.</span><span class="token function">printStr</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 1.1ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»  </span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token annotation punctuation">@Override</span>              <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello world !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 1.2ä½¿ç”¨ lambda expression  </span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello world !"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 2.1ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»  </span>        Runnable race1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token annotation punctuation">@Override</span>              <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello world !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 2.2ä½¿ç”¨ lambda expression  </span>        Runnable race2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello world !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// ç›´æ¥è°ƒç”¨ run æ–¹æ³•(æ²¡å¼€æ–°çº¿ç¨‹å“¦!)  </span>        race1<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          race2<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="2-å‡½æ•°å¼æ¥å£"><a href="#2-å‡½æ•°å¼æ¥å£" class="headerlink" title="2. å‡½æ•°å¼æ¥å£"></a>2. å‡½æ•°å¼æ¥å£</h4><p>JDK 8ä¹‹å‰å°±æœ‰çš„å‡½æ•°å¼æ¥å£ï¼ˆä½¿ç”¨@FunctionalInterfaceå®šä¹‰ ï¼‰</p><pre class=" language-java"><code class="language-java">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Runnablejava<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>Callablejava<span class="token punctuation">.</span>security<span class="token punctuation">.</span>PrivilegedActionjava<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Comparatorjava<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileFilterjava<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>PathMatcher java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>InvocationHandlerjava<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>PropertyChangeListenerjava<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>event<span class="token punctuation">.</span>ActionListener  javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span>event<span class="token punctuation">.</span>ChangeListener </code></pre><h4 id="3-æ¥å£é»˜è®¤æ–¹æ³•ä¸é™æ€æ–¹æ³•"><a href="#3-æ¥å£é»˜è®¤æ–¹æ³•ä¸é™æ€æ–¹æ³•" class="headerlink" title="3. æ¥å£é»˜è®¤æ–¹æ³•ä¸é™æ€æ–¹æ³•"></a>3. æ¥å£é»˜è®¤æ–¹æ³•ä¸é™æ€æ–¹æ³•</h4><p>æ¥å£é»˜è®¤æ–¹æ³•ï¼Œç”¨<code>default</code>å…³é”®å­—ã€‚<br>æ¥å£é™æ€æ–¹æ³•ï¼Œç”¨<code>static</code>å…³é”®å­—ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk8<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">printStr</span><span class="token punctuation">(</span>String string<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" this is default method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isNull</span><span class="token punctuation">(</span>String str<span class="token punctuation">)</span> <span class="token punctuation">{</span>         System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Interface Null Check"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">return</span> str <span class="token operator">==</span> null <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre><p>æ³¨æ„ï¼šç±»ç»§æ‰¿å¤šä¸ªInterfaceæ¥å£åŒåæ–¹æ³•(å¦‚show())æ—¶ï¼Œå¿…é¡»åœ¨å­ç±»ä¸­@Overrideé‡å†™çˆ¶ç±»show()æ–¹æ³•ã€‚</p><p>ç‰¹æ€§è¯´æ˜ï¼š</p><pre><code>1,å‡½æ•°å¼æ¥å£ä»…ä»…åªæœ‰ä¸€ä¸ªæ–¹æ³•(éé»˜è®¤æˆ–é™æ€æ–¹æ³•)ï¼Œç”¨äºæ˜¾ç¤ºè½¬æ¢æˆladbmaè¡¨è¾¾å¼ã€‚2, java.lang.Runnableæ¥å£ java.util.concurrent.Callableæ¥å£æ˜¯ä¸¤ä¸ªæœ€å…¸å‹çš„å‡½æ•°å¼æ¥å£ã€‚3.å¦‚æœä¸€ä¸ªå‡½æ•°å¼æ¥å£æ·»åŠ ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œå°±å˜æˆäº†éå‡½æ•°å¼æ¥å£ï¼ˆä¸€èˆ¬å®šä¹‰çš„æ¥å£ï¼‰ã€‚4.Jdk8 è§„èŒƒé‡Œæ·»åŠ äº†æ³¨è§£@FunctionalInterfaceæ¥é™åˆ¶å‡½æ•°å¼æ¥å£ä¸èƒ½ä¿®æ”¹ä¸ºæ™®é€šçš„æ¥å£.</code></pre><p>jdk8æ–°å¢äº†å››ä¸ªé‡è¦çš„å‡½æ•°å¼æ¥å£ï¼šå‡½æ•°å½¢æ¥å£ ã€ä¾›ç»™å½¢æ¥å£ã€æ¶ˆè´¹å‹æ¥å£ã€åˆ¤æ–­å‹æ¥å£ </p><h4 id="4-æ—¥æœŸæ—¶é—´çš„API"><a href="#4-æ—¥æœŸæ—¶é—´çš„API" class="headerlink" title="4. æ—¥æœŸæ—¶é—´çš„API."></a>4. æ—¥æœŸæ—¶é—´çš„API.</h4><p>æ–°çš„æ—¶é—´åŠæ—¥æœŸAPIç±»åœ¨java.timeåŒ…ä¸­ï¼Œä¸å¯å˜ä¸”çº¿ç¨‹å®‰å…¨çš„ã€‚<br>Instantè·å–æ—¶é—´æˆ³, LocalDateåªå¤„ç†æ—¥æœŸã€LocalTimeåªå¤„ç†æ—¶é—´,LocalDateTimeåªå¤„ç†æ—¥æœŸæ—¶é—´ï¼ŒZonedDateTimeåŒ…å«æ—¶åŒºçš„æ—¥æœŸæ—¶é—´<br>TemporalAdjusters æ—¥æœŸè°ƒæ•´<br>DateTimeFormatter æ›¿ä»£ä¹‹å‰ç‰ˆæœ¬çš„SimpleDateFormatç±»<br>YearMonthå¹´æœˆç»„åˆ,MonthDayæœˆæ—¥ç»„åˆ<br>Clockdeng</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk8<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Clock<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDate<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDateTime<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalTime<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token punctuation">.</span>out<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateTimeTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>         LocalDate date <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          LocalTime time <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span>Clock<span class="token punctuation">.</span><span class="token function">systemUTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         LocalDateTime dttm <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" date = "</span> <span class="token operator">+</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>         out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" time = "</span> <span class="token operator">+</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>         out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" dttm = "</span> <span class="token operator">+</span>dttm<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>æ§åˆ¶å°è¾“å‡ºï¼š</p><pre><code> date = 2020-05-31 time = 16:29:41.010 dttm = 2020-05-31T00:29:41.010</code></pre><p>æ›´å¤šå†…å®¹å‚è€ƒ<a href="/post/d0e15f60.html">ã€Šjava æŸ¥æ¼è¡¥ç¼º-java8é‡Œçš„æ—¥æœŸæ—¶é—´APIã€‹</a></p><h4 id="5-Optional-ç±»"><a href="#5-Optional-ç±»" class="headerlink" title="5. Optional ç±»"></a>5. Optional ç±»</h4><p>Optional æ˜¯ä¸ªå®¹å™¨ï¼Œå®ƒå¯ä»¥ä¿å­˜ç±»å‹Tçš„å€¼ï¼Œæˆ–è€…ä»…ä»…ä¿å­˜nullã€‚Optionalæä¾›å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨æ˜¾å¼è¿›è¡Œç©ºå€¼æ£€æµ‹ã€‚æ¯”è¾ƒå‹å¥½çš„çš„è§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚Optional.of()æˆ–è€…Optional.ofNullable()ï¼šåˆ›å»ºOptionalå¯¹è±¡ï¼Œå·®åˆ«åœ¨äºofä¸å…è®¸å‚æ•°æ˜¯nullï¼Œè€ŒofNullableåˆ™æ— é™åˆ¶ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk8<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Optional<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token punctuation">.</span>out<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OptionalTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// å‚æ•°ä¸èƒ½æ˜¯null</span>        Optional<span class="token operator">&lt;</span>Integer<span class="token operator">></span> opt1 <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opt1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å‚æ•°å¯ä»¥æ˜¯null</span>        Optional<span class="token operator">&lt;</span>Integer<span class="token operator">></span> opt2 <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opt2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// å‚æ•°å¯ä»¥æ˜¯énull</span>        Optional<span class="token operator">&lt;</span>Integer<span class="token operator">></span> opt3 <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> opt4 <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opt3<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opt4<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// orElse</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opt1<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// true</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>opt4<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"1000"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"1000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// true</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>optional1<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">1000</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//true</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="6-Nashorn-JavaScriptå¼•æ“ã€‚"><a href="#6-Nashorn-JavaScriptå¼•æ“ã€‚" class="headerlink" title="6. Nashorn, JavaScriptå¼•æ“ã€‚"></a>6. Nashorn, JavaScriptå¼•æ“ã€‚</h4><p>Java 8æä¾›äº†ä¸€ä¸ªæ–°çš„Nashorn javascriptå¼•æ“ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨JVMä¸Šè¿è¡Œç‰¹å®šçš„javascriptåº”ç”¨ã€‚</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>zxc<span class="token punctuation">.</span>jdk8<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span>ScriptEngine<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span>ScriptEngineManager<span class="token punctuation">;</span><span class="token keyword">import</span> javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span>ScriptException<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NashornTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> ScriptException <span class="token punctuation">{</span>        ScriptEngine engine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScriptEngineManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">"nashorn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        engine<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"print('Hello World!');"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Nashorn JavaScriptåŸºäºECMAScript 5.1ï¼Œä½†æ˜¯å®ƒçš„åç»­ç‰ˆæœ¬ä¼šå¯¹ES6æä¾›æ”¯æŒï¼š<br>Nashornçš„å½“å‰ç­–ç•¥éµå¾ªECMAScriptè§„èŒƒã€‚å½“æˆ‘ä»¬åœ¨JDK8ä¸­å‘å¸ƒå®ƒæ—¶ï¼Œå®ƒå°†åŸºäºECMAScript 5.1ã€‚Nashornæœªæ¥çš„ä¸»è¦å‘å¸ƒåŸºäºECMAScript 6ã€‚<br>Nashornå®šä¹‰äº†å¤§é‡å¯¹ECMAScriptæ ‡å‡†çš„è¯­è¨€å’ŒAPIæ‰©å±•ã€‚ä½†æ˜¯é¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸€çœ‹Javaå’ŒJavaScriptä»£ç å¦‚ä½•äº¤äº’ã€‚</p><p>æ³¨æ„ï¼š</p><p>è¯¥å¼•æ“åœ¨java11æ˜¯è¢«å¼ƒç”¨ã€‚ECMAScriptè¯­è¨€æ ‡å‡†çš„å¿«é€Ÿå‘å±•ï¼Œç»´æŠ¤Nashornå¼•æ“å˜å¾—è¶Šå‘æŒ‘æˆ˜ï¼Œå› æ­¤è¯¥å¼•æ“å°†åœ¨Javaä¸­åºŸå¼ƒã€‚<br>ä¸¤ä¸ªæ¨¡å—å°†ä¼šè¢«æœ€ç»ˆå¼ƒç”¨ï¼Œè¢«æ ‡æ³¨ä¸º@Deprecated(forRemoval=true)ã€‚</p><p>jdk.scripting.nashornæ¨¡å—ï¼ŒåŒ…å«dk.nashorn.api.scriptingå’Œjdk.nashorn.api.treeåŒ…ã€‚jdk.scripting.nashorn.shellæ¨¡å—ï¼ŒåŒ…å«jjså·¥å…·ï¼Œè¿è¡Œjjså°†æ˜¾ç¤ºè­¦å‘Šã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œjava.scriptingæ¨¡å—ä¸­javax.scriptåŒ…ä¸‹çš„ç›¸å…³APIä¸å—å½±å“ã€‚</p><h4 id="7-æ–°å·¥å…·"><a href="#7-æ–°å·¥å…·" class="headerlink" title="7. æ–°å·¥å…·"></a>7. æ–°å·¥å…·</h4><p>æ–°çš„ç¼–è¯‘å·¥å…·ï¼Œå¦‚ï¼šNashornå¼•æ“ jjsã€ ç±»ä¾èµ–åˆ†æå™¨jdepsã€‚<br>Nashornå¼•æ“jjsï¼š<br>jjsæ˜¯ä¸€ä¸ªåŸºäºæ ‡å‡†Nashornå¼•æ“çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥æ¥å—jsæºç å¹¶æ‰§è¡Œã€‚<br>ç±»ä¾èµ–åˆ†æå™¨jdepsï¼š<br>jdepsæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå¯ä»¥å±•ç¤ºåŒ…å±‚çº§å’Œç±»å±‚çº§çš„Javaç±»ä¾èµ–å…³ç³»ï¼Œå®ƒä»¥.classæ–‡ä»¶ã€ç›®å½•æˆ–è€…Jaræ–‡ä»¶ä¸ºè¾“å…¥ï¼Œç„¶åä¼šæŠŠä¾èµ–å…³ç³»è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚<br>JVMçš„æ–°ç‰¹æ€§<br>ä½¿ç”¨Metaspaceï¼ˆJEP 122ï¼‰ä»£æ›¿æŒä¹…ä»£ï¼ˆPermGen spaceï¼‰ã€‚åœ¨JVMå‚æ•°æ–¹é¢ï¼Œä½¿ç”¨<code>-XX:MetaSpaceSize</code>å’Œ<code>-XX:MaxMetaspaceSize</code>ä»£æ›¿åŸæ¥çš„<code>-XX:PermSize</code>å’Œ<code>-XX:MaxPermSize</code>ã€‚</p><h4 id="8-å…¶ä»–"><a href="#8-å…¶ä»–" class="headerlink" title="8. å…¶ä»–"></a>8. å…¶ä»–</h4><p>è‹¥é‡åˆ°éšæ—¶è¡¥å……å­¦ä¹ ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 Optional API</title>
      <link href="/posts/e748f349.html"/>
      <url>/posts/e748f349.html</url>
      
        <content type="html"><![CDATA[<h2 id="Java8-ä¸­çš„-Optional"><a href="#Java8-ä¸­çš„-Optional" class="headerlink" title="Java8 ä¸­çš„ Optional"></a>Java8 ä¸­çš„ Optional</h2><h3 id="å…³äºOptional"><a href="#å…³äºOptional" class="headerlink" title="å…³äºOptional"></a>å…³äºOptional</h3><p>è¯¥ç±»ä½äºjava.utilä¸‹ï¼Œå±äºfinalç±»ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå·¥å…·ç±»ã€‚<br>ä¸»è¦æ˜¯ä¸ºäº†é¢„é˜²è¿è¡Œæ—¶æŠ›å‡º <code>NullPointException</code></p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>optional<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Optional<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OptionalTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>         Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> optionalS <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"zhangxiaocai"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>optionalS<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//è¾“å‡ºï¼š zhangxiaocai</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="Optionalä¸»è¦æ–¹æ³•API"><a href="#Optionalä¸»è¦æ–¹æ³•API" class="headerlink" title="Optionalä¸»è¦æ–¹æ³•API"></a>Optionalä¸»è¦æ–¹æ³•API</h3><table><thead><tr><th>æ–¹æ³•API</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>of(T value)</td><td>æŠŠæŒ‡å®šçš„å€¼å°è£…ä¸ºOptionalå¯¹è±¡ï¼Œå¦‚æœæŒ‡å®šçš„å€¼ä¸ºnullï¼Œåˆ™æŠ›å‡ºNullPointerException</td></tr><tr><td>ofNullable(T value)</td><td>æŠŠæŒ‡å®šçš„å€¼å°è£…ä¸ºOptionalå¯¹è±¡ï¼Œå¦‚æœæŒ‡å®šçš„å€¼ä¸ºnullï¼Œåˆ™åˆ›å»ºä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡</td></tr><tr><td>get()</td><td>å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™æŠ›å‡ºNoSuchElementException</td></tr><tr><td>isPresent()</td><td>å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œè¿”å›trueï¼Œå¦åˆ™è¿”å›false</td></tr><tr><td>ifPresent(Consumerc)</td><td>å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œè¯¥æ–¹æ³•çš„è°ƒç”¨ï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åš</td></tr><tr><td>orElse(T value)</td><td>å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªé»˜è®¤å€¼</td></tr><tr><td>orElseGet(Supplier s)</td><td>å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç”±Supplieræ¥å£ç”Ÿæˆçš„å€¼</td></tr><tr><td>orElseThrow(Supplier s)</td><td>å¦‚æœå­˜åœ¨è¯¥å€¼ï¼Œè¿”å›åŒ…å«çš„å€¼ï¼Œå¦åˆ™æŠ›å‡ºç”± Supplier ç»§æ‰¿çš„å¼‚å¸¸</td></tr><tr><td>empty()</td><td>åˆ›å»ºä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡</td></tr><tr><td>orElseThrow</td><td>å¦‚æœåˆ›å»ºçš„Optionalä¸­æœ‰å€¼å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å€¼ï¼Œå¦åˆ™æŠ›å‡ºä¸€ä¸ªç”±æŒ‡å®šçš„Supplieræ¥å£ç”Ÿæˆçš„å¼‚å¸¸</td></tr><tr><td>filter(Predicate p)</td><td>å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼æ»¡è¶³filterä¸­çš„æ¡ä»¶ï¼Œåˆ™è¿”å›åŒ…å«è¯¥å€¼çš„Optionalå¯¹è±¡ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡</td></tr><tr><td>map(Function f)</td><td>å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œå¯¹è¯¥å€¼æ‰§è¡Œæä¾›çš„Functionå‡½æ•°è°ƒç”¨</td></tr><tr><td>flagMap(Function f)</td><td>å¦‚æœåˆ›å»ºçš„Optionalä¸­çš„å€¼å­˜åœ¨ï¼Œå°±å¯¹è¯¥å€¼æ‰§è¡Œæä¾›çš„Functionå‡½æ•°è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªOptionalç±»å‹çš„å€¼ï¼Œå¦åˆ™å°±è¿”å›ä¸€ä¸ªç©ºçš„Optionalå¯¹è±¡</td></tr></tbody></table><h3 id="æ™®é€šæ€ç»´å®ä¾‹æ¼”ç¤º"><a href="#æ™®é€šæ€ç»´å®ä¾‹æ¼”ç¤º" class="headerlink" title="æ™®é€šæ€ç»´å®ä¾‹æ¼”ç¤º"></a>æ™®é€šæ€ç»´å®ä¾‹æ¼”ç¤º</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>optional<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Optional<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token punctuation">.</span>out<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OptionalTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>         Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> optionalS <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"zhangxiaocai"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>optionalS<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         UserModel user <span class="token operator">=</span> null<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//Optional&lt;UserModel> userOption1 = Optional.of(user);//ä¼šæŠ›å¼‚å¸¸</span>         <span class="token comment" spellcheck="true">//out.println(userOption1.get());</span>         Optional<span class="token operator">&lt;</span>UserModel<span class="token operator">></span> userOption2 <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ä¸ä¼šæŠ›å¼‚å¸¸</span>         out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userOption2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è°ƒç”¨çš„æ—¶å€™ä¼šæŠ›å¼‚å¸¸ï¼Œå› æ­¤è°ƒç”¨éœ€è¦å…ˆåˆ¤æ–­</span>         user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"xiaocai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"small-rose@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//å³ä½¿ä½¿ç”¨äº†ä¹‹å‰çš„å˜é‡åï¼Œä¾æ—§æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡</span>         userOption2 <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>         out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userOption2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span>userOption2<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>             out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userOption2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              Optional<span class="token operator">&lt;</span>Integer<span class="token operator">></span> uid <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>userOption2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token keyword">if</span><span class="token punctuation">(</span>uid<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                 out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user  id is "</span><span class="token operator">+</span>uid<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token punctuation">}</span>             Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> email <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>userOption2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token keyword">if</span><span class="token punctuation">(</span>email<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                 out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"you can send mail to "</span><span class="token operator">+</span>email<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token punctuation">}</span>             <span class="token comment" spellcheck="true">//Optional.orElse - å¦‚æœå€¼å­˜åœ¨ï¼Œè¿”å›å®ƒï¼Œå¦åˆ™è¿”å›æä¾›çš„é»˜è®¤å€¼</span>             Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> nameopt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>userOption2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             String name <span class="token operator">=</span> nameopt<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"zhangxiaocai"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user name is "</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>             out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user is null "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="å‡½æ•°å¼ç¼–ç¨‹æ¼”ç¤º"><a href="#å‡½æ•°å¼ç¼–ç¨‹æ¼”ç¤º" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹æ¼”ç¤º"></a>å‡½æ•°å¼ç¼–ç¨‹æ¼”ç¤º</h3><p>å‡½æ•°å¼ç¼–ç¨‹æ³¨æ„æ–¹æ³•APIä¸­ä¼ çš„å‚æ•°ã€‚<br>ç•™æ„å¸¦å‚æ•°çš„å‡ ä¸ªAPI:<br><code>ifPresent(Consumer&lt;? super T&gt; consumer</code>ã€<br><code>orElseGet(Supplier&lt;? extends T&gt; other)</code><br><code>orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier)</code><br><code>map(Function&lt;? super T,? extends U&gt; mapper)</code><br><code>flagMap(Function&lt;? super T,Optional&lt;U&gt;&gt; mapper)</code></p><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaocai<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>optional<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>System<span class="token punctuation">.</span>out<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Optional<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span>Supplier<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OptionalFuncTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>         UserModel user1 <span class="token operator">=</span> null <span class="token punctuation">;</span>         Optional<span class="token operator">&lt;</span>UserModel<span class="token operator">></span> userop1 <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user1<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//å¦‚æœuser1ä¸ºnullï¼Œå°±å®ä¾‹åŒ–ä¸€ä¸ª</span>         <span class="token comment" spellcheck="true">//orElse ä¸ä¹‹å‰ç›¸åŒ å†™æ³•1</span>         UserModel defuser1 <span class="token operator">=</span>userop1<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>defuser1<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//å‡½æ•°å¼ orElseGet å†™æ³•2</span>         UserModel defuser2 <span class="token operator">=</span> userop1<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//if(userop1.isPresent()){ defuser2 = userop1.get(); }else{ defuser2 = new UserModel(); }</span>         out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>defuser2<span class="token punctuation">)</span><span class="token punctuation">;</span>         UserModel user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"xiaocai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"small-rose@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         Optional<span class="token operator">&lt;</span>UserModel<span class="token operator">></span> userop2 <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//å¦‚æœ userop é‡Œçš„å¯¹è±¡ä¸ä¸ºç©ºï¼Œåˆ™å–å‡ºåç§°å¹¶æ‰“å°</span>         <span class="token comment" spellcheck="true">//å‡½æ•°å¼ifPresent æ˜¯æ— è¿”å›å€¼çš„ Consumeræ¶ˆè´¹å‹æ¥å£</span>         userop2<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>u <span class="token operator">-</span><span class="token operator">></span>  out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// if(userop2.isPresent()){ out.println(userop2.get().getName()); }</span>         <span class="token comment" spellcheck="true">//user1å¦‚æœæ˜¯ç©ºçš„ï¼Œå°±å®ä¾‹åŒ–ä¸€ä¸ªï¼Œä½†æ˜¯åç§°ä¹Ÿæ˜¯ç©ºçš„ï¼Œä¸ºäº†æµ‹è¯•orElseGet</span>         Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> nameop <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>userop1<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//å‡½æ•°å¼orElseGet æ˜¯æœ‰è¿”å›å€¼çš„ Supplierä¾›ç»™å‹æ¥å£</span>         String userName <span class="token operator">=</span> nameop<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"zhangxiaocai"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">// if(nameop.isPresent()){ userName = nameop.get(); }else{ userName = "zhangxiaocai"; }</span>         out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user name is "</span> <span class="token operator">+</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//å¦‚æœè¦æ±‚ä¸å…è®¸éšä¾¿å®ä¾‹åŒ–æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±å¯ä»¥åˆ¤æ–­ï¼Œæ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºæŠ›å‡ºå¼‚å¸¸å³å¯</span>         userop1<span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span>IllegalArgumentException<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// userop2.map(  uOptionalFuncTest::sendEmail (u));</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span>UserModel u<span class="token punctuation">)</span><span class="token punctuation">{</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" send email to "</span> <span class="token operator">+</span> u<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</title>
      <link href="/posts/c68d7a69.html"/>
      <url>/posts/c68d7a69.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•å°†hexoåšå®¢éƒ¨ç½²åˆ°githubã€äº‘æœåŠ¡å™¨ä¸Šçš„ç›¸å…³æ“ä½œæ“ä½œã€‚</p><a id="more"></a><h4 id="å…³äºéƒ¨ç½²"><a href="#å…³äºéƒ¨ç½²" class="headerlink" title="å…³äºéƒ¨ç½²"></a>å…³äºéƒ¨ç½²</h4><p>å¸¸è§éƒ¨ç½²åœ¨githubä¸Šï¼Œå¦‚æœæœ‰è‡ªå·±ç‹¬ç«‹çš„æœåŠ¡å™¨ä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨æœåŠ¡ä¸Šï¼Œæ­¤å¤„ç”¨çš„è…¾è®¯äº‘æœåŠ¡å™¨ã€‚</p><h3 id="ä¸€-Githubä¸Šéƒ¨ç½²"><a href="#ä¸€-Githubä¸Šéƒ¨ç½²" class="headerlink" title="ä¸€  Githubä¸Šéƒ¨ç½²"></a>ä¸€  Githubä¸Šéƒ¨ç½²</h3><h4 id="1-å‡†å¤‡ç¯å¢ƒï¼š"><a href="#1-å‡†å¤‡ç¯å¢ƒï¼š" class="headerlink" title="1 å‡†å¤‡ç¯å¢ƒï¼š"></a>1 å‡†å¤‡ç¯å¢ƒï¼š</h4><p>â€‹    æœ‰githubè´¦æˆ·</p><p>â€‹    åœ¨è´¦æˆ·é‡Œåˆ›å»ºä»“åº“, New repositoryï¼Œä»“åº“åå›ºå®šæ ¼å¼ï¼š <code>ä½ çš„githubè´¦æˆ·å.github.io</code></p><p>â€‹    gitå…å¯†ç™»é™†ï¼ˆå¯é€‰ï¼Œéå¿…é¡»ï¼‰</p><h4 id="2-å®‰è£…éƒ¨ç½²æ’ä»¶"><a href="#2-å®‰è£…éƒ¨ç½²æ’ä»¶" class="headerlink" title="2  å®‰è£…éƒ¨ç½²æ’ä»¶"></a>2  å®‰è£…éƒ¨ç½²æ’ä»¶</h4><p>â€‹    å®‰è£…éƒ¨ç½²æ’ä»¶deploy-git </p><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-deployer-git --save</code></pre><h4 id="3-Hexoä¿®æ”¹æ ¹ç›®å½•é…ç½®æ–‡ä»¶"><a href="#3-Hexoä¿®æ”¹æ ¹ç›®å½•é…ç½®æ–‡ä»¶" class="headerlink" title="3  Hexoä¿®æ”¹æ ¹ç›®å½•é…ç½®æ–‡ä»¶"></a>3  Hexoä¿®æ”¹æ ¹ç›®å½•é…ç½®æ–‡ä»¶</h4><pre class=" language-yml"><code class="language-yml">deploy:  type: git  repo: https://github.com/your_github_name/your_github_name.github.io.git  branch: master</code></pre><p>å¦‚æœé…ç½®äº†å…å¯†ç™»å½•: </p><pre><code>git@github.com:yourgithubName/your_github_name.github.io.git</code></pre><p>æ²¡æœ‰é…ç½®è¯·ä½¿ç”¨ï¼š</p><pre><code>https://github.com/your_github_name/your_github_name.github.io.git</code></pre><p><code>https</code>å¼€å¤´æ¯æ¬¡è¦è¾“å…¥å¯†ç ï¼Œ<code>git</code>å¼€å¤´è¡¨ç¤ºæ˜¯ç”¨sshæ–¹å¼è¿æ¥ã€‚</p><h4 id="4-ç”Ÿæˆå¹¶éƒ¨ç½²"><a href="#4-ç”Ÿæˆå¹¶éƒ¨ç½²" class="headerlink" title="4  ç”Ÿæˆå¹¶éƒ¨ç½²"></a>4  ç”Ÿæˆå¹¶éƒ¨ç½²</h4><pre class=" language-bash"><code class="language-bash">hexo g <span class="token operator">&amp;</span> hexo d</code></pre><p>å¦‚æœæ²¡æœ‰é…ç½®å…å¯†ç™»é™†ï¼Œéƒ¨ç½²çš„æ—¶å€™å¯èƒ½ä¼šç”¨åˆ°gitçš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p><h4 id="5-è®¿é—®éªŒè¯"><a href="#5-è®¿é—®éªŒè¯" class="headerlink" title="5  è®¿é—®éªŒè¯"></a>5  è®¿é—®éªŒè¯</h4><p>æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š<a href="https://YourgithubName.github.io" target="_blank" rel="noopener">https://YourgithubName.github.io</a></p><p>å¦‚æˆ‘<code>github</code>åšå®¢åœ°å€ï¼š<a href="https://small-rose.github.io" target="_blank" rel="noopener">https://small-rose.github.io</a></p><h3 id="äºŒ-äº‘æœåŠ¡å™¨éƒ¨ç½²"><a href="#äºŒ-äº‘æœåŠ¡å™¨éƒ¨ç½²" class="headerlink" title="äºŒ  äº‘æœåŠ¡å™¨éƒ¨ç½²"></a>äºŒ  äº‘æœåŠ¡å™¨éƒ¨ç½²</h3><p>éƒ¨ç½²åˆ°äº‘æœåŠ¡æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åˆ©ç”¨gitä»“åº“é…åˆhooksè‡ªåŠ¨éƒ¨ç½²æ›´æ–°ï¼Œå¦ä¸€ç§æ˜¯æ’ä»¶çš„æ–¹å¼ï¼Œæ’ä»¶çš„è¯å¯ä»¥å‚è€ƒå¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ’ä»¶å®‰è£…å‘½ä»¤</th><th>åŠŸèƒ½</th><th>æ–‡æ¡£</th></tr></thead><tbody><tr><td>npm install hexo-deployer-cos â€“save</td><td>hexoä¸Šä¼ è‡³è…¾è®¯äº‘COS</td><td><a href="https://github.com/sdlzhd/hexo-deployer-cos#user-content-options" target="_blank" rel="noopener">https://github.com/sdlzhd/hexo-deployer-cos#user-content-options</a></td></tr><tr><td>npm install hexo-deployer-aliyun â€“save</td><td>hexoä¸Šä¼ è‡³é˜¿é‡Œäº‘</td><td><a href="https://github.com/yedaodao/hexo-deployer-aliyun" target="_blank" rel="noopener">https://github.com/yedaodao/hexo-deployer-aliyun</a></td></tr></tbody></table><h4 id="1-å‡†å¤‡ç¯å¢ƒï¼š-1"><a href="#1-å‡†å¤‡ç¯å¢ƒï¼š-1" class="headerlink" title="1  å‡†å¤‡ç¯å¢ƒï¼š"></a>1  å‡†å¤‡ç¯å¢ƒï¼š</h4><p>â€‹    æœ‰ä¸€å°äº‘æœåŠ¡å™¨ï¼Œæœ¬æ–‡æ˜¯è…¾è®¯äº‘æœåŠ¡å™¨</p><p>â€‹    å‡†å¤‡å·¥ä½œå¤§æ¦‚å¦‚ä¸‹</p><pre class=" language-html"><code class="language-html">ï¼ˆ1ï¼‰æœåŠ¡å™¨å®‰è£…gitæœåŠ¡å¹¶åˆ›å»ºä»“åº“ï¼ˆ2ï¼‰é…ç½®hooksï¼ˆ3ï¼‰å®‰è£…åŠé…ç½®Nginx</code></pre><h4 id="2-å®‰è£…git"><a href="#2-å®‰è£…git" class="headerlink" title="2  å®‰è£…git"></a>2  å®‰è£…git</h4><p>å®‰è£…å‘½ä»¤ï¼š</p><pre class=" language-bash"><code class="language-bash">yum -y <span class="token function">install</span> <span class="token function">git</span> </code></pre><p>å¦‚æœä½ çš„æœåŠ¡å™¨ä¸èƒ½ç›´æ¥yumå®‰è£…ï¼Œå¯ä»¥å‚è€ƒ    gitå®‰è£…æ•™ç¨‹ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span>  /usr/local/src   <span class="token comment" spellcheck="true">#è¿›å…¥ä½ çš„ä¸‹è½½ç›®å½•           </span><span class="token function">wget</span> https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.24.0.tar.gz    <span class="token comment" spellcheck="true">#ä¸‹è½½ï¼Œä¸èƒ½ä¸‹è½½å°±è‡ªå·±ä¸Šä¼ ä¸€ä¸‹</span><span class="token function">tar</span> -zvxf git-2.24.0.tar.gz    <span class="token comment" spellcheck="true">#è§£å‹</span><span class="token function">cd</span> git-2.24.0                <span class="token function">make</span> all prefix<span class="token operator">=</span>/usr/local/git    <span class="token comment" spellcheck="true">#ç¼–è¯‘</span><span class="token function">make</span> <span class="token function">install</span> prefix<span class="token operator">=</span>/usr/local/git    <span class="token comment" spellcheck="true">#å®‰è£…gitåˆ°æŒ‡å®šç›®å½•</span><span class="token keyword">echo</span> <span class="token string">'export PATH=<span class="token variable">$PATH</span>:/usr/local/git/bin'</span> <span class="token operator">>></span> /etc/bashrc  <span class="token comment" spellcheck="true">#é…ç½®ç¯å¢ƒå˜é‡</span><span class="token function">source</span> /etc/bashrc       <span class="token comment" spellcheck="true">#åˆ·æ–°ç¯å¢ƒå˜é‡</span></code></pre><p>éªŒè¯Gitæ˜¯å¦å®‰è£…æˆåŠŸï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">git</span> --version</code></pre><p>æ·»åŠ gitç”¨æˆ·å¹¶æˆæƒï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">useradd</span> -r -s /bin/bash -c <span class="token string">'git version control'</span> -d /home/git <span class="token function">git</span> <span class="token function">passwd</span> <span class="token function">git</span> <span class="token function">mkdir</span> -p /home/git  <span class="token function">chown</span> git:git /home/git </code></pre><p>åˆ›å»ºä»“åº“ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /home/git/<span class="token function">git</span> init --bare myHexoBlog.git</code></pre><p>å¦‚æœè¦é…ç½®SSHå…ç™»å½•ï¼šï¼ˆå¯é€‰æ“ä½œï¼Œé…ç½®ä¹‹åä¸ç”¨æ¯æ¬¡æäº¤éƒ½è¾“å…¥å¯†ç ï¼‰</p><p>a.å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥</p><pre class=" language-bash"><code class="language-bash">ssh-keygen -t rsa -C <span class="token string">"è¿™é‡Œæ¢ä¸Šä½ çš„é‚®ç®±"</span></code></pre><p>ç„¶åä¼šå‡ºç°è¯¢é—®ï¼Œå¤§æ¦‚æ„æ€å¦‚ä¸‹ï¼š</p><pre><code>1. ç¡®è®¤ç§˜é’¥çš„ä¿å­˜è·¯å¾„ï¼ˆå¦‚æœä¸éœ€è¦æ”¹è·¯å¾„åˆ™ç›´æ¥å›è½¦ï¼‰ï¼›2. å¦‚æœä¸Šä¸€æ­¥ç½®é¡¶çš„ä¿å­˜è·¯å¾„ä¸‹å·²ç»æœ‰ç§˜é’¥æ–‡ä»¶ï¼Œåˆ™éœ€è¦ç¡®è®¤æ˜¯å¦è¦†ç›–ï¼ˆå¦‚æœä¹‹å‰çš„ç§˜é’¥ä¸å†éœ€è¦åˆ™ç›´æ¥å›è½¦è¦†ç›–ï¼Œå¦‚éœ€è¦åˆ™æ‰‹åŠ¨æ‹·è´åˆ°å…¶ä»–ç›®å½•åå†è¦†ç›–ï¼‰ï¼›3. åˆ›å»ºå¯†ç ï¼ˆå¦‚æœä¸éœ€è¦å¯†ç åˆ™ç›´æ¥å›è½¦ï¼‰ï¼›4. ç¡®è®¤å¯†ç ï¼›</code></pre><p>è¦å…å¯†ç™»å½•è¯·è¾“å¯†ç çš„æ—¶å€™å›è½¦å³å¯ã€‚æ ¹æ®æç¤ºæ‰¾åˆ°å¯†é’¥æ‰€åœ¨æ–‡ä»¶ï¼š</p><pre><code>id_rsa  #ç§é’¥id_rsa.pub  #å…¬é’¥</code></pre><p>b.æœåŠ¡ç«¯å¯¼å…¥å®¢æˆ·ç«¯å…¬é’¥</p><p>åœ¨/home/gitä¸‹å·²ç»åˆ›å»º.sshç›®å½•ï¼Œç„¶ååˆ›å»ºauthorized_keysæ–‡ä»¶ï¼Œå¹¶å°†å®¢æˆ·ç«¯ç”Ÿæˆçš„å…¬é’¥å¯¼å…¥è¿›å»ã€‚</p><pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /home/git/<span class="token function">mkdir</span> .ssh<span class="token function">chmod</span> 755 .ssh<span class="token function">touch</span> .ssh/authorized_keys<span class="token function">chmod</span> 644 .ssh/authorized_keys</code></pre><p>å°† <code>id_rsa.pub</code> æ–‡ä»¶çš„å†…å®¹å†™å…¥<code>authorized_keys</code></p><p>c. æœåŠ¡ç«¯SSHå°†RSAè®¤è¯æ‰“å¼€</p><pre class=" language-bash"><code class="language-bash">vim /etc/ssh/sshd_config</code></pre><p>å…¶ä¸­ä¸‰ä¸ªåœ°æ–¹çš„è®¾ç½®è¦ç¡®è®¤å¦‚ä¸‹ï¼š</p><pre><code>RSAAuthentication yesPubkeyAuthentication yesAuthorizedKeysFile .ssh/authorized_keys</code></pre><p>gitç”¨æˆ·ä¸å…è®¸ç™»å½•shell</p><pre class=" language-bash"><code class="language-bash">vim /etc/passwd</code></pre><p>å°†</p><pre><code>git:x:502:502::/home/git:/bin/bash</code></pre><p> æ”¹ä¸º</p><pre><code>git:x:502:502::/home/git:/usr/local/git/bin/git-shell</code></pre><p><code>ESC</code>é€€å‡ºï¼Œè¾“å…¥<code>:wq</code>ä¿å­˜é€€å‡ºï¼Œæ‰§è¡Œ<code>Enter</code>å³å¯ã€‚</p><h4 id="3-é…ç½®hooksè‡ªåŠ¨éƒ¨ç½²"><a href="#3-é…ç½®hooksè‡ªåŠ¨éƒ¨ç½²" class="headerlink" title="3 é…ç½®hooksè‡ªåŠ¨éƒ¨ç½²"></a>3 é…ç½®hooksè‡ªåŠ¨éƒ¨ç½²</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> -p /home/hexoBlog<span class="token function">chown</span> git:git /home/hexoBlog <span class="token function">cd</span> /home/hexoBlog<span class="token function">cd</span> /home/git/myHexoBlog.git/hooksvim  post-receive  <span class="token comment" spellcheck="true">#åˆ›å»ºhooksæ‰§è¡Œæ–‡ä»¶</span></code></pre><p>é…ç½®hooksï¼ŒæŒ‡å®š Git çš„å·¥ä½œæ ‘ï¼ˆæºä»£ç ï¼‰å’Œ Git ç›®å½•ï¼ˆé…ç½®æ–‡ä»¶ç­‰ï¼‰</p><pre class=" language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function">git</span> --work-tree<span class="token operator">=</span>/home/hexoBlog --git-dir<span class="token operator">=</span>/home/git/myHexoBlog.git checkout -f</code></pre><p>å¦‚æœæ˜¯ä½¿ç”¨ApacheæœåŠ¡,å¯ä»¥ç›´æ¥æŠŠwork-treeç›®å½•æŒ‡å‘/var/www/html</p><h4 id="4-å®‰è£…NginxæœåŠ¡"><a href="#4-å®‰è£…NginxæœåŠ¡" class="headerlink" title="4 å®‰è£…NginxæœåŠ¡"></a>4 å®‰è£…NginxæœåŠ¡</h4><pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> -y nginx</code></pre><p>å¦‚æœä½ ä¸èƒ½ç›´æ¥å®‰è£…ï¼Œè¯·å…ˆé…ç½®å®‰è£…æº</p><pre class=" language-bahs"><code class="language-bahs">sudo rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</code></pre><p>å¯åŠ¨Nginx</p><pre class=" language-bash"><code class="language-bash">systemctl start nginx.service</code></pre><p>æµè§ˆå™¨è¾“å…¥ä½ çš„åŸŸåæˆ–è€…IPï¼Œå‡ºç°æ¬¢è¿é¡µé¢ä»£è¡¨å®‰è£…å¯åŠ¨æˆåŠŸã€‚</p><p>ä¿®æ”¹é…ç½®ï¼š</p><pre class=" language-bash"><code class="language-bash">nginx -t  <span class="token comment" spellcheck="true">#æŸ¥çœ‹nginxå®‰è£…è·¯å¾„ é…ç½®æ–‡ä»¶è·¯å¾„</span>vim /etc/nginx/nginx.conf</code></pre><p>æ‰¾åˆ°serveréƒ¨åˆ†</p><pre><code>server {    listen 80 default_server;    listen [::]:80 default_server;    root /home/hexoBlog;    #éœ€è¦ä¿®æ”¹    server_name www.zhangxiaocai.cn; #éœ€è¦ä¿®æ”¹    include /etc/nginx/default.d/*.conf;    location / {    }    error_page 404 /404.html;        location = /40x.html {    }}</code></pre><p>ä¿®æ”¹å¥½ä¹‹å<code>ESC</code> è¾“å…¥<code>:wq</code>ä¿å­˜é€€å‡ºã€‚æ¥ä¸‹æ¥éªŒè¯é…ç½®</p><pre class=" language-bash"><code class="language-bash">nginx -t</code></pre><p>å¦‚æœå‡ºç°ä»¥ä¸‹å†…å®¹ä»£è¡¨é…ç½®æˆåŠŸï¼š</p><pre class=" language-bash"><code class="language-bash">nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is oknginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token function">test</span> is successful</code></pre><p>é‡æ–°åŠ è½½é…ç½®æˆ–é‡å¯nginxæœåŠ¡</p><pre class=" language-bash"><code class="language-bash">nginx -s reload</code></pre><p>æ›´å¤š<code>Nginx</code>ç›¸å…³å†…å®¹ï¼Œè®¿é—®<code>Nginx</code></p><h4 id="5-æœ¬åœ°é…ç½®ä¿®æ”¹"><a href="#5-æœ¬åœ°é…ç½®ä¿®æ”¹" class="headerlink" title="5 æœ¬åœ°é…ç½®ä¿®æ”¹"></a>5 æœ¬åœ°é…ç½®ä¿®æ”¹</h4><p>ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•çš„é…ç½®æ–‡ä»¶</p><pre><code>deploy:    type: git    repo: git@ä½ çš„äº‘æœåŠ¡å™¨çš„IPåœ°å€:/home/git/myHexoBlog    branch: master</code></pre><p>æ¸…ç†-ç”Ÿæˆ-éƒ¨ç½²</p><pre class=" language-bash"><code class="language-bash">hexo clean <span class="token operator">&amp;</span> hexo g <span class="token operator">&amp;</span> hexo d</code></pre><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a><br><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a><br><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a><br><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a><br><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a><br><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a><br><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a><br><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a><br><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a><br><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a><br><a href="a53a9069.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</title>
      <link href="/posts/ce4a93ff.html"/>
      <url>/posts/ce4a93ff.html</url>
      
        <content type="html"><![CDATA[<p> æœ¬æ–‡è®°å½•æ£é¼“hexoåšå®¢æ—¶é‡åˆ°çš„ä¸€äº›è¸©å‘çš„è®°å½•åŠç›¸å…³è§£å†³æ€è·¯ã€‚</p><a id="more"></a><p>å¸¸è§æŠ¥é”™å¤šåœ¨ <code>hexo g</code> çš„æ—¶å€™æŠ¥é”™</p><h5 id="1-YAMLException"><a href="#1-YAMLException" class="headerlink" title="1. YAMLException"></a>1. YAMLException</h5><pre><code>ERROR Process failed: _posts/hexo-problem.mdYAMLException: end of the stream or a document separator is expected at line x, column y:at ...</code></pre><p>è§£å†³æ€è·¯ï¼š<br>A. ä¸€èˆ¬æ˜¯å› ä¸ºç¼ºå°‘åˆ†éš”ç¬¦ï¼Œç¼ºå°‘ç©ºæ ¼ï¼Œ<code>key: value</code> ï¼Œè‹±æ–‡å†’å·åé¢ç•™ç©ºæ ¼ï¼Œä¸€èˆ¬é”™ä¼šæç¤ºå“ªä¸ªæ–‡ä»¶çš„ç¬¬å‡ è¡Œç¬¬å‡ åˆ—ã€‚<br>B.å…¶æ¬¡æ˜¯å¤´éƒ¨yamlé…ç½®</p><pre><code>---key: value---</code></pre><p>ç¼ºå°‘ä¹Ÿä¼šå¯¼è‡´æ–‡ç« å†…å®¹æŠ¥é”™ï¼Œå…·ä½“æŠ¥é”™çš„è¡Œåˆ—ä½ç½®å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå°±æ£€æŸ¥å¤´éƒ¨æˆ–è€…é™„è¿‘æ ‡ç‚¹ï¼Œæˆ–åˆ†æ®µæµ‹è¯•ï¼Œè¯¥æ–¹æ¡ˆé€‚åˆæ–‡ç« æŠ¥é”™<br>C.è¿˜æœ‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚<code>[ ]</code>ä¹Ÿä¼šå¯¼è‡´æŠ¥é”™ï¼Œæˆ‘åœ¨titleä¸­ä½¿ç”¨è‹±æ–‡<code>[ ]</code>ä¹Ÿä¼šæŠ¥é”™ï¼Œä½†æç¤ºçš„ä½ç½®æ²¡æœ‰é—®é¢˜ï¼Œæ³¨æ„ç‰¹æ®Šå­—ç¬¦ä½¿ç”¨ã€‚</p><h5 id="2-æŸä¸ªejsæˆ–swigæ–‡ä»¶æŠ¥é”™"><a href="#2-æŸä¸ªejsæˆ–swigæ–‡ä»¶æŠ¥é”™" class="headerlink" title="2.  æŸä¸ªejsæˆ–swigæ–‡ä»¶æŠ¥é”™"></a>2.  æŸä¸ªejsæˆ–swigæ–‡ä»¶æŠ¥é”™</h5><p>ï¼ˆ1ï¼‰æ­¤ç±»é—®é¢˜ä¸€èˆ¬æ˜¯ä½¿ç”¨æŸä¸ªä¸»é¢˜ä¹‹åä¼šå‡ºç°ï¼Œæ³¨æ„ä¸»é¢˜ä¸‹çš„é…ç½®æ–‡ä»¶_config.ymlæ£€æŸ¥æ˜¯å¦é…ç½®ï¼Œå‚è€ƒï¼ˆä¸€ï¼‰Açš„æ€è·¯<br>ï¼ˆ2ï¼‰ç¼ºå°‘ç›¸å…³æ’ä»¶å¦‚xoxoä¸»é¢˜ç”Ÿæˆæ—¶å°±æœ‰readingTimeçš„æŠ¥é”™ï¼Œå®‰è£…äº†hexo-reading-timeçš„æ’ä»¶åè§£å†³ï¼Œå¦‚æ˜¯å…¶ä»–åŒç†ç½‘ä¸Šæœä¸€ä¸‹</p><pre><code>npm install   hexo-reading-time --save</code></pre><p>(3)ä½¿ç”¨ä¸»é¢˜çš„æ—¶å€™æ³¨æ„å…ˆé˜…è¯»ç›¸å…³ä½¿ç”¨æ–‡æ¡£ï¼Œæœ‰äº›ä¸»é¢˜éœ€è¦ä¸€äº›æ’ä»¶</p><h5 id="3-å…¶ä»–"><a href="#3-å…¶ä»–" class="headerlink" title="3. å…¶ä»–"></a>3. å…¶ä»–</h5><p>åç»­è¡¥å……</p><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a><br><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a><br><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a><br><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a><br><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a><br><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a><br><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a><br><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a><br><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a><br><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a><br><a href="a53a9069.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</title>
      <link href="/posts/cda13ebe.html"/>
      <url>/posts/cda13ebe.html</url>
      
        <content type="html"><![CDATA[<p>Hexoé™æ€åšå®¢æ’ä»¶å®‰è£…ç›¸å…³å†…å®¹ï¼Œæœ¬æ–‡ä»¥å®‰è£…searchå’Œabbrlinkæ’ä»¶ä¸ºä¾‹ã€‚</p><a id="more"></a><p>æ³¨æ„ï¼šå®‰è£…æ’ä»¶ä¸æ˜¯éå¿…é¡»ï¼Œé™¤äº†éƒ¨åˆ†æ’ä»¶è·Ÿç€ä¸»é¢˜å¿…é¡»å®‰è£…ä¹‹å¤–ï¼Œå…¶ä»–æ’ä»¶å±äºå¯é€‰ã€‚</p><h2 id="å®‰è£…æ’ä»¶å‘½ä»¤"><a href="#å®‰è£…æ’ä»¶å‘½ä»¤" class="headerlink" title="å®‰è£…æ’ä»¶å‘½ä»¤"></a>å®‰è£…æ’ä»¶å‘½ä»¤</h2><pre><code>npm install   hexo-generator-feed  --save   #è®¢é˜…npm install   hexo-generator-search --save  #æœç´¢</code></pre><h2 id="æœ¬åœ°æœç´¢æ’ä»¶"><a href="#æœ¬åœ°æœç´¢æ’ä»¶" class="headerlink" title="æœ¬åœ°æœç´¢æ’ä»¶"></a>æœ¬åœ°æœç´¢æ’ä»¶</h2><p>è¿™é‡Œè¯´ä¸€ä¸‹æ·»åŠ æœ¬åœ°æœç´¢ï¼Œæœ‰çš„ä¸»é¢˜å·²ç»è‡ªå·±å¸¦äº†æœç´¢åŠŸèƒ½ï¼Œåªè¦é…ç½®å¼€å¯å³å¯ã€‚å¦‚æœæ²¡æœ‰å¸¦ä¸»é¢˜å¯ä»¥è‡ªå·±åŠ ä¸Šã€‚<br><font color=red>ç‰¹åˆ«è¯´æ˜ï¼šå¦‚æœä¸»é¢˜è‡ªå¸¦æœç´¢ï¼Œçœ‹è‡ªå¸¦æœç´¢æ“ä½œè¯´æ˜å³å¯ï¼Œå¦‚æœä¸»é¢˜æ— æœç´¢çœ‹è‡ªå®šä¹‰æ¨¡å¼è¯´æ˜å³å¯ã€‚</font></p><h3 id="æ­¥éª¤ä¸€-å®‰è£…æ’ä»¶"><a href="#æ­¥éª¤ä¸€-å®‰è£…æ’ä»¶" class="headerlink" title="æ­¥éª¤ä¸€ å®‰è£…æ’ä»¶"></a>æ­¥éª¤ä¸€ å®‰è£…æ’ä»¶</h3><p>ç¬¬ä¸€æ­¥ï¼šå®‰è£…æœç´¢æ’ä»¶ <code>npm install hexo-generator-searchdb --save</code></p><h3 id="æ­¥éª¤äºŒ-ä¿®æ”¹é…ç½®"><a href="#æ­¥éª¤äºŒ-ä¿®æ”¹é…ç½®" class="headerlink" title="æ­¥éª¤äºŒ ä¿®æ”¹é…ç½®"></a>æ­¥éª¤äºŒ ä¿®æ”¹é…ç½®</h3><p>ç¬¬äºŒæ­¥ï¼šæ ¹ç›®å½•_config.ymlæ–‡ä»¶é…ç½®æ·»åŠ </p><pre><code>search:  path: search.xml  field: post  format: html  limit: 10000</code></pre><p>ä¸»é¢˜é…ç½®_config.ymlæ·»åŠ </p><pre><code>local_search:   enable: true</code></pre><h3 id="æ­¥éª¤ä¸‰-æ·»åŠ æœç´¢"><a href="#æ­¥éª¤ä¸‰-æ·»åŠ æœç´¢" class="headerlink" title="æ­¥éª¤ä¸‰ æ·»åŠ æœç´¢"></a>æ­¥éª¤ä¸‰ æ·»åŠ æœç´¢</h3><p>ç¬¬ä¸‰æ­¥:æ·»åŠ æœç´¢æ¡†</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search-content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pure-form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>local-search-input<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">results</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>æœç´¢<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pure-input pure-input-1<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">204</span>, <span class="token number">232</span>, <span class="token number">207</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>local-search-result<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>ç¬¬1ç§ï¼Œä¸»é¢˜è‡ªå¸¦æœç´¢æ¨¡å¼ï¼Œæœ‰ç‹¬ç«‹çš„searché¡µé¢,ç”Ÿæˆé¡µé¢å‰é¢å·²ç»è®²åˆ°äº†ï¼ŒæŠŠä»£ç æ”¾åˆ°source/search/index.mdæ–‡ä»¶ä¸­å³å¯ã€‚</p><p>ç¬¬2ç§ï¼Œè‡ªå®šä¹‰æ¨¡å¼ï¼Œç›´æ¥åŠ åœ¨é¦–é¡µï¼Œæƒ³åŠ å“ªä¸ªä½ç½®çœ‹è‡ªå·±å–œå¥½ï¼Œä½ç½®æ‰¾ä¸»é¢˜ä¸‹çš„å¸ƒå±€æ–‡ä»¶å¤¹_layoutæˆ–layout/partialsä¹‹ç±»çš„æ–‡ä»¶å¤¹ä¸‹,é‡Œé¢æœ‰head.ejsæˆ–head.swigæ–‡ä»¶ï¼ˆå¦‚æœä¸æ˜¯è¯·è‡ªå·±æŸ¥æ‰¾èŠ‚ç‚¹ï¼Œæ–‡ä»¶åæ­£å°±é‚£äº›ï¼‰,æ·»åŠ htmlä»£ç </p><h3 id="æ­¥éª¤å››-å¼•å…¥jsæ–‡ä»¶"><a href="#æ­¥éª¤å››-å¼•å…¥jsæ–‡ä»¶" class="headerlink" title="æ­¥éª¤å›› å¼•å…¥jsæ–‡ä»¶"></a>æ­¥éª¤å›› å¼•å…¥jsæ–‡ä»¶</h3><p>ç¬¬å››æ­¥ï¼šå¼•å…¥js</p><p>ç¬¬1ç§ï¼Œä¸»é¢˜è‡ªå¸¦æœç´¢æ¨¡å¼ï¼Œä¸»é¢˜ä¸‹çš„é…ç½®æ–‡ä»¶ä¸€èˆ¬æœ‰scriptsè®¾ç½®ï¼Œç›´æ¥é…ç½®è·¯å¾„ï¼Œä¸€èˆ¬éƒ½æœ‰ç¤ºä¾‹å¦‚</p><pre><code>scripts:#- //cdn.bootcss.com/zepto/1.2.0/zepto.min.js#- /js/xoxo.js  - /js/search.js</code></pre><p>ç¬¬2ç§ï¼Œè‡ªå®šä¹‰æ¨¡å¼ï¼Œæ²¡æœ‰scriptsé…ç½®,å°±åœ¨æ‰¾ä¸»é¢˜ä¸‹çš„å¸ƒå±€æ–‡ä»¶å¤¹_layoutæˆ–layout/ä¸­ï¼Œæœ‰js.ejsæˆ–srcipt.ejsï¼Œ<br>æ–‡ä»¶å¯ä»¥ä»è¿™é‡Œæ‹¿ï¼š<a href="https://github.com/zhzy2017/hexo-search-plugin-snippets" target="_blank" rel="noopener">https://github.com/zhzy2017/hexo-search-plugin-snippets</a><br>æŠŠsearch.js æ”¾åˆ°source\jsç›®å½•ä¸‹,å¼•å…¥ä½¿ç”¨ä¹Ÿæœ‰ä¸åŒçš„æ–¹æ³•</p><h3 id="æ­¥éª¤äº”-å¼•å…¥cssæ–‡ä»¶"><a href="#æ­¥éª¤äº”-å¼•å…¥cssæ–‡ä»¶" class="headerlink" title="æ­¥éª¤äº” å¼•å…¥cssæ–‡ä»¶"></a>æ­¥éª¤äº” å¼•å…¥cssæ–‡ä»¶</h3><p>ç¬¬äº”æ­¥ï¼šcssè®¾ç½®<br>æœ‰çš„å¸¦æœç´¢çš„æ— é¡»æ“ä½œï¼Œæ²¡æœ‰çš„ä»ä¸‹è½½hexo-search-plugin-snippetsé‡Œé¢æ‹¿æ‹·è´åˆ°source/cssé‡Œé¢ï¼Œå¼•å…¥å³å¯ï¼Œ</p><p>ç¬¬1ç§ï¼Œä¸»é¢˜è‡ªå¸¦æœç´¢æ¨¡å¼ï¼Œä¸€èˆ¬ä¸éœ€è¦é…ç½®å†™åœ¨å…¬å…±æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ ·å¼å¯ä»¥åœ¨ä¸»é¢˜ä¸‹çš„é…ç½®æ–‡ä»¶ä¸€èˆ¬æœ‰stylesheetsè®¾ç½®ï¼Œç›´æ¥é…ç½®è·¯å¾„ï¼Œä¸€èˆ¬éƒ½æœ‰ç¤ºä¾‹ï¼š</p><pre><code>stylesheets:# - /css/normalize.css - //cdn.bootcss.com/pure/1.0.0/pure-min.css - /css/xoxo.css</code></pre><p>ç¬¬2ç§ï¼Œè‡ªå®šä¹‰æ¨¡å¼ï¼Œè·Ÿé…å¼•å…¥jsç±»ä¼¼ï¼Œæ‰¾ä¸€ä¸‹ä¸»é¢˜ç›®å½•ejsæˆ–swigæ–‡ä»¶å¼•å…¥ï¼Œæˆ–è€…ç›´æ¥ç”¨cssæˆ–lessæ–‡ä»¶æ”¾åˆ°source/cssç›®å½•ä¸‹çš„æŸä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™æ ·ä¸éœ€è¦å¼•æ–‡ä»¶</p><p>å…¶ä»–æ’ä»¶ï¼Œå…·ä½“ä½¿ç”¨è‡ªè¡Œæœç´¢ï¼Œä¸€èˆ¬æ˜¯ä¿®æ”¹é…ç½®æˆ–æ·»åŠ ä»£ç </p><pre><code>npm install hexo-generator-index-pin-top â€“save  #æ–‡ç« ç½®é¡¶æ’ä»¶ npm uninstall hexo-generator-index â€“save     #æ–‡ç« ç½®é¡¶æ’ä»¶ npm i â€“save hexo-wordcount        #æ–‡ç« å­—æ•°+é˜…è¯»æ—¶é•¿ç»Ÿè®¡     npm install hexo-baidu-url-submit â€“save     #ç™¾åº¦é“¾æ¥ä¸»åŠ¨æ¨é€     npm install hexo-deployer-ftpsync â€“save     #hexoä¸Šä¼ è‡³FTPæœåŠ¡å™¨     npm install hexo-deployer-cos â€“save     #hexoä¸Šä¼ è‡³è…¾è®¯äº‘COS     npm install hexo-deployer-aliyun â€“save     #hexoä¸Šä¼ è‡³é˜¿é‡Œäº‘     npm install â€“save hexo-admin     #hexoç®¡ç†æ’ä»¶     hexo-blog-encrypt(è¯·çœ‹æ–‡æ¡£)     #hexoæ–‡ç« åŠ å¯†ç  npm install leancloud-storage â€“save     #Valineè¯„è®º     Valineè¯„è®ºé‚®ä»¶é€šçŸ¥     Valineè¯„è®ºæé†’ npm install hexo-deployer-git â€“save hexoå®‰è£…gitï¼ˆå…è®¸ä½¿ç”¨gitå‘½ä»¤ï¼‰</code></pre><p>æ›´å¤šæ’ä»¶è¯·è®¿é—®æ’ä»¶ä¸­å¿ƒï¼š<a href="https://hexo.io/plugins/" target="_blank" rel="noopener">https://hexo.io/plugins/</a><br>ä½¿ç”¨å‚è€ƒé“¾æ¥å‚è€ƒ<a href="https://blog.csdn.net/q2158798/article/details/82354154" target="_blank" rel="noopener">å¹»å‡¡ss</a></p><h3 id="ä¿®æ”¹ä¿®æ”¹æ°¸ä¹…é“¾æ¥"><a href="#ä¿®æ”¹ä¿®æ”¹æ°¸ä¹…é“¾æ¥" class="headerlink" title="ä¿®æ”¹ä¿®æ”¹æ°¸ä¹…é“¾æ¥"></a>ä¿®æ”¹ä¿®æ”¹æ°¸ä¹…é“¾æ¥</h3><p>Hexoä¿®æ”¹ä¿®æ”¹æ°¸ä¹…é“¾æ¥çš„é»˜è®¤æ ¼å¼,æ–¹ä¾¿SEO.<br><code>npm install hexo-abbrlink --save</code>  #æ–‡ç« æ°¸ä¹…é“¾æ¥ <a href="https://github.com/Rozbo/hexo-abbrlink" target="_blank" rel="noopener">é¡¹ç›®åœ°å€åœ¨è¿™é‡Œ</a></p><h4 id="1-å®‰è£…æ’ä»¶"><a href="#1-å®‰è£…æ’ä»¶" class="headerlink" title="1.å®‰è£…æ’ä»¶"></a>1.å®‰è£…æ’ä»¶</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-abbrlink --save</code></pre><h4 id="2-ä¿®æ”¹é…ç½®"><a href="#2-ä¿®æ”¹é…ç½®" class="headerlink" title="2.ä¿®æ”¹é…ç½®"></a>2.ä¿®æ”¹é…ç½®</h4><pre><code># permalink: :year/:month/:day/:title/# permalink_defaults:permalink: posts/:abbrlink.htmlabbrlink:  alg: crc32  # ç®—æ³•ï¼šcrc16(default) and crc32  rep: hex    # è¿›åˆ¶ï¼šdec(default) and hex</code></pre><h4 id="3-é‡å¯"><a href="#3-é‡å¯" class="headerlink" title="3.é‡å¯"></a>3.é‡å¯</h4><pre class=" language-bash"><code class="language-bash">hexo clean <span class="token operator">&amp;</span> heox g <span class="token operator">&amp;</span> hexo s</code></pre><p>ç‚¹å‡»ä¸€ç¯‡æ–‡ç« ï¼Œæ£€æŸ¥æµè§ˆå™¨åœ°å€çœ‹çœ‹æ˜¯ä¸æ˜¯å‘ç”Ÿå˜åŒ–äº†ï¼Ÿ</p><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a><br><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a><br><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a><br><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a><br><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a><br><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a><br><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a><br><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a><br><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a><br><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a><br><a href="a53a9069.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</title>
      <link href="/posts/a5bf7e18.html"/>
      <url>/posts/a5bf7e18.html</url>
      
        <content type="html"><![CDATA[<p>Hexoé™æ€åšå®¢å·²ç»æ­å»ºå¥½äº†ï¼Œé“¾æ¥é¡µé¢æœ‰äº†ï¼Œä¸»é¢˜ä¸å¥½çœ‹æ€ä¹ˆæ¢å‘¢ï¼Ÿæœ¬æ–‡è®°å½•ä¸»é¢˜æ›´æ¢ç›¸å…³å†…å®¹ã€‚</p> <a id="more"></a><p>é€‰æ‹©ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„ Hexo ä¸»é¢˜ç«™ï¼š<a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a><br>æç®€ä¸»é¢˜æ¨èï¼š<br><a href="https://github.com/small-rose/hexo-theme-polarbear.git" target="_blank" rel="noopener">hexo-theme-polarbear</a></p><p><a href="https://github.com/small-rose/gd4Ark.github.io.git" target="_blank" rel="noopener">hexo-theme-polarbear  ï¼ˆgd4Arkçš„æ‰©å±•ç‰ˆï¼‰</a> ï¼ˆä¸‹è½½åæ‰§è¡Œå®‰è£…npm installï¼‰</p><p><a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank" rel="noopener">hexo-theme-ayer</a></p><p><a href="https://github.com/small-rose/hexo-theme-sky.git" target="_blank" rel="noopener">hexo-theme-sky</a></p><p><a href="https://github.com/small-rose/hexo-theme-xoxo.git" target="_blank" rel="noopener">hexo-theme-xoxo</a></p><p><a href="https://github.com/small-rose/hexo-theme-xoxo-plus.git" target="_blank" rel="noopener">hexo-theme-xoxo-plus</a></p><p>æ¼‚äº®ä¸»é¢˜æ¨èï¼š</p><p><a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank" rel="noopener">hexo-theme-matery</a> </p><p><a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="noopener">hexo-theme-fluid </a>  | <a href="https://github.com/small-rose/hexo-theme-fluid" target="_blank" rel="noopener">butterflyä¸»é¢˜æ–‡æ¡£</a></p><p><a href="https://github.com/small-rose/hexo-theme-butterfly" target="_blank" rel="noopener">hexo-theme-butterfly</a> | <a href="https://demo.jerryc.me/posts/21cfbf15/" target="_blank" rel="noopener">butterflyä¸»é¢˜æ–‡æ¡£</a></p><p><a href="https://github.com/small-rose/hexo-theme-sakura" target="_blank" rel="noopener">hexo-theme-sakura</a> | <a href="https://docs.hojun.cn/sakura/docs/#/" target="_blank" rel="noopener">sakuraä¸»é¢˜æ–‡æ¡£</a></p><p>å…¶ä¸­æç®€ä¸»é¢˜æœ‰äº›æ²¡æœ‰searchåŠŸèƒ½ï¼Œå¦‚éœ€è¦è‡ªå·±å®‰è£…searchæ’ä»¶ï¼Œå‚è€ƒHexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…<br>æç®€ä¸»é¢˜ä¸­æœ€å¼€å§‹æ¯”è¾ƒå–œæ¬¢ hexo-theme-polarbearï¼Œå¯¹æ‰©å±•ç‰ˆè¿›è¡Œè¡¥å……æœç´¢åŠŸèƒ½ï¼Œé¡ºä¾¿å­¦ä¹ ä¸€äº›<code>hexo</code>è‡ªå®šä¹‰æ’ä»¶å®‰è£…çš„ä¸œè¥¿ã€‚</p><p>æ¼‚äº®ä¸»é¢˜ï¼Œç°åœ¨ä½¿ç”¨çš„æ˜¯ hexo-theme-matery å¦‚æœä½ å–œæ¬¢ï¼Œæœ¬æ–‡åº•éƒ¨è¿˜æœ‰ä¸€äº›ç›¸å…³æ–‡ç« ï¼Œå¦‚æœèƒ½å¸®ä½ è§£å†³é—®é¢˜å°±å¥½äº†ï¼Œæ›´å¤šé—®é¢˜å¯ä»¥åˆ°ç¾¤é‡Œ<code>ï¼ˆ971887688ï¼‰</code>æé—®ï¼Œæˆ–è€…è”ç³»æˆ‘ã€‚</p><p>å¦‚å®‰è£…ä¸»é¢˜hexo-theme-xoxo-matery,</p><h4 id="1-ä¸‹è½½ä¸»é¢˜"><a href="#1-ä¸‹è½½ä¸»é¢˜" class="headerlink" title="1.ä¸‹è½½ä¸»é¢˜"></a>1.ä¸‹è½½ä¸»é¢˜</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> themes<span class="token function">git</span> clone https://github.com/small-rose/hexo-theme-matery.git</code></pre><h4 id="2-ä¿®æ”¹é…ç½®"><a href="#2-ä¿®æ”¹é…ç½®" class="headerlink" title="2.ä¿®æ”¹é…ç½®"></a>2.ä¿®æ”¹é…ç½®</h4><p>ä¿®æ”¹å…¨å±€é…ç½®æ ¹ç›®å½•_config.yml, æ³¨æ„themeçš„å€¼è¦å’Œthemeç›®å½•çš„ä¸»é¢˜çš„æ–‡ä»¶å¤¹åå­—ä¸€è‡´</p><pre><code># Extensions## Plugins: https://hexo.io/plugins/## Themes: https://hexo.io/themes/# landscapetheme: hexo-theme-matery</code></pre><h4 id="3-å¯åŠ¨é¢„è§ˆ"><a href="#3-å¯åŠ¨é¢„è§ˆ" class="headerlink" title="3.å¯åŠ¨é¢„è§ˆ"></a>3.å¯åŠ¨é¢„è§ˆ</h4><pre class=" language-bash"><code class="language-bash">hexo g <span class="token operator">&amp;</span> hexo s</code></pre><p>æµè§ˆå™¨è®¿é—®ï¼š<br>å¤§åŠŸå‘Šæˆã€‚</p><p>å¦‚æœå¯¹è¯¥ä¸»é¢˜çš„å…¶ä»–è®¾ç½®è¯·å‚è€ƒä¸»é¢˜ç”¨æ³•ï¼Œåˆ°ä¸»é¢˜ç›®å½•ä¸‹ä¿®æ”¹ä¸»é¢˜çš„é…ç½®æ–‡ä»¶_config.yml</p><p>å¦‚æœ‰é—®é¢˜è¯·å‚è€ƒæœ¬ç³»åˆ—ï¼š<a href="/post/ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a></p><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a><br><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a><br><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a><br><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a><br><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a><br><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a><br><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a><br><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a><br><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a><br><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a><br><a href="a53a9069.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</title>
      <link href="/posts/c1358fc8.html"/>
      <url>/posts/c1358fc8.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•å°†hexoåšå®¢åˆ›å»ºé¡µé¢ç›¸å…³æ“ä½œæ“ä½œã€‚</p><a id="more"></a><p>ä½œè€…ï¼šé˜¿å…°é‚£</p><h2 id="1-åˆ›å»ºé“¾æ¥é¡µé¢çš„åŸºæœ¬å‘½ä»¤"><a href="#1-åˆ›å»ºé“¾æ¥é¡µé¢çš„åŸºæœ¬å‘½ä»¤" class="headerlink" title="1.åˆ›å»ºé“¾æ¥é¡µé¢çš„åŸºæœ¬å‘½ä»¤"></a>1.åˆ›å»ºé“¾æ¥é¡µé¢çš„åŸºæœ¬å‘½ä»¤</h2><font color=red>```hexo new page  yourpagename```</font><h4 id="2-åˆ›å»ºabouté¡µé¢"><a href="#2-åˆ›å»ºabouté¡µé¢" class="headerlink" title="2.åˆ›å»ºabouté¡µé¢"></a>2.åˆ›å»ºabouté¡µé¢</h4><pre><code>hexo new page about</code></pre><p>ä¿®æ”¹source/about/index.mdæ–‡ä»¶å³å¯ã€‚æ–‡ä»¶å†…å¯ä»¥ä½¿ç”¨markdownæˆ–htmlè¯­æ³•ã€‚</p><h4 id="3-åˆ›å»ºåˆ†ç±»"><a href="#3-åˆ›å»ºåˆ†ç±»" class="headerlink" title="3.åˆ›å»ºåˆ†ç±»"></a>3.åˆ›å»ºåˆ†ç±»</h4><pre><code>hexo new page categories   //åˆ›å»ºåˆ†ç±»</code></pre><p>ä¿®æ”¹source/categories/index.mdæ–‡ä»¶å³å¯.<br>è¡¥å……çº¢è‰²å­—ä½“å†…å®¹ï¼š <font color=red><code>type: &quot;categories&quot;</code></font></p><pre><code>---title: categoriesdate: 2020-05-14 21:51:42type: categories---</code></pre><p>é‚£ä¹ˆåœ¨å†™æ–‡ç« çš„æ—¶å€™å°±å¯ä»¥åœ¨å¤´éƒ¨ä½¿ç”¨åˆ†ç±»äº†ï¼Œå¦‚ï¼š</p><pre><code>---title: Hexoæ­å»ºé™æ€åšå®¢åŠè¸©å‘é—®é¢˜date: 2020-05-13categories: Hexo--- this is my article ...</code></pre><h4 id="4-åˆ›å»ºæ ‡ç­¾"><a href="#4-åˆ›å»ºæ ‡ç­¾" class="headerlink" title="4.åˆ›å»ºæ ‡ç­¾"></a>4.åˆ›å»ºæ ‡ç­¾</h4><pre><code>hexo new page tags         //åˆ›å»ºæ ‡ç­¾</code></pre><p>ä¿®æ”¹source/tags/index.mdæ–‡ä»¶å³å¯:<br>è¡¥å……çº¢è‰²å­—ä½“å†…å®¹ï¼š <font color=red><code>type: &quot;tags&quot;</code></font></p><pre><code>---title: tagsdate: 2020-05-14 21:51:42type: tags---</code></pre><p>é‚£ä¹ˆåœ¨å†™æ–‡ç« çš„æ—¶å€™å°±å¯ä»¥åœ¨å¤´éƒ¨ä½¿ç”¨æ ‡ç­¾äº†ï¼Œå¦‚ï¼š</p><pre><code>---title: Hexoæ­å»ºé™æ€åšå®¢åŠè¸©å‘é—®é¢˜date: 2020-05-13categories: Hexotags: Hexo--- this is my article ...</code></pre><p>æ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢ï¼Ÿ</p><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a><br><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a><br><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a><br><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a><br><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a><br><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a><br><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a><br><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a><br><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a><br><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a><br><a href="a53a9069.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</title>
      <link href="/posts/9f117b.html"/>
      <url>/posts/9f117b.html</url>
      
        <content type="html"><![CDATA[<p> åŸæ¥ä½¿ç”¨springbootè‡ªå·±æ£é¼“çš„åšå®¢ï¼Œæ€»æ˜¯ä¸å¤Ÿæ»¡æ„ï¼Œå°±æƒ³ç€å®åœ¨ä¸è¡Œæä¸ªé™æ€åšå®¢ï¼Œæ¯”è¾ƒå†ä¸‰é€‰æ‹©hexo,å°±ç”¨Hexoå†æ£é¼“ä¸€ä¸ªé™æ€åšå®¢ï¼ŒæŠ˜è…¾äº†å‡ å¤©ä¹Ÿç®—æœ‰æˆæœäº†ã€‚</p><a id="more"></a><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p>æœ¬æ–‡ç¯å¢ƒå¦‚ä¸‹</p><pre><code>$ hexo -vhexoï¼š4.2.1hexo-cliï¼š3.1.0osï¼šWindows_NT 10.0.18362 win32 x64http_parserï¼š2.8.0nodeï¼š8.12.0v8ï¼š6.2.414.66uvï¼š1.19.2zlibï¼š1.2.11aresï¼š1.10.1-DEVmodulesï¼š57nghttp2ï¼š1.32.0napiï¼š 3opensslï¼š1.0.2picuï¼š60.1unicodeï¼š10.0cldrï¼š32.0tzï¼š2017c</code></pre><h4 id="1-å®‰è£…gitç¯å¢ƒ"><a href="#1-å®‰è£…gitç¯å¢ƒ" class="headerlink" title="1.å®‰è£…gitç¯å¢ƒ"></a>1.å®‰è£…gitç¯å¢ƒ</h4><p>å®‰è£…git for windowsï¼ˆæˆ–è€…å…¶å®ƒgitå®¢æˆ·ç«¯ï¼‰[gitä¸‹è½½]ï¼ˆ<a href="https://git-scm.com/downloadsï¼‰" target="_blank" rel="noopener">https://git-scm.com/downloadsï¼‰</a><br>éªŒè¯gitå®‰è£…å‘½ä»¤(å¯ä»¥ç”¨Windowsçš„cmdçª—å£æˆ–é¼ æ ‡å³é”®èœå•çš„git bash çª—å£)</p><pre class=" language-bash"><code class="language-bash"><span class="token function">git</span> --version</code></pre><h4 id="2-å®‰è£…Node"><a href="#2-å®‰è£…Node" class="headerlink" title="2.å®‰è£…Node"></a>2.å®‰è£…Node</h4><p>å®‰è£…Node<a href="http://nodejs.cn/" target="_blank" rel="noopener">Nodeä¸‹è½½</a><br>éªŒè¯nodeå®‰è£…å‘½ä»¤ (å¯ä»¥ç”¨Windowsçš„cmdçª—å£æˆ–é¼ æ ‡å³é”®èœå•çš„git bash çª—å£)</p><pre class=" language-bash"><code class="language-bash">node --version</code></pre><h4 id="3-githubè´¦å·"><a href="#3-githubè´¦å·" class="headerlink" title="3.githubè´¦å·"></a>3.githubè´¦å·</h4><p>å¦‚æœæ²¡æœ‰æ³¨å†Œä¸€ä¸ªï¼š<a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a><br>ä¸»è¦æ˜¯æ–¹ä¾¿ä»gitä¸Šä¸‹è½½å„ç§ä¸œä¸œã€‚</p><h3 id="å®‰è£…hexoåŠåˆå§‹åŒ–"><a href="#å®‰è£…hexoåŠåˆå§‹åŒ–" class="headerlink" title="å®‰è£…hexoåŠåˆå§‹åŒ–"></a>å®‰è£…hexoåŠåˆå§‹åŒ–</h3><pre class=" language-bash"><code class="language-bash">$ <span class="token function">cd</span> D:hexo/    //æ¢æˆä½ çš„ç›®å½•$ <span class="token function">npm</span> <span class="token function">install</span> -g hexo-cli   //å®‰è£…hexoè„šæ‰‹æ¶$ hexo init     //Hexo åˆå§‹åŒ– ä¼šè‡ªåŠ¨åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ä¸‹è½½æ­å»ºç½‘ç«™æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶$ <span class="token function">npm</span> <span class="token function">install</span>   //å®‰è£…ä¾èµ–åŒ…å‘½ä»¤</code></pre><h3 id="ç¼–è¯‘ç”Ÿæˆé™æ€é¡µé¢"><a href="#ç¼–è¯‘ç”Ÿæˆé™æ€é¡µé¢" class="headerlink" title="ç¼–è¯‘ç”Ÿæˆé™æ€é¡µé¢"></a>ç¼–è¯‘ç”Ÿæˆé™æ€é¡µé¢</h3><pre class=" language-bash"><code class="language-bash">hexo g</code></pre><h3 id="å¯åŠ¨æœåŠ¡é¢„è§ˆ"><a href="#å¯åŠ¨æœåŠ¡é¢„è§ˆ" class="headerlink" title="å¯åŠ¨æœåŠ¡é¢„è§ˆ"></a>å¯åŠ¨æœåŠ¡é¢„è§ˆ</h3><pre class=" language-bash"><code class="language-bash">hexo s</code></pre><p>æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a><br>å¦‚æœæ­£å¸¸å‡ºç°é¡µé¢è¯´æ˜æ­å»ºæˆåŠŸã€‚</p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><pre class=" language-bash"><code class="language-bash">hexo clean      //æ¸…ç©ºpublicæ–‡ä»¶å¤¹å†…å®¹hexo g æˆ–  hexo generate   //åœ¨hexoç«™ç‚¹æ ¹ç›®å½•ä¸‹ç”Ÿæˆpublicæ–‡ä»¶å¤¹ï¼Œç›¸å…³é™æ€ç½‘é¡µæ–‡ä»¶hexo s æˆ–  hexo server     //å¯åŠ¨æœåŠ¡é¢„è§ˆ http://localhost:4000hexo d æˆ–  hexo deploy     //éƒ¨ç½²ç«™ç‚¹ï¼Œåœ¨æœ¬åœ°ç”Ÿæˆ.deploy_gitæ–‡ä»¶å¤¹ï¼Œå¹¶å°†ç¼–è¯‘åçš„æ–‡ä»¶ä¸Šä¼ è‡³ Gitè¿œç¨‹ä»“åº“ï¼Œå¦‚githubæˆ–è‡ªå·±æ­å»ºçš„è¿œç¨‹æœåŠ¡å™¨ã€‚</code></pre><p>ä¹Ÿå¯ä»¥è¿èµ·æ¥ä½¿ç”¨ï¼š<font face="console" color="red" bgcolor='#fff'><code>hexo clean &amp; hexo g &amp; hexo s &amp;  hexo d</code></font></p><p>å¦‚æœ‰é—®é¢˜è¯·å‚è€ƒæœ¬ç³»åˆ—ï¼šHexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</p><br/><p><strong>ç›¸å…³æ–‡ç« </strong></p><p><a href="9f117b.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€æ­å»º</a><br><a href="c1358fc8.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäºŒï¼‰â€”â€”åˆ›å»ºé¡µé¢</a><br><a href="a5bf7e18.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸‰ï¼‰â€”â€”ä¸»é¢˜æ›´æ¢</a><br><a href="cda13ebe.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå››ï¼‰â€”â€”æ’ä»¶å®‰è£…</a><br><a href="ce4a93ff.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆäº”ï¼‰â€”â€”è¸©å‘é—®é¢˜</a><br><a href="c68d7a69.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆå…­ï¼‰â€”â€”é¡¹ç›®éƒ¨ç½²</a><br><a href="1c633c7e.html">Hexoæ­å»ºé™æ€åšå®¢ï¼ˆä¸ƒï¼‰â€”â€”å®¢æœä¸æ¨é€</a><br><a href="caf66d5e.html">Hexoæ·»åŠ Live2DäºŒæ¬¡å…ƒè€å©†</a><br><a href="358175a6.html">Hexoåšå®¢Valine-Adminè¸©å‘è®°å½•</a><br><a href="40099453.html">Hexoåšå®¢Materyä¸»é¢˜valineå‡çº§ä¸ä¼˜åŒ–</a><br><a href="a53a9069.html">Hexoåšå®¢Materyä¸»é¢˜æ–°æ‰‹å¸¸è§é—®é¢˜</a></p><br/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jsè®©é¡µé¢è‡ªåŠ¨åˆ·æ–°</title>
      <link href="/posts/7413f2ca.html"/>
      <url>/posts/7413f2ca.html</url>
      
        <content type="html"><![CDATA[<p>jsè®©é¡µé¢è‡ªåŠ¨åˆ·æ–°</p><a id="more"></a><h6 id="æƒ³è®©é¡µé¢è‡ªåŠ¨åˆ·æ–°"><a href="#æƒ³è®©é¡µé¢è‡ªåŠ¨åˆ·æ–°" class="headerlink" title="æƒ³è®©é¡µé¢è‡ªåŠ¨åˆ·æ–°?"></a>æƒ³è®©é¡µé¢è‡ªåŠ¨åˆ·æ–°?</h6><p>F12 â€”â€“ æ§åˆ¶å° â€”â€“ ä½¿ç”¨ä¸‹é¢ä»£ç ï¼ŒOKã€‚</p><pre class=" language-javascript"><code class="language-javascript">timeout<span class="token operator">=</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"Set timeout (Second):"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>count<span class="token operator">=</span><span class="token number">0</span>current<span class="token operator">=</span>location<span class="token punctuation">.</span>href<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>timeout<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">'reload()'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token operator">*</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span>location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">'reload()'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token operator">*</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>count<span class="token operator">++</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ¯ï¼ˆ'</span><span class="token operator">+</span>timeout<span class="token operator">+</span><span class="token string">'ï¼‰ç§’è‡ªåŠ¨åˆ·æ–°,åˆ·æ–°æ¬¡æ•°ï¼š'</span><span class="token operator">+</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>fr4me<span class="token operator">=</span><span class="token string">'&lt;frameset cols=\'*\'>\n&lt;frame src=\''</span><span class="token operator">+</span>current<span class="token operator">+</span><span class="token string">'\'/>'</span><span class="token punctuation">;</span>fr4me<span class="token operator">+</span><span class="token operator">=</span><span class="token string">'&lt;/frameset>'</span><span class="token punctuation">;</span><span class="token keyword">with</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">write</span><span class="token punctuation">(</span>fr4me<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å·¥å…·ç±»å¸¸ç”¨çš„ç½‘ç«™</title>
      <link href="/posts/2ae4d0b0.html"/>
      <url>/posts/2ae4d0b0.html</url>
      
        <content type="html"><![CDATA[<h4 id="APIåœ¨çº¿"><a href="#APIåœ¨çº¿" class="headerlink" title="APIåœ¨çº¿"></a>APIåœ¨çº¿</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>å¸¸ç”¨APIæ–‡æ¡£ç´¢å¼•</td><td><a href="https://tool.oschina.net/apidocs" target="_blank" rel="noopener">https://tool.oschina.net/apidocs</a></td></tr><tr><td>java8 API</td><td><a href="https://www.matools.com/api/java8" target="_blank" rel="noopener">https://www.matools.com/api/java8</a></td></tr><tr><td>Mybatis java API</td><td>h<a href="https://mybatis.org/mybatis-3/zh/java-api.html" target="_blank" rel="noopener">https://mybatis.org/mybatis-3/zh/java-api.html</a></td></tr><tr><td>dubbo API</td><td><a href="http://dubbo.apache.org/zh-cn/docs/user/configuration/api.html" target="_blank" rel="noopener">http://dubbo.apache.org/zh-cn/docs/user/configuration/api.html</a></td></tr></tbody></table><h4 id="å¼€æºç½‘ç«™"><a href="#å¼€æºç½‘ç«™" class="headerlink" title="å¼€æºç½‘ç«™"></a>å¼€æºç½‘ç«™</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>githubç½‘ç«™</td><td><a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a></td></tr><tr><td>ç äº‘</td><td><a href="https://gitee.com/" target="_blank" rel="noopener">https://gitee.com/</a></td></tr><tr><td>ä¸€èµ·å¼€æºå®˜ç½‘</td><td><a href="http://www.17ky.net/" target="_blank" rel="noopener">http://www.17ky.net/</a></td></tr><tr><td>Open JDK</td><td><a href="http://openjdk.java.net/" target="_blank" rel="noopener">http://openjdk.java.net/</a></td></tr><tr><td>Open JDK  HotSpot</td><td><a href="https://wiki.openjdk.java.net/display/HotSpot/Main" target="_blank" rel="noopener">https://wiki.openjdk.java.net/display/HotSpot/Main</a></td></tr></tbody></table><h4 id="å¼€å‘ç›¸å…³"><a href="#å¼€å‘ç›¸å…³" class="headerlink" title="å¼€å‘ç›¸å…³"></a>å¼€å‘ç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>ORICLEå®˜ç½‘</td><td><a href="https://www.oracle.com/downloads/" target="_blank" rel="noopener">https://www.oracle.com/downloads/</a></td></tr><tr><td>JAVAå®˜ç½‘</td><td><a href="https://www.oracle.com/java/technologies/javase-downloads.html" target="_blank" rel="noopener">https://www.oracle.com/java/technologies/javase-downloads.html</a></td></tr><tr><td>ECLIPSEå®˜ç½‘</td><td><a href="https://www.eclipse.org/downloads/" target="_blank" rel="noopener">https://www.eclipse.org/downloads/</a></td></tr><tr><td>IntelliJ IDEA</td><td><a href="http://www.jetbrains.com/" target="_blank" rel="noopener">http://www.jetbrains.com/</a></td></tr><tr><td>springtoolsuite</td><td><a href="https://spring.io/tools" target="_blank" rel="noopener">https://spring.io/tools</a></td></tr><tr><td>Pythonå®˜ç½‘</td><td><a href="https://www.python.org/" target="_blank" rel="noopener">https://www.python.org/</a></td></tr><tr><td>Mavenå®˜ç½‘</td><td><a href="https://maven.apache.org/" target="_blank" rel="noopener">https://maven.apache.org/</a></td></tr><tr><td>Mavenä»“åº“</td><td><a href="https://mvnrepository.com/" target="_blank" rel="noopener">https://mvnrepository.com/</a></td></tr><tr><td>Nexuså®˜ç½‘</td><td><a href="https://www.nexusmods.com/" target="_blank" rel="noopener">https://www.nexusmods.com/</a></td></tr><tr><td>Antå®˜ç½‘</td><td><a href="https://ant.apache.org/" target="_blank" rel="noopener">https://ant.apache.org/</a></td></tr><tr><td>SVNå®˜ç½‘</td><td><a href="https://tortoisesvn.net/" target="_blank" rel="noopener">https://tortoisesvn.net/</a></td></tr><tr><td>Gitå®˜ç½‘</td><td><a href="https://git-scm.com/" target="_blank" rel="noopener">https://git-scm.com/</a></td></tr><tr><td>Springå®˜ç½‘</td><td><a href="https://spring.io/" target="_blank" rel="noopener">https://spring.io/</a></td></tr><tr><td>mybatis</td><td><a href="https://mybatis.org/mybatis-3/" target="_blank" rel="noopener">https://mybatis.org/mybatis-3/</a></td></tr><tr><td>#### æœåŠ¡ç›¸å…³</td><td></td></tr><tr><td>ç½‘ç«™</td><td>åœ°å€</td></tr><tr><td>â€”â€”â€”â€”â€”</td><td>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</td></tr><tr><td>APACHEå®˜ç½‘</td><td><a href="http://tomcat.apache.org/" target="_blank" rel="noopener">http://tomcat.apache.org/</a></td></tr><tr><td>Tomcatå®˜ç½‘</td><td><a href="http://tomcat.apache.org/" target="_blank" rel="noopener">http://tomcat.apache.org/</a></td></tr><tr><td>Nginxå®˜ç½‘</td><td><a href="http://nginx.org/" target="_blank" rel="noopener">http://nginx.org/</a></td></tr><tr><td>Dubboå®˜ç½‘</td><td><a href="http://dubbo.apache.org/zh-cn/" target="_blank" rel="noopener">http://dubbo.apache.org/zh-cn/</a></td></tr><tr><td>Zookeeper</td><td><a href="https://zookeeper.apache.org/" target="_blank" rel="noopener">https://zookeeper.apache.org/</a></td></tr><tr><td>netty</td><td><a href="https://netty.io/" target="_blank" rel="noopener">https://netty.io/</a></td></tr><tr><td>jetty</td><td><a href="http://www.eclipse.org/jetty/" target="_blank" rel="noopener">http://www.eclipse.org/jetty/</a></td></tr></tbody></table><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>Linux</td><td><a href="https://www.linux.org/" target="_blank" rel="noopener">https://www.linux.org/</a></td></tr><tr><td>Linuxå¼€æºç¤¾åŒº</td><td><a href="https://linux.cn/" target="_blank" rel="noopener">https://linux.cn/</a></td></tr><tr><td>Linuxå…¬ç¤¾</td><td><a href="https://www.linuxidc.com/" target="_blank" rel="noopener">https://www.linuxidc.com/</a></td></tr></tbody></table><h4 id="æ•°æ®åº“ç›¸å…³"><a href="#æ•°æ®åº“ç›¸å…³" class="headerlink" title="æ•°æ®åº“ç›¸å…³"></a>æ•°æ®åº“ç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>Mysqlå®˜ç½‘</td><td><a href="https://www.mysql.com/" target="_blank" rel="noopener">https://www.mysql.com/</a></td></tr><tr><td>SQL SERVERå®˜ç½‘</td><td><a href="https://www.microsoft.com/zh-cn/sql-server/sql-server-downloads" target="_blank" rel="noopener">https://www.microsoft.com/zh-cn/sql-server/sql-server-downloads</a></td></tr><tr><td>ORICLEå®˜ç½‘</td><td><a href="https://www.oracle.com/downloads/" target="_blank" rel="noopener">https://www.oracle.com/downloads/</a></td></tr><tr><td>DB2å®˜ç½‘</td><td><a href="https://www.ibm.com/analytics/cn/zh/technology/db2/" target="_blank" rel="noopener">https://www.ibm.com/analytics/cn/zh/technology/db2/</a></td></tr><tr><td>TOADå®˜ç½‘</td><td><a href="https://www.toadworld.com/" target="_blank" rel="noopener">https://www.toadworld.com/</a></td></tr><tr><td>Navicatå®˜ç½‘</td><td><a href="https://www.navicat.com.cn/" target="_blank" rel="noopener">https://www.navicat.com.cn/</a></td></tr><tr><td>DataGripå®˜ç½‘</td><td><a href="https://www.jetbrains.com/zh/datagrip/specials/datagrip/datagrip.html" target="_blank" rel="noopener">https://www.jetbrains.com/zh/datagrip/specials/datagrip/datagrip.html</a></td></tr><tr><td>Rediså®˜ç½‘</td><td><a href="https://redis.io/" target="_blank" rel="noopener">https://redis.io/</a></td></tr><tr><td>Redisä¸­æ–‡ç½‘</td><td><a href="http://www.redis.cn/" target="_blank" rel="noopener">http://www.redis.cn/</a></td></tr><tr><td>MongoDBå®˜ç½‘</td><td><a href="https://www.mongodb.com/Nginx" target="_blank" rel="noopener">https://www.mongodb.com/Nginx</a>  <a href="http://nginx.org/" target="_blank" rel="noopener">http://nginx.org/</a></td></tr><tr><td>UMLå·¥å…·åˆ—è¡¨</td><td><a href="http://www.umlchina.com/Tools/Newindex1.htm" target="_blank" rel="noopener">http://www.umlchina.com/Tools/Newindex1.htm</a></td></tr></tbody></table><h4 id="å‰ç«¯ç›¸å…³"><a href="#å‰ç«¯ç›¸å…³" class="headerlink" title="å‰ç«¯ç›¸å…³"></a>å‰ç«¯ç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>w3schoolå®˜ç½‘</td><td><a href="http://www.w3school.com.cn/" target="_blank" rel="noopener">http://www.w3school.com.cn/</a></td></tr><tr><td>jQueryå®˜ç½‘</td><td><a href="https://jquery.com/" target="_blank" rel="noopener">https://jquery.com/</a></td></tr><tr><td>jQuery api   éå®˜ç½‘:</td><td><a href="http://jquery.cuishifeng.cn/" target="_blank" rel="noopener">http://jquery.cuishifeng.cn/</a></td></tr><tr><td>easyuiå®˜ç½‘</td><td><a href="http://www.jeasyui.net/" target="_blank" rel="noopener">http://www.jeasyui.net/</a></td></tr><tr><td>Bootstrapå®˜ç½‘</td><td><a href="https://www.bootcss.com/" target="_blank" rel="noopener">https://www.bootcss.com/</a></td></tr><tr><td>Amaze ~ å¦¹å­ UIå®˜ç½‘:</td><td><a href="http://amazeui.org/" target="_blank" rel="noopener">http://amazeui.org/</a></td></tr><tr><td>React</td><td><a href="https://react.docschina.org/" target="_blank" rel="noopener">https://react.docschina.org/</a></td></tr><tr><td>NOWA</td><td><a href="https://nowa-webpack.github.io/" target="_blank" rel="noopener">https://nowa-webpack.github.io/</a></td></tr><tr><td>Vueå®˜ç½‘:</td><td><a href="https://cn.vuejs.org/" target="_blank" rel="noopener">https://cn.vuejs.org/</a></td></tr><tr><td>AngularJSä¸­æ–‡ç½‘</td><td><a href="https://www.angularjs.net.cn/" target="_blank" rel="noopener">https://www.angularjs.net.cn/</a></td></tr><tr><td>å¼€æºå›¾æ ‡åº“</td><td><a href="https://remixicon.com/" target="_blank" rel="noopener">https://remixicon.com/</a></td></tr><tr><td>å¼€æºå›¾æ ‡åº“é¢„è§ˆ</td><td><a href="https://lvyueyang.gitee.io/remixicon/" target="_blank" rel="noopener">https://lvyueyang.gitee.io/remixicon/</a></td></tr></tbody></table><h4 id="è¿œç¨‹æˆ–ä¼ è¾“"><a href="#è¿œç¨‹æˆ–ä¼ è¾“" class="headerlink" title="è¿œç¨‹æˆ–ä¼ è¾“"></a>è¿œç¨‹æˆ–ä¼ è¾“</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>SecureCRTå®˜ç½‘</td><td><a href="https://www.vandyke.com/products/securecrt/" target="_blank" rel="noopener">https://www.vandyke.com/products/securecrt/</a></td></tr><tr><td>XSHELLå®˜ç½‘</td><td><a href="https://xshell.en.softonic.com/" target="_blank" rel="noopener">https://xshell.en.softonic.com/</a></td></tr><tr><td>WinSCPå®˜ç½‘</td><td><a href="https://winscp.net/eng/docs/lang:chs" target="_blank" rel="noopener">https://winscp.net/eng/docs/lang:chs</a></td></tr><tr><td>File-Zillaå®˜ç½‘</td><td><a href="https://filezilla-project.org/" target="_blank" rel="noopener">https://filezilla-project.org/</a></td></tr><tr><td>File-Zillaä¸­æ–‡ç½‘</td><td><a href="https://www.filezilla.cn/" target="_blank" rel="noopener">https://www.filezilla.cn/</a></td></tr><tr><td>flashfxpå®˜ç½‘</td><td><a href="https://www.flashfxp.com/" target="_blank" rel="noopener">https://www.flashfxp.com/</a></td></tr></tbody></table><h4 id="å°å·¥å…·"><a href="#å°å·¥å…·" class="headerlink" title="å°å·¥å…·"></a>å°å·¥å…·</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>7z</td><td><a href="https://www.7-zip.org/" target="_blank" rel="noopener">https://www.7-zip.org/</a></td></tr><tr><td>WINRARå®˜ç½‘</td><td><a href="http://www.winrar.com.cn/" target="_blank" rel="noopener">http://www.winrar.com.cn/</a></td></tr><tr><td>åœ¨çº¿å·¥å…·ç®±</td><td><a href="https://tool.lu/" target="_blank" rel="noopener">https://tool.lu/</a></td></tr><tr><td>DeskTopShare</td><td><a href="http://www.yinrg.net/" target="_blank" rel="noopener">http://www.yinrg.net/</a></td></tr></tbody></table><h4 id="å›¾ç‰‡ç›¸å…³"><a href="#å›¾ç‰‡ç›¸å…³" class="headerlink" title="å›¾ç‰‡ç›¸å…³"></a>å›¾ç‰‡ç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>å›¾ç‰‡å‹ç¼©TinyPNG</td><td><a href="https://tinypng.com/" target="_blank" rel="noopener">https://tinypng.com/</a></td></tr><tr><td>å›¾ç‰‡å»èƒŒæ™¯</td><td><a href="http://www.aigei.com/bgremover/" target="_blank" rel="noopener">http://www.aigei.com/bgremover/</a></td></tr><tr><td>å‡ºç°ä¸€å¼ éšæœºå›¾ç‰‡</td><td><a href="https://api.uomg.com/api/image.lofter?format=images" target="_blank" rel="noopener">https://api.uomg.com/api/image.lofter?format=images</a></td></tr></tbody></table><h4 id="å›¾åºŠå·¥å…·ï¼š"><a href="#å›¾åºŠå·¥å…·ï¼š" class="headerlink" title="å›¾åºŠå·¥å…·ï¼š"></a>å›¾åºŠå·¥å…·ï¼š</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>PicGo</td><td><a href="https://github.com/Molunerfinn/PicGo" target="_blank" rel="noopener">https://github.com/Molunerfinn/PicGo</a></td></tr><tr><td>MPic-å›¾åºŠç¥å™¨</td><td><a href="http://mpic.lzhaofu.cn" target="_blank" rel="noopener">http://mpic.lzhaofu.cn</a></td></tr><tr><td>PicPlus -æ‰‹æœºå›¾åºŠ</td><td><a href="https://www.coolapk.com/apk/name.gudong.pic" target="_blank" rel="noopener">https://www.coolapk.com/apk/name.gudong.pic</a></td></tr></tbody></table><h4 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>open jdkç›¸å…³</td><td><a href="https://www.iteye.com/blog/user/rednaxelafx" target="_blank" rel="noopener">https://www.iteye.com/blog/user/rednaxelafx</a></td></tr></tbody></table><h4 id="XMLç›¸å…³"><a href="#XMLç›¸å…³" class="headerlink" title="XMLç›¸å…³"></a>XMLç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>Castorå®ç°XMLä¸Javaçš„äº’è½¬</td><td><a href="http://www.castor.org/" target="_blank" rel="noopener">http://www.castor.org/</a></td></tr></tbody></table><!--  JDK6JAXB2æ¥å®ç°å¯¹è±¡ä¸XMLä¹‹é—´çš„æ˜ å°„  --><h4 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>quartz</td><td><a href="https://www.w3cschool.cn/quartz_doc/" target="_blank" rel="noopener">https://www.w3cschool.cn/quartz_doc/</a></td></tr><tr><td>viewerjsï¼ŒPDF/officeåœ¨çº¿é¢„è§ˆ</td><td><a href="https://fengyuanchen.github.io/viewerjs/" target="_blank" rel="noopener">https://fengyuanchen.github.io/viewerjs/</a></td></tr></tbody></table><h4 id="markdown"><a href="#markdown" class="headerlink" title="markdown"></a>markdown</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>mkdownåœ¨çº¿ç¼–è¾‘å™¨</td><td><a href="http://www.mdeditor.com/" target="_blank" rel="noopener">http://www.mdeditor.com/</a></td></tr><tr><td>mkdownåœ¨çº¿ç¼–è¾‘å™¨</td><td><a href="http://mahua.jser.me/" target="_blank" rel="noopener">http://mahua.jser.me/</a></td></tr><tr><td>mkdownåœ¨çº¿ç¼–è¾‘å™¨</td><td><a href="https://tool.lu/markdown/" target="_blank" rel="noopener">https://tool.lu/markdown/</a></td></tr><tr><td>mkdownåœ¨çº¿ç¼–è¾‘å™¨</td><td><a href="https://dillinger.io/" target="_blank" rel="noopener">https://dillinger.io/</a></td></tr></tbody></table><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> æ”¶è—èµ„æº </category>
          
          <category> å·¥å…·ç½‘ç«™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç«™åˆ—è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€å‘å¸¸ç”¨çš„ç½‘ç«™</title>
      <link href="/posts/2d1a17c5.html"/>
      <url>/posts/2d1a17c5.html</url>
      
        <content type="html"><![CDATA[<h4 id="APIåœ¨çº¿"><a href="#APIåœ¨çº¿" class="headerlink" title="APIåœ¨çº¿"></a>APIåœ¨çº¿</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>å¸¸ç”¨APIæ–‡æ¡£ç´¢å¼•</td><td><a href="https://tool.oschina.net/apidocs" target="_blank" rel="noopener">https://tool.oschina.net/apidocs</a></td></tr><tr><td>java8 API</td><td><a href="https://www.matools.com/api/java8" target="_blank" rel="noopener">https://www.matools.com/api/java8</a></td></tr><tr><td>Mybatis java API</td><td>h<a href="https://mybatis.org/mybatis-3/zh/java-api.html" target="_blank" rel="noopener">https://mybatis.org/mybatis-3/zh/java-api.html</a></td></tr><tr><td>dubbo API</td><td><a href="http://dubbo.apache.org/zh-cn/docs/user/configuration/api.html" target="_blank" rel="noopener">http://dubbo.apache.org/zh-cn/docs/user/configuration/api.html</a></td></tr></tbody></table><h4 id="å¼€æºç½‘ç«™"><a href="#å¼€æºç½‘ç«™" class="headerlink" title="å¼€æºç½‘ç«™"></a>å¼€æºç½‘ç«™</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>githubç½‘ç«™</td><td><a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a></td></tr><tr><td>ç äº‘</td><td><a href="https://gitee.com/" target="_blank" rel="noopener">https://gitee.com/</a></td></tr><tr><td>ä¸€èµ·å¼€æºå®˜ç½‘</td><td><a href="http://www.17ky.net/" target="_blank" rel="noopener">http://www.17ky.net/</a></td></tr><tr><td>Open JDK</td><td><a href="http://openjdk.java.net/" target="_blank" rel="noopener">http://openjdk.java.net/</a></td></tr><tr><td>Open JDK  HotSpot</td><td><a href="https://wiki.openjdk.java.net/display/HotSpot/Main" target="_blank" rel="noopener">https://wiki.openjdk.java.net/display/HotSpot/Main</a></td></tr></tbody></table><h4 id="å¼€å‘ç›¸å…³"><a href="#å¼€å‘ç›¸å…³" class="headerlink" title="å¼€å‘ç›¸å…³"></a>å¼€å‘ç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>ORICLEå®˜ç½‘</td><td><a href="https://www.oracle.com/downloads/" target="_blank" rel="noopener">https://www.oracle.com/downloads/</a></td></tr><tr><td>JAVAå®˜ç½‘</td><td><a href="https://www.oracle.com/java/technologies/javase-downloads.html" target="_blank" rel="noopener">https://www.oracle.com/java/technologies/javase-downloads.html</a></td></tr><tr><td>ECLIPSEå®˜ç½‘</td><td><a href="https://www.eclipse.org/downloads/" target="_blank" rel="noopener">https://www.eclipse.org/downloads/</a></td></tr><tr><td>IntelliJ IDEA</td><td><a href="http://www.jetbrains.com/" target="_blank" rel="noopener">http://www.jetbrains.com/</a></td></tr><tr><td>springtoolsuite</td><td><a href="https://spring.io/tools" target="_blank" rel="noopener">https://spring.io/tools</a></td></tr><tr><td>Pythonå®˜ç½‘</td><td><a href="https://www.python.org/" target="_blank" rel="noopener">https://www.python.org/</a></td></tr><tr><td>Mavenå®˜ç½‘</td><td><a href="https://maven.apache.org/" target="_blank" rel="noopener">https://maven.apache.org/</a></td></tr><tr><td>Mavenä»“åº“</td><td><a href="https://mvnrepository.com/" target="_blank" rel="noopener">https://mvnrepository.com/</a></td></tr><tr><td>Nexuså®˜ç½‘</td><td><a href="https://www.nexusmods.com/" target="_blank" rel="noopener">https://www.nexusmods.com/</a></td></tr><tr><td>Antå®˜ç½‘</td><td><a href="https://ant.apache.org/" target="_blank" rel="noopener">https://ant.apache.org/</a></td></tr><tr><td>SVNå®˜ç½‘</td><td><a href="https://tortoisesvn.net/" target="_blank" rel="noopener">https://tortoisesvn.net/</a></td></tr><tr><td>Gitå®˜ç½‘</td><td><a href="https://git-scm.com/" target="_blank" rel="noopener">https://git-scm.com/</a></td></tr><tr><td>Springå®˜ç½‘</td><td><a href="https://spring.io/" target="_blank" rel="noopener">https://spring.io/</a></td></tr><tr><td>mybatis</td><td><a href="https://mybatis.org/mybatis-3/" target="_blank" rel="noopener">https://mybatis.org/mybatis-3/</a></td></tr><tr><td>slf4j</td><td><a href="http://www.slf4j.org" target="_blank" rel="noopener">http://www.slf4j.org</a></td></tr><tr><td>webjars</td><td><a href="https://www.webjars.org/" target="_blank" rel="noopener">https://www.webjars.org/</a></td></tr></tbody></table><h4 id="æœåŠ¡ç›¸å…³"><a href="#æœåŠ¡ç›¸å…³" class="headerlink" title="æœåŠ¡ç›¸å…³"></a>æœåŠ¡ç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>APACHEå®˜ç½‘</td><td><a href="http://tomcat.apache.org/" target="_blank" rel="noopener">http://tomcat.apache.org/</a></td></tr><tr><td>Tomcatå®˜ç½‘</td><td><a href="http://tomcat.apache.org/" target="_blank" rel="noopener">http://tomcat.apache.org/</a></td></tr><tr><td>Nginxå®˜ç½‘</td><td><a href="http://nginx.org/" target="_blank" rel="noopener">http://nginx.org/</a></td></tr><tr><td>Dubboå®˜ç½‘</td><td><a href="http://dubbo.apache.org/zh-cn/" target="_blank" rel="noopener">http://dubbo.apache.org/zh-cn/</a></td></tr><tr><td>Zookeeper</td><td><a href="https://zookeeper.apache.org/" target="_blank" rel="noopener">https://zookeeper.apache.org/</a></td></tr><tr><td>netty</td><td><a href="https://netty.io/" target="_blank" rel="noopener">https://netty.io/</a></td></tr><tr><td>jetty</td><td><a href="http://www.eclipse.org/jetty/" target="_blank" rel="noopener">http://www.eclipse.org/jetty/</a></td></tr></tbody></table><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>Linux</td><td><a href="https://www.linux.org/" target="_blank" rel="noopener">https://www.linux.org/</a></td></tr><tr><td>Linuxå¼€æºç¤¾åŒº</td><td><a href="https://linux.cn/" target="_blank" rel="noopener">https://linux.cn/</a></td></tr><tr><td>Linuxå…¬ç¤¾</td><td><a href="https://www.linuxidc.com/" target="_blank" rel="noopener">https://www.linuxidc.com/</a></td></tr></tbody></table><h4 id="æ•°æ®åº“ç›¸å…³"><a href="#æ•°æ®åº“ç›¸å…³" class="headerlink" title="æ•°æ®åº“ç›¸å…³"></a>æ•°æ®åº“ç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>Mysqlå®˜ç½‘</td><td><a href="https://www.mysql.com/" target="_blank" rel="noopener">https://www.mysql.com/</a></td></tr><tr><td>SQL SERVERå®˜ç½‘</td><td><a href="https://www.microsoft.com/zh-cn/sql-server/sql-server-downloads" target="_blank" rel="noopener">https://www.microsoft.com/zh-cn/sql-server/sql-server-downloads</a></td></tr><tr><td>ORICLEå®˜ç½‘</td><td><a href="https://www.oracle.com/downloads/" target="_blank" rel="noopener">https://www.oracle.com/downloads/</a></td></tr><tr><td>DB2å®˜ç½‘</td><td><a href="https://www.ibm.com/analytics/cn/zh/technology/db2/" target="_blank" rel="noopener">https://www.ibm.com/analytics/cn/zh/technology/db2/</a></td></tr><tr><td>TOADå®˜ç½‘</td><td><a href="https://www.toadworld.com/" target="_blank" rel="noopener">https://www.toadworld.com/</a></td></tr><tr><td>Navicatå®˜ç½‘</td><td><a href="https://www.navicat.com.cn/" target="_blank" rel="noopener">https://www.navicat.com.cn/</a></td></tr><tr><td>DataGripå®˜ç½‘</td><td><a href="https://www.jetbrains.com/zh/datagrip/specials/datagrip/datagrip.html" target="_blank" rel="noopener">https://www.jetbrains.com/zh/datagrip/specials/datagrip/datagrip.html</a></td></tr><tr><td>Rediså®˜ç½‘</td><td><a href="https://redis.io/" target="_blank" rel="noopener">https://redis.io/</a></td></tr><tr><td>Redisä¸­æ–‡ç½‘</td><td><a href="http://www.redis.cn/" target="_blank" rel="noopener">http://www.redis.cn/</a></td></tr><tr><td>MongoDBå®˜ç½‘</td><td><a href="https://www.mongodb.com/Nginx" target="_blank" rel="noopener">https://www.mongodb.com/Nginx</a>  <a href="http://nginx.org/" target="_blank" rel="noopener">http://nginx.org/</a></td></tr><tr><td>UMLå·¥å…·åˆ—è¡¨</td><td><a href="http://www.umlchina.com/Tools/Newindex1.htm" target="_blank" rel="noopener">http://www.umlchina.com/Tools/Newindex1.htm</a></td></tr></tbody></table><h4 id="å‰ç«¯ç›¸å…³"><a href="#å‰ç«¯ç›¸å…³" class="headerlink" title="å‰ç«¯ç›¸å…³"></a>å‰ç«¯ç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>w3schoolå®˜ç½‘</td><td><a href="http://www.w3school.com.cn/" target="_blank" rel="noopener">http://www.w3school.com.cn/</a></td></tr><tr><td>jQueryå®˜ç½‘</td><td><a href="https://jquery.com/" target="_blank" rel="noopener">https://jquery.com/</a></td></tr><tr><td>jQuery api   éå®˜ç½‘:</td><td><a href="http://jquery.cuishifeng.cn/" target="_blank" rel="noopener">http://jquery.cuishifeng.cn/</a></td></tr><tr><td>easyuiå®˜ç½‘</td><td><a href="http://www.jeasyui.net/" target="_blank" rel="noopener">http://www.jeasyui.net/</a></td></tr><tr><td>Bootstrapå®˜ç½‘</td><td><a href="https://www.bootcss.com/" target="_blank" rel="noopener">https://www.bootcss.com/</a></td></tr><tr><td>Amaze ~ å¦¹å­ UIå®˜ç½‘:</td><td><a href="http://amazeui.org/" target="_blank" rel="noopener">http://amazeui.org/</a></td></tr><tr><td>React</td><td><a href="https://react.docschina.org/" target="_blank" rel="noopener">https://react.docschina.org/</a></td></tr><tr><td>NOWA</td><td><a href="https://nowa-webpack.github.io/" target="_blank" rel="noopener">https://nowa-webpack.github.io/</a></td></tr><tr><td>Vueå®˜ç½‘:</td><td><a href="https://cn.vuejs.org/" target="_blank" rel="noopener">https://cn.vuejs.org/</a></td></tr><tr><td>AngularJSä¸­æ–‡ç½‘</td><td><a href="https://www.angularjs.net.cn/" target="_blank" rel="noopener">https://www.angularjs.net.cn/</a></td></tr><tr><td>å¼€æºå›¾æ ‡åº“</td><td><a href="https://remixicon.com/" target="_blank" rel="noopener">https://remixicon.com/</a></td></tr><tr><td>å¼€æºå›¾æ ‡åº“é¢„è§ˆ</td><td><a href="https://lvyueyang.gitee.io/remixicon/" target="_blank" rel="noopener">https://lvyueyang.gitee.io/remixicon/</a></td></tr></tbody></table><h4 id="è¿œç¨‹æˆ–ä¼ è¾“"><a href="#è¿œç¨‹æˆ–ä¼ è¾“" class="headerlink" title="è¿œç¨‹æˆ–ä¼ è¾“"></a>è¿œç¨‹æˆ–ä¼ è¾“</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>SecureCRTå®˜ç½‘</td><td><a href="https://www.vandyke.com/products/securecrt/" target="_blank" rel="noopener">https://www.vandyke.com/products/securecrt/</a></td></tr><tr><td>XSHELLå®˜ç½‘</td><td><a href="https://xshell.en.softonic.com/" target="_blank" rel="noopener">https://xshell.en.softonic.com/</a></td></tr><tr><td>WinSCPå®˜ç½‘</td><td><a href="https://winscp.net/eng/docs/lang:chs" target="_blank" rel="noopener">https://winscp.net/eng/docs/lang:chs</a></td></tr><tr><td>File-Zillaå®˜ç½‘</td><td><a href="https://filezilla-project.org/" target="_blank" rel="noopener">https://filezilla-project.org/</a></td></tr><tr><td>File-Zillaä¸­æ–‡ç½‘</td><td><a href="https://www.filezilla.cn/" target="_blank" rel="noopener">https://www.filezilla.cn/</a></td></tr><tr><td>flashfxpå®˜ç½‘</td><td><a href="https://www.flashfxp.com/" target="_blank" rel="noopener">https://www.flashfxp.com/</a></td></tr></tbody></table><h4 id="å°å·¥å…·"><a href="#å°å·¥å…·" class="headerlink" title="å°å·¥å…·"></a>å°å·¥å…·</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>7z</td><td><a href="https://www.7-zip.org/" target="_blank" rel="noopener">https://www.7-zip.org/</a></td></tr><tr><td>WINRARå®˜ç½‘</td><td><a href="http://www.winrar.com.cn/" target="_blank" rel="noopener">http://www.winrar.com.cn/</a></td></tr><tr><td>åœ¨çº¿å·¥å…·ç®±</td><td><a href="https://tool.lu/" target="_blank" rel="noopener">https://tool.lu/</a></td></tr><tr><td>DeskTopShare</td><td><a href="http://www.yinrg.net/" target="_blank" rel="noopener">http://www.yinrg.net/</a></td></tr></tbody></table><h4 id="å›¾ç‰‡ç›¸å…³"><a href="#å›¾ç‰‡ç›¸å…³" class="headerlink" title="å›¾ç‰‡ç›¸å…³"></a>å›¾ç‰‡ç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>å›¾ç‰‡å‹ç¼©TinyPNG</td><td><a href="https://tinypng.com/" target="_blank" rel="noopener">https://tinypng.com/</a></td></tr><tr><td>å›¾ç‰‡å»èƒŒæ™¯</td><td><a href="http://www.aigei.com/bgremover/" target="_blank" rel="noopener">http://www.aigei.com/bgremover/</a></td></tr><tr><td>å‡ºç°ä¸€å¼ éšæœºå›¾ç‰‡</td><td><a href="https://api.uomg.com/api/image.lofter?format=images" target="_blank" rel="noopener">https://api.uomg.com/api/image.lofter?format=images</a></td></tr></tbody></table><h4 id="å›¾åºŠå·¥å…·ï¼š"><a href="#å›¾åºŠå·¥å…·ï¼š" class="headerlink" title="å›¾åºŠå·¥å…·ï¼š"></a>å›¾åºŠå·¥å…·ï¼š</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>PicGo</td><td><a href="https://github.com/Molunerfinn/PicGo" target="_blank" rel="noopener">https://github.com/Molunerfinn/PicGo</a></td></tr><tr><td>MPic-å›¾åºŠç¥å™¨</td><td><a href="http://mpic.lzhaofu.cn" target="_blank" rel="noopener">http://mpic.lzhaofu.cn</a></td></tr><tr><td>PicPlus -æ‰‹æœºå›¾åºŠ</td><td><a href="https://www.coolapk.com/apk/name.gudong.pic" target="_blank" rel="noopener">https://www.coolapk.com/apk/name.gudong.pic</a></td></tr></tbody></table><h4 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>open jdkç›¸å…³</td><td><a href="https://www.iteye.com/blog/user/rednaxelafx" target="_blank" rel="noopener">https://www.iteye.com/blog/user/rednaxelafx</a></td></tr></tbody></table><h4 id="XMLç›¸å…³"><a href="#XMLç›¸å…³" class="headerlink" title="XMLç›¸å…³"></a>XMLç›¸å…³</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>Castorå®ç°XMLä¸Javaçš„äº’è½¬</td><td><a href="http://www.castor.org/" target="_blank" rel="noopener">http://www.castor.org/</a></td></tr></tbody></table><!--  JDK6JAXB2æ¥å®ç°å¯¹è±¡ä¸XMLä¹‹é—´çš„æ˜ å°„  --><h4 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>quartz</td><td><a href="https://www.w3cschool.cn/quartz_doc/" target="_blank" rel="noopener">https://www.w3cschool.cn/quartz_doc/</a></td></tr><tr><td>viewerjsï¼ŒPDF/officeåœ¨çº¿é¢„è§ˆ</td><td><a href="https://fengyuanchen.github.io/viewerjs/" target="_blank" rel="noopener">https://fengyuanchen.github.io/viewerjs/</a></td></tr></tbody></table><h4 id="markdown"><a href="#markdown" class="headerlink" title="markdown"></a>markdown</h4><table><thead><tr><th>ç½‘ç«™</th><th>åœ°å€</th></tr></thead><tbody><tr><td>mkdownåœ¨çº¿ç¼–è¾‘å™¨</td><td><a href="http://www.mdeditor.com/" target="_blank" rel="noopener">http://www.mdeditor.com/</a></td></tr><tr><td>mkdownåœ¨çº¿ç¼–è¾‘å™¨</td><td><a href="http://mahua.jser.me/" target="_blank" rel="noopener">http://mahua.jser.me/</a></td></tr><tr><td>mkdownåœ¨çº¿ç¼–è¾‘å™¨</td><td><a href="https://tool.lu/markdown/" target="_blank" rel="noopener">https://tool.lu/markdown/</a></td></tr><tr><td>mkdownåœ¨çº¿ç¼–è¾‘å™¨</td><td><a href="https://dillinger.io/" target="_blank" rel="noopener">https://dillinger.io/</a></td></tr></tbody></table><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> æ”¶è—èµ„æº </category>
          
          <category> å¼€å‘ç½‘ç«™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç«™åˆ—è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos-jdkå®‰è£…é…ç½®ç¯å¢ƒå˜é‡</title>
      <link href="/posts/9064540a.html"/>
      <url>/posts/9064540a.html</url>
      
        <content type="html"><![CDATA[<h2 id="Centosä¸Šjdké…ç½®"><a href="#Centosä¸Šjdké…ç½®" class="headerlink" title="Centosä¸Šjdké…ç½®"></a>Centosä¸Šjdké…ç½®</h2><h2 id="1-æ£€æŸ¥ç¯å¢ƒ"><a href="#1-æ£€æŸ¥ç¯å¢ƒ" class="headerlink" title="1.æ£€æŸ¥ç¯å¢ƒ"></a>1.æ£€æŸ¥ç¯å¢ƒ</h2><p>æŸ¥çœ‹javaç‰ˆæœ¬</p><pre class=" language-bash"><code class="language-bash">java -version</code></pre><p> æ£€æŸ¥æ˜¯å¦å·²ç»å®‰è£…jdkï¼Œé€šå¸¸é»˜è®¤è‡ªè®¤openjdk</p><pre class=" language-bash"><code class="language-bash">java-1.7.0-openjdk-1.7.0.111-2.6.7.8.el7.x86_64java-1.8.0-openjdk-1.8.0.102-4.b14.el7.x86_64java-1.8.0-openjdk-headless-1.8.0.102-4.b14.el7.x86_64java-1.7.0-openjdk-headless-1.7.0.111-2.6.7.8.el7.x86_64</code></pre><p> å¦‚æœè¦å¸è½½,éœ€è¦rootç”¨æˆ·æƒé™æ‰å¯ä»¥æ‰§è¡Œï¼š</p><pre class=" language-bash"><code class="language-bash">rpm -e --nodeps java-1.7.0-openjdk-1.7.0.111-2.6.7.8.el7.x86_64rpm -e --nodeps java-1.8.0-openjdk-1.8.0.102-4.b14.el7.x86_64rpm -e --nodeps java-1.8.0-openjdk-headless-1.8.0.102-4.b14.el7.x86_64rpm -e --nodeps java-1.7.0-openjdk-headless-1.7.0.111-2.6.7.8.el7.x86_64</code></pre><p>å†æ¬¡æŸ¥çœ‹javaç‰ˆæœ¬ï¼Œå¦‚æç¤ºæœªæ‰¾åˆ°å‘½ä»¤åˆ™åˆ é™¤æˆåŠŸã€‚</p><h2 id="2-ä¸Šä¼ jdkå®‰è£…æ–‡ä»¶"><a href="#2-ä¸Šä¼ jdkå®‰è£…æ–‡ä»¶" class="headerlink" title="2.ä¸Šä¼ jdkå®‰è£…æ–‡ä»¶"></a>2.ä¸Šä¼ jdkå®‰è£…æ–‡ä»¶</h2><h4 id="ä¸Šä¼ æ–¹æ³•"><a href="#ä¸Šä¼ æ–¹æ³•" class="headerlink" title="ä¸Šä¼ æ–¹æ³•"></a>ä¸Šä¼ æ–¹æ³•</h4><p>ï¼ˆ1ï¼‰å¯ä»¥è”ç½‘ç›´æ¥ä¸‹è½½å³å¯<br>ï¼ˆ2ï¼‰sshå¯ä»¥å®‰è£…ç”¨rz/szä¸Šä¼ ä¸‹è½½<br>ï¼ˆ3ï¼‰ftpè‡ªè¡Œå®‰è£…ftpæœåŠ¡ï¼Œå…³äºå®‰è£…æ•™ç¨‹å¯åˆ°ï¼š</p><p>ä¸Šä¼ jdk-7u80-linux-x64.tar.gzåˆ°ä½ çš„ç›®å½•åï¼Œ<br>è§£å‹åç§»åŠ¨åˆ° <code>/usr/jdk1.7.0_80</code></p><pre class=" language-bash"><code class="language-bash"><span class="token function">tar</span> -zxvf jdk-7u80-linux-x64.tar.gz<span class="token function">cp</span>  jdk-7u80 /usr/jdk1.7.0_80</code></pre><p>ã€å…³äºè§£å‹å‘½ä»¤å¤§å…¨å¯ä»¥ç§»æ­¥ï¼šã€‘</p><h2 id="2-é…ç½®å…³å˜é‡"><a href="#2-é…ç½®å…³å˜é‡" class="headerlink" title="2.é…ç½®å…³å˜é‡"></a>2.é…ç½®å…³å˜é‡</h2><p>/etc/profileå…¨å±€å˜é‡é…ç½®</p><pre class=" language-bash"><code class="language-bash">vim /etc/profile</code></pre><p>.bash_profileä¸ºrootç”¨æˆ·çš„ç¯å¢ƒå˜é‡ã€‚</p><pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /root/<span class="token function">ls</span> -a<span class="token function">vi</span> .bash_profile</code></pre><p>äºŒè€…å‡å¯ï¼Œå»ºè®®ä¿®æ”¹ç”¨æˆ·ç¯å¢ƒå˜é‡ã€‚<br>åœ¨æ–‡ä»¶æœ«å°¾å¢åŠ javaç¯å¢ƒå˜é‡å³å¯,å¬è¯´CentOS6ä¸Šé¢çš„æ˜¯JAVAHOMEï¼ŒCentOS7æ˜¯{JAVA_HOME}</p><pre><code># .bash_profile# Get the aliases and functionsif [ -f ~/.bashrc ]; then        . ~/.bashrcfi# User specific environment and startup programsexport JAVA_HOME=/usr/jdk1.7.0_80export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarPATH=$PATH:$HOME/bin:$JAVA_HOME/binexport PATH</code></pre><h2 id="3-è®©åˆšåˆšè®¾ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ"><a href="#3-è®©åˆšåˆšè®¾ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ" class="headerlink" title="3.è®©åˆšåˆšè®¾ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ"></a>3.è®©åˆšåˆšè®¾ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</h2><pre class=" language-bash"><code class="language-bash"><span class="token function">source</span> /etc/profile</code></pre><p>æˆ–è€…</p><pre class=" language-bash"><code class="language-bash"><span class="token function">source</span> .bash_profile</code></pre><h2 id="4-å†æ¬¡éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ"><a href="#4-å†æ¬¡éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ" class="headerlink" title="4.å†æ¬¡éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ"></a>4.å†æ¬¡éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ</h2><pre class=" language-bash"><code class="language-bash">java -version</code></pre><p>å‡ºç°javaç‰ˆæœ¬å·ä»£è¡¨å®‰è£…æˆåŠŸã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å„å‚å•†æ•°æ®åº“å­—æ®µçš„Javaç±»å‹å’ŒJDBCç±»å‹å¯¹åº”å…³ç³»</title>
      <link href="/posts/dc390855.html"/>
      <url>/posts/dc390855.html</url>
      
        <content type="html"><![CDATA[<p>å¸¸è§æ•°æ®åº“å­—æ®µçš„Javaç±»å‹å’ŒJDBCç±»å‹å¯¹åº”å…³ç³»</p><a id="more"></a><p><img src="/medias/loading-animated.gif" data-original="/images/db_jdbcType.jpg" alt="Image text"></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Mybatis </tag>
            
            <tag> DB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centosç›¸å…³é…ç½®</title>
      <link href="/posts/42e4f857.html"/>
      <url>/posts/42e4f857.html</url>
      
        <content type="html"><![CDATA[<h2 id="Centoså„ç§é…ç½®"><a href="#Centoså„ç§é…ç½®" class="headerlink" title="Centoså„ç§é…ç½®"></a>Centoså„ç§é…ç½®</h2><h2 id="1-Centosç½‘ç»œé…ç½®"><a href="#1-Centosç½‘ç»œé…ç½®" class="headerlink" title="1.Centosç½‘ç»œé…ç½®"></a>1.Centosç½‘ç»œé…ç½®</h2><h4 id="ç½‘ç»œé…ç½®"><a href="#ç½‘ç»œé…ç½®" class="headerlink" title="ç½‘ç»œé…ç½®"></a>ç½‘ç»œé…ç½®</h4><p>æœ‰å›¾å½¢ç•Œé¢å¯ä»¥ç›´æ¥ç•Œé¢æ“ä½œï¼Œæ²¡æœ‰ç•Œé¢å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š<br>ï¼ˆ1ï¼‰ä¿®æ”¹é…ç½®</p><pre class=" language-bash"><code class="language-bash">$ <span class="token function">cd</span> /etc/sysconfig/network-scripts/</code></pre><p>ä¿®æ”¹å¯¹åº”ç½‘å¡çš„é…ç½®ï¼Œå¯ä»¥ifconfigçœ‹çœ‹ç”¨çš„ç½‘å¡åã€‚<br>ä¿®æ”¹ç›¸å…³é…ç½®ï¼š</p><pre><code>TYPE=EthernetPROXY_METHOD=noneBROWSER_ONLY=noBOOTPROTO=noneDEFROUTE=yesIPV4_FAILURE_FATAL=noIPV6INIT=yesIPV6_AUTOCONF=yesIPV6_DEFROUTE=yesIPV6_FAILURE_FATAL=noIPV6_ADDR_GEN_MODE=stable-privacyNAME=ens192UUID=64e7784d-8183-4db5-af4c-120203391708DEVICE=ens192ONBOOT=yesIPADDR=192.168.66.80PREFIX=24GATEWAY=192.168.66.254IPV6_PRIVACY=no</code></pre><p>ï¼ˆ2ï¼‰é‡å¯ç½‘ç»œæœåŠ¡</p><pre class=" language-bash"><code class="language-bash">$ <span class="token function">service</span> network restart</code></pre><h2 id="2-Centosæ—¶é—´é…ç½®"><a href="#2-Centosæ—¶é—´é…ç½®" class="headerlink" title="2.Centosæ—¶é—´é…ç½®"></a>2.Centosæ—¶é—´é…ç½®</h2><p>è®¾ç½®æ—¶åŒºåŒæ ·,åœ¨ CentOS 7 ä¸­, å¼•å…¥äº†ä¸€ä¸ªå« timedatectl çš„è®¾ç½®è®¾ç½®ç¨‹åº.<br>ç”¨æ³•å¾ˆç®€å•:<code>timedatectl # æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´æ–¹é¢çš„å„ç§çŠ¶æ€</code></p><pre><code>      Local time: å›› 2014-12-25 10:52:10 CST  Universal time: å›› 2014-12-25 02:52:10 UTC        RTC time: å›› 2014-12-25 02:52:10        Timezone: Asia/Shanghai (CST, +0800)     NTP enabled: yesNTP synchronized: yes RTC in local TZ: no      DST active: n/a</code></pre><h4 id="åˆ—å‡ºæ‰€æœ‰æ—¶åŒº"><a href="#åˆ—å‡ºæ‰€æœ‰æ—¶åŒº" class="headerlink" title="åˆ—å‡ºæ‰€æœ‰æ—¶åŒº"></a>åˆ—å‡ºæ‰€æœ‰æ—¶åŒº</h4><pre class=" language-bash"><code class="language-bash">$ timedatectl list-timezones </code></pre><h4 id="å°†ç¡¬ä»¶æ—¶é’Ÿè°ƒæ•´ä¸ºä¸æœ¬åœ°æ—¶é’Ÿä¸€è‡´-0-ä¸ºè®¾ç½®ä¸º-UTC-æ—¶é—´"><a href="#å°†ç¡¬ä»¶æ—¶é’Ÿè°ƒæ•´ä¸ºä¸æœ¬åœ°æ—¶é’Ÿä¸€è‡´-0-ä¸ºè®¾ç½®ä¸º-UTC-æ—¶é—´" class="headerlink" title="å°†ç¡¬ä»¶æ—¶é’Ÿè°ƒæ•´ä¸ºä¸æœ¬åœ°æ—¶é’Ÿä¸€è‡´, 0 ä¸ºè®¾ç½®ä¸º UTC æ—¶é—´"></a>å°†ç¡¬ä»¶æ—¶é’Ÿè°ƒæ•´ä¸ºä¸æœ¬åœ°æ—¶é’Ÿä¸€è‡´, 0 ä¸ºè®¾ç½®ä¸º UTC æ—¶é—´</h4><pre class=" language-bash"><code class="language-bash">$ timedatectl set-local-rtc 1 </code></pre><h4 id="è®¾ç½®ç³»ç»Ÿæ—¶åŒºä¸ºä¸Šæµ·"><a href="#è®¾ç½®ç³»ç»Ÿæ—¶åŒºä¸ºä¸Šæµ·" class="headerlink" title="è®¾ç½®ç³»ç»Ÿæ—¶åŒºä¸ºä¸Šæµ·"></a>è®¾ç½®ç³»ç»Ÿæ—¶åŒºä¸ºä¸Šæµ·</h4><pre class=" language-bash"><code class="language-bash">$ timedatectl set-timezone Asia/Shanghai </code></pre><h4 id="ç›´æ¥ä¿®æ”¹æ—¶é—´æ—¶åŒº"><a href="#ç›´æ¥ä¿®æ”¹æ—¶é—´æ—¶åŒº" class="headerlink" title="ç›´æ¥ä¿®æ”¹æ—¶é—´æ—¶åŒº"></a>ç›´æ¥ä¿®æ”¹æ—¶é—´æ—¶åŒº</h4><p>å…¶å®ä¸è€ƒè™‘å„ä¸ªå‘è¡Œç‰ˆçš„å·®å¼‚åŒ–, ä»æ›´åº•å±‚å‡ºå‘çš„è¯, ç›´æ¥ä¿®æ”¹æ—¶é—´æ—¶åŒº:</p><pre class=" language-bash"><code class="language-bash">$ <span class="token function">cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code></pre><h2 id="3-DNSè§£æé—®é¢˜"><a href="#3-DNSè§£æé—®é¢˜" class="headerlink" title="3.DNSè§£æé—®é¢˜"></a>3.DNSè§£æé—®é¢˜</h2><p>ping IPå¯ä»¥ ping åŸŸåä¸é€šçš„æ—¶å€™</p><pre class=" language-bash"><code class="language-bash">$ vim /etc/resolve.conf</code></pre><p>å¢åŠ ï¼š</p><pre><code>nameserver 8.8.8.8nameserver 8.8.4.4</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Centos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
